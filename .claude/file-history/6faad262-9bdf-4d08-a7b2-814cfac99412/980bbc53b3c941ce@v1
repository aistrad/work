"use client";

/**
 * Chat Page - Main conversation interface
 * Based on: vibelife spec v3.0
 *
 * Features:
 * - Skill selection (bazi / zodiac)
 * - Voice mode toggle (warm / sarcastic)
 * - Daily Greeting display
 * - SSE streaming responses
 */

import { useState } from "react";
import { ChatLayout } from "@/components/chat/ChatLayout";
import { ChatContainer } from "@/components/chat/ChatContainer";
import { type SkillType } from "@/components/core";

// ═══════════════════════════════════════════════════════════════════════════
// Types
// ═══════════════════════════════════════════════════════════════════════════

type VoiceMode = "warm" | "sarcastic";

const SKILL_CONFIG: Record<SkillType, { name: string; description: string }> = {
  bazi: {
    name: "八字命理",
    description: "探索你的命盘，了解天赋与方向",
  },
  zodiac: {
    name: "星座占星",
    description: "解读你的星盘，发现内在潜能",
  },
};

// ═══════════════════════════════════════════════════════════════════════════
// Page Component
// ═══════════════════════════════════════════════════════════════════════════

export default function ChatPage() {
  // State
  const [skill, setSkill] = useState<SkillType>("bazi");
  const [voiceMode, setVoiceMode] = useState<VoiceMode>("warm");

  // Handlers
  const handleSkillChange = (newSkill: SkillType) => {
    setSkill(newSkill);
  };

  const handleVoiceModeToggle = () => {
    setVoiceMode((prev) => (prev === "warm" ? "sarcastic" : "warm"));
  };

  return (
    <ChatLayout
      skill={skill}
      title={SKILL_CONFIG[skill].name}
      backHref="/"
      voiceMode={voiceMode}
      onVoiceModeToggle={handleVoiceModeToggle}
    >
      <ChatContainer
        skillId={skill}
        skill={skill}
        voiceMode={voiceMode}
      />
    </ChatLayout>
  );
}
