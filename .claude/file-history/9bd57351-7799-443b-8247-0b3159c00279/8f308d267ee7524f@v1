"use client";

/**
 * ZodiacSummaryCard - è¥¿æ–¹å æ˜Ÿæ‘˜è¦å¡ç‰‡ï¼ˆv2.0 é‡è®¾è®¡ï¼‰
 *
 * è®¾è®¡è¦ç‚¹ï¼š
 * - å¤ªé˜³/æœˆäº®/ä¸Šå‡ä¸‰è§’å¸ƒå±€
 * - æ¯ä¸ªæ˜Ÿåº§ç”¨å¯¹åº”å…ƒç´ è‰²ï¼ˆç«/åœŸ/é£/æ°´ï¼‰
 * - è¡Œè¿æç¤ºç”¨æ¸å˜èƒŒæ™¯
 * - ç‚¹å‡»ä»»æ„åŒºåŸŸè·³è½¬å¯¹è¯
 *
 * React Best Practices Applied:
 * - 6.3: Hoist static JSX (sign-element mappings)
 * - 6.7: Explicit conditional rendering
 */

import { cn } from "@/lib/utils";
import { ChevronRight } from "lucide-react";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Types
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export interface ZodiacData {
  sun?: { sign: string; keywords: string[] };
  moon?: { sign: string; keywords: string[] };
  rising?: { sign: string; keywords: string[] };
  transitHighlight?: string;
  // Legacy support
  sunSign?: string;
  ascendant?: string;
  todayEnergy?: string;
  energyLevel?: 1 | 2 | 3 | 4 | 5;
}

export interface ZodiacSummaryCardProps {
  data?: ZodiacData | null;
  onExplore?: () => void;
  className?: string;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Static Constants - Sign to Element Mapping
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type Element = "fire" | "earth" | "air" | "water";

const SIGN_ELEMENTS: Record<string, Element> = {
  // Fire signs
  ç™½ç¾Šåº§: "fire", ç‹®å­åº§: "fire", å°„æ‰‹åº§: "fire",
  // Earth signs
  é‡‘ç‰›åº§: "earth", å¤„å¥³åº§: "earth", æ‘©ç¾¯åº§: "earth",
  // Air signs
  åŒå­åº§: "air", å¤©ç§¤åº§: "air", æ°´ç“¶åº§: "air",
  // Water signs
  å·¨èŸ¹åº§: "water", å¤©èåº§: "water", åŒé±¼åº§: "water",
};

const ELEMENT_STYLES: Record<Element, { bg: string; text: string; icon: string }> = {
  fire: { bg: "bg-red-100/80", text: "text-red-700", icon: "ğŸ”¥" },
  earth: { bg: "bg-amber-100/80", text: "text-amber-700", icon: "ğŸŒ" },
  air: { bg: "bg-sky-100/80", text: "text-sky-700", icon: "ğŸ’¨" },
  water: { bg: "bg-blue-100/80", text: "text-blue-700", icon: "ğŸ’§" },
};

function getSignElement(sign: string): Element {
  return SIGN_ELEMENTS[sign] || "air";
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Sub-components
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function SignBadge({
  label,
  sign,
  keywords,
  icon,
  className,
}: {
  label: string;
  sign: string;
  keywords: string[];
  icon: string;
  className?: string;
}) {
  const element = getSignElement(sign);
  const styles = ELEMENT_STYLES[element];

  return (
    <div className={cn("text-center", className)}>
      <div className="flex items-center justify-center gap-1 mb-1">
        <span className="text-lg">{icon}</span>
        <span className="text-xs text-muted-foreground">{label}</span>
      </div>
      <div
        className={cn(
          "px-3 py-1.5 rounded-lg inline-block",
          styles.bg
        )}
      >
        <span className={cn("font-medium text-sm", styles.text)}>
          {sign}
        </span>
      </div>
      <p className="text-xs text-muted-foreground mt-1">
        {keywords.join(" Â· ")}
      </p>
    </div>
  );
}

function TripleLayout({
  sun,
  moon,
  rising,
}: {
  sun: { sign: string; keywords: string[] };
  moon: { sign: string; keywords: string[] };
  rising: { sign: string; keywords: string[] };
}) {
  return (
    <div className="p-4 rounded-lg bg-gradient-to-br from-purple-50/80 to-indigo-50/60 border border-purple-200/30">
      {/* Top row: Sun and Moon */}
      <div className="flex justify-around mb-4">
        <SignBadge
          label="å¤ªé˜³"
          icon="â˜‰"
          sign={sun.sign}
          keywords={sun.keywords}
        />
        <SignBadge
          label="æœˆäº®"
          icon="â˜½"
          sign={moon.sign}
          keywords={moon.keywords}
        />
      </div>

      {/* Bottom row: Rising (centered) */}
      <div className="flex justify-center">
        <SignBadge
          label="ä¸Šå‡"
          icon="â†‘"
          sign={rising.sign}
          keywords={rising.keywords}
        />
      </div>

      {/* Visual connecting lines (decorative) */}
      <div className="absolute inset-0 pointer-events-none overflow-hidden">
        {/* Could add SVG lines connecting the three signs */}
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Main Component
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export function ZodiacSummaryCard({
  data,
  onExplore,
  className,
}: ZodiacSummaryCardProps) {
  // Empty state
  if (!data) {
    return (
      <div
        onClick={onExplore}
        className={cn(
          "p-5 rounded-xl cursor-pointer",
          "bg-gradient-to-br from-purple-50/50 to-blue-50/50",
          "border border-purple-200/30 shadow-card",
          "hover:shadow-card-hover hover:border-purple-200/50",
          "transition-all duration-200",
          className
        )}
      >
        <div className="flex items-center gap-2 mb-3">
          <span className="text-2xl">â˜‰</span>
          <span className="font-serif text-base font-semibold text-foreground">
            è¥¿æ–¹å æ˜Ÿ
          </span>
        </div>
        <p className="text-sm text-muted-foreground mb-4">
          è¿˜æœªç”Ÿæˆæ˜Ÿç›˜ï¼Œå’Œ VibeLife èŠèŠå§
        </p>
        <div className="flex items-center justify-center gap-2 px-4 py-2.5 bg-purple-500/10 hover:bg-purple-500/20 text-purple-700 rounded-lg text-sm font-medium transition-colors">
          <span>å¼€å§‹æµ‹ç®—</span>
          <ChevronRight className="w-4 h-4" />
        </div>
      </div>
    );
  }

  // Convert legacy data format
  const sun = data.sun || (data.sunSign ? { sign: data.sunSign, keywords: [] } : undefined);
  const moon = data.moon || { sign: "æœªçŸ¥", keywords: [] };
  const rising = data.rising || (data.ascendant ? { sign: data.ascendant, keywords: [] } : undefined);
  const transitHighlight = data.transitHighlight || data.todayEnergy;

  // Check if we have complete triple data
  const hasTriple = sun && moon && rising;

  return (
    <div
      onClick={onExplore}
      className={cn(
        "p-5 rounded-xl cursor-pointer",
        "bg-gradient-to-br from-purple-50/50 to-blue-50/50",
        "border border-purple-200/30 shadow-card",
        "hover:shadow-card-hover hover:border-purple-200/50",
        "transition-all duration-200 hover:scale-[1.01]",
        className
      )}
    >
      {/* Header */}
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center gap-2">
          <span className="text-xl">â˜‰</span>
          <span className="font-serif text-base font-semibold text-foreground">
            è¥¿æ–¹å æ˜Ÿ
          </span>
        </div>
        <div className="flex items-center gap-1 text-purple-600">
          <span className="text-xs">æ·±å…¥</span>
          <ChevronRight className="w-4 h-4" />
        </div>
      </div>

      {/* Triple Layout or Simple Display */}
      {hasTriple ? (
        <TripleLayout
          sun={sun}
          moon={moon}
          rising={rising!}
        />
      ) : (
        <div className="p-4 rounded-lg bg-purple-50/50 border border-purple-200/30">
          <div className="space-y-3">
            {sun ? (
              <div className="flex items-center gap-3">
                <span className="text-lg">â˜‰</span>
                <span className="text-xs text-muted-foreground w-10">å¤ªé˜³</span>
                <span className="text-sm font-medium text-foreground">{sun.sign}</span>
              </div>
            ) : null}
            {rising ? (
              <div className="flex items-center gap-3">
                <span className="text-lg">â†‘</span>
                <span className="text-xs text-muted-foreground w-10">ä¸Šå‡</span>
                <span className="text-sm font-medium text-foreground">{rising.sign}</span>
              </div>
            ) : null}
          </div>
        </div>
      )}

      {/* Transit Highlight */}
      {transitHighlight ? (
        <div className="mt-4 p-3 rounded-lg bg-gradient-to-r from-purple-100/50 to-indigo-100/50 border border-purple-200/30">
          <div className="flex items-center gap-2 mb-1.5">
            <span className="text-base">ğŸª</span>
            <span className="text-xs font-medium text-purple-700">å½“å‰è¡Œè¿</span>
          </div>
          <p className="text-sm text-ink-700 leading-relaxed">
            {transitHighlight}
          </p>
        </div>
      ) : null}
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Skeleton
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export function ZodiacSummaryCardSkeleton({ className }: { className?: string }) {
  return (
    <div
      className={cn(
        "p-5 rounded-xl",
        "bg-gradient-to-br from-purple-50/50 to-blue-50/50",
        "border border-purple-200/30 shadow-card animate-pulse",
        className
      )}
    >
      {/* Header */}
      <div className="flex items-center gap-2 mb-4">
        <div className="w-6 h-6 rounded bg-purple-200" />
        <div className="h-5 bg-purple-200 rounded w-20" />
      </div>

      {/* Triple layout placeholder */}
      <div className="p-4 rounded-lg bg-purple-100/50 mb-4">
        <div className="flex justify-around mb-4">
          <div className="text-center">
            <div className="w-16 h-6 bg-purple-200 rounded mx-auto mb-1" />
            <div className="w-12 h-8 bg-purple-200 rounded mx-auto" />
          </div>
          <div className="text-center">
            <div className="w-16 h-6 bg-purple-200 rounded mx-auto mb-1" />
            <div className="w-12 h-8 bg-purple-200 rounded mx-auto" />
          </div>
        </div>
        <div className="flex justify-center">
          <div className="text-center">
            <div className="w-16 h-6 bg-purple-200 rounded mx-auto mb-1" />
            <div className="w-12 h-8 bg-purple-200 rounded mx-auto" />
          </div>
        </div>
      </div>

      {/* Transit */}
      <div className="p-3 rounded-lg bg-purple-100/50">
        <div className="h-4 bg-purple-200 rounded w-20 mb-2" />
        <div className="h-4 bg-purple-200 rounded w-full" />
      </div>
    </div>
  );
}

export default ZodiacSummaryCard;
