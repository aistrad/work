"use client";

/**
 * UserInfoCard - Me页用户信息卡片
 *
 * 设计要点：
 * - 头像圆形，带品牌色边框
 * - 原型标签用柔和色彩区分
 * - 编辑资料按钮低调
 */

import { cn } from "@/lib/utils";
import { User } from "lucide-react";

// ═══════════════════════════════════════════════════════════════════════════
// Types
// ═══════════════════════════════════════════════════════════════════════════

export interface UserInfoCardProps {
  displayName: string;
  avatarUrl?: string;
  tagline?: string;
  onEditProfile?: () => void;
  className?: string;
}

// ═══════════════════════════════════════════════════════════════════════════
// Helper: Parse tagline into tags
// ═══════════════════════════════════════════════════════════════════════════

const ARCHETYPE_COLORS: Record<string, { bg: string; text: string }> = {
  创造者: { bg: "bg-amber-100/80", text: "text-amber-700" },
  探索者: { bg: "bg-teal-100/80", text: "text-teal-700" },
  智者: { bg: "bg-indigo-100/80", text: "text-indigo-700" },
  英雄: { bg: "bg-red-100/80", text: "text-red-700" },
  照顾者: { bg: "bg-green-100/80", text: "text-green-700" },
  恋人: { bg: "bg-pink-100/80", text: "text-pink-700" },
  魔术师: { bg: "bg-purple-100/80", text: "text-purple-700" },
  统治者: { bg: "bg-yellow-100/80", text: "text-yellow-700" },
  天真者: { bg: "bg-sky-100/80", text: "text-sky-700" },
  凡人: { bg: "bg-slate-100/80", text: "text-slate-700" },
  叛逆者: { bg: "bg-orange-100/80", text: "text-orange-700" },
  愚者: { bg: "bg-cyan-100/80", text: "text-cyan-700" },
  思考者: { bg: "bg-indigo-100/80", text: "text-indigo-700" },
};

function parseTagline(tagline: string): string[] {
  if (!tagline) return [];
  return tagline.split(/[·、,，]/).map((tag) => tag.trim()).filter(Boolean);
}

function getArchetypeColor(tag: string): { bg: string; text: string } {
  return ARCHETYPE_COLORS[tag] || { bg: "bg-vellum-100", text: "text-vellum-700" };
}

// ═══════════════════════════════════════════════════════════════════════════
// Component
// ═══════════════════════════════════════════════════════════════════════════

export function UserInfoCard({
  displayName,
  avatarUrl,
  tagline,
  onEditProfile,
  className,
}: UserInfoCardProps) {
  const tags = parseTagline(tagline || "");

  return (
    <div
      className={cn(
        "p-5 rounded-xl",
        "bg-gradient-to-br from-vellum-50/50 to-white",
        "border border-vellum-200/40",
        "shadow-soft",
        className
      )}
    >
      {/* Avatar and Name */}
      <div className="flex flex-col items-center text-center">
        {/* Avatar with brand color border */}
        <div className="relative mb-3">
          <div
            className={cn(
              "w-20 h-20 rounded-full",
              "bg-gradient-to-br from-vellum-200 to-vellum-300",
              "ring-2 ring-gold-400/50 ring-offset-2 ring-offset-white",
              "flex items-center justify-center overflow-hidden",
              "shadow-soft"
            )}
          >
            {avatarUrl ? (
              <img
                src={avatarUrl}
                alt={displayName}
                className="w-full h-full object-cover"
              />
            ) : (
              <User className="w-10 h-10 text-vellum-600" />
            )}
          </div>
        </div>

        {/* Name */}
        <h2 className="font-serif text-xl font-semibold text-foreground mb-2">
          {displayName}
        </h2>

        {/* Archetype Tags */}
        {tags.length > 0 ? (
          <div className="flex flex-wrap justify-center gap-2 mb-4">
            {tags.map((tag, index) => {
              const colors = getArchetypeColor(tag);
              return (
                <span
                  key={index}
                  className={cn(
                    "px-2.5 py-1 rounded-full text-xs font-medium",
                    "transition-all duration-200",
                    colors.bg,
                    colors.text
                  )}
                >
                  {tag}
                </span>
              );
            })}
          </div>
        ) : null}

        {/* Edit Profile Button */}
        {onEditProfile ? (
          <button
            onClick={onEditProfile}
            className={cn(
              "px-4 py-1.5 rounded-full",
              "text-sm text-vellum-600 hover:text-vellum-800",
              "bg-vellum-100/50 hover:bg-vellum-100",
              "border border-vellum-200/50",
              "transition-all duration-200"
            )}
          >
            编辑资料
          </button>
        ) : null}
      </div>
    </div>
  );
}

// ═══════════════════════════════════════════════════════════════════════════
// Skeleton
// ═══════════════════════════════════════════════════════════════════════════

export function UserInfoCardSkeleton({ className }: { className?: string }) {
  return (
    <div
      className={cn(
        "p-5 rounded-xl",
        "bg-gradient-to-br from-vellum-50/50 to-white",
        "border border-vellum-200/40",
        "shadow-soft animate-pulse",
        className
      )}
    >
      <div className="flex flex-col items-center">
        <div className="w-20 h-20 rounded-full bg-vellum-200 mb-3" />
        <div className="h-6 bg-vellum-200 rounded w-24 mb-2" />
        <div className="flex gap-2 mb-4">
          <div className="h-6 bg-vellum-100 rounded-full w-16" />
          <div className="h-6 bg-vellum-100 rounded-full w-16" />
          <div className="h-6 bg-vellum-100 rounded-full w-16" />
        </div>
        <div className="h-8 bg-vellum-100 rounded-full w-20" />
      </div>
    </div>
  );
}

export default UserInfoCard;
