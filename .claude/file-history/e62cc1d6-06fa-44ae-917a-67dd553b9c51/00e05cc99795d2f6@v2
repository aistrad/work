# VibeLife LLM 模型配置文件
# 所有模型名称、API 地址、fallback 链都在此配置
# 支持环境变量替换: ${VAR_NAME:default_value}
#
# 更新方法:
#   1. 直接编辑此文件
#   2. 使用 scripts/update_model_config.py 脚本
#   3. 从 docs/apikey.md 同步: python scripts/update_model_config.py --sync-from-docs

# ============================================================
# 模型提供商配置
# ============================================================
providers:
  claude:
    name: "Claude (代理)"
    base_url: "${CLAUDE_BASE_URL:https://www.zz166.cn/api/v1}"
    api_key_env: "CLAUDE_API_KEY"
    enabled: true
    timeout: 180  # 代理 API 延迟较高，增加超时

  glm:
    name: "智谱 GLM"
    base_url: "${GLM_BASE_URL:https://open.bigmodel.cn/api/paas/v4}"
    api_key_env: "GLM_API_KEY"
    enabled: true

  deepseek:
    name: "DeepSeek (官方)"
    base_url: "${DEEPSEEK_BASE_URL:https://api.deepseek.com/anthropic}"
    api_key_env: "DEEPSEEK_API_KEY"
    enabled: true

  gemini:
    name: "Google Gemini"
    # 主力端点
    base_url: "${GEMINI_BASE_URL:https://new.12ai.org/v1}"
    api_key_env: "GEMINI_API_KEY"
    # 备用端点 (按顺序尝试)
    backup_urls:
      - "https://hk.12ai.org/v1"
      - "https://cdn.12ai.org/v1"
      - "https://api2.qiandao.mom/v1"
    backup_key_env: "GEMINI_BACKUP_KEY"
    enabled: true


# ============================================================
# 模型定义
# ============================================================
models:
  # ----- Claude 系列 -----
  claude-opus:
    provider: claude
    model_name: "${CLAUDE_MODEL:claude-opus-4-5-20251101}"
    capabilities: [chat, analysis, tools]
    tier: premium
    description: "Claude Opus 4.5，最强大的推理和工具调用能力"

  # ----- GLM 系列 -----
  glm-4-flash:
    provider: glm
    model_name: "${GLM_FLASH_MODEL:glm-4-flash}"
    capabilities: [chat]
    tier: standard
    description: "GLM 快速模型，适合简单对话"

  glm-4.7:
    provider: glm
    model_name: "${GLM_CHAT_MODEL:glm-4.7}"
    capabilities: [chat, analysis]
    tier: premium
    description: "GLM 主力模型，支持深度分析"

  glm-4v-plus:
    provider: glm
    model_name: "glm-4v-plus"
    capabilities: [chat, vision]
    tier: premium
    description: "GLM 视觉模型"

  # ----- Gemini 系列 -----
  gemini-flash:
    provider: gemini
    model_name: "${GEMINI_CHAT_MODEL:gemini-2.5-flash}"
    capabilities: [chat, analysis]
    tier: standard
    description: "Gemini Flash，快速响应"

  gemini-image:
    provider: gemini
    model_name: "${GEMINI_IMAGE_MODEL:gemini-2.5-flash-image}"
    capabilities: [image_gen]
    tier: premium
    description: "Gemini 图像生成模型"

  # ----- DeepSeek 系列 -----
  deepseek-v3:
    provider: deepseek
    model_name: "deepseek-chat"
    capabilities: [chat, analysis]
    tier: premium
    description: "DeepSeek V3 (官方 API)，强大的推理和工具调用能力"

# ============================================================
# 默认路由配置 (带 fallback 链)
# primary: 首选模型
# fallback: 按顺序尝试的备选模型列表
# ============================================================
defaults:
  chat:
    primary: deepseek-v3
    fallback: [claude-opus, glm-4.7]

  analysis:
    primary: deepseek-v3
    fallback: [claude-opus, glm-4.7]

  vision:
    primary: glm-4v-plus
    fallback: []

  image_gen:
    primary: gemini-image
    fallback: []

# ============================================================
# 全局兜底模型
# 当所有 fallback 都失败时使用
# ============================================================
global_fallback: glm-4-flash

# ============================================================
# Fallback 触发条件配置
# ============================================================
fallback_triggers:
  # API 调用失败时触发 fallback
  on_api_error: true
  # 配额超限时触发 fallback
  on_quota_exceeded: true
  # 超时时间 (秒) - Claude 代理需要更长超时
  timeout: 180
  # 最大重试次数 (单个模型)
  max_retries: 2

# ============================================================
# 用户层级路由覆盖
# 数据库中的动态规则优先级更高
# ============================================================
tier_overrides:
  paid:
    chat:
      primary: deepseek-v3
      fallback: [claude-opus, glm-4.7]
