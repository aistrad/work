# VibeLife LLM 模型配置文件 - 唯一配置源 (Single Source of Truth)
# 所有 LLM 相关配置都从此文件读取
# 支持环境变量替换: ${VAR_NAME:default_value}
#
# 使用方法:
#   from services.llm.config import get_provider, get_model, get_defaults
#
# 验证配置:
#   python scripts/validate_llm_config.py

# ============================================================
# 模型提供商配置
# ============================================================
providers:
  claude:
    name: "Claude (代理)"
    base_url: "${CLAUDE_BASE_URL:https://www.zz166.cn/api/v1}"
    api_key_env: "CLAUDE_API_KEY"
    api_protocol: "anthropic"  # anthropic | openai
    test_endpoint: "/messages"
    enabled: true
    timeout: 180

  glm:
    name: "智谱 GLM (Anthropic 兼容)"
    base_url: "${GLM_BASE_URL:https://open.bigmodel.cn/api/anthropic/v1}"
    api_key_env: "GLM_API_KEY"
    api_protocol: "anthropic"
    test_endpoint: "/messages"
    enabled: true
    timeout: 120
    # OpenAI 兼容端点 (备用)
    openai_base_url: "https://open.bigmodel.cn/api/paas/v4"

  deepseek:
    name: "DeepSeek V3 (Anthropic 兼容)"
    base_url: "${DEEPSEEK_BASE_URL:https://api.deepseek.com/anthropic}"
    api_key_env: "DEEPSEEK_API_KEY"
    api_protocol: "anthropic"
    test_endpoint: "/messages"
    enabled: true
    timeout: 120

  gemini:
    name: "Google Gemini (代理)"
    base_url: "${GEMINI_BASE_URL:https://new.12ai.org/v1}"
    api_key_env: "GEMINI_API_KEY"
    api_protocol: "openai"
    test_endpoint: "/chat/completions"
    backup_urls:
      - "https://hk.12ai.org/v1"
      - "https://cdn.12ai.org/v1"
    backup_key_env: "GEMINI_BACKUP_KEY"
    enabled: true
    timeout: 60

# ============================================================
# 模型定义
# ============================================================
models:
  # ----- Claude 系列 -----
  claude-opus:
    provider: claude
    model_name: "${CLAUDE_MODEL:claude-opus-4-5-20251101}"
    capabilities: [chat, analysis, tools]
    tier: premium
    description: "Claude Opus 4.5，最强大的推理和工具调用能力"

  claude-sonnet:
    provider: claude
    model_name: "claude-sonnet-4-20250514"
    capabilities: [chat, analysis, tools]
    tier: standard
    description: "Claude Sonnet 4，平衡性能与成本"

  # ----- GLM 系列 -----
  glm-4-flash:
    provider: glm
    model_name: "${GLM_FLASH_MODEL:glm-4-flash}"
    capabilities: [chat]
    tier: standard
    description: "GLM 快速模型，适合简单对话"

  glm-4.7:
    provider: glm
    model_name: "${GLM_CHAT_MODEL:glm-4.7}"
    capabilities: [chat, analysis, tools]
    tier: premium
    description: "GLM 主力模型，支持深度分析和工具调用"

  glm-4v-plus:
    provider: glm
    model_name: "glm-4v-plus"
    capabilities: [chat, vision]
    tier: premium
    description: "GLM 视觉模型"

  # ----- Gemini 系列 -----
  gemini-flash:
    provider: gemini
    model_name: "${GEMINI_CHAT_MODEL:gemini-2.5-flash}"
    capabilities: [chat, analysis]
    tier: standard
    description: "Gemini Flash，快速响应"

  gemini-image:
    provider: gemini
    model_name: "${GEMINI_IMAGE_MODEL:gemini-2.5-flash-image}"
    capabilities: [image_gen]
    tier: premium
    description: "Gemini 图像生成模型"

  # ----- DeepSeek 系列 -----
  deepseek-v3:
    provider: deepseek
    model_name: "deepseek-chat"
    capabilities: [chat, analysis, tools]
    tier: premium
    description: "DeepSeek V3，强大的推理和工具调用能力"

  deepseek-reasoner:
    provider: deepseek
    model_name: "deepseek-reasoner"
    capabilities: [chat, analysis, reasoning]
    tier: premium
    description: "DeepSeek Reasoner，深度推理模型"

# ============================================================
# 默认路由配置 (带 fallback 链)
# ============================================================
defaults:
  chat:
    primary: deepseek-v3
    fallback: [glm-4.7, claude-opus]

  analysis:
    primary: deepseek-v3
    fallback: [glm-4.7, claude-opus]

  vision:
    primary: glm-4v-plus
    fallback: []

  image_gen:
    primary: gemini-image
    fallback: []

  tools:
    primary: deepseek-v3
    fallback: [glm-4.7, claude-opus]

# ============================================================
# 全局兜底模型
# ============================================================
global_fallback: glm-4-flash

# ============================================================
# Fallback 触发条件配置
# ============================================================
fallback_triggers:
  on_api_error: true
  on_quota_exceeded: true
  timeout: 180
  max_retries: 2

# ============================================================
# 用户层级路由覆盖
# ============================================================
tier_overrides:
  paid:
    chat:
      primary: deepseek-v3
      fallback: [claude-opus, glm-4.7]
  free:
    chat:
      primary: glm-4-flash
      fallback: [deepseek-v3]
