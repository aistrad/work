/**
 * Skill Management Types
 * v7.4 - Skill 订阅管理系统类型定义
 */

// ═══════════════════════════════════════════════════════════════════════════
// Skill 元数据
// ═══════════════════════════════════════════════════════════════════════════

export type SkillCategory = 'core' | 'default' | 'professional';
export type PricingType = 'free' | 'premium' | 'credits';
export type FeatureTier = 'free' | 'basic' | 'premium';

export interface SkillPricing {
  type: PricingType;
  trial_messages?: number;
  credits_per_use?: number;
}

export interface SkillFeature {
  name: string;
  description?: string;
  icon?: string;
  tier?: FeatureTier;
}

export interface SkillShowcase {
  tagline: string;
  highlights: string[];
  preview_image?: string;
  demo_prompts?: string[];
}

export interface SkillMetadata {
  id: string;
  name: string;
  description: string;
  version?: string;
  icon: string;
  color: string;
  category: SkillCategory;
  pricing: SkillPricing;
  features: SkillFeature[];
  showcase: SkillShowcase;
  triggers: string[];
}

// ═══════════════════════════════════════════════════════════════════════════
// 用户订阅状态
// ═══════════════════════════════════════════════════════════════════════════

export interface SkillUserStatus {
  subscribed: boolean;
  push_enabled: boolean;
  trial_messages_used: number;
  trial_messages_remaining: number | null;
  subscribed_at?: string;
}

export interface SkillSubscription {
  skill_id: string;
  skill_name?: string;
  status: 'subscribed' | 'unsubscribed' | 'not_subscribed';
  push_enabled: boolean;
  subscribed_at: string | null;
  can_unsubscribe: boolean;
  trial_messages_used: number;
}

// ═══════════════════════════════════════════════════════════════════════════
// API 响应类型
// ═══════════════════════════════════════════════════════════════════════════

export interface SkillWithUserStatus extends SkillMetadata {
  user_status?: SkillUserStatus;
}

export interface SkillListResponse {
  skills: SkillWithUserStatus[];
  categories: {
    core: { name: string; description: string; count: number };
    default: { name: string; description: string; count: number };
    professional: { name: string; description: string; count: number };
  };
  total: number;
}

export interface SkillSubscriptionsResponse {
  subscriptions: SkillSubscription[];
  summary: {
    total_subscribed: number;
    total_available: number;
    push_enabled_count: number;
  };
}

export interface SkillRecommendation {
  skill_id: string;
  skill: {
    id: string;
    name: string;
    icon: string;
    color: string;
    tagline: string;
  };
  reason: 'based_on_conversation' | 'based_on_emotion' | 'based_on_profile' | 'featured';
  context: string;
  score: number;
  trial_messages_remaining: number | null;
}

export interface SkillRecommendationsResponse {
  recommendations: SkillRecommendation[];
  generated_at: string;
}

export interface FeaturedSkill {
  skill_id: string;
  skill: {
    id: string;
    name: string;
    icon: string;
    color: string;
    tagline: string;
    preview_image?: string;
  };
  position: number;
  campaign?: {
    title: string;
    badge: string;
  } | null;
}

export interface FeaturedSkillsResponse {
  featured: FeaturedSkill[];
}

// ═══════════════════════════════════════════════════════════════════════════
// 组件 Props
// ═══════════════════════════════════════════════════════════════════════════

export type SkillCardVariant = 'compact' | 'card' | 'detail' | 'inline';

export interface SkillCardProps {
  skill: SkillMetadata;
  variant?: SkillCardVariant;
  userStatus?: SkillUserStatus;
  showActions?: boolean;
  context?: string; // inline 变体使用
  className?: string;

  // 事件回调
  onSubscribe?: () => void;
  onUnsubscribe?: () => void;
  onTogglePush?: (enabled: boolean) => void;
  onTry?: () => void;
  onLearnMore?: () => void;
  onClick?: () => void;
  onDismiss?: () => void;
}

export interface SkillListProps {
  skills: SkillMetadata[];
  userStatuses?: Record<string, SkillUserStatus>;
  layout?: 'list' | 'grid';
  groupBy?: 'category' | 'none';
  showFilters?: boolean;
  onSkillClick?: (skillId: string) => void;
  onSubscribe?: (skillId: string) => void;
  onUnsubscribe?: (skillId: string) => void;
  onTogglePush?: (skillId: string, enabled: boolean) => void;
}
