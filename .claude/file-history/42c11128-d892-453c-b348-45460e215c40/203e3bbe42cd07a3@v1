/**
 * Skills Registry
 *
 * Central registry for all Agent Runtime skills (tools).
 * Skills are organized by command/domain and can be selectively enabled.
 *
 * IMPORTANT: Use createSkillsWithContext() to create skills that need
 * authenticated API calls (e.g., yunshi requires user cookie).
 */
import { createDivineSkills, divineSkills, type SkillContext } from './divine-skills';
import { healSkills } from './heal-skills';
import { growSkills } from './grow-skills';

// All available skills combined (static, for backward compat)
export const allSkills = {
  ...divineSkills,
  ...healSkills,
  ...growSkills,
};

// Re-export individual skill groups
export { divineSkills, createDivineSkills, type SkillContext } from './divine-skills';
export { healSkills } from './heal-skills';
export { growSkills } from './grow-skills';

/**
 * Create all skills with user context (session cookie).
 * This is the preferred way to create skills for authenticated users.
 */
export function createSkillsWithContext(ctx: SkillContext) {
  const divine = createDivineSkills(ctx);
  // TODO: Add createHealSkills(ctx) and createGrowSkills(ctx) when they need auth
  return {
    ...divine,
    ...healSkills,
    ...growSkills,
  };
}

/**
 * Get tools for a specific command, with user context for auth.
 */
export function getToolsForCommandWithContext(
  command: string | null | undefined,
  ctx: SkillContext
) {
  const divine = createDivineSkills(ctx);

  switch (command) {
    case '/divine':
    case '/bazi':
    case '/yunshi':
    case '/tieban':
      return divine;

    case '/heal':
    case '/mood':
    case '/perma':
    case '/therapy':
      return healSkills;

    case '/grow':
    case '/goal':
    case '/task':
    case '/focus':
      return growSkills;

    case '/all':
      return { ...divine, ...healSkills, ...growSkills };

    default:
      return { ...divine, ...healSkills, ...growSkills };
  }
}

// Skill selection based on command (legacy, no auth context)
export function getToolsForCommand(command: string | null | undefined) {
  // Map commands to skill sets
  switch (command) {
    case '/divine':
    case '/bazi':
    case '/yunshi':
    case '/tieban':
      return divineSkills;

    case '/heal':
    case '/mood':
    case '/perma':
    case '/therapy':
      return healSkills;

    case '/grow':
    case '/goal':
    case '/task':
    case '/focus':
      return growSkills;

    case '/all':
      return allSkills;

    default:
      // Return all skills for general chat
      return allSkills;
  }
}

// Get tool names for a command (for logging/debugging)
export function getToolNamesForCommand(command: string | null | undefined): string[] {
  const tools = getToolsForCommand(command);
  return Object.keys(tools);
}

// Skill metadata for documentation
export const skillMetadata = {
  divine: {
    name: '玄学技能',
    description: '八字命理、运势分析、铁板神数等',
    commands: ['/divine', '/bazi', '/yunshi', '/tieban'],
    tools: Object.keys(divineSkills),
  },
  heal: {
    name: '疗愈技能',
    description: '情绪追踪、PERMA评估、认知重构等',
    commands: ['/heal', '/mood', '/perma', '/therapy'],
    tools: Object.keys(healSkills),
  },
  grow: {
    name: '成长技能',
    description: '目标设定、任务管理、专注计时等',
    commands: ['/grow', '/goal', '/task', '/focus'],
    tools: Object.keys(growSkills),
  },
};
