/**
 * SkillRecommendationCard - Skill æ¨èå¡ç‰‡ç»„ä»¶
 *
 * å½“ CoreAgent åˆ¤æ–­ç”¨æˆ·éœ€è¦é€‰æ‹©ä¸åŒ Skill æ—¶ï¼ˆå¦‚"ä»Šæ—¥è¿åŠ¿"éœ€è¦é€‰å…«å­—æˆ–æ˜Ÿåº§ï¼‰ï¼Œ
 * é€šè¿‡ recommend_skills å·¥å…·è§¦å‘æ­¤å¡ç‰‡å±•ç¤ºå¤šä¸ªå¯é€‰ Skillã€‚
 */

'use client';

import React, { useState } from 'react';
import { Sparkles, X } from 'lucide-react';

interface SkillAction {
  type: 'activate_skill';
  skill: string;
}

interface SkillInfo {
  id: string;
  name: string;
  description?: string;
  icon?: string;
  color?: string;
  tagline?: string;
  trial_messages?: number;
  action?: SkillAction;
}

interface SkillRecommendationCardProps {
  data?: {
    skills?: SkillInfo[];
    skill?: SkillInfo;  // å‘åå…¼å®¹å•ä¸ª skill
    reason?: string;
    status?: string;
  };
  onSendMessage?: (message: string) => void;
}

function SkillRecommendationCard({ data, onSendMessage }: SkillRecommendationCardProps): React.ReactElement | null {
  const [dismissed, setDismissed] = useState(false);

  // æ”¯æŒ skills æ•°ç»„æˆ–å•ä¸ª skillï¼ˆå‘åå…¼å®¹ï¼‰
  const skills = data?.skills || (data?.skill ? [data.skill] : []);

  // Early return for non-render cases
  if (!data || skills.length === 0 || data.status === 'skip' || dismissed) {
    return null;
  }

  const { reason } = data;

  const handleDismiss = () => setDismissed(true);

  const handleActivateSkill = (skill: SkillInfo) => {
    if (onSendMessage) {
      // å‘é€æ¿€æ´»æ¶ˆæ¯ï¼Œè®©åç«¯ LLM å¤„ç†
      onSendMessage(`ä½¿ç”¨${skill.name}`);
    }
  };

  return (
    <div className="rounded-xl overflow-hidden border border-accent/30 bg-gradient-to-br from-accent/5 to-accent/10 backdrop-blur-sm">
      {/* Header */}
      <div className="px-4 py-3 border-b border-white/10 flex items-center justify-between">
        <div className="flex items-center gap-2">
          <Sparkles className="w-4 h-4 text-accent" />
          <span className="text-sm font-medium text-text-primary">è¯·é€‰æ‹©æŸ¥çœ‹æ–¹å¼</span>
        </div>
        <button
          onClick={handleDismiss}
          className="p-1 rounded-lg hover:bg-white/10 transition-colors"
          aria-label="å…³é—­æ¨è"
        >
          <X className="w-4 h-4 text-text-tertiary" />
        </button>
      </div>

      {/* Content */}
      <div className="p-4">
        {/* Reason */}
        {reason && (
          <p className="text-sm text-text-secondary mb-4">
            {reason}
          </p>
        )}

        {/* Skill Options */}
        <div className="grid gap-2">
          {skills.map((skill) => {
            const iconBgColor = skill.color ? `${skill.color}20` : 'rgba(99, 102, 241, 0.1)';
            return (
              <button
                key={skill.id}
                onClick={() => handleActivateSkill(skill)}
                className="flex items-center gap-3 p-3 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 hover:border-accent/30 transition-all text-left group"
              >
                <div
                  className="w-10 h-10 rounded-lg flex items-center justify-center text-xl shrink-0 group-hover:scale-105 transition-transform"
                  style={{ backgroundColor: iconBgColor }}
                >
                  {skill.icon || 'ğŸ’¡'}
                </div>
                <div className="flex-1 min-w-0">
                  <h4 className="font-medium text-text-primary group-hover:text-accent transition-colors">
                    {skill.name}
                  </h4>
                  {skill.description && (
                    <p className="text-xs text-text-tertiary mt-0.5 line-clamp-1">
                      {skill.description}
                    </p>
                  )}
                </div>
              </button>
            );
          })}
        </div>
      </div>
    </div>
  );
}

export default SkillRecommendationCard;
