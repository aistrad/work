# VibeLife LLM 模型配置文件 - 唯一配置源 (Single Source of Truth)
# 所有 LLM 相关配置都从此文件读取
# 支持环境变量替换: ${VAR_NAME:default_value}
#
# 使用方法:
#   from services.llm.config import LLMConfig
#   provider = LLMConfig.get_provider("deepseek")
#   selection = LLMConfig.resolve(user_tier="paid", task="chat")
#
# 验证配置:
#   python scripts/validate_llm_config.py

# ============================================================
# LLM 环境变量映射 (每次调用时自动同步)
# ============================================================
env_mapping:
  # 格式: yaml_key: actual_env_var
  GLM_API_KEY: ZAI_GLM_KEY
  CLAUDE_API_KEY: CC_API_KEY
  # DEEPSEEK_API_KEY 直接使用，无需映射

# ============================================================
# 模型提供商配置
# ============================================================
providers:
  deepseek:
    name: "DeepSeek V3 (Anthropic 兼容)"
    base_url: "${DEEPSEEK_BASE_URL:https://api.deepseek.com/anthropic}"
    api_key_env: "DEEPSEEK_API_KEY"
    api_protocol: "anthropic"
    test_endpoint: "/messages"
    enabled: true
    timeout: 0

  glm:
    name: "智谱 GLM (Anthropic 兼容)"
    base_url: "${GLM_BASE_URL:https://open.bigmodel.cn/api/anthropic/v1}"
    api_key_env: "GLM_API_KEY"
    api_protocol: "anthropic"
    test_endpoint: "/messages"
    enabled: true
    timeout: 0
    # OpenAI 兼容端点 (备用)
    openai_base_url: "https://open.bigmodel.cn/api/paas/v4"

  claude:
    name: "Claude (代理)"
    base_url: "${CLAUDE_BASE_URL:https://www.zz166.cn/api/v1}"
    api_key_env: "CLAUDE_API_KEY"
    api_protocol: "anthropic"
    test_endpoint: "/messages"
    enabled: true
    timeout: 0

  gemini:
    name: "Google Gemini (代理)"
    base_url: "${GEMINI_BASE_URL:https://new.12ai.org/v1}"
    api_key_env: "GEMINI_API_KEY"
    api_protocol: "openai"
    test_endpoint: "/chat/completions"
    backup_urls:
      - "https://hk.12ai.org/v1"
      - "https://cdn.12ai.org/v1"
    backup_key_env: "GEMINI_BACKUP_KEY"
    enabled: true
    timeout: 0

# ============================================================
# 模型定义
# ============================================================
models:
  # ----- DeepSeek 系列 (Primary) -----
  deepseek-v3:
    provider: deepseek
    model_name: "deepseek-chat"
    capabilities: [chat, analysis, tools]
    tier: standard
    description: "DeepSeek V3，强大的推理和工具调用能力"

  deepseek-reasoner:
    provider: deepseek
    model_name: "deepseek-reasoner"
    capabilities: [chat, analysis, reasoning]
    tier: premium
    description: "DeepSeek Reasoner，深度推理模型"

  # ----- GLM 系列 (Fallback 1) -----
  glm-4.7:
    provider: glm
    model_name: "${GLM_CHAT_MODEL:glm-4.7}"
    capabilities: [chat, analysis, tools]
    tier: standard
    description: "GLM 主力模型，支持深度分析和工具调用"

  glm-4v-plus:
    provider: glm
    model_name: "glm-4v-plus"
    capabilities: [chat, vision]
    tier: premium
    description: "GLM 视觉模型"

  # ----- Claude 系列 (Fallback 2) -----
  claude-sonnet:
    provider: claude
    model_name: "${CLAUDE_MODEL:claude-sonnet-4-20250514}"
    capabilities: [chat, analysis, tools]
    tier: standard
    description: "Claude Sonnet 4，平衡性能与成本"

  # ----- Gemini 系列 (图像专用) -----
  gemini-flash:
    provider: gemini
    model_name: "${GEMINI_CHAT_MODEL:gemini-2.5-flash}"
    capabilities: [chat, analysis]
    tier: standard
    description: "Gemini Flash，快速响应"

  gemini-image:
    provider: gemini
    model_name: "${GEMINI_IMAGE_MODEL:gemini-2.5-flash-image}"
    capabilities: [image_gen]
    tier: premium
    description: "Gemini 图像生成模型"

# ============================================================
# 默认路由配置 (统一顺序: deepseek → glm → opus)
# ============================================================
defaults:
  chat:
    primary: deepseek-v3
    fallback: [glm-4.7, claude-sonnet]

  analysis:
    primary: deepseek-v3
    fallback: [glm-4.7, claude-sonnet]

  tools:
    primary: deepseek-v3
    fallback: [glm-4.7, claude-sonnet]

  vision:
    primary: glm-4v-plus
    fallback: []

  image_gen:
    primary: gemini-image
    fallback: []

# ============================================================
# 全局兜底模型
# ============================================================
global_fallback: glm-4.7

# ============================================================
# Fallback 触发条件配置
# ============================================================
fallback_triggers:
  on_api_error: true
  on_quota_exceeded: true
  timeout: 180
  max_retries: 2

# ============================================================
# 用户层级路由覆盖 (所有层级统一顺序)
# ============================================================
tier_overrides:
  # 所有用户统一使用相同的模型顺序
  paid:
    chat:
      primary: deepseek-v3
      fallback: [glm-4.7, claude-sonnet]
  free:
    chat:
      primary: deepseek-v3
      fallback: [glm-4.7, claude-sonnet]
