/**
 * WeChat Login Button
 * Opens QR code modal for WeChat scan login
 */
"use client";

import { useState } from "react";
import { Button } from "@/components/ui/Button";
import { WechatQRModal } from "./WechatQRModal";
import { OnboardingData } from "@/lib/api";

interface WechatLoginButtonProps {
  onSuccess?: () => void;
  onError?: (error: string) => void;
  onboarding?: OnboardingData;
  disabled?: boolean;
}

export function WechatLoginButton({
  onSuccess,
  onError,
  onboarding,
  disabled = false,
}: WechatLoginButtonProps) {
  const [showQRModal, setShowQRModal] = useState(false);

  const handleClick = () => {
    setShowQRModal(true);
  };

  const handleSuccess = () => {
    setShowQRModal(false);
    onSuccess?.();
  };

  const handleError = (error: string) => {
    setShowQRModal(false);
    onError?.(error);
  };

  const handleClose = () => {
    setShowQRModal(false);
  };

  return (
    <>
      <Button
        type="button"
        variant="secondary"
        className="w-full flex items-center justify-center gap-2"
        onClick={handleClick}
        disabled={disabled}
      >
        <WechatIcon />
        Continue with WeChat
      </Button>

      {showQRModal && (
        <WechatQRModal
          onSuccess={handleSuccess}
          onError={handleError}
          onClose={handleClose}
          onboarding={onboarding}
        />
      )}
    </>
  );
}

// WeChat Icon
function WechatIcon() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="#07C160">
      <path d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 01.213.665l-.39 1.48c-.019.07-.048.141-.048.213 0 .163.13.295.29.295a.326.326 0 00.167-.054l1.903-1.114a.864.864 0 01.717-.098 10.16 10.16 0 002.837.403c.276 0 .543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446C13.314 8.545 15.98 7 19.083 7c.273 0 .532.02.793.038C18.923 4.106 14.32 2.188 8.691 2.188zm-2.82 5.51a1.008 1.008 0 110-2.017 1.008 1.008 0 010 2.018zm5.65 0a1.008 1.008 0 110-2.017 1.008 1.008 0 010 2.018z" />
      <path d="M23.125 14.637c0-3.24-3.146-5.87-7.026-5.87-3.883 0-7.028 2.63-7.028 5.87 0 3.243 3.145 5.874 7.028 5.874.86 0 1.682-.119 2.448-.338a.713.713 0 01.58.078l1.546.908a.263.263 0 00.137.043c.13 0 .235-.106.235-.236 0-.059-.024-.116-.039-.175l-.316-1.207a.469.469 0 01.173-.54c1.487-1.095 2.262-2.715 2.262-4.407zm-9.405-.758a.823.823 0 110-1.646.823.823 0 010 1.646zm4.761 0a.823.823 0 110-1.646.823.823 0 010 1.646z" />
    </svg>
  );
}
