// Message Types
export interface Message {
  id: string
  role: "user" | "assistant"
  content: string
  timestamp: Date
  blocks?: Block[]
  artifact?: Artifact
}

// Block Types (三段式结构)
export type BlockType = "callout" | "toggle" | "task" | "chart" | "diff" | "card" | "action_buttons" | "markdown_text"

export interface Block {
  id: string
  type: BlockType
  content: string
  metadata?: Record<string, unknown>
}

export interface CalloutBlock extends Block {
  type: "callout"
}

export interface ToggleBlock extends Block {
  type: "toggle"
  isOpen?: boolean
  children?: Block[]
}

export interface TaskBlock extends Block {
  type: "task"
  duration: 2 | 5 | 15  // 分钟
  completed?: boolean
  status?: "pending" | "in_progress" | "completed" | "downgraded"
}

export interface ChartBlock extends Block {
  type: "chart"
  chartType: "line" | "bar" | "radial"
  data: unknown
  events?: TimelineEvent[]
}

export interface DiffBlock extends Block {
  type: "diff"
  changes: DiffChange[]
  status: "pending" | "applied" | "rejected" | "paused"
}

export interface DiffChange {
  field: string
  oldValue: number | string
  newValue: number | string
  reason: string
}

// A2UI Action Button Types
export interface ActionButton {
  label: string
  action: {
    type: "start_task" | "schedule_task" | "open_panel" | "opt_out" | "checkin"
    task_id?: string
    panel?: string
  }
}

export interface ActionButtonsBlock extends Block {
  type: "action_buttons"
  buttons: ActionButton[]
}

export interface MarkdownTextBlock extends Block {
  type: "markdown_text"
  title?: string
}

// Artifact Types
export interface Artifact {
  id: string
  type: "analysis" | "suggestion" | "chart" | "mystic" | "course"
  title: string
  summary: string
  sourceMessageId: string
  createdAt: Date
  pinned?: boolean
  savedAsPage?: boolean
}

// Timeline Event (用于趋势图事件标记)
export interface TimelineEvent {
  id: string
  date: Date
  title: string
  description?: string
  sourceMessageId?: string
  sourceArtifactId?: string
}

// Dashboard Tab Types
export type DashboardTab =
  | "overview"
  | "status"
  | "trends"
  | "quests"
  | "relations"
  | "explore"
  | "settings"

// Status (五维状态)
export interface UserStatus {
  energy: number      // 能量
  emotion: number     // 情绪
  connection: number  // 连接
  growth: number      // 成长
  fortune: number     // 运势
}

// Quest/Task Types
export interface Quest {
  id: string
  title: string
  description?: string
  duration: 2 | 5 | 15
  status: "pending" | "in_progress" | "completed" | "downgraded"
  rewards?: {
    field: keyof UserStatus
    value: number
  }[]
  createdAt: Date
  completedAt?: Date
}

// Relation Types
export interface Relation {
  id: string
  name: string
  type: "friend" | "family" | "partner" | "colleague"
  avatar?: string
  compatibility?: number
  suggestions?: string[]
  sharedQuests?: Quest[]
}

// Page Types (Notion-like)
export type PageType =
  | "twin-page"
  | "artifact-page"
  | "quest-page"
  | "relation-page"
  | "event-page"
  | "mystic-page"
  | "course-page"

export interface Page {
  id: string
  type: PageType
  title: string
  content: Block[]
  createdAt: Date
  updatedAt: Date
  archived?: boolean
}
