# Fortune AI æ ¸å¿ƒåŠŸèƒ½æ¨¡å—è®¾è®¡ v4.0

> **å®šä½**: åŸºäºå››å±‚å¿ƒç†æ¶æ„ (L0-L3) çš„å¯æ‰§è¡ŒåŠŸèƒ½æ¨¡å—
>
> **ç›®æ ‡**: å¼•æµ â†’ è¯•ç”¨ â†’ ç•™å­˜ â†’ ç¤¾äº¤ â†’ å¼•æµ çš„é—­ç¯å¢é•¿
>
> **v4æ›´æ–°**: ç»†åŒ–Loginé¡µé¢è®¾è®¡ã€å®æ–½ä¼˜å…ˆçº§ã€æµ·æŠ¥ç”ŸæˆæŠ€æœ¯æ–¹æ¡ˆ

---

## 0. ä¸€é¡µæ€»è§ˆï¼ˆåŒ—ææ˜Ÿä½“éªŒï¼‰

### 0.1 åŒ—ææ˜Ÿä½“éªŒï¼ˆ5 åˆ†é’Ÿé—­ç¯ï¼‰

ç”¨æˆ·ç¬¬ä¸€æ¬¡æ¥è§¦ Fortune AI æ—¶ï¼Œä¸éœ€è¦å­¦ä»»ä½•æœ¯è¯­ã€ä¸éœ€è¦å¡«å¤æ‚é—®å·ï¼š

1) **30 ç§’**ï¼šè¾“å…¥ç”Ÿè¾°/åœ°ç‚¹ï¼ˆé»˜è®¤åŒ—äº¬ï¼‰â†’ å¾—åˆ° 3 ä¸ªã€Œé‚£å°±æ˜¯æˆ‘ã€éªŒè¯ç‚¹ï¼ˆå»ºç«‹ä¿¡ä»»ï¼‰
2) **3 åˆ†é’Ÿ**ï¼šä¸€é”®ç”Ÿæˆã€Œäººç”Ÿè¯´æ˜ä¹¦ã€ç»“æ„åŒ–æŠ¥å‘Šï¼ˆç„å­¦ç¡®å®šæ€§ Ã— å¿ƒç†å­¦è¡ŒåŠ¨å›¾å¼ï¼‰
3) **5 åˆ†é’Ÿ**ï¼šç»™å‡º â‰¤3 æ¡å¯æ‰§è¡Œå¤„æ–¹ + æ‰¿è¯ºé‚€è¯·ï¼ˆæŠŠ"ç„¦è™‘"è½åˆ°"åŠ¨ä½œ"ï¼‰

### 0.2 ä¸‰å¤§æ ¸å¿ƒæ¨¡å—ï¼ˆåªåšæœ€å¼ºä¸‰ä»¶äº‹ï¼‰

| æ ¸å¿ƒæ¨¡å— | ç”¨æˆ·å¾—åˆ°ä»€ä¹ˆ | å¯¹åº”å¢é•¿é˜¶æ®µ |
|---|---|---|
| **ä¸€é”®æ·±åº¦æŠ¥å‘Š**ï¼ˆç„å­¦ Ã— å¿ƒç†ï¼‰ | ä¸“ä¸šã€å¯è¿½æº¯çš„ã€Œäººç”Ÿè¯´æ˜ä¹¦ã€+ ç¬¬ä¸€æ¡è¡ŒåŠ¨å¤„æ–¹ | è¯•ç”¨/è½¬åŒ– |
| **çŠ¶æ€é‡åŒ– Ã— äººç”Ÿ K çº¿** | å¯é‡åŒ–ã€å¯å›é¡¾ã€å¯è§£é‡Šçš„çŠ¶æ€è¶‹åŠ¿ï¼ˆå«é¢„è­¦ä¸å¹²é¢„ï¼‰ | ç•™å­˜ |
| **éšç§ç¤¾äº¤å¼•æ“**ï¼ˆåˆç›˜ + åæ§½æµ·æŠ¥ + èƒ½é‡äº’èµ ï¼‰ | ä¸æš´éœ²éšç§ä¹Ÿèƒ½"ç©èµ·æ¥/è¢«ç†è§£/è¢«åŠ æ²¹"ï¼Œå¹¶å¸¦æ¥æ–°ç”¨æˆ· | ç¤¾äº¤/å¼•æµ |

### 0.3 æˆé•¿é—­ç¯ï¼ˆå¼•æµ â†’ è¯•ç”¨ â†’ ç•™å­˜ â†’ ç¤¾äº¤ â†’ å¼•æµï¼‰

```
å†…å®¹è§¦è¾¾/æµ·æŠ¥ç§è‰ â†’ å…è´¹å¿«é€Ÿè§£è¯»ï¼ˆä¿¡ä»»ï¼‰ â†’ æ·±åº¦æŠ¥å‘Šï¼ˆä»·å€¼é”šç‚¹ï¼‰ â†’ æ¯æ—¥æŒ‡å¼•+Kçº¿ï¼ˆé™ªä¼´ï¼‰
         â†‘                                                                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åæ§½æµ·æŠ¥/åˆç›˜é‚€è¯·/åŠ æ²¹æ‰“èµï¼ˆç¤¾äº¤ä¼ æ’­ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 0.4 å®æ–½ä¼˜å…ˆçº§ï¼ˆv4 æ–°å¢ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å®æ–½ä¼˜å…ˆçº§çŸ©é˜µ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

P0 (æœ€é«˜ä¼˜å…ˆçº§ - å…¥å£ä¸æ ¸å¿ƒä»·å€¼)
â”œâ”€â”€ 1. Loginé¡µé¢é‡æ„ï¼ˆå…«å­—/ç´«å¾®/æ˜Ÿåº§ Tab + éªŒè¯ç‚¹ + æ³¨å†Œç™»å½•ï¼‰
â””â”€â”€ 2. æ·±åº¦å…«å­—æŠ¥å‘Šä¼˜åŒ–

P1 (é«˜ä¼˜å…ˆçº§ - ç¤¾äº¤è£‚å˜)
â”œâ”€â”€ 3. å¯¹è¯ç³»ç»Ÿä¼˜åŒ–
â””â”€â”€ 4. æµ·æŠ¥ç”Ÿæˆç³»ç»Ÿï¼ˆgemini_create_job å›¾ç‰‡æ¨¡å‹ï¼‰

P2 (ä¸­ä¼˜å…ˆçº§ - ç•™å­˜å¢å¼º)
â”œâ”€â”€ 5. äººç”ŸKçº¿ç³»ç»Ÿï¼ˆèœ¡çƒ›å›¾å¯è§†åŒ–ï¼‰
â””â”€â”€ 6. åˆå¹¶å‰ç«¯çŠ¶æ€/è¶‹åŠ¿ Tab

æœªæ¥è¿­ä»£
â”œâ”€â”€ åˆç›˜ç³»ç»Ÿ
â”œâ”€â”€ èƒ½é‡æ‰“èµ
â””â”€â”€ æˆé•¿è®¡åˆ’
```

---

## ä¸€ã€è®¾è®¡åŸåˆ™

### 1.1 æ¶æ„å¯¹é½

æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å¿…é¡»ä¸ Soul OS å››å±‚æ¶æ„æ·±åº¦å¯¹é½ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Soul OS å››å±‚æ¶æ„ Ã— åŠŸèƒ½æ¨¡å—æ˜ å°„                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L3: Synthesis (æ„è¯†/è‡ªæˆ‘)                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å…ƒè®¤çŸ¥ä»²è£å™¨ - GLM Agent                                          â”‚  â”‚
â”‚  â”‚ â†’ ç»¼åˆ L0/L1/L2 è¾“å‡ºï¼Œç”Ÿæˆã€Œç»“è®º + å¤„æ–¹ + æ‰¿è¯ºé‚€è¯·ã€               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  L2: Agents (ç­–ç•¥/è¶…æˆ‘)                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å¤šè§†è§’å¹¶è¡Œåˆ†æ Agent                                              â”‚  â”‚
â”‚  â”‚ â†’ å…«å­—è§£è¯» Agent / å¿ƒç†å­¦åˆ†æ Agent / è¡ŒåŠ¨æ•™ç»ƒ Agent              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  L1: Schema (ç‰¹è´¨/å›¾å¼)                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PERMA / VIA / CBT å›¾å¼ + è¡Œä¸ºè¯æ®æ±‡æ€»                             â”‚  â”‚
â”‚  â”‚ â†’ ç”¨æˆ·çŠ¶æ€é‡åŒ– (State Score) + äººç”ŸKçº¿                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  L0: Firmware (å®šæ•°/æœ¬æˆ‘)                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å…«å­—/æ˜Ÿç›˜/ç´«å¾® + ç”¨æˆ·æ¡£æ¡ˆï¼ˆå¿«ç…§åŒ–ã€å¯è¿½æº¯ï¼‰                        â”‚  â”‚
â”‚  â”‚ â†’ æ·±åº¦æŠ¥å‘Šç”Ÿæˆ / åˆç›˜åŒ¹é…                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒè®¾è®¡çº¦æŸ

| çº¦æŸ | è¯´æ˜ |
|-----|------|
| **Agent ä¼˜å…ˆ** | æ‰€æœ‰åˆ†æç”±ä¸“ä¸š Agent å®Œæˆï¼Œéé€šç”¨ LLM æ³›èŠ |
| **ç¡®å®šæ€§ä¼˜å…ˆ** | L0 å±‚äº‹å®ï¼ˆå…«å­—/æ˜Ÿç›˜ï¼‰è®¡ç®—ç»“æœå¯è¿½æº¯ã€å¯éªŒè¯ |
| **è¡¨è¾¾å±‚åˆ†ç¦»** | ä¸“ä¸šåˆ†æç»“æ„åŒ–è¾“å‡ºï¼ˆA2UI/Viewerï¼‰ï¼Œå¯¹è¯åªåš"æ•™ç»ƒè¡¨è¾¾" |
| **è¡ŒåŠ¨é—­ç¯** | æ¯æ¬¡è¾“å‡ºå¿…é¡»è½åˆ°å¯æ‰§è¡Œå¤„æ–¹ + æ‰¿è¯ºæœºåˆ¶ |
| **åä¾èµ–æœºåˆ¶** | é˜²æ­¢æ²‰è¿·"ç®—å‘½"ï¼Œè¿ç»­è¿½é—®ä¼šå¼ºåˆ¶è½åˆ°ç°å®è¡ŒåŠ¨å®éªŒ |
| **éšç§ä¿æŠ¤** | åˆç›˜ç­‰ç¤¾äº¤åŠŸèƒ½ä¸æš´éœ²æ ¸å¿ƒéšç§æ•°æ® |
| **åˆ†å±‚æ¸—é€** | äº¤äº’ä¸­é€æ­¥å¼•å…¥ç”¨æˆ· Profile Context |
| **é£é™©è¾¹ç•Œ** | ä¸æ›¿ä»£åŒ»ç–—/æ³•å¾‹/æŠ•èµ„å»ºè®®ï¼›è´Ÿé¢ä¿¡æ¯å¿…é¡»é™„å¸¦"ä½ å¯ä»¥åšä»€ä¹ˆ" |

---

## äºŒã€Loginé¡µé¢è®¾è®¡ï¼ˆv4 é‡ç‚¹ç»†åŒ–ï¼‰

### 2.1 è®¾è®¡ç›®æ ‡

å‚ç…§ Co-Star é£æ ¼ï¼Œä¿æŒ Fortune AI æš—è‰²ä¸»é¢˜è®¾è®¡è¯­è¨€ï¼š
- å…«å­—/ç´«å¾®/æ˜Ÿåº§ ä¸‰ç§æ¨¡å¼ Tab å¯é€‰
- æ¯ç§æ¨¡å¼é…ä¸“ä¸šå‘½ç›˜å›¾ç¤º
- 3 ä¸ªã€Œé‚£å°±æ˜¯æˆ‘ã€éªŒè¯ç‚¹å»ºç«‹ä¿¡ä»»
- éªŒè¯ç‚¹ä¸æ³¨å†Œ/ç™»å½•åŒæ—¶æ˜¾ç¤ºï¼Œç”¨æˆ·è‡ªä¸»é€‰æ‹©

### 2.2 é¡µé¢å¸ƒå±€è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fortune AI     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     [ç™»å½•]  [æ³¨å†Œ]              â”‚
â”‚                â”‚ å…«å­— â”‚ ç´«å¾® â”‚ æ˜Ÿåº§  â”‚                                  â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ”® [å½“å‰æ¨¡å¼ä¸“ä¸šå›¾ç¤º]   â”‚  â”‚  â”‚        ä¸“ä¸šå‘½ç›˜å¯è§†åŒ–              â”‚  â”‚
â”‚  â”‚    å…«å­—: å››æŸ±+äº”è¡Œé›·è¾¾  â”‚  â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚    ç´«å¾®: 12å®«æ ¼å‘½ç›˜    â”‚  â”‚  â”‚   â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”                   â”‚  â”‚
â”‚  â”‚    æ˜Ÿåº§: æœ¬å‘½ç›˜è½®      â”‚  â”‚  â”‚   â”‚å¹´â”‚æœˆâ”‚æ—¥â”‚æ—¶â”‚  (å…«å­—å››æŸ±)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜                   â”‚  â”‚
â”‚                              â”‚  â”‚                                    â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚      [äº”è¡Œé›·è¾¾å›¾]                  â”‚  â”‚
â”‚  â”‚ å‡ºç”Ÿä¿¡æ¯               â”‚  â”‚  â”‚        é‡‘                          â”‚  â”‚
â”‚  â”‚ æ—¥æœŸ [1990-01-01    ]  â”‚  â”‚  â”‚      ï¼   ï¼¼                       â”‚  â”‚
â”‚  â”‚ æ—¶é—´ [12:00         ]  â”‚  â”‚  â”‚    æœ¨ â”€â”€â”€â—â”€â”€â”€ æ°´                  â”‚  â”‚
â”‚  â”‚ åœ°ç‚¹ [åŒ—äº¬(é»˜è®¤)     ]  â”‚  â”‚  â”‚      ï¼¼   ï¼                       â”‚  â”‚
â”‚  â”‚      [ç”Ÿæˆé¢„è§ˆ]        â”‚  â”‚  â”‚        ç« â”€ åœŸ                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚                                    â”‚  â”‚
â”‚                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                          â”‚
â”‚  â”‚ âœ¨ 3ä¸ªã€Œé‚£å°±æ˜¯æˆ‘ã€éªŒè¯ç‚¹ â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        â”‚  â”‚  â”‚        é¢„è§ˆæ•°æ®å¡ç‰‡                 â”‚  â”‚
â”‚  â”‚ âœ“ "ä½ æ˜¯ä¸æ˜¯ç»å¸¸æƒ³å¤ªå¤š,  â”‚  â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚    å†³å®šä¸€ä»¶å°äº‹éƒ½è¦     â”‚  â”‚  â”‚  æ—¥ä¸»ï¼šç”²æœ¨ Â· èº«å¼º                  â”‚  â”‚
â”‚  â”‚    çº ç»“å¾ˆä¹…ï¼Ÿ"         â”‚  â”‚  â”‚  æœ‰åˆ©ï¼šé‡‘ã€åœŸ                       â”‚  â”‚
â”‚  â”‚                        â”‚  â”‚  â”‚  èµ·è¿ï¼š8å² Â· é¡ºè¡Œ                   â”‚  â”‚
â”‚  â”‚ âœ“ "ä½ åœ¨äººé™…å…³ç³»ä¸­å¾€å¾€   â”‚  â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚    æ˜¯ä»˜å‡ºæ›´å¤šçš„é‚£ä¸ªï¼Ÿ"  â”‚  â”‚  â”‚  æœ¬å‘¨è¿åŠ¿ï¼š                        â”‚  â”‚
â”‚  â”‚                        â”‚  â”‚  â”‚  äº‹ä¸š â˜…â˜…â˜…â˜…â˜†  æ„Ÿæƒ… â˜…â˜…â˜…â˜†â˜†       â”‚  â”‚
â”‚  â”‚ âœ“ "ä½ é¢å¯¹å‹åŠ›æ—¶ï¼Œç¬¬ä¸€   â”‚  â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚    ååº”æ˜¯ç‹¬è‡ªæ¶ˆåŒ–ï¼Ÿ"    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                          â”‚
â”‚                              â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                          â”‚
â”‚  â”‚ è´¦å· (å¯åŒæ—¶é€‰æ‹©)       â”‚  â”‚                                          â”‚
â”‚  â”‚                        â”‚  â”‚                                          â”‚
â”‚  â”‚ é‚®ç®± [_______________ ]â”‚  â”‚                                          â”‚
â”‚  â”‚ å¯†ç  [_______________ ]â”‚  â”‚                                          â”‚
â”‚  â”‚ æ˜µç§° [_______________ ]â”‚  â”‚                                          â”‚
â”‚  â”‚                        â”‚  â”‚                                          â”‚
â”‚  â”‚ [æ³¨å†Œå¹¶ä¿å­˜]  [ç›´æ¥ç™»å½•]â”‚  â”‚                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                          â”‚
â”‚                              â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æ¨¡å¼åˆ‡æ¢ä¸ä¸“ä¸šå›¾ç¤º

| æ¨¡å¼ | L0 æ•°æ®æº | ä¸“ä¸šå›¾ç¤º | éªŒè¯ç‚¹ç”Ÿæˆä¾æ® |
|------|----------|---------|---------------|
| **å…«å­—** | å››æŸ±æ’ç›˜ + åç¥ + ç¥ç… | å››æŸ±å¡ç‰‡ + äº”è¡Œé›·è¾¾å›¾ | æ—¥ä¸»ç‰¹è´¨ + åç¥ç»„åˆ |
| **ç´«å¾®** | ç´«å¾®æ–—æ•° + 14ä¸»æ˜Ÿ + 12å®« | 12å®«æ ¼å‘½ç›˜å›¾ | å‘½å®«ä¸»æ˜Ÿ + æ ¼å±€ |
| **æ˜Ÿåº§** | å¤ªé˜³/æœˆäº®/ä¸Šå‡ + è¡Œæ˜Ÿ | æœ¬å‘½ç›˜è½®å›¾ | æ—¥æœˆå‡ç»„åˆ + ç›¸ä½ |

### 2.4 éªŒè¯ç‚¹ç”Ÿæˆ API

```python
# api/auth_routes.py æ–°å¢

class ValidationPointsRequest(BaseModel):
    mode: Literal['bazi', 'ziwei', 'astro']
    birthday_local: str  # YYYY-MM-DD HH:MM:SS
    tz_offset_hours: float = 8.0
    location: Dict[str, Any] = {'name': 'åŒ—äº¬', 'longitude': 116.4074, 'latitude': 39.9042}
    gender: str = 'ç”·'

class ValidationPoint(BaseModel):
    statement: str      # "ä½ æ˜¯ä¸æ˜¯ç»å¸¸..."
    confidence: float   # 0.0-1.0
    evidence: str       # ä¾æ®ï¼ˆå¦‚ï¼šæ—¥ä¸»ç”²æœ¨+åå°é€å‡ºï¼‰

@router.post("/validation-points")
def generate_validation_points(req: ValidationPointsRequest) -> List[ValidationPoint]:
    """
    æ ¹æ®L0äº‹å®ç”Ÿæˆ3ä¸ªã€Œé‚£å°±æ˜¯æˆ‘ã€éªŒè¯ç‚¹
    - ä¸å†™å…¥æ•°æ®åº“
    - ä»…ç”¨äºå†·å¯åŠ¨ä¿¡ä»»å»ºç«‹
    """
    if req.mode == 'bazi':
        facts = calculate_bazi(req.birthday_local, req.tz_offset_hours, req.location)
        return bazi_validation_points(facts, req.gender)
    elif req.mode == 'ziwei':
        facts = calculate_ziwei(req.birthday_local, req.tz_offset_hours, req.location)
        return ziwei_validation_points(facts, req.gender)
    else:  # astro
        facts = calculate_astro(req.birthday_local, req.tz_offset_hours, req.location)
        return astro_validation_points(facts, req.gender)
```

### 2.5 ç”¨æˆ·äº¤äº’æµç¨‹

```
ç”¨æˆ·è®¿é—® /login
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. é»˜è®¤é€‰ä¸­ã€Œå…«å­—ã€Tabï¼Œæ˜¾ç¤ºå…«å­—ä¸“ä¸šå›¾ç¤º                                  â”‚
â”‚ 2. ç”¨æˆ·è¾“å…¥ç”Ÿè¾°ï¼ˆåœ°ç‚¹é»˜è®¤åŒ—äº¬ï¼‰                                          â”‚
â”‚ 3. è‡ªåŠ¨è§¦å‘é¢„è§ˆ + éªŒè¯ç‚¹ç”Ÿæˆ                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å³æ æ˜¾ç¤ºå‘½ç›˜é¢„è§ˆ                                                      â”‚
â”‚ 5. å·¦æ æ˜¾ç¤º 3 ä¸ªéªŒè¯ç‚¹                                                   â”‚
â”‚ 6. åº•éƒ¨æ˜¾ç¤ºæ³¨å†Œ/ç™»å½•è¡¨å•ï¼ˆéå¼¹çª—ï¼Œå†…åµŒï¼‰                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼                 â–¼                 â–¼
  [æ³¨å†Œå¹¶ä¿å­˜]      [ç›´æ¥ç™»å½•]        [åˆ‡æ¢Tab]
     â”‚                 â”‚                 â”‚
     â–¼                 â–¼                 â–¼
  åˆ›å»ºè´¦å·          éªŒè¯è´¦å·          é‡æ–°ç”Ÿæˆ
  ä¿å­˜å…«å­—æ•°æ®      è·³è½¬å·¥ä½œå°        é¢„è§ˆ+éªŒè¯ç‚¹
  è·³è½¬å·¥ä½œå°
```

### 2.6 å…³é”®æ–‡ä»¶æ”¹åŠ¨

| æ–‡ä»¶ | æ”¹åŠ¨å†…å®¹ |
|------|----------|
| `api/templates/auth.html` | 1. é¡¶éƒ¨æ·»åŠ å…«å­—/ç´«å¾®/æ˜Ÿåº§ Tab<br>2. å·¦æ æ·»åŠ éªŒè¯ç‚¹å¡ç‰‡<br>3. å·¦æ åº•éƒ¨å†…åµŒæ³¨å†Œ/ç™»å½•è¡¨å•(éå¼¹çª—)<br>4. å³æ æ·»åŠ ä¸“ä¸šå‘½ç›˜å›¾ç¤ºåŒº |
| `api/static/auth.js` | 1. Tabåˆ‡æ¢é€»è¾‘<br>2. éªŒè¯ç‚¹ç”ŸæˆAPIè°ƒç”¨<br>3. è¡¨å•æäº¤é€»è¾‘è°ƒæ•´<br>4. é¢„è§ˆä¸éªŒè¯ç‚¹è”åŠ¨ |
| `api/auth_routes.py` | 1. æ–°å¢ `POST /api/auth/validation-points`<br>2. æ‰©å±•previewæ”¯æŒç´«å¾®/æ˜Ÿåº§ |
| `services/auth_service.py` | éªŒè¯ç‚¹ç”Ÿæˆé€»è¾‘ (åŸºäºL0 facts) |

---

## ä¸‰ã€æ ¸å¿ƒæ¨¡å—ä¸€ï¼šä¸€é”®æ·±åº¦æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ

### 3.1 æ¨¡å—å®šä½

**ä¸€å¥è¯**: ç”¨æˆ·è¾“å…¥æœ€å°‘ä¿¡æ¯ï¼Œè·å¾—åª²ç¾ä¸“ä¸šå’¨è¯¢å¸ˆçš„æ·±åº¦åˆ†ææŠ¥å‘Šã€‚

**è§£å†³ç—›ç‚¹**:
- ä¼ ç»Ÿå‘½ç†/å¿ƒç†å’¨è¯¢ï¼šè´µï¼ˆå•æ¬¡ 200-2000 RMBï¼‰+ æ…¢ï¼ˆæ’é˜Ÿé¢„çº¦ï¼‰+ ä¸å¯è¿½æº¯
- ç°æœ‰ AI å·¥å…·ï¼šæ³›åŒ–ã€ä¸ä¸“ä¸šã€ç¼ºä¹æ¡†æ¶

**æ¶æ„ä¼˜åŠ¿**:
- L0 ç¡®å®šæ€§æ•°æ® â†’ L2 å¤š Agent ä¸“ä¸šåˆ†æ â†’ L3 ç»¼åˆè¾“å‡º
- çŸ¥è¯†åº“ RAG æ£€ç´¢ + è§„åˆ™å¼•æ“ â†’ å¯è§£é‡Šã€å¯è¿½æº¯

### 3.2 æŠ¥å‘Šç±»å‹çŸ©é˜µ

> è¯´æ˜ï¼šæä¾›å…«å­—ã€ç´«å¾®ã€æ˜Ÿåº§ã€å¿ƒç†å­¦ç­‰å¤šç§æ¨¡å—ä¾›ç”¨æˆ·å¯é€‰

| æŠ¥å‘Šç±»å‹ | è¾“å…¥è¦æ±‚ | è¾“å‡ºè§„æ¨¡ | å®šä»·ç­–ç•¥ | ç”¨é€” |
|---------|---------|---------|---------|-----|
| **å…«å­—åŸºç¡€è§£è¯»** | ç”Ÿè¾°+åœ°ç‚¹(é»˜è®¤åŒ—äº¬)+æ€§åˆ« | 3-5 é¡µ | å…è´¹ | å†·å¯åŠ¨/å»ºç«‹ä¿¡ä»» |
| **å…«å­—æ·±åº¦æŠ¥å‘Š** | ç”Ÿè¾°+åœ°ç‚¹(é»˜è®¤åŒ—äº¬)+æ€§åˆ« | 15-25 é¡µ | Â¥29-49 | æ ¸å¿ƒä»˜è´¹äº§å“ |
| **æµå¹´è¿åŠ¿æŠ¥å‘Š** | å·²æœ‰å…«å­—+ç›®æ ‡å¹´ä»½ | 5-8 é¡µ | Â¥9-19 | å¤è´­å¼•æ“ |
| **å¿ƒç†æ·±åº¦ç”»åƒ** | ä¸Šä¼ æ—¥è®°/å¯¹è¯è®°å½• | 10-15 é¡µ | Â¥39-69 | å·®å¼‚åŒ–æœåŠ¡ |
| **å†³ç­–åˆ†ææŠ¥å‘Š** | å…·ä½“é—®é¢˜+é€‰é¡¹ | 3-5 é¡µ | Â¥19-29 | é«˜é¢‘åœºæ™¯ |

### 3.3 æŠ¥å‘Šç”Ÿæˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ·±åº¦æŠ¥å‘Šç”Ÿæˆæµæ°´çº¿                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     ç”¨æˆ·è¾“å…¥                L0 è®¡ç®—å±‚                 L2 Agent å±‚
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æœ€å°å¿…è¦è¾“å…¥  â”‚      â”‚ ç¡®å®šæ€§è®¡ç®—    â”‚      â”‚ Agent æ·±åº¦åˆ†æ        â”‚
  â”‚              â”‚      â”‚              â”‚      â”‚ (ä»¥ä¸‹æ¡†æ¶å¾…ä¼˜åŒ–)      â”‚
  â”‚ â€¢ ç”Ÿè¾°æ—¶é—´   â”‚  â†’   â”‚ â€¢ çœŸå¤ªé˜³æ—¶    â”‚  â†’   â”‚ 1: æ ¼å±€åˆ†æ          â”‚
  â”‚ â€¢ å‡ºç”Ÿåœ°ç‚¹   â”‚      â”‚ â€¢ å››æŸ±æ’ç›˜    â”‚      â”‚ 2: æ€§æ ¼è§£è¯»          â”‚
  â”‚ â€¢ æ€§åˆ«      â”‚      â”‚ â€¢ åç¥æ¨å¯¼    â”‚      â”‚ 3: å¤§è¿æµå¹´          â”‚
  â”‚ â€¢ (å¯é€‰)é—®é¢˜ â”‚      â”‚ â€¢ ç¥ç…è®¡ç®—    â”‚      â”‚ 4: è¡ŒåŠ¨å»ºè®®          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                        â”‚
                              â–¼                        â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ facts.json   â”‚      â”‚ çŸ¥è¯†åº“ RAG æ£€ç´¢      â”‚
                       â”‚ facts_hash   â”‚      â”‚ â€¢ bazi_kb_chunk     â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â€¢ ä¸“ä¸šæ–‡çŒ®å¼•ç”¨       â”‚
                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                             â”‚ L3 Synthesis Agent   â”‚
                                             â”‚                      â”‚
                                             â”‚ â€¢ ç»¼åˆå¤šè§†è§’è¾“å‡º      â”‚
                                             â”‚ â€¢ å†²çªä»²è£           â”‚
                                             â”‚ â€¢ é£é™©è¾¹ç•Œæ ‡æ³¨       â”‚
                                             â”‚ â€¢ è¡ŒåŠ¨å¤„æ–¹ç”Ÿæˆ       â”‚
                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                             â”‚ ç»“æ„åŒ–æŠ¥å‘Šè¾“å‡º        â”‚
                                             â”‚                      â”‚
                                             â”‚ â€¢ PDF / Web é˜…è¯»     â”‚
                                             â”‚ â€¢ åˆ†äº«æµ·æŠ¥           â”‚
                                             â”‚ â€¢ A2UI äº¤äº’ç‰ˆ        â”‚
                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 æŠ¥å‘Šç»“æ„æ¨¡æ¿ï¼ˆå…«å­—æ·±åº¦æŠ¥å‘Šï¼‰

```markdown
# ä½ çš„äººç”Ÿè¯´æ˜ä¹¦

## ç¬¬ä¸€ç« ï¼šå‘½ç›˜æ¦‚è§ˆ
- å››æŸ±ä¿¡æ¯ï¼ˆå¹´/æœˆ/æ—¥/æ—¶æŸ±ï¼‰
- æ—¥ä¸»åˆ†æï¼ˆä½ çš„æ ¸å¿ƒèƒ½é‡ï¼‰
- äº”è¡Œåˆ†å¸ƒå›¾ + å¼ºå¼±åˆ¤å®š

## ç¬¬äºŒç« ï¼šæ€§æ ¼æ·±åº¦è§£æ
- æ€§æ ¼ä¼˜åŠ¿ï¼ˆåŸºäºåç¥ + å¿ƒç†å­¦æ˜ å°„ï¼‰
- æ€§æ ¼ç›²åŒºï¼ˆè¿‡åº¦ä½¿ç”¨çš„é£é™©ï¼‰
- äººé™…æ¨¡å¼åˆ†æ

## ç¬¬ä¸‰ç« ï¼šäº‹ä¸šä¸è´¢è¿
- é€‚åˆçš„èŒä¸šæ–¹å‘
- è´¢è¿æ¨¡å¼ï¼ˆæ­£è´¢/åè´¢å€¾å‘ï¼‰
- èŒä¸šå‘å±•èŠ‚å¥å»ºè®®

## ç¬¬å››ç« ï¼šæƒ…æ„Ÿä¸å…³ç³»
- æƒ…æ„Ÿæ¨¡å¼åˆ†æ
- ç†æƒ³ä¼´ä¾£ç‰¹è´¨
- å…³ç³»ç»è¥å»ºè®®

## ç¬¬äº”ç« ï¼šå¤§è¿æµå¹´
- å½“å‰å¤§è¿è§£è¯»
- è¿‘ 3-5 å¹´æµå¹´é¢„æµ‹
- å…³é”®æ—¶é—´çª—å£æé†’

## ç¬¬å…­ç« ï¼šè¡ŒåŠ¨æŒ‡å—
- æœ¬æœˆ 3 ä¸ªæ ¸å¿ƒè¡ŒåŠ¨
- éœ€è¦é¿å…çš„ 3 ä¸ªé™·é˜±
- æ¨èçš„æˆé•¿è®¡åˆ’

## é™„å½•
- æœ¯è¯­è§£é‡Š
- è®¡ç®—ä¾æ®ä¸å¼•ç”¨
- facts_hashï¼ˆå¯éªŒè¯ï¼‰
```

### 3.5 è¾“å‡ºå¥‘çº¦ï¼ˆA2UI + å¯è¿½æº¯ + å¯åˆ†äº«ï¼‰

**ç›®æ ‡**ï¼šæŠŠ"ç„å­¦/å¿ƒç†å­¦æ´å¯Ÿ"å˜æˆ**å¯éªŒè¯ã€å¯æ‰§è¡Œã€å¯åˆ†äº«**çš„ç»“æ„åŒ–äº¤ä»˜ç‰©ã€‚

æœ€å°äº¤ä»˜ç»“æ„ï¼ˆæ¯æ¬¡è¾“å‡ºéƒ½å¿…é¡»åŒ…å«ï¼‰ï¼š
1) **ç»“è®ºï¼ˆConclusionï¼‰**ï¼šä¸€å¥è¯"ä½ ç°åœ¨æœ€å…³é”®çš„çŸ›ç›¾/æœºä¼šç‚¹æ˜¯ä»€ä¹ˆ"
2) **ä¾æ®ï¼ˆEvidenceï¼‰**ï¼šfacts_hash + rule_ids + kb_refsï¼ˆè®©ç”¨æˆ·ç›¸ä¿¡"ä¸æ˜¯çç¼–"ï¼‰
3) **å¤„æ–¹ï¼ˆPrescriptionsï¼‰**ï¼šâ‰¤3 æ¡åŠ¨ä½œï¼ˆå«æ—¶é•¿/éš¾åº¦/è§¦å‘æ¡ä»¶ï¼‰
4) **æ‰¿è¯ºé‚€è¯·ï¼ˆCommitment Askï¼‰**ï¼šå¿…é¡»é—®"ä½ æ„¿æ„å…ˆåšå“ªä¸€ä¸ªï¼Ÿ"
5) **é£é™©è¾¹ç•Œï¼ˆRisk Boundaryï¼‰**ï¼šä¸æ›¿ä»£åŒ»ç–—/æ³•å¾‹/æŠ•èµ„å»ºè®®ï¼›è´Ÿé¢ä¿¡æ¯å¿…é¡»ç»™å‡º"ä½ å¯ä»¥åšä»€ä¹ˆ"
6) **åˆ†äº«åŒ…ï¼ˆShare Packï¼‰**ï¼šè„±æ•å¯ä¼ æ’­æ–‡æ¡ˆ + æµ·æŠ¥å‚æ•°ï¼ˆè§æ¨¡å—ä¸‰ï¼‰

---

## å››ã€æ ¸å¿ƒæ¨¡å—äºŒï¼šç”¨æˆ·çŠ¶æ€é‡åŒ–ä¸äººç”ŸKçº¿

### 4.1 æ¨¡å—å®šä½

**ä¸€å¥è¯**: æŠŠæŠ½è±¡çš„"çŠ¶æ€"å˜æˆå¯è¿½è¸ªçš„æ•°å­—ï¼ŒæŠŠæ•£ç‚¹çš„è®°å½•å˜æˆå¯å›é¡¾çš„è¶‹åŠ¿ã€‚

**è§£å†³ç—›ç‚¹**:
- "æˆ‘æœ€è¿‘çŠ¶æ€ä¸å¥½" â†’ å¤šä¸å¥½ï¼Ÿå“ªä¸ªç»´åº¦ï¼Ÿæ¯”ä¸Šå‘¨å¦‚ä½•ï¼Ÿ
- "æˆ‘æ„Ÿè§‰è‡ªå·±æœ‰è¿›æ­¥" â†’ æœ‰æ•°æ®æ”¯æ’‘å—ï¼Ÿè¶‹åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ

### 4.2 çŠ¶æ€é‡åŒ–æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    State Score è®¡ç®—æ¨¡å‹                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         State Score (0-100)
                               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                      â”‚                      â”‚
        â–¼                      â–¼                      â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  æƒ…ç»ªæŒ‡æ•°  â”‚          â”‚  è¡ŒåŠ¨æŒ‡æ•°  â”‚          â”‚  æˆé•¿æŒ‡æ•°  â”‚
  â”‚   (40%)   â”‚          â”‚   (35%)   â”‚          â”‚   (25%)   â”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚                      â”‚
        â–¼                      â–¼                      â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ â€¢ æƒ…ç»ªç­¾åˆ° â”‚          â”‚ â€¢ æ‰¿è¯ºå®Œæˆç‡â”‚         â”‚ â€¢ è®¡åˆ’è¿›åº¦ â”‚
  â”‚ â€¢ å¯¹è¯æƒ…æ„Ÿ â”‚          â”‚ â€¢ è¡ŒåŠ¨åŠæ—¶æ€§â”‚         â”‚ â€¢ å¤ç›˜æ·±åº¦ â”‚
  â”‚ â€¢ æ³¢åŠ¨ç¨³å®šæ€§â”‚         â”‚ â€¢ ä»»åŠ¡éš¾åº¦  â”‚          â”‚ â€¢ æ´å¯Ÿè´¨é‡ â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 äººç”Ÿ K çº¿è®¾è®¡ï¼ˆv4 å¢å¼ºï¼‰

**è®¾è®¡ç†å¿µ**: å€Ÿé‰´è‚¡ç¥¨ K çº¿çš„ç›´è§‚æ€§ï¼Œè®©ç”¨æˆ·"ä¸€çœ¼çœ‹æ‡‚"è‡ªå·±çš„çŠ¶æ€è¶‹åŠ¿ã€‚

**æ”¯æŒå¤šæ—¶é—´å°ºåº¦**ï¼šæ—¥çº¿ã€å‘¨çº¿ã€æœˆçº¿ã€å¹´çº¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    äººç”Ÿ K çº¿èœ¡çƒ›å›¾                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

State
Score
 100 â”¤
     â”‚                              â”Œâ”€â”€â”€â”
  80 â”¤          â”Œâ”€â”€â”€â”    â•·          â”‚â–ˆâ–ˆâ–ˆâ”‚
     â”‚    â”Œâ”€â”€â”€â” â”‚â–ˆâ–ˆâ–ˆâ”‚    â”‚    â”Œâ”€â”€â”€â” â”‚â–ˆâ–ˆâ–ˆâ”‚
  60 â”¤    â”‚â–ˆâ–ˆâ–ˆâ”‚ â”‚â–ˆâ–ˆâ–ˆâ”‚   â”Œâ”´â”   â”‚â–’â–’â–’â”‚ â”‚â–ˆâ–ˆâ–ˆâ”‚
     â”‚ â•·  â”‚â–ˆâ–ˆâ–ˆâ”‚ â”‚â–ˆâ–ˆâ–ˆâ”‚   â”‚â–’â”‚   â”‚â–’â–’â–’â”‚ â”‚â–ˆâ–ˆâ–ˆâ”‚
  40 â”¤ â”‚  â”‚â–ˆâ–ˆâ–ˆâ”‚ â”‚â–ˆâ–ˆâ–ˆâ”‚ â•· â”‚â–’â”‚   â”‚â–’â–’â–’â”‚ â”‚â–ˆâ–ˆâ–ˆâ”‚
     â”‚ â”‚  â”‚â–ˆâ–ˆâ–ˆâ”‚ â”‚â–ˆâ–ˆâ–ˆâ”‚ â”‚ â”‚â–’â”‚   â”‚â–’â–’â–’â”‚ â”‚â–ˆâ–ˆâ–ˆâ”‚
  20 â”¤ â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â”‚ â””â”€â”˜   â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜
     â”‚ â•µ              â•µ
   0 â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ—¶é—´
       W1   W2   W3   W4   W5   W6   W7

å›¾ä¾‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â–ˆâ–ˆâ–ˆ = ä¸Šæ¶¨å‘¨ï¼ˆæ”¶ç›˜ > å¼€ç›˜ï¼Œç»¿è‰²å¡«å……ï¼‰                                    â”‚
â”‚  â–’â–’â–’ = ä¸‹è·Œå‘¨ï¼ˆæ”¶ç›˜ < å¼€ç›˜ï¼Œçº¢è‰²å¡«å……ï¼‰                                    â”‚
â”‚  â•·â•µ  = å½±çº¿ï¼ˆå‘¨å†…é«˜ä½åŒºé—´ï¼‰                                              â”‚
â”‚  æ©™è‰²è¾¹æ¡† = æ³¢åŠ¨è¾ƒå¤§ï¼ˆéœ€å…³æ³¨ï¼‰                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 K çº¿æ•°æ®ç»“æ„ï¼ˆv4 å¢å¼ºï¼‰

```json
{
  "user_id": 123,
  "period": "weekly",
  "period_start": "2026-01-01",
  "period_end": "2026-01-07",
  "kline": {
    "open": 62,      // å‘¨ä¸€æ—©æ™¨ State Score
    "close": 68,     // å‘¨æ—¥æ™šé—´ State Score
    "high": 75,      // å‘¨å†…æœ€é«˜
    "low": 55,       // å‘¨å†…æœ€ä½
    "avg": 65,       // å‘¨å‡å€¼
    "change": "+6",  // å˜åŒ–
    "change_pct": "+9.7%",
    "trend": "up",   // up | down | volatile
    "volatility": "medium"  // low | medium | high
  },
  "drivers": [
    {"dimension": "action", "delta": "+7", "evidence": "æ‰¿è¯ºå®Œæˆç‡æå‡è‡³80%"},
    {"dimension": "emotion", "delta": "-3", "evidence": "å‘¨äº”è´Ÿå‘æƒ…ç»ªå³°å€¼(å·¥ä½œå‹åŠ›)"}
  ],
  "confidence": "medium",
  "perma": {
    "P": 70, "E": 65, "R": 55, "M": 68, "A": 72
  },
  "key_events": [
    {"date": "2026-01-03", "type": "milestone", "event": "å®Œæˆ21å¤©æ„Ÿæ©è®¡åˆ’", "impact": "+5"},
    {"date": "2026-01-05", "type": "checkin", "event": "æƒ…ç»ªä½è°·ï¼ˆå·¥ä½œå‹åŠ›ï¼‰", "impact": "-8"}
  ],
  "ai_insight": "æœ¬å‘¨æ•´ä½“ä¸Šæ¶¨ï¼Œä¸»è¦å¾—ç›Šäºè®¡åˆ’å®Œæˆçš„æˆå°±æ„Ÿã€‚å‘¨äº”çš„æƒ…ç»ªä½è°·å€¼å¾—å…³æ³¨ï¼Œå»ºè®®ä¸‹å‘¨å·¥ä½œå‹åŠ›å¤§æ—¶ä¼˜å…ˆä½¿ç”¨3åˆ†é’Ÿé™å™ªåè®®ã€‚"
}
```

### 4.5 K çº¿ API è®¾è®¡ï¼ˆv4 æ–°å¢ï¼‰

```python
# api/dashboard_routes.py æ–°å¢

@router.get("/kline")
def get_kline(
    period: Literal['daily', 'weekly', 'monthly'] = 'weekly',
    count: int = Query(7, ge=1, le=52),
    auth: dict = Depends(require_auth)
) -> List[KLineData]:
    """
    è·å–Kçº¿æ•°æ®
    - period: æ—¶é—´ç²’åº¦
    - count: è¿”å›æ•°é‡
    """
    return soul_os.get_kline_history(auth['user_id'], period, count)
```

### 4.6 å‰ç«¯ Tab åˆå¹¶è®¾è®¡ï¼ˆv4 æ–°å¢ï¼‰

**ç›®æ ‡**: åˆå¹¶ status-tab å’Œ trends-tab ä¸ºç»Ÿä¸€çš„ä»ªè¡¨ç›˜è§†å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç»Ÿä¸€ä»ªè¡¨ç›˜ Tab                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  State Score    â”‚  â”‚           K çº¿è¶‹åŠ¿å›¾                        â”‚  â”‚
â”‚  â”‚     [72]        â”‚  â”‚   â”Œâ”€â”€â”€â”                                    â”‚  â”‚
â”‚  â”‚   â—â”€â”€â”€â”€â”€â”€â”€â”€     â”‚  â”‚   â”‚â–ˆâ–ˆâ–ˆâ”‚ â”Œâ”€â”€â”€â”     â”Œâ”€â”€â”€â”                   â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚   â”‚â–ˆâ–ˆâ–ˆâ”‚ â”‚â–’â–’â–’â”‚ â•·   â”‚â–ˆâ–ˆâ–ˆâ”‚                   â”‚  â”‚
â”‚  â”‚  æƒ…ç»ª â–ˆâ–ˆâ–ˆâ–ˆâ–‘ 32  â”‚  â”‚   â”‚â–ˆâ–ˆâ–ˆâ”‚ â”‚â–’â–’â–’â”‚ â”‚   â”‚â–ˆâ–ˆâ–ˆâ”‚                   â”‚  â”‚
â”‚  â”‚  è¡ŒåŠ¨ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 28  â”‚  â”‚   â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â•µ   â””â”€â”€â”€â”˜                   â”‚  â”‚
â”‚  â”‚  è¿ç»­ â–ˆâ–ˆâ–ˆâ–‘â–‘ 12  â”‚  â”‚   Mon  Tue  Wed  Thu  Fri                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                    [æ—¥|å‘¨|æœˆ] åˆ‡æ¢          â”‚  â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PERMA é›·è¾¾å›¾ (ç‚¹å‡»å±•å¼€)                                         â”‚   â”‚
â”‚  â”‚           P:70                                                  â”‚   â”‚
â”‚  â”‚         â•±     â•²                                                 â”‚   â”‚
â”‚  â”‚      M:68 â”€â”€â—â”€â”€ E:65                                            â”‚   â”‚
â”‚  â”‚         â•²     â•±                                                 â”‚   â”‚
â”‚  â”‚        A:72  R:55                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  äº‹ä»¶æ—¶é—´çº¿ (æ¨ªå‘æ»šåŠ¨)                                                  â”‚
â”‚  â—‹â”€â”€â”€â”€â—â”€â”€â”€â”€â—‹â”€â”€â”€â”€â—â”€â”€â”€â”€â—‹â”€â”€â”€â”€â—â”€â”€â”€â”€â—‹                                      â”‚
â”‚  1/1   1/3   1/4   1/5   1/6   1/7                                     â”‚
â”‚       ç­¾åˆ°   å®Œæˆ   æƒ…ç»ª   ç­¾åˆ°   å¤ç›˜                                   â”‚
â”‚              è®¡åˆ’   ä½è°·                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€æ ¸å¿ƒæ¨¡å—ä¸‰ï¼šæµ·æŠ¥ç”Ÿæˆç³»ç»Ÿï¼ˆv4 æ–°å¢ï¼‰

### 5.1 æ¨¡å—å®šä½

**ä¸€å¥è¯**: æŠŠç”¨æˆ·çš„çŠ¶æ€/æ´å¯Ÿå˜æˆå¯åˆ†äº«çš„ç¤¾äº¤è´§å¸ï¼Œåˆ©ç”¨ Gemini å›¾ç‰‡æ¨¡å‹ç”Ÿæˆé«˜è´¨é‡æµ·æŠ¥ã€‚

### 5.2 æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æµ·æŠ¥ç”Ÿæˆæµæ°´çº¿                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ç”¨æˆ·è§¦å‘                  æœåŠ¡å±‚                     Gemini å›¾ç‰‡æ¨¡å‹
 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§¦å‘åœºæ™¯ï¼š    â”‚      â”‚ poster_service   â”‚      â”‚ gemini_create_job    â”‚
â”‚              â”‚      â”‚                  â”‚      â”‚                      â”‚
â”‚ â€¢ å®Œæˆè§£è¯»   â”‚  â†’   â”‚ 1. è¯»å–ç”¨æˆ·      â”‚  â†’   â”‚ model: gemini-2.0-   â”‚
â”‚ â€¢ æƒ…ç»ªç­¾åˆ°   â”‚      â”‚    Profile       â”‚      â”‚   flash-exp (å›¾ç‰‡)   â”‚
â”‚ â€¢ æŸ¥çœ‹è¿åŠ¿   â”‚      â”‚ 2. ç”Ÿæˆåæ§½æ–‡æ¡ˆ  â”‚      â”‚                      â”‚
â”‚ â€¢ åˆç›˜ç»“æœ   â”‚      â”‚    (GLM)         â”‚      â”‚ prompt: æµ·æŠ¥è®¾è®¡     â”‚
â”‚ â€¢ å®Œæˆé‡Œç¨‹ç¢‘ â”‚      â”‚ 3. æ„å»ºæµ·æŠ¥å‚æ•°  â”‚      â”‚   + æ–‡æ¡ˆ + ç”¨æˆ·æ•°æ®  â”‚
â”‚ â€¢ çŠ¶æ€ä½è°·   â”‚      â”‚                  â”‚      â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚                           â”‚
                             â–¼                           â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ è¿”å› job_id      â”‚      â”‚ ç”Ÿæˆå›¾ç‰‡             â”‚
                      â”‚ å‰ç«¯è½®è¯¢çŠ¶æ€     â”‚      â”‚ è¿”å› image_url       â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 æµ·æŠ¥ç±»å‹

```python
# services/poster_service.py

class PosterType(str, Enum):
    PERSONALITY = 'personality'   # æ€§æ ¼åæ§½
    MOOD = 'mood'                 # æƒ…ç»ªåæ§½
    FORTUNE = 'fortune'           # è¿åŠ¿åæ§½
    PAIRING = 'pairing'           # åˆç›˜åæ§½
    ACHIEVEMENT = 'achievement'   # æˆå°±æ‰“å¡
    HELP = 'help'                 # æ±‚åŠ©å‘¼å”¤

class PosterRequest(BaseModel):
    type: PosterType
    context: Dict[str, Any]  # ç±»å‹ç›¸å…³çš„ä¸Šä¸‹æ–‡æ•°æ®
    style: Literal['dark', 'light', 'gradient'] = 'dark'
```

### 5.4 æµ·æŠ¥ç”ŸæˆæœåŠ¡

```python
# services/poster_service.py

class PosterService:
    def __init__(self, glm_client, gemini_repo):
        self.glm = glm_client
        self.gemini = gemini_repo

    async def generate_poster(
        self,
        user_id: int,
        poster_type: PosterType,
        context: Dict[str, Any]
    ) -> str:
        """
        ç”Ÿæˆæµ·æŠ¥ï¼Œè¿”å› job_id
        """
        # 1. è·å–ç”¨æˆ· Profile
        profile = await self._get_user_profile(user_id)

        # 2. ç”Ÿæˆåæ§½æ–‡æ¡ˆ (GLM)
        copy = await self._generate_copy(poster_type, profile, context)

        # 3. æ„å»º Gemini å›¾ç‰‡ç”Ÿæˆ prompt
        prompt = self._build_poster_prompt(poster_type, copy, profile, context)

        # 4. è°ƒç”¨ gemini_create_job
        job_id = self.gemini.create_gemini_job(
            title=f"poster_{poster_type}_{user_id}",
            tasks=[{
                'model': 'gemini-2.0-flash-exp',  # å›¾ç‰‡æ¨¡å‹
                'prompt': prompt,
                'output_type': 'image'
            }],
            user_email=profile.get('email')
        )

        return job_id

    def _build_poster_prompt(self, poster_type, copy, profile, context):
        """æ„å»ºæµ·æŠ¥è®¾è®¡ prompt"""
        return f"""
è®¾è®¡ä¸€å¼ ç¤¾äº¤åˆ†äº«æµ·æŠ¥ï¼Œè¦æ±‚ï¼š

1. é£æ ¼ï¼šæš—è‰²è°ƒ + é‡‘è‰²ç‚¹ç¼€ï¼ˆ#f6c453ï¼‰ï¼Œç¥ç§˜é«˜çº§æ„Ÿ
2. å°ºå¯¸ï¼š1080x1920 (9:16 ç«–ç‰ˆ)
3. å¸ƒå±€ï¼š
   - é¡¶éƒ¨ï¼šç”¨æˆ·å¤´åƒåŒºï¼ˆå¯ç”¨å ä½ç¬¦ï¼‰
   - ä¸­éƒ¨ï¼šæ ¸å¿ƒæ–‡æ¡ˆã€Œ{copy}ã€
   - åº•éƒ¨ï¼šFortune AI logo + äºŒç»´ç å ä½

4. ç±»å‹ç‰¹å®šå…ƒç´ ï¼š
   {self._get_type_specific_elements(poster_type, context)}

5. æ•°æ®å¯è§†åŒ–ï¼ˆå¦‚æœ‰ï¼‰ï¼š
   {self._get_data_visualization(poster_type, context)}

è¯·ç”Ÿæˆä¸€å¼ å®Œæ•´çš„æµ·æŠ¥å›¾ç‰‡ã€‚
"""
```

### 5.5 æµ·æŠ¥ API

```python
# api/poster_routes.py

router = APIRouter(prefix="/api/poster", tags=["poster"])

@router.post("/generate")
async def generate_poster(
    req: PosterRequest,
    auth: dict = Depends(require_auth)
) -> Dict[str, str]:
    """
    ç”Ÿæˆæµ·æŠ¥ï¼Œè¿”å› job_id
    """
    job_id = await poster_service.generate_poster(
        user_id=auth['user_id'],
        poster_type=req.type,
        context=req.context
    )
    return {"job_id": job_id}

@router.get("/{job_id}")
async def get_poster_status(
    job_id: str,
    auth: dict = Depends(require_auth)
) -> Dict[str, Any]:
    """
    è·å–æµ·æŠ¥ç”ŸæˆçŠ¶æ€
    """
    status = await poster_service.get_poster_status(job_id)
    return {
        "status": status.state,  # pending | processing | completed | failed
        "image_url": status.image_url if status.state == 'completed' else None,
        "error": status.error if status.state == 'failed' else None
    }
```

### 5.6 åæ§½æ–‡æ¡ˆç±»å‹çŸ©é˜µ

| ç±»å‹ | è§¦å‘åœºæ™¯ | æ–‡æ¡ˆé£æ ¼ | ç¤¾äº¤å±æ€§ |
|------|----------|----------|----------|
| **æ€§æ ¼åæ§½** | å®Œæˆå…«å­—è§£è¯»å | è‡ªå˜²å¼ï¼Œå¼•å‘å…±é¸£ | æ±‚è®¤åŒã€æ±‚å®‰æ…° |
| **æƒ…ç»ªåæ§½** | æƒ…ç»ªç­¾åˆ°å | å¤¸å¼ å¼ï¼Œå¸¦å¹½é»˜ | æ±‚æŠ±æŠ±ã€æ±‚åŠ æ²¹ |
| **è¿åŠ¿åæ§½** | æŸ¥çœ‹æµå¹´è¿åŠ¿å | è°ƒä¾ƒå¼ï¼Œé™„è¡ŒåŠ¨ | æ±‚é”¦é²¤ã€æ±‚è½¬è¿ |
| **åˆç›˜åæ§½** | æŸ¥çœ‹åˆç›˜ç»“æœå | åå·®å¼ï¼Œå±•æ´å¯Ÿ | æ±‚ç¥ç¦ã€æ±‚ç»éªŒ |
| **æˆå°±æ‰“å¡** | å®Œæˆè®¡åˆ’/é‡Œç¨‹ç¢‘ | è‡ªè±ªå¼ï¼Œå¸¦æ•°æ® | æ±‚ç‚¹èµã€æ±‚æ¨¡ä»¿ |
| **æ±‚åŠ©å‘¼å”¤** | çŠ¶æ€ä½è°·æ—¶ | æ±‚åŠ©å¼ï¼Œé™„CTA | æ±‚èƒ½é‡ã€æ±‚äº’åŠ¨ |

---

## å…­ã€ç”¨æˆ·åˆ†å±‚ Context æ¸—é€æœºåˆ¶

### 6.1 Context æ¸—é€ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ· Context åˆ†å±‚æ¸—é€                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ           æ¸—é€æ·±åº¦              ç³»ç»Ÿè¡Œä¸º                 ç”¨æˆ·æ„ŸçŸ¥
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ã€é¦–æ¬¡æ¥è§¦ã€‘   L0 åŸºç¡€               ä»…ä½¿ç”¨å…¬å¼€å…«å­—ä¿¡æ¯       "è¿™ä¸ªç³»ç»Ÿ
               ç”Ÿè¾°+åœ°ç‚¹+æ€§åˆ«        è¾“å‡ºé€šç”¨æ€§æ ¼è§£è¯»         æŒºå‡†çš„"
               + 3ä¸ªéªŒè¯ç‚¹

ã€æ³¨å†Œå®Œæˆã€‘   L0 + L1 åˆå§‹åŒ–        å¼•å…¥ PERMA ç»´åº¦          "å®ƒå¼€å§‹
               + é¦–æ¬¡æƒ…ç»ªç­¾åˆ°        æä¾›ä¸ªæ€§åŒ–å»ºè®®           æ‡‚æˆ‘äº†"

ã€æ´»è·ƒä¸€å‘¨ã€‘   L0 + L1 + è¡Œä¸º        æ ¹æ®è¡Œä¸ºæ¨¡å¼è°ƒæ•´         "å®ƒè®°å¾—
               ä»»åŠ¡å®Œæˆ/æƒ…ç»ªè½¨è¿¹     æ¨èå’Œè¯æœ¯é£æ ¼           æˆ‘çš„æƒ…å†µ"

ã€æ·±åº¦ä½¿ç”¨ã€‘   L0 + L1 + L2          å¤š Agent ç»¼åˆåˆ†æ        "å®ƒçœŸçš„
               + ç›®æ ‡/è®¡åˆ’/å¤ç›˜      å¼•ç”¨å†å²ä¸Šä¸‹æ–‡           ç†è§£æˆ‘"

ã€é•¿æœŸé™ªä¼´ã€‘   å…¨é‡ Context          é¢„æµ‹æ€§å¹²é¢„               "å®ƒæ¯”æˆ‘
               + è¶‹åŠ¿ + è§„å¾‹         ä¸»åŠ¨æä¾›æ´å¯Ÿ             æ›´äº†è§£æˆ‘"
```

---

## ä¸ƒã€Settings æ¨¡å—è®¾è®¡ï¼ˆv4 æ–°å¢ï¼‰

### 7.1 æ¨¡å—å®šä½

**ä¸€å¥è¯**: æä¾›ç”¨æˆ·è‡ªå®šä¹‰ Profile å’Œç³»ç»Ÿé€‰é¡¹çš„ç»Ÿä¸€å…¥å£ï¼Œæ”¯æŒ AI å¼•æ“åˆ‡æ¢ã€æ¨¡å‹é€‰æ‹©ç­‰é«˜çº§é…ç½®ã€‚

### 7.2 ç°æœ‰åŸºç¡€è®¾æ–½

| å±‚çº§ | ç°æœ‰å®ç° | å­˜å‚¨ä½ç½® |
|-----|---------|---------|
| **Profile æ•°æ®** | name, gender, birthday_local, tz_offset_hours, location | `fortune_user` è¡¨ |
| **åå¥½è®¾ç½®** | persona_style, push_enabled, push_time, quiet_hours, chat_backend | `fortune_user_preferences` è¡¨ |
| **API** | `GET/PUT /api/user/profile` + `GET/PUT /api/user/preferences` | `api/user_routes.py` |
| **å‰ç«¯** |  è®¾ç½®é¡µé¢ | - |

### 7.3 Settings é¡µé¢ä¿¡æ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Settings é¡µé¢ç»“æ„                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ ğŸ“‹ Profile (ä¸ªäººèµ„æ–™)
â”‚   â”œâ”€â”€ åŸºç¡€ä¿¡æ¯
â”‚   â”‚   â”œâ”€â”€ å¤´åƒ (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ æ˜µç§°
â”‚   â”‚   â””â”€â”€ æ€§åˆ«
â”‚   â”œâ”€â”€ å‡ºç”Ÿä¿¡æ¯
â”‚   â”‚   â”œâ”€â”€ å‡ºç”Ÿæ—¥æœŸæ—¶é—´
â”‚   â”‚   â”œâ”€â”€ æ—¶åŒºåç§»
â”‚   â”‚   â””â”€â”€ å‡ºç”Ÿåœ°ç‚¹ (ç»çº¬åº¦)
â”‚   â””â”€â”€ å‘½ç†æ¨¡å¼ (æ–°å¢)
â”‚       â””â”€â”€ åå¥½æ¨¡å¼: å…«å­— | ç´«å¾® | æ˜Ÿåº§

â”œâ”€ ğŸ¤– AI å¼•æ“ (ç³»ç»Ÿé€‰é¡¹)
â”‚   â”œâ”€â”€ å¯¹è¯åç«¯
â”‚   â”‚   â”œâ”€â”€ GLM ç›´è¿ (fastapi) - ä½å»¶è¿Ÿ
â”‚   â”‚   â””â”€â”€ Vercel Agent (agent_service) - å¤šåŠŸèƒ½
â”‚   â”œâ”€â”€ æ¨¡å‹é€‰æ‹© (æ–°å¢)
â”‚   â”‚   â”œâ”€â”€ GLM æ¨¡å‹: glm-4 | glm-4.7 | glm-4-flash
â”‚   â”‚   â””â”€â”€ Gemini æ¨¡å‹: gemini-2.0-flash | gemini-2.0-flash-exp
â”‚   â””â”€â”€ æŠ¥å‘Šåç«¯ (æ–°å¢)
â”‚       â”œâ”€â”€ GLM - ä¸­æ–‡ä¼˜åŒ–
â”‚       â”œâ”€â”€ Gemini CLI - å¤šæ¨¡æ€
â”‚       â””â”€â”€ Claude CLI - æ·±åº¦åˆ†æ

â”œâ”€ ğŸ’¬ æ•™ç»ƒé£æ ¼ (Persona)
â”‚   â”œâ”€â”€ æ¸©æš–é™ªä¼´ (warm) - é»˜è®¤
â”‚   â”œâ”€â”€ ä¸“ä¸šç†æ€§ (standard)
â”‚   â””â”€â”€ æ¯’èˆŒæ¿€åŠ± (roast)

â”œâ”€ ğŸ”” æ¨é€é€šçŸ¥
â”‚   â”œâ”€â”€ å¯ç”¨æ¨é€: on/off
â”‚   â”œâ”€â”€ æ¨é€æ—¶é—´: HH:MM
â”‚   â””â”€â”€ å…æ‰“æ‰°æ—¶æ®µ: start - end

â”œâ”€ ğŸ¨ å¤–è§‚ (æ–°å¢)
â”‚   â”œâ”€â”€ ä¸»é¢˜: æš—è‰² | äº®è‰² | è·Ÿéšç³»ç»Ÿ
â”‚   â””â”€â”€ è¯­è¨€: ç®€ä½“ä¸­æ–‡ | English

â””â”€ ğŸ” è´¦æˆ·å®‰å…¨
    â”œâ”€â”€ ä¿®æ”¹å¯†ç 
    â”œâ”€â”€ å¯¼å‡ºæ•°æ®
    â””â”€â”€ æ³¨é”€è´¦å·
```

### 7.4 æ•°æ®æ¨¡å‹æ‰©å±•

**æ–°å¢å­—æ®µ (fortune_user_preferences è¡¨)**:

```sql
-- å‘½ç†æ¨¡å¼åå¥½
preferred_fortune_mode TEXT DEFAULT 'bazi'
  CHECK (preferred_fortune_mode IN ('bazi', 'ziwei', 'astro'));

-- AI å¼•æ“é€‰é¡¹
glm_model TEXT DEFAULT 'glm-4.7';
gemini_model TEXT DEFAULT 'gemini-2.0-flash';
report_backend TEXT DEFAULT 'glm'
  CHECK (report_backend IN ('glm', 'gemini', 'claude'));

-- å¤–è§‚
theme TEXT DEFAULT 'dark'
  CHECK (theme IN ('dark', 'light', 'system'));
locale TEXT DEFAULT 'zh-CN';
```

**å®Œæ•´åå¥½ Schema**:

```python
class UserPreferences(BaseModel):
    # ç°æœ‰
    persona_style: Literal['standard', 'warm', 'roast'] = 'warm'
    push_enabled: bool = True
    push_time: str = '08:00:00'
    quiet_hours_start: str = '22:00:00'
    quiet_hours_end: str = '07:00:00'
    chat_backend: Literal['fastapi', 'agent_service'] = 'agent_service'

    # æ–°å¢ - AI å¼•æ“
    preferred_fortune_mode: Literal['bazi', 'ziwei', 'astro'] = 'bazi'
    glm_model: str = 'glm-4.7'
    gemini_model: str = 'gemini-2.0-flash'
    report_backend: Literal['glm', 'gemini', 'claude'] = 'glm'

    # æ–°å¢ - å¤–è§‚
    theme: Literal['dark', 'light', 'system'] = 'dark'
    locale: str = 'zh-CN'
```

### 7.5 å‰ç«¯é¡µé¢è®¾è®¡ (Notion é£æ ¼)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Settings                                              [ä¿å­˜æ›´æ”¹]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“‹ ä¸ªäººèµ„æ–™                                            [å±•å¼€ â–¼] â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”                                                        â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ‘¤  â”‚  Alice                                                 â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜  alice@example.com                                     â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  æ˜µç§°        [Alice_____________]                               â”‚   â”‚
â”‚  â”‚  æ€§åˆ«        â—‹ ç”·  â— å¥³                                         â”‚   â”‚
â”‚  â”‚  å‡ºç”Ÿæ—¥æœŸ    [1990-01-15] [12:00]                               â”‚   â”‚
â”‚  â”‚  å‡ºç”Ÿåœ°ç‚¹    [åŒ—äº¬________] (116.4, 39.9)                       â”‚   â”‚
â”‚  â”‚  å‘½ç†æ¨¡å¼    â—‰ å…«å­—  â—‹ ç´«å¾®  â—‹ æ˜Ÿåº§                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ¤– AI å¼•æ“                                             [å±•å¼€ â–¼] â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  å¯¹è¯åç«¯                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ â—‰ Vercel Agent          â”‚ â—‹ GLM ç›´è¿                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   å¤šåŠŸèƒ½ Â· å·¥å…·è°ƒç”¨      â”‚   ä½å»¶è¿Ÿ Â· ç®€å•å¯¹è¯           â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  GLM æ¨¡å‹     [glm-4.7 â–¾]                                       â”‚   â”‚
â”‚  â”‚               glm-4 Â· glm-4.7 Â· glm-4-flash                     â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  Gemini æ¨¡å‹  [gemini-2.0-flash â–¾]                              â”‚   â”‚
â”‚  â”‚               ç”¨äºæµ·æŠ¥ç”Ÿæˆå’Œå¤šæ¨¡æ€ä»»åŠ¡                          â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  æŠ¥å‘Šåç«¯     [GLM â–¾]                                           â”‚   â”‚
â”‚  â”‚               GLM Â· Gemini CLI Â· Claude CLI                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ’¬ æ•™ç»ƒé£æ ¼                                            [å±•å¼€ â–¼] â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â—‹ ä¸“ä¸šç†æ€§ standard     å®¢è§‚åˆ†æï¼Œç†æ€§å»ºè®®                     â”‚   â”‚
â”‚  â”‚  â— æ¸©æš–é™ªä¼´ warm         å…±æƒ…é™ªä¼´ï¼Œæ¸©å’Œé¼“åŠ±                     â”‚   â”‚
â”‚  â”‚  â—‹ æ¯’èˆŒæ¿€åŠ± roast        çŠ€åˆ©åæ§½ï¼Œåå‘æ¿€åŠ±                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”” æ¨é€é€šçŸ¥                                            [å±•å¼€ â–¼] â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  å¯ç”¨æ¨é€    [â—â”â”â”â”â”â”â”â—‹]                                        â”‚   â”‚
â”‚  â”‚  æ¨é€æ—¶é—´    [08:00 â–¾]                                          â”‚   â”‚
â”‚  â”‚  å…æ‰“æ‰°      [22:00] - [07:00]                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ¨ å¤–è§‚                                                [å±•å¼€ â–¼] â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  ä¸»é¢˜        â—‰ æš—è‰²  â—‹ äº®è‰²  â—‹ è·Ÿéšç³»ç»Ÿ                         â”‚   â”‚
â”‚  â”‚  è¯­è¨€        [ç®€ä½“ä¸­æ–‡ â–¾]                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ” è´¦æˆ·å®‰å…¨                                            [å±•å¼€ â–¼] â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  [ä¿®æ”¹å¯†ç ]   [å¯¼å‡ºæ•°æ®]   [æ³¨é”€è´¦å·]                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.6 API è®¾è®¡

#### 7.6.1 æ‰©å±•åå¥½è®¾ç½® API

```python
# api/user_routes.py æ‰©å±•

class ExtendedPreferencesRequest(BaseModel):
    # ç°æœ‰å­—æ®µ
    persona_style: Optional[Literal['standard', 'warm', 'roast']] = None
    push_enabled: Optional[bool] = None
    push_time: Optional[str] = None
    quiet_hours_start: Optional[str] = None
    quiet_hours_end: Optional[str] = None
    chat_backend: Optional[Literal['fastapi', 'agent_service']] = None

    # æ–°å¢å­—æ®µ
    preferred_fortune_mode: Optional[Literal['bazi', 'ziwei', 'astro']] = None
    glm_model: Optional[str] = None
    gemini_model: Optional[str] = None
    report_backend: Optional[Literal['glm', 'gemini', 'claude']] = None
    theme: Optional[Literal['dark', 'light', 'system']] = None
    locale: Optional[str] = None
```

#### 7.6.2 åŠ¨æ€é…ç½®é€‰é¡¹ API

```python
@router.get("/settings/options")
def get_setting_options():
    """è¿”å›å¯é€‰çš„æ¨¡å‹åˆ—è¡¨ç­‰åŠ¨æ€é…ç½®"""
    return {
        "glm_models": [
            {"value": "glm-4", "label": "GLM-4", "desc": "åŸºç¡€ç‰ˆ"},
            {"value": "glm-4.7", "label": "GLM-4.7", "desc": "æ¨è"},
            {"value": "glm-4-flash", "label": "GLM-4-Flash", "desc": "å¿«é€Ÿç‰ˆ"},
        ],
        "gemini_models": [
            {"value": "gemini-2.0-flash", "label": "Gemini 2.0 Flash", "desc": "æ ‡å‡†"},
            {"value": "gemini-2.0-flash-exp", "label": "Gemini 2.0 Flash Exp", "desc": "å®éªŒç‰ˆ"},
        ],
        "report_backends": [
            {"value": "glm", "label": "GLM", "desc": "ä¸­æ–‡ä¼˜åŒ–ï¼Œæ¨è"},
            {"value": "gemini", "label": "Gemini CLI", "desc": "å¤šæ¨¡æ€æ”¯æŒ"},
            {"value": "claude", "label": "Claude CLI", "desc": "æ·±åº¦åˆ†æ"},
        ],
        "chat_backends": [
            {"value": "agent_service", "label": "Vercel Agent", "desc": "å¤šåŠŸèƒ½Â·å·¥å…·è°ƒç”¨"},
            {"value": "fastapi", "label": "GLM ç›´è¿", "desc": "ä½å»¶è¿ŸÂ·ç®€å•å¯¹è¯"},
        ],
        "persona_styles": [
            {"value": "standard", "label": "ä¸“ä¸šç†æ€§", "desc": "å®¢è§‚åˆ†æï¼Œç†æ€§å»ºè®®"},
            {"value": "warm", "label": "æ¸©æš–é™ªä¼´", "desc": "å…±æƒ…é™ªä¼´ï¼Œæ¸©å’Œé¼“åŠ±"},
            {"value": "roast", "label": "æ¯’èˆŒæ¿€åŠ±", "desc": "çŠ€åˆ©åæ§½ï¼Œåå‘æ¿€åŠ±"},
        ],
        "fortune_modes": [
            {"value": "bazi", "label": "å…«å­—", "desc": "å››æŸ±å‘½ç†"},
            {"value": "ziwei", "label": "ç´«å¾®", "desc": "ç´«å¾®æ–—æ•°"},
            {"value": "astro", "label": "æ˜Ÿåº§", "desc": "è¥¿æ–¹å æ˜Ÿ"},
        ],
        "themes": [
            {"value": "dark", "label": "æš—è‰²"},
            {"value": "light", "label": "äº®è‰²"},
            {"value": "system", "label": "è·Ÿéšç³»ç»Ÿ"},
        ],
        "locales": [
            {"value": "zh-CN", "label": "ç®€ä½“ä¸­æ–‡"},
            {"value": "en-US", "label": "English"},
        ],
    }
```

### 7.7 å‰ç«¯ç»„ä»¶ç»“æ„

```
web-app/src/
â”œâ”€â”€ app/settings/
â”‚   â””â”€â”€ page.tsx              # è®¾ç½®ä¸»é¡µé¢
â”œâ”€â”€ components/settings/
â”‚   â”œâ”€â”€ settings-section.tsx  # å¯æŠ˜å åŒºå—å®¹å™¨
â”‚   â”œâ”€â”€ profile-section.tsx   # ä¸ªäººèµ„æ–™åŒºå—
â”‚   â”œâ”€â”€ ai-engine-section.tsx # AI å¼•æ“é…ç½®åŒºå—
â”‚   â”œâ”€â”€ persona-section.tsx   # æ•™ç»ƒé£æ ¼åŒºå—
â”‚   â”œâ”€â”€ push-section.tsx      # æ¨é€é€šçŸ¥åŒºå—
â”‚   â”œâ”€â”€ appearance-section.tsx# å¤–è§‚è®¾ç½®åŒºå—
â”‚   â””â”€â”€ security-section.tsx  # è´¦æˆ·å®‰å…¨åŒºå—
â””â”€â”€ hooks/
    â””â”€â”€ use-settings.ts       # è®¾ç½®çŠ¶æ€ç®¡ç† Hook
```

### 7.8 è®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|-----|------|
| **æ¸è¿›æŠ«éœ²** | é«˜çº§é€‰é¡¹é»˜è®¤æŠ˜å ï¼Œæ™®é€šç”¨æˆ·æ— éœ€å…³å¿ƒ AI å¼•æ“ç»†èŠ‚ |
| **å³æ—¶åé¦ˆ** | åˆ‡æ¢é€‰é¡¹åç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€åˆ·æ–°é¡µé¢ |
| **å®‰å…¨é»˜è®¤** | æ‰€æœ‰é€‰é¡¹éƒ½æœ‰åˆç†é»˜è®¤å€¼ï¼Œç”¨æˆ·å¯ç›´æ¥ä½¿ç”¨ |
| **å¯æ¢å¤æ€§** | æ¯ä¸ªåŒºå—æä¾›"é‡ç½®ä¸ºé»˜è®¤"é€‰é¡¹ |
| **ä¸€è‡´æ€§** | ä¸ç°æœ‰æš—è‰²ä¸»é¢˜ (#07070b) + é‡‘è‰²ç‚¹ç¼€ (#f6c453) ä¿æŒä¸€è‡´ |
| **å“åº”å¼** | ç§»åŠ¨ç«¯æŠ˜å ä¸ºå•åˆ—ï¼Œä¿æŒå¯ç”¨æ€§ |

### 7.9 å…³é”®æ–‡ä»¶æ”¹åŠ¨

| æ–‡ä»¶ | æ”¹åŠ¨å†…å®¹ |
|------|----------|
| `api/user_routes.py` | æ‰©å±• PreferencesUpdateRequest + æ–°å¢ /settings/options |
| `stores/fortune_db.py` | æ–°å¢å­—æ®µæŸ¥è¯¢æ”¯æŒ |
| `migrations/` | æ–°å¢ fortune_user_preferences å­—æ®µè¿ç§» |
| `web-app/src/app/settings/` | æ–°å¢è®¾ç½®é¡µé¢ |
| `web-app/src/components/settings/` | æ–°å¢è®¾ç½®ç»„ä»¶é›† |

---

## å…«ã€æŠ€æœ¯å®ç°è¦ç‚¹

### 8.1 API è®¾è®¡æ¦‚è§ˆï¼ˆv4 æ›´æ–°ï¼‰

| æ¨¡å— | ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|-----|------|------|------|
| **Auth** | `/api/auth/preview` | POST | å‘½ç›˜é¢„è§ˆï¼ˆå…«å­—/ç´«å¾®/æ˜Ÿåº§ï¼‰ |
| | `/api/auth/validation-points` | POST | ç”Ÿæˆ3ä¸ªéªŒè¯ç‚¹ (v4æ–°å¢) |
| | `/api/auth/register` | POST | æ³¨å†Œ |
| | `/api/auth/login` | POST | ç™»å½• |
| **Chat/æ•™ç»ƒ** | `/api/chat/send` | POST | æ•™ç»ƒå¯¹è¯ + A2UI |
| | `/api/chat/stream` | GET | æµå¼å¯¹è¯ (SSE) |
| **æŠ¥å‘Š** | `/api/report/bazi/submit` | POST | å¼‚æ­¥ç”Ÿæˆå…«å­—æŠ¥å‘Š |
| | `/api/report/bazi/{job_id}` | GET | è·å–æŠ¥å‘ŠçŠ¶æ€/ç»“æœ |
| | `/api/report/bazi/deep/submit` | POST | åŒæ­¥æ·±åº¦æŠ¥å‘Š (GLM) |
| **Kçº¿** | `/api/dashboard/overview` | GET | ä»ªè¡¨ç›˜æ¦‚è§ˆï¼ˆå«StateScoreï¼‰ |
| | `/api/dashboard/kline` | GET | Kçº¿å†å²æ•°æ® (v4æ–°å¢) |
| | `/api/dashboard/trends` | GET | è¶‹åŠ¿+äº‹ä»¶ (å·²æœ‰) |
| **æµ·æŠ¥** | `/api/poster/generate` | POST | ç”Ÿæˆæµ·æŠ¥ (v4æ–°å¢) |
| | `/api/poster/{job_id}` | GET | æµ·æŠ¥çŠ¶æ€ (v4æ–°å¢) |
| **åˆç›˜** | `/api/pairing/invite` | POST | ç”Ÿæˆåˆç›˜é‚€è¯· |
| | `/api/pairing/accept/{code}` | POST | æ¥å—åˆç›˜é‚€è¯· |
| | `/api/pairing/{id}` | GET | è·å–åˆç›˜ç»“æœ |

### 8.2 å…³é”®æ–‡ä»¶æ¸…å•ï¼ˆv4 æ›´æ–°ï¼‰

#### éœ€è¦ä¿®æ”¹
| æ–‡ä»¶ | æ”¹åŠ¨å†…å®¹ |
|------|----------|
| `api/templates/auth.html` | Tabç»“æ„ + éªŒè¯ç‚¹ + å†…åµŒæ³¨å†Œç™»å½• |
| `api/static/auth.js` | Tabåˆ‡æ¢ + éªŒè¯ç‚¹API + è¡¨å•è”åŠ¨ |
| `api/auth_routes.py` | æ–°å¢éªŒè¯ç‚¹API + æ‰©å±•preview |
| `services/bazi_report_service.py` | 6ç« ç»“æ„ + facts_hash + å¤„æ–¹ä¼˜åŒ– |
| `api/dashboard_routes.py` | Kçº¿ç«¯ç‚¹ + åˆå¹¶æ•°æ® |
| `services/soul_os.py` | OHLCè®¡ç®— + Kçº¿å†å² |
| `web-app/.../dashboard/` | åˆå¹¶status+trends Tab |

#### éœ€è¦æ–°å¢
| æ–‡ä»¶ | å†…å®¹ |
|------|------|
| `services/poster_service.py` | æµ·æŠ¥ç”ŸæˆæœåŠ¡ |
| `api/poster_routes.py` | æµ·æŠ¥APIè·¯ç”± |
| `services/validation_service.py` | éªŒè¯ç‚¹ç”Ÿæˆé€»è¾‘ |
| `web-app/.../kline/` | Kçº¿èœ¡çƒ›å›¾ç»„ä»¶ |

---

## ä¹ã€å®æ–½è·¯çº¿å›¾ï¼ˆv4 æ›´æ–°ï¼‰

### Phase 1: Loginé¡µé¢é‡æ„ (P0)
- [ ] auth.html æ·»åŠ Tabç»“æ„ï¼ˆå…«å­—/ç´«å¾®/æ˜Ÿåº§ï¼‰
- [ ] auth.js Tabåˆ‡æ¢é€»è¾‘
- [ ] auth_routes.py éªŒè¯ç‚¹API
- [ ] SVGå‘½ç›˜å›¾ç¤ºå ä½
- [ ] å†…åµŒæ³¨å†Œ/ç™»å½•è¡¨å•ï¼ˆéå¼¹çª—ï¼‰

### Phase 2: æ·±åº¦å…«å­—æŠ¥å‘Š (P0)
- [ ] bazi_report_service.py promptä¼˜åŒ–
- [ ] 6ç« ç»“æ„è¾“å‡º
- [ ] facts_hash/å¤„æ–¹/é£é™©è¾¹ç•Œ

### Phase 3: å¯¹è¯ç³»ç»Ÿä¼˜åŒ– (P1)
- [ ] A2UIè¾“å‡ºä¼˜åŒ–
- [ ] éªŒè¯ç‚¹ä¸å¯¹è¯è”åŠ¨

### Phase 4: æµ·æŠ¥ç”Ÿæˆ (P1)
- [ ] poster_service.py æ–°å»º
- [ ] poster_routes.py æ–°å»º
- [ ] gemini_create_job å›¾ç‰‡æ¨¡å‹è°ƒç”¨
- [ ] å‰ç«¯æµ·æŠ¥é¢„è§ˆç»„ä»¶

### Phase 5: Kçº¿ç³»ç»Ÿ (P2)
- [ ] dashboard_routes.py klineç«¯ç‚¹
- [ ] soul_os.py OHLCè®¡ç®—
- [ ] å‰ç«¯Kçº¿èœ¡çƒ›å›¾ç»„ä»¶

### Phase 6: Tabåˆå¹¶ (P2)
- [ ] åˆå¹¶status-tab + trends-tab
- [ ] ç»Ÿä¸€ä»ªè¡¨ç›˜è§†å›¾
- [ ] ä¼˜åŒ–æ•°æ®åŠ è½½

### Phase 7: Settings é¡µé¢ (P2)
- [ ] migrations/ æ–°å¢ fortune_user_preferences å­—æ®µ
- [ ] api/user_routes.py æ‰©å±•åå¥½è®¾ç½® API
- [ ] api/user_routes.py æ–°å¢ /settings/options ç«¯ç‚¹
- [ ] web-app/src/app/settings/page.tsx è®¾ç½®ä¸»é¡µé¢
- [ ] web-app/src/components/settings/ è®¾ç½®ç»„ä»¶é›†
- [ ] web-app/src/hooks/use-settings.ts çŠ¶æ€ç®¡ç†

---

## åã€ç‰ˆæœ¬å˜æ›´æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¸»è¦å˜æ›´ |
|-----|------|---------|
| v1.0 | 2026-01-01 | åˆç‰ˆï¼ˆCodexï¼‰ï¼Œå®Œæ•´æ¶æ„ä¸æ²»ç†è§„åˆ™ |
| v2.0 | 2026-01-01 | æ‰‹å·¥ç²¾ç®€ç‰ˆï¼Œæ–°å¢åœ°ç‚¹é»˜è®¤åŒ—äº¬ã€å¤šæ¨¡å—å¯é€‰ã€Geminiæµ·æŠ¥ |
| v3.0 | 2026-01-01 | åˆå¹¶ç‰ˆæœ¬ï¼šä¿ç•™v1æ²»ç†è§„åˆ™ï¼Œèå…¥v2å®ç”¨æ”¹è¿› |
| v4.0 | 2026-01-01 | å®æ–½ç»†åŒ–ç‰ˆï¼šLoginé¡µé¢è®¾è®¡ã€æµ·æŠ¥æŠ€æœ¯æ–¹æ¡ˆã€Kçº¿å¢å¼ºã€ä¼˜å…ˆçº§æ’åº |
| v4.1 | 2026-01-01 | Settingsæ¨¡å—ï¼šProfile + AIå¼•æ“ + å¤–è§‚è®¾ç½® |

**v4.0 æ–°å¢è¦ç‚¹**ï¼š
- âœ… Loginé¡µé¢è¯¦ç»†å¸ƒå±€è®¾è®¡ï¼ˆå…«å­—/ç´«å¾®/æ˜Ÿåº§ Tabï¼‰
- âœ… éªŒè¯ç‚¹ç”ŸæˆAPIè®¾è®¡
- âœ… éªŒè¯ç‚¹ä¸æ³¨å†Œ/ç™»å½•åŒæ—¶æ˜¾ç¤ºï¼ˆéå¼¹çª—ï¼‰
- âœ… æµ·æŠ¥ç”ŸæˆæŠ€æœ¯æ–¹æ¡ˆï¼ˆgemini_create_job å›¾ç‰‡æ¨¡å‹ï¼‰
- âœ… Kçº¿èœ¡çƒ›å›¾æ•°æ®ç»“æ„ä¸API
- âœ… å‰ç«¯Tabåˆå¹¶è®¾è®¡ï¼ˆçŠ¶æ€+è¶‹åŠ¿ï¼‰
- âœ… å®æ–½ä¼˜å…ˆçº§æ’åºï¼ˆP0/P1/P2ï¼‰
- âœ… å…³é”®æ–‡ä»¶æ”¹åŠ¨æ¸…å•

**v4.1 æ–°å¢è¦ç‚¹**ï¼š
- âœ… Settings æ¨¡å—å®Œæ•´è®¾è®¡ï¼ˆç¬¬ä¸ƒç« ï¼‰
- âœ… ç”¨æˆ·åå¥½æ•°æ®æ¨¡å‹æ‰©å±•ï¼ˆpreferred_fortune_mode, glm_model, gemini_model, report_backend, theme, localeï¼‰
- âœ… åŠ¨æ€é…ç½®é€‰é¡¹ APIï¼ˆ/settings/optionsï¼‰
- âœ… Notion é£æ ¼å‰ç«¯é¡µé¢è®¾è®¡ï¼ˆå¯æŠ˜å åŒºå—ï¼‰
- âœ… å‰ç«¯ç»„ä»¶ç»“æ„è§„åˆ’
- âœ… è®¾è®¡åŸåˆ™ï¼ˆæ¸è¿›æŠ«éœ²ã€å³æ—¶åé¦ˆã€å®‰å…¨é»˜è®¤ã€å¯æ¢å¤æ€§ã€ä¸€è‡´æ€§ã€å“åº”å¼ï¼‰

---

*æ–‡æ¡£ç‰ˆæœ¬: v4.1*
*æ›´æ–°æ—¥æœŸ: 2026-01-01*
