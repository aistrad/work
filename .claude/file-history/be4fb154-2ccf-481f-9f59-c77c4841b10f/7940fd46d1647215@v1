# User Profile Save Rules

> LLM reference guide - how to decide what to save to user profile

## When to Save

Save when user **proactively provides** the following information:

| User Says | Save Path | Example Data |
|-----------|-----------|--------------|
| "I'm a designer" | vibe.profile.context.occupation | "Designer" |
| "I'm feeling anxious" | vibe.state.emotion | "anxious" |
| "My goal is..." | vibe.goals | {title, category, status: "active"} |
| "I'm interested in AI" | vibe.profile.context.interests | ["AI"] |
| "I just got promoted" | vibe.timeline | {date, type: "milestone", event: "..."} |

## Save Process

1. **Identify Information Type**: Is it a stable trait or temporary state?
   - Stable traits → `vibe.profile.*`
   - Current state → `vibe.state.*`
   - Goals → `vibe.goals`
   - Important events → `vibe.timeline`

2. **Read Existing Data** (required for merge): `read(path="vibe.xxx")`

3. **Decide Merge Strategy**:
   - Single value fields (emotion): Direct overwrite
   - Array fields (goals, traits): Append or update
   - Timeline: Always append (never overwrite)

4. **Write Data**: `save(path, merged_data)`

## Do NOT Save

- **Third-party information**: "Help my friend calculate" → Save nothing
- **Hypothetical questions**: "If I were..." → Save nothing
- **Temporary tests**: "Let me try" → Save nothing
- **System-generated insights**: Only save user-provided info

## Path Reference

### Profile (Stable - changes slowly)
```
vibe.profile.identity.archetypes  # ["Explorer", "Creator"] max 3
vibe.profile.identity.traits      # ["analytical", "curious"] max 5
vibe.profile.identity.style       # "direct" | "warm" | "rational" | "emotional"
vibe.profile.context.occupation   # "Product Designer"
vibe.profile.context.life_stage   # "early_career" | "growth" | "peak" | "transition"
vibe.profile.context.interests    # ["AI", "travel"] max 10
```

### State (Current - changes frequently)
```
vibe.state.emotion  # "anxious" | "sad" | "neutral" | "content" | "excited" | "focused"
vibe.state.energy   # "low" | "medium" | "high"
vibe.state.focus    # ["career transition"] max 3
```

### Goals (Merge by title)
```
vibe.goals  # [{title, category, status}] max 10

categories: career | health | relationship | wealth | growth
status: active | paused | completed
```

### Timeline (Append only)
```
vibe.timeline  # [{date, type, event}] max 100

types: goal | decision | milestone | life_event
```

## Examples

### Example 1: User shares occupation
User: "I'm a software engineer at a startup"

```python
# 1. Read current data
current = read(path="vibe.profile.context")

# 2. Save occupation
save(path="vibe.profile.context.occupation", data="Software Engineer")
```

### Example 2: User expresses current emotion
User: "I'm really stressed about the deadline"

```python
# Direct overwrite for state
save(path="vibe.state.emotion", data="anxious")
save(path="vibe.state.focus", data=["work deadline"])
```

### Example 3: User sets a goal
User: "This year I want to learn Japanese"

```python
# 1. Read existing goals
current = read(path="vibe.goals")

# 2. Add new goal
new_goal = {
    "title": "Learn Japanese",
    "category": "growth",
    "status": "active"
}

# 3. Merge and save
if current.data:
    # Check for duplicates by title
    existing_titles = [g["title"] for g in current.data]
    if new_goal["title"] not in existing_titles:
        merged = current.data + [new_goal]
        save(path="vibe.goals", data=merged)
else:
    save(path="vibe.goals", data=[new_goal])
```

### Example 4: Important life event
User: "I accepted a new job offer yesterday"

```python
# Timeline is append-only
save(
    path="vibe.timeline",
    data={
        "date": "2026-01-25",  # yesterday
        "type": "milestone",
        "event": "Accepted new job offer"
    }
)
```

## Merge Rules Summary

| Path Pattern | Strategy | Notes |
|--------------|----------|-------|
| `vibe.profile.*` | Merge | Keep existing, update changed |
| `vibe.state.*` | Overwrite | Current state, direct replace |
| `vibe.goals` | Merge by title | Dedupe by title field |
| `vibe.timeline` | Append | Never modify existing events |
