/**
 * ZodiacTransitCard - å¤©è±¡æ¨è¿å¡ç‰‡
 *
 * ä» show-transit.tsx æå–çš„çº¯æ¸²æŸ“ç»„ä»¶
 * é€šè¿‡ CardRegistry æ³¨å†Œï¼Œç”± card_type: "zodiac_transit" è§¦å‘
 */

"use client";

import { registerCard } from "@/skills/CardRegistry";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Types
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface Transit {
  planet: string;
  sign: string;
  aspect: string;
  natalPlanet: string;
  influence: "positive" | "neutral" | "challenging";
  description: string;
  startDate: string;
  endDate: string;
  isActive: boolean;
}

interface MajorEvent {
  event: string;
  date: string;
  description: string;
}

interface ZodiacTransitData {
  date?: string;
  transits?: Transit[];
  majorEvents?: MajorEvent[];
  major_events?: MajorEvent[];
  overallEnergy?: string;
  overall_energy?: string;
  advice?: string;
}

interface ZodiacTransitCardProps {
  data: ZodiacTransitData;
  cardProps?: Record<string, unknown>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Helpers
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getInfluenceStyle(influence: string): string {
  const styles: Record<string, string> = {
    positive: "bg-green-100/50 dark:bg-green-900/20 text-green-800 dark:text-green-200",
    neutral: "bg-slate-100/50 dark:bg-slate-800/50 text-slate-800 dark:text-slate-200",
    challenging: "bg-orange-100/50 dark:bg-orange-900/20 text-orange-800 dark:text-orange-200",
  };
  return styles[influence] || styles.neutral;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Component
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function ZodiacTransitCard({ data }: ZodiacTransitCardProps) {
  // å…¼å®¹ snake_case å’Œ camelCase
  const transits = data.transits || [];
  const majorEvents = data.majorEvents || data.major_events || [];
  const overallEnergy = data.overallEnergy || data.overall_energy || "";
  const advice = data.advice || "";
  const date = data.date || "";

  const activeTransits = transits.filter((t) => t.isActive);

  return (
    <div className="transit-card bg-gradient-to-br from-violet-50 to-fuchsia-50 dark:from-violet-950/30 dark:to-fuchsia-950/30 rounded-xl border border-violet-200 dark:border-violet-800 p-4 my-2 animate-fade-in">
      {/* Header */}
      <div className="flex items-center justify-between mb-4">
        <h3 className="text-lg font-semibold text-violet-900 dark:text-violet-100 flex items-center gap-2">
          <span>ğŸ”®</span>
          <span>å¤©è±¡æ¨è¿</span>
        </h3>
        <span className="text-sm text-violet-700 dark:text-violet-300">{date}</span>
      </div>

      {/* Overall Energy */}
      {overallEnergy && (
        <div className="bg-white/60 dark:bg-black/30 rounded-lg p-3 mb-4">
          <div className="text-sm font-medium mb-1">æ•´ä½“èƒ½é‡</div>
          <p className="text-sm text-muted-foreground">{overallEnergy}</p>
        </div>
      )}

      {/* Active Transits */}
      {activeTransits.length > 0 && (
        <div className="mb-4">
          <div className="text-sm font-medium mb-2">å½“å‰è¡Œæ˜Ÿè¿‡å¢ƒ</div>
          <div className="space-y-2">
            {activeTransits.slice(0, 5).map((transit, index) => (
              <div
                key={index}
                className={`p-2 rounded-lg text-sm ${getInfluenceStyle(transit.influence)}`}
              >
                <div className="flex items-center justify-between">
                  <span className="font-medium">
                    {transit.planet} {transit.aspect} {transit.natalPlanet}
                  </span>
                  <span className="text-xs opacity-70">è‡³ {transit.endDate}</span>
                </div>
                <p className="text-xs mt-1 opacity-80">{transit.description}</p>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Major Events */}
      {majorEvents.length > 0 && (
        <div className="mb-4">
          <div className="text-sm font-medium mb-2">é‡è¦å¤©è±¡</div>
          <div className="space-y-1">
            {majorEvents.map((event, index) => (
              <div
                key={index}
                className="flex items-center gap-2 text-sm bg-violet-100/50 dark:bg-violet-900/20 rounded p-2"
              >
                <span className="text-violet-600">â˜…</span>
                <span>{event.event}</span>
                <span className="text-xs text-muted-foreground ml-auto">{event.date}</span>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Advice */}
      {advice && (
        <div className="bg-gradient-to-r from-violet-100 to-fuchsia-100 dark:from-violet-900/30 dark:to-fuchsia-900/30 rounded-lg p-3">
          <div className="text-sm font-medium mb-1">å»ºè®®</div>
          <p className="text-sm text-muted-foreground">{advice}</p>
        </div>
      )}
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Register to CardRegistry
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

registerCard("zodiac_transit", ZodiacTransitCard);

export default ZodiacTransitCard;
