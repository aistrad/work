"use client";

import { cn } from "@/lib/utils";
import { Bookmark, Share2, Sparkles, RefreshCw, Clock, Sprout } from "lucide-react";
import { InsightSeal, SealBadge, type InsightType } from "@/components/core";

// ═══════════════════════════════════════════════════════════════════════════
// InsightCard - LUMINOUS PAPER Design System
// 洞察卡片：带 Insight Seal 印章系统
// ═══════════════════════════════════════════════════════════════════════════

export type { InsightType };

export interface InsightCardProps {
  type: InsightType;
  title: string;
  content: string;
  onSave?: () => void;
  onShare?: () => void;
  onDeepDive?: () => void;
  showSeal?: boolean;
  className?: string;
}

const INSIGHT_CONFIG: Record<InsightType, {
  icon: typeof Sparkles;
  defaultTitle: string;
  borderColor: string;
  glowColor: string;
}> = {
  discovery: {
    icon: Sparkles,
    defaultTitle: "我看见你...",
    borderColor: "border-l-element-water",
    glowColor: "shadow-[0_2px_16px_rgba(58,129,180,0.15)]",
  },
  pattern: {
    icon: RefreshCw,
    defaultTitle: "我注意到一个模式...",
    borderColor: "border-l-zodiac-primary",
    glowColor: "shadow-[0_2px_16px_rgba(60,58,122,0.15)]",
  },
  timing: {
    icon: Clock,
    defaultTitle: "现在是...的好时机",
    borderColor: "border-l-antique-gold",
    glowColor: "shadow-[0_2px_16px_rgba(184,138,68,0.15)]",
  },
  growth: {
    icon: Sprout,
    defaultTitle: "你的成长...",
    borderColor: "border-l-element-wood",
    glowColor: "shadow-[0_2px_16px_rgba(51,128,64,0.15)]",
  },
};

export function InsightCard({
  type,
  title,
  content,
  onSave,
  onShare,
  onDeepDive,
  showSeal = true,
  className,
}: InsightCardProps) {
  const config = INSIGHT_CONFIG[type];
  const Icon = config.icon;

  return (
    <div
      className={cn(
        "insight-card relative animate-scale-in",
        "bg-card rounded-xl border border-border border-l-4",
        "p-5",
        config.borderColor,
        config.glowColor,
        className
      )}
      data-type={type}
    >
      {/* Seal in corner */}
      {showSeal && (
        <div className="absolute top-3 right-3">
          <InsightSeal type={type} size="sm" />
        </div>
      )}

      {/* Header */}
      <div className="flex items-start gap-3 mb-3 pr-12">
        <div className="p-2 rounded-lg bg-muted/50">
          <Icon className="w-5 h-5 text-skill-primary" />
        </div>
        <div className="flex-1">
          <SealBadge type={type} className="mb-1.5">
            {type.toUpperCase()}
          </SealBadge>
          <h3 className="font-serif font-semibold text-foreground">
            {title || config.defaultTitle}
          </h3>
        </div>
      </div>

      {/* Content */}
      <p className="text-muted-foreground whitespace-pre-wrap leading-relaxed">
        {content}
      </p>

      {/* Actions */}
      <div className="flex items-center justify-between mt-4 pt-4 border-t border-border/50">
        {/* Left: Deep dive */}
        {onDeepDive && (
          <button
            onClick={onDeepDive}
            className="text-sm font-medium text-skill-primary hover:underline"
          >
            深入了解
          </button>
        )}

        {/* Right: Save & Share */}
        <div className="flex items-center gap-2 ml-auto">
          {onSave && (
            <button
              onClick={onSave}
              className={cn(
                "inline-flex items-center gap-1.5 px-3 py-1.5",
                "text-sm rounded-full",
                "bg-muted/50 text-muted-foreground",
                "hover:bg-muted hover:text-foreground",
                "transition-colors duration-200"
              )}
            >
              <Bookmark className="w-4 h-4" />
              <span>保存</span>
            </button>
          )}
          {onShare && (
            <button
              onClick={onShare}
              className={cn(
                "inline-flex items-center gap-1.5 px-3 py-1.5",
                "text-sm rounded-full",
                "bg-muted/50 text-muted-foreground",
                "hover:bg-muted hover:text-foreground",
                "transition-colors duration-200"
              )}
            >
              <Share2 className="w-4 h-4" />
              <span>分享</span>
            </button>
          )}
        </div>
      </div>
    </div>
  );
}

// ═══════════════════════════════════════════════════════════════════════════
// MiniInsightCard - Compact version for inline display
// ═══════════════════════════════════════════════════════════════════════════

interface MiniInsightCardProps {
  type: InsightType;
  title: string;
  onClick?: () => void;
  className?: string;
}

export function MiniInsightCard({
  type,
  title,
  onClick,
  className,
}: MiniInsightCardProps) {
  const config = INSIGHT_CONFIG[type];
  const Icon = config.icon;

  return (
    <button
      onClick={onClick}
      className={cn(
        "w-full text-left p-3 rounded-lg animate-fade-in-up",
        "bg-card border border-border border-l-2",
        config.borderColor,
        "hover:shadow-card-hover",
        "transition-all duration-200",
        className
      )}
    >
      <div className="flex items-center gap-2">
        <Icon className="w-4 h-4 text-skill-primary flex-shrink-0" />
        <span className="text-sm font-medium text-foreground truncate">
          {title}
        </span>
      </div>
    </button>
  );
}
