/**
 * DimensionRow - 维度行组件
 *
 * 基于前端规范 v7.1 - Linear 风格
 * 展示单个维度的原型信息
 */

'use client'

import { memo } from 'react'
import { cn } from '@/lib/utils'
import type { ArchetypeType, DimensionId } from '@/types/vibe-id'
import { getArchetypeMeta, DIMENSION_META } from '@/types/vibe-id'
import { ArchetypeBadge } from './ArchetypeBadge'

interface DimensionRowProps {
  dimension: DimensionId
  archetypeId: ArchetypeType
  score?: number
  expanded?: boolean
  className?: string
  onToggle?: () => void
  /** 核心张力描述 (用于 Shadow 维度) */
  tension?: string
  /** 阴影来源 - Core原型 (用于显示对立关系) */
  coreArchetype?: ArchetypeType
}

/**
 * 维度行组件
 * 显示维度信息和对应的原型
 */
export const DimensionRow = memo(function DimensionRow({
  dimension,
  archetypeId,
  score,
  expanded = false,
  className,
  onToggle,
  tension,
  coreArchetype,
}: DimensionRowProps) {
  const dimensionInfo = DIMENSION_META[dimension]
  const archetype = getArchetypeMeta(archetypeId)
  const isShadow = dimension === 'shadow'

  // 获取 Core 原型信息用于显示张力关系
  const coreArchetypeMeta = coreArchetype ? getArchetypeMeta(coreArchetype) : null

  return (
    <div
      className={cn(
        'p-4 rounded-xl',
        'bg-vellum-50 hover:bg-vellum-100 transition-colors',
        onToggle && 'cursor-pointer',
        // Shadow 维度使用特殊的暗色调
        isShadow && 'bg-ink-50/50 hover:bg-ink-100/50',
        className
      )}
      onClick={onToggle}
    >
      <div className="flex items-center gap-4">
        {/* Dimension icon */}
        <span className="text-2xl">{dimensionInfo.icon}</span>

        {/* Dimension info */}
        <div className="flex-1 min-w-0">
          <div className="flex items-center gap-2">
            <span className="font-medium text-ink-800">
              {dimensionInfo.label}
            </span>
            {score !== undefined && (
              <span className="text-xs text-ink-400 bg-ink-100 px-2 py-0.5 rounded-full">
                {Math.round(score)}%
              </span>
            )}
          </div>
          <p className="text-sm text-ink-500 truncate">
            {dimensionInfo.description}
          </p>
        </div>

        {/* Archetype badge */}
        <ArchetypeBadge
          archetypeId={archetypeId}
          size="sm"
          showLabel
        />
      </div>

      {/* Shadow 核心张力展示 */}
      {isShadow && tension && (
        <div className="mt-3 pt-3 border-t border-ink-200/50">
          <div className="flex items-center gap-2 text-sm">
            <span className="text-orange-500">⚡</span>
            <span className="text-ink-600 font-medium">核心张力：</span>
            <span className="text-ink-700">{tension}</span>
          </div>
          {coreArchetypeMeta && (
            <p className="text-xs text-ink-500 mt-1 ml-6">
              {archetype.emoji} {archetype.name} 与 {coreArchetypeMeta.emoji} {coreArchetypeMeta.name} 形成内在张力
            </p>
          )}
        </div>
      )}

      {/* Expanded content */}
      {expanded && (
        <div className="mt-4 pt-4 border-t border-ink-100">
          <p className="text-sm text-ink-600 mb-2">
            {archetype.slogan}
          </p>
          <div className="flex flex-wrap gap-2">
            {archetype.growthPoints.map((point, i) => (
              <span
                key={i}
                className="text-xs bg-mystic-100 text-mystic-700 px-2 py-1 rounded-full"
              >
                {point}
              </span>
            ))}
          </div>
        </div>
      )}
    </div>
  )
})

export default DimensionRow
