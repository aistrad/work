/**
 * DimensionRow - 维度行组件
 *
 * 基于前端规范 v7.1 - Linear 风格
 * 展示单个维度的原型信息
 */

'use client'

import { memo } from 'react'
import { cn } from '@/lib/utils'
import type { ArchetypeType } from '@/types/vibe-id'
import { getArchetypeMeta } from '@/types/vibe-id'
import { ArchetypeBadge } from './ArchetypeBadge'
import { DIMENSION_LABELS, type DimensionId } from '../constants/styles'

interface DimensionRowProps {
  dimension: DimensionId
  archetypeId: ArchetypeType
  score?: number
  expanded?: boolean
  className?: string
  onToggle?: () => void
  /** 核心张力描述 (用于 Shadow 维度) */
  tension?: string
  /** 阴影来源 - Core原型 (用于显示对立关系) */
  coreArchetype?: ArchetypeType
}

/**
 * 维度行组件
 * 显示维度信息和对应的原型
 */
export const DimensionRow = memo(function DimensionRow({
  dimension,
  archetypeId,
  score,
  expanded = false,
  className,
  onToggle,
}: DimensionRowProps) {
  const dimensionInfo = DIMENSION_LABELS[dimension]
  const archetype = getArchetypeMeta(archetypeId)

  return (
    <div
      className={cn(
        'flex items-center gap-4 p-4 rounded-xl',
        'bg-vellum-50 hover:bg-vellum-100 transition-colors',
        onToggle && 'cursor-pointer',
        className
      )}
      onClick={onToggle}
    >
      {/* Dimension icon */}
      <span className="text-2xl">{dimensionInfo.icon}</span>

      {/* Dimension info */}
      <div className="flex-1 min-w-0">
        <div className="flex items-center gap-2">
          <span className="font-medium text-ink-800">
            {dimensionInfo.label}
          </span>
          {score !== undefined && (
            <span className="text-xs text-ink-400 bg-ink-100 px-2 py-0.5 rounded-full">
              {Math.round(score)}%
            </span>
          )}
        </div>
        <p className="text-sm text-ink-500 truncate">
          {dimensionInfo.description}
        </p>
      </div>

      {/* Archetype badge */}
      <ArchetypeBadge
        archetypeId={archetypeId}
        size="sm"
        showLabel
      />

      {/* Expanded content */}
      {expanded && (
        <div className="mt-4 pt-4 border-t border-ink-100">
          <p className="text-sm text-ink-600 mb-2">
            {archetype.slogan}
          </p>
          <div className="flex flex-wrap gap-2">
            {archetype.growthPoints.map((point, i) => (
              <span
                key={i}
                className="text-xs bg-mystic-100 text-mystic-700 px-2 py-1 rounded-full"
              >
                {point}
              </span>
            ))}
          </div>
        </div>
      )}
    </div>
  )
})

export default DimensionRow
