/**
 * SkillIntroCard 类型定义
 */

// ═══════════════════════════════════════════════════════════════════════════
// Feature 相关类型
// ═══════════════════════════════════════════════════════════════════════════

export interface FeatureAction {
  type: 'send_prompt' | 'navigate' | 'expand';
  target?: 'rule' | 'scenario' | 'url';
  id?: string;
  url?: string;
}

export interface SkillFeature {
  name: string;
  description: string;
  icon: string;
  tier: 'free' | 'basic' | 'premium';
  action?: FeatureAction;
  demo_prompt?: string;
}

// ═══════════════════════════════════════════════════════════════════════════
// 设置相关类型
// ═══════════════════════════════════════════════════════════════════════════

export interface SettingOption {
  value: string;
  label: string;
}

export interface SkillSetting {
  key: string;
  name: string;
  type: 'toggle' | 'select' | 'time' | 'number';
  default: unknown;
  description?: string;
  options?: SettingOption[];
  min?: number;
  max?: number;
}

// ═══════════════════════════════════════════════════════════════════════════
// Skill 元数据类型
// ═══════════════════════════════════════════════════════════════════════════

export interface SkillPricing {
  type: 'free' | 'premium' | 'credits';
  trial_messages: number;
  credits_per_use?: number | null;
}

export interface SkillShowcase {
  tagline: string;
  highlights: string[];
  preview_image?: string | null;
  demo_prompts: string[];
}

export interface IntroCardConfig {
  default_sections: SectionType[];
  show_on_first_use: boolean;
  cta_text?: string;
}

export interface SkillMetadata {
  id: string;
  name: string;
  description: string;
  version: string;
  category: 'core' | 'default' | 'professional';
  icon: string;
  color: string;
  triggers: string[];
  pricing: SkillPricing;
  features: SkillFeature[];
  showcase: SkillShowcase;
  settings?: SkillSetting[];
  intro_card?: IntroCardConfig;
}

// ═══════════════════════════════════════════════════════════════════════════
// 用户状态类型
// ═══════════════════════════════════════════════════════════════════════════

export type SubscriptionStatus = 'subscribed' | 'trial' | 'unsubscribed';

export interface UserSubscription {
  skill_id: string;
  status: SubscriptionStatus;
  push_enabled: boolean;
  subscribed_at?: string | null;
  trial_messages_used: number;
  trial_messages_remaining: number | null;
}

export interface UserSkillSettings {
  skill_id: string;
  voice_mode?: 'warm' | 'sarcastic' | 'wise';
  reminder_hour?: number;
  custom_settings?: Record<string, unknown>;
}

// ═══════════════════════════════════════════════════════════════════════════
// 组件 Props 类型
// ═══════════════════════════════════════════════════════════════════════════

export type SectionType = 'header' | 'features' | 'quickstart' | 'pricing' | 'settings';

export type IntroCardVariant = 'full' | 'compact' | 'mini';

export type IntroCardAction =
  | { type: 'send_prompt'; prompt: string }
  | { type: 'navigate'; target: 'rule' | 'scenario'; id: string }
  | { type: 'subscribe'; skillId: string }
  | { type: 'unsubscribe'; skillId: string }
  | { type: 'toggle_setting'; key: string; value: unknown }
  | { type: 'expand_feature'; featureId: string }
  | { type: 'dismiss' };

export interface SkillIntroCardProps {
  /** Skill ID */
  skillId: string;

  /** 变体: full | compact | mini */
  variant?: IntroCardVariant;

  /** 要显示的 sections (覆盖默认配置) */
  sections?: SectionType[];

  /** 是否可关闭 */
  dismissible?: boolean;

  /** Action 回调 */
  onAction?: (action: IntroCardAction) => void;

  /** 自定义样式 */
  className?: string;

  /** 预加载的数据 (避免重复请求) */
  initialData?: SkillIntroData;

  /** 展示原因 */
  reason?: string;
}

export interface SkillIntroData {
  skill: SkillMetadata;
  subscription: UserSubscription | null;
  settings: UserSkillSettings | null;
  is_first_use: boolean;
}

// ═══════════════════════════════════════════════════════════════════════════
// 子组件 Props 类型
// ═══════════════════════════════════════════════════════════════════════════

export interface HeaderProps {
  skill: SkillMetadata;
  subscription: UserSubscription | null;
  variant: IntroCardVariant;
}

export interface FeatureListProps {
  features: SkillFeature[];
  variant: IntroCardVariant;
  onFeatureClick?: (feature: SkillFeature) => void;
  onTryClick?: (feature: SkillFeature) => void;
}

export interface FeatureItemProps {
  feature: SkillFeature;
  expanded?: boolean;
  onExpand?: () => void;
  onTryClick?: () => void;
}

export interface QuickStartProps {
  prompts: string[];
  onPromptClick?: (prompt: string) => void;
}

export interface PricingSectionProps {
  pricing: SkillPricing;
  subscription: UserSubscription | null;
  skillId: string;
  ctaText?: string;
  onSubscribe?: () => void;
  onManage?: () => void;
}

export interface SettingsSectionProps {
  settings: SkillSetting[];
  userSettings: UserSkillSettings | null;
  subscription: UserSubscription | null;
  onSettingChange?: (key: string, value: unknown) => void;
}

export interface StatusBadgeProps {
  status: SubscriptionStatus;
  trialRemaining?: number | null;
}
