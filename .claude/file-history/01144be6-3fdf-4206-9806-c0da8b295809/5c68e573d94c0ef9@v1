# Fortune AI Admin System è®¾è®¡ (The Cockpit)

**ç‰ˆæœ¬**ï¼šv4.2ï¼ˆ2026-01-01ï¼ŒVercel AI SDK Editionï¼‰
**æ–‡æ¡£ç±»å‹**ï¼šAdmin System Design
**å®šä½**ï¼šSoul OS åå°ç®¡ç†ç³»ç»Ÿ â€” é©¾é©¶èˆ±ï¼ˆCockpitï¼‰
**æ ¸å¿ƒæ¶æ„**ï¼šNext.js App Router + shadcn/ui + TanStack Table + Monaco Editor
**å…¥å£**ï¼š`/admin`ï¼ˆéœ€ Admin è§’è‰²é‰´æƒï¼‰

---

## 0. è®¾è®¡ç†å¿µ

### 0.1 æ ¸å¿ƒåŸåˆ™

Admin ç³»ç»Ÿå¦‚åŒé£æœºé©¾é©¶èˆ±ï¼š**å…³é”®ä¿¡æ¯ä¸€ç›®äº†ç„¶ï¼Œæ ¸å¿ƒå‚æ•°è§¦æ‰‹å¯åŠï¼Œä¿æŒå…‹åˆ¶å’Œç†æ€§ã€‚**

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **ç»Ÿä¸€æ€§ (Unity)** | å¤ç”¨å‰ç«¯ Tailwind é…ç½®ã€å­—ä½“å’Œ shadcn/uiï¼Œè§†è§‰ä¸Šæ˜¯ Soul OS çš„æœ‰æœºå»¶ä¼¸ |
| **å®ç”¨è‡³ä¸Š (Utility First)** | æ‰€æœ‰æ•°æ®å±•ç¤ºéƒ½æ˜¯ä¸ºäº†å†³ç­–æˆ–æ“ä½œï¼Œä¸æèŠ±å“¨è£…é¥° |
| **é…ç½®å³æ•°æ® (Configuration as Data)** | Promptsã€Skillsã€å‚æ•°å­˜å‚¨åœ¨æ•°æ®åº“ï¼Œæ”¯æŒçƒ­æ›´æ–°æ— éœ€é‡æ–°éƒ¨ç½² |
| **å®‰å…¨ç¬¬ä¸€ (Security First)** | ä¸¥æ ¼ RBACï¼Œæ‰€æœ‰æ“ä½œè®°å½•å®¡è®¡æ—¥å¿— |

### 0.2 ä¸ v4.2 æ¶æ„é›†æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Admin System æ¶æ„ä½ç½®                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              Admin System
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              â”‚              â”‚
                    â–¼              â–¼              â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Agent Studioâ”‚ â”‚ Dashboard â”‚ â”‚ Data Managerâ”‚
            â”‚ (Prompts)   â”‚ â”‚ (Metrics) â”‚ â”‚ (L0/L1)     â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â”‚              â”‚              â”‚
                   â–¼              â–¼              â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚           PostgreSQL (fortune_ai)            â”‚
            â”‚  agent_prompts / agent_skills / audit_log   â”‚
            â”‚  fortune_user / fortune_twin_* / metrics_*  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ çƒ­åŠ è½½
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚        Agent Runtime (Next.js API Route)     â”‚
            â”‚  streamText({ system: loadActivePrompt() }) â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. ç³»ç»Ÿæ¶æ„

### 1.1 æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç”¨é€” |
|------|----------|------|
| **æ¡†æ¶** | Next.js App Router | `/app/admin/*` è·¯ç”± |
| **UI** | shadcn/ui + Tailwind CSS | å¤ç”¨ `globals.css` ä¸»é¢˜ |
| **æ•°æ®è¡¨æ ¼** | TanStack Table (React Table v8) | å¤æ‚æ•°æ®å±•ç¤º |
| **ä»£ç ç¼–è¾‘å™¨** | Monaco Editor (React) | Prompt YAML/JSON ç¼–è¾‘ |
| **æ•°æ®å¯è§†åŒ–** | Recharts | ç›‘æ§å›¾è¡¨ |
| **é‰´æƒ** | NextAuth.js + Middleware | RBAC è§’è‰²æ§åˆ¶ |
| **ç¼“å­˜** | Redis (å¯é€‰) | Prompt çƒ­åŠ è½½ç¼“å­˜ |

### 1.2 æ¨¡å—ç»“æ„

```
/admin
â”œâ”€â”€ ä»ªè¡¨ç›˜ (Dashboard)      â€” ç³»ç»Ÿå¥åº·ä¸æ ¸å¿ƒæŒ‡æ ‡æ¦‚è§ˆ
â”œâ”€â”€ æ•°æ®ç®¡ç† (Data Manager) â€” L0/L1 æ•°æ®çš„æŸ¥é˜…ä¸ä¿®æ­£
â”œâ”€â”€ æ™ºèƒ½ä½“å·¥ä½œå®¤ (Agent Studio) â€” Prompt, Skills, KB çš„æ ¸å¿ƒç®¡ç†åŒº
â”œâ”€â”€ ç³»ç»Ÿè®¾ç½® (Settings)     â€” å…¨å±€å‚æ•°ä¸åŠŸèƒ½å¼€å…³
â””â”€â”€ å®¡è®¡æ—¥å¿— (Audit Log)    â€” æ“ä½œè®°å½•ä¸å®‰å…¨å®¡è®¡
```

### 1.3 é¡µé¢è·¯ç”±

```bash
src/app/admin/
â”œâ”€â”€ layout.tsx                # Admin ä¾§è¾¹æ å¸ƒå±€ + é‰´æƒ Guard
â”œâ”€â”€ page.tsx                  # ä»ªè¡¨ç›˜é¦–é¡µ (Dashboard)
â”‚
â”œâ”€â”€ data/                     # æ•°æ®ç®¡ç†
â”‚   â”œâ”€â”€ page.tsx              # æ•°æ®ç®¡ç†é¦–é¡µ
â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â”œâ”€â”€ page.tsx          # L0 ç”¨æˆ·åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ [userId]/page.tsx # ç”¨æˆ·è¯¦æƒ…
â”‚   â”œâ”€â”€ conversations/
â”‚   â”‚   â””â”€â”€ page.tsx          # ä¼šè¯æ—¥å¿—
â”‚   â””â”€â”€ twins/
â”‚       â””â”€â”€ page.tsx          # æ•°å­—å­ªç”Ÿæ•°æ®
â”‚
â”œâ”€â”€ agents/                   # æ™ºèƒ½ä½“å·¥ä½œå®¤
â”‚   â”œâ”€â”€ page.tsx              # Agent åˆ—è¡¨æ¦‚è§ˆ
â”‚   â”œâ”€â”€ prompts/
â”‚   â”‚   â”œâ”€â”€ page.tsx          # Prompt åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ [promptId]/page.tsx # Prompt ç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ skills/
â”‚   â”‚   â”œâ”€â”€ page.tsx          # Skills åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ [skillId]/page.tsx # Skill ç¼–è¾‘å™¨
â”‚   â””â”€â”€ kb/
â”‚       â””â”€â”€ page.tsx          # çŸ¥è¯†åº“ç®¡ç†
â”‚
â”œâ”€â”€ settings/                 # ç³»ç»Ÿè®¾ç½®
â”‚   â”œâ”€â”€ page.tsx              # è®¾ç½®é¦–é¡µ
â”‚   â”œâ”€â”€ models/page.tsx       # æ¨¡å‹é…ç½®
â”‚   â”œâ”€â”€ features/page.tsx     # åŠŸèƒ½å¼€å…³
â”‚   â””â”€â”€ params/page.tsx       # ç³»ç»Ÿå‚æ•°
â”‚
â””â”€â”€ audit/                    # å®¡è®¡æ—¥å¿—
    â””â”€â”€ page.tsx              # æ“ä½œæ—¥å¿—æŸ¥è¯¢
```

---

## 2. æ¨¡å—è¯¦ç»†è®¾è®¡

### 2.1 ä»ªè¡¨ç›˜ (Dashboard) â€” "ç³»ç»Ÿå¿ƒç”µå›¾"

**ç›®æ ‡**: 3 ç§’å†…äº†è§£ç³»ç»Ÿæ˜¯å¦å¥åº·ï¼Œä»¥åŠç”¨æˆ·æ´»è·ƒåº¦ã€‚

#### 2.1.1 é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fortune AI Admin â€” Dashboard                              [Admin] [Logout] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  ä¾§   â”‚  â”‚ ğŸŸ¢ Live      â”‚ â”‚ ğŸ’¬ Today's   â”‚ â”‚ âœ… API       â”‚ â”‚ ğŸ”´ Error    â”‚â”‚
â”‚  è¾¹   â”‚  â”‚ Users        â”‚ â”‚ Interactions â”‚ â”‚ Health       â”‚ â”‚ Rate        â”‚â”‚
â”‚  æ    â”‚  â”‚    128       â”‚ â”‚  4,521 msg   â”‚ â”‚  99.9%       â”‚ â”‚  0.3%       â”‚â”‚
â”‚       â”‚  â”‚              â”‚ â”‚  320 skills  â”‚ â”‚  1.2s avg    â”‚ â”‚             â”‚â”‚
â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚       â”‚  â”‚  äº¤äº’è¶‹åŠ¿å›¾ (7æ—¥)               â”‚ â”‚  æŠ€èƒ½ä½¿ç”¨åˆ†å¸ƒ              â”‚  â”‚
â”‚       â”‚  â”‚  [Recharts Line Chart]         â”‚ â”‚  [Recharts Pie Chart]      â”‚  â”‚
â”‚       â”‚  â”‚  æ¶ˆæ¯é‡ vs æŠ€èƒ½è°ƒç”¨é‡           â”‚ â”‚  /divine 45%               â”‚  â”‚
â”‚       â”‚  â”‚                                â”‚ â”‚  /heal 30%                 â”‚  â”‚
â”‚       â”‚  â”‚                                â”‚ â”‚  /grow 25%                 â”‚  â”‚
â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚       â”‚  â”‚  æœ€è¿‘ç³»ç»Ÿæ—¥å¿—                                                   â”‚ â”‚
â”‚       â”‚  â”‚  [2026-01-01 10:23:45] ERROR  Tool execute failed: calculate... â”‚ â”‚
â”‚       â”‚  â”‚  [2026-01-01 10:22:12] WARN   High latency: 3.2s on /api/chat   â”‚ â”‚
â”‚       â”‚  â”‚  [2026-01-01 10:20:00] INFO   Prompt deployed: style_warm v1.3  â”‚ â”‚
â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.1.2 æŒ‡æ ‡å¡ç‰‡å®šä¹‰

| æŒ‡æ ‡ | æ•°æ®æº | åˆ·æ–°é¢‘ç‡ | å‘Šè­¦é˜ˆå€¼ |
|------|--------|----------|----------|
| Live Users | WebSocket è¿æ¥æ•° / Redis | å®æ—¶ | - |
| Today's Interactions | `metrics_daily` è¡¨ | 1min | - |
| API Health | å¤–éƒ¨ç›‘æ§ / å¥åº·æ£€æŸ¥ | 30s | < 99% |
| Error Rate | `system_logs` è¡¨ | 1min | > 1% |

#### 2.1.3 API ç«¯ç‚¹

```typescript
// GET /api/admin/dashboard/metrics
interface DashboardMetrics {
  live_users: number;
  today_messages: number;
  today_skill_calls: number;
  api_health: {
    uptime_percent: number;
    avg_latency_ms: number;
    provider_status: Record<string, 'healthy' | 'degraded' | 'down'>;
  };
  error_rate_percent: number;
}

// GET /api/admin/dashboard/trends?days=7
interface TrendData {
  date: string;
  messages: number;
  skill_calls: number;
}

// GET /api/admin/dashboard/skill-distribution
interface SkillDistribution {
  skill: string;
  count: number;
  percent: number;
}

// GET /api/admin/dashboard/logs?limit=20
interface SystemLog {
  id: string;
  timestamp: string;
  level: 'INFO' | 'WARN' | 'ERROR';
  message: string;
  details?: Record<string, any>;
}
```

---

### 2.2 æ•°æ®ç®¡ç† (Data Manager) â€” "L0/L1 é€è§†é•œ"

**ç›®æ ‡**: æŸ¥çœ‹ç”¨æˆ·æ•°æ®çŠ¶æ€ï¼ˆç”¨äº debugï¼‰ï¼Œå¿…è¦æ—¶æ‰‹åŠ¨ä¿®æ­£é”™è¯¯æ•°æ®ã€‚

#### 2.2.1 ç”¨æˆ·æ¡£æ¡ˆ (L0 Profile View)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®ç®¡ç† > ç”¨æˆ·æ¡£æ¡ˆ                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [æœç´¢: é‚®ç®±/ç”¨æˆ·ID]                          [å¯¼å‡º CSV] [åˆ·æ–°]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·ID (Hash) â”‚ æ³¨å†Œæ—¶é—´     â”‚ æœ€åæ´»è·ƒ    â”‚ çŠ¶æ€   â”‚ å…«å­—     â”‚ æ“ä½œ      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  a1b2c3...     â”‚ 2025-12-01   â”‚ 5åˆ†é’Ÿå‰     â”‚ ğŸŸ¢ æ´»è·ƒâ”‚ ç”²å­å¹´... â”‚ [è¯¦æƒ…]   â”‚
â”‚  d4e5f6...     â”‚ 2025-11-15   â”‚ 2å¤©å‰       â”‚ ğŸŸ¡ æ²‰é»˜â”‚ ä¹™ä¸‘å¹´... â”‚ [è¯¦æƒ…]   â”‚
â”‚  g7h8i9...     â”‚ 2025-10-20   â”‚ 30å¤©å‰      â”‚ ğŸ”´ æµå¤±â”‚ ä¸™å¯…å¹´... â”‚ [è¯¦æƒ…]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ˜¾ç¤º 1-20 / å…± 1,234 æ¡                              [< ä¸Šä¸€é¡µ] [ä¸‹ä¸€é¡µ >] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2.2 ç”¨æˆ·è¯¦æƒ…ä¾§è¾¹æ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¯¦æƒ…                              [Ã—]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸºç¡€ä¿¡æ¯ (L0)                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ç”¨æˆ·ID:    a1b2c3d4-e5f6-...               â”‚
â”‚  é‚®ç®±:      z***@example.com (è„±æ•)          â”‚
â”‚  æ˜µç§°:      å¼ ä¸‰                             â”‚
â”‚  æ€§åˆ«:      ç”·                               â”‚
â”‚  å‡ºç”Ÿ:      1990-05-12 14:00 (åŒ—äº¬)          â”‚
â”‚  æ³¨å†Œæ—¶é—´:  2025-12-01 10:30:00              â”‚
â”‚  é£æ ¼åå¥½:  warm                             â”‚
â”‚                                              â”‚
â”‚  å…«å­—å¿«ç…§ (L1)                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  å››æŸ±: åºšåˆå¹´ è¾›å·³æœˆ ç”²å­æ—¥ è¾›æœªæ—¶            â”‚
â”‚  æ—¥ä¸»: ç”²æœ¨                                  â”‚
â”‚  èº«å¼º/å¼±: èº«å¼±                               â”‚
â”‚  å–œç”¨ç¥: æ°´æœ¨                                â”‚
â”‚  facts_hash: sha256:3b9e8b...               â”‚
â”‚                                              â”‚
â”‚  æ•°å­—å­ªç”Ÿ (Twin)                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Grit:     7.2 / 10                          â”‚
â”‚  Wisdom:   6.8 / 10                          â”‚
â”‚  Love:     8.1 / 10                          â”‚
â”‚  Will:     5.5 / 10                          â”‚
â”‚  Vitality: 7.0 / 10                          â”‚
â”‚                                              â”‚
â”‚  PERMA æœ€è¿‘ 7 å¤©                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  P (ç§¯ææƒ…ç»ª): 6.5                           â”‚
â”‚  E (æŠ•å…¥):     7.0                           â”‚
â”‚  R (å…³ç³»):     5.8                           â”‚
â”‚  M (æ„ä¹‰):     6.2                           â”‚
â”‚  A (æˆå°±):     7.5                           â”‚
â”‚                                              â”‚
â”‚  æ´»è·ƒç›®æ ‡: 2 ä¸ª                               â”‚
â”‚  å¾…å®Œæˆä»»åŠ¡: 5 ä¸ª                             â”‚
â”‚  æœ¬å‘¨ä¼šè¯æ•°: 12                               â”‚
â”‚                                              â”‚
â”‚  [æŸ¥çœ‹ä¼šè¯å†å²] [æŸ¥çœ‹ä»»åŠ¡] [ç¼–è¾‘ç”¨æˆ·]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2.3 æ¨¡å—æ—¥å¿— (L1 Module Logs)

æ”¯æŒæŒ‰æ¨¡å—ç­›é€‰æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š

| æ¨¡å— | æ—¥å¿—å†…å®¹ | å¯ä¿®æ­£å­—æ®µ |
|------|----------|------------|
| PERMA | æƒ…ç»ªæ‰“å¡è®°å½• | score, note |
| Goal | ç›®æ ‡åˆ›å»º/è¿›åº¦ | status |
| Commitment | ä»»åŠ¡å®Œæˆè®°å½• | completed_at |
| Checkin | ç­¾åˆ°è®°å½• | - |

#### 2.2.4 API ç«¯ç‚¹

```typescript
// GET /api/admin/users?page=1&limit=20&search=xxx
interface UserListResponse {
  users: AdminUserSummary[];
  total: number;
  page: number;
}

// GET /api/admin/users/:userId
interface AdminUserDetail {
  profile: UserProfile;
  bazi_snapshot: BaziSnapshot;
  twin: TwinData;
  perma_recent: PermaScore[];
  active_goals: Goal[];
  pending_tasks: number;
  session_count_week: number;
}

// PUT /api/admin/users/:userId/twin
// æ‰‹åŠ¨ä¿®æ­£å­ªç”Ÿæ•°æ®

// PUT /api/admin/logs/:logId
// æ‰‹åŠ¨ä¿®æ­£æ—¥å¿—è®°å½• (éœ€å®¡è®¡)
```

---

### 2.3 æ™ºèƒ½ä½“å·¥ä½œå®¤ (Agent Studio) â€” "æ ¸å¿ƒå¼•æ“å®¤"

**ç›®æ ‡**: åœ¨ä¸å‘ç‰ˆçš„æƒ…å†µä¸‹è°ƒæ•´ AI è¡Œä¸º â€” Promptsã€Skillsã€çŸ¥è¯†åº“ã€‚

#### 2.3.1 Prompt ç®¡ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ™ºèƒ½ä½“å·¥ä½œå®¤ > Prompts                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‚ Style Agents      â”‚  Prompt Editor                                       â”‚
â”‚  â”œâ”€â”€ ğŸ“„ standard      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”œâ”€â”€ ğŸ“„ warm âœ“        â”‚  â”‚ Agent: style_warm                               â”‚â”‚
â”‚  â””â”€â”€ ğŸ“„ roast         â”‚  â”‚ Version: v1.3 (Active) â–¼  [v1.2] [v1.1] [Draft] â”‚â”‚
â”‚                       â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  ğŸ“‚ Expert Agents     â”‚  â”‚                                                 â”‚â”‚
â”‚  â”œâ”€â”€ ğŸ“‚ Divine        â”‚  â”‚  # Monaco Editor                                â”‚â”‚
â”‚  â”‚   â”œâ”€â”€ ğŸ“„ bazi      â”‚  â”‚  ä½ æ˜¯ Fortune AI çš„å¯¹è¯ Agentï¼Œè§’è‰²æ˜¯ç§¯æå¿ƒç†    â”‚â”‚
â”‚  â”‚   â””â”€â”€ ğŸ“„ ziwei     â”‚  â”‚  å­¦æ•™ç»ƒï¼ˆPerformance Coachï¼‰ã€‚                   â”‚â”‚
â”‚  â”œâ”€â”€ ğŸ“‚ Heal          â”‚  â”‚                                                 â”‚â”‚
â”‚  â”‚   â”œâ”€â”€ ğŸ“„ perma     â”‚  â”‚  ã€äº§å“å®šä½ã€‘                                    â”‚â”‚
â”‚  â”‚   â””â”€â”€ ğŸ“„ cbt       â”‚  â”‚  äººç”Ÿå¯¼èˆª / é™ªä¼´ / æå‡ã€‚ç³»ç»Ÿå’Œäº¤äº’ä¿æŒ"æœ‰æ•ˆè€Œ   â”‚â”‚
â”‚  â””â”€â”€ ğŸ“‚ Grow          â”‚  â”‚  æç®€"ã€‚                                         â”‚â”‚
â”‚      â”œâ”€â”€ ğŸ“„ goal      â”‚  â”‚                                                 â”‚â”‚
â”‚      â””â”€â”€ ğŸ“„ task      â”‚  â”‚  ã€ä½ çš„ä¼˜å…ˆçº§ï¼ˆä¸å¯é€†ï¼‰ã€‘                         â”‚â”‚
â”‚                       â”‚  â”‚  Coach > Teaching Assistant > Customer Support  â”‚â”‚
â”‚  ğŸ“‚ System            â”‚  â”‚  > Sales                                        â”‚â”‚
â”‚  â””â”€â”€ ğŸ“„ base_prompt   â”‚  â”‚                                                 â”‚â”‚
â”‚                       â”‚  â”‚  ã€ç¡¬æ€§è§„åˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰ã€‘                         â”‚â”‚
â”‚                       â”‚  â”‚  1) ç¦æ­¢æå“ã€ç¾è¾±ã€å®¿å‘½è®ºæ–­è¨€...               â”‚â”‚
â”‚                       â”‚  â”‚                                                 â”‚â”‚
â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                       â”‚                                                      â”‚
â”‚                       â”‚  [Save Draft]  [Deploy v1.4]  [Diff with Active]    â”‚
â”‚                       â”‚                                                      â”‚
â”‚                       â”‚  âš ï¸ ä¸Šæ¬¡éƒ¨ç½²: 2026-01-01 09:30 by admin@example.com â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.2 Skills ç®¡ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ™ºèƒ½ä½“å·¥ä½œå®¤ > Skills                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‚ Divine Skills     â”‚  Skill Editor                                        â”‚
â”‚  â”œâ”€â”€ ğŸ”§ calculate_baziâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”œâ”€â”€ ğŸ”§ get_bazi_factsâ”‚  â”‚ Skill: calculate_bazi                           â”‚â”‚
â”‚  â””â”€â”€ ğŸ”§ search_bazi_kbâ”‚  â”‚ Category: divine                                â”‚â”‚
â”‚                       â”‚  â”‚ Status: âœ… Active                               â”‚â”‚
â”‚  ğŸ“‚ Heal Skills       â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”œâ”€â”€ ğŸ”§ log_perma âœ“   â”‚  â”‚ Description:                                    â”‚â”‚
â”‚  â”œâ”€â”€ ğŸ”§ mood_checkin  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â””â”€â”€ ğŸ”§ cbt_reframe   â”‚  â”‚ â”‚ è®¡ç®—ç”¨æˆ·çš„å…«å­—å‘½ç›˜ï¼Œè¿”å›å››æŸ±ã€äº”è¡Œã€åç¥ã€   â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â”‚ ç¥ç…ã€å¤§è¿ç­‰ä¿¡æ¯                             â”‚ â”‚â”‚
â”‚  ğŸ“‚ Grow Skills       â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”œâ”€â”€ ğŸ”§ create_commit â”‚  â”‚                                                 â”‚â”‚
â”‚  â”œâ”€â”€ ğŸ”§ goal_setting  â”‚  â”‚ Parameters (Zod Schema):                        â”‚â”‚
â”‚  â””â”€â”€ ğŸ”§ update_twin   â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚                       â”‚  â”‚ â”‚ {                                           â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â”‚   "birth_datetime": {                       â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â”‚     "type": "string",                       â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â”‚     "description": "å‡ºç”Ÿæ—¥æœŸæ—¶é—´ (ISO 8601)"â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â”‚   },                                        â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â”‚   "timezone": {                             â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â”‚     "type": "string",                       â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â”‚     "default": "Asia/Shanghai"              â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â”‚   },                                        â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â”‚   "include_dayun": {                        â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â”‚     "type": "boolean",                      â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â”‚     "default": true                         â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â”‚   }                                         â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â”‚ }                                           â”‚ â”‚â”‚
â”‚                       â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚                       â”‚  â”‚                                                 â”‚â”‚
â”‚                       â”‚  â”‚ Endpoint: POST /api/bazi/calculate              â”‚â”‚
â”‚                       â”‚  â”‚                                                 â”‚â”‚
â”‚                       â”‚  â”‚ [Save] [Test Skill] [Disable]                   â”‚â”‚
â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.3 çŸ¥è¯†åº“ç®¡ç† (Knowledge Base)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ™ºèƒ½ä½“å·¥ä½œå®¤ > çŸ¥è¯†åº“                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [+ ä¸Šä¼ æ–‡æ¡£]                              [é‡å»ºç´¢å¼•] [åˆ·æ–°]                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ–‡ä»¶å              â”‚ ç±»åˆ«    â”‚ Chunks â”‚ ä¸Šä¼ æ—¶é—´     â”‚ çŠ¶æ€   â”‚ æ“ä½œ      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  å…«å­—åŸºç¡€çŸ¥è¯†.pdf     â”‚ bazi    â”‚ 156    â”‚ 2025-12-15   â”‚ âœ… å·²ç´¢å¼•â”‚ [é¢„è§ˆ][åˆ ]â”‚
â”‚  PERMAå¿ƒç†å­¦.md      â”‚ perma   â”‚ 89     â”‚ 2025-12-10   â”‚ âœ… å·²ç´¢å¼•â”‚ [é¢„è§ˆ][åˆ ]â”‚
â”‚  CBTè®¤çŸ¥ç–—æ³•.pdf     â”‚ cbt     â”‚ 234    â”‚ 2025-12-08   â”‚ â³ ç´¢å¼•ä¸­â”‚ [é¢„è§ˆ][åˆ ]â”‚
â”‚  ç´«å¾®æ–—æ•°å…¥é—¨.pdf    â”‚ ziwei   â”‚ 0      â”‚ åˆšåˆš         â”‚ ğŸ”„ å¤„ç†ä¸­â”‚ [å–æ¶ˆ]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ€»è®¡: 4 ä¸ªæ–‡æ¡£, 479 chunks, ç´¢å¼•å¤§å°: 12.3 MB                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.4 API ç«¯ç‚¹

```typescript
// Prompts
// GET /api/admin/prompts
// GET /api/admin/prompts/:promptId/versions
// POST /api/admin/prompts/:promptId/versions (åˆ›å»ºæ–°ç‰ˆæœ¬)
// PUT /api/admin/prompts/:promptId/deploy/:version (éƒ¨ç½²æŒ‡å®šç‰ˆæœ¬)

// Skills
// GET /api/admin/skills
// GET /api/admin/skills/:skillId
// PUT /api/admin/skills/:skillId (æ›´æ–° Skill)
// POST /api/admin/skills/:skillId/test (æµ‹è¯• Skill)

// Knowledge Base
// GET /api/admin/kb
// POST /api/admin/kb/upload (ä¸Šä¼ æ–‡æ¡£)
// DELETE /api/admin/kb/:docId
// POST /api/admin/kb/reindex (é‡å»ºç´¢å¼•)
```

---

### 2.4 ç³»ç»Ÿè®¾ç½® (Settings) â€” "æ§åˆ¶å°"

#### 2.4.1 æ¨¡å‹é…ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç³»ç»Ÿè®¾ç½® > æ¨¡å‹é…ç½®                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  é»˜è®¤æ¨¡å‹                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [GLM-4.5 (æ¨è)]  â–¼                                                    â”‚ â”‚
â”‚  â”‚   â€¢ GLM-4.5 (via Vercel AI Gateway)                                   â”‚ â”‚
â”‚  â”‚   â€¢ Gemini 2.0 Flash                                                  â”‚ â”‚
â”‚  â”‚   â€¢ Claude 3.5 Sonnet                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  æ¨¡å‹æä¾›å•†çŠ¶æ€                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æä¾›å•†        â”‚ çŠ¶æ€       â”‚ å»¶è¿Ÿ      â”‚ é…é¢ä½¿ç”¨    â”‚ æ“ä½œ          â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚  â”‚  GLM-4.5       â”‚ ğŸŸ¢ æ­£å¸¸    â”‚ 1.2s      â”‚ 45%         â”‚ [é…ç½®]        â”‚ â”‚
â”‚  â”‚  Gemini        â”‚ ğŸŸ¢ æ­£å¸¸    â”‚ 0.8s      â”‚ 12%         â”‚ [é…ç½®]        â”‚ â”‚
â”‚  â”‚  Claude        â”‚ ğŸŸ¡ é™çº§    â”‚ 2.5s      â”‚ 78%         â”‚ [é…ç½®]        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  API Key é…ç½®                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  GLM API Key:     [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢]  [æ˜¾ç¤º] [æµ‹è¯•è¿æ¥]           â”‚ â”‚
â”‚  â”‚  Google API Key:  [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢]  [æ˜¾ç¤º] [æµ‹è¯•è¿æ¥]           â”‚ â”‚
â”‚  â”‚  Anthropic Key:   [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢]  [æ˜¾ç¤º] [æµ‹è¯•è¿æ¥]           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  [ä¿å­˜é…ç½®]                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.4.2 åŠŸèƒ½å¼€å…³ (Feature Flags)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç³»ç»Ÿè®¾ç½® > åŠŸèƒ½å¼€å…³                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  æ ¸å¿ƒåŠŸèƒ½                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  [ON]  å¯ç”¨ Agent Runtime (v4.2)                                       â”‚ â”‚
â”‚  â”‚        ä½¿ç”¨ Vercel AI SDK streamText() å¤„ç†å¯¹è¯                        â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  [ON]  å¯ç”¨ Tool Calling                                               â”‚ â”‚
â”‚  â”‚        å…è®¸ LLM è°ƒç”¨ Skills (maxSteps=5)                               â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  [ON]  å¯ç”¨å¤šæ¨¡å‹åˆ‡æ¢                                                   â”‚ â”‚
â”‚  â”‚        æ ¹æ®ç”¨æˆ·åå¥½åŠ¨æ€é€‰æ‹©æ¨¡å‹                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  é£æ ¼æ¨¡å¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  [ON]  Standard æ¨¡å¼                                                   â”‚ â”‚
â”‚  â”‚  [ON]  Warm æ¨¡å¼ (é»˜è®¤)                                                â”‚ â”‚
â”‚  â”‚  [OFF] Roast æ¨¡å¼ (æ¯’èˆŒ) âš ï¸ å¼€å‘ä¸­                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  å®éªŒåŠŸèƒ½                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  [OFF] Landing Page (Digital Mirror)                                   â”‚ â”‚
â”‚  â”‚        æ–°ç‰ˆé¦–é¡µï¼ŒWebGL Soul Orb + æ¸è¿›å¼æ³¨å†Œ                            â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  [OFF] ç´«å¾®æ–—æ•°æ¨¡å—                                                     â”‚ â”‚
â”‚  â”‚        calculate_ziwei Skill                                           â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  [ON]  ç»´æŠ¤æ¨¡å¼                                                         â”‚ â”‚
â”‚  â”‚        å¼€å¯åå‰ç«¯æ˜¾ç¤ºç»´æŠ¤é¡µé¢                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  [ä¿å­˜é…ç½®]                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.4.3 ç³»ç»Ÿå‚æ•°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç³»ç»Ÿè®¾ç½® > ç³»ç»Ÿå‚æ•°                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  å¯¹è¯å‚æ•°                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å•æ¬¡å¯¹è¯æœ€å¤§ Context é•¿åº¦:  [8192] tokens                             â”‚ â”‚
â”‚  â”‚  æœ€å¤§å†å²æ¶ˆæ¯æ•°:             [20] æ¡                                   â”‚ â”‚
â”‚  â”‚  Tool Calling æœ€å¤§æ­¥æ•°:      [5] æ­¥                                    â”‚ â”‚
â”‚  â”‚  æµå¼å“åº”è¶…æ—¶:               [30] ç§’                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  ä¼šè¯å‚æ•°                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Session è¶…æ—¶æ—¶é—´:           [30] å¤©                                   â”‚ â”‚
â”‚  â”‚  CSRF Token æœ‰æ•ˆæœŸ:          [24] å°æ—¶                                 â”‚ â”‚
â”‚  â”‚  å•ç”¨æˆ·æœ€å¤§å¹¶å‘ä¼šè¯:         [5] ä¸ª                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  é€Ÿç‡é™åˆ¶                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æ¯ç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚:       [30] æ¬¡                                   â”‚ â”‚
â”‚  â”‚  æ¯ IP æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚:       [100] æ¬¡                                  â”‚ â”‚
â”‚  â”‚  Landing Page æ´å¯Ÿé™åˆ¶:      [10] æ¬¡/IP/å°æ—¶                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  [æ¢å¤é»˜è®¤] [ä¿å­˜é…ç½®]                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2.5 å®¡è®¡æ—¥å¿— (Audit Log) â€” "é»‘åŒ£å­"

**ç›®æ ‡**: è®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œï¼Œæ”¯æŒåˆè§„å®¡è®¡å’Œé—®é¢˜è¿½æº¯ã€‚

#### 2.5.1 é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¡è®¡æ—¥å¿—                                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ—¶é—´èŒƒå›´: [è¿‡å» 7 å¤©] â–¼   æ“ä½œç±»å‹: [å…¨éƒ¨] â–¼   æ“ä½œäºº: [å…¨éƒ¨] â–¼   [æŸ¥è¯¢]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ—¶é—´               â”‚ æ“ä½œäºº          â”‚ æ“ä½œç±»å‹     â”‚ è¯¦æƒ…                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  2026-01-01 10:30   â”‚ admin@example   â”‚ PROMPT_DEPLOYâ”‚ style_warm v1.3       â”‚
â”‚  2026-01-01 10:15   â”‚ admin@example   â”‚ FEATURE_FLAG â”‚ roast_mode: offâ†’on    â”‚
â”‚  2026-01-01 09:45   â”‚ admin@example   â”‚ USER_EDIT    â”‚ user:a1b2c3 twinä¿®æ­£  â”‚
â”‚  2025-12-31 18:00   â”‚ system          â”‚ KB_REINDEX   â”‚ å…¨é‡é‡å»ºç´¢å¼•           â”‚
â”‚  2025-12-31 15:30   â”‚ admin@example   â”‚ SKILL_UPDATE â”‚ calculate_bazi å‚æ•°   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ˜¾ç¤º 1-20 / å…± 156 æ¡                              [< ä¸Šä¸€é¡µ] [ä¸‹ä¸€é¡µ >]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.5.2 å®¡è®¡äº‹ä»¶ç±»å‹

| äº‹ä»¶ç±»å‹ | è¯´æ˜ | è®°å½•å­—æ®µ |
|----------|------|----------|
| `PROMPT_DEPLOY` | Prompt ç‰ˆæœ¬éƒ¨ç½² | agent_name, version, prev_version |
| `PROMPT_CREATE` | Prompt ç‰ˆæœ¬åˆ›å»º | agent_name, version |
| `SKILL_UPDATE` | Skill é…ç½®æ›´æ–° | skill_name, changes |
| `SKILL_TOGGLE` | Skill å¯ç”¨/ç¦ç”¨ | skill_name, enabled |
| `FEATURE_FLAG` | åŠŸèƒ½å¼€å…³å˜æ›´ | flag_name, old_value, new_value |
| `MODEL_CONFIG` | æ¨¡å‹é…ç½®å˜æ›´ | provider, changes |
| `USER_EDIT` | ç”¨æˆ·æ•°æ®ä¿®æ­£ | user_id, field, old_value, new_value |
| `KB_UPLOAD` | çŸ¥è¯†åº“ä¸Šä¼  | doc_name, category |
| `KB_DELETE` | çŸ¥è¯†åº“åˆ é™¤ | doc_id, doc_name |
| `KB_REINDEX` | çŸ¥è¯†åº“é‡å»ºç´¢å¼• | doc_count, chunk_count |
| `ADMIN_LOGIN` | ç®¡ç†å‘˜ç™»å½• | admin_email, ip |
| `ADMIN_LOGOUT` | ç®¡ç†å‘˜ç™»å‡º | admin_email |

---

## 3. æ•°æ®åº“è®¾è®¡

### 3.1 Schema å®šä¹‰

```sql
-- ============================================================
-- Admin System Tables (fortune_ai database)
-- ============================================================

-- 3.1.1 Prompt ç‰ˆæœ¬æ§åˆ¶è¡¨
CREATE TABLE admin_prompts (
    id SERIAL PRIMARY KEY,
    agent_name VARCHAR(50) NOT NULL,      -- e.g., 'style_warm', 'expert_bazi'
    type VARCHAR(20) NOT NULL,            -- 'system_prompt' | 'context_template'
    version INT NOT NULL,                 -- ç‰ˆæœ¬å·ï¼Œé€’å¢
    content TEXT NOT NULL,                -- Prompt å†…å®¹ (YAML/Markdown)
    is_active BOOLEAN DEFAULT FALSE,      -- å½“å‰æ˜¯å¦ç”Ÿæ•ˆ
    created_at TIMESTAMPTZ DEFAULT NOW(),
    created_by INT REFERENCES fortune_user(user_id),
    deployed_at TIMESTAMPTZ,              -- éƒ¨ç½²æ—¶é—´
    deployed_by INT REFERENCES fortune_user(user_id),
    UNIQUE(agent_name, type, version)
);

CREATE INDEX idx_prompts_active ON admin_prompts (agent_name, type) WHERE is_active = TRUE;

-- 3.1.2 Skill é…ç½®è¡¨
CREATE TABLE admin_skills (
    id SERIAL PRIMARY KEY,
    skill_name VARCHAR(50) UNIQUE NOT NULL, -- e.g., 'calculate_bazi'
    category VARCHAR(20) NOT NULL,          -- 'divine' | 'heal' | 'grow'
    description TEXT NOT NULL,
    parameters JSONB NOT NULL,              -- Zod Schema (JSON format)
    endpoint VARCHAR(100) NOT NULL,         -- e.g., '/api/bazi/calculate'
    is_enabled BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 3.1.3 åŠŸèƒ½å¼€å…³è¡¨
CREATE TABLE admin_feature_flags (
    id SERIAL PRIMARY KEY,
    flag_name VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    is_enabled BOOLEAN DEFAULT FALSE,
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    updated_by INT REFERENCES fortune_user(user_id)
);

-- åˆå§‹åŒ–åŠŸèƒ½å¼€å…³
INSERT INTO admin_feature_flags (flag_name, description, is_enabled) VALUES
    ('agent_runtime_v42', 'ä½¿ç”¨ Vercel AI SDK streamText()', TRUE),
    ('tool_calling', 'å…è®¸ LLM è°ƒç”¨ Skills', TRUE),
    ('multi_model', 'å¤šæ¨¡å‹åŠ¨æ€åˆ‡æ¢', TRUE),
    ('style_standard', 'Standard é£æ ¼æ¨¡å¼', TRUE),
    ('style_warm', 'Warm é£æ ¼æ¨¡å¼ (é»˜è®¤)', TRUE),
    ('style_roast', 'Roast é£æ ¼æ¨¡å¼ (æ¯’èˆŒ)', FALSE),
    ('landing_page', 'Digital Mirror é¦–é¡µ', FALSE),
    ('ziwei_module', 'ç´«å¾®æ–—æ•°æ¨¡å—', FALSE),
    ('maintenance_mode', 'ç»´æŠ¤æ¨¡å¼', FALSE);

-- 3.1.4 ç³»ç»Ÿå‚æ•°è¡¨
CREATE TABLE admin_system_params (
    id SERIAL PRIMARY KEY,
    param_name VARCHAR(50) UNIQUE NOT NULL,
    param_value TEXT NOT NULL,
    param_type VARCHAR(20) NOT NULL,  -- 'int' | 'string' | 'boolean' | 'json'
    description TEXT,
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- åˆå§‹åŒ–ç³»ç»Ÿå‚æ•°
INSERT INTO admin_system_params (param_name, param_value, param_type, description) VALUES
    ('max_context_tokens', '8192', 'int', 'å•æ¬¡å¯¹è¯æœ€å¤§ Context é•¿åº¦'),
    ('max_history_messages', '20', 'int', 'æœ€å¤§å†å²æ¶ˆæ¯æ•°'),
    ('max_tool_steps', '5', 'int', 'Tool Calling æœ€å¤§æ­¥æ•°'),
    ('stream_timeout_seconds', '30', 'int', 'æµå¼å“åº”è¶…æ—¶'),
    ('session_timeout_days', '30', 'int', 'Session è¶…æ—¶æ—¶é—´'),
    ('rate_limit_per_user_per_minute', '30', 'int', 'æ¯ç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚'),
    ('rate_limit_per_ip_per_minute', '100', 'int', 'æ¯ IP æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚'),
    ('default_model', 'glm-4.5', 'string', 'é»˜è®¤æ¨¡å‹');

-- 3.1.5 æ¨¡å‹é…ç½®è¡¨
CREATE TABLE admin_model_config (
    id SERIAL PRIMARY KEY,
    provider VARCHAR(30) NOT NULL,        -- 'glm' | 'gemini' | 'claude'
    model_name VARCHAR(50) NOT NULL,
    api_key_encrypted TEXT,               -- åŠ å¯†å­˜å‚¨
    base_url VARCHAR(200),
    is_default BOOLEAN DEFAULT FALSE,
    is_enabled BOOLEAN DEFAULT TRUE,
    quota_percent INT,                    -- é…é¢ä½¿ç”¨ç™¾åˆ†æ¯” (ç›‘æ§ç”¨)
    avg_latency_ms INT,                   -- å¹³å‡å»¶è¿Ÿ (ç›‘æ§ç”¨)
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 3.1.6 çŸ¥è¯†åº“æ–‡æ¡£è¡¨
CREATE TABLE admin_kb_documents (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    filename VARCHAR(200) NOT NULL,
    category VARCHAR(30) NOT NULL,        -- 'bazi' | 'perma' | 'cbt' | 'ziwei'
    file_size_bytes BIGINT,
    chunk_count INT DEFAULT 0,
    status VARCHAR(20) DEFAULT 'pending', -- 'pending' | 'processing' | 'indexed' | 'failed'
    error_message TEXT,
    uploaded_at TIMESTAMPTZ DEFAULT NOW(),
    uploaded_by INT REFERENCES fortune_user(user_id),
    indexed_at TIMESTAMPTZ
);

-- 3.1.7 å®¡è®¡æ—¥å¿—è¡¨
CREATE TABLE admin_audit_log (
    id BIGSERIAL PRIMARY KEY,
    event_type VARCHAR(30) NOT NULL,
    actor_id INT REFERENCES fortune_user(user_id),
    actor_email VARCHAR(100),
    target_type VARCHAR(30),              -- 'prompt' | 'skill' | 'user' | 'kb' | 'config'
    target_id VARCHAR(100),
    details JSONB,                        -- å˜æ›´è¯¦æƒ…
    ip_address INET,
    user_agent TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_audit_log_time ON admin_audit_log (created_at DESC);
CREATE INDEX idx_audit_log_event ON admin_audit_log (event_type, created_at DESC);
CREATE INDEX idx_audit_log_actor ON admin_audit_log (actor_id, created_at DESC);

-- 3.1.8 æŒ‡æ ‡ç»Ÿè®¡è¡¨ (æ¯æ—¥èšåˆ)
CREATE TABLE admin_metrics_daily (
    id SERIAL PRIMARY KEY,
    metric_date DATE NOT NULL,
    total_users INT DEFAULT 0,
    active_users INT DEFAULT 0,
    new_users INT DEFAULT 0,
    total_messages INT DEFAULT 0,
    total_skill_calls INT DEFAULT 0,
    skill_breakdown JSONB,                -- {"divine": 100, "heal": 50, "grow": 30}
    avg_latency_ms INT,
    error_count INT DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(metric_date)
);

-- 3.1.9 ç³»ç»Ÿæ—¥å¿—è¡¨
CREATE TABLE admin_system_logs (
    id BIGSERIAL PRIMARY KEY,
    level VARCHAR(10) NOT NULL,           -- 'INFO' | 'WARN' | 'ERROR'
    message TEXT NOT NULL,
    details JSONB,
    source VARCHAR(50),                   -- 'agent_runtime' | 'tool_call' | 'api'
    correlation_id VARCHAR(50),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_system_logs_time ON admin_system_logs (created_at DESC);
CREATE INDEX idx_system_logs_level ON admin_system_logs (level, created_at DESC);
```

### 3.2 ç”¨æˆ·è§’è‰²æ‰©å±•

```sql
-- åœ¨ fortune_user è¡¨æ·»åŠ è§’è‰²å­—æ®µ
ALTER TABLE fortune_user ADD COLUMN IF NOT EXISTS role VARCHAR(20) DEFAULT 'user';
-- role: 'user' | 'admin' | 'super_admin'

-- åˆ›å»ºç®¡ç†å‘˜ç´¢å¼•
CREATE INDEX idx_user_role ON fortune_user (role) WHERE role IN ('admin', 'super_admin');
```

---

## 4. API è®¾è®¡

### 4.1 é‰´æƒä¸­é—´ä»¶

```typescript
// middleware.ts
import { NextRequest, NextResponse } from 'next/server';
import { getToken } from 'next-auth/jwt';

export async function middleware(req: NextRequest) {
  // Admin è·¯ç”±ä¿æŠ¤
  if (req.nextUrl.pathname.startsWith('/admin')) {
    const token = await getToken({ req });

    if (!token) {
      return NextResponse.redirect(new URL('/new/login', req.url));
    }

    if (token.role !== 'admin' && token.role !== 'super_admin') {
      return NextResponse.redirect(new URL('/new', req.url));
    }
  }

  return NextResponse.next();
}

export const config = {
  matcher: ['/admin/:path*', '/api/admin/:path*'],
};
```

### 4.2 Admin API ç«¯ç‚¹æ±‡æ€»

| æ¨¡å— | ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|------|
| **Dashboard** | `/api/admin/dashboard/metrics` | GET | æ ¸å¿ƒæŒ‡æ ‡ |
| | `/api/admin/dashboard/trends` | GET | è¶‹åŠ¿æ•°æ® |
| | `/api/admin/dashboard/skill-distribution` | GET | æŠ€èƒ½åˆ†å¸ƒ |
| | `/api/admin/dashboard/logs` | GET | ç³»ç»Ÿæ—¥å¿— |
| **Users** | `/api/admin/users` | GET | ç”¨æˆ·åˆ—è¡¨ |
| | `/api/admin/users/:id` | GET | ç”¨æˆ·è¯¦æƒ… |
| | `/api/admin/users/:id/twin` | PUT | ä¿®æ­£å­ªç”Ÿæ•°æ® |
| **Prompts** | `/api/admin/prompts` | GET | Prompt åˆ—è¡¨ |
| | `/api/admin/prompts/:id/versions` | GET | ç‰ˆæœ¬åˆ—è¡¨ |
| | `/api/admin/prompts/:id/versions` | POST | åˆ›å»ºç‰ˆæœ¬ |
| | `/api/admin/prompts/:id/deploy/:v` | PUT | éƒ¨ç½²ç‰ˆæœ¬ |
| **Skills** | `/api/admin/skills` | GET | Skill åˆ—è¡¨ |
| | `/api/admin/skills/:id` | GET/PUT | Skill è¯¦æƒ…/æ›´æ–° |
| | `/api/admin/skills/:id/test` | POST | æµ‹è¯• Skill |
| **KB** | `/api/admin/kb` | GET | æ–‡æ¡£åˆ—è¡¨ |
| | `/api/admin/kb/upload` | POST | ä¸Šä¼ æ–‡æ¡£ |
| | `/api/admin/kb/:id` | DELETE | åˆ é™¤æ–‡æ¡£ |
| | `/api/admin/kb/reindex` | POST | é‡å»ºç´¢å¼• |
| **Settings** | `/api/admin/settings/models` | GET/PUT | æ¨¡å‹é…ç½® |
| | `/api/admin/settings/features` | GET/PUT | åŠŸèƒ½å¼€å…³ |
| | `/api/admin/settings/params` | GET/PUT | ç³»ç»Ÿå‚æ•° |
| **Audit** | `/api/admin/audit` | GET | å®¡è®¡æ—¥å¿— |

---

## 5. ç»„ä»¶å®ç°

### 5.1 Admin Layout

```typescript
// app/admin/layout.tsx
'use client';

import { useState } from 'react';
import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { cn } from '@/lib/utils';
import {
  LayoutDashboard,
  Users,
  Bot,
  Settings,
  FileText,
  ChevronLeft,
  ChevronRight,
} from 'lucide-react';

const NAV_ITEMS = [
  { href: '/admin', icon: LayoutDashboard, label: 'ä»ªè¡¨ç›˜' },
  { href: '/admin/data', icon: Users, label: 'æ•°æ®ç®¡ç†' },
  { href: '/admin/agents', icon: Bot, label: 'æ™ºèƒ½ä½“å·¥ä½œå®¤' },
  { href: '/admin/settings', icon: Settings, label: 'ç³»ç»Ÿè®¾ç½®' },
  { href: '/admin/audit', icon: FileText, label: 'å®¡è®¡æ—¥å¿—' },
];

export default function AdminLayout({ children }: { children: React.ReactNode }) {
  const [collapsed, setCollapsed] = useState(false);
  const pathname = usePathname();

  return (
    <div className="flex h-screen bg-background">
      {/* Sidebar */}
      <aside
        className={cn(
          'flex flex-col border-r bg-card transition-all duration-300',
          collapsed ? 'w-16' : 'w-64'
        )}
      >
        {/* Logo */}
        <div className="flex h-14 items-center justify-between border-b px-4">
          {!collapsed && (
            <span className="font-semibold text-lg">Fortune Admin</span>
          )}
          <button
            onClick={() => setCollapsed(!collapsed)}
            className="p-1 hover:bg-accent rounded"
          >
            {collapsed ? <ChevronRight size={20} /> : <ChevronLeft size={20} />}
          </button>
        </div>

        {/* Navigation */}
        <nav className="flex-1 p-2 space-y-1">
          {NAV_ITEMS.map((item) => {
            const isActive = pathname === item.href ||
              (item.href !== '/admin' && pathname.startsWith(item.href));
            return (
              <Link
                key={item.href}
                href={item.href}
                className={cn(
                  'flex items-center gap-3 px-3 py-2 rounded-md transition-colors',
                  isActive
                    ? 'bg-primary text-primary-foreground'
                    : 'hover:bg-accent'
                )}
              >
                <item.icon size={20} />
                {!collapsed && <span>{item.label}</span>}
              </Link>
            );
          })}
        </nav>
      </aside>

      {/* Main Content */}
      <main className="flex-1 overflow-auto">
        <div className="p-6">{children}</div>
      </main>
    </div>
  );
}
```

### 5.2 Prompt Editor ç»„ä»¶

```typescript
// components/admin/prompt-editor.tsx
'use client';

import { useState } from 'react';
import Editor from '@monaco-editor/react';
import { Button } from '@/components/ui/button';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Badge } from '@/components/ui/badge';
import { Save, Rocket, GitCompare } from 'lucide-react';

interface PromptEditorProps {
  agentName: string;
  versions: { version: number; isActive: boolean; createdAt: string }[];
  currentContent: string;
  onSave: (content: string) => Promise<void>;
  onDeploy: (version: number) => Promise<void>;
}

export function PromptEditor({
  agentName,
  versions,
  currentContent,
  onSave,
  onDeploy,
}: PromptEditorProps) {
  const [content, setContent] = useState(currentContent);
  const [selectedVersion, setSelectedVersion] = useState(
    versions.find((v) => v.isActive)?.version.toString() || ''
  );
  const [isSaving, setIsSaving] = useState(false);
  const [isDeploying, setIsDeploying] = useState(false);

  const activeVersion = versions.find((v) => v.isActive);

  const handleSave = async () => {
    setIsSaving(true);
    try {
      await onSave(content);
    } finally {
      setIsSaving(false);
    }
  };

  const handleDeploy = async () => {
    setIsDeploying(true);
    try {
      const nextVersion = Math.max(...versions.map((v) => v.version)) + 1;
      await onDeploy(nextVersion);
    } finally {
      setIsDeploying(false);
    }
  };

  return (
    <div className="flex flex-col h-full">
      {/* Header */}
      <div className="flex items-center justify-between p-4 border-b">
        <div className="flex items-center gap-4">
          <h2 className="text-lg font-semibold">{agentName}</h2>
          <Select value={selectedVersion} onValueChange={setSelectedVersion}>
            <SelectTrigger className="w-40">
              <SelectValue placeholder="é€‰æ‹©ç‰ˆæœ¬" />
            </SelectTrigger>
            <SelectContent>
              {versions.map((v) => (
                <SelectItem key={v.version} value={v.version.toString()}>
                  v{v.version} {v.isActive && '(Active)'}
                </SelectItem>
              ))}
              <SelectItem value="draft">Draft</SelectItem>
            </SelectContent>
          </Select>
          {activeVersion && (
            <Badge variant="secondary">
              å½“å‰: v{activeVersion.version}
            </Badge>
          )}
        </div>
        <div className="flex items-center gap-2">
          <Button variant="outline" size="sm">
            <GitCompare className="w-4 h-4 mr-2" />
            Diff
          </Button>
          <Button
            variant="outline"
            size="sm"
            onClick={handleSave}
            disabled={isSaving}
          >
            <Save className="w-4 h-4 mr-2" />
            {isSaving ? 'ä¿å­˜ä¸­...' : 'Save Draft'}
          </Button>
          <Button size="sm" onClick={handleDeploy} disabled={isDeploying}>
            <Rocket className="w-4 h-4 mr-2" />
            {isDeploying ? 'éƒ¨ç½²ä¸­...' : 'Deploy'}
          </Button>
        </div>
      </div>

      {/* Editor */}
      <div className="flex-1">
        <Editor
          height="100%"
          defaultLanguage="markdown"
          value={content}
          onChange={(value) => setContent(value || '')}
          theme="vs-dark"
          options={{
            minimap: { enabled: false },
            fontSize: 14,
            lineNumbers: 'on',
            wordWrap: 'on',
            scrollBeyondLastLine: false,
          }}
        />
      </div>
    </div>
  );
}
```

### 5.3 æ•°æ®è¡¨æ ¼ç»„ä»¶

```typescript
// components/admin/data-table.tsx
'use client';

import {
  ColumnDef,
  flexRender,
  getCoreRowModel,
  getPaginationRowModel,
  getSortedRowModel,
  useReactTable,
} from '@tanstack/react-table';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';

interface DataTableProps<TData, TValue> {
  columns: ColumnDef<TData, TValue>[];
  data: TData[];
  searchPlaceholder?: string;
  onSearch?: (query: string) => void;
}

export function DataTable<TData, TValue>({
  columns,
  data,
  searchPlaceholder = 'æœç´¢...',
  onSearch,
}: DataTableProps<TData, TValue>) {
  const table = useReactTable({
    data,
    columns,
    getCoreRowModel: getCoreRowModel(),
    getPaginationRowModel: getPaginationRowModel(),
    getSortedRowModel: getSortedRowModel(),
  });

  return (
    <div>
      {/* Search */}
      {onSearch && (
        <div className="flex items-center py-4">
          <Input
            placeholder={searchPlaceholder}
            onChange={(e) => onSearch(e.target.value)}
            className="max-w-sm"
          />
        </div>
      )}

      {/* Table */}
      <div className="rounded-md border">
        <Table>
          <TableHeader>
            {table.getHeaderGroups().map((headerGroup) => (
              <TableRow key={headerGroup.id}>
                {headerGroup.headers.map((header) => (
                  <TableHead key={header.id}>
                    {flexRender(
                      header.column.columnDef.header,
                      header.getContext()
                    )}
                  </TableHead>
                ))}
              </TableRow>
            ))}
          </TableHeader>
          <TableBody>
            {table.getRowModel().rows?.length ? (
              table.getRowModel().rows.map((row) => (
                <TableRow key={row.id}>
                  {row.getVisibleCells().map((cell) => (
                    <TableCell key={cell.id}>
                      {flexRender(
                        cell.column.columnDef.cell,
                        cell.getContext()
                      )}
                    </TableCell>
                  ))}
                </TableRow>
              ))
            ) : (
              <TableRow>
                <TableCell colSpan={columns.length} className="h-24 text-center">
                  æš‚æ— æ•°æ®
                </TableCell>
              </TableRow>
            )}
          </TableBody>
        </Table>
      </div>

      {/* Pagination */}
      <div className="flex items-center justify-end space-x-2 py-4">
        <Button
          variant="outline"
          size="sm"
          onClick={() => table.previousPage()}
          disabled={!table.getCanPreviousPage()}
        >
          ä¸Šä¸€é¡µ
        </Button>
        <Button
          variant="outline"
          size="sm"
          onClick={() => table.nextPage()}
          disabled={!table.getCanNextPage()}
        >
          ä¸‹ä¸€é¡µ
        </Button>
      </div>
    </div>
  );
}
```

---

## 6. Prompt çƒ­åŠ è½½æœºåˆ¶

### 6.1 ç¼“å­˜ç­–ç•¥

```typescript
// lib/admin/prompt-loader.ts
import { Redis } from 'ioredis';
import { db } from '@/lib/db';

const redis = new Redis(process.env.REDIS_URL!);
const CACHE_TTL = 300; // 5 minutes

export async function loadActivePrompt(agentName: string, type: string = 'system_prompt'): Promise<string> {
  const cacheKey = `prompt:${agentName}:${type}`;

  // 1. Try cache first
  const cached = await redis.get(cacheKey);
  if (cached) {
    return cached;
  }

  // 2. Load from database
  const result = await db.query(
    `SELECT content FROM admin_prompts
     WHERE agent_name = $1 AND type = $2 AND is_active = TRUE
     LIMIT 1`,
    [agentName, type]
  );

  if (result.rows.length === 0) {
    throw new Error(`No active prompt found for ${agentName}:${type}`);
  }

  const content = result.rows[0].content;

  // 3. Cache for next time
  await redis.setex(cacheKey, CACHE_TTL, content);

  return content;
}

export async function invalidatePromptCache(agentName: string, type: string = 'system_prompt') {
  const cacheKey = `prompt:${agentName}:${type}`;
  await redis.del(cacheKey);
}
```

### 6.2 Agent Runtime é›†æˆ

```typescript
// app/api/chat/route.ts
import { streamText } from 'ai';
import { loadActivePrompt } from '@/lib/admin/prompt-loader';
import { selectModel } from '@/lib/models/model-provider';
import { allSkills } from '@/lib/skills';

export async function POST(req: Request) {
  const { messages, userId, command } = await req.json();

  // ä»æ•°æ®åº“/ç¼“å­˜åŠ è½½ Prompt (æ”¯æŒçƒ­æ›´æ–°)
  const basePrompt = await loadActivePrompt('system', 'base_prompt');
  const stylePrompt = await loadActivePrompt('style_warm', 'system_prompt');

  // è·å–ç”¨æˆ·ä¸Šä¸‹æ–‡
  const context = await fetchUserContext(userId);

  // ç»„è£…æœ€ç»ˆ System Prompt
  const systemPrompt = buildSystemPrompt(basePrompt, stylePrompt, context);

  const result = streamText({
    model: selectModel(context.preference),
    system: systemPrompt,
    messages,
    tools: command ? getToolsForCommand(command) : allSkills,
    maxSteps: 5,
  });

  return result.toDataStreamResponse();
}
```

---

## 7. ä¾èµ–æ¸…å•

```json
{
  "dependencies": {
    "@monaco-editor/react": "^4.6.0",
    "@tanstack/react-table": "^8.10.0",
    "recharts": "^2.10.0",
    "next-auth": "^4.24.0",
    "ioredis": "^5.3.0"
  }
}
```

---

## 8. å®æ–½è®¡åˆ’

| é˜¶æ®µ | æ—¶é—´ | å†…å®¹ |
|:----:|:----:|------|
| P1 | W1 | Admin Layout + Dashboard åŸºç¡€é¡µé¢ |
| P2 | W2 | æ•°æ®ç®¡ç† (Users/Twins) + å®¡è®¡æ—¥å¿— |
| P3 | W3 | Agent Studio (Prompts/Skills) + Monaco é›†æˆ |
| P4 | W4 | Settings + KB ç®¡ç† + Prompt çƒ­åŠ è½½ |
| P5 | W5 | æµ‹è¯• + æƒé™ç»†åŒ– + æ–‡æ¡£å®Œå–„ |

---

*æ–‡æ¡£ç‰ˆæœ¬: v4.2 (Vercel AI SDK Edition)*
*æ›´æ–°æ—¥æœŸ: 2026-01-01*
*å…³è”æ–‡æ¡£: [system_design_final_mvp_v3.md](./system_design_final_mvp_v3.md), [backend_refactoring_plan_v42.md](./backend_refactoring_plan_v42.md)*
