"use client";

/**
 * Relationship Page - Relationship Simulator entry
 * Based on: vibelife spec v3.0
 *
 * Features:
 * - Traditional input mode (enter partner info)
 * - Vibe Link mode (invite partner)
 * - Relationship history
 */

import { useState, useEffect } from "react";
import { useRouter } from "next/navigation";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Types
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type InputMode = "manual" | "vibelink";

interface RelationshipRecord {
  id: string;
  partnerName?: string;
  type: "romantic" | "friend" | "family" | "work";
  createdAt: string;
  hasPartnerJoined: boolean;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Page Component
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export default function RelationshipPage() {
  const router = useRouter();
  const [mode, setMode] = useState<InputMode>("manual");
  const [records, setRecords] = useState<RelationshipRecord[]>([]);
  const [loading, setLoading] = useState(true);

  // Manual mode state
  const [partnerBirthDate, setPartnerBirthDate] = useState("");
  const [partnerBirthTime, setPartnerBirthTime] = useState("");
  const [relationshipType, setRelationshipType] = useState<
    "romantic" | "friend" | "family" | "work"
  >("romantic");

  useEffect(() => {
    // TODO: Fetch relationship records from API
    setLoading(false);
  }, []);

  const handleManualAnalysis = async () => {
    if (!partnerBirthDate) return;

    // TODO: Call API to create relationship analysis
    console.log("Analyzing:", { partnerBirthDate, partnerBirthTime, relationshipType });
  };

  const handleCreateVibeLink = async () => {
    // TODO: Call API to create Vibe Link
    console.log("Creating Vibe Link...");
  };

  return (
    <div className="min-h-screen bg-vellum dark:bg-ink">
      {/* Header */}
      <header className="sticky top-0 z-10 bg-vellum/80 dark:bg-ink/80 backdrop-blur-sm border-b border-gold/10">
        <div className="container mx-auto px-4 py-4 flex items-center gap-4">
          <button
            onClick={() => router.back()}
            className="p-2 hover:bg-gold/10 rounded-lg transition-colors"
          >
            <svg
              className="w-5 h-5 text-ink dark:text-vellum"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M15 19l-7-7 7-7"
              />
            </svg>
          </button>
          <h1 className="font-serif text-xl text-ink dark:text-vellum">
            å…³ç³»æ¨¡æ‹Ÿå™¨
          </h1>
        </div>
      </header>

      {/* Content */}
      <main className="container mx-auto px-4 py-8">
        {/* Mode Toggle */}
        <div className="flex gap-2 mb-8">
          <button
            onClick={() => setMode("manual")}
            className={`flex-1 px-4 py-3 rounded-lg font-medium transition-colors ${
              mode === "manual"
                ? "bg-gold text-white"
                : "bg-white dark:bg-white/5 border border-gold/10 text-muted hover:border-gold/30"
            }`}
          >
            è¾“å…¥å¯¹æ–¹ä¿¡æ¯
          </button>
          <button
            onClick={() => setMode("vibelink")}
            className={`flex-1 px-4 py-3 rounded-lg font-medium transition-colors ${
              mode === "vibelink"
                ? "bg-gold text-white"
                : "bg-white dark:bg-white/5 border border-gold/10 text-muted hover:border-gold/30"
            }`}
          >
            Vibe Link é‚€è¯·
          </button>
        </div>

        {mode === "manual" ? (
          // Manual Input Mode
          <div className="space-y-6">
            <div className="p-6 bg-white dark:bg-white/5 rounded-xl border border-gold/10">
              <h2 className="font-serif text-lg text-ink dark:text-vellum mb-4">
                è¾“å…¥å¯¹æ–¹ä¿¡æ¯
              </h2>

              {/* Birth Date */}
              <div className="mb-4">
                <label className="block text-sm text-muted mb-2">
                  å¯¹æ–¹å‡ºç”Ÿæ—¥æœŸ
                </label>
                <input
                  type="date"
                  value={partnerBirthDate}
                  onChange={(e) => setPartnerBirthDate(e.target.value)}
                  className="w-full px-4 py-2 bg-vellum dark:bg-ink border border-gold/20 rounded-lg focus:border-gold focus:outline-none"
                />
              </div>

              {/* Birth Time (Optional) */}
              <div className="mb-4">
                <label className="block text-sm text-muted mb-2">
                  å‡ºç”Ÿæ—¶é—´ï¼ˆå¯é€‰ï¼‰
                </label>
                <select
                  value={partnerBirthTime}
                  onChange={(e) => setPartnerBirthTime(e.target.value)}
                  className="w-full px-4 py-2 bg-vellum dark:bg-ink border border-gold/20 rounded-lg focus:border-gold focus:outline-none"
                >
                  <option value="">ä¸ç¡®å®š</option>
                  <option value="23-01">å­æ—¶ (23:00-01:00)</option>
                  <option value="01-03">ä¸‘æ—¶ (01:00-03:00)</option>
                  <option value="03-05">å¯…æ—¶ (03:00-05:00)</option>
                  <option value="05-07">å¯æ—¶ (05:00-07:00)</option>
                  <option value="07-09">è¾°æ—¶ (07:00-09:00)</option>
                  <option value="09-11">å·³æ—¶ (09:00-11:00)</option>
                  <option value="11-13">åˆæ—¶ (11:00-13:00)</option>
                  <option value="13-15">æœªæ—¶ (13:00-15:00)</option>
                  <option value="15-17">ç”³æ—¶ (15:00-17:00)</option>
                  <option value="17-19">é…‰æ—¶ (17:00-19:00)</option>
                  <option value="19-21">æˆŒæ—¶ (19:00-21:00)</option>
                  <option value="21-23">äº¥æ—¶ (21:00-23:00)</option>
                </select>
              </div>

              {/* Relationship Type */}
              <div className="mb-6">
                <label className="block text-sm text-muted mb-2">
                  å…³ç³»ç±»å‹
                </label>
                <div className="grid grid-cols-2 gap-2">
                  {[
                    { value: "romantic", label: "ğŸ’• æ‹äºº/ä¼´ä¾£" },
                    { value: "friend", label: "ğŸ‘« æœ‹å‹" },
                    { value: "family", label: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ å®¶äºº" },
                    { value: "work", label: "ğŸ’¼ åŒäº‹" },
                  ].map((option) => (
                    <button
                      key={option.value}
                      onClick={() =>
                        setRelationshipType(
                          option.value as typeof relationshipType
                        )
                      }
                      className={`px-3 py-2 rounded-lg text-sm transition-colors ${
                        relationshipType === option.value
                          ? "bg-gold text-white"
                          : "bg-vellum dark:bg-ink border border-gold/20 hover:border-gold/40"
                      }`}
                    >
                      {option.label}
                    </button>
                  ))}
                </div>
              </div>

              {/* Submit Button */}
              <button
                onClick={handleManualAnalysis}
                disabled={!partnerBirthDate}
                className="w-full py-3 bg-gold text-white rounded-lg hover:bg-gold/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                å¼€å§‹åˆ†æ
              </button>
            </div>

            <p className="text-center text-sm text-muted">
              âš¡ å¿«é€Ÿä½“éªŒï¼šåªéœ€å¯¹æ–¹ç”Ÿæ—¥å³å¯è·å¾—åŸºç¡€åˆ†æ
            </p>
          </div>
        ) : (
          // Vibe Link Mode
          <div className="space-y-6">
            <div className="p-6 bg-white dark:bg-white/5 rounded-xl border border-gold/10 text-center">
              <div className="text-5xl mb-4">ğŸ”—</div>
              <h2 className="font-serif text-xl text-ink dark:text-vellum mb-2">
                Vibe Link
              </h2>
              <p className="text-muted mb-6">
                é‚€è¯·å¯¹æ–¹ä¸€èµ·å‚ä¸ï¼Œè·å¾—åŒå‘æ·±åº¦åˆ†æ
              </p>
              <button
                onClick={handleCreateVibeLink}
                className="px-8 py-3 bg-gold text-white rounded-lg hover:bg-gold/90 transition-colors"
              >
                åˆ›å»ºé‚€è¯·é“¾æ¥
              </button>
            </div>

            <div className="text-center space-y-2 text-sm text-muted">
              <p>ğŸ”’ å¯¹æ–¹ä¿¡æ¯ä»…ç”¨äºå…³ç³»åˆ†æï¼Œä¸ä¼šè¢«ä¿å­˜æˆ–åˆ†äº«</p>
              <p>ğŸ“Š åŒæ–¹éƒ½èƒ½çœ‹åˆ°å„è‡ªè§†è§’çš„åˆ†æç»“æœ</p>
            </div>
          </div>
        )}

        {/* History Section */}
        {!loading && records.length > 0 && (
          <section className="mt-12">
            <h3 className="font-serif text-lg text-ink dark:text-vellum mb-4">
              å†å²è®°å½•
            </h3>
            <div className="space-y-3">
              {records.map((record) => (
                <button
                  key={record.id}
                  onClick={() => router.push(`/relationship/${record.id}`)}
                  className="w-full p-4 bg-white dark:bg-white/5 rounded-xl border border-gold/10 hover:border-gold/30 transition-colors text-left"
                >
                  <div className="flex items-center justify-between">
                    <div>
                      <span className="font-medium text-ink dark:text-vellum">
                        {record.partnerName || "å…³ç³»åˆ†æ"}
                      </span>
                      <span className="ml-2 text-xs text-muted">
                        {record.type === "romantic"
                          ? "ğŸ’•"
                          : record.type === "friend"
                          ? "ğŸ‘«"
                          : record.type === "family"
                          ? "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§"
                          : "ğŸ’¼"}
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      {record.hasPartnerJoined && (
                        <span className="text-xs text-green-600">å·²åŒå‘</span>
                      )}
                      <span className="text-sm text-muted">
                        {new Date(record.createdAt).toLocaleDateString("zh-CN")}
                      </span>
                    </div>
                  </div>
                </button>
              ))}
            </div>
          </section>
        )}
      </main>
    </div>
  );
}
