version: "3.0"
skill_id: lifecoach

tools:
  # ═══════════════════════════════════════════════════════════════════════════
  # 数据工具 (通用 - 所有方法论共享)
  # ═══════════════════════════════════════════════════════════════════════════
  - name: read_lifecoach_state
    description: |
      读取用户的人生地图状态。支持读取以下部分：
      - system: 系统配置（方法论选择）
      - north_star: 北极星（愿景、反愿景、使命、原则）
      - goals: 核心目标/角色目标
      - roadmap: 路线图（年度、季度）
      - current: 当前焦点（月度项目、周大石头、每日行动）
      - identity: 身份设计
      - progress: 进度追踪
      - journal: 复盘日志/功过格
    type: data
    when_to_call: 每次对话开始时，或需要了解用户当前状态时
    parameters:
      - name: sections
        type: array
        description: 要读取的部分
        default: ["system", "north_star", "current", "progress"]

  - name: write_lifecoach_state
    description: 写入用户的人生地图状态。支持局部更新，深度合并。
    type: data
    when_to_call: 完成愿景设计、目标设定、计划制定后保存状态
    parameters:
      - name: section
        type: string
        required: true
        enum: [system, north_star, goals, roadmap, current, identity, progress]
        description: 要写入的部分
      - name: data
        type: object
        required: true
        description: 要写入的数据

  - name: add_journal_entry
    description: 添加日志条目（复盘/功过格/洞察）
    type: data
    when_to_call: 用户完成复盘或有重要洞察时
    parameters:
      - name: entry_type
        type: string
        required: true
        enum: [daily, weekly, monthly, insight, milestone]
        description: 日志类型
      - name: content
        type: string
        description: 日志内容
      - name: wins
        type: array
        description: 胜利/善行
      - name: struggles
        type: array
        description: 挑战/过错
      - name: merits
        type: array
        description: 功过格-功（了凡四训）
      - name: demerits
        type: array
        description: 功过格-过（了凡四训）

  - name: update_progress
    description: 更新进度/签到
    type: data
    when_to_call: 用户完成每日行动或签到时
    parameters:
      - name: action_type
        type: string
        required: true
        enum: [daily_checkin, task_complete, milestone_reached]
        description: 行动类型
      - name: notes
        type: string
        description: 备注

  # ═══════════════════════════════════════════════════════════════════════════
  # 展示工具 - 公用卡片（所有方法论共享）
  # ═══════════════════════════════════════════════════════════════════════════
  - name: show_skill_intro
    description: |
      展示 Skill 介绍卡片。用于首次使用或用户想了解功能时。
      卡片包含：功能介绍、快速开始提示、订阅状态。
    type: display
    card_type: skill_intro
    when_to_call: |
      - 用户首次使用此 Skill 时
      - 用户问"这个能做什么"、"有什么功能"时
      - 用户说"介绍一下"、"帮助"时
    parameters:
      - name: variant
        type: string
        enum: [full, compact, mini]
        default: compact
        description: 卡片变体（full=完整版, compact=精简版, mini=迷你版）
      - name: reason
        type: string
        description: 展示原因（如"首次使用"、"功能介绍"）

  - name: show_action_plan
    description: 展示行动计划卡片（公用）
    type: display
    card_type: action_plan
    when_to_call: 为用户设计具体行动后
    parameters:
      - name: long_term_goal
        type: string
        description: 长期目标
      - name: medium_term_goal
        type: string
        description: 中期目标
      - name: daily_actions
        type: array
        required: true
        description: 每日行动列表
      - name: first_step
        type: string
        description: 立即可做的第一步

  - name: show_progress_streak
    description: 展示进度统计卡片（公用）
    type: display
    card_type: progress_streak
    when_to_call: 用户签到后或查看进度时
    parameters:
      - name: current_streak
        type: integer
        required: true
        description: 当前连续天数
      - name: longest_streak
        type: integer
        description: 最长连续天数
      - name: total_checkins
        type: integer
        description: 总签到次数
      - name: completion_rate
        type: number
        description: 完成率 0-100
      - name: framework_stats
        type: object
        description: 方法论特定统计

  # Protocol 内联卡片 - 嵌入对话流展示协议进度
  - name: show_protocol_progress
    description: 展示 Protocol 进度卡片（内联嵌入对话流）
    type: display
    card_type: protocol_progress
    when_to_call: Protocol 执行过程中，更新进度时
    parameters:
      - name: protocol_id
        type: string
        required: true
        description: Protocol ID（如 dankoe_vision）
      - name: protocol_name
        type: string
        required: true
        description: Protocol 名称（如"愿景设计"）
      - name: step
        type: integer
        required: true
        description: 当前步骤（1-based）
      - name: total
        type: integer
        required: true
        description: 总步骤数
      - name: phase
        type: string
        required: true
        description: 当前阶段 ID（如 Phase 1）
      - name: phase_name
        type: string
        required: true
        description: 阶段名称（如"勾勒愿景画面"）
      - name: is_completed
        type: boolean
        default: false
        description: 是否已完成

  - name: show_protocol_step
    description: 展示 Protocol 步骤内容卡片（内联嵌入对话流）
    type: display
    card_type: protocol_step
    when_to_call: Protocol 进入新步骤，向用户展示引导内容时
    parameters:
      - name: step_number
        type: integer
        required: true
        description: 步骤编号
      - name: step_name
        type: string
        required: true
        description: 步骤名称
      - name: content
        type: string
        required: true
        description: 步骤内容/引导文字
      - name: is_question
        type: boolean
        default: false
        description: 是否为问题步骤（需要用户回答）
      - name: options
        type: array
        description: 选项列表（每项包含 key 和 label）

  - name: show_protocol_completion
    description: 展示 Protocol 完成卡片（内联嵌入对话流）
    type: display
    card_type: protocol_completion
    when_to_call: Protocol 全部完成时
    parameters:
      - name: protocol_name
        type: string
        required: true
        description: Protocol 名称
      - name: completed_steps
        type: integer
        required: true
        description: 已完成步骤数
      - name: total_steps
        type: integer
        required: true
        description: 总步骤数
      - name: summary
        type: string
        required: true
        description: 完成总结
      - name: next_actions
        type: array
        description: 建议下一步行动列表

  # Protocol 辅助工具 - 简化协议执行
  - name: start_protocol
    description: |
      启动一个 Protocol 协议流程
      自动读取配置、初始化状态、返回第一步数据
    type: protocol
    when_to_call: 用户确认要开始一个方法论协议时
    parameters:
      - name: protocol_id
        type: string
        required: true
        enum: [dankoe, covey, yangming, liaofan]
        description: Protocol ID（如 dankoe）

  - name: continue_protocol
    description: |
      继续执行 Protocol，保存当前答案并获取下一步
      自动管理状态、返回下一步数据或完成信息
    type: protocol
    when_to_call: 用户回答了当前步骤的问题后
    parameters:
      - name: protocol_id
        type: string
        required: true
        description: Protocol ID
      - name: current_step
        type: integer
        required: true
        description: 当前步骤编号
      - name: user_answer
        type: string
        required: true
        description: 用户的回答
      - name: answer_data
        type: object
        description: 结构化答案数据（如数组、对象）

  # ═══════════════════════════════════════════════════════════════════════════
  # 展示工具 - 方法论专属卡片（每个方法论一个）
  # ═══════════════════════════════════════════════════════════════════════════

  # Dan Koe 专属卡片
  - name: show_dankoe
    description: |
      展示 Dan Koe 方法论卡片
      整合：愿景、反愿景、身份、目标层级、游戏化框架
    type: display
    card_type: dankoe
    when_to_call: 完成 Dan Koe 协议后展示整体设计
    parameters:
      - name: vision
        type: object
        required: true
        description: |
          愿景信息 {
            statement: 一句话愿景,
            scene: 3年后的周二场景,
            identity: 新身份 "我是那种..."
          }
      - name: anti_vision
        type: object
        required: true
        description: |
          反愿景信息 {
            statement: 一句话反愿景,
            scene: 5年后的周二场景
          }
      - name: game_elements
        type: object
        required: true
        description: |
          游戏化元素 {
            main_mission: 一年目标/主线任务,
            current_boss: 月度项目/Boss战,
            daily_quests: 每日杠杆/任务,
            rules: 约束条件/游戏规则
          }

  # Covey 专属卡片
  - name: show_covey
    description: |
      展示 Covey 方法论卡片
      整合：使命宣言、角色目标、大石头、平衡度
    type: display
    card_type: covey
    when_to_call: 完成 Covey 协议后展示整体设计
    parameters:
      - name: mission
        type: string
        description: 使命宣言
      - name: principles
        type: array
        description: 核心原则
      - name: roles
        type: array
        required: true
        description: |
          角色列表，每个包含 {
            id: 角色ID,
            name: 角色名,
            icon: 图标,
            year_target: 年度目标,
            weekly_rocks: 本周大石头,
            score: 本周得分 0-10
          }
      - name: balance_score
        type: number
        description: 整体平衡分数 0-100
      - name: insight
        type: string
        description: 平衡洞察

  # 王阳明 专属卡片
  - name: show_yangming
    description: |
      展示王阳明方法论卡片
      整合：良知、私欲、知行差距、日课
    type: display
    card_type: yangming
    when_to_call: 完成王阳明协议后展示整体设计
    parameters:
      - name: aspiration
        type: string
        required: true
        description: 志向（良知指引的方向）
      - name: conscience_voice
        type: string
        required: true
        description: 良知的声音（内心知道应该做什么）
      - name: desire_obstacles
        type: array
        description: 私欲/习气（阻碍知行合一的）
      - name: daily_practice
        type: object
        description: |
          日课 {
            morning_intention: 晨起立志,
            practice_focus: 事上磨练重点,
            evening_reflection: 晚间省察
          }
      - name: recent_reflections
        type: array
        description: 近期省察记录摘要

  # 了凡四训 专属卡片
  - name: show_liaofan
    description: |
      展示了凡四训方法论卡片
      整合：立命志向、功过统计、改命进度
    type: display
    card_type: liaofan
    when_to_call: 完成了凡四训协议后展示整体设计
    parameters:
      - name: fate_transform
        type: object
        required: true
        description: |
          改命信息 {
            original_fate: 原命轨迹,
            new_fate: 立命志向
          }
      - name: merit_stats
        type: object
        required: true
        description: |
          功过统计 {
            total_merits: 累计功,
            total_demerits: 累计过,
            net_karma: 净值,
            trend: improving/stable/declining
          }
      - name: category_breakdown
        type: object
        description: "按类别统计 {与人为善: 5, 舍财作福: 3, ...}"
      - name: recent_entries
        type: array
        description: 近期功过记录
      - name: milestones
        type: array
        description: 改命里程碑

  # ═══════════════════════════════════════════════════════════════════════════
  # 协议管理工具 - REFACTOR_PLAN.md Phase 2
  # ═══════════════════════════════════════════════════════════════════════════
  - name: show_protocol_invitation
    description: |
      向用户推荐开始一个协议（如 Dan Koe 快速重置）。

      这是协议流的入口工具，用于向用户展示协议邀请卡片。
      前端收到后会显示邀请卡片，提示用户回复"准备好了"或"开始"来启动协议。

      调用时机：
      - 检测到用户迷茫、困惑时
      - 用户表达想要设定目标时
      - 用户寻求方向指引时
      - 探索对话识别出 2-3 个核心困扰后

      注意：
      - 只推荐适合当前用户状态的协议
      - 不要频繁推荐，避免打扰
      - 如果用户正在执行协议，不要推荐其他协议
    type: display
    card_type: protocol_invitation
    when_to_call: 检测到用户需要时，推荐开始协议
    parameters:
      - name: protocol_id
        type: string
        required: true
        enum: [dankoe, covey, yangming, liaofan]
        description: |
          协议ID：
          - dankoe: Dan Koe 快速重置
          - covey: Covey 角色目标设定
          - yangming: 王阳明立志省察
          - liaofan: 了凡四训改命
      - name: title
        type: string
        required: true
        description: 协议标题，如 "Dan Koe 快速重置"
      - name: description
        type: string
        required: true
        description: 协议描述，简要说明协议能帮助用户做什么
      - name: estimated_time
        type: string
        description: 预计时间，如 "10分钟"
      - name: total_steps
        type: integer
        description: 总步骤数，如 6

  - name: advance_protocol_step
    description: |
      完成当前协议步骤，保存数据并进入下一步。

      这是协议流的核心工具，用于推进协议进度。
      在用户回答完当前步骤的问题后调用此工具。

      工作流程：
      1. LLM 提出问题
      2. 用户回答
      3. LLM 调用此工具保存数据
      4. 系统自动更新协议状态（step + 1）
      5. LLM 自动过渡到下一个问题

      调用时机：
      - 用户回答完协议中的一个问题后
      - 确认用户的回答有效后
      - 在过渡到下一个问题之前

      注意：
      - 步骤推进由 chat_v5.py 路由层自动处理
      - 此工具只负责保存当前步骤的数据
      - 不要跳过步骤或回退步骤
    type: data
    when_to_call: 用户回答完协议问题后，保存数据
    parameters:
      - name: step_data
        type: object
        required: true
        description: |
          当前步骤收集的数据，会保存到 protocol.data.step_{N}

          示例：
          {
            "pain_points": ["工作没意义", "总是拖延"],
            "anti_vision_scene": "5年后的周二，依然..."
          }
      - name: step_summary
        type: string
        required: false
        description: |
          对用户回答的简短总结，便于后续回顾。
          示例："用户提到工作缺乏意义，希望通过创作实现自由"

  - name: cancel_protocol
    description: |
      取消当前协议。

      用户可能因为各种原因需要中断协议：
      - 暂时没有时间
      - 发现协议不适合自己
      - 想换一个协议

      调用时机：
      - 用户明确表示"我不想继续了"
      - 用户说"停止"、"取消"
      - 用户长时间不回应

      注意：
      - 取消前应确认用户意图
      - 已收集的数据会保留
      - 用户可以随时重新开始协议
    type: data
    when_to_call: 用户明确要求取消协议时
    parameters:
      - name: reason
        type: string
        required: false
        description: |
          取消原因（可选），如：
          - "用户暂时没有时间"
          - "用户想换一个协议"
          - "用户不想继续"

