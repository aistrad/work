<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Fortune AI - 生成你的星盘</title>
  <style>
    /* ========== Reset & Base ========== */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #000000;
      --surface: #0a0a0a;
      --text: #ffffff;
      --text-muted: #888888;
      --text-dim: #555555;
      --gold: #FFD700;
      --gold-dim: #C9A227;
      --border: #222222;
      --radius: 12px;
      --font: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", "PingFang SC", sans-serif;
    }

    html, body {
      height: 100%;
      font-family: var(--font);
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }

    /* ========== Page Container ========== */
    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 24px 60px;
      position: relative;
      overflow: hidden;
    }

    /* ========== Background Stars ========== */
    .bg-stars {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
    }
    .bg-star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: var(--gold);
      border-radius: 50%;
      opacity: 0.3;
      animation: twinkle-bg 3s ease-in-out infinite;
    }
    @keyframes twinkle-bg {
      0%, 100% { opacity: 0.2; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.2); }
    }

    /* ========== Hero SVG ========== */
    .hero-container {
      position: relative;
      width: 220px;
      height: 220px;
      margin-bottom: 32px;
      z-index: 1;
    }

    .astro-chart {
      width: 100%;
      height: 100%;
    }

    /* Star twinkle animations */
    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }
    @keyframes twinkle-delay {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 0.9; }
    }
    @keyframes pulse-glow {
      0%, 100% { filter: drop-shadow(0 0 2px var(--gold)); }
      50% { filter: drop-shadow(0 0 8px var(--gold)); }
    }
    @keyframes rotate-slow {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .star-1 { animation: twinkle 2s ease-in-out infinite; }
    .star-2 { animation: twinkle 2.5s ease-in-out infinite 0.3s; }
    .star-3 { animation: twinkle 3s ease-in-out infinite 0.7s; }
    .star-4 { animation: twinkle-delay 2.2s ease-in-out infinite 0.5s; }
    .star-5 { animation: twinkle 2.8s ease-in-out infinite 1s; }
    .star-6 { animation: twinkle-delay 3.2s ease-in-out infinite 0.2s; }

    .center-symbols { animation: pulse-glow 4s ease-in-out infinite; }
    .outer-ring { animation: rotate-slow 120s linear infinite; }

    /* ========== Typography ========== */
    .title {
      font-size: 24px;
      font-weight: 600;
      letter-spacing: -0.5px;
      text-align: center;
      margin-bottom: 8px;
      z-index: 1;
    }

    .subtitle {
      font-size: 15px;
      color: var(--text-muted);
      text-align: center;
      margin-bottom: 40px;
      z-index: 1;
    }

    /* ========== Form Container ========== */
    .form-container {
      width: 100%;
      max-width: 400px;
      z-index: 1;
    }

    /* ========== Form Labels ========== */
    .form-label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }
    .form-label .required {
      color: var(--gold);
    }

    /* ========== Wheel Picker ========== */
    .picker-group {
      margin-bottom: 28px;
    }

    .wheel-container {
      display: flex;
      gap: 8px;
      justify-content: center;
    }

    .wheel {
      position: relative;
      width: 80px;
      height: 160px;
      overflow: hidden;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
    }
    .wheel.wide { width: 100px; }

    .wheel-inner {
      position: absolute;
      width: 100%;
      top: 50%;
      transform: translateY(-50%);
      transition: transform 0.15s ease-out;
    }

    .wheel-item {
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 500;
      color: var(--text-dim);
      cursor: pointer;
      transition: all 0.15s ease;
      user-select: none;
    }
    .wheel-item.selected {
      color: var(--text);
      font-size: 22px;
      font-weight: 600;
    }
    .wheel-item:hover:not(.selected) {
      color: var(--text-muted);
    }

    /* Selection highlight */
    .wheel::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 42px;
      transform: translateY(-50%);
      border-top: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      pointer-events: none;
      z-index: 1;
    }

    /* Fade masks */
    .wheel::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to bottom,
        var(--surface) 0%,
        transparent 30%,
        transparent 70%,
        var(--surface) 100%
      );
      pointer-events: none;
      z-index: 2;
    }

    .wheel-label {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 1px;
      z-index: 3;
    }

    /* ========== City Input ========== */
    .city-input-group {
      margin-bottom: 32px;
    }

    .city-input {
      width: 100%;
      padding: 14px 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text);
      font-size: 16px;
      font-family: var(--font);
      outline: none;
      transition: border-color 0.2s ease;
    }
    .city-input::placeholder {
      color: var(--text-dim);
    }
    .city-input:focus {
      border-color: var(--gold-dim);
    }

    /* ========== CTA Button ========== */
    .cta-btn {
      width: 100%;
      padding: 16px 24px;
      background: var(--text);
      color: var(--bg);
      border: none;
      border-radius: var(--radius);
      font-size: 16px;
      font-weight: 600;
      font-family: var(--font);
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 16px;
    }
    .cta-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(255,255,255,0.15);
    }
    .cta-btn:active {
      transform: translateY(0);
    }
    .cta-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* ========== Secondary Link ========== */
    .secondary-link {
      display: block;
      text-align: center;
      color: var(--text-muted);
      font-size: 14px;
      text-decoration: none;
      transition: color 0.2s ease;
    }
    .secondary-link:hover {
      color: var(--text);
    }

    /* ========== Trust Note ========== */
    .trust-note {
      text-align: center;
      font-size: 12px;
      color: var(--text-dim);
      margin-top: 32px;
      line-height: 1.6;
    }

    /* ========== Loading State ========== */
    .loading .cta-btn {
      position: relative;
      color: transparent;
    }
    .loading .cta-btn::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      top: 50%;
      left: 50%;
      margin: -10px 0 0 -10px;
      border: 2px solid var(--bg);
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ========== Error State ========== */
    .error-msg {
      background: rgba(220, 38, 38, 0.1);
      border: 1px solid rgba(220, 38, 38, 0.3);
      color: #fca5a5;
      padding: 12px 16px;
      border-radius: var(--radius);
      font-size: 14px;
      margin-bottom: 20px;
      display: none;
    }
    .error-msg.show {
      display: block;
    }

    /* ========== Responsive ========== */
    @media (max-width: 480px) {
      .page {
        padding: 32px 20px 48px;
      }
      .hero-container {
        width: 180px;
        height: 180px;
        margin-bottom: 24px;
      }
      .title {
        font-size: 22px;
      }
      .wheel {
        width: 70px;
        height: 140px;
      }
      .wheel.wide {
        width: 88px;
      }
      .wheel-item {
        height: 35px;
        font-size: 16px;
      }
      .wheel-item.selected {
        font-size: 20px;
      }
      .wheel::before {
        height: 37px;
      }
    }

    /* ========== Touch Scrolling for Wheels ========== */
    .wheel {
      touch-action: pan-y;
      -webkit-overflow-scrolling: touch;
    }
  </style>
</head>
<body>
  <!-- Background Stars -->
  <div class="bg-stars" id="bgStars"></div>

  <div class="page">
    <!-- Hero SVG -->
    <div class="hero-container">
      <svg class="astro-chart" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <!-- Outer rotating ring -->
        <g class="outer-ring" transform-origin="100 100">
          <circle cx="100" cy="100" r="90" fill="none" stroke="#222" stroke-width="0.5"/>
          <circle cx="100" cy="100" r="75" fill="none" stroke="#333" stroke-width="0.5"/>

          <!-- 12 house divisions -->
          <g stroke="#333" stroke-width="0.5">
            <line x1="100" y1="10" x2="100" y2="25"/>
            <line x1="145" y1="22.68" x2="138.75" y2="35.01" transform="rotate(30 100 100)"/>
            <line x1="177.32" y1="55" x2="164.99" y2="61.25" transform="rotate(60 100 100)"/>
            <line x1="190" y1="100" x2="175" y2="100"/>
            <line x1="177.32" y1="145" x2="164.99" y2="138.75" transform="rotate(-60 100 100)"/>
            <line x1="145" y1="177.32" x2="138.75" y2="164.99" transform="rotate(-30 100 100)"/>
            <line x1="100" y1="190" x2="100" y2="175"/>
            <line x1="55" y1="177.32" x2="61.25" y2="164.99" transform="rotate(30 100 100)"/>
            <line x1="22.68" y1="145" x2="35.01" y2="138.75" transform="rotate(60 100 100)"/>
            <line x1="10" y1="100" x2="25" y2="100"/>
            <line x1="22.68" y1="55" x2="35.01" y2="61.25" transform="rotate(-60 100 100)"/>
            <line x1="55" y1="22.68" x2="61.25" y2="35.01" transform="rotate(-30 100 100)"/>
          </g>
        </g>

        <!-- Inner circle -->
        <circle cx="100" cy="100" r="50" fill="none" stroke="#444" stroke-width="0.5"/>

        <!-- Center symbols with glow -->
        <g class="center-symbols">
          <text x="82" y="105" font-size="18" fill="#FFD700" font-family="serif">☉</text>
          <text x="100" y="105" font-size="16" fill="#C0C0C0" font-family="serif">☽</text>
          <text x="116" y="105" font-size="14" fill="#FFD700" font-family="serif">↑</text>
        </g>

        <!-- Decorative stars -->
        <text x="25" y="35" font-size="10" fill="#FFD700" class="star-1">✦</text>
        <text x="170" y="45" font-size="8" fill="#FFD700" class="star-2">✧</text>
        <text x="35" y="165" font-size="6" fill="#FFD700" class="star-3">·</text>
        <text x="160" y="160" font-size="9" fill="#FFD700" class="star-4">✦</text>
        <text x="50" y="80" font-size="5" fill="#FFD700" class="star-5">✧</text>
        <text x="145" y="130" font-size="7" fill="#FFD700" class="star-6">·</text>
        <text x="85" y="30" font-size="6" fill="#FFD700" class="star-2">✦</text>
        <text x="115" y="175" font-size="8" fill="#FFD700" class="star-4">✧</text>
        <text x="20" y="110" font-size="5" fill="#FFD700" class="star-1">·</text>
        <text x="180" y="95" font-size="7" fill="#FFD700" class="star-3">✦</text>
      </svg>
    </div>

    <!-- Title -->
    <h1 class="title">用你的出生信息，生成今天的「行动处方」</h1>
    <p class="subtitle">先给你 30 秒的个人洞察；想保存再注册</p>

    <!-- Form -->
    <div class="form-container">
      <div id="errorMsg" class="error-msg"></div>

      <!-- Birth Date -->
      <div class="picker-group">
        <div class="form-label">
          出生日期 <span class="required">*</span>
        </div>
        <div class="wheel-container">
          <div class="wheel wide" id="yearWheel">
            <div class="wheel-inner" id="yearInner"></div>
            <span class="wheel-label">年</span>
          </div>
          <div class="wheel" id="monthWheel">
            <div class="wheel-inner" id="monthInner"></div>
            <span class="wheel-label">月</span>
          </div>
          <div class="wheel" id="dayWheel">
            <div class="wheel-inner" id="dayInner"></div>
            <span class="wheel-label">日</span>
          </div>
        </div>
      </div>

      <!-- Birth Time -->
      <div class="picker-group">
        <div class="form-label">
          出生时间 <span class="required">*</span>
        </div>
        <div class="wheel-container">
          <div class="wheel" id="hourWheel">
            <div class="wheel-inner" id="hourInner"></div>
            <span class="wheel-label">时</span>
          </div>
          <div class="wheel" id="minuteWheel">
            <div class="wheel-inner" id="minuteInner"></div>
            <span class="wheel-label">分</span>
          </div>
        </div>
      </div>

      <!-- City (Optional) -->
      <div class="city-input-group">
        <div class="form-label">
          出生地点 <span style="color: var(--text-dim)">（可选，提高准确度）</span>
        </div>
        <input type="text" class="city-input" id="cityInput" placeholder="搜索城市..." autocomplete="off">
      </div>

      <!-- CTA -->
      <button class="cta-btn" id="submitBtn">生成我的星盘</button>

      <!-- Secondary Link -->
      <a href="#" class="secondary-link" id="demoLink">先随便看看示例 →</a>

      <!-- Trust Note -->
      <p class="trust-note">仅用于生成个人画像与每日建议，可随时删除</p>
    </div>
  </div>

  <script>
    // ========== Background Stars Generator ==========
    (function() {
      const container = document.getElementById('bgStars');
      const starCount = 50;
      for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.className = 'bg-star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.animationDelay = Math.random() * 3 + 's';
        star.style.animationDuration = (2 + Math.random() * 2) + 's';
        container.appendChild(star);
      }
    })();

    // ========== Wheel Picker Logic ==========
    class WheelPicker {
      constructor(wheelEl, innerEl, items, defaultIndex = 0) {
        this.wheel = wheelEl;
        this.inner = innerEl;
        this.items = items;
        this.selectedIndex = defaultIndex;
        this.itemHeight = wheelEl.offsetWidth < 75 ? 35 : 40;
        this.isDragging = false;
        this.startY = 0;
        this.startOffset = 0;
        this.currentOffset = 0;
        this.velocity = 0;
        this.lastY = 0;
        this.lastTime = 0;

        this.render();
        this.bindEvents();
        this.scrollToIndex(defaultIndex, false);
      }

      render() {
        this.inner.innerHTML = this.items.map((item, i) =>
          `<div class="wheel-item${i === this.selectedIndex ? ' selected' : ''}" data-index="${i}">${item}</div>`
        ).join('');
      }

      bindEvents() {
        // Touch events
        this.wheel.addEventListener('touchstart', this.onStart.bind(this), { passive: true });
        this.wheel.addEventListener('touchmove', this.onMove.bind(this), { passive: false });
        this.wheel.addEventListener('touchend', this.onEnd.bind(this));

        // Mouse events
        this.wheel.addEventListener('mousedown', this.onStart.bind(this));
        document.addEventListener('mousemove', this.onMove.bind(this));
        document.addEventListener('mouseup', this.onEnd.bind(this));

        // Click on item
        this.inner.addEventListener('click', (e) => {
          const item = e.target.closest('.wheel-item');
          if (item) {
            const index = parseInt(item.dataset.index);
            this.scrollToIndex(index);
          }
        });
      }

      getY(e) {
        return e.touches ? e.touches[0].clientY : e.clientY;
      }

      onStart(e) {
        this.isDragging = true;
        this.startY = this.getY(e);
        this.startOffset = this.currentOffset;
        this.velocity = 0;
        this.lastY = this.startY;
        this.lastTime = Date.now();
        this.inner.style.transition = 'none';
      }

      onMove(e) {
        if (!this.isDragging) return;
        e.preventDefault();

        const y = this.getY(e);
        const delta = y - this.startY;
        this.currentOffset = this.startOffset + delta;

        // Calculate velocity
        const now = Date.now();
        const dt = now - this.lastTime;
        if (dt > 0) {
          this.velocity = (y - this.lastY) / dt;
        }
        this.lastY = y;
        this.lastTime = now;

        this.inner.style.transform = `translateY(calc(-50% + ${this.currentOffset}px))`;
      }

      onEnd() {
        if (!this.isDragging) return;
        this.isDragging = false;

        // Apply momentum
        const momentum = this.velocity * 100;
        const targetOffset = this.currentOffset + momentum;

        // Calculate nearest index
        const index = Math.round(-targetOffset / this.itemHeight);
        const clampedIndex = Math.max(0, Math.min(this.items.length - 1, index));

        this.scrollToIndex(clampedIndex);
      }

      scrollToIndex(index, animate = true) {
        this.selectedIndex = index;
        this.currentOffset = -index * this.itemHeight;

        this.inner.style.transition = animate ? 'transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)' : 'none';
        this.inner.style.transform = `translateY(calc(-50% + ${this.currentOffset}px))`;

        // Update selected class
        this.inner.querySelectorAll('.wheel-item').forEach((el, i) => {
          el.classList.toggle('selected', i === index);
        });

        // Dispatch change event
        this.wheel.dispatchEvent(new CustomEvent('change', { detail: { index, value: this.items[index] } }));
      }

      getValue() {
        return this.items[this.selectedIndex];
      }

      getIndex() {
        return this.selectedIndex;
      }

      setItems(items, defaultIndex = 0) {
        this.items = items;
        this.render();
        this.scrollToIndex(Math.min(defaultIndex, items.length - 1), false);
      }
    }

    // ========== Initialize Pickers ==========
    const currentYear = new Date().getFullYear();
    const years = [];
    for (let y = currentYear; y >= 1920; y--) years.push(y);

    const months = [];
    for (let m = 1; m <= 12; m++) months.push(m);

    const hours = [];
    for (let h = 0; h < 24; h++) hours.push(h.toString().padStart(2, '0'));

    const minutes = [];
    for (let m = 0; m < 60; m++) minutes.push(m.toString().padStart(2, '0'));

    function getDaysInMonth(year, month) {
      return new Date(year, month, 0).getDate();
    }

    function generateDays(year, month) {
      const daysCount = getDaysInMonth(year, month);
      const days = [];
      for (let d = 1; d <= daysCount; d++) days.push(d);
      return days;
    }

    // Default to 1990-01-01 12:00
    const defaultYear = 1990;
    const defaultMonth = 1;
    const defaultDay = 1;
    const defaultHour = 12;
    const defaultMinute = 0;

    let yearPicker, monthPicker, dayPicker, hourPicker, minutePicker;

    document.addEventListener('DOMContentLoaded', () => {
      yearPicker = new WheelPicker(
        document.getElementById('yearWheel'),
        document.getElementById('yearInner'),
        years,
        years.indexOf(defaultYear)
      );

      monthPicker = new WheelPicker(
        document.getElementById('monthWheel'),
        document.getElementById('monthInner'),
        months,
        defaultMonth - 1
      );

      dayPicker = new WheelPicker(
        document.getElementById('dayWheel'),
        document.getElementById('dayInner'),
        generateDays(defaultYear, defaultMonth),
        defaultDay - 1
      );

      hourPicker = new WheelPicker(
        document.getElementById('hourWheel'),
        document.getElementById('hourInner'),
        hours,
        defaultHour
      );

      minutePicker = new WheelPicker(
        document.getElementById('minuteWheel'),
        document.getElementById('minuteInner'),
        minutes,
        defaultMinute
      );

      // Update days when year/month changes
      function updateDays() {
        const year = parseInt(yearPicker.getValue());
        const month = parseInt(monthPicker.getValue());
        const currentDay = dayPicker.getIndex();
        const newDays = generateDays(year, month);
        dayPicker.setItems(newDays, Math.min(currentDay, newDays.length - 1));
      }

      document.getElementById('yearWheel').addEventListener('change', updateDays);
      document.getElementById('monthWheel').addEventListener('change', updateDays);

      // Submit handler
      document.getElementById('submitBtn').addEventListener('click', handleSubmit);

      // Demo link
      document.getElementById('demoLink').addEventListener('click', (e) => {
        e.preventDefault();
        // Navigate to demo or show sample
        window.location.href = '/bazi2?demo=1';
      });
    });

    async function handleSubmit() {
      const btn = document.getElementById('submitBtn');
      const errorMsg = document.getElementById('errorMsg');

      // Get values
      const year = yearPicker.getValue();
      const month = monthPicker.getValue().toString().padStart(2, '0');
      const day = dayPicker.getValue().toString().padStart(2, '0');
      const hour = hourPicker.getValue();
      const minute = minutePicker.getValue();
      const city = document.getElementById('cityInput').value.trim();

      const birthDate = `${year}-${month}-${day}`;
      const birthTime = `${hour}:${minute}:00`;

      // Show loading
      btn.disabled = true;
      btn.parentElement.classList.add('loading');
      errorMsg.classList.remove('show');

      try {
        // Store birth info in session/localStorage for the next step
        const birthInfo = {
          birth_date: birthDate,
          birth_time: birthTime,
          location_name: city || '北京',
          tz_offset_hours: 8,
          // Default coordinates for Beijing if no city specified
          longitude: 116.4074,
          latitude: 39.9042
        };

        sessionStorage.setItem('fortune_birth_info', JSON.stringify(birthInfo));

        // Navigate to the instant analysis page
        window.location.href = `/bazi2?birth_date=${birthDate}&birth_time=${encodeURIComponent(birthTime)}&location=${encodeURIComponent(city || '北京')}`;

      } catch (err) {
        errorMsg.textContent = err.message || '发生错误，请重试';
        errorMsg.classList.add('show');
      } finally {
        btn.disabled = false;
        btn.parentElement.classList.remove('loading');
      }
    }
  </script>
</body>
</html>
