version: "3.0"
skill_id: core
description: V9 Core 全局工具 - 7 个原子工具

# ═══════════════════════════════════════════════════════════════════════════
# 1. 路由工具
# ═══════════════════════════════════════════════════════════════════════════
routing:
  - name: activate_skills
    phase1: true  # Phase 1 可用
    description: |
      激活一个或多个 Skill。

      ## 何时调用
      - 用户意图明确需要某个 Skill 时
      - 用户说"帮我算命" → activate_skills(["bazi"])
      - 用户说"看职业运势" → activate_skills(["bazi", "career"])
      - 用户说"看合盘" → activate_skills(["synastry"])

      ## 可用 Skills
      - bazi: 八字命理（触发词：八字、命理、算命、排盘）
      - zodiac: 西方占星（触发词：星座、星盘、占星、运势）
      - tarot: 塔罗占卜（触发词：塔罗、抽牌、占卜）
      - career: 职业规划（触发词：职业、工作、跳槽、创业）
      - psych: 心理探索（触发词：心理、情绪、焦虑）
      - mindfulness: 正念练习（触发词：冥想、正念、放松）
      - lifecoach: 人生教练（触发词：目标、计划、教练）
      - vibe_id: 四维人格（触发词：性格、人格、画像）
      - jungastro: 荣格占星（触发词：荣格、心理占星）
      - synastry: 关系合盘（触发词：合盘、关系、配对）
    parameters:
      - name: skills
        type: array
        required: true
        description: 要激活的 Skill ID 列表
      - name: rule
        type: string
        required: false
        description: 可选的规则 ID，用于指定具体场景

# ═══════════════════════════════════════════════════════════════════════════
# 2. 收集工具
# ═══════════════════════════════════════════════════════════════════════════
collect:
  - name: ask
    phase1: true  # Phase 1 可用
    description: |
      向用户提问或请求信息。合并了 request_info 和 ask_user_question。

      ## 何时调用
      - 需要收集出生信息时 → ask(question="...", form_type="birth")
      - 需要用户选择时 → ask(question="...", form_type="select", options=[...])
      - 需要文本输入时 → ask(question="...", form_type="text")
      - 需要自定义表单时 → ask(question="...", form_type="custom", fields=[...])

      ## form_type 说明
      - birth: 出生信息表单（日期、时间、地点、性别）
      - text: 文本输入框
      - select: 选择器（需提供 options）
      - custom: 自定义表单（需提供 fields）
    card_type: collect_form
    parameters:
      - name: question
        type: string
        required: true
        description: 要问用户的问题
      - name: form_type
        type: string
        required: true
        description: 表单类型
        enum:
          - birth
          - text
          - select
          - custom
      - name: options
        type: array
        required: false
        description: select 类型时的选项列表（最多4个）
      - name: fields
        type: array
        required: false
        description: custom 类型时的自定义字段列表

# ═══════════════════════════════════════════════════════════════════════════
# 3. 保存工具
# ═══════════════════════════════════════════════════════════════════════════
action:
  - name: save
    description: |
      保存数据到用户档案。合并了 save_birth_info、write_state、save_skill_data。

      ## 路径规范
      - identity.birth_info: 出生信息
      - state.*: 运行时状态（如 state.emotion）
      - skills.{skill_id}.*: Skill 专属数据
      - goals.*: 目标数据
      - triggers.*: 触发器数据

      ## 示例
      - save(path="identity.birth_info", data={date: "1990-01-01", time: "12:00"})
      - save(path="state.emotion", data="happy")
      - save(path="skills.lifecoach.north_star", data={vision: "..."})
      - save(path="goals.2026", data={title: "..."})

      ## 删除数据
      - save(path="goals.xxx", data=null) 删除该路径数据
    parameters:
      - name: path
        type: string
        required: true
        description: 数据路径
      - name: data
        type: object
        required: true
        description: 要保存的数据（null 表示删除）
      - name: merge
        type: boolean
        required: false
        description: 是否深度合并（默认 true）
        default: true

  # ─────────────────────────────────────────────────────────────────────────
  # 4. 读取工具
  # ─────────────────────────────────────────────────────────────────────────
  - name: read
    phase1: true  # Phase 1 可用（用于回答用户个人信息查询）
    description: |
      读取用户数据。合并了 read_state、read_user_data。

      ## 路径规范
      - identity: 身份信息
      - identity.birth_info: 出生信息
      - state: 运行时状态
      - skills.{skill_id}: Skill 专属数据
      - goals: 目标数据
      - triggers: 触发器数据

      ## 示例
      - read(path="identity.birth_info") 读取出生信息
      - read(path="skills.lifecoach") 读取 lifecoach 数据
      - read(path="goals") 读取所有目标
    parameters:
      - name: path
        type: string
        required: true
        description: 数据路径
      - name: sections
        type: array
        required: false
        description: 只读取指定部分（可选）

# ═══════════════════════════════════════════════════════════════════════════
# 5. 检索工具
# ═══════════════════════════════════════════════════════════════════════════
search:
  - name: search
    description: |
      检索知识库。从 search_db 简化而来。

      ## 何时调用
      - 需要专业知识时
      - 需要案例参考时
      - LLM 判断需要外部知识支持时

      ## 示例
      - search(query="八字财运分析方法")
      - search(query="职业规划框架")
    parameters:
      - name: query
        type: string
        required: true
        description: 检索查询词
      - name: table
        type: string
        required: false
        description: 要查询的表
        enum:
          - knowledge_chunks
          - cases
        default: knowledge_chunks
      - name: top_k
        type: integer
        required: false
        description: 返回结果数量
        default: 5
      - name: filters
        type: object
        required: false
        description: 可选过滤条件

# ═══════════════════════════════════════════════════════════════════════════
# 6. 展示工具
# ═══════════════════════════════════════════════════════════════════════════
display:
  - name: show
    phase1: true  # Phase 1 可用
    description: |
      统一展示工具。合并了 show_card、show_all_skills、recommend_skill。

      ## type 说明
      - card: 展示数据卡片（需指定 card_type）
      - skill_list: 展示所有 Skill 列表
      - recommendation: 推荐 Skill
      - insight: 展示洞察

      ## card_type（type=card 时）
      - list: 列表展示
      - tree: 树形结构
      - table: 表格数据
      - form: 交互表单
      - chart: 图表
      - progress: 进度条
      - custom: 自定义组件（需指定 component_id）

      ## 示例
      - show(type="skill_list") 展示所有 Skill
      - show(type="recommendation", data={skill_id: "bazi", reason: "..."})
      - show(type="card", card_type="tree", data={...})
      - show(type="card", card_type="custom", component_id="bazi_chart", data={...})
    parameters:
      - name: type
        type: string
        required: true
        description: 展示类型
        enum:
          - card
          - skill_list
          - recommendation
          - insight
      - name: card_type
        type: string
        required: false
        description: 卡片类型（type=card 时使用）
        enum:
          - list
          - tree
          - table
          - form
          - chart
          - progress
          - custom
      - name: component_id
        type: string
        required: false
        description: 自定义组件 ID（card_type=custom 时使用）
      - name: data
        type: object
        required: false
        description: 展示数据
      - name: message
        type: string
        required: false
        description: 展示消息或推荐理由

# ═══════════════════════════════════════════════════════════════════════════
# 7. 提醒工具
# ═══════════════════════════════════════════════════════════════════════════
trigger:
  - name: remind
    description: |
      管理提醒。合并了 create_trigger、list_triggers、cancel_trigger。

      ## action 说明
      - set: 创建提醒
      - list: 列出提醒
      - cancel: 取消提醒

      ## 调度格式（action=set 时）
      - daily: "08:00" (每天8点)
      - weekly: "1,3,5 09:00" (周一三五9点)
      - once: "2026-01-20T10:00:00" (一次性)

      ## 示例
      - remind(action="set", title="每日打卡", schedule="08:00", schedule_type="daily")
      - remind(action="list")
      - remind(action="cancel", id="xxx")
    parameters:
      - name: action
        type: string
        required: true
        description: 操作类型
        enum:
          - set
          - list
          - cancel
      - name: id
        type: string
        required: false
        description: 提醒 ID（cancel 时必填）
      - name: title
        type: string
        required: false
        description: 提醒标题（set 时必填）
      - name: schedule
        type: string
        required: false
        description: 调度表达式（set 时必填）
      - name: schedule_type
        type: string
        required: false
        description: 调度类型
        default: daily
        enum:
          - once
          - daily
          - weekly
      - name: status
        type: string
        required: false
        description: 按状态过滤（list 时使用）
        default: active
        enum:
          - active
          - paused
          - completed
          - cancelled
