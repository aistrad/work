# Bazi Skill 提醒定义 v3.0
# LLM-First 架构：声明式 conditions + Agent 内容生成
# 配置与 SKILL.md 通过 skill_id 关联

version: "3.0"
skill_id: bazi
enabled: true

reminders:
  # ═══════════════════════════════════════════════════════════════════════════
  # 每日运势
  # ═══════════════════════════════════════════════════════════════════════════
  - id: daily_fortune
    name: 每日运势

    trigger:
      type: time_based
      schedule: "0 8 * * *"  # 每天早上8点 (用户本地时间)
      cooldown_hours: 24

    # 声明式条件 - 静态优先求值
    conditions:
      - description: "用户已设定八字信息"
        data_path: "identity.birth_info"
        operator: "exists"

    content:
      rule: rules/proactive/daily-fortune-push.md
      card_type: DailyFortuneCard
      suggested_prompt: "想了解今天的运势详情？"
      quick_actions:
        - label: "今日宜忌"
          prompt: "今天适合做什么？有什么需要注意的？"
        - label: "开运建议"
          prompt: "今天如何提升运势？"

    priority: medium

  # ═══════════════════════════════════════════════════════════════════════════
  # 大运交接
  # ═══════════════════════════════════════════════════════════════════════════
  - id: dayun_transition
    name: 大运交接

    trigger:
      type: event_based
      event: dayun_change
      advance_days: [30, 7, 0]  # 提前30天、7天、当天

    conditions:
      - description: "用户已设定八字信息"
        data_path: "identity.birth_info"
        operator: "exists"

    content:
      rule: rules/proactive/dayun-transition-push.md
      card_type: InsightCard
      suggested_prompt: "想了解新大运的详细分析？"
      quick_actions:
        - label: "大运解读"
          prompt: "请详细分析我即将进入的新大运"
        - label: "机遇与挑战"
          prompt: "新大运会带来哪些机遇和挑战？"

    priority: high

  # ═══════════════════════════════════════════════════════════════════════════
  # 流年运势
  # ═══════════════════════════════════════════════════════════════════════════
  - id: liunian
    name: 流年运势

    trigger:
      type: event_based
      event: new_year
      advance_days: [7, 0]  # 新年前7天、新年当天

    conditions:
      - description: "用户已设定八字信息"
        data_path: "identity.birth_info"
        operator: "exists"

    content:
      rule: rules/proactive/liunian-push.md
      card_type: InsightCard
      suggested_prompt: "想了解新一年的运势？"
      quick_actions:
        - label: "年度运势"
          prompt: "请分析我的新年运势"
        - label: "关键时机"
          prompt: "新的一年有哪些关键时机需要把握？"

    priority: high

  # ═══════════════════════════════════════════════════════════════════════════
  # 生日提醒
  # ═══════════════════════════════════════════════════════════════════════════
  - id: birthday
    name: 生日提醒

    trigger:
      type: event_based
      event: birthday
      advance_days: [7, 0]  # 提前7天、当天

    conditions:
      - description: "用户生日信息存在"
        data_path: "identity.birth_info.date"
        operator: "exists"

    content:
      rule: rules/proactive/birthday-push.md
      card_type: InsightCard
      suggested_prompt: "想了解新的一岁运势？"
      quick_actions:
        - label: "生日运势"
          prompt: "请分析我新的一岁运势"
        - label: "生日愿望"
          prompt: "今年最适合实现什么愿望？"

    priority: high

  # ═══════════════════════════════════════════════════════════════════════════
  # 运势预警 (智能化: 阈值触发)
  # ═══════════════════════════════════════════════════════════════════════════
  - id: fortune_alert
    name: 运势预警

    trigger:
      type: data_condition
      cooldown_hours: 168  # 7天内不重复提醒

    conditions:
      - description: "用户已设定八字信息"
        data_path: "identity.birth_info"
        operator: "exists"
      - description: "今日运势分数低于40"
        data_path: "skills.bazi.daily_fortune.score"
        operator: "<"
        value: 40

    content:
      rule: rules/proactive/fortune-alert-push.md
      card_type: AlertCard
      suggested_prompt: "想了解如何化解？"
      quick_actions:
        - label: "化解方法"
          prompt: "请告诉我如何化解当前的不利因素"
        - label: "注意事项"
          prompt: "这段时间需要特别注意什么？"

    priority: medium

# ═══════════════════════════════════════════════════════════════════════════
# 全局配置
# ═══════════════════════════════════════════════════════════════════════════
global_config:
  default_push_hour: 8     # 默认推送时间（用户本地时间）
  cooldown_hours: 24       # 同类型提醒的冷却时间
  max_daily_pushes: 5      # 每日最大推送数
  quiet_hours:
    start: 22
    end: 7
