# VibeLife Onboarding 模块设计文档 v7.0

> **版本**: 7.0 | 2026-01-17
> **依赖文档**: VibeID设计-v5.md + VibeLife-PageLayouts-v7.1.md
> **目标读者**: AI Agent / 前端开发 / 产品设计
> **核心理念**: 90秒内完成「相遇 → 洞察 → 共鸣 → 期待」的价值闭环

---

## 一、设计目标

### 1.1 核心目标

1. **90秒价值闭环**: 用户在90秒内完成首次VibeID计算，获得"Aha Moment"
2. **品牌心智植入**: 全程强化"VibeID = 东西方融合的人格操作系统"概念
3. **转化漏斗优化**: 每个阶段都有明确的转化触发点
4. **低门槛高粘性**: 仅需生日即可开始，逐步引导深入

### 1.2 用户旅程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          VibeLife Onboarding v7.0                           │
│                     90秒旅程: 相遇 → 洞察 → 共鸣 → 期待                      │
└─────────────────────────────────────────────────────────────────────────────┘

时间轴:  0s ──────── 15s ──────── 45s ──────── 75s ──────── 90s
         │           │            │            │            │
阶段:    │  Phase 1  │  Phase 2   │  Phase 3   │  Phase 4   │
         │  相遇     │  洞察      │  共鸣      │  期待      │
         │           │            │            │            │
情绪:    好奇 ───── 期待 ───── 惊喜 ───── 认同 ───── 渴望
```

---

## 二、整体流程架构

### 2.1 主流程

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                              主流程 (4阶段)                                   │
└──────────────────────────────────────────────────────────────────────────────┘

[入口]
┌─────────────────────┐
│ 用户访问 /onboarding │ ← 未登录首页CTA / 邀请链接 / 分享入口 / 深链
└─────────────────────┘
           │
           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│ Phase 1: 相遇 (0-15s) — LandingStep                                          │
│                                                                              │
│   输入: 出生年/月/日 (必填) + 出生时辰 (可选，默认12:00)                        │
│   品牌: 强调"发现你的Vibe" + "东西方智慧融合"                                  │
│   输出: birthInfo → Context                                                  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
           │
           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│ Phase 2: 洞察 (15-45s) — LoadingStep                                         │
│                                                                              │
│   步骤: ① 解读能量密码 → ② 绘制天赋图谱 → ③ 融合东西方智慧                    │
│   API:  POST /api/v1/vibe-id/calculate                                       │
│         - 八字计算 (格局+用神+日主强弱)                                        │
│         - 星盘计算 (五点模型: 太阳/月亮/上升/金星/火星)                         │
│         - 融合计算 (八字70% + 星座30% + 一致性奖励)                            │
│   输出: VibeID Profile → Context                                             │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
           │
           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│ Phase 3: 共鸣 (45-75s) — AhaStep                                             │
│                                                                              │
│   展示: VibeID 四维原型卡片 (Core/Inner/Outer/Shadow)                         │
│         + 底层密码 (八字格局 · 星盘组合)                                       │
│         + 成长方向                                                           │
│   问答: 基于Core原型的验证问题 (强化认同感)                                    │
│   输出: 用户确认 + 情感共鸣                                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
           │
           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│ Phase 4: 期待 (75-90s) — ConversionStep                                      │
│                                                                              │
│   预览: 今日Vibe能量 (模糊) + 成长提示 (模糊)                                  │
│   功能: Premium功能亮点 (VibeID特色)                                          │
│   定价: 区域化定价 (GLOBAL / CN)                                              │
│   分流: 订阅 → 支付流程 | 跳过 → 免费版首页                                    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
           │
           ├─────────────────────────────────────┐
           ▼                                     ▼
┌─────────────────────────┐          ┌─────────────────────────┐
│   订阅流程               │          │   免费版入口             │
│   → /auth/login (OAuth) │          │   → / (首页)            │
│   → /membership         │          │   功能受限              │
│   → /payment/...        │          │                         │
└─────────────────────────┘          └─────────────────────────┘
```

### 2.2 数据流

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                              数据流设计                                       │
└──────────────────────────────────────────────────────────────────────────────┘

                    OnboardingContext (React Context)
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌───────────────┐    ┌───────────────┐    ┌───────────────┐
│   birthInfo   │    │   vibeID      │    │   uiState     │
├───────────────┤    ├───────────────┤    ├───────────────┤
│ year: number  │    │ core: Archetype│   │ step: Step    │
│ month: number │    │ inner: Archetype│  │ loading: bool │
│ day: number   │    │ outer: Archetype│  │ error: string │
│ hour?: number │    │ shadow: Archetype│ │               │
│ location?: str│    │ bazi: BaziData │   │               │
│               │    │ zodiac: ZodiacData││               │
│               │    │ explanation: {...}││               │
└───────────────┘    └───────────────┘    └───────────────┘
        │                     │
        │    API Call         │
        ▼                     │
┌───────────────────────┐     │
│ POST /api/v1/vibe-id/ │     │
│      calculate        │─────┘
└───────────────────────┘
```

---

## 三、Phase 1: 相遇 (LandingStep)

### 3.1 设计目标

- 极简输入，降低门槛
- 品牌植入，建立期待
- 优雅动效，营造仪式感

### 3.2 PC Layout (≥768px)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│                                                                              │
│              ┌────────────────────────────────────────────┐                 │
│              │              (max-width: 480px)            │                 │
│              │                                            │                 │
│              │      ╭────────────────────────────╮       │                 │
│              │      │                            │       │                 │
│              │      │    ✨ VibeID 呼吸光晕 ✨    │       │                 │
│              │      │       (160x160px)          │       │                 │
│              │      │    [渐变色球体 + 脉冲动画]  │       │                 │
│              │      │                            │       │                 │
│              │      ╰────────────────────────────╯       │                 │
│              │                                            │                 │
│              │           发现你的 VibeID                  │                 │
│              │                                            │                 │
│              │    融合东方命理智慧与西方心理学洞察          │                 │
│              │         你的人格操作系统                    │                 │
│              │                                            │                 │
│              │  ┌──────────────────────────────────────┐ │                 │
│              │  │              生日输入卡片              │ │                 │
│              │  │                                      │ │                 │
│              │  │     ┌────────┐ ┌────┐ ┌────┐       │ │                 │
│              │  │     │  1990  │ │ 6  │ │ 15 │       │ │                 │
│              │  │     └────────┘ └────┘ └────┘       │ │                 │
│              │  │        年        月      日         │ │                 │
│              │  │                                      │ │                 │
│              │  │     + 添加出生时间 (更精准) ▾        │ │                 │
│              │  │                                      │ │                 │
│              │  │  ┌──────────────────────────────┐   │ │                 │
│              │  │  │         开始探索              │   │ │                 │
│              │  │  └──────────────────────────────┘   │ │                 │
│              │  │                                      │ │                 │
│              │  └──────────────────────────────────────┘ │                 │
│              │                                            │                 │
│              │              ● ○ ○ ○                       │                 │
│              │                                            │                 │
│              └────────────────────────────────────────────┘                 │
│                                                                              │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Mobile Layout (<768px)

```
┌─────────────────────────┐
│                         │
│   ╭───────────────╮     │
│   │               │     │
│   │  ✨ VibeID    │     │
│   │   呼吸光晕    │     │
│   │  (120x120)    │     │
│   │               │     │
│   ╰───────────────╯     │
│                         │
│    发现你的 VibeID      │
│                         │
│  融合东方命理智慧与      │
│  西方心理学洞察          │
│  你的人格操作系统        │
│                         │
├─────────────────────────┤
│  ┌───────────────────┐  │
│  │    生日输入卡片    │  │
│  │                   │  │
│  │  ┌──────┐┌──┐┌──┐ │  │
│  │  │ 1990 ││6 ││15│ │  │
│  │  └──────┘└──┘└──┘ │  │
│  │    年    月   日   │  │
│  │                   │  │
│  │ + 添加出生时间 ▾  │  │
│  │                   │  │
│  │  ┌─────────────┐  │  │
│  │  │  开始探索    │  │  │
│  │  └─────────────┘  │  │
│  │                   │  │
│  └───────────────────┘  │
│                         │
│       ● ○ ○ ○           │
│                         │
└─────────────────────────┘
```

### 3.4 交互细节

| 元素 | 行为 |
|------|------|
| 年份输入 | 4位数字，自动跳转到月份 |
| 月份输入 | 1-12，2位时自动跳转到日期 |
| 日期输入 | 1-31，根据月份校验 |
| 出生时间 | 点击展开，0-23时，可选 |
| 开始探索 | 年月日填完后激活，点击进入Phase 2 |
| VibeID光晕 | 呼吸动画，吸引注意力 |

### 3.5 文案规范

```typescript
const LANDING_COPY = {
  title: "发现你的 Vibe",
  subtitle: "融合东方命理智慧与西方心理学洞察\n你的人格操作系统",
  inputLabel: "你的生日是？",
  timeExpand: "+ 添加出生时间 (更精准)",
  timeHint: "时辰影响八字时柱精确度",
  submitButton: "开始探索",
  skipTime: "不知道也没关系，我们会用默认值"
}
```

---

## 四、Phase 2: 洞察 (LoadingStep)

### 4.1 设计目标

- 品牌化的计算过程展示 (不暴露"八字""星座"术语)
- 营造"神秘解读"的仪式感
- 实际完成VibeID计算

### 4.2 PC Layout (≥768px)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│                                                                              │
│              ┌────────────────────────────────────────────┐                 │
│              │              (max-width: 480px)            │                 │
│              │                                            │                 │
│              │         正在解读你的能量密码                │                 │
│              │    融合东西方智慧，绘制你的人格图谱...       │                 │
│              │                                            │                 │
│              │      ╭────────────────────────────╮       │                 │
│              │      │                            │       │                 │
│              │      │     ✨ 魔法阵动画 ✨        │       │                 │
│              │      │    (符文旋转 + 光效)       │       │                 │
│              │      │       (180x180px)          │       │                 │
│              │      │                            │       │                 │
│              │      ╰────────────────────────────╯       │                 │
│              │                                            │                 │
│              │  ┌──────────────────────────────────────┐ │                 │
│              │  │              步骤卡片                  │ │                 │
│              │  │                                      │ │                 │
│              │  │  ┌────────────────────────────────┐  │ │                 │
│              │  │  │ ✓  解读你的能量密码             │  │ │                 │
│              │  │  │    分析先天格局与核心驱动力      │  │ │                 │
│              │  │  └────────────────────────────────┘  │ │                 │
│              │  │                                      │ │                 │
│              │  │  ┌────────────────────────────────┐  │ │                 │
│              │  │  │ ◎  绘制你的天赋图谱      [...]  │  │ │                 │
│              │  │  │    解析内在世界与外在表达       │  │ │                 │
│              │  │  └────────────────────────────────┘  │ │                 │
│              │  │                                      │ │                 │
│              │  │  ┌────────────────────────────────┐  │ │                 │
│              │  │  │ ○  融合东西方智慧               │  │ │                 │
│              │  │  │    生成你的专属 VibeID          │  │ │                 │
│              │  │  └────────────────────────────────┘  │ │                 │
│              │  │                                      │ │                 │
│              │  └──────────────────────────────────────┘ │                 │
│              │                                            │                 │
│              │              ○ ● ○ ○                       │                 │
│              │                                            │                 │
│              └────────────────────────────────────────────┘                 │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.3 Mobile Layout (<768px)

```
┌─────────────────────────┐
│                         │
│  正在解读你的能量密码    │
│ 融合东西方智慧，         │
│ 绘制你的人格图谱...      │
│                         │
│   ╭───────────────╮     │
│   │               │     │
│   │  ✨ 魔法阵    │     │
│   │   动画        │     │
│   │  (140x140)    │     │
│   │               │     │
│   ╰───────────────╯     │
│                         │
├─────────────────────────┤
│  ┌───────────────────┐  │
│  │     步骤卡片       │  │
│  │                   │  │
│  │ ┌───────────────┐ │  │
│  │ │✓ 解读能量密码  │ │  │
│  │ │  先天格局分析  │ │  │
│  │ └───────────────┘ │  │
│  │                   │  │
│  │ ┌───────────────┐ │  │
│  │ │◎ 绘制天赋图谱 │ │  │
│  │ │  [...]        │ │  │
│  │ └───────────────┘ │  │
│  │                   │  │
│  │ ┌───────────────┐ │  │
│  │ │○ 融合东西方   │ │  │
│  │ │  智慧         │ │  │
│  │ └───────────────┘ │  │
│  │                   │  │
│  └───────────────────┘  │
│                         │
│       ○ ● ○ ○           │
│                         │
└─────────────────────────┘
```

### 4.4 步骤定义

```typescript
const LOADING_STEPS = [
  {
    key: 'energy',
    title: '解读你的能量密码',
    subtitle: '分析先天格局与核心驱动力',
    // 实际执行: 八字计算 (格局+用神+日主强弱)
  },
  {
    key: 'talent',
    title: '绘制你的天赋图谱',
    subtitle: '解析内在世界与外在表达',
    // 实际执行: 星盘计算 (五点模型)
  },
  {
    key: 'fusion',
    title: '融合东西方智慧',
    subtitle: '生成你的专属 VibeID',
    // 实际执行: 融合算法 (八字70% + 星座30%)
  }
]
```

### 4.5 API 设计

```typescript
// 推荐: 统一的 VibeID 计算接口
POST /api/v1/vibe-id/calculate

Request:
{
  birth_date: "1990-06-15",
  birth_time: "14:30",        // 可选，默认 "12:00"
  birth_place: "Shanghai",     // 可选，默认按时区推断
  gender: "unknown"            // 可选
}

Response:
{
  success: true,
  vibe_id: {
    // 四维原型
    core: {
      archetype: "Creator",
      archetype_chinese: "创造者",
      nickname: "审美在线本人",
      tagline: "表达是我的呼吸",
      confidence: 0.85
    },
    inner: {
      archetype: "Magician",
      archetype_chinese: "魔术师",
      emotional_style: "深沉转化",
      love_style: "深情专一"
    },
    outer: {
      archetype: "Caregiver",
      archetype_chinese: "照顾者",
      social_style: "温和保护",
      action_style: "情绪驱动"
    },
    shadow: {
      archetype: "Regular",
      archetype_chinese: "凡人",
      tension: "独特 vs 归属"
    },

    // 底层密码
    bazi: {
      pattern: "伤官格",
      useful_god: "财",
      day_master_strength: "偏旺",
      four_pillars: {...}
    },
    zodiac: {
      sun_sign: "狮子座",
      moon_sign: "双鱼座",
      rising_sign: "天蝎座",
      venus_sign: "巨蟹座",
      mars_sign: "白羊座"
    },

    // 可解释性模块
    explanation: {
      summary: "你的核心原型是【创造者】...",
      bazi_insight: "你的八字是伤官格，用神为财...",
      zodiac_insight: "太阳狮子赋予你创造者的核心特质...",
      integration_insight: "东方命理与西方占星指向相似原型...",
      growth_direction: "你的成长方向是完成作品而非追求完美..."
    },

    // 置信度
    confidence: 0.82,
    consistency_type: "similar"
  }
}
```

---

## 五、Phase 3: 共鸣 (AhaStep)

### 5.1 设计目标

- 展示完整的VibeID四维画像
- 通过验证问题强化用户认同
- 创造"Aha Moment"

### 5.2 PC Layout (≥768px)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│                         你的 VibeID                                          │
│                                                                              │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                        (max-width: 560px)                           │  │
│    │                                                                     │  │
│    │  ┌───────────────────────────────────────────────────────────────┐ │  │
│    │  │                     VibeID 主卡片                              │ │  │
│    │  │                                                               │ │  │
│    │  │              ╭──────────────────────╮                         │ │  │
│    │  │              │         🎨           │                         │ │  │
│    │  │              │       创造者          │   Core 原型             │ │  │
│    │  │              │   审美在线本人        │                         │ │  │
│    │  │              ╰──────────────────────╯                         │ │  │
│    │  │                                                               │ │  │
│    │  │                  "表达是我的呼吸"                               │ │  │
│    │  │                                                               │ │  │
│    │  │  ─────────────────────────────────────────────────────────── │ │  │
│    │  │                                                               │ │  │
│    │  │     Inner                              Outer                  │ │  │
│    │  │     🔮 魔术师                           🤗 照顾者              │ │  │
│    │  │     情感: 深沉转化                      社交: 温和保护         │ │  │
│    │  │                                                               │ │  │
│    │  │  ─────────────────────────────────────────────────────────── │ │  │
│    │  │                                                               │ │  │
│    │  │     Shadow 倾向: 🏠 凡人                                       │ │  │
│    │  │     核心张力: 独特 vs 归属                                     │ │  │
│    │  │                                                               │ │  │
│    │  │  ─────────────────────────────────────────────────────────── │ │  │
│    │  │                                                               │ │  │
│    │  │     📍 底层密码                                                │ │  │
│    │  │     八字: 伤官格 · 用神为财 · 身偏旺                            │ │  │
│    │  │     星盘: 太阳狮子 · 月亮双鱼 · 上升天蝎                        │ │  │
│    │  │                                                               │ │  │
│    │  └───────────────────────────────────────────────────────────────┘ │  │
│    │                                                                     │  │
│    │  ┌───────────────────────────────────────────────────────────────┐ │  │
│    │  │                     验证问题卡片                               │ │  │
│    │  │                                                               │ │  │
│    │  │     作为创造者，你是否经常感到：                                │ │  │
│    │  │     "表达不出来比不舒服更难受"？                                │ │  │
│    │  │                                                               │ │  │
│    │  │     ┌─────────────────┐  ┌─────────────────┐                 │ │  │
│    │  │     │     是的！      │  │   不太是        │                 │ │  │
│    │  │     └─────────────────┘  └─────────────────┘                 │ │  │
│    │  │                                                               │ │  │
│    │  └───────────────────────────────────────────────────────────────┘ │  │
│    │                                                                     │  │
│    │  ┌───────────────────────────────────────────────────────────────┐ │  │
│    │  │                     成长方向卡片                               │ │  │
│    │  │                                                               │ │  │
│    │  │     ✨ 成长方向                                                │ │  │
│    │  │     "你的成长方向是完成作品而非追求完美，让创意真正落地。"       │ │  │
│    │  │                                                               │ │  │
│    │  └───────────────────────────────────────────────────────────────┘ │  │
│    │                                                                     │  │
│    │              ┌────────────────────────────┐                        │  │
│    │              │      继续探索 →            │                        │  │
│    │              └────────────────────────────┘                        │  │
│    │                                                                     │  │
│    │                        ○ ○ ● ○                                     │  │
│    │                                                                     │  │
│    └─────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.3 Mobile Layout (<768px)

```
┌─────────────────────────┐
│                         │
│    你的 VibeID          │
│                         │
├─────────────────────────┤
│  ┌───────────────────┐  │
│  │    VibeID 主卡片   │  │
│  │                   │  │
│  │   ╭───────────╮   │  │
│  │   │    🎨     │   │  │
│  │   │  创造者    │   │  │
│  │   │审美在线本人│   │  │
│  │   ╰───────────╯   │  │
│  │                   │  │
│  │ "表达是我的呼吸"  │  │
│  │                   │  │
│  │ ───────────────── │  │
│  │                   │  │
│  │ Inner │ Outer     │  │
│  │ 🔮魔术师│🤗照顾者  │  │
│  │ 深沉转化│温和保护  │  │
│  │                   │  │
│  │ ───────────────── │  │
│  │                   │  │
│  │ Shadow: 🏠凡人    │  │
│  │ 张力:独特vs归属   │  │
│  │                   │  │
│  │ ───────────────── │  │
│  │                   │  │
│  │ 📍 底层密码       │  │
│  │ 八字:伤官格·用财  │  │
│  │ 星盘:太阳狮子...  │  │
│  │                   │  │
│  └───────────────────┘  │
│                         │
│  ┌───────────────────┐  │
│  │    验证问题卡片    │  │
│  │                   │  │
│  │ 作为创造者，你是  │  │
│  │ 否经常感到：      │  │
│  │ "表达不出来比不   │  │
│  │ 舒服更难受"？     │  │
│  │                   │  │
│  │ ┌─────┐ ┌─────┐  │  │
│  │ │是的！│ │不太是│  │  │
│  │ └─────┘ └─────┘  │  │
│  │                   │  │
│  └───────────────────┘  │
│                         │
│  ┌───────────────────┐  │
│  │ ✨ 成长方向       │  │
│  │ "完成作品而非     │  │
│  │ 追求完美..."      │  │
│  └───────────────────┘  │
│                         │
│  ┌───────────────────┐  │
│  │    继续探索 →     │  │
│  └───────────────────┘  │
│                         │
│       ○ ○ ● ○           │
│                         │
└─────────────────────────┘
```

### 5.4 验证问题库

基于Core原型生成动态验证问题：

```typescript
const ARCHETYPE_VALIDATION_QUESTIONS: Record<string, string[]> = {
  Creator: [
    "你是否经常感到「表达不出来比不舒服更难受」？",
    "看到丑的东西，你会不会有种生理性不适？",
    "你是否常常为了「完美」而拖延完成？"
  ],
  Hero: [
    "面对挑战时，你是否感到莫名兴奋而非恐惧？",
    "你是否很难接受「输」这个结果？",
    "别人有困难时，你是否第一反应就是想帮忙？"
  ],
  Sage: [
    "不明白一件事比不舒服更让你难受？",
    "你是否经常被人说「想太多」？",
    "做决定前，你是否一定要收集足够信息？"
  ],
  Caregiver: [
    "看到在乎的人难过，你是否比自己难过还难受？",
    "你是否常常把别人的需求放在自己之前？",
    "你是否很难对他人说「不」？"
  ],
  Lover: [
    "你是否一旦爱上就会全身心投入？",
    "失去热情的生活对你来说是否难以忍受？",
    "你是否容易被美好的事物深深打动？"
  ],
  Explorer: [
    "安稳的生活是否让你感到窒息？",
    "你是否总是想去未知的地方？",
    "重复的日常是否让你焦虑？"
  ],
  Ruler: [
    "看到混乱的局面，你是否忍不住想整理？",
    "你是否天然会在群体中承担责任？",
    "失控的感觉是否让你非常不安？"
  ],
  Outlaw: [
    "你是否常常质疑既有的规则？",
    "你是否觉得大多数人都活得太顺从？",
    "你是否愿意为改变而承担风险？"
  ],
  Magician: [
    "你是否相信「想到就能做到」？",
    "你是否能看到别人看不到的可能性？",
    "你是否喜欢创造惊喜和转变？"
  ],
  Jester: [
    "严肃的氛围是否让你想要打破？",
    "你是否用幽默来处理困难？",
    "活在当下对你来说是否很自然？"
  ],
  Regular: [
    "你是否更看重归属感而非特殊性？",
    "你是否觉得做好自己比出众更重要？",
    "你是否不喜欢太张扬？"
  ],
  Innocent: [
    "你是否倾向于相信世界是美好的？",
    "你是否容易被他人的善意打动？",
    "你是否希望简单快乐地生活？"
  ]
}
```

---

## 六、Phase 4: 期待 (ConversionStep)

### 6.1 设计目标

- 展示Premium价值（模糊化引发好奇）
- 区域化定价
- 双路径分流（订阅/免费）

### 6.2 PC Layout (≥768px)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                        (max-width: 560px)                           │  │
│    │                                                                     │  │
│    │  ┌───────────────────────────────────────────────────────────────┐ │  │
│    │  │                     今日 Vibe 预览                             │ │  │
│    │  │                                                               │ │  │
│    │  │     🌅 今日能量主题                                            │ │  │
│    │  │                                                               │ │  │
│    │  │     ╭─────────────────────────────────╮                       │ │  │
│    │  │     │  🔮  作为创造者，今天你的        │                       │ │  │
│    │  │     │      创造能量处于高峰期...       │  🔒                   │ │  │
│    │  │     │                                │                       │ │  │
│    │  │     │  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░  │ (模糊)                │ │  │
│    │  │     │  今日适合启动新项目，表达...    │                       │ │  │
│    │  │     ╰─────────────────────────────────╯                       │ │  │
│    │  │                                                               │ │  │
│    │  │     想查看完整今日洞察？                                       │ │  │
│    │  │                                                               │ │  │
│    │  └───────────────────────────────────────────────────────────────┘ │  │
│    │                                                                     │  │
│    │  ┌───────────────────────────────────────────────────────────────┐ │  │
│    │  │                  ✨ VibeLife Premium                          │ │  │
│    │  │                  解锁完整的人格探索体验                        │ │  │
│    │  │                                                               │ │  │
│    │  │     ┌─────────┐  ┌─────────┐  ┌─────────┐                    │ │  │
│    │  │     │  月付   │  │  季付   │  │  年付   │ ← 推荐             │ │  │
│    │  │     │ $9.90   │  │ $24.90  │  │ $69.90  │                    │ │  │
│    │  │     │         │  │  省15%  │  │  省36%  │                    │ │  │
│    │  │     └─────────┘  └─────────┘  └─────────┘                    │ │  │
│    │  │                                                               │ │  │
│    │  │     ✅ Premium 功能:                                          │ │  │
│    │  │                                                               │ │  │
│    │  │     · VibeID 完整四维画像 (Core/Inner/Outer/Shadow)           │ │  │
│    │  │     · 每日 Vibe 能量指数与行动建议                             │ │  │
│    │  │     · 深度日 阴影整合引导                                      │ │  │
│    │  │     · 30次/天 AI 命理对话                                      │ │  │
│    │  │     · 完整行运分析 (大运/流年/流月)                             │ │  │
│    │  │     · 关系配对与亲密指南                                       │ │  │
│    │  │                                                               │ │  │
│    │  │     ┌───────────────────────────────────────────────────┐    │ │  │
│    │  │     │           立即订阅 · $69.90/年                    │    │ │  │
│    │  │     └───────────────────────────────────────────────────┘    │ │  │
│    │  │                                                               │ │  │
│    │  │     7天无理由退款保障                                          │ │  │
│    │  │                                                               │ │  │
│    │  └───────────────────────────────────────────────────────────────┘ │  │
│    │                                                                     │  │
│    │                  或继续免费体验 →                                   │  │
│    │                                                                     │  │
│    │                        ○ ○ ○ ●                                     │  │
│    │                                                                     │  │
│    └─────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 6.3 Mobile Layout (<768px)

```
┌─────────────────────────┐
│                         │
│  ┌───────────────────┐  │
│  │  今日 Vibe 预览   │  │
│  │                   │  │
│  │  🌅 今日能量主题  │  │
│  │                   │  │
│  │ ╭───────────────╮ │  │
│  │ │🔮 作为创造者  │ │  │
│  │ │ 今天创造能量  │ │  │
│  │ │ 处于高峰...   │🔒│  │
│  │ │              │ │  │
│  │ │░░░░░░(模糊)░░░│ │  │
│  │ ╰───────────────╯ │  │
│  │                   │  │
│  │ 想查看完整洞察？  │  │
│  │                   │  │
│  └───────────────────┘  │
│                         │
│  ┌───────────────────┐  │
│  │ ✨ VibeLife       │  │
│  │    Premium        │  │
│  │                   │  │
│  │ ┌─────┐┌─────┐┌─────┐│
│  │ │月付 ││季付 ││年付 ││
│  │ │$9.90││$24.9││$69.9││
│  │ │     ││省15%││省36%││
│  │ └─────┘└─────┘└─────┘│
│  │                   │  │
│  │ ✅ Premium 功能:  │  │
│  │ · 四维画像完整版  │  │
│  │ · 每日Vibe能量   │  │
│  │ · 阴影整合引导   │  │
│  │ · 30次/天AI对话  │  │
│  │ · 行运分析      │  │
│  │ · 关系配对      │  │
│  │                   │  │
│  │ ┌───────────────┐ │  │
│  │ │立即订阅·$69.9 │ │  │
│  │ └───────────────┘ │  │
│  │                   │  │
│  │ 7天无理由退款     │  │
│  │                   │  │
│  └───────────────────┘  │
│                         │
│   或继续免费体验 →      │
│                         │
│       ○ ○ ○ ●           │
│                         │
└─────────────────────────┘
```

### 6.4 定价配置

```typescript
const PRICING_CONFIG = {
  global: {
    monthly: { price: '$9.90', period: '/月' },
    quarterly: { price: '$24.90', period: '/季', savings: '省15%' },
    yearly: { price: '$69.90', period: '/年', savings: '省36%', recommended: true }
  },
  cn: {
    monthly: { price: '39 HKD', period: '/月' },
    quarterly: { price: '99 HKD', period: '/季', savings: '省15%' },
    yearly: { price: '298 HKD', period: '/年', savings: '省36%', recommended: true }
  }
}

// 区域检测
function detectRegion(): 'global' | 'cn' {
  const tz = Intl.DateTimeFormat().resolvedOptions().timeZone
  return tz.includes('Shanghai') || tz.includes('Beijing') || tz.includes('Hong_Kong')
    ? 'cn'
    : 'global'
}
```

---

## 七、组件架构

### 7.1 目录结构

```
apps/web/src/app/onboarding/
├── page.tsx                    # 主入口，路由 step 渲染
├── layout.tsx                  # Onboarding 专属布局
├── context.tsx                 # OnboardingContext
├── steps/
│   ├── LandingStep.tsx         # Phase 1: 相遇
│   ├── LoadingStep.tsx         # Phase 2: 洞察
│   ├── AhaStep.tsx             # Phase 3: 共鸣
│   └── ConversionStep.tsx      # Phase 4: 期待
├── components/
│   ├── VibeIDAura.tsx          # 呼吸光晕动画
│   ├── MagicCircle.tsx         # 魔法阵动画
│   ├── VibeIDCard.tsx          # VibeID 四维展示卡片
│   ├── StepIndicator.tsx       # 步骤进度指示器
│   ├── BirthDateInput.tsx      # 生日输入组件
│   ├── ValidationQuestion.tsx  # 验证问题组件
│   └── PricingCard.tsx         # 定价卡片组件
└── hooks/
    ├── useVibeIDCalculation.ts # VibeID 计算 Hook
    └── useRegionPricing.ts     # 区域定价 Hook
```

### 7.2 Context 定义

```typescript
// context.tsx
interface BirthInfo {
  year: number
  month: number
  day: number
  hour?: number
  location?: string
}

interface ArchetypeInfo {
  archetype: string
  archetype_chinese: string
  nickname: string
  tagline: string
  confidence?: number
  style?: string
}

interface VibeIDData {
  core: ArchetypeInfo
  inner: ArchetypeInfo
  outer: ArchetypeInfo
  shadow: ArchetypeInfo & { tension: string }
  bazi: {
    pattern: string
    useful_god: string
    day_master_strength: string
    four_pillars: any
  }
  zodiac: {
    sun_sign: string
    moon_sign: string
    rising_sign: string
    venus_sign: string
    mars_sign: string
  }
  explanation: {
    summary: string
    bazi_insight: string
    zodiac_insight: string
    integration_insight: string
    growth_direction: string
  }
  confidence: number
}

type OnboardingStep = 'landing' | 'loading' | 'aha' | 'conversion'

interface OnboardingState {
  step: OnboardingStep
  birthInfo: BirthInfo | null
  vibeID: VibeIDData | null
  validationAnswer: 'yes' | 'no' | null
  selectedPlan: 'monthly' | 'quarterly' | 'yearly'
  error: string | null
  loading: boolean
}

interface OnboardingContextValue {
  state: OnboardingState
  setBirthInfo: (info: BirthInfo) => void
  setVibeID: (data: VibeIDData) => void
  setValidationAnswer: (answer: 'yes' | 'no') => void
  setSelectedPlan: (plan: 'monthly' | 'quarterly' | 'yearly') => void
  nextStep: () => void
  goToStep: (step: OnboardingStep) => void
  reset: () => void
}
```

---

## 八、动效规范

### 8.1 动画定义

```css
/* globals.css - Onboarding 专属动画 */

/* 呼吸光晕 */
@keyframes pulse-soft {
  0%, 100% {
    transform: scale(1);
    opacity: 0.6;
  }
  50% {
    transform: scale(1.08);
    opacity: 0.9;
  }
}

.animate-pulse-soft {
  animation: pulse-soft 3s ease-in-out infinite;
}

/* 魔法阵旋转 */
@keyframes magic-rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.animate-magic-rotate {
  animation: magic-rotate 8s linear infinite;
}

/* 弹性缩放 */
@keyframes spring-scale {
  0% { transform: scale(0.8); opacity: 0; }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); opacity: 1; }
}

.animate-spring-scale {
  animation: spring-scale 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

/* 向上滑入 */
@keyframes slide-in-up {
  from {
    transform: translateY(20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.animate-slide-in-up {
  animation: slide-in-up 0.4s ease-out forwards;
}

/* 淡入 */
@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

.animate-fade-in {
  animation: fade-in 0.3s ease-out forwards;
}
```

### 8.2 动效时序

```
Phase 1 (LandingStep):
  0ms    - VibeID 光晕开始呼吸
  0ms    - 标题淡入
  100ms  - 副标题淡入
  200ms  - 输入卡片弹性缩放

Phase 2 (LoadingStep):
  0ms    - 魔法阵旋转开始
  0ms    - 步骤1高亮
  ~3000ms - 步骤1完成，步骤2高亮
  ~6000ms - 步骤2完成，步骤3高亮
  ~8000ms - 全部完成，跳转

Phase 3 (AhaStep):
  0ms    - VibeID卡片向上滑入
  200ms  - 验证问题卡片向上滑入
  400ms  - 成长方向卡片向上滑入
  600ms  - 继续按钮淡入

Phase 4 (ConversionStep):
  0ms    - 今日预览卡片向上滑入
  100ms  - Premium卡片向上滑入
  300ms  - 跳过按钮淡入
```

---

## 九、性能优化

### 9.1 Vercel Best Practices 清单

| 优化项 | 实施方式 |
|--------|---------|
| bundle-dynamic-imports | Loading/Aha/Conversion 步骤动态导入 |
| async-suspense-boundaries | 每个步骤使用 Suspense 边界 |
| rerender-memo | 静态 JSX 提升 + useMemo |
| client-swr-dedup | VibeID 计算结果缓存 |
| rendering-hoist-jsx | 静态内容提升到组件外部 |

### 9.2 代码示例

```typescript
// page.tsx - 动态导入
import dynamic from 'next/dynamic'
import { Suspense } from 'react'

// LandingStep 不动态导入（首屏必需）
import LandingStep from './steps/LandingStep'

// 其他步骤动态导入
const LoadingStep = dynamic(() => import('./steps/LoadingStep'), {
  loading: () => <StepSkeleton />,
  ssr: false
})

const AhaStep = dynamic(() => import('./steps/AhaStep'), {
  loading: () => <StepSkeleton />,
  ssr: false
})

const ConversionStep = dynamic(() => import('./steps/ConversionStep'), {
  loading: () => <StepSkeleton />,
  ssr: false
})

export default function OnboardingPage() {
  const { state } = useOnboarding()

  if (state.step === 'landing') {
    return <LandingStep />
  }

  return (
    <Suspense fallback={<StepSkeleton />}>
      {state.step === 'loading' && <LoadingStep />}
      {state.step === 'aha' && <AhaStep />}
      {state.step === 'conversion' && <ConversionStep />}
    </Suspense>
  )
}
```

---

## 十、数据埋点

### 10.1 关键事件

```typescript
const ONBOARDING_EVENTS = {
  // Phase 1
  'onboarding_start': {},
  'birth_info_entered': { has_hour: boolean },

  // Phase 2
  'calculation_started': {},
  'calculation_step_completed': { step: 'energy' | 'talent' | 'fusion' },
  'calculation_completed': { duration_ms: number },
  'calculation_error': { error: string },

  // Phase 3
  'vibeid_displayed': { core_archetype: string },
  'validation_answered': { answer: 'yes' | 'no', archetype: string },

  // Phase 4
  'pricing_viewed': { region: 'global' | 'cn' },
  'plan_selected': { plan: 'monthly' | 'quarterly' | 'yearly' },
  'subscribe_clicked': { plan: string, price: string },
  'skip_clicked': {},

  // 全局
  'onboarding_completed': { converted: boolean, duration_total_ms: number },
  'onboarding_abandoned': { step: OnboardingStep, duration_ms: number }
}
```

---

## 十一、错误处理

### 11.1 错误场景

| 场景 | 处理方式 |
|------|---------|
| API 超时 | 显示重试按钮，保留已填数据 |
| 计算失败 | 降级到基础结果 + 提示"稍后完善" |
| 网络断开 | 检测恢复后自动重试 |
| 无效日期 | 实时校验 + 红色提示 |

### 11.2 降级策略

```typescript
// 当 VibeID 计算失败时的降级数据
const FALLBACK_VIBEID: Partial<VibeIDData> = {
  core: {
    archetype: 'Explorer',
    archetype_chinese: '探险家',
    nickname: '说走就走型人格',
    tagline: '人间值得，去看看',
    confidence: 0.5
  },
  explanation: {
    summary: '我们暂时无法完成完整计算，但初步分析显示你有探索者的特质...',
    growth_direction: '你的成长方向是在自由探索中建立持久的连接。'
  }
}
```

---

## 十二、待确认事项

### 12.1 API 相关

- [ ] `/api/v1/vibe-id/calculate` 接口是否已实现？
- [ ] 返回格式是否符合本文档 4.5 节定义？
- [ ] 是否需要分步调用（八字 → 星盘 → 融合）还是一次性返回？

### 12.2 数据收集

- [ ] 出生地点是否在 Onboarding 中收集？（影响上升星座精度）
- [ ] 性别是否需要收集？（影响某些命理解读）

### 12.3 验证问题

- [ ] 验证问题是否需要后端动态返回？
- [ ] 还是前端根据原型静态匹配？

### 12.4 Guest Session

- [ ] 未登录用户的数据如何暂存？
- [ ] 是否需要 `/api/v1/guest/session` 接口？

---

## 附录A：原型 Emoji 映射

```typescript
const ARCHETYPE_EMOJI: Record<string, string> = {
  Innocent: '🌸',
  Sage: '📚',
  Explorer: '🧭',
  Outlaw: '⚡',
  Magician: '🔮',
  Hero: '⚔️',
  Lover: '💕',
  Jester: '🎭',
  Regular: '🏠',
  Caregiver: '🤗',
  Ruler: '👑',
  Creator: '🎨'
}
```

---

## 附录B：响应式断点

```typescript
const BREAKPOINTS = {
  mobile: '< 768px',
  tablet: '768px - 1024px',
  desktop: '≥ 1024px'
}

// Tailwind 断点使用
const RESPONSIVE_CLASSES = {
  card: 'w-full md:max-w-[500px]',  // Mobile 全宽，Desktop 限制宽度
  title: 'text-xl md:text-2xl',     // 响应式字号
  spacing: 'p-4 md:p-6',            // 响应式内边距
}
```

---

## 附录C：颜色系统

```typescript
// 基于现有 Tailwind 配置
const ONBOARDING_COLORS = {
  primary: 'var(--accent)',         // 主色调
  background: 'var(--bg-primary)',  // 背景色
  card: 'var(--bg-secondary)',      // 卡片背景
  text: {
    primary: 'var(--text-primary)',
    secondary: 'var(--text-secondary)',
    disabled: 'var(--text-disabled)'
  },
  glow: {
    core: 'rgba(139, 92, 246, 0.5)',    // 紫色光晕
    magic: 'rgba(236, 72, 153, 0.5)'     // 粉色光效
  }
}
```

---

*文档结束 - VibeLife Onboarding 模块设计 v7.0*
