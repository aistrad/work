"use client";

import { ButtonHTMLAttributes, forwardRef, memo } from "react";
import { cn } from "@/lib/utils";

// ═══════════════════════════════════════════════════════════════════════════
// Button - v7.1 Linear 风格设计系统
// 克制、精致、流畅 + Spring 动效
// Vercel rule: rerender-memo
// ═══════════════════════════════════════════════════════════════════════════

export interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: "primary" | "secondary" | "ghost" | "danger" | "premium";
  size?: "sm" | "md" | "lg";
  isLoading?: boolean;
}

export const Button = memo(forwardRef<HTMLButtonElement, ButtonProps>(
  (
    {
      className,
      variant = "primary",
      size = "md",
      isLoading,
      children,
      disabled,
      ...props
    },
    ref
  ) => {
    const baseStyles = cn(
      "inline-flex items-center justify-center gap-2",
      "font-sans font-medium",
      "rounded-lg",
      // Web Interface Guidelines: specify properties instead of 'all'
      "transition-[background-color,color,box-shadow,transform,opacity] duration-fast ease-out-expo",
      "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-accent",
      "disabled:pointer-events-none disabled:opacity-50",
      // v7.1 Spring 动效
      "active:scale-[0.97] hover:scale-[1.01]"
    );

    const variants = {
      // Primary: v7.1 高级灰棕
      primary: cn(
        "bg-accent-primary text-text-inverse",
        "hover:bg-accent-hover",
        "shadow-card hover:shadow-card-hover"
      ),
      // Secondary: 无边框设计 + 多层阴影
      secondary: cn(
        "bg-bg-card text-text-primary",
        "shadow-card",
        "hover:bg-bg-card-hover hover:shadow-card-hover"
      ),
      // Ghost: 透明背景
      ghost: cn(
        "bg-transparent text-text-secondary",
        "hover:bg-bg-secondary hover:text-text-primary"
      ),
      // Danger: 危险操作
      danger: cn(
        "bg-error text-text-inverse",
        "hover:bg-error/90",
        "shadow-card"
      ),
      // Premium: 金色高级感
      premium: cn(
        "bg-gradient-to-r from-gold-600 to-gold-500 text-white",
        "hover:from-gold-700 hover:to-gold-600",
        "shadow-card hover:shadow-card-hover"
      ),
    };

    const sizes = {
      sm: "px-3 py-1.5 text-sm h-8",
      md: "px-4 py-2 text-base h-10",
      lg: "px-6 py-3 text-lg h-12",
    };

    return (
      <button
        ref={ref}
        className={cn(
          baseStyles,
          variants[variant],
          sizes[size],
          className
        )}
        disabled={disabled || isLoading}
        {...props}
      >
        {isLoading && (
          <svg
            className="animate-spin h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              className="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              strokeWidth="4"
            />
            <path
              className="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"
            />
          </svg>
        )}
        {children}
      </button>
    );
  }
));

Button.displayName = "Button";

// ═══════════════════════════════════════════════════════════════════════════
// IconButton - 图标按钮
// ═══════════════════════════════════════════════════════════════════════════

export interface IconButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: "primary" | "secondary" | "ghost";
  size?: "sm" | "md" | "lg";
}

export const IconButton = memo(forwardRef<HTMLButtonElement, IconButtonProps>(
  ({ className, variant = "ghost", size = "md", children, ...props }, ref) => {
    const variants = {
      primary: "bg-accent-primary text-text-inverse hover:bg-accent-hover shadow-card",
      secondary: "bg-bg-card text-text-primary shadow-card hover:bg-bg-card-hover hover:shadow-card-hover",
      ghost: "text-text-secondary hover:text-text-primary hover:bg-bg-secondary",
    };

    const sizes = {
      sm: "w-8 h-8",
      md: "w-10 h-10",
      lg: "w-12 h-12",
    };

    return (
      <button
        ref={ref}
        className={cn(
          "inline-flex items-center justify-center rounded-lg",
          "transition-all duration-fast ease-out-expo",
          "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent",
          "disabled:pointer-events-none disabled:opacity-50",
          "active:scale-95 hover:scale-105",
          variants[variant],
          sizes[size],
          className
        )}
        {...props}
      >
        {children}
      </button>
    );
  }
));

IconButton.displayName = "IconButton";
