version: "1.0"
skill_id: zodiac

# 计算型工具
compute:
  - name: calculate_zodiac
    description: |
      计算用户星盘。使用 Swiss Ephemeris 进行精确天文计算。
      当用户提供出生信息后需要计算星盘时调用。
      SOP P2 阶段必须调用此工具。
    card_type: zodiac_chart
    when_to_call: |
      - 用户提供了出生信息但尚未计算星盘
      - SOP P2 阶段需要计算排盘
      - 需要刷新或重新计算星盘数据
    parameters:
      - name: birth_date
        type: string
        required: false
        description: 出生日期 (YYYY-MM-DD)，不提供时从 profile 读取
      - name: birth_time
        type: string
        required: false
        description: 出生时间 (HH:MM)
        default: "12:00"
      - name: birth_place
        type: string
        required: false
        description: 出生地点
        default: "Shanghai"

# 收集型工具
collect:
  - name: collect_zodiac_info
    description: |
      收集用户的出生信息以进行星盘分析。
      当用户想要进行星座/占星分析但尚未提供出生信息时调用。
    card_type: collect_form
    card_props:
      form_fields:
        - name: birth_date
          type: date
          required: true
          label: 出生日期
        - name: birth_time
          type: time
          required: true
          label: 出生时间
        - name: birth_location
          type: location
          required: true
          label: 出生地点
    parameters:
      - name: question
        type: string
        required: false
        description: 用户的问题或困惑
    when_to_call: 用户想进行星盘分析但没有提供出生信息时

# 展示型工具
display:
  - name: show_skill_intro
    description: |
      展示 Skill 介绍卡片。用于首次使用或用户想了解功能时。
      卡片包含：功能介绍、快速开始提示、订阅状态。
    type: display
    card_type: skill_intro
    when_to_call: |
      - 用户首次使用此 Skill 时
      - 用户问"这个能做什么"、"有什么功能"时
      - 用户说"介绍一下"、"帮助"时
    parameters:
      - name: variant
        type: string
        enum: [full, compact, mini]
        default: compact
        description: 卡片变体（full=完整版, compact=精简版, mini=迷你版）
      - name: reason
        type: string
        description: 展示原因（如"首次使用"、"功能介绍"）

  - name: show_zodiac_chart
    description: |
      展示用户的星盘，包括太阳、月亮、上升星座和行星位置。
      重要：如果刚调用过 calculate_zodiac，必须把计算结果传入参数！
    card_type: zodiac_chart
    when_to_call: |
      - 用户说"看看我的星盘"
      - 完成 calculate_zodiac 计算后立即调用，把结果传入
    parameters:
      - name: sun_sign
        type: string
        required: false
        description: 太阳星座（从 calculate_zodiac 结果传入）
      - name: moon_sign
        type: string
        required: false
        description: 月亮星座（从 calculate_zodiac 结果传入）
      - name: rising_sign
        type: string
        required: false
        description: 上升星座（从 calculate_zodiac 结果传入）
      - name: birth_date
        type: string
        required: false
        description: 出生日期
      - name: birth_time
        type: string
        required: false
        description: 出生时间
      - name: birth_place
        type: string
        required: false
        description: 出生地点
      - name: showAspects
        type: boolean
        required: false
        description: 是否显示相位
        default: true

  - name: show_zodiac_transit
    description: |
      展示行运分析，当前行星对本命盘的影响。
      当用户问行星运行、行运、当前运势时调用。
    card_type: zodiac_transit
    when_to_call: |
      - 用户问"行运如何"
      - 用户问"水逆对我有什么影响"
      - 用户想了解当前行星影响
    parameters:
      - name: date
        type: string
        required: false
        description: 日期 (YYYY-MM-DD)

  - name: show_zodiac_synastry
    description: |
      展示合盘分析，两个人的星盘对比。
      当用户想了解与某人的关系兼容性时调用。
    card_type: zodiac_synastry
    when_to_call: |
      - 用户问"我和TA合不合"
      - 用户想看合盘
      - 用户想了解关系兼容性
    parameters:
      - name: partner_birth_date
        type: string
        required: false
        description: 对方出生日期
      - name: partner_birth_time
        type: string
        required: false
        description: 对方出生时间
