# VibeLife 顶层架构设计

> Version: 11.3 | 2026-01-21
> 原则：**四维统一 × 各司其职 × 极简**

---

## 一、核心洞察

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│                    VibeLife = 人类理解自己的基础设施                          │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   用户的四个核心问题               VibeLife 的四大支柱                        │
│   ────────────────────           ────────────────────                       │
│                                                                             │
│   "我想找专家咨询"          ──▶   CoreAgent + Skills (对话即服务)            │
│   "我的信息太分散"          ──▶   VibeProfile (用户信息统一)                 │
│   "我是谁？"               ──▶   Me + VibeInsight (跨维度自我认知)          │
│   "我要成为谁？"           ──▶   VibeTarget (目标与成长)                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 二、四大支柱

### 2.1 CoreAgent + Skills：对话即服务

**职责**：用户找专家咨询

```
┌─────────────────────────────────────────────────────────────────┐
│                    CoreAgent + Skills                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  核心能力：LLM 驱动的对话路由 + Skill 执行                        │
│                                                                  │
│  Skills（按领域划分）：                                           │
│  ─────────────────────────────────────────────────────────────   │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │  Core                                                    │     │
│  │  └─ core: 生命对话者（AI 的灵魂，始终激活）               │     │
│  ├─────────────────────────────────────────────────────────┤     │
│  │  心理成长                                                │     │
│  │  ├─ lifecoach: 人生教练（目标、卡点、成长）              │     │
│  │  └─ mindfulness: 正念导师（情绪、冥想）                  │     │
│  ├─────────────────────────────────────────────────────────┤     │
│  │  东方命理                                                │     │
│  │  └─ bazi: 八字命理（格局、运势、时机）                   │     │
│  ├─────────────────────────────────────────────────────────┤     │
│  │  西方占星                                                │     │
│  │  └─ zodiac: 西方占星（星盘、行运）                       │     │
│  ├─────────────────────────────────────────────────────────┤     │
│  │  直觉洞察                                                │     │
│  │  └─ tarot: 塔罗占卜（当下指引）                          │     │
│  ├─────────────────────────────────────────────────────────┤     │
│  │  职业发展                                                │     │
│  │  └─ career: 职业规划（人岗匹配）                         │     │
│  ├─────────────────────────────────────────────────────────┤     │
│  │  自我认知                                                │     │
│  │  ├─ vibe_id: 人格画像（东西方融合）                      │     │
│  │  └─ jungastro: 荣格占星（心理学视角）                    │     │
│  └─────────────────────────────────────────────────────────┘     │
│                                                                  │
│  关键特性：                                                       │
│  • LLM 自动路由（不是 if-else）                                  │
│  • 配置驱动（SKILL.md）                                          │
│  • Tool Calling（工具即能力）                                    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

### 2.2 VibeProfile：用户信息统一

**职责**：一个人的完整画像

```
┌─────────────────────────────────────────────────────────────────┐
│                       VibeProfile                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  三层数据架构：                                                   │
│  ─────────────────────────────────────────────────────────────   │
│                                                                  │
│  Layer 1: Identity（身份）                                       │
│  ─────────────────────────────────────────────────────────────   │
│  来源：用户填写                                                   │
│  内容：birth_info, display_name, preferences                     │
│                                                                  │
│  Layer 2: Skills（Skill 原始数据）                               │
│  ─────────────────────────────────────────────────────────────   │
│  来源：各 Skill 实时写入                                         │
│  内容：bazi.chart, zodiac.chart, lifecoach.{...}, tarot.{...}   │
│                                                                  │
│  Layer 3: Vibe（共享深度信息）← 核心创新                         │
│  ─────────────────────────────────────────────────────────────   │
│  来源：抽取（activities）+ 同步（skills）                         │
│  内容：                                                           │
│    • vibe.insight（我是谁：本质+动态+规律）                       │
│    • vibe.target（我要成为谁：目标+聚焦+里程碑）                  │
│                                                                  │
│  ─────────────────────────────────────────────────────────────   │
│                                                                  │
│  核心原则：                                                       │
│  • Skills 是原始数据：每个 Skill 存自己的数据，互不干扰           │
│  • Vibe 是共享洞察：跨 Skill 共享，所有 Skill 都可读取           │
│  • Vibe 双来源：抽取（activities）+ 同步（skills）               │
│  • Single Source of Truth                                        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

### 2.3 Me + VibeInsight：我是谁

**职责**：跨维度的自我认知

**VibeInsight 模型（荣格 + 阿德勒融合）**：

```
┌─────────────────────────────────────────────────────────────────┐
│                    VibeInsight 三维模型                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │                                                          │     │
│  │   维度 1: 本质 (Essence) — 我是什么                       │     │
│  │   ─────────────────────────────────────────────────────  │     │
│  │                                                          │     │
│  │   静态层：先天倾向                                        │     │
│  │   来源：skill_data.bazi + skill_data.zodiac              │     │
│  │                                                          │     │
│  │   {                                                       │     │
│  │     archetype: {                                          │     │
│  │       primary: "creator",      // 主原型                  │     │
│  │       secondary: "explorer",   // 副原型                  │     │
│  │       shadow: "ruler"          // 阴影原型                │     │
│  │     },                                                    │     │
│  │     traits: [                                             │     │
│  │       { source: "bazi", trait: "表达力强" },              │     │
│  │       { source: "zodiac", trait: "好奇心旺" }             │     │
│  │     ]                                                     │     │
│  │   }                                                       │     │
│  │                                                          │     │
│  └─────────────────────────────────────────────────────────┘     │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │                                                          │     │
│  │   维度 2: 动态 (Dynamic) — 我现在怎么样 + 往哪走          │     │
│  │   ─────────────────────────────────────────────────────  │     │
│  │                                                          │     │
│  │   动态层：当前状态 + 变化趋势                             │     │
│  │   来源：对话抽取（ProfileExtractor）                      │     │
│  │                                                          │     │
│  │   {                                                       │     │
│  │     // 当前状态                                           │     │
│  │     emotion: { current: "calm", intensity: 0.6 },        │     │
│  │     energy: { level: 0.7, focus: ["career"] },           │     │
│  │     active_archetype: "creator",                          │     │
│  │                                                          │     │
│  │     // 变化趋势                                           │     │
│  │     trend: {                                              │     │
│  │       archetype_shift: { rising: "pioneer", delta: 0.05 },│     │
│  │       emotion_trend: "stable",                            │     │
│  │       direction: "expansion"                              │     │
│  │     }                                                     │     │
│  │   }                                                       │     │
│  │                                                          │     │
│  └─────────────────────────────────────────────────────────┘     │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │                                                          │     │
│  │   维度 3: 规律 (Pattern) — 我的行为模式                   │     │
│  │   ─────────────────────────────────────────────────────  │     │
│  │                                                          │     │
│  │   洞察层：长期规律                                        │     │
│  │   来源：历史行为分析                                      │     │
│  │                                                          │     │
│  │   {                                                       │     │
│  │     behaviors: [                                          │     │
│  │       { pattern: "晚间活跃", confidence: 0.8 },           │     │
│  │       { pattern: "周期性低落", trigger: "周一" }          │     │
│  │     ],                                                    │     │
│  │     insights: [                                           │     │
│  │       "你在压力下倾向于独处思考",                         │     │
│  │       "创意灵感常在深夜涌现"                              │     │
│  │     ]                                                     │     │
│  │   }                                                       │     │
│  │                                                          │     │
│  └─────────────────────────────────────────────────────────┘     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**Me 页设计原则**：

```
┌─────────────────────────────────────────────────────────────────┐
│                         Me 页                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  首屏：一句话核心洞察                                            │
│  ─────────────────────────────────────────────────────────────   │
│  "你的创造者特质正在显化，近期频繁讨论写作与此呼应。"              │
│                                                                  │
│  展开：三维画像                                                   │
│  ─────────────────────────────────────────────────────────────   │
│  • 本质：我是什么（原型 + 特质）                                 │
│  • 动态：我现在怎么样 + 往哪走（状态 + 趋势）                    │
│  • 规律：我的模式（行为洞察）                                    │
│                                                                  │
│  ─────────────────────────────────────────────────────────────   │
│                                                                  │
│  核心原则：                                                       │
│  • 本质是"倾向"，不是"定论"                                      │
│  • 动态每天都在变，趋势展示成长方向                              │
│  • 规律帮助自我觉察，而非预测命运                                │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

### 2.4 VibeTarget：我要成为谁

**职责**：目标管理与成长陪伴

**实现方式**：
- **前端页面**：Journey 页面 (`/journey`)
- **数据存储**：`skill_data.lifecoach`
- **API 端点**：`/api/v1/skills/lifecoach/state_read` 和 `state_write`
- **核心 Skill**：lifecoach（人生教练）协议流程生成结构化目标数据

**VibeTarget 模型（与 VibeInsight 平行）**：

```
┌─────────────────────────────────────────────────────────────────┐
│                    VibeTarget 三维模型                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │                                                          │     │
│  │   维度 1: 目标 (Goals) — 我想要什么                       │     │
│  │   ─────────────────────────────────────────────────────  │     │
│  │                                                          │     │
│  │   来源：对话抽取 + 专门协议流程                           │     │
│  │   • 对话抽取：ProfileExtractor 自动识别用户目标           │     │
│  │   • 专门流程：协议生成 north_star（lifecoach/mindfulness 等）│     │
│  │     包含愿景场景/反愿景/痛点/身份等结构化目标数据          │     │
│  │                                                          │     │
│  │   {                                                       │     │
│  │     goals: [                                              │     │
│  │       {                                                   │     │
│  │         id: "goal_001",                                   │     │
│  │         title: "完成写作项目",                            │     │
│  │         source: "对话抽取",    // 或 "用户手动添加"       │     │
│  │         status: "in_progress",                            │     │
│  │         progress: 0.6,                                    │     │
│  │         created_at: "2026-01-10",                         │     │
│  │         check_ins: [{ date: "...", note: "..." }]         │     │
│  │       }                                                   │     │
│  │     ]                                                     │     │
│  │   }                                                       │     │
│  │                                                          │     │
│  └─────────────────────────────────────────────────────────┘     │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │                                                          │     │
│  │   维度 2: 聚焦 (Focus) — 我现在关注什么                   │     │
│  │   ─────────────────────────────────────────────────────  │     │
│  │                                                          │     │
│  │   来源：话题热度 + 目标活跃度                             │     │
│  │                                                          │     │
│  │   {                                                       │     │
│  │     primary: "career",         // 主要聚焦领域            │     │
│  │     secondary: ["growth"],     // 次要领域                │     │
│  │     active_goal: "goal_001",   // 当前最活跃目标          │     │
│  │     heat_map: {                                           │     │
│  │       career: 0.8, growth: 0.5, health: 0.2              │     │
│  │     }                                                     │     │
│  │   }                                                       │     │
│  │                                                          │     │
│  └─────────────────────────────────────────────────────────┘     │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │                                                          │     │
│  │   维度 3: 里程碑 (Milestones) — 我走过了什么              │     │
│  │   ─────────────────────────────────────────────────────  │     │
│  │                                                          │     │
│  │   来源：目标完成 + 重要时刻记录                           │     │
│  │                                                          │     │
│  │   {                                                       │     │
│  │     achieved: [                                           │     │
│  │       { goal_id: "...", title: "...", achieved_at: "..." }│     │
│  │     ],                                                    │     │
│  │     streak: { current: 7, best: 14 },  // 连续打卡        │     │
│  │     moments: [                                            │     │
│  │       { date: "...", event: "首次公开分享写作" }          │     │
│  │     ]                                                     │     │
│  │   }                                                       │     │
│  │                                                          │     │
│  └─────────────────────────────────────────────────────────┘     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**VibeTarget 页设计（Journey 页面）**：

```
┌─────────────────────────────────────────────────────────────────┐
│                      Journey 页面 (VibeTarget)                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  访问路径：/journey                                               │
│  数据来源：skill_data.lifecoach                                   │
│  ─────────────────────────────────────────────────────────────   │
│                                                                  │
│  渐进式展示（4 状态系统）：                                        │
│                                                                  │
│  State 0 (empty): 北极星引导                                      │
│  State 1 (north_star_set): 北极星 + 身份转换                      │
│  State 2 (planned): 年度目标 + 月度 Boss                          │
│  State 3 (executing): 完整仪表盘                                  │
│  ─────────────────────────────────────────────────────────────   │
│                                                                  │
│  核心功能：                                                       │
│  • 北极星愿景（vision_scene + anti_vision_scene）                │
│  • 年度目标（goals + milestones）                                 │
│  • 月度 Boss + 周大石头 + 每日杠杆                                │
│  • 进度统计（streak + 签到历史）                                  │
│  ─────────────────────────────────────────────────────────────   │
│                                                                  │
│  数据来源：                                                       │
│  • 专门协议：lifecoach 协议流程生成 north_star（优先级最高）      │
│    - Dan Koe 6 问协议、Covey 8 问协议等                           │
│    - 包含愿景场景、反愿景、痛点、身份宣言等结构化数据            │
│  • 对话抽取：ProfileExtractor 自动识别用户明确表达的愿望/计划    │
│  • 用户手动：Journey 页面直接添加/编辑目标                        │
│                                                                  │
│  ─────────────────────────────────────────────────────────────   │
│                                                                  │
│  设计原则：                                                       │
│  • 默认不加入命理元素（纯粹的目标管理）                          │
│  • 用户主动询问时，才提供命理视角                                │
│  • 重点是陪伴和鼓励，不是预测和判断                              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 三、数据流

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              数据流全景                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  写入流：                                                                    │
│  ─────────────────────────────────────────────────────────────────────────  │
│                                                                             │
│  用户对话 (Chat)                                                            │
│      │                                                                      │
│      ├─ Bazi Skill ─────▶ skill_data.bazi (命盘)                           │
│      ├─ Zodiac Skill ───▶ skill_data.zodiac (星盘)                         │
│      │                                                                      │
│      ▼                                                                      │
│  conversations/messages                                                     │
│      │                                                                      │
│      ▼ (每日凌晨 3 点)                                                      │
│  ProfileExtractor                                                           │
│      │                                                                      │
│      ├─▶ vibe_insight (本质 + 动态 + 规律)  ← 我是谁                        │
│      └─▶ vibe_target (目标 + 聚焦 + 里程碑) ← 我要成为谁                    │
│                                                                             │
│  ─────────────────────────────────────────────────────────────────────────  │
│                                                                             │
│  读取流：                                                                    │
│  ─────────────────────────────────────────────────────────────────────────  │
│                                                                             │
│  Me 页 ◀─────────── vibe_insight                                           │
│  VibeTarget 页 ◀──── vibe_target                                           │
│  Chat ◀───────────── skill_data + vibe_insight (上下文注入)                │
│  Proactive ◀──────── vibe_insight.dynamic + vibe_target.focus              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 四、VibeProfile 数据结构

```json
{
  "identity": {
    "birth_info": { "date": "1990-01-01", "time": "12:00", "location": "北京" },
    "account": { "vibe_id": "VB-xxx", "display_name": "用户" }
  },

  "skill_data": {
    "bazi": { "chart": {...}, "dayun": {...} },
    "zodiac": { "natal_chart": {...}, "transits": {...} },

    "lifecoach": {
      // VibeTarget 实际存储位置 (通过 Journey 页面访问)
      "north_star": {
        "vision_scene": "3年后的理想场景描述",
        "anti_vision_scene": "不想要的未来场景",
        "pain_points": ["持续的不满1", "持续的不满2"],
        "vision_timeframe": "3年后"
      },
      "goals": [
        {
          "id": "goal_001",
          "title": "完成写作项目",
          "description": "详细描述",
          "category": "career",
          "source": "lifecoach",  // 或 "对话抽取"、"用户手动"
          "status": "in_progress",
          "progress": 0.6,
          "year": 2026,
          "created_at": "2026-01-10T08:00:00Z",
          "check_ins": [
            { "date": "2026-01-18", "note": "写了3章", "progress": 0.6 }
          ],
          "milestones": [
            { "id": "m1", "title": "完成大纲", "completed": true, "completed_at": "..." }
          ]
        }
      ],
      "current": {
        "week": {
          "week_start": "2026-01-20",
          "rocks": [{ "id": "...", "task": "周大石头", "status": "...", "progress": 0.5 }]
        },
        "daily": {
          "date": "2026-01-21",
          "levers": [{ "id": "...", "task": "每日杠杆", "status": "completed" }]
        },
        "month": {
          "id": "boss_001",
          "title": "月度Boss",
          "month": "2026-01",
          "progress": 0.7,
          "goal_id": "goal_001"
        }
      },
      "progress": {
        "current_streak": 7,
        "longest_streak": 14,
        "total_checkins": 50,
        "last_checkin_date": "2026-01-21"
      },
      "focus": {
        "primary": "career",
        "active_goal": "goal_001",
        "heat_map": { "career": 0.8, "growth": 0.5, "health": 0.2 }
      }
    }
  },

  "vibe_insight": {
    "essence": {
      "archetype": { "primary": "creator", "secondary": "explorer", "shadow": "ruler" },
      "traits": [
        { "source": "bazi", "trait": "表达力强" },
        { "source": "zodiac", "trait": "好奇心旺" }
      ]
    },
    "dynamic": {
      "emotion": { "current": "calm", "intensity": 0.6 },
      "energy": { "level": 0.7 },
      "active_archetype": "creator",
      "trend": { "archetype_shift": { "rising": "pioneer" }, "direction": "expansion" }
    },
    "pattern": {
      "behaviors": [{ "pattern": "晚间活跃", "confidence": 0.8 }],
      "insights": ["创意灵感常在深夜涌现"]
    },
    "updated_at": "2026-01-21T03:00:00Z"
  },

  "preferences": { "timezone": "Asia/Shanghai" }
}
```

---

## 五、API 设计

### 5.1 Me API

```
GET /api/v1/me/dashboard

Response:
{
  "primary_insight": "你的创造者特质正在显化",
  "vibe_insight": {
    "essence": { "archetype": {...}, "traits": [...] },
    "dynamic": { "emotion": {...}, "energy": {...}, "trend": {...} },
    "pattern": { "behaviors": [...], "insights": [...] }
  },
  "data_level": "A"
}
```

### 5.2 Journey API (VibeTarget)

```
# 前端 API 代理
GET /api/journey
→ 调用后端: POST /api/v1/skills/lifecoach/state_read
  sections: ["system", "north_star", "identity", "current", "progress", "goals", "focus"]

Response:
{
  "system": { "active_framework": "dankoe", ... },
  "north_star": { "vision_scene": "...", "anti_vision_scene": "..." },
  "goals": [...],
  "current": { "week": {...}, "daily": {...}, "month": {...} },
  "progress": { "current_streak": 7, "longest_streak": 14, ... },
  "focus": { "primary": "career", "active_goal": "goal_001", "heat_map": {...} }
}

# 更新目标
POST /api/journey
→ 调用后端: POST /api/v1/skills/lifecoach/state_write
Body: {
  "section": "goals",  // 或 "north_star", "current", "focus"
  "data": {...}
}

# 每日签到
POST /api/v1/skills/lifecoach/checkin
Body: { "energy_level": 7, "mood": "good", "intention": "..." }

# 完成每日杠杆
POST /api/v1/skills/lifecoach/lever_complete
Body: { "lever_id": "...", "notes": "..." }

# 完成周大石头
POST /api/v1/skills/lifecoach/rock_complete
Body: { "rock_id": "...", "reflection": "..." }
```

---

## 六、关键设计决策

| 决策 | 内容 |
|------|------|
| Skill 分类 | 按领域划分（心理/命理/占星/直觉/职业/认知），不分层级 |
| VibeInsight | 三维：本质(静态) + 动态(状态+趋势) + 规律(模式) |
| VibeTarget | **实现为 Journey 页面（skill_data.lifecoach）** |
| VibeTarget 结构 | north_star + goals + current(week/daily/month) + progress + focus |
| 数据来源 | VibeInsight 由 ProfileExtractor 生成；VibeTarget 由 lifecoach 协议生成 |
| 命理与目标 | 默认分离，用户主动询问时才融合 |
| 数据分层 | Identity → Skill Data (含 lifecoach) → VibeInsight（三层） |

---

## 七、实施路径（简化）

| Phase | 内容 | 时间 | 状态 |
|-------|------|------|------|
| 1 | Skills category 字段补齐 | 0.5天 | ✅ 已完成 |
| 2 | Lifecoach 补齐缺失字段（source/created_at/check_ins/focus） | 0.5天 | 进行中 |
| 3 | ProfileExtractor 升级（VibeInsight 三维模型） | 2-3天 | 待开始 |
| 4 | Me 页 + API（VibeInsight） | 2天 | 待开始 |

---

## 八、与北极星对齐

| 北极星 | 实现 |
|--------|------|
| 深度理解 | VibeInsight 三维模型（本质 + 动态 + 规律） |
| 主动关心 | Proactive（基于 dynamic + goals） |
| 无限扩展 | Skills 按领域划分 |
| 温暖不粘腻 | VibeTarget 默认不加命理判断 |

---

> **Version**: 11.3 | 2026-01-21
