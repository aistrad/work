version: "1.0"
skill_id: synastry

# ═══════════════════════════════════════════════════════════════════════════
# Collect Tools
# ═══════════════════════════════════════════════════════════════════════════

collect:
  - name: collect_synastry_info
    description: |
      收集合盘对象的出生信息。
      当用户想要查看合盘但未指定对方信息时调用此工具。
    card_type: collect_synastry_info
    parameters:
      - name: relationship_type
        type: string
        enum: [romantic, spouse, parent_child, sibling, business, friend]
        required: true
        description: 关系类型
      - name: person_name
        type: string
        required: true
        description: 对方姓名或昵称
      - name: birth_date
        type: string
        format: date
        required: true
        description: 出生日期 (YYYY-MM-DD)
      - name: birth_time
        type: string
        format: time
        required: false
        description: 出生时间 (HH:MM)，不填则默认正午
      - name: birth_place
        type: string
        required: true
        description: 出生地点（城市名）
      - name: notes
        type: string
        required: false
        description: 备注信息
      - name: save_relationship
        type: boolean
        required: false
        default: true
        description: 是否保存关系对象

  - name: select_relationship
    description: |
      展示已保存的关系对象列表，让用户选择。
      当用户已保存过关系对象时优先调用此工具。
    card_type: select_relationship
    parameters:
      - name: relationships
        type: array
        required: true
        description: 关系对象列表（从 Profile 读取）

# ═══════════════════════════════════════════════════════════════════════════
# Compute Tools
# ═══════════════════════════════════════════════════════════════════════════

compute:
  - name: calculate_synastry
    description: |
      计算两人的合盘分析。
      会根据用户已订阅的 Skill 自动计算对应维度。
    parameters:
      - name: person2_birth_info
        type: object
        required: true
        description: 对方的出生信息
        properties:
          date:
            type: string
            format: date
          time:
            type: string
            format: time
          place:
            type: string
          timezone:
            type: string
      - name: relationship_type
        type: string
        enum: [romantic, spouse, parent_child, sibling, business, friend]
        required: true
        description: 关系类型
      - name: relationship_id
        type: string
        required: false
        description: 已保存的关系对象 ID（如果是从已保存对象发起）
      - name: person_name
        type: string
        required: false
        description: 对方姓名

# ═══════════════════════════════════════════════════════════════════════════
# Display Tools
# ═══════════════════════════════════════════════════════════════════════════

display:
  - name: show_synastry_overview
    description: 展示合盘总览卡片，包含综合评分和各维度摘要
    card_type: synastry_overview
    parameters:
      - name: person1
        type: object
        required: true
        description: 用户信息摘要
      - name: person2
        type: object
        required: true
        description: 对方信息摘要
      - name: relationship_type
        type: string
        required: true
      - name: overall_score
        type: number
        required: true
        description: 综合评分 0-100
      - name: dimensions
        type: array
        required: true
        description: 各维度评分
      - name: strengths
        type: array
        required: false
        description: 关系亮点
      - name: challenges
        type: array
        required: false
        description: 需要注意的地方
      - name: advice
        type: array
        required: false
        description: 相处建议

  - name: show_zodiac_synastry
    description: 展示星座合盘详情
    card_type: zodiac_synastry
    parameters:
      - name: synastry_data
        type: object
        required: true

  - name: show_bazi_synastry
    description: 展示八字合婚详情
    card_type: bazi_synastry
    parameters:
      - name: synastry_data
        type: object
        required: true

  - name: show_jungastro_synastry
    description: 展示荣格关系分析
    card_type: jungastro_synastry
    parameters:
      - name: synastry_data
        type: object
        required: true

  # ─────────────────────────────────────────────────────────────────
  # Privacy Pairing Display Tools
  # ─────────────────────────────────────────────────────────────────

  - name: show_pairing_code
    description: |
      显示用户的 Vibe 配对码。
      当用户想要分享配对码给他人时调用此工具。
    card_type: pairing_code
    parameters: []

  - name: show_pairing_requests
    description: |
      显示待处理的配对请求列表。
      当有人向用户发起配对请求时展示此卡片。
    card_type: pairing_request_list
    parameters: []

  - name: show_pairing_invite
    description: |
      显示生成的邀请链接和二维码。
      当用户想要邀请新用户合盘时展示此卡片。
    card_type: pairing_invite
    parameters:
      - name: url
        type: string
        required: true
        description: 邀请链接
      - name: relationship_type
        type: string
        required: true
        description: 关系类型
      - name: expires_at
        type: string
        required: false
        description: 过期时间

  - name: show_privacy_synastry_result
    description: |
      显示隐私安全的合盘结果。
      结果不包含任何原始出生数据。
    card_type: privacy_synastry_result
    parameters:
      - name: person1
        type: object
        required: true
        description: 用户信息摘要（仅包含姓名）
      - name: person2
        type: object
        required: true
        description: 对方信息摘要（仅包含姓名）
      - name: overall_score
        type: number
        required: true
      - name: overall_label
        type: string
        required: true
      - name: dimensions
        type: array
        required: true
      - name: strengths
        type: array
        required: false
      - name: challenges
        type: array
        required: false
      - name: advice
        type: array
        required: false

# ═══════════════════════════════════════════════════════════════════════════
# Action Tools
# ═══════════════════════════════════════════════════════════════════════════

action:
  - name: save_relationship
    description: 保存关系对象到用户档案
    parameters:
      - name: name
        type: string
        required: true
        description: 姓名
      - name: relationship_type
        type: string
        required: true
        description: 关系类型
      - name: birth_info
        type: object
        required: true
        description: 出生信息
      - name: notes
        type: string
        required: false
        description: 备注

  - name: save_synastry_insight
    description: 保存合盘洞察到 vibeRelationship
    parameters:
      - name: relationship_id
        type: string
        required: true
        description: 关系对象 ID
      - name: insight
        type: object
        required: true
        description: 合盘洞察数据
      - name: is_primary
        type: boolean
        required: false
        default: false
        description: 是否设为主要伴侣

  # ─────────────────────────────────────────────────────────────────
  # Privacy Pairing Action Tools
  # ─────────────────────────────────────────────────────────────────

  - name: request_pairing
    description: |
      向另一用户发起配对请求。
      需要对方同意才能计算合盘，保护双方隐私。
    parameters:
      - name: target_vibe_id
        type: string
        required: true
        description: 对方的 Vibe ID (VB-XXXXXXXX)
      - name: relationship_type
        type: string
        enum: [romantic, spouse, parent_child, sibling, business, friend]
        required: true
        description: 关系类型
      - name: message
        type: string
        required: false
        description: 给对方的留言

  - name: accept_pairing_request
    description: |
      接受配对请求并计算合盘。
      接受后系统自动计算合盘并通知双方。
    parameters:
      - name: request_id
        type: string
        required: true
        description: 配对请求 ID

  - name: reject_pairing_request
    description: 拒绝配对请求
    parameters:
      - name: request_id
        type: string
        required: true
        description: 配对请求 ID

  - name: generate_invite_link
    description: |
      生成一次性邀请链接。
      可分享给未注册用户，对方注册后自动触发合盘。
    parameters:
      - name: relationship_type
        type: string
        enum: [romantic, spouse, parent_child, sibling, business, friend]
        required: true
        description: 关系类型
      - name: message
        type: string
        required: false
        description: 邀请留言

  - name: delete_synastry_result
    description: |
      删除自己的合盘记录。
      只删除自己的记录，不影响对方的记录。
    parameters:
      - name: partner_id
        type: string
        required: true
        description: 对方的用户 ID
