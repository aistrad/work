"use client";

import { cn } from "@/lib/utils";
import { type SkillType } from "./LuminousPaper";
import { BreathAura } from "./BreathAura";
import { useId } from "react";

// ═══════════════════════════════════════════════════════════════════════════
// VibeGlyph - 橙子 Logo
// 品牌图标：扁平卡通风格，深色描边
// ═══════════════════════════════════════════════════════════════════════════

interface VibeGlyphProps {
  size?: "sm" | "md" | "lg" | "xl";
  skill?: SkillType;
  showAura?: boolean;
  animate?: boolean;
  /** v11: 思考中动画 (类似 Claude/Gemini) */
  isThinking?: boolean;
  className?: string;
}

const sizeConfig = {
  sm: { container: "w-8 h-8", icon: 28, aura: "sm" as const },
  md: { container: "w-10 h-10", icon: 36, aura: "md" as const },
  lg: { container: "w-14 h-14", icon: 48, aura: "lg" as const },
  xl: { container: "w-20 h-20", icon: 72, aura: "xl" as const },
};

// 扁平卡通风格橙子图标（参考 logo.png）
function OrangeIcon({ size, id }: { size: number; id: string }) {
  const shadowId = `shadow-${id}`;

  return (
    <svg
      width={size}
      height={size}
      viewBox="0 0 48 48"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <defs>
        {/* 阴影渐变 */}
        <radialGradient id={shadowId} cx="50%" cy="50%" r="50%">
          <stop offset="0%" stopColor="#555" stopOpacity="0.25" />
          <stop offset="100%" stopColor="#555" stopOpacity="0" />
        </radialGradient>
      </defs>

      {/* 底部阴影 */}
      <ellipse cx="24" cy="44" rx="14" ry="3" fill={`url(#${shadowId})`} />

      {/* 橙子主体 - 带深色描边 */}
      <circle cx="24" cy="26" r="17" fill="#FBBD6A" stroke="#4A4A4A" strokeWidth="2" />

      {/* 叶子 - 简洁椭圆形绿叶 */}
      <ellipse
        cx="12"
        cy="6"
        rx="6"
        ry="3.5"
        fill="#7BC96F"
        stroke="#4A4A4A"
        strokeWidth="1.5"
        transform="rotate(-35, 12, 6)"
      />

      {/* 茎 - 弯曲连接到橙子顶部 */}
      <path
        d="M16 8 C18 8, 20 9, 21 10"
        stroke="#4A4A4A"
        strokeWidth="2"
        strokeLinecap="round"
        fill="none"
      />
    </svg>
  );
}

export function VibeGlyph({
  size = "md",
  skill = "bazi",
  showAura = false,
  animate = false,
  className,
}: VibeGlyphProps) {
  const config = sizeConfig[size];
  const uniqueId = useId();

  return (
    <div
      className={cn(
        "vibe-glyph relative flex items-center justify-center",
        config.container,
        animate && "animate-float",
        className
      )}
    >
      {/* Breath aura background */}
      {showAura && (
        <BreathAura
          skill={skill}
          size={config.aura}
          position="center"
          intensity="medium"
          className="absolute"
        />
      )}

      {/* 橙子图标 */}
      <div className="vibe-glyph-inner relative z-10">
        <OrangeIcon size={config.icon} id={uniqueId} />
      </div>
    </div>
  );
}

// ═══════════════════════════════════════════════════════════════════════════
// SimpleVibeGlyph - 简化版橙子图标
// ═══════════════════════════════════════════════════════════════════════════

interface SimpleVibeGlyphProps {
  size?: number;
  skill?: SkillType;
  className?: string;
}

export function SimpleVibeGlyph({
  size = 24,
  skill = "bazi",
  className,
}: SimpleVibeGlyphProps) {
  return (
    <svg
      width={size}
      height={size}
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      {/* 橙子主体 - 带描边 */}
      <circle cx="12" cy="13" r="8.5" fill="#FBBD6A" stroke="#4A4A4A" strokeWidth="1.2" />
      {/* 叶子 - 带描边 */}
      <path
        d="M8 5 Q5 3, 7 1 Q9 3, 8 5"
        fill="#7BC96F"
        stroke="#4A4A4A"
        strokeWidth="0.8"
        strokeLinejoin="round"
      />
      {/* 茎 */}
      <path
        d="M9 5 Q10 4, 11 4.5"
        stroke="#4A4A4A"
        strokeWidth="1.2"
        strokeLinecap="round"
        fill="none"
      />
    </svg>
  );
}

export default VibeGlyph;
