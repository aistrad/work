'use client';

/**
 * SkillIntroCard - Skill ä»‹ç»å¡ç‰‡
 *
 * å½“ç”¨æˆ·é¦–æ¬¡ä½¿ç”¨æŸä¸ª Skill æ—¶å±•ç¤ºï¼Œä»‹ç»è¯¥ Skill çš„åŠŸèƒ½å’Œç‰¹ç‚¹ã€‚
 * é€šè¿‡ show(type="skill_intro", data={skill_id: "xxx"}) è§¦å‘ã€‚
 *
 * v11.0 æ–°å¢
 */

import React, { memo, useState, useCallback } from 'react';
import { cn } from '@/lib/utils';
import { Sparkles, ChevronRight, X, Check } from 'lucide-react';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Types
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface SkillInfo {
  id: string;
  name: string;
  description: string;
  icon?: string;
  color?: string;
  category?: string;
  tagline?: string;
  features?: string[];
  trial_messages?: number;
}

interface SkillIntroCardProps {
  skillId?: string;
  skill?: SkillInfo;
  reason?: string;
  variant?: 'default' | 'compact';
  onAction?: (action: { type: string; skillId?: string }) => void;
  onDismiss?: () => void;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SkillIntroCard Component
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function SkillIntroCard({
  skillId,
  skill,
  reason,
  variant = 'default',
  onAction,
  onDismiss,
}: SkillIntroCardProps): React.ReactElement | null {
  const [dismissed, setDismissed] = useState(false);

  // Handle dismiss
  const handleDismiss = useCallback(() => {
    setDismissed(true);
    onDismiss?.();
  }, [onDismiss]);

  // Handle start action
  const handleStart = useCallback(() => {
    onAction?.({ type: 'start', skillId: skill?.id || skillId });
  }, [onAction, skill?.id, skillId]);

  // Early return if dismissed or no skill data
  if (dismissed || !skill) {
    return null;
  }

  const iconBgColor = skill.color ? `${skill.color}20` : 'rgba(234, 190, 138, 0.15)';
  const isCompact = variant === 'compact';

  return (
    <div
      className={cn(
        'rounded-xl overflow-hidden border backdrop-blur-sm',
        'border-accent-primary/20 bg-gradient-to-br from-accent-primary/5 to-accent-primary/10',
        isCompact ? 'my-2' : 'my-3'
      )}
    >
      {/* Header */}
      <div className="px-4 py-3 border-b border-white/10 flex items-center justify-between">
        <div className="flex items-center gap-2">
          <Sparkles className="w-4 h-4 text-accent-primary" />
          <span className="text-sm font-medium text-text-primary">
            {isCompact ? skill.name : `æ¬¢è¿ä½¿ç”¨ ${skill.name}`}
          </span>
        </div>
        <button
          onClick={handleDismiss}
          className="p-1 rounded-lg hover:bg-white/10 transition-colors"
          aria-label="å…³é—­ä»‹ç»"
        >
          <X className="w-4 h-4 text-text-tertiary" />
        </button>
      </div>

      {/* Content */}
      <div className={cn('p-4', isCompact && 'py-3')}>
        {/* Skill Info */}
        <div className="flex items-start gap-3 mb-4">
          <div
            className="w-12 h-12 rounded-xl flex items-center justify-center text-2xl shrink-0"
            style={{ backgroundColor: iconBgColor }}
          >
            {skill.icon || 'ğŸ’¡'}
          </div>
          <div className="flex-1 min-w-0">
            {skill.tagline && (
              <p className="text-sm text-text-secondary mb-1">{skill.tagline}</p>
            )}
            <p className="text-sm text-text-tertiary line-clamp-2">
              {skill.description}
            </p>
          </div>
        </div>

        {/* Reason (if provided) */}
        {reason && (
          <div className="mb-4 px-3 py-2 rounded-lg bg-white/5 border border-white/10">
            <p className="text-xs text-text-secondary">{reason}</p>
          </div>
        )}

        {/* Features (if available and not compact) */}
        {!isCompact && skill.features && skill.features.length > 0 && (
          <div className="mb-4">
            <p className="text-xs text-text-tertiary mb-2 font-medium">æ ¸å¿ƒåŠŸèƒ½</p>
            <ul className="space-y-1.5">
              {skill.features.slice(0, 3).map((feature, index) => (
                <li key={index} className="flex items-start gap-2 text-sm text-text-secondary">
                  <Check className="w-4 h-4 text-accent-primary shrink-0 mt-0.5" />
                  <span>{feature}</span>
                </li>
              ))}
            </ul>
          </div>
        )}

        {/* Trial info */}
        {skill.trial_messages && skill.trial_messages > 0 && (
          <p className="text-xs text-text-tertiary mb-3">
            å…è´¹ä½“éªŒ {skill.trial_messages} æ¬¡å¯¹è¯
          </p>
        )}

        {/* Action button */}
        <button
          onClick={handleStart}
          className={cn(
            'w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg',
            'bg-accent-primary/20 hover:bg-accent-primary/30',
            'text-sm font-medium text-text-primary',
            'transition-all duration-200',
            'border border-accent-primary/30 hover:border-accent-primary/50'
          )}
        >
          <span>å¼€å§‹ä½¿ç”¨</span>
          <ChevronRight className="w-4 h-4" />
        </button>
      </div>
    </div>
  );
}

export default memo(SkillIntroCard);
