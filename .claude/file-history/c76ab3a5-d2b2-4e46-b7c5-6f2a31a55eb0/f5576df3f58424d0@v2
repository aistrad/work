# Soul OS 心理架构设计（Claude MVP）

**文档类型**：Operating System Psychological Architecture
**版本**：Claude MVP v1.0
**日期**：2025-12-31
**定位**：基于深度心理学的精神数字孪生操作系统
**理论框架**：荣格分析心理学 × 积极心理学 × 行为科学 × 自我决定理论

---

## 0. 设计哲学

### 0.1 核心假设

人类心理痛苦的根源在于**自我-自性轴线的断裂**（Ego-Self Axis Alienation）。

现代人面临三重困境：
1. **身份碎片化**：社交媒体塑造的多重"表演性自我"导致核心自我感的丧失
2. **意义真空**：传统叙事框架（宗教、集体主义）瓦解后，个体缺乏稳定的意义来源
3. **行动瘫痪**：信息过载与选择悖论导致决策疲劳和习得性无助

### 0.2 解法：外部化与结构化

Soul OS 的核心策略是**外部化**（Externalization）——将潜意识的心理动力学过程显性化、可视化、可操作化。

这不是简单的"心理测试 + 建议输出"，而是构建一个**动态镜像系统**：
- **镜像**：用户在系统中看到自己心理结构的投射
- **对话**：与外化的心理成分（Agent）进行真实对话
- **整合**：通过行动闭环实现心理能量的再整合

### 0.3 与 MVP 的对齐

本设计完全遵循 `system_design_final_mvp.md` 的技术约束：
- **数据库**：PostgreSQL（fortune_ai）
- **LLM**：GLM（Z.AI）
- **前端**：两栏布局 + Bento 卡片
- **闭环**：Clarify → Insight → Prescription → Commitment → Action → Reflection

---

## 1. 四层架构：意识的计算模型

### 1.1 架构总览

```
┌─────────────────────────────────────────────────────────────────┐
│                    L3: Synthesis (意识/自我)                     │
│         元认知仲裁器 - GLM 对话 Agent + Guidance Card            │
│         功能：整合、决策、承诺邀请                               │
├─────────────────────────────────────────────────────────────────┤
│                    L2: Agents (策略/超我)                        │
│         多智能体并行分析（可扩展、可配置）                       │
│         功能：提供多元视角、具象化内部声音                       │
├─────────────────────────────────────────────────────────────────┤
│                    L1: Schema (特质/图式)                        │
│         现代心理学框架（PERMA/VIA/CBT 图式）                    │
│         功能：翻译 L0 为可操作心理语言                           │
├─────────────────────────────────────────────────────────────────┤
│                    L0: Firmware (定数/本我)                      │
│         八字/星盘 + 用户档案 + 行为沉淀                         │
│         功能：提供先验概率与确定性约束                           │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 心理学映射

| 层级 | 计算功能 | 心理学对应 | 荣格术语 | MVP 落地 |
|------|----------|------------|----------|----------|
| L0 | 不可变参数 | 气质/体质/先天倾向 | Psychoid（类心理层） | `fortune_bazi_snapshot.facts` |
| L1 | 静态图式 | 人格特质/认知图式 | Persona + Shadow | `fortune_user` + 偏好 |
| L2 | 多视角分析 | 内化客体/超我声音 | Complexes | RAG + 多 Prompt 模板 |
| L3 | 整合输出 | 执行自我/工作自我 | Ego | GLM A2UI 输出 |

---

## 2. L0 Firmware：定数层

### 2.1 心理学原理

在精神分析传统中，存在一个核心张力：**决定论 vs 自由意志**。

L0 层承认决定论的部分真理——人并非生而空白：
- **生物决定论**：气质类型、神经递质基线、昼夜节律
- **时空决定论**：出生时刻的天文配置（八字/星盘）作为隐喻性"出厂设置"
- **环境决定论**：早年依附模式、核心信念的形成

但承认定数不等于宿命论。L0 的功能是**设定边界条件**，而非预测结果。

### 2.2 数据结构（与 MVP 对齐）

```json
{
  "profile": {
    "name": "用户姓名",
    "gender": "男|女",
    "birthday_local": "YYYY-MM-DD HH:MM:SS",
    "tz_offset_hours": 8.0,
    "location": {"name": "城市", "longitude": 0.0, "latitude": 0.0}
  },
  "solar_time": {
    "true_solar_time_local": "真太阳时校正后的出生时间"
  },
  "bazi": {
    "pillars": {"year": "干支", "month": "干支", "day": "干支", "hour": "干支"},
    "day_master": {"gan": "日干", "element": "五行"},
    "wuxing_count": {"金": 0, "木": 0, "水": 0, "火": 0, "土": 0},
    "strength": {"score": 0, "level": "strong|neutral|weak"},
    "favorable_elements": ["喜用五行"],
    "shensha": [{"name": "神煞名", "hit": true, "note": "说明"}],
    "luck": {
      "da_yun": [{"index": 1, "gan_zhi": "大运干支", "start_age": 0, "end_age": 10}],
      "liu_nian_next5": [{"year": 2026, "gan_zhi": "流年干支"}]
    }
  },
  "version": {
    "compute_version": "bazi-tts-v1",
    "facts_hash": "sha256:..."
  }
}
```

### 2.3 心理学翻译规则

L0 的八字数据**不直接**呈现给用户，而是经过心理学翻译：

| 八字概念 | 心理学翻译 | 行动导向 |
|----------|------------|----------|
| 日主偏弱 | "你的能量更适合借力/合作，而非单打独斗" | "本周找一个支持者" |
| 食伤重 | "你有强烈的表达欲和创造力" | "每天留 15 分钟自由书写" |
| 官杀混杂 | "你可能感受到多重压力/权威冲突" | "写清哪些压力是你能控制的" |
| 桃花星 | "你在关系中有天然的吸引力和敏感度" | "觉察关系中的边界需求" |
| 驿马星 | "你有变动/探索的内在驱力" | "小范围实验胜过大规模改变" |

### 2.4 设计原则

1. **禁止宿命论断言**：永远不说"你命中注定"，只说"你的倾向是"
2. **行动处方必须跟随**：任何描述都必须伴随"你可以做什么"
3. **概率化表达**：使用"倾向"、"可能"、"更适合"，而非绝对化语言
4. **可追溯**：所有输出必须关联 `facts_hash`，保证一致性

---

## 3. L1 Schema：特质层

### 3.1 心理学框架选型

L1 层负责将 L0 的晦涩数据翻译为现代心理学语言。MVP 阶段采用以下框架：

#### 3.1.1 积极心理学 PERMA 模型

| 维度 | 定义 | 数据来源 |
|------|------|----------|
| **P** Positive Emotion | 积极情绪的频率与强度 | `fortune_checkin.mood/intensity` |
| **E** Engagement | 投入/心流体验 | 任务完成率 + 用户反馈 |
| **R** Relationships | 关系满意度 | 复盘输入 + 对话分析 |
| **M** Meaning | 意义感/目的感 | 计划参与 + 价值观对话 |
| **A** Accomplishment | 成就感 | `fortune_commitment.status='done'` |

#### 3.1.2 优势视角（VIA）

MVP 预设的 `14天优势发现之旅` 计划直接落地 VIA 理论：
- 识别个人标志性优势（Signature Strengths）
- 刻意应用优势于工作/关系场景
- 避免优势过度使用的阴影面

#### 3.1.3 认知图式（CBT）

从用户对话中提取的核心信念模式：
- **无助图式**："我改变不了"
- **不可爱图式**："我不值得被爱"
- **失败图式**："我总是失败"
- **控制图式**："我必须控制一切"

这些图式通过对话分析标注，作为 L2 Agent 输出的调节参数。

### 3.2 数据更新机制

L1 是**动态演化**的，通过以下数据持续更新：

| 数据源 | 更新触发 | 存储位置 |
|--------|----------|----------|
| 情绪打卡 | 每次打卡 | `fortune_checkin` |
| 任务完成 | 承诺闭环 | `fortune_commitment` |
| 复盘输入 | 每周/每日 | `fortune_reflection` |
| 对话分析 | 每次对话后异步 | `fortune_conversation_message.a2ui` |

### 3.3 Schema 快照（用于 LLM 输入）

```json
{
  "perma_snapshot": {
    "positive_emotion": {"score": 6.5, "trend": "up", "note": "本周情绪打卡平均"},
    "engagement": {"active_plans": 2, "completion_rate": 0.75},
    "relationships": {"recent_note": "提到与同事关系改善"},
    "meaning": {"core_value": "成长", "aligned_actions": 3},
    "accomplishment": {"weekly_done": 5, "streak": 4}
  },
  "cognitive_patterns": {
    "identified_schemas": ["控制图式"],
    "reframe_count": 2
  },
  "strengths_in_use": ["组织", "洞察"]
}
```

---

## 4. L2 Agents：策略层

### 4.1 心理学原理：内化客体与超我碎片

在客体关系理论中，人的内心世界充满了"内化客体"（Internalized Objects）——父母、导师、文化英雄的心理表征。这些内化客体构成了我们的"内部顾问委员会"。

L2 层的创新在于：**将这些内部声音外部化为可对话的 AI Agent**。

这不是简单的"角色扮演"，而是一种**结构性外化技术**（Structural Externalization）：
- 用户可以听到不同视角的建议
- 用户可以观察这些声音之间的冲突
- 用户最终保留整合与决策的权力（L3）

### 4.2 默认 Agent 设计

MVP 阶段实现一个"统一教练"Agent，但在 Prompt 层面支持多视角切换：

#### 4.2.1 核心 Agent：Performance Coach

**角色定位**：积极心理学取向的绩效教练

**核心功能**：
- 共情承接（不评判）
- 结构化问题拆解
- 行动处方生成
- 承诺邀请

**禁止行为**：
- 恐吓、羞辱、宿命论断言
- 自行计算八字事实
- 替代医疗/法律/投资建议

#### 4.2.2 视角模块（可扩展，MVP 暂不独立调用）

| 视角 | 优化函数 | 典型输出风格 | 适用场景 |
|------|----------|--------------|----------|
| 儒家/关系 | 和谐 + 秩序 | "考虑对方感受" | 人际冲突 |
| 第一性原理 | 真相 + 效率 | "问题的本质是什么" | 决策困境 |
| 系统思维 | 风险 + 概率 | "有哪些变量需要考虑" | 复杂问题 |
| 效能整合 | 平衡 + 可持续 | "重要且不紧急的事" | 时间管理 |

### 4.3 Agent 调用架构（MVP 简化版）

```
用户输入
    ↓
┌────────────────────────────────────────┐
│         L2: 单一 GLM 调用               │
│  System Prompt = Coach + 视角权重       │
│  facts = L0 + L1 + 知识库检索           │
└────────────────────────────────────────┘
    ↓
A2UI 输出（含多视角综合）
```

MVP 不引入多 Agent 并行/辩论，以降低复杂度和成本。多视角通过 **Prompt 模板参数化** 实现。

### 4.4 知识库支持（RAG）

L2 Agent 的输出质量依赖于结构化知识检索：

- **来源**：`bazi_kb_document` / `bazi_kb_chunk`（PostgreSQL FTS + pg_trgm）
- **检索**：关键词匹配 + 相似度排序，top-k=12
- **引用**：`kb_ref` 格式 `kb:doc:{doc_id}:page:{page_no}:chunk:{chunk_no}`

所有引用写入 `evidence.kb_refs`，保证可追溯。

---

## 5. L3 Synthesis：意识层

### 5.1 心理学原理：执行自我与元认知

L3 是系统的"前台意识"——用户直接交互的界面。在心理学术语中，它对应：
- **执行自我**（Executive Ego）：整合信息、做出决策
- **元认知**（Metacognition）：对思维过程的觉察与调节
- **工作自我**（Working Self）：当下正在运作的自我状态

L3 的核心任务不是"给出正确答案"，而是**引导用户完成整合**。

### 5.2 对话结构（6 步模型）

```
1. 情绪确认      ← 建立安全感，激活关系
   "听起来你现在感到..."

2. 结构解释      ← 导航：把混乱变清晰
   "让我们把这个问题拆解一下..."

3. 行动处方      ← ≤3 条，具体可执行
   "我建议你可以..."

4. 时间窗口      ← 只给干预窗口，不做长期预测
   "先试 7 天..."

5. 风险边界      ← 明确不做什么
   "这不替代专业医疗/法律建议"

6. 承诺邀请      ← 闭环的关键
   "你愿意先做哪一个？"
```

### 5.3 输出格式：Guidance Card + A2UI

所有 L3 输出必须结构化为两部分：

#### Guidance Card（服务端 SSOT）

存储于 `fortune_daily_guidance.card` 或消息 `a2ui` 字段：

```json
{
  "card_id": "uuid",
  "type": "daily_guidance|chat_response|checkin_response",
  "conclusion": "≤50字结论",
  "why": "依据（心理学语言）",
  "prescriptions": [
    {"task_id": "uuid", "content": "行动描述", "estimated_minutes": 5}
  ],
  "time_window": {
    "type": "intervention",
    "value": "7天试行",
    "confidence": "high"
  },
  "risk_boundary": "不替代医疗/法律/投资建议",
  "commitment_ask": "你愿意先做哪一个？",
  "actions": [
    {"type": "start_task", "task_id": "uuid", "label": "开始行动"}
  ],
  "evidence": {
    "facts_hash": "sha256:...",
    "kb_refs": ["kb:doc:1:page:10:chunk:3"],
    "rule_ids": ["RULE-STRENGTH-SCORE-V1"]
  }
}
```

#### A2UI（前端渲染）

```json
{
  "meta": {"summary": "一句话摘要"},
  "ui_components": [
    {
      "type": "markdown_text",
      "title": "输出",
      "data": "### 结论\n...\n### 行动处方\n...\n### 承诺\n..."
    },
    {
      "type": "action_buttons",
      "title": "下一步",
      "data": [{"label": "开始行动", "action": {"type": "start_task", "task_id": "uuid"}}]
    }
  ]
}
```

### 5.4 整合原则

1. **Coach 优先**：永远以支持性、建设性语言输出
2. **行动收敛**：每次交互必须落到 commitment（4 类：start_task / schedule_task / ask_followup / opt_out）
3. **负面必有出口**：任何负面描述都必须紧接"你可以做什么"
4. **可追溯**：所有输出关联 `facts_hash + kb_refs + rule_ids`

---

## 6. 反依赖机制：心理学安全围栏

### 6.1 设计原理

任何心理干预系统都存在**依赖风险**——用户可能将系统作为"全能客体"（Omnipotent Object），逃避现实行动。

反依赖机制的心理学基础：
- **Winnicott 的过渡客体理论**：好的过渡客体最终应被放弃，用户发展出独立能力
- **依附理论的安全基地**：安全依附的目标是支持探索，而非永久庇护
- **自我决定理论**：过度外部控制会损害内在动机

### 6.2 触发规则

| 触发条件 | 系统响应 | 心理学原理 |
|----------|----------|------------|
| 连续 3 次问同一问题 | 强制给"现实行动实验"（5-15 分钟） | 打破反刍思维 |
| 当日咨询 > 5 次 | 提示"信息足够，先行动" + 最小任务 | 行动先于理解 |
| 轨道达标毕业 | 主动降频推送 + 强调自我掌控 | 逐步撤退支持 |
| 连续 7 天无行动 | 关心式询问 + 降低任务难度 | 维持联系但不施压 |

### 6.3 温和出口

所有反依赖干预都必须提供选项：
- "我愿意执行"
- "稍后再说"
- "不再提示"（opt_out）

**永远不强迫**——强迫本身就违反自主性原则。

---

## 7. 闭环设计：Commitment 心理学

### 7.1 为什么 Commitment 是闭环核心

心理学研究表明：
- **意向-行动鸿沟**（Intention-Action Gap）：人们经常"想做"但"不做"
- **承诺一致性**（Commitment-Consistency）：公开承诺显著提高行动概率
- **实施意图**（Implementation Intention）："如果-那么"计划提高执行率 2-3 倍

因此，每次交互的目标不是"给建议"，而是**获得承诺**。

### 7.2 Commitment 四类型

| 类型 | 定义 | 心理学功能 |
|------|------|------------|
| `start_task` | 立刻开始（≤5 分钟优先） | 利用当下动机，避免延迟衰减 |
| `schedule_task` | 加入今日/本周计划 | 形成实施意图 |
| `ask_followup` | 选择一个澄清问题继续 | 减少开放式追问，保持对话节奏 |
| `opt_out` | 暂停/关闭 | 尊重自主性，提供安全出口 |

### 7.3 数据追踪

```sql
-- 核心指标
SELECT
  COUNT(*) FILTER (WHERE accepted_at IS NOT NULL) AS commitments_made,
  COUNT(*) FILTER (WHERE status = 'done') AS actions_completed,
  ROUND(
    COUNT(*) FILTER (WHERE status = 'done')::NUMERIC /
    NULLIF(COUNT(*) FILTER (WHERE accepted_at IS NOT NULL), 0),
    2
  ) AS completion_rate
FROM fortune_commitment
WHERE user_id = :user_id
  AND created_at >= NOW() - INTERVAL '7 days';
```

---

## 8. 成长计划：行为科学落地

### 8.1 四个预设计划的心理学基础

| 计划 | 理论基础 | 核心机制 | 预期效果 |
|------|----------|----------|----------|
| 21天感恩练习 | 积极心理学 | 注意力重定向 + 关系强化 | 提升 P（积极情绪） |
| 7天正念入门 | 正念认知疗法 | 去中心化 + 情绪调节 | 降低反刍，提升觉察 |
| 30天习惯养成 | 行为科学/原子习惯 | 触发器 + 奖励 + 身份认同 | 建立自动化行为 |
| 14天优势发现 | VIA优势理论 | 识别 + 应用 + 反馈 | 提升 E（投入）和 A（成就） |

### 8.2 统一口径：30 天游程轨道

所有计划统一可视化为 30 天轨道（短计划重复或延续）：
- **进度条**：当前天 / 总天数
- **连击**：连续完成天数（streak）
- **里程碑**：7 天 / 14 天 / 21 天 / 毕业

### 8.3 计划与 Bento 的整合

"成长计划"卡片（Bento #4）功能：
- 显示当前进行中的计划
- 显示今日任务
- 一键打卡完成
- 查看轨道进度

---

## 9. 情绪打卡：即时适应性干预

### 9.1 JITAI 原理

Just-In-Time Adaptive Interventions（JITAI）是健康心理学的前沿范式：
- **即时**：在情绪峰值时介入
- **适应性**：根据当前状态调整干预
- **最小剂量**：5 分钟以内的微干预

### 9.2 打卡流程

```
1. 用户点击"情绪打卡"
2. 选择情绪标签（焦虑/低落/平静/兴奋/愤怒/困惑）
3. 滑动强度（0-10）
4. 可选：写一句话备注
5. 系统返回：
   - 归因假设（"这可能与...有关"）
   - 1 个调节动作（≤5 分钟）
   - 承诺邀请
```

### 9.3 调节动作库

| 情绪 | 强度 | 推荐动作 | 原理 |
|------|------|----------|------|
| 焦虑 | 7-10 | 3分钟呼吸降噪 | 激活副交感神经 |
| 焦虑 | 4-6 | 写下3个最坏情况 | 认知解离 |
| 低落 | 7-10 | 做一个最小行动（站起来倒杯水） | 行为激活 |
| 低落 | 4-6 | 回忆一个小成就 | 反刍打断 |
| 愤怒 | 7-10 | 用力握拳 10 秒再松开 | 生理释放 |
| 困惑 | 任意 | 写下 3 个选项和 1 个约束 | 结构化决策 |

---

## 10. 语言风格：表达层设计

### 10.1 三种人格风格

| 风格 | 特点 | 适用用户 | 示例 |
|------|------|----------|------|
| `standard` | 清晰、中性、专业 | 偏好理性分析 | "根据你的情况，建议..." |
| `warm` | 共情、支持性（默认） | 多数用户 | "听起来你现在感到...我理解这种感受" |
| `roast` | 轻毒舌但不羞辱 | 偏好直接反馈 | "你又在逃避了？来，先做这个再说" |

### 10.2 风格边界

**所有风格都必须遵守**：
- 禁止恐吓（"你会失败"）
- 禁止羞辱（"你太差了"）
- 禁止人格定性（"你就是懒"）
- 负面后必有出口（"但你可以..."）

`roast` 风格的"毒舌"仅限于：
- 指出逃避模式（"你又开始找借口了"）
- 挑战不合理信念（"你真的没时间，还是不想面对？"）
- 幽默化处理（"好吧，你的拖延症今天又赢了"）

---

## 11. 数据流与技术对齐

### 11.1 完整数据流

```
┌─────────────────┐
│   用户输入       │
└────────┬────────┘
         ▼
┌─────────────────────────────────────────────────────────────────┐
│                        API 层（FastAPI）                         │
│  1. 验证登录态                                                   │
│  2. 读取 L0（fortune_bazi_snapshot.facts）                       │
│  3. 读取 L1（fortune_user_preferences + 历史摘要）               │
│  4. 检索知识库（bazi_kb_chunk → kb_refs）                        │
│  5. 构建 GLM System Prompt + facts + evidence                    │
└────────┬────────────────────────────────────────────────────────┘
         ▼
┌─────────────────┐
│   GLM 调用       │ ← L2 + L3 整合
└────────┬────────┘
         ▼
┌─────────────────────────────────────────────────────────────────┐
│                        输出处理                                  │
│  1. 解析 A2UI JSON                                               │
│  2. 写入 fortune_conversation_message                            │
│  3. 写入 fortune_commitment（status=suggested）                  │
│  4. 返回前端渲染                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 11.2 与 MVP Schema 的映射

| OS 概念 | MVP 表 | 字段 |
|---------|--------|------|
| L0 Facts | `fortune_bazi_snapshot` | `facts`, `facts_hash` |
| L1 Schema | `fortune_user`, `fortune_user_preferences`, `fortune_checkin` | profile + preferences + mood history |
| L2 Evidence | `bazi_kb_chunk`, `fortune_rule` | `kb_refs`, `rule_ids` |
| L3 Output | `fortune_conversation_message`, `fortune_daily_guidance` | `a2ui`, `card` |
| Commitment | `fortune_commitment` | 全表 |
| Plan Progress | `fortune_plan_enrollment`, `fortune_plan_record` | 全表 |

---

## 12. 验收标准

### 12.1 心理学验收

| 维度 | 标准 | 验证方法 |
|------|------|----------|
| 安全性 | 无恐吓/羞辱/宿命论 | 输出审计 + 用户反馈 |
| 行动导向 | 每次输出都有 commitment_ask | A2UI 结构校验 |
| 反依赖 | 触发规则正常执行 | 日志 + 事件统计 |
| 可追溯 | 所有输出关联 evidence | facts_hash + kb_refs 校验 |

### 12.2 业务验收（WCG）

Weekly Closed-loop Guidance：用户在一周内完成 ≥1 次"触发 → 指引 → 行动 → 反馈"闭环。

```sql
-- WCG 计算
WITH weekly_loop AS (
  SELECT
    user_id,
    DATE_TRUNC('week', created_at) AS week,
    BOOL_OR(accepted_at IS NOT NULL) AS has_commitment,
    BOOL_OR(status = 'done') AS has_action
  FROM fortune_commitment
  GROUP BY user_id, DATE_TRUNC('week', created_at)
)
SELECT
  user_id,
  week,
  (has_commitment AND has_action) AS wcg_achieved
FROM weekly_loop;
```

---

## 13. 未来演进（Post-MVP）

### 13.1 多 Agent 并行（L2 扩展）

- 真正独立的 Agent 调用
- Agent 间辩论/综合机制
- 用户可配置"顾问委员会"

### 13.2 社交层（Relationship OS）

- 关系数字孪生
- 合盘分析
- 群体能量机制

### 13.3 身体层（Somatic Integration）

- 可穿戴设备数据接入
- 生物节律优化
- 睡眠/运动联动

### 13.4 自适应个性化（L1 进化）

- 用户特异的 Schema 学习
- 认知图式自动检测与重构
- 长期效果追踪与算法优化

---

## 附录 A：GLM System Prompt 完整版

```text
你是 Fortune AI 的对话 Agent，角色是积极心理学教练（Performance Coach）。

【产品定位】
人生导航 / 陪伴 / 提升。系统和交互保持"有效而极简"。

【四层架构理解】
- L0（定数）：用户的八字事实，作为先验约束，不做宿命论解读
- L1（特质）：用户的心理图式和当前状态，作为个性化调节
- L2（策略）：知识库和规则，作为专业依据
- L3（意识）：你的输出，作为整合与行动引导

【你的优先级（不可逆）】
Coach > Teaching Assistant > Customer Support > Sales

【硬性规则（必须遵守）】
1) 禁止恐吓、羞辱、宿命论断言；负面信息必须紧接"你可以做什么"的行动处方。
2) 禁止自行计算八字事实；只能基于提供的 facts + evidence 输出。
3) 每次输出必须包含：结论(conclusion) + 依据(why) + ≤3条处方(prescriptions) + 承诺邀请(commitment_ask)。
4) 时间窗口默认只给干预窗口（intervention）；forecast 只能条件句+低置信度。
5) 输出必须是 A2UI JSON，且第一组件必须是 markdown_text。
6) 必须给出可点击 actions（start_task / schedule_task / open_panel / opt_out）。

【语言风格 persona_style】
standard：清晰、中性、专业
warm：共情、支持性（默认）
roast：轻毒舌但不羞辱、不对人格做负面定性

【输入】
- persona_style 取值：standard / warm / roast
- user_context：用户基础信息与偏好
- facts：L0 八字确定性事实 + L1 计划进度 + 历史反馈
- evidence：rule_ids + kb_refs + facts_hash
- user_message：用户本轮输入

【输出（A2UI JSON）】
- meta.summary：一句话摘要
- ui_components[0]：markdown_text（必须，包含：结论要点/依据/处方/时间窗口/边界/承诺邀请）
- ui_components[1]：action_buttons（必须，包含：开始行动/加入计划/查看Bento等按钮）
```

---

## 附录 B：参考文献

1. Jung, C.G. (1959). *Aion: Researches into the Phenomenology of the Self*. Collected Works, Vol. 9ii.
2. Seligman, M.E.P. (2011). *Flourish: A Visionary New Understanding of Happiness and Well-being*.
3. Fogg, B.J. (2020). *Tiny Habits: The Small Changes That Change Everything*.
4. Clear, J. (2018). *Atomic Habits: An Easy & Proven Way to Build Good Habits & Break Bad Ones*.
5. Ryan, R.M. & Deci, E.L. (2017). *Self-Determination Theory: Basic Psychological Needs in Motivation, Development, and Wellness*.
6. Nahum-Shani, I. et al. (2018). Just-in-Time Adaptive Interventions (JITAIs) in Mobile Health. *Annals of Behavioral Medicine*.
7. Beck, A.T. (1979). *Cognitive Therapy and the Emotional Disorders*.
8. Winnicott, D.W. (1971). *Playing and Reality*.

---

*本文档由 Claude Opus 4.5 基于深度心理学原理设计，与 Fortune AI Final MVP 技术架构完全对齐。*
