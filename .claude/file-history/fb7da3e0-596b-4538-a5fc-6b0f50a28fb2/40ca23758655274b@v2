/**
 * ProtocolCompletionCard - Protocol å®Œæˆå¡ç‰‡
 *
 * å±•ç¤º Protocol å®ŒæˆçŠ¶æ€å’Œæ€»ç»“ï¼ˆåµŒå…¥å¯¹è¯æµï¼‰
 * card_type: "protocol_completion"
 */

"use client";

import { motion } from "framer-motion";
import { registerCard } from "@/skills/CardRegistry";

interface ProtocolCompletionData {
  protocol_name: string;
  completed_steps: number;
  total_steps: number;
  summary: string;
  next_actions?: string[];
  generated_at?: string;
}

interface ProtocolCompletionCardProps {
  data: ProtocolCompletionData;
}

function ProtocolCompletionCard({ data }: ProtocolCompletionCardProps) {
  const { protocol_name, completed_steps, total_steps, summary, next_actions } =
    data;

  return (
    <motion.div
      initial={{ opacity: 0, scale: 0.95 }}
      animate={{ opacity: 1, scale: 1 }}
      className="protocol-completion-card my-4 p-6 rounded-2xl bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200/50"
    >
      {/* å®Œæˆå›¾æ ‡ */}
      <div className="flex items-center gap-3 mb-4">
        <div className="flex-shrink-0 w-12 h-12 rounded-full bg-green-500 text-white flex items-center justify-center">
          <svg
            className="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth={2}
              d="M5 13l4 4L19 7"
            />
          </svg>
        </div>
        <div>
          <h3 className="text-xl font-bold text-gray-800">åè®®å®Œæˆ</h3>
          <p className="text-sm text-gray-600">{protocol_name}</p>
        </div>
      </div>

      {/* è¿›åº¦æ€»ç»“ */}
      <div className="mb-4 p-3 bg-white/60 rounded-lg">
        <div className="flex justify-between items-center mb-2">
          <span className="text-sm font-medium text-gray-700">å®Œæˆè¿›åº¦</span>
          <span className="text-sm font-semibold text-green-600">
            {completed_steps}/{total_steps} æ­¥éª¤
          </span>
        </div>
        <div className="w-full bg-gray-200 rounded-full h-2">
          <div
            className="bg-gradient-to-r from-green-400 to-emerald-500 h-2 rounded-full transition-all duration-500"
            style={{
              width: `${(completed_steps / total_steps) * 100}%`,
            }}
          />
        </div>
      </div>

      {/* æ€»ç»“å†…å®¹ */}
      <div className="mb-4">
        <h4 className="text-sm font-semibold text-gray-700 mb-2">ğŸ“ æ€»ç»“</h4>
        <p className="text-gray-700 leading-relaxed whitespace-pre-wrap">
          {summary}
        </p>
      </div>

      {/* ä¸‹ä¸€æ­¥è¡ŒåŠ¨ */}
      {next_actions && next_actions.length > 0 && (
        <div className="mt-4 p-4 bg-white/60 rounded-lg">
          <h4 className="text-sm font-semibold text-gray-700 mb-2">
            ğŸ¯ å»ºè®®ä¸‹ä¸€æ­¥
          </h4>
          <ul className="space-y-2">
            {next_actions.map((action, index) => (
              <li key={index} className="flex items-start gap-2 text-sm">
                <span className="text-green-500 mt-0.5">â€¢</span>
                <span className="text-gray-700">{action}</span>
              </li>
            ))}
          </ul>
        </div>
      )}
    </motion.div>
  );
}

registerCard("protocol_completion", ProtocolCompletionCard);

export default ProtocolCompletionCard;
