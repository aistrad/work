/**
 * BaziDailyFortuneCard - ä»Šæ—¥è¿åŠ¿å¡ç‰‡
 *
 * ä» show-daily-fortune.tsx æå–çš„çº¯æ¸²æŸ“ç»„ä»¶
 * é€šè¿‡ CardRegistry æ³¨å†Œï¼Œç”± card_type: "bazi_daily_fortune" è§¦å‘
 */

"use client";

import { registerCard } from "@/skills/CardRegistry";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Types
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface Interaction {
  type: string;
  description: string;
}

interface Advice {
  do: string[];
  avoid: string[];
}

interface BaziDailyFortuneData {
  date?: string;
  dayPillar?: string;
  day_pillar?: string;
  dayMaster?: string;
  day_master?: string;
  interactions?: Interaction[];
  luckyElements?: string[];
  lucky_elements?: string[];
  advice?: Advice;
  overallScore?: number;
  overall_score?: number;
  summary?: string;
}

interface BaziDailyFortuneCardProps {
  data: BaziDailyFortuneData;
  cardProps?: Record<string, unknown>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Component
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function BaziDailyFortuneCard({ data }: BaziDailyFortuneCardProps) {
  // å…¼å®¹ snake_case å’Œ camelCase
  const date = data.date || "";
  const dayPillar = data.dayPillar || data.day_pillar || "";
  const interactions = data.interactions || [];
  const luckyElements = data.luckyElements || data.lucky_elements || [];
  const advice = data.advice || { do: [], avoid: [] };
  const overallScore = data.overallScore || data.overall_score || 5;
  const summary = data.summary || "";

  const scoreColor = overallScore >= 7 ? "text-green-500" : overallScore >= 4 ? "text-yellow-500" : "text-red-500";
  const scoreBg = overallScore >= 7 ? "bg-green-500" : overallScore >= 4 ? "bg-yellow-500" : "bg-red-500";

  return (
    <div className="daily-fortune-card bg-gradient-to-br from-amber-50 to-orange-50 dark:from-amber-950/30 dark:to-orange-950/30 rounded-2xl border border-amber-200 dark:border-amber-800 p-5 my-2 fade-in shadow-[var(--shadow-card)]">
      {/* Header */}
      <div className="flex items-center justify-between mb-4">
        <div>
          <div className="text-sm text-muted-foreground">{date}</div>
          <div className="font-medium flex items-center gap-2">
            <span>ğŸ›ï¸</span>
            <span>æ—¥æŸ± {dayPillar}</span>
          </div>
        </div>
        <div className="text-center">
          <div className={`text-3xl font-bold ${scoreColor}`}>{overallScore}</div>
          <div className="text-xs text-muted-foreground">è¿åŠ¿æŒ‡æ•°</div>
        </div>
      </div>

      {/* Score Bar */}
      <div className="h-2 bg-gray-200 dark:bg-gray-700 rounded-full mb-4 overflow-hidden">
        <div
          className={`h-full ${scoreBg} transition-all duration-500`}
          style={{ width: `${overallScore * 10}%` }}
        />
      </div>

      {/* Interactions */}
      {interactions.length > 0 && (
        <div className="mb-4">
          <div className="text-sm font-medium mb-2">ä»Šæ—¥ä¸å‘½ç›˜ä½œç”¨</div>
          <div className="space-y-1">
            {interactions.map((item, i) => (
              <div key={i} className="flex items-center gap-2 text-sm">
                <span className="px-2 py-0.5 bg-amber-200 dark:bg-amber-800 rounded text-xs">{item.type}</span>
                <span>{item.description}</span>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Lucky Elements */}
      {luckyElements.length > 0 && (
        <div className="mb-4">
          <div className="text-sm font-medium mb-2">ä»Šæ—¥å‰åˆ©äº”è¡Œ</div>
          <div className="flex gap-2">
            {luckyElements.map((el, i) => (
              <span key={i} className="px-3 py-1 bg-green-100 dark:bg-green-900 rounded-full text-sm">
                {el}
              </span>
            ))}
          </div>
        </div>
      )}

      {/* Advice */}
      {(advice.do.length > 0 || advice.avoid.length > 0) && (
        <div className="grid grid-cols-2 gap-4 mb-4">
          {advice.do.length > 0 && (
            <div>
              <div className="text-sm font-medium text-green-600 mb-1">å®œ</div>
              <ul className="text-sm space-y-1">
                {advice.do.map((item, i) => (
                  <li key={i} className="flex items-center gap-1">
                    <span className="text-green-500">âœ“</span> {item}
                  </li>
                ))}
              </ul>
            </div>
          )}
          {advice.avoid.length > 0 && (
            <div>
              <div className="text-sm font-medium text-red-600 mb-1">å¿Œ</div>
              <ul className="text-sm space-y-1">
                {advice.avoid.map((item, i) => (
                  <li key={i} className="flex items-center gap-1">
                    <span className="text-red-500">âœ—</span> {item}
                  </li>
                ))}
              </ul>
            </div>
          )}
        </div>
      )}

      {/* Summary */}
      {summary && (
        <div className="text-sm text-muted-foreground border-t border-amber-200 dark:border-amber-800 pt-3">
          {summary}
        </div>
      )}
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Register to CardRegistry
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

registerCard("bazi_daily_fortune", BaziDailyFortuneCard);

export default BaziDailyFortuneCard;
