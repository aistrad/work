/**
 * CardWrapper - Skill 卡片统一包装组件
 *
 * 提供统一的视觉样式：
 * - 圆角: rounded-2xl
 * - Padding: p-5 (md)
 * - 阴影: shadow-[var(--shadow-card)]
 * - 边框: border
 * - 暗黑模式: 自动支持
 *
 * 配色方案:
 * | Skill     | Variant | Light                  | Dark                   |
 * |-----------|---------|------------------------|------------------------|
 * | Bazi      | amber   | amber-50/orange-50     | amber-950/30           |
 * | Zodiac    | orange  | orange-50/amber-50     | orange-950/30          |
 * | Synastry  | pink    | pink-50/purple-50      | pink-950/30            |
 * | LifeCoach | cyan    | cyan-50/blue-50        | cyan-950/30            |
 * | Psych     | purple  | purple-50/indigo-50    | purple-950/30          |
 * | Career    | blue    | blue-50/cyan-50        | blue-950/30            |
 * | 通用      | neutral | bg-card                | bg-card                |
 */

import React from 'react';
import { motion, type HTMLMotionProps } from 'framer-motion';

// ═══════════════════════════════════════════════════════════════════════════
// Types
// ═══════════════════════════════════════════════════════════════════════════

export type CardVariant =
  | 'default'
  | 'amber'    // Bazi
  | 'orange'   // Zodiac
  | 'pink'     // Synastry
  | 'cyan'     // LifeCoach
  | 'purple'   // Psych
  | 'blue'     // Career
  | 'neutral';

export type CardPadding = 'none' | 'sm' | 'md' | 'lg';

export interface CardWrapperProps {
  children: React.ReactNode;
  /** 配色变体，对应不同 Skill */
  variant?: CardVariant;
  /** 内边距大小 */
  padding?: CardPadding;
  /** 是否启用入场动画 */
  animate?: boolean;
  /** 额外的 className */
  className?: string;
  /** 是否显示边框 */
  border?: boolean;
  /** 是否显示阴影 */
  shadow?: boolean;
  /** 是否启用 hover 效果 */
  hover?: boolean;
  /** 动画延迟 (ms) */
  animationDelay?: number;
  /** 点击事件 */
  onClick?: () => void;
  /** 其他 HTML 属性 */
  style?: React.CSSProperties;
}

// ═══════════════════════════════════════════════════════════════════════════
// Constants
// ═══════════════════════════════════════════════════════════════════════════

const VARIANT_STYLES: Record<CardVariant, string> = {
  default: 'bg-gradient-to-br from-orange-50/80 to-amber-50/60 dark:from-orange-950/20 dark:to-amber-950/20 border-orange-100 dark:border-orange-900/50',
  amber: 'bg-gradient-to-br from-amber-50 to-orange-50 dark:from-amber-950/30 dark:to-orange-950/30 border-amber-200 dark:border-amber-800',
  orange: 'bg-gradient-to-br from-orange-50 to-amber-50 dark:from-orange-950/30 dark:to-amber-950/30 border-orange-200 dark:border-orange-800',
  pink: 'bg-gradient-to-br from-pink-50 to-purple-50 dark:from-pink-950/30 dark:to-purple-950/30 border-pink-200 dark:border-pink-800',
  cyan: 'bg-gradient-to-br from-cyan-50 to-blue-50 dark:from-cyan-950/30 dark:to-blue-950/30 border-cyan-200 dark:border-cyan-800',
  purple: 'bg-gradient-to-br from-purple-50 to-indigo-50 dark:from-purple-950/30 dark:to-indigo-950/30 border-purple-200 dark:border-purple-800',
  blue: 'bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/30 dark:to-cyan-950/30 border-blue-200 dark:border-blue-800',
  neutral: 'bg-[var(--bg-card)] border-[var(--border-default)]',
};

const PADDING_STYLES: Record<CardPadding, string> = {
  none: '',
  sm: 'p-3',
  md: 'p-5',
  lg: 'p-6',
};

// ═══════════════════════════════════════════════════════════════════════════
// Component
// ═══════════════════════════════════════════════════════════════════════════

export function CardWrapper({
  children,
  variant = 'default',
  padding = 'md',
  animate = true,
  className = '',
  border = true,
  shadow = true,
  hover = false,
  animationDelay = 0,
  onClick,
  style,
}: CardWrapperProps) {
  const baseClasses = [
    'rounded-2xl',
    'overflow-hidden',
    'w-full',
    VARIANT_STYLES[variant],
    PADDING_STYLES[padding],
    border && 'border',
    shadow && 'shadow-[var(--shadow-card)]',
    hover && 'transition-shadow duration-200 hover:shadow-[var(--shadow-card-hover)]',
    onClick && 'cursor-pointer',
  ]
    .filter(Boolean)
    .join(' ');

  const motionProps: HTMLMotionProps<'div'> = animate
    ? {
        initial: { opacity: 0, y: 20 },
        animate: { opacity: 1, y: 0 },
        transition: {
          duration: 0.4,
          delay: animationDelay / 1000,
          ease: [0.16, 1, 0.3, 1], // ease-out-expo
        },
      }
    : {};

  return (
    <motion.div
      className={`${baseClasses} ${className}`}
      onClick={onClick}
      style={style}
      {...motionProps}
    >
      {children}
    </motion.div>
  );
}

// ═══════════════════════════════════════════════════════════════════════════
// Static Variant (No Animation)
// ═══════════════════════════════════════════════════════════════════════════

/**
 * 静态版本，不使用 framer-motion，适合服务端渲染或性能敏感场景
 */
export function CardWrapperStatic({
  children,
  variant = 'default',
  padding = 'md',
  className = '',
  border = true,
  shadow = true,
  hover = false,
  onClick,
  style,
}: Omit<CardWrapperProps, 'animate' | 'animationDelay'>) {
  const baseClasses = [
    'rounded-2xl',
    'overflow-hidden',
    'w-full',
    VARIANT_STYLES[variant],
    PADDING_STYLES[padding],
    border && 'border',
    shadow && 'shadow-[var(--shadow-card)]',
    hover && 'transition-shadow duration-200 hover:shadow-[var(--shadow-card-hover)]',
    onClick && 'cursor-pointer',
  ]
    .filter(Boolean)
    .join(' ');

  return (
    <div
      className={`${baseClasses} ${className}`}
      onClick={onClick}
      style={style}
    >
      {children}
    </div>
  );
}

// ═══════════════════════════════════════════════════════════════════════════
// Utility: Get Variant by Skill ID
// ═══════════════════════════════════════════════════════════════════════════

/**
 * 根据 Skill ID 获取对应的配色变体
 */
export function getVariantBySkillId(skillId: string): CardVariant {
  const skillVariantMap: Record<string, CardVariant> = {
    bazi: 'amber',
    zodiac: 'orange',
    synastry: 'pink',
    lifecoach: 'cyan',
    psych: 'purple',
    career: 'blue',
    tarot: 'purple',
    jungastro: 'purple',
    mindfulness: 'cyan',
  };

  return skillVariantMap[skillId.toLowerCase()] || 'default';
}

export default CardWrapper;
