# VibeLife V8 å‰ç«¯æ¶æ„è®¾è®¡æ–¹æ¡ˆ

> **è®¾è®¡å“²å­¦**ï¼šæµåŠ¨ (Fluid)ã€å“åº” (Reactive)ã€AI åŸç”Ÿ (AI-Native)
>
> æˆ‘ä»¬ä¸åªæ˜¯æ„å»ºé¡µé¢ï¼Œè€Œæ˜¯åœ¨ç¼–æ’ **æ™ºèƒ½çš„æµåŠ¨**ã€‚

---

## 1. æ¶æ„å…¨æ™¯ (Architecture Panorama)

ä»ä¼ ç»Ÿçš„"å±‚çº§å †å "è½¬å‘"æ•°æ®æµåŠ¨çš„ç®¡é“"ã€‚æ•°æ®ä» API æ¶Œå…¥ï¼Œç»è¿‡ Core çš„å¤„ç†ï¼Œæ³¨å…¥ State å®¹å™¨ï¼Œæœ€ç»ˆç”± Shell å‘ˆç°ç»™ Experience å±‚ã€‚

```mermaid
graph TD
    %% Styling
    classDef experience fill:#e1f5fe,stroke:#01579b,stroke-width:2px;
    classDef shell fill:#f3e5f5,stroke:#4a148c,stroke-width:2px;
    classDef core fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px;
    classDef state fill:#fff3e0,stroke:#e65100,stroke-width:2px;
    classDef api fill:#eceff1,stroke:#37474f,stroke-width:1px,stroke-dasharray: 5 5;
    classDef proactive fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,stroke-dasharray: 5 5;

    subgraph Experience ["âœ¨ Experience Layer (ç”¨æˆ·è§¦ç‚¹)"]
        direction LR
        Onboard(ğŸš€ æ–°æ‰‹å¼•å¯¼)
        Chat(ğŸ’¬ å¯¹è¯ç©ºé—´)
        Market(ğŸ¯ æŠ€èƒ½å¸‚åœº)
        Prism(ğŸ’ èº«ä»½æ£±é•œ)
        Settings(âš™ï¸ è®¾ç½®ä¸­å¿ƒ)
    end

    subgraph Shell ["ğŸ–¼ï¸ Shell Layer (å…¨æ¯å®¹å™¨)"]
        UnifiedShell[ğŸ“± ç»Ÿä¸€ Shell å®¹å™¨]
        NavRail[ğŸ“ å¯¼èˆªè½¨]
        SidePanel[ğŸ§© ä¸Šä¸‹æ–‡ä¾§è¾¹æ ]
        ProactiveFloat((ğŸ”” ä¸»åŠ¨å±‚))

        UnifiedShell --> NavRail
        UnifiedShell --> SidePanel
        ProactiveFloat -.-> UnifiedShell
    end

    subgraph Core ["ğŸ§  Core Layer (æ™ºèƒ½å†…æ ¸)"]
        ChatCore[[ğŸ¤– ChatCore<br/>AI SDK æµå¼å“åº”]]
        SkillCore[[ğŸ“¦ SkillCore<br/>Skill æ³¨å†Œè¡¨]]
        CardCore[[ğŸƒ CardCore<br/>ShowCard æ¸²æŸ“]]
        ProactiveEngine[[âš¡ ProactiveCore<br/>æ¨é€å¼•æ“]]
    end

    subgraph State ["ğŸ’¾ State Layer (çŠ¶æ€ç”Ÿæ€)"]
        AuthContext[(ğŸ” è®¤è¯)]
        SkillContext[(ğŸ¯ æŠ€èƒ½)]
        UserContext[(ğŸ‘¤ ç”¨æˆ·)]
        PushContext[(ğŸ“« é€šçŸ¥)]
    end

    subgraph API ["â˜ï¸ API Layer (åç«¯æºå¤´)"]
        APIs[REST / SSE / WebSocket]
    end

    %% Flows
    Experience --> UnifiedShell
    UnifiedShell --> ChatCore
    UnifiedShell --> SkillCore

    ChatCore --> CardCore
    ProactiveEngine -.-> ProactiveFloat

    ChatCore ==> SkillContext
    SkillCore ==> SkillContext
    ProactiveEngine ==> PushContext

    AuthContext -.-> APIs
    UserContext -.-> APIs

    %% Apply Classes
    class Onboard,Chat,Market,Prism,Settings experience;
    class UnifiedShell,NavRail,SidePanel shell;
    class ProactiveFloat proactive;
    class ChatCore,SkillCore,CardCore,ProactiveEngine core;
    class AuthContext,SkillContext,UserContext,PushContext state;
    class APIs api;
```

**ASCII å¤‡ç”¨è§†å›¾**ï¼š
```
                                     .-------------------.
                                     |    Experience     |
                                     |  [Chat] [Market]  |
                                     '--------+----------'
                                              |
    . - - - - - - - - - - - - - .             v
    |       Proactive Layer     |    .-------------------.
    |     (Floating Overlay)    | ~> |       Shell       |
    ' - - - - - - - - - - - - - '    | [Nav] [Main] [Side]|
                                     '--------+----------'
                                              |
                                              v
                                     .-------------------.
                                     |       Core        |
                                     | [Chat] [Skill] [Card]|
                                     '--------+----------'
                                              |
                                              v
                                     .-------------------.
                                     |       State       |
                                     |  (Auth) (User)    |
                                     '--------+----------'
                                              :
                                              v
                                       (  API Cloud  )
```

---

## 2. ä¸‰å¤§ä½“éªŒæ”¯æŸ±

VibeLife çš„ä¸‰å¤§å·®å¼‚åŒ–èƒ½åŠ›ï¼Œåœ¨å‰ç«¯å¦‚ä½•ä½“ç°ï¼š

| åç«¯èƒ½åŠ› | å‰ç«¯ä½“éªŒ | è®¾è®¡è¦ç‚¹ | è§†è§‰æ„å›¾ |
|----------|----------|----------|----------|
| **Deep Understanding** | Identity Prism | ç”¨æˆ·ç”»åƒå¯è§†åŒ–ã€æ´å¯Ÿå¡ç‰‡ã€è®°å¿†æ—¶é—´çº¿ | å·¦ä¾§å¯¹è¯ï¼Œå³ä¾§å®æ—¶æ›´æ–°ç”»åƒ |
| **Proactive Agency** | Proactive Layer | ä¸»åŠ¨æ¨é€æµ®å±‚ã€é€šçŸ¥ä¸­å¿ƒã€æ™ºèƒ½æé†’ | æµ®å±‚è¦†ç›–ï¼Œä¸»åŠ¨è§¦è¾¾ç”¨æˆ· |
| **Infinite Extensibility** | Skill Market | Skill å‘ç°ã€è®¢é˜…ã€ç®¡ç†ã€åˆ‡æ¢åŠ¨æ•ˆ | å·¦ä¾§æµè§ˆï¼Œå³ä¾§å±•ç¤ºè¯¦æƒ… |

---

## 3. AI åŸç”Ÿäº¤äº’é—­ç¯ (Vibe Loop)

ä¼ ç»Ÿ App æ˜¯çº¿æ€§çš„æ­»èƒ¡åŒï¼ŒAI åŸç”Ÿåº”ç”¨æ˜¯æ— é™çš„èºæ—‹ä¸Šå‡ã€‚

```mermaid
sequenceDiagram
    autonumber
    actor User as ğŸ‘¤ ç”¨æˆ·
    participant Vibe as âœ¨ Vibe å¼•æ“
    participant Tools as ğŸ› ï¸ èƒ½åŠ›å·¥å…·
    participant UI as ğŸƒ è‡ªé€‚åº” UI

    User->>Vibe: ğŸ—£ï¸ è¡¨è¾¾æ„å›¾ (Intent)
    activate Vibe
    note right of User: "æˆ‘æƒ³äº†è§£ä¸‹å‘¨è¿åŠ¿..."

    Vibe->>Vibe: ğŸ§  æ„å›¾ç†è§£ & Skill è·¯ç”±
    Vibe->>Tools: ğŸ”§ è°ƒç”¨ Tool (æ˜Ÿç›˜/å…«å­—)
    Tools-->>Vibe: ğŸ“Š è¿”å›ç»“æ„åŒ–æ•°æ®

    Vibe->>UI: ğŸ¨ æŒ‡ä»¤: æ¸²æŸ“ ShowCard
    activate UI
    UI-->>User: ğŸ–¼ï¸ å±•ç¤º: è¿åŠ¿è¶‹åŠ¿å›¾
    deactivate UI

    Vibe--)User: ğŸ’¡ ä¸»åŠ¨å»ºè®® (Proactive)
    note left of Vibe: "æ£€æµ‹åˆ°æ°´é€†ï¼Œæ˜¯å¦æŸ¥çœ‹é¿å‘æŒ‡å—?"
    deactivate Vibe

    User->>Vibe: ğŸ—£ï¸ åç»­è¿½é—® (Follow-up)
    note right of User: å½¢æˆæŒç»­å¯¹è¯é—­ç¯
```

**æ ¸å¿ƒç†å¿µ**ï¼š
```
ä¼ ç»Ÿ App:  ç”¨æˆ·æ“ä½œ â†’ ç•Œé¢å“åº” â†’ å±•ç¤ºç»“æœ (ç»ˆç‚¹)
AI åŸç”Ÿ:   ç”¨æˆ·æ„å›¾ â†’ AI ç†è§£ â†’ å·¥å…·è°ƒç”¨ â†’ å¡ç‰‡æ¸²æŸ“ â†’ æŒç»­å¯¹è¯
                         â†‘                              â†“
                         â””â”€â”€â”€â”€ ä¸»åŠ¨è§¦è¾¾ (Proactive) â”€â”€â”€â”€â”˜
```

---

## 4. å…¨æ¯ Shell (Holographic Shell)

`UnifiedShell` æ˜¯ä¸€ä¸ªæ™ºèƒ½çš„å“åº”å¼å®¹å™¨ï¼Œå®ƒæ ¹æ®è®¾å¤‡å°ºå¯¸å’Œä¸Šä¸‹æ–‡è‡ªåŠ¨å½¢å˜ã€‚**æ›¿ä»£ç°æœ‰çš„ AppShellã€PCLayout ç­‰å¤šå¥—å¸ƒå±€**ã€‚

### 4.1 ç»„ä»¶è§£å‰–

```mermaid
classDiagram
    class UnifiedShell {
        +DeviceType device
        +LayoutMode mode
        +render() ReactNode
    }

    class Navigation {
        <<å¯¼èˆªç»„ä»¶>>
        +PCç«¯: NavRail (å·¦ä¾§ 64px)
        +ç§»åŠ¨ç«¯: BottomBar (åº•éƒ¨)
    }

    class MainStage {
        <<æ ¸å¿ƒåŒºåŸŸ>>
        +å†…å®¹åŒº (flex-1)
        +åŠ¨æ€é¢åŒ…å±‘
    }

    class ContextPanel {
        <<æ™ºèƒ½é­”é•œ>>
        +PCç«¯: å³ä¾§ SidePanel (320-480px)
        +ç§»åŠ¨ç«¯: æŠ½å±‰ / æµ®å±‚
        +å†…å®¹: æ ¹æ®ä¸»èˆå°åŠ¨æ€å˜åŒ–
    }

    class ProactiveOverlay {
        <<æ‚¬æµ®å±‚>>
        +Toast æé†’
        +æ‚¬æµ®å¡ç‰‡
        +æ¨¡æ€æ¡†
        +Z-Index: æœ€é«˜å±‚çº§
    }

    UnifiedShell *-- Navigation
    UnifiedShell *-- MainStage
    UnifiedShell *-- ContextPanel
    UnifiedShell *-- ProactiveOverlay
```

### 4.2 å“åº”å¼å¸ƒå±€

**PC å¸ƒå±€ (â‰¥1024px)**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚NavRail â”‚         MainContent             â”‚    SidePanel       â”‚
â”‚ (64px) â”‚      (flex-1, å·¦å¯¹é½)           â”‚   (320-480px)      â”‚
â”‚        â”‚                                  â”‚   å¯æŠ˜å /æ‹–æ‹½      â”‚
â”‚  ğŸ     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                    â”‚
â”‚  ğŸ’¬    â”‚  â”‚     Page Content        â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  ğŸ¯    â”‚  â”‚                         â”‚    â”‚  â”‚ Context Card â”‚  â”‚
â”‚  ğŸ‘¤    â”‚  â”‚                         â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚        â”‚                                  â”‚  â”‚ Quick Action â”‚  â”‚
â”‚        â”‚                                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†‘
            ProactiveLayer (æµ®å±‚ï¼Œè¦†ç›–åœ¨ä¸Šæ–¹)
```

**Mobile å¸ƒå±€ (<1024px)**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header (Skill åˆ‡æ¢ + é€šçŸ¥é“ƒé“›)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚           MainContent                    â”‚
â”‚        (å…¨å±ï¼Œæ ¹æ® Tab åˆ‡æ¢)              â”‚
â”‚                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ  Home â”‚ ğŸ’¬ Chat â”‚ ğŸ¯ Skills â”‚ ğŸ‘¤ Me  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 æ™ºèƒ½ä¾§è¾¹æ ç­–ç•¥ (Smart SidePanel)

SidePanel ä¸æ˜¯é™æ€çš„ï¼Œå®ƒæ˜¯ä¸€é¢"**é­”é•œ**"ï¼Œæ ¹æ®å½“å‰çš„ä¸»èˆå°å†…å®¹åå°„å‡ºè¾…åŠ©ä¿¡æ¯ã€‚

| ä¸»èˆå° (Main Stage) | ä¾§è¾¹é­”é•œ (Side Panel) | è§†è§‰æ„å›¾ |
|---------------------|----------------------|----------|
| ğŸ’¬ **Chat (å¯¹è¯)** | VibeID é¢„è§ˆ + ä»Šæ—¥ Vibe + å¿«æ·æ“ä½œ | ä½“ç°"æ·±åº¦ç†è§£" |
| ğŸ¯ **Market (å¸‚åœº)** | Skill è¯¦æƒ… + åŠŸèƒ½åˆ—è¡¨ + ç›¸å…³æ¨è | å‡å°‘é¡µé¢è·³è½¬ |
| ğŸ’ **Identity (èº«ä»½)** | ç»´åº¦æ·±é’» + å†å²è¶‹åŠ¿ | å·¦ä¾§å…¨è§ˆï¼Œå³ä¾§é’»å– |
| âš™ï¸ **Settings (è®¾ç½®)** | è®¾ç½®èœå•å¯¼èˆª | å¿«é€Ÿå®šä½ |

---

## 5. å¡ç‰‡æ¸²æŸ“é€»è¾‘ (Card Rendering)

`CardCore` æ˜¯å‰ç«¯çš„"**è§†è§‰ç¿»è¯‘å®˜**"ã€‚å®ƒè´Ÿè´£å°†æ¯ç‡¥çš„ JSON æ•°æ®ç¿»è¯‘æˆç”ŸåŠ¨çš„ UI å¡ç‰‡ã€‚é‡‡ç”¨ **"æ¸è¿›å¼é™çº§" (Progressive Fallback)** ç­–ç•¥ã€‚

```mermaid
flowchart TD
    Input[ğŸ“¥ Tool è°ƒç”¨ç»“æœ] --> Identify{ğŸ†” å¡ç‰‡ç±»å‹?}

    Identify -- "å·²çŸ¥ç±»å‹ (å¦‚ bazi_chart)" --> CustomComponent[âœ¨ æ¸²æŸ“ä¸“ç”¨ç»„ä»¶]

    Identify -- "æœªçŸ¥ç±»å‹" --> CheckFallback{ğŸ”™ æœ‰é™çº§æç¤º?}

    CheckFallback -- "æœ‰ (å¦‚ list)" --> RenderPattern[ğŸ“ æ¸²æŸ“é€šç”¨æ¨¡å¼]

    CheckFallback -- "æ— " --> AnalyzeData{ğŸ” åˆ†ææ•°æ®ç»“æ„}

    AnalyzeData -- "æ•°ç»„ Array" --> RenderList[ğŸ“‹ æ¸²æŸ“æ™ºèƒ½åˆ—è¡¨]
    AnalyzeData -- "é”®å€¼å¯¹ Object" --> RenderDesc[ğŸ“ æ¸²æŸ“æè¿°åˆ—è¡¨]
    AnalyzeData -- "Markdown æ–‡æœ¬" --> RenderText[ğŸ“„ æ¸²æŸ“æ–‡æœ¬]

    subgraph Patterns [é€šç”¨æ¨¡å¼åº“]
        RenderList
        RenderDesc
        RenderText
    end

    CustomComponent --> FinalUI[ğŸ¨ æœ€ç»ˆ UI å¡ç‰‡]
    RenderPattern --> FinalUI
    Patterns --> FinalUI

    style CustomComponent fill:#c8e6c9,stroke:#2e7d32
    style RenderPattern fill:#fff9c4,stroke:#fbc02d
    style AnalyzeData fill:#ffccbc,stroke:#d84315
```

**é€šç”¨è§†å›¾ç±»å‹**ï¼š
```
list | tree | table | timeline | form | select
chart | progress | counter | modal | toast | custom
```

---

## 6. çŠ¶æ€ç”Ÿæ€ (State Ecosystem)

çŠ¶æ€ä¸å†æ˜¯é›¶æ•£çš„å˜é‡ï¼Œè€Œæ˜¯å±‚å±‚åŒ…è£¹çš„ç”Ÿæ€åœˆã€‚

```tsx
// âš›ï¸ VibeLife App çš„åŸå­ç»“æ„
<AppProviders>
  {/* 1. èº«ä»½å±‚ï¼šä½ æ˜¯è°ï¼Ÿ */}
  <AuthProvider>
    <UserProvider>

      {/* 2. èƒ½åŠ›å±‚ï¼šä½ èƒ½åšä»€ä¹ˆï¼Ÿ */}
      <SkillProvider>

        {/* 3. äº’åŠ¨å±‚ï¼šæ­£åœ¨å‘ç”Ÿä»€ä¹ˆï¼Ÿ */}
        <ProactiveProvider>

          {/* 4. è§†è§‰å±‚ï¼šçœ‹èµ·æ¥å¦‚ä½•ï¼Ÿ */}
          <ThemeProvider>
            <UnifiedShell>
               {/* èˆå°å·²å°±ç»ª */}
               <Component {...pageProps} />
            </UnifiedShell>
          </ThemeProvider>

        </ProactiveProvider>
      </SkillProvider>

    </UserProvider>
  </AuthProvider>
</AppProviders>
```

### 6.1 Context æ¥å£å®šä¹‰

```typescript
// 1. AuthContext - è®¤è¯çŠ¶æ€
interface AuthState {
  isAuthenticated: boolean;
  user: User | null;
  tokens: { access: string; refresh: string } | null;
  login: (provider: 'google' | 'apple' | 'wechat') => Promise<void>;
  logout: () => void;
}

// 2. SkillContext - Skill çŠ¶æ€
interface SkillState {
  currentSkill: SkillId;
  setSkill: (skill: SkillId, transition?: boolean) => void;
  subscriptions: SkillSubscription[];
  availableSkills: SkillConfig[];
}

// 3. UserContext - ç”¨æˆ·æ•°æ®
interface UserState {
  profile: UserProfile | null;
  vibeId: VibeIdData | null;
  subscription: SubscriptionStatus;
  entitlements: Entitlement[];
}

// 4. ProactiveContext - æ¨é€çŠ¶æ€
interface ProactiveState {
  notifications: ProactiveNotification[];
  unreadCount: number;
  isConnected: boolean; // WebSocket çŠ¶æ€
}
```

---

## 7. è·¯ç”±ç»“æ„

```
app/
â”œâ”€â”€ (public)/                    # å…¬å¼€é¡µé¢ï¼ˆæ— éœ€ç™»å½•ï¼‰
â”‚   â”œâ”€â”€ page.tsx                 # Landing / Onboarding å…¥å£
â”‚   â”œâ”€â”€ onboarding/              # Onboarding æµç¨‹
â”‚   â””â”€â”€ auth/                    # ç™»å½•/æ³¨å†Œ
â”‚
â”œâ”€â”€ (app)/                       # åº”ç”¨ä¸»ä½“ï¼ˆéœ€ç™»å½•ï¼Œä½¿ç”¨ UnifiedShellï¼‰
â”‚   â”œâ”€â”€ layout.tsx               # UnifiedShell å¸ƒå±€
â”‚   â”œâ”€â”€ chat/                    # å¯¹è¯é¡µé¢ï¼ˆé»˜è®¤é¦–é¡µï¼‰
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ skills/                  # Skill å¸‚åœº
â”‚   â”‚   â”œâ”€â”€ page.tsx             # Skill åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ [skillId]/           # Skill è¯¦æƒ…
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ identity/                # VibeID / Identity Prism
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ journey/                 # æˆé•¿æ—…ç¨‹ / æ—¶é—´çº¿
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ notifications/           # é€šçŸ¥ä¸­å¿ƒ
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ settings/                # è®¾ç½®
â”‚       â””â”€â”€ page.tsx
â”‚
â””â”€â”€ api/                         # Next.js API Routes (Proxy)
    â”œâ”€â”€ v1/
    â”‚   â”œâ”€â”€ chat/
    â”‚   â”œâ”€â”€ skills/
    â”‚   â”œâ”€â”€ tools/
    â”‚   â””â”€â”€ ...
    â””â”€â”€ auth/
```

---

## 8. Skill æ’ä»¶æ¶æ„

### 8.1 å‰ç«¯ Skill ç›®å½•ç»“æ„

```
skills/
â”œâ”€â”€ registry.ts                  # Skill æ³¨å†Œè¡¨
â”œâ”€â”€ types.ts                     # ç±»å‹å®šä¹‰
â”œâ”€â”€ CardRegistry.ts              # å¡ç‰‡æ³¨å†Œè¡¨
â”œâ”€â”€ initCards.ts                 # å¡ç‰‡åˆå§‹åŒ–
â”‚
â”œâ”€â”€ shared/                      # å…±äº«ç»„ä»¶
â”‚   â”œâ”€â”€ ShowCard.tsx             # ç»Ÿä¸€å¡ç‰‡æ¸²æŸ“å™¨
â”‚   â”œâ”€â”€ views/                   # é€šç”¨è§†å›¾ (list, tree, table...)
â”‚   â””â”€â”€ CollectFormCard.tsx      # ä¿¡æ¯æ”¶é›†è¡¨å•
â”‚
â”œâ”€â”€ bazi/                        # å…«å­— Skill
â”‚   â”œâ”€â”€ index.ts                 # Skill é…ç½®å¯¼å‡º
â”‚   â”œâ”€â”€ config.ts                # ä¸»é¢˜ã€åŠŸèƒ½é…ç½®
â”‚   â”œâ”€â”€ cards/                   # ä¸“ç”¨å¡ç‰‡ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ BaziChartCard.tsx
â”‚   â”‚   â”œâ”€â”€ BaziFortuneCard.tsx
â”‚   â”‚   â””â”€â”€ BaziKlineCard.tsx
â”‚   â”œâ”€â”€ panels/                  # ä¸“ç”¨é¢æ¿
â”‚   â”‚   â””â”€â”€ FortunePanel.tsx
â”‚   â””â”€â”€ tools/                   # Tool æ¸²æŸ“å™¨ï¼ˆå¯é€‰ï¼‰
â”‚
â”œâ”€â”€ zodiac/                      # è¥¿æ–¹å æ˜Ÿ Skill
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ [new-skill]/                 # æ–° Skill æ¨¡æ¿
    â”œâ”€â”€ index.ts
    â”œâ”€â”€ config.ts
    â””â”€â”€ cards/
```

### 8.2 æ·»åŠ æ–° Skill æµç¨‹

```mermaid
flowchart LR
    A[1. åç«¯åˆ›å»º SKILL.md] --> B[2. å‰ç«¯åˆ›å»º config.ts]
    B --> C[3. æ³¨å†Œä¸“ç”¨å¡ç‰‡<br/>å¯é€‰]
    C --> D[4. é‡å¯æœåŠ¡]
    D --> E[âœ… è‡ªåŠ¨å‘ç°]

    style A fill:#e3f2fd
    style B fill:#e8f5e9
    style C fill:#fff3e0
    style D fill:#fce4ec
    style E fill:#c8e6c9
```

---

## 9. åç«¯ API å¯¹æ¥

### 9.1 API æ˜ å°„è¡¨

| åç«¯ API | å‰ç«¯æ¨¡å— | ç”¨é€” |
|----------|----------|------|
| `POST /chat/v5/stream` | ChatCore | AI å¯¹è¯æµ (SSE) |
| `GET /skills` | SkillCore | Skill åˆ—è¡¨ |
| `POST /skills/{id}/{action}` | SkillCore | Skill æœåŠ¡è°ƒç”¨ |
| `GET /tools/schema` | CardCore | å·¥å…· Schema |
| `GET /notifications` | ProactiveCore | é€šçŸ¥åˆ—è¡¨ |
| `POST /notifications/{id}/read` | ProactiveCore | æ ‡è®°å·²è¯» |
| `GET /account/identity/prism` | UserContext | VibeID æ•°æ® |
| `GET /commerce/entitlement` | UserContext | æƒç›Šä¿¡æ¯ |

### 9.2 Tool Calling æ¸²æŸ“æµç¨‹

```mermaid
sequenceDiagram
    participant Backend as åç«¯ CoreAgent
    participant SDK as AI SDK 4.x
    participant Chat as ChatMessage
    participant Card as ShowCard

    Backend->>SDK: Tool Call: show_bazi_chart
    Note over Backend,SDK: { cardType: "bazi_chart", chart: {...} }

    SDK->>Chat: toolInvocations
    Chat->>Card: æ£€æµ‹åˆ° tool result

    alt æœ‰ä¸“ç”¨ç»„ä»¶
        Card->>Card: <BaziChartCard />
    else æ— ä¸“ç”¨ç»„ä»¶
        Card->>Card: é€šç”¨è§†å›¾ (fallback)
    end

    Card-->>Chat: æ¸²æŸ“å®Œæˆ
```

---

## 10. å…³é”®ä½“éªŒè®¾è®¡

### 10.1 Skill åˆ‡æ¢åŠ¨æ•ˆ

```
å½“å‰ Skill: Bazi (é‡‘è‰²ä¸»é¢˜)
     â”‚
     â”‚ ç”¨æˆ·åˆ‡æ¢åˆ° Zodiac
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ä¸»é¢˜è‰²æ¸å˜è¿‡æ¸¡ (0.3s)               â”‚
â”‚     é‡‘è‰² â†’ ç´«è‰²                          â”‚
â”‚                                          â”‚
â”‚  2. VibeGlyph å˜å½¢åŠ¨ç”» (0.5s)           â”‚
â”‚     å…«å¦å›¾å½¢ â†’ æ˜Ÿåº§å›¾å½¢                  â”‚
â”‚                                          â”‚
â”‚  3. SidePanel å†…å®¹æ·¡å…¥æ·¡å‡º (0.3s)       â”‚
â”‚     ä»Šæ—¥è¿åŠ¿ â†’ ä»Šæ—¥æ˜Ÿè±¡                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 ä¸»åŠ¨æ¨é€ä½“éªŒ

```mermaid
flowchart TD
    A[åç«¯ Proactive Engine è§¦å‘] --> B[æ¯æ—¥è¿åŠ¿æ¨é€ 08:00]
    B --> C[ç”¨æˆ·æ‰“å¼€ App]
    C --> D[é€šçŸ¥é“ƒé“›æ˜¾ç¤ºçº¢ç‚¹]
    C --> E[SidePanel é¡¶éƒ¨æ˜¾ç¤ºæ¨é€å¡ç‰‡]

    E --> F{ç”¨æˆ·æ“ä½œ}
    F -- "æŸ¥çœ‹è¯¦æƒ…" --> G[å±•å¼€å¡ç‰‡å†…å®¹]
    F -- "å¼€å§‹å¯¹è¯" --> H[è·³è½¬ Chat + è‡ªåŠ¨å‘é€ prompt]
    F -- "å¿½ç•¥" --> I[æ ‡è®°å·²è¯»]
```

### 10.3 æ–°ç”¨æˆ· Onboarding

```mermaid
flowchart LR
    A[Landing Page<br/>é›¶æ‘©æ“¦å…¥å£] --> B[Loading<br/>å‘½ç›˜æ¸è¿›ç»˜åˆ¶]
    B --> C[Aha Moment<br/>æ—¥ä¸»æ´å¯Ÿ]
    C --> D[Conversion<br/>ä»˜è´¹è½¬åŒ–]
    D --> E[Chat<br/>å¼€å§‹å¯¹è¯]

    style A fill:#e3f2fd
    style B fill:#fff3e0
    style C fill:#c8e6c9
    style D fill:#fce4ec
    style E fill:#e8f5e9
```

---

## 11. å®æ–½è·¯çº¿å›¾

### Phase 1: åŸºç¡€ç»Ÿä¸€ï¼ˆ1-2 å‘¨ï¼‰
- [ ] å®ç° UnifiedShellï¼Œæ›¿ä»£ç°æœ‰å¤šå¥—å¸ƒå±€
- [ ] ç»Ÿä¸€ NavRail / BottomNav ç»„ä»¶
- [ ] è¿ç§» Chat é¡µé¢åˆ°æ–°å¸ƒå±€

### Phase 2: Skill ç³»ç»Ÿï¼ˆ1-2 å‘¨ï¼‰
- [ ] å®ç° Skill Market é¡µé¢
- [ ] å®Œå–„ Skill åˆ‡æ¢åŠ¨æ•ˆ
- [ ] å¯¹æ¥åç«¯ Skill è®¢é˜… API

### Phase 3: ä¸»åŠ¨æ¨é€ï¼ˆ1 å‘¨ï¼‰
- [ ] å®ç° ProactiveLayer ç»„ä»¶
- [ ] å¯¹æ¥åç«¯ Notifications API
- [ ] å®ç°é€šçŸ¥ä¸­å¿ƒé¡µé¢

### Phase 4: ä½“éªŒä¼˜åŒ–ï¼ˆæŒç»­ï¼‰
- [ ] Onboarding æµç¨‹ä¼˜åŒ–
- [ ] Identity Prism å¯è§†åŒ–å¢å¼º
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆLCP < 2.5sï¼‰

---

## 12. æœªè§£å†³é—®é¢˜

1. **WebSocket vs Polling**ï¼šä¸»åŠ¨æ¨é€æ˜¯å¦éœ€è¦å®æ—¶ WebSocketï¼Œè¿˜æ˜¯å®šæ—¶è½®è¯¢è¶³å¤Ÿï¼Ÿ
2. **ç¦»çº¿æ”¯æŒ**ï¼šæ˜¯å¦éœ€è¦ PWA ç¦»çº¿ç¼“å­˜å¯¹è¯å†å²ï¼Ÿ
3. **å›½é™…åŒ–**ï¼šæ˜¯å¦éœ€è¦å¤šè¯­è¨€æ”¯æŒï¼Ÿä¼˜å…ˆçº§å¦‚ä½•ï¼Ÿ
4. **A/B æµ‹è¯•**ï¼šæ˜¯å¦éœ€è¦å†…ç½® A/B æµ‹è¯•æ¡†æ¶ï¼Ÿ

---

> **è§†è§‰æ€»ç»“**ï¼š
>
> VibeLife V8 ä¸ä»…ä»…æ˜¯ä¸€ä¸ª UIï¼›å®ƒæ˜¯ä¸€ä¸ª **ç”Ÿå‘½æ¥å£ (Living Interface)**ã€‚
>
> å®ƒä¼šå‘¼å¸ (ä¸»åŠ¨å…³æ€€ Proactive)ï¼Œä¼šæ€è€ƒ (æ™ºèƒ½å†…æ ¸ Core)ï¼Œå¹¶èƒ½éšéœ€åº”å˜ (å…¨æ¯å®¹å™¨ Shell)ã€‚
