"use client"

import { motion } from "framer-motion"
import { Leaf, Flame, Mountain, Gem, Droplets, Sparkles } from "lucide-react"
import { cn } from "@/lib/utils"

interface InsightData {
  type: "bazi" | "emotion"
  insight: string
  insight_cn?: string
  element?: "wood" | "fire" | "earth" | "metal" | "water"
}

interface InstantInsightCardProps {
  data: InsightData
  onUnlock?: () => void
  className?: string
}

const ELEMENT_CONFIG = {
  wood: {
    icon: Leaf,
    label: "Wood · 木",
    color: "text-element-wood",
    bg: "bg-element-wood/10",
    border: "border-element-wood/20",
  },
  fire: {
    icon: Flame,
    label: "Fire · 火",
    color: "text-element-fire",
    bg: "bg-element-fire/10",
    border: "border-element-fire/20",
  },
  earth: {
    icon: Mountain,
    label: "Earth · 土",
    color: "text-element-earth",
    bg: "bg-element-earth/10",
    border: "border-element-earth/20",
  },
  metal: {
    icon: Gem,
    label: "Metal · 金",
    color: "text-foreground-muted",
    bg: "bg-foreground/5",
    border: "border-foreground/10",
  },
  water: {
    icon: Droplets,
    label: "Water · 水",
    color: "text-element-water",
    bg: "bg-element-water/10",
    border: "border-element-water/20",
  },
}

export function InstantInsightCard({
  data,
  onUnlock,
  className,
}: InstantInsightCardProps) {
  const elementConfig = data.element ? ELEMENT_CONFIG[data.element] : null
  const ElementIcon = elementConfig?.icon || Sparkles

  return (
    <motion.div
      className={cn(
        "w-full max-w-md mx-auto",
        "p-6 sm:p-8",
        "rounded-2xl",
        "insight-card",
        className
      )}
      initial={{ opacity: 0, y: 20, scale: 0.95 }}
      animate={{ opacity: 1, y: 0, scale: 1 }}
      transition={{
        duration: 0.5,
        ease: [0.16, 1, 0.3, 1],
      }}
    >
      {/* Header with element badge */}
      <div className="flex items-start justify-between mb-4">
        <div className="flex items-center gap-2">
          {elementConfig && (
            <div
              className={cn(
                "flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium",
                elementConfig.bg,
                elementConfig.border,
                elementConfig.color,
                "border"
              )}
            >
              <ElementIcon className="w-3.5 h-3.5" />
              <span>{elementConfig.label}</span>
            </div>
          )}
        </div>
        <motion.div
          className="text-foreground-subtle"
          animate={{
            rotate: [0, 10, -10, 0],
            scale: [1, 1.1, 1],
          }}
          transition={{
            duration: 2,
            repeat: Infinity,
            ease: "easeInOut",
          }}
        >
          <Sparkles className="w-5 h-5" />
        </motion.div>
      </div>

      {/* Title */}
      <h3 className="serif-heading text-lg sm:text-xl text-foreground mb-3">
        {data.type === "bazi" ? "Destiny Insight" : "Energy Reading"}
      </h3>

      {/* Insight content */}
      <div className="space-y-3">
        <p className="text-foreground/90 text-sm sm:text-base leading-relaxed">
          {data.insight}
        </p>
        {data.insight_cn && (
          <p className="text-foreground-muted text-sm leading-relaxed">
            {data.insight_cn}
          </p>
        )}
      </div>

      {/* Divider */}
      <div className="my-6 h-px bg-gradient-to-r from-transparent via-border to-transparent" />

      {/* CTA */}
      <div className="flex flex-col items-center text-center">
        <p className="text-xs text-foreground-subtle mb-4">
          Your complete destiny map awaits
        </p>
        <motion.button
          onClick={onUnlock}
          className={cn(
            "group relative",
            "px-6 py-3 rounded-full",
            "bg-primary text-primary-foreground",
            "text-sm font-medium",
            "transition-all duration-200",
            "hover:shadow-lg",
            "focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2"
          )}
          whileHover={{ scale: 1.02, y: -1 }}
          whileTap={{ scale: 0.98 }}
        >
          <span className="flex items-center gap-2">
            Unlock Full Analysis
            <motion.span
              animate={{ x: [0, 4, 0] }}
              transition={{
                duration: 1.5,
                repeat: Infinity,
                ease: "easeInOut",
              }}
            >
              →
            </motion.span>
          </span>
        </motion.button>
      </div>
    </motion.div>
  )
}
