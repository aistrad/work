# VibeLife 测试脚本说明

> 最后更新: 2026-01-19

## 测试脚本列表

### 1. 工具与 VibeProfile 集成测试（推荐）

**脚本**: `test_tool_vibeprofile_integration.py`

**用途**: 测试工具调用与 VibeProfile 数据协作，不依赖 LLM API

**特点**:
- ✅ 连接真实数据库 (106.37.170.238:8224/vibelife)
- ✅ 使用真实用户数据
- ✅ 直接调用工具，验证工具注册表和执行链路
- ✅ 测试多个 Skill：bazi, zodiac, vibe_id, tarot, core
- ✅ 验证 VibeProfile 数据提取和使用

**运行**:
```bash
cd /home/aiscend/work/vibelife/apps/api
python scripts/test_tool_vibeprofile_integration.py
```

**测试覆盖**:
- 数据库连接
- 工具注册表初始化 (41 个工具)
- VibeProfile 数据提取
- 八字工具: show_bazi_chart
- 星座工具: show_zodiac_chart
- VibeID 工具: show_vibe_id, show_archetype_radar, get_archetype_info
- Core 工具: write_user_data, query_user_data

**测试结果** (2026-01-19):
```
✅ 数据库连接成功
✅ 已注册 41 个工具
  • bazi         5 个工具
  • career       1 个工具
  • core         23 个工具
  • tarot        3 个工具
  • vibe_id      4 个工具
  • zodiac       5 个工具

✅ Profile 加载成功
✅ VibeID 四维人格原型:
  • Core (灵魂):  Creator
  • Inner (内在): Creator
  • Outer (外在): Innocent
  • Shadow (阴影): Regular

✅ 12原型能量分布正常
✅ 八字/星座工具调用成功
```

---

### 2. 真实用户场景测试

**脚本**: `test_real_user_scenarios.py`

**用途**: 端到端测试 CoreAgent + Skill + VibeProfile 协作

**特点**:
- 模拟 16 个真实用户场景
- 测试 CoreAgent 的完整对话流程
- 需要配置 LLM API keys (GLM/DeepSeek/Claude)

**运行**:
```bash
cd /home/aiscend/work/vibelife/apps/api
python scripts/test_real_user_scenarios.py
```

**注意**: 需要在 `.env` 中配置有效的 LLM API keys

---

### 3. 测试用户管理

**脚本**: `setup_test_user.py`

**用途**: 创建测试用户数据

**特点**:
- 创建固定 UUID 的测试用户: `f43b745f-5a70-4ed1-aaa7-637fb1f87a61`
- 包含完整的 bazi/zodiac/vibe_id 数据
- 自动验证插入成功

**运行**:
```bash
cd /home/aiscend/work/vibelife/apps/api
python scripts/setup_test_user.py
```

---

### 4. 数据库诊断

**脚本**: `diagnose_db.py`

**用途**: 诊断数据库连接和表结构

**运行**:
```bash
cd /home/aiscend/work/vibelife/apps/api
python scripts/diagnose_db.py
```

---

## 测试环境配置

### 数据库连接

测试脚本使用 `/home/aiscend/work/vibelife/apps/api/.env` 中的配置：

```bash
VIBELIFE_DB_URL=postgresql://postgres:Ak4_9lScd-69WX@106.37.170.238:8224/vibelife
VIBELIFE_DB_HOST=106.37.170.238
VIBELIFE_DB_PORT=8224
VIBELIFE_DB_NAME=vibelife
```

### 测试用户

固定的测试用户 UUID：`f43b745f-5a70-4ed1-aaa7-637fb1f87a61`

用户数据包含：
- 出生信息: 1992-03-15 06:30 北京
- 八字数据: 完整的四柱信息
- 星座数据: sun/moon/rising signs
- VibeID: 四维人格原型 (Creator/Creator/Innocent/Regular)

---

## 常见问题

### Q: 运行测试时提示 "用户不存在"

A: 先运行 `setup_test_user.py` 创建测试用户

### Q: 数据库连接失败

A: 检查 `.env` 文件中的数据库配置，确保密码正确

### Q: LLM API 401 错误

A: 检查 `.env` 中的 API keys 是否有效：
- `GLM_API_KEY`
- `DEEPSEEK_API_KEY`
- `CLAUDE_API_KEY`

### Q: 工具未注册警告

A: 某些工具可能还未实现或已被移除，这是正常现象。核心工具都应该正常工作。

---

## 测试架构

```
测试脚本
├── setup_test_user.py              创建测试数据
├── diagnose_db.py                  数据库诊断
│
├── test_tool_vibeprofile_integration.py    工具集成测试 (✅ 推荐)
│   ├── 不依赖 LLM
│   ├── 直接测试工具调用
│   └── 验证 VibeProfile 协作
│
└── test_real_user_scenarios.py     端到端场景测试
    ├── 依赖 LLM API
    ├── 测试 CoreAgent 完整流程
    └── 16 个真实用户场景
```

---

## 后续优化

1. ✅ 工具集成测试已完成
2. ⏳ 补全缺失的工具实现 (show_daily_fortune, show_lunar_phase, draw_tarot_card)
3. ⏳ 添加更多边界情况测试
4. ⏳ 添加性能测试
5. ⏳ 添加并发测试

---

## 参考文档

- [配置文档](/home/aiscend/work/vibelife/docs/config-test.md)
- [部署文档](/home/aiscend/work/vibelife/docs/deployment-test.md)
- [架构规范](/home/aiscend/work/vibelife/docs/archive/v6/SPEC-v7.md)
