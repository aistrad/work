-- ═══════════════════════════════════════════════════════════════════════════
-- VibeLife Unified Profiles Table
-- 统一用户画像表 - 核心表
-- ═══════════════════════════════════════════════════════════════════════════

CREATE TABLE IF NOT EXISTS unified_profiles (
    user_id         UUID PRIMARY KEY,
    profile         JSONB NOT NULL DEFAULT '{}'::jsonb,
    created_at      TIMESTAMP DEFAULT NOW(),
    updated_at      TIMESTAMP DEFAULT NOW()
);

-- 索引
CREATE INDEX IF NOT EXISTS idx_unified_profiles_updated ON unified_profiles(updated_at DESC);

-- GIN 索引用于 JSONB 查询
CREATE INDEX IF NOT EXISTS idx_unified_profiles_profile ON unified_profiles USING GIN(profile);

-- 注释
COMMENT ON TABLE unified_profiles IS '统一用户画像表：存储用户的完整profile数据(JSONB)';
COMMENT ON COLUMN unified_profiles.user_id IS '用户ID (UUID)';
COMMENT ON COLUMN unified_profiles.profile IS 'JSONB profile数据，包含birth_info, skill_data, extracted等所有字段';
COMMENT ON COLUMN unified_profiles.created_at IS '创建时间';
COMMENT ON COLUMN unified_profiles.updated_at IS '更新时间';
