#!/usr/bin/env python3
"""列出数据库中的用户"""
import asyncio
import sys
from pathlib import Path
import os

sys.path.insert(0, str(Path(__file__).parent.parent))

os.environ["VIBELIFE_ENV"] = "test"
from dotenv import load_dotenv
load_dotenv(Path(__file__).resolve().parents[2] / ".env.test")

DB_HOST = "106.37.170.238"
DB_PORT = "8224"
DB_NAME = "vibelife"
DB_USER = "postgres"
DB_PASSWORD = os.getenv("VIBELIFE_DB_PASSWORD", "")
os.environ["VIBELIFE_DB_URL"] = f"postgresql://{DB_USER}:{DB_PASSWORD}@{DB_HOST}:{DB_PORT}/{DB_NAME}"

from stores.db import fetch

async def main():
    rows = await fetch(
        "SELECT user_id, profile->>'display_name' as name FROM unified_profiles ORDER BY created_at DESC LIMIT 10"
    )
    print(f"数据库中的用户 (最近10个):")
    print("="*60)
    for row in rows:
        print(f"  {row['user_id']} - {row['name']}")

if __name__ == "__main__":
    asyncio.run(main())
