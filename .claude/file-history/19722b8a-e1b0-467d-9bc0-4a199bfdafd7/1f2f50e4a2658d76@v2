# VibeID 设计文档 v5.0

> **版本**: 5.0
> **更新日期**: 2026-01-16
> **核心定位**: 成长陪伴型人格操作系统
> **本次升级**: 中等深度八字算法 + 五点星盘模型 + 八字主导融合 + 可解释性模块

---

## 一、设计哲学

### 1.1 核心理念

VibeID 是一个融合东方命理智慧与西方心理学洞察的人格操作系统，旨在成为用户的**成长陪伴者**。

**三个核心信念**：

1. **人格是多维的**：每个人都是多个原型能量的独特组合，而非单一标签
2. **阴影是宝藏**：被我们否认的部分往往藏着成长的金钥匙
3. **成长是过程**：自我认知不是一次性"算出来"的，而是在陪伴中逐渐"发现"的

### 1.2 心理学基础

#### 荣格分析心理学

**集体无意识与原型的本质**

荣格提出的「集体无意识」(Collective Unconscious) 是VibeID系统的哲学基石。与弗洛伊德的个人无意识不同，集体无意识是人类共同继承的心理遗产——一种超越个人经验、植根于人类进化历程的深层心理结构。

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│                    荣格心理结构模型                             │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│                      ┌─────────────┐                           │
│                      │   自我 Ego   │  ← 意识层：日常觉知       │
│                      └──────┬──────┘                           │
│                             │                                   │
│           ╔═════════════════╧═════════════════╗                │
│           ║         人格面具 Persona          ║ ← 社会角色      │
│           ╚═════════════════╤═════════════════╝                │
│                             │                                   │
│  ┌──────────────────────────┼──────────────────────────────┐   │
│  │                          │                              │   │
│  │    ┌─────────┐    ┌─────┴─────┐    ┌─────────┐        │   │
│  │    │  阴影   │    │  阿尼玛/  │    │  自性   │        │   │
│  │    │ Shadow  │    │ 阿尼姆斯  │    │  Self   │        │   │
│  │    └─────────┘    └───────────┘    └─────────┘        │   │
│  │                                                        │   │
│  │                  【个人无意识】                         │   │
│  └──────────────────────────┬─────────────────────────────┘   │
│                             │                                   │
│  ╔══════════════════════════╧══════════════════════════════╗   │
│  ║                                                          ║   │
│  ║                    【集体无意识】                        ║   │
│  ║                                                          ║   │
│  ║   ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐          ║   │
│  ║   │ 英雄   │ │ 智者   │ │ 母亲   │ │ 创造者 │ ...     ║   │
│  ║   │ 原型   │ │ 原型   │ │ 原型   │ │ 原型   │          ║   │
│  ║   └────────┘ └────────┘ └────────┘ └────────┘          ║   │
│  ║                                                          ║   │
│  ║            人类共同的心理遗产 · 跨文化普遍存在           ║   │
│  ║                                                          ║   │
│  ╚══════════════════════════════════════════════════════════╝   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**原型的四大本质特征**

荣格的原型不是具体的形象，而是一种**心理潜能的模式**——它们像是心灵的"磁场"，吸引和组织着我们的经验、情感和行为。

1. **先验性 (A Priori)**
   - 原型先于个人经验存在，是"心灵的本能"
   - 就像鸟儿不需要学习就知道如何筑巢
   - **应用意义**：这解释了为什么八字命理中的"先天八字"能映射人格——出生时刻的宇宙能量配置激活了特定的原型潜能

2. **普遍性 (Universality)**
   - 所有人类文化中都能找到相同的原型主题：英雄之旅、智慧老人、伟大母亲...
   - **应用意义**：这解释了为什么东方八字、西方星座能够在同一个原型框架下统一——因为它们描述的是同一套人类心理的普遍结构

3. **两极性 (Bipolarity)**
   - 每个原型都包含光明面和阴暗面：英雄 ←→ 暴君 | 照顾者 ←→ 殉道者 | 智者 ←→ 脱离
   - **应用意义**：这为系统提供了"成长空间"的理论基础——原型不是静态标签，而是发展维度

4. **动力性 (Dynamism)**
   - 原型不是静止的，它们有能量、有意图、会"呼唤"我们
   - 当原型被激活，会产生强烈的情感体验和行为驱力
   - **应用意义**：这为"Vibe能量"和"行运系统"提供了理论基础——不同时间不同原型能量的起伏，创造了命运的节奏

**12原型的深层结构**

荣格的12原型并非随意分类，而是基于人类两大核心心理动力的组合：

```
        核心驱力1: 自我实现
        "我是谁？我的独特性是什么？"
                    ↑
                    │
             【独立/自我】
                    │
    ┌───────────────┼───────────────┐
    │               │               │
【稳定】←───────────┼───────────→【变革】
    │               │               │
    │        【归属/连接】          │
    │               │               │
    └───────────────┼───────────────┘
                    │
                    ↓
        核心驱力2: 归属联结
        "我属于哪里？我与谁连接？"
```

**四象限 × 三层次 = 12原型**：

| 象限 | 核心追求 | 层次1 | 层次2 | 层次3 |
|------|----------|-------|-------|-------|
| 独立+稳定 | 自我实现与内在秩序 | Innocent (纯粹自我认同) | Sage (理解自我与世界) | Explorer (发现真实自我) |
| 独立+变革 | 自我实现与外在突破 | Hero (证明自我价值) | Outlaw (打破限制框架) | Magician (转化自我与现实) |
| 归属+稳定 | 连接与和谐保持 | Regular (归属于群体) | Caregiver (照顾他人建立连接) | Ruler (建立秩序保护群体) |
| 归属+变革 | 连接与积极改变 | Lover (与他人深度连接) | Jester (通过欢乐建立连接) | Creator (创造新事物贡献群体) |

#### 阿德勒个体心理学

- **自卑与超越**：每个人都有自卑感，这是成长的动力而非病态
- **社会兴趣**：真正的幸福来自于与他人、与社会的连接
- **生活风格**：每个人独特的存在方式和应对模式

#### 应用原则

- 我们借鉴这些心理学框架的洞察力，而非机械套用
- 所有分析都是"倾向性推测"而非"确定性断言"
- 强调赋能和成长，而非贴标签和定性

### 1.3 东西方融合的哲学（v5.0 升级）

**东方智慧**（八字命理）—— **主导地位 (70%)**：
- 提供"先天能量格局"的视角
- 强调时间（出生时刻）对人格的影响
- 关注五行能量的平衡与流转
- **v5.0新增**：考虑日主强弱、用神喜忌，决定Core原型

**西方洞察**（占星学）—— **补充地位 (30%)**：
- 提供"天体能量影响"的视角
- **v5.0升级**：五点模型（太阳、月亮、上升、金星、火星）
- 太阳：核心自我（35%）
- 月亮：情感需求（25%）
- 上升：社会面具（20%）
- 金星：爱情风格（10%）
- 火星：行动风格（10%）

**融合原则（v5.0 升级）**：
- **八字主导**：八字决定Core原型，星座调整表达细节
- **一致性奖励**：当两套体系指向同一原型时，置信度大幅提升（+15%）
- **冲突处理**：当两套体系指向对立原型时，以八字为准，星座作为"表达层调节"

---

## 二、四维人格模型

### 2.1 模型概述

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│                      VibeID 四维人格模型 v5.0                   │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────┐                                                   │
│   │  Core   │ ← 灵魂本质：你最深层的驱动力                      │
│   │  原型   │   来源：八字(格局+用神) 70% + 太阳星座 30%        │
│   └────┬────┘                                                   │
│        │                                                        │
│   ┌────┴────┐                                                   │
│   │  Inner  │ ← 内在世界：你如何处理情绪和需求                  │
│   │  原型   │   来源：月亮星座 + 金星星座                       │
│   └────┬────┘                                                   │
│        │                                                        │
│   ┌────┴────┐                                                   │
│   │  Outer  │ ← 外在呈现：你展示给世界的形象                    │
│   │  原型   │   来源：上升星座 + 火星星座                       │
│   └────┬────┘                                                   │
│        │                                                        │
│   ┌────┴────┐                                                   │
│   │ Shadow  │ ← 阴影倾向：你可能否认或回避的能量                │
│   │  原型   │   来源：渐进式发现                                │
│   └─────────┘                                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 十二原型体系

#### 原型命名（正式名 + 昵称 + Slogan）

| 原型 | 正式名 | 昵称 | Slogan | 核心驱动 | 核心恐惧 |
|------|--------|------|--------|----------|----------|
| Innocent | 天真者 | 小确幸本幸 | "世界很好，我也很好" | 追求幸福与安全 | 害怕受到惩罚或伤害 |
| Explorer | 探险家 | 说走就走型人格 | "人间值得，去看看" | 追求自由与发现 | 害怕空虚或被困住 |
| Sage | 智者 | 人间清醒代表 | "想明白了才能活明白" | 追求真理与理解 | 害怕无知或被欺骗 |
| Hero | 英雄 | 搞事业的命 | "要么出众，要么出局" | 追求掌控与证明 | 害怕软弱或无能 |
| Outlaw | 叛逆者 | 人间清醒叛逆版 | "规则？我自己定" | 追求变革与解放 | 害怕无力或被控制 |
| Magician | 魔术师 | 现实扭曲力场 | "想到就能做到" | 追求转化与实现 | 害怕意外的负面后果 |
| Regular | 凡人 | 人间真实 | "做自己就很好" | 追求归属与连接 | 害怕被排斥或孤立 |
| Lover | 爱人 | 为爱发电体质 | "爱我所爱，无问西东" | 追求亲密与体验 | 害怕孤独或不被爱 |
| Jester | 愚者 | 氛围感担当 | "人生苦短，先甜一会" | 追求快乐与当下 | 害怕无聊或被忽视 |
| Caregiver | 照顾者 | 人形安全感 | "有我在，别怕" | 追求帮助与保护 | 害怕自私或被需要 |
| Creator | 创造者 | 审美在线本人 | "表达是我的呼吸" | 追求创新与表达 | 害怕平庸或无意义 |
| Ruler | 统治者 | 大局观选手 | "一切尽在掌控" | 追求掌控与秩序 | 害怕混乱或失控 |

#### 原型完整内容定义

每个原型包含完整的内容体系，用于产品呈现和社交分享：

**#1 Innocent 天真者 / 小确幸本幸**
- **核心描述**：你是人群中的一道光，自带「岁月静好」滤镜。不是天真，而是选择相信世界本该美好。你的存在让周围的人也变得柔软。
- **超能力**：感染力、治愈力、保持初心
- **成长点**：建立边界感、接受不完美、面对阴暗面
- **成长方向**：在保持纯真的同时发展智慧，学会辨别而非盲目信任
- **最配原型**：Caregiver（人形安全感）
- **需注意原型**：Outlaw（人间清醒叛逆版）
- **稀有度**：8%

**#2 Explorer 探险家 / 说走就走型人格**
- **核心描述**：你的灵魂是一只不愿被笼养的鸟。安稳对你来说是一种慢性窒息，只有未知才能点燃你的生命力。你活着不是为了抵达，而是为了路上。
- **超能力**：适应力、好奇心、打破舒适区
- **成长点**：深度关系、长期承诺、专注坚持
- **成长方向**：学会深耕，在自由探索中也能建立持久的连接
- **最配原型**：Caregiver（人形安全感）
- **需注意原型**：Ruler（大局观选手）
- **稀有度**：10%

**#3 Sage 智者 / 人间清醒代表**
- **核心描述**：你的大脑是一台永不停歇的分析机器。对你来说，「不明白」比「不舒服」更难忍受。你追求的不是答案，而是理解本身。
- **超能力**：洞察力、分析力、独立思考
- **成长点**：行动力、情感表达、接受不确定
- **成长方向**：将智慧转化为行动，不仅追求理解，更要实践和分享
- **最配原型**：Explorer（说走就走型人格）
- **需注意原型**：Jester（氛围感担当）
- **稀有度**：7%

**#4 Hero 英雄 / 搞事业的命**
- **核心描述**：你骨子里有一团不服输的火。挑战越大，你越兴奋。别人眼中的困难，在你看来是证明自己的舞台。
- **超能力**：勇气、决心、执行力
- **成长点**：接受帮助、允许失败、关注过程
- **成长方向**：学会接纳脆弱，在保持勇气的同时培养同理心
- **最配原型**：Sage（人间清醒代表）
- **需注意原型**：Innocent（小确幸本幸）
- **稀有度**：9%

**#5 Outlaw 叛逆者 / 人间清醒叛逆版**
- **核心描述**：规则在你眼里只是「别人的共识」。你不是为了叛逆而叛逆，而是因为你看到了更好的可能性。打破，是为了重建。
- **超能力**：突破力、真实感、革新精神
- **成长点**：建设性表达、团队协作、选择战场
- **成长方向**：将叛逆转化为建设性的变革，找到值得为之战斗的事业
- **最配原型**：Magician（现实扭曲力场）
- **需注意原型**：Ruler（大局观选手）
- **稀有度**：6%

**#6 Magician 魔术师 / 现实扭曲力场**
- **核心描述**：你相信「不可能」只是暂时的。在你的世界里，想象力就是生产力。你不是在做梦，你是在创造现实。
- **超能力**：转化力、直觉力、创造奇迹
- **成长点**：脚踏实地、耐心等待、接受局限
- **成长方向**：将洞察用于帮助他人，而非仅仅掌控局势
- **最配原型**：Outlaw（人间清醒叛逆版）
- **需注意原型**：Regular（人间真实）
- **稀有度**：5%

**#7 Regular 凡人 / 人间真实**
- **核心描述**：你是人群中最真实的存在。不装、不作、不卷。你的力量来自于「做好自己」的笃定，而不是「成为别人」的焦虑。
- **超能力**：共情力、可靠感、脚踏实地
- **成长点**：表达独特性、追求卓越、突破舒适区
- **成长方向**：在归属中保持独特性，勇敢表达自己的观点
- **最配原型**：Caregiver（人形安全感）
- **需注意原型**：Magician（现实扭曲力场）
- **稀有度**：12%

**#8 Lover 爱人 / 为爱发电体质**
- **核心描述**：你的心是一个永不枯竭的能量源。一旦爱上什么，就会全身心投入。对你来说，没有热爱的生活不值得过。
- **超能力**：热情、感染力、全情投入
- **成长点**：保持边界、理性判断、自我关爱
- **成长方向**：在关系中保持独立性，避免失去自我
- **最配原型**：Creator（审美在线本人）
- **需注意原型**：Sage（人间清醒代表）
- **稀有度**：11%

**#9 Jester 愚者 / 氛围感担当**
- **核心描述**：你是人群中的快乐源泉。不是因为你没有烦恼，而是因为你选择用轻盈的方式面对沉重。你的存在让世界变得不那么严肃。
- **超能力**：幽默感、活在当下、化解尴尬
- **成长点**：深度思考、长期规划、面对严肃
- **成长方向**：在欢乐中找到深度，让幽默服务于真正重要的事
- **最配原型**：Explorer（说走就走型人格）
- **需注意原型**：Sage（人间清醒代表）
- **稀有度**：8%

**#10 Caregiver 照顾者 / 人形安全感**
- **核心描述**：你是别人生命中的「安全港」。看到在乎的人过得不好，比自己难受还难受。你的爱是行动，不是言语。
- **超能力**：滋养力、保护欲、无条件支持
- **成长点**：自我关爱、设立边界、允许他人成长
- **成长方向**：学会照顾自己，建立健康的边界，避免过度付出
- **最配原型**：Innocent（小确幸本幸）
- **需注意原型**：Explorer（说走就走型人格）
- **稀有度**：10%

**#11 Creator 创造者 / 审美在线本人**
- **核心描述**：你的眼睛自带「美学滤镜」。看到丑的东西会难受，必须按自己的审美来才舒服。表达不是选择，是本能。
- **超能力**：创造力、审美力、独特表达
- **成长点**：完成比完美重要、接受平凡、团队协作
- **成长方向**：完成作品而非追求完美，让创意真正落地
- **最配原型**：Lover（为爱发电体质）
- **需注意原型**：Regular（人间真实）
- **稀有度**：7%

**#12 Ruler 统治者 / 大局观选手**
- **核心描述**：你天生有一种「主持大局」的气场。看到混乱的局面，就忍不住想站出来。你追求的不是权力，而是秩序。
- **超能力**：领导力、掌控力、战略思维
- **成长点**：放手信任、接受失控、倾听他人
- **成长方向**：学会授权和信任，在掌控中保持灵活
- **最配原型**：Hero（搞事业的命）
- **需注意原型**：Outlaw（人间清醒叛逆版）
- **稀有度**：7%

#### 原型的光明面与阴暗面

每个原型都有其光明面（健康表达）和阴暗面（过度或扭曲表达）：

```
┌─────────────┬────────────────────────┬────────────────────────┐
│    原型     │        光明面          │        阴暗面          │
├─────────────┼────────────────────────┼────────────────────────┤
│ Innocent    │ 乐观、信任、纯粹       │ 天真、否认、依赖       │
│ Explorer    │ 独立、勇敢、好奇       │ 逃避、不安定、孤僻     │
│ Sage        │ 智慧、客观、洞察       │ 冷漠、傲慢、脱离现实   │
│ Hero        │ 勇气、决心、担当       │ 傲慢、冷酷、过度竞争   │
│ Outlaw      │ 革新、勇于打破、真实   │ 破坏、自毁、犯罪倾向   │
│ Magician    │ 转化、疗愈、创造奇迹   │ 操控、欺骗、妄想       │
│ Regular     │ 务实、可靠、共情       │ 失去自我、随波逐流     │
│ Lover       │ 热情、亲密、感恩       │ 沉溺、嫉妒、失去边界   │
│ Jester      │ 快乐、幽默、活在当下   │ 肤浅、逃避、不负责任   │
│ Caregiver   │ 慷慨、滋养、保护       │ 牺牲自我、控制、怨恨   │
│ Creator     │ 创新、表达、想象力     │ 完美主义、自我沉溺     │
│ Ruler       │ 领导力、秩序、责任     │ 专制、控制欲、傲慢     │
└─────────────┴────────────────────────┴────────────────────────┘
```

### 2.3 Core 原型：灵魂本质（v5.0 重大升级）

**定义**：你最核心的人格驱动力，是你在最真实状态下的存在方式。

**计算来源（v5.0 升级）**：
- **八字（主要权重 70%）**：格局 + 用神组合映射
- **太阳星座（次要权重 30%）**：太阳星座映射
- **一致性奖励**：当两者指向同一原型时，置信度+15%
- **冲突处理**：当两者指向不同原型时，以八字为准，星座作为"次要能量"

#### 日主强弱判断（v5.0 新增）

日主强弱是原型计算的基础参数，影响原型的表达方式。

```python
class DayMasterStrength(Enum):
    """日主强弱等级"""
    EXTREMELY_STRONG = "极旺"  # 得令得地得势，需要泄耗
    STRONG = "偏旺"            # 有根有气，喜泄耗
    BALANCED = "中和"          # 身旺弱平衡，喜顺势
    WEAK = "偏弱"              # 无根少气，喜生扶
    EXTREMELY_WEAK = "极弱"    # 从格条件，需特殊处理

def calculate_day_master_strength(bazi: BaziChart) -> tuple[DayMasterStrength, float]:
    """
    计算日主强弱

    Returns:
        (强弱等级, 强度分数 -1.0 到 1.0)
    """
    score = 0.0

    # 1. 得令判断 (月支对日主的影响) - 权重40%
    seasonal_factor = get_seasonal_strength(bazi.day_master, bazi.month_branch)
    score += seasonal_factor * 0.4

    # 2. 得地判断 (四支对日主的根气) - 权重30%
    root_factor = calculate_root_strength(bazi.day_master, bazi.branches)
    score += root_factor * 0.3

    # 3. 得势判断 (天干透出的帮扶) - 权重20%
    support_factor = calculate_stem_support(bazi.day_master, bazi.stems)
    score += support_factor * 0.2

    # 4. 合冲修正 (干支合化、地支冲合) - 权重10%
    combination_factor = calculate_combination_effect(bazi)
    score += combination_factor * 0.1

    # 转换为等级
    if score >= 0.6:
        return (DayMasterStrength.EXTREMELY_STRONG, score)
    elif score >= 0.2:
        return (DayMasterStrength.STRONG, score)
    elif score >= -0.2:
        return (DayMasterStrength.BALANCED, score)
    elif score >= -0.6:
        return (DayMasterStrength.WEAK, score)
    else:
        return (DayMasterStrength.EXTREMELY_WEAK, score)
```

#### 用神喜忌判断（v5.0 新增）

用神决定了命局的需求方向，直接影响原型的核心驱动力。

```python
class UsefulGod(Enum):
    """用神类型"""
    WEALTH = "财"        # 追求资源、物质
    POWER = "官杀"       # 追求权力、地位
    RESOURCE = "印"      # 追求知识、支持
    OUTPUT = "食伤"      # 追求表达、创造
    PEER = "比劫"        # 追求合作、竞争

def determine_useful_god(bazi: BaziChart, strength: DayMasterStrength) -> UsefulGod:
    """
    根据日主强弱确定用神

    基本原则：
    - 身旺：喜财官食伤（泄耗之神）
    - 身弱：喜印比（生扶之神）
    - 特殊格局：顺势取用
    """
    if strength in [DayMasterStrength.STRONG, DayMasterStrength.EXTREMELY_STRONG]:
        # 身旺喜泄耗
        if has_strong_element(bazi, "food_god"):
            return UsefulGod.OUTPUT  # 食伤泄秀
        elif has_strong_element(bazi, "wealth"):
            return UsefulGod.WEALTH  # 财星耗身
        else:
            return UsefulGod.POWER  # 官杀制身
    elif strength in [DayMasterStrength.WEAK, DayMasterStrength.EXTREMELY_WEAK]:
        # 身弱喜生扶
        if has_strong_element(bazi, "resource"):
            return UsefulGod.RESOURCE  # 印星生身
        else:
            return UsefulGod.PEER  # 比劫帮身
    else:
        # 中和取平衡
        return determine_balanced_god(bazi)
```

#### 八字格局+用神→原型映射（v5.0 核心升级）

升级后的映射考虑格局和用神的组合，共10格局×5用神=50种组合：

| 格局 | 用神为财 | 用神为官杀 | 用神为印 | 用神为食伤 | 用神为比劫 |
|------|----------|------------|----------|------------|------------|
| 正官格 | Ruler+Caregiver | Ruler+Hero | Sage+Ruler | Creator+Ruler | Regular+Ruler |
| 七杀格 | Hero+Explorer | Outlaw+Hero | Hero+Sage | Outlaw+Creator | Hero+Regular |
| 正印格 | Caregiver+Sage | Sage+Ruler | Sage+Innocent | Creator+Sage | Caregiver+Regular |
| 偏印格 | Magician+Explorer | Magician+Sage | Sage+Magician | Creator+Outlaw | Outlaw+Magician |
| 食神格 | Creator+Lover | Magician+Creator | Sage+Creator | Creator+Jester | Jester+Creator |
| 伤官格 | Creator+Outlaw | Outlaw+Hero | Magician+Creator | Creator+Outlaw | Outlaw+Explorer |
| 正财格 | Regular+Lover | Ruler+Regular | Sage+Caregiver | Creator+Regular | Regular+Caregiver |
| 偏财格 | Explorer+Jester | Explorer+Ruler | Magician+Explorer | Jester+Creator | Jester+Lover |
| 比肩格 | Explorer+Hero | Hero+Outlaw | Sage+Explorer | Creator+Explorer | Regular+Hero |
| 劫财格 | Outlaw+Explorer | Hero+Outlaw | Magician+Outlaw | Jester+Outlaw | Outlaw+Hero |

**映射示例代码**：

```python
BAZI_ARCHETYPE_MAPPING = {
    "正官格": {
        UsefulGod.WEALTH: {
            "primary": "Ruler",      # 统治者：通过资源管理实现秩序
            "secondary": "Caregiver", # 照顾者：对他人负责
            "driver": "责任驱动型成就者"
        },
        UsefulGod.RESOURCE: {
            "primary": "Sage",       # 智者：通过知识获得权威
            "secondary": "Ruler",
            "driver": "知识驱动型领导者"
        },
        # ... 其他用神组合
    },
    # ... 其他格局
}
```

#### 日主强弱对原型表达的修正

```python
def apply_strength_modifier(archetype_scores, strength_score):
    """
    日主强弱修正原型表达

    身旺：增强外向型原型（Hero, Ruler, Outlaw, Explorer, Creator, Jester）
    身弱：增强内向型原型（Sage, Caregiver, Innocent, Lover, Regular, Magician）
    """
    EXTROVERT_ARCHETYPES = {
        "Hero", "Ruler", "Outlaw", "Explorer", "Creator", "Jester"
    }
    INTROVERT_ARCHETYPES = {
        "Sage", "Caregiver", "Innocent", "Lover", "Regular", "Magician"
    }

    if strength_score > 0:  # 身旺
        modifier = 1 + strength_score * 0.2  # 最多+20%
        for archetype in EXTROVERT_ARCHETYPES:
            archetype_scores[archetype] *= modifier
    else:  # 身弱
        modifier = 1 + abs(strength_score) * 0.2
        for archetype in INTROVERT_ARCHETYPES:
            archetype_scores[archetype] *= modifier

    return archetype_scores
```

#### 太阳星座→原型映射

| 太阳星座 | 主要原型 | 次要原型 |
|----------|----------|----------|
| 白羊座 | Hero | Explorer |
| 金牛座 | Lover | Regular |
| 双子座 | Jester | Magician |
| 巨蟹座 | Caregiver | Innocent |
| 狮子座 | Ruler | Creator |
| 处女座 | Sage | Caregiver |
| 天秤座 | Lover | Ruler |
| 天蝎座 | Magician | Outlaw |
| 射手座 | Explorer | Sage |
| 摩羯座 | Ruler | Hero |
| 水瓶座 | Outlaw | Sage |
| 双鱼座 | Innocent | Magician |

### 2.4 Inner 原型：内在世界（v5.0 升级）

**定义**：你如何处理内在情绪、需求和私密体验。这是只有亲近的人才能看到的你。

**计算来源（v5.0 升级）**：
- **月亮星座（主要 75%）**：情感需求
- **金星星座（辅助 25%）**：爱情风格，补充情感表达

#### 月亮星座→原型映射

| 月亮星座 | Inner原型 | 情感特质 |
|----------|-----------|----------|
| 白羊座 | Hero | 直接、冲动的情感表达 |
| 金牛座 | Lover | 稳定、感官的情感需求 |
| 双子座 | Jester | 多变、交流的情感模式 |
| 巨蟹座 | Caregiver | 滋养、保护的情感本能 |
| 狮子座 | Creator | 热情、戏剧化的情感 |
| 处女座 | Caregiver | 细致、服务的情感表达 |
| 天秤座 | Lover | 和谐、审美的情感需求 |
| 天蝎座 | Magician | 深沉、转化的情感体验 |
| 射手座 | Explorer | 自由、乐观的情感态度 |
| 摩羯座 | Ruler | 克制、务实的情感处理 |
| 水瓶座 | Outlaw | 超脱、人道的情感观 |
| 双鱼座 | Innocent | 共情、梦幻的情感世界 |

#### 金星星座→爱情风格映射（v5.0 新增）

| 金星星座 | 原型 | 爱情风格 |
|----------|------|----------|
| 白羊座 | Hero | 主动追求、热情直接 |
| 金牛座 | Lover | 忠诚专一、感官享受 |
| 双子座 | Jester | 多变有趣、智性交流 |
| 巨蟹座 | Caregiver | 温柔呵护、家庭导向 |
| 狮子座 | Creator | 浪漫奢华、戏剧化表达 |
| 处女座 | Caregiver | 细心体贴、实际付出 |
| 天秤座 | Lover | 优雅浪漫、追求美感 |
| 天蝎座 | Magician | 深情专一、占有欲强 |
| 射手座 | Explorer | 自由开放、冒险精神 |
| 摩羯座 | Ruler | 务实稳重、长期承诺 |
| 水瓶座 | Outlaw | 独立自由、打破常规 |
| 双鱼座 | Innocent | 浪漫梦幻、无条件付出 |

### 2.5 Outer 原型：外在呈现（v5.0 升级）

**定义**：你展示给世界的形象，你希望别人如何看待你。这是你的"社会面具"。

**计算来源（v5.0 升级）**：
- **上升星座（主要 70%）**：社会面具
- **火星星座（辅助 30%）**：行动风格，影响外在行为表现

#### 上升星座→原型映射

| 上升星座 | Outer原型 | 社交风格 |
|----------|-----------|----------|
| 白羊座 | Hero | 主动、直接、有冲劲 |
| 金牛座 | Regular | 稳重、可靠、务实 |
| 双子座 | Jester | 灵活、健谈、好奇 |
| 巨蟹座 | Caregiver | 温和、体贴、保护性 |
| 狮子座 | Ruler | 自信、大方、有魅力 |
| 处女座 | Sage | 细致、谨慎、有条理 |
| 天秤座 | Lover | 优雅、和善、注重美感 |
| 天蝎座 | Magician | 神秘、深邃、有穿透力 |
| 射手座 | Explorer | 开朗、乐观、有冒险精神 |
| 摩羯座 | Ruler | 严肃、专业、有目标感 |
| 水瓶座 | Outlaw | 独特、前卫、有距离感 |
| 双鱼座 | Innocent | 柔和、梦幻、有同理心 |

#### 火星星座→行动风格映射（v5.0 新增）

| 火星星座 | 原型 | 行动风格 |
|----------|------|----------|
| 白羊座 | Hero | 果断冲动、竞争好胜 |
| 金牛座 | Regular | 稳健持久、务实坚定 |
| 双子座 | Magician | 灵活多变、策略性强 |
| 巨蟹座 | Caregiver | 情绪驱动、保护本能 |
| 狮子座 | Ruler | 自信领导、追求卓越 |
| 处女座 | Sage | 精确分析、完美主义 |
| 天秤座 | Lover | 协调平衡、避免冲突 |
| 天蝎座 | Magician | 坚定执着、隐秘策略 |
| 射手座 | Explorer | 冒险乐观、自由奔放 |
| 摩羯座 | Hero | 坚韧不拔、目标导向 |
| 水瓶座 | Outlaw | 独特创新、打破规则 |
| 双鱼座 | Innocent | 直觉引导、随流而动 |

### 2.6 Shadow 原型：阴影倾向

**定义**：你可能否认、压抑或回避的人格能量。整合阴影是成长的关键任务。

**重要说明**：
- 阴影不是"坏的"，而是"被否认的"
- 阴影中往往藏着我们未开发的潜能（"金子"）
- 阴影是个人化的，需要在成长陪伴中逐渐发现

#### 渐进式阴影发现机制

**第一层：初始推测**

基于Core原型，提供阴影的初始倾向性推测：

| Core原型 | 初始阴影倾向 | 核心张力 |
|----------|--------------|----------|
| Innocent | Hero | 信任 vs 掌控 |
| Hero | Innocent | 征服 vs 信任 |
| Sage | Jester | 深刻 vs 轻盈 |
| Jester | Sage | 轻盈 vs 深刻 |
| Caregiver | Explorer | 扎根 vs 流动 |
| Explorer | Caregiver | 自由 vs 责任 |
| Creator | Regular | 独特 vs 归属 |
| Regular | Creator | 归属 vs 独特 |
| Lover | Magician | 融合 vs 超越 |
| Magician | Lover | 超越 vs 融合 |
| Ruler | Outlaw | 秩序 vs 自由 |
| Outlaw | Ruler | 自由 vs 秩序 |

**第二层：数据验证**

计算用户12原型的完整得分，识别最低分原型进行交叉验证。

**第三层：用户确认（可选深度探索）**

通过问答引导用户探索和确认自己的阴影倾向。

**第四层：长期反馈调整**

基于用户在"深度日"的行为和反馈，动态调整阴影画像。

---

## 三、计算体系（v5.0 重大升级）

### 3.1 输入数据要求

#### 必需输入

| 字段 | 格式 | 用途 | 默认值 |
|------|------|------|--------|
| 出生年 | YYYY | 八字年柱、星座计算 | 无 |
| 出生月 | MM | 八字月柱、星座计算 | 无 |
| 出生日 | DD | 八字日柱、星座计算 | 无 |

#### 可选输入（推荐提供）

| 字段 | 格式 | 用途 | 默认值 |
|------|------|------|--------|
| 出生时 | HH:MM | 八字时柱、精确星盘 | 12:00 |
| 出生地点 | 城市名 | 精确上升星座计算 | 北京（中国用户） |

### 3.2 基础计算流程（v5.0 升级）

```
┌─────────────────────────────────────────────────────────────────┐
│                       VibeID 计算流程 v5.0                      │
└─────────────────────────────────────────────────────────────────┘

      ┌──────────────┐
      │   用户输入   │
      │ (生辰信息)   │
      └──────┬───────┘
             │
             ▼
┌────────────────────────────────────────────────────────────────┐
│                         并行计算                                │
├────────────────────────────┬───────────────────────────────────┤
│                            │                                   │
│   ┌────────────────────┐   │   ┌────────────────────┐         │
│   │    八字计算        │   │   │    五点星盘计算    │         │
│   ├────────────────────┤   │   ├────────────────────┤         │
│   │ • 四柱推算         │   │   │ • 太阳星座 (35%)   │         │
│   │ • 日主强弱计算     │   │   │ • 月亮星座 (25%)   │         │
│   │ • 用神喜忌判断     │   │   │ • 上升星座 (20%)   │         │
│   │ • 格局判断         │   │   │ • 金星星座 (10%)   │         │
│   │ • 五行分析         │   │   │ • 火星星座 (10%)   │         │
│   └────────┬───────────┘   │   └────────┬───────────┘         │
│            │               │            │                      │
│            ▼               │            ▼                      │
│   ┌────────────────────┐   │   ┌────────────────────┐         │
│   │  八字原型映射      │   │   │  星座原型映射      │         │
│   │  格局+用神组合     │   │   │  五点综合计算      │         │
│   │  (权重 70%)        │   │   │  (权重 30%)        │         │
│   └────────┬───────────┘   │   └────────┬───────────┘         │
│            │               │            │                      │
└────────────┼───────────────┴────────────┼──────────────────────┘
             │                            │
             └────────────┬───────────────┘
                          ▼
             ┌──────────────────────┐
             │    八字主导融合      │
             │                      │
             │ • 一致性检查         │
             │ • 一致性奖励 (+15%)  │
             │ • 冲突处理           │
             │ • 置信度计算         │
             └──────────┬───────────┘
                        │
                        ▼
             ┌──────────────────────┐
             │    可解释性生成      │
             │                      │
             │ • 八字洞察           │
             │ • 星座洞察           │
             │ • 融合洞察           │
             │ • 成长方向           │
             └──────────┬───────────┘
                        │
                        ▼
             ┌──────────────────────┐
             │    VibeID 生成       │
             └──────────────────────┘
```

### 3.3 八字原型计算（v5.0 核心算法）

```python
def calculate_bazi_archetype(bazi_data):
    """
    八字原型计算 - v5.0 中等深度算法
    """
    # Step 1: 计算日主强弱
    strength, strength_score = calculate_day_master_strength(bazi_data)

    # Step 2: 确定用神
    useful_god = determine_useful_god(bazi_data, strength)

    # Step 3: 获取格局
    pattern = bazi_data.pattern

    # Step 4: 格局+用神组合映射
    archetype_mapping = BAZI_ARCHETYPE_MAPPING[pattern][useful_god]
    primary_archetype = archetype_mapping["primary"]
    secondary_archetype = archetype_mapping["secondary"]
    driver = archetype_mapping["driver"]

    # Step 5: 初始化得分
    bazi_scores = {archetype: 0.0 for archetype in ALL_ARCHETYPES}
    bazi_scores[primary_archetype] = 1.0
    bazi_scores[secondary_archetype] = 0.5

    # Step 6: 应用日主强弱修正
    bazi_scores = apply_strength_modifier(bazi_scores, strength_score)

    # Step 7: 生成解释
    explanation = f"你的八字是{pattern}，用神为{useful_god.value}，这决定了你的人生底色是{primary_archetype}型的{driver}。"

    return {
        "scores": bazi_scores,
        "primary": primary_archetype,
        "secondary": secondary_archetype,
        "pattern": pattern,
        "useful_god": useful_god.value,
        "day_master_strength": strength.value,
        "driver": driver,
        "explanation": explanation
    }
```

### 3.4 五点星盘原型计算（v5.0 新增）

```python
def calculate_zodiac_archetype(natal_chart):
    """
    五点星盘原型计算 - v5.0 算法
    """
    archetype_scores = {archetype: 0.0 for archetype in ALL_ARCHETYPES}
    explanations = []

    # 太阳星座 (35%权重)
    sun_mapping = SUN_SIGN_MAPPING[natal_chart.sun_sign]
    archetype_scores[sun_mapping["primary"]] += 0.35 * 1.0
    archetype_scores[sun_mapping["secondary"]] += 0.35 * 0.5
    explanations.append(f"太阳{natal_chart.sun_sign}赋予你{sun_mapping['primary']}的核心特质")

    # 月亮星座 (25%权重)
    moon_mapping = MOON_SIGN_MAPPING[natal_chart.moon_sign]
    archetype_scores[moon_mapping["primary"]] += 0.25 * 1.0
    explanations.append(f"月亮{natal_chart.moon_sign}让你的情感表达呈现{moon_mapping['style']}")

    # 上升星座 (20%权重)
    asc_mapping = ASCENDANT_MAPPING[natal_chart.ascendant]
    archetype_scores[asc_mapping["primary"]] += 0.20 * 1.0
    explanations.append(f"上升{natal_chart.ascendant}让你给人{asc_mapping['impression']}的印象")

    # 金星星座 (10%权重)
    venus_mapping = VENUS_SIGN_MAPPING[natal_chart.venus_sign]
    archetype_scores[venus_mapping["primary"]] += 0.10 * 1.0
    explanations.append(f"金星{natal_chart.venus_sign}让你的爱情风格是{venus_mapping['love_style']}")

    # 火星星座 (10%权重)
    mars_mapping = MARS_SIGN_MAPPING[natal_chart.mars_sign]
    archetype_scores[mars_mapping["primary"]] += 0.10 * 1.0
    explanations.append(f"火星{natal_chart.mars_sign}让你的行动风格是{mars_mapping['action_style']}")

    # 确定主原型
    primary = max(archetype_scores, key=archetype_scores.get)

    return {
        "scores": archetype_scores,
        "primary": primary,
        "explanations": explanations,
        "sun_sign": natal_chart.sun_sign,
        "moon_sign": natal_chart.moon_sign,
        "ascendant": natal_chart.ascendant,
        "venus_sign": natal_chart.venus_sign,
        "mars_sign": natal_chart.mars_sign
    }
```

### 3.5 八字主导融合算法（v5.0 核心升级）

```python
class FusionStrategy:
    """八字主导的东西方融合策略"""

    # 基础权重：八字70%，星座30%
    BASE_BAZI_WEIGHT = 0.70
    BASE_ZODIAC_WEIGHT = 0.30

    # 一致性奖励：当两套系统指向同一原型时
    CONSISTENCY_BONUS = 0.15

    # 冲突处理：当两套系统指向对立原型时
    CONFLICT_PENALTY = 0.10

def calculate_fused_archetype(bazi_result, zodiac_result):
    """
    融合计算最终原型

    策略：
    1. 八字决定Core原型（主原型）
    2. 星座调整表达层次（Inner/Outer）
    3. 一致性增强置信度
    4. 冲突时八字优先
    """

    # Step 1: 获取八字主原型
    bazi_primary = bazi_result["primary"]

    # Step 2: 获取星座主原型
    zodiac_primary = zodiac_result["primary"]

    # Step 3: 一致性检查
    consistency_type = check_consistency(bazi_primary, zodiac_primary)

    # Step 4: 融合计算
    fused_scores = {}
    for archetype in ALL_ARCHETYPES:
        base_score = (
            bazi_result["scores"].get(archetype, 0) * FusionStrategy.BASE_BAZI_WEIGHT +
            zodiac_result["scores"].get(archetype, 0) * FusionStrategy.BASE_ZODIAC_WEIGHT
        )

        # 一致性奖励
        if archetype == bazi_primary and archetype == zodiac_primary:
            base_score += FusionStrategy.CONSISTENCY_BONUS

        fused_scores[archetype] = base_score

    # Step 5: 确定最终原型
    primary_archetype = max(fused_scores, key=fused_scores.get)

    # Step 6: 确定副原型（排除主原型后的最高分）
    secondary_scores = {k: v for k, v in fused_scores.items() if k != primary_archetype}
    secondary_archetype = max(secondary_scores, key=secondary_scores.get)

    # Step 7: 计算置信度
    confidence = calculate_confidence(
        fused_scores[primary_archetype],
        fused_scores[secondary_archetype],
        consistency_type
    )

    # Step 8: 生成解释
    explanation = generate_explanation(
        primary_archetype, secondary_archetype,
        bazi_primary, zodiac_primary,
        consistency_type,
        bazi_result["explanation"],
        zodiac_result["explanations"]
    )

    return {
        "primary_archetype": primary_archetype,
        "secondary_archetype": secondary_archetype,
        "all_scores": fused_scores,
        "confidence": confidence,
        "consistency_type": consistency_type,
        "explanation": explanation,
        "bazi_contribution": bazi_result,
        "zodiac_contribution": zodiac_result
    }

def check_consistency(bazi_archetype, zodiac_archetype):
    """检查八字和星座原型的一致性"""

    if bazi_archetype == zodiac_archetype:
        return "perfect_match"  # 完美一致

    # 定义原型对立关系
    OPPOSING_PAIRS = [
        ("Ruler", "Outlaw"),
        ("Hero", "Innocent"),
        ("Sage", "Jester"),
        ("Caregiver", "Explorer"),
    ]

    for pair in OPPOSING_PAIRS:
        if {bazi_archetype, zodiac_archetype} == set(pair):
            return "conflict"  # 对立冲突

    # 定义原型相近关系
    SIMILAR_GROUPS = [
        {"Ruler", "Hero", "Magician"},
        {"Sage", "Caregiver", "Regular"},
        {"Creator", "Explorer", "Outlaw"},
        {"Lover", "Innocent", "Jester"},
    ]

    for group in SIMILAR_GROUPS:
        if bazi_archetype in group and zodiac_archetype in group:
            return "similar"  # 相近

    return "neutral"  # 中性
```

### 3.6 可解释性模块（v5.0 新增）

```python
def generate_explanation(primary, secondary, bazi_primary, zodiac_primary,
                         consistency, bazi_explanation, zodiac_explanations):
    """
    生成用户可理解的原型解释
    """

    explanation = {
        "summary": "",
        "bazi_insight": "",
        "zodiac_insight": "",
        "integration_insight": "",
        "growth_direction": ""
    }

    # 主原型总结
    explanation["summary"] = f"你的核心原型是【{ARCHETYPE_CHINESE_NAMES[primary]}】，副原型是【{ARCHETYPE_CHINESE_NAMES[secondary]}】"

    # 八字洞察
    explanation["bazi_insight"] = bazi_explanation

    # 星座洞察
    explanation["zodiac_insight"] = f"从星盘角度看，{'; '.join(zodiac_explanations[:3])}。"

    # 融合洞察
    if consistency == "perfect_match":
        explanation["integration_insight"] = (
            f"东方命理与西方占星高度一致地指向{ARCHETYPE_CHINESE_NAMES[primary]}原型，"
            f"说明这是你非常稳定的核心特质。"
        )
    elif consistency == "conflict":
        explanation["integration_insight"] = (
            f"有趣的是，八字指向{ARCHETYPE_CHINESE_NAMES[bazi_primary]}，"
            f"而星盘指向{ARCHETYPE_CHINESE_NAMES[zodiac_primary]}，"
            f"这种张力可能让你内心有时感到矛盾。"
            f"最终我们以八字为主，确定你的主原型是{ARCHETYPE_CHINESE_NAMES[primary]}。"
        )
    else:
        explanation["integration_insight"] = (
            f"八字的{ARCHETYPE_CHINESE_NAMES[bazi_primary]}特质与星盘的{ARCHETYPE_CHINESE_NAMES[zodiac_primary]}特质"
            f"相互补充，让你的人格更加丰富多元。"
        )

    # 成长方向
    explanation["growth_direction"] = GROWTH_DIRECTIONS[primary]

    return explanation

# 成长方向映射
GROWTH_DIRECTIONS = {
    "Hero": "你的成长方向是学会接纳脆弱，在保持勇气的同时培养同理心。",
    "Sage": "你的成长方向是将智慧转化为行动，不仅追求理解，更要实践和分享。",
    "Caregiver": "你的成长方向是学会照顾自己，建立健康的边界，避免过度付出。",
    "Creator": "你的成长方向是完成作品而非追求完美，让创意真正落地。",
    "Ruler": "你的成长方向是学会授权和信任，在掌控中保持灵活。",
    "Outlaw": "你的成长方向是将叛逆转化为建设性的变革，找到值得为之战斗的事业。",
    "Magician": "你的成长方向是将洞察用于帮助他人，而非仅仅掌控局势。",
    "Lover": "你的成长方向是在关系中保持独立性，避免失去自我。",
    "Jester": "你的成长方向是在欢乐中找到深度，让幽默服务于真正重要的事。",
    "Regular": "你的成长方向是在归属中保持独特性，勇敢表达自己的观点。",
    "Innocent": "你的成长方向是在保持纯真的同时发展智慧，学会辨别而非盲目信任。",
    "Explorer": "你的成长方向是学会深耕，在自由探索中也能建立持久的连接。"
}
```

### 3.7 十二原型得分计算（v5.0 更新）

每个原型的得分（0-100）由以下因素综合计算：

```python
def calculate_archetype_score(archetype, bazi_data, astro_data, fused_scores):
    """
    计算单个原型的最终得分 (0-100)
    """
    # 基准分 50
    score = 50

    # 融合得分贡献 (±30分)
    fusion_contribution = fused_scores.get(archetype, 0)
    score += fusion_contribution * 30

    # 五行相关性修正 (±10分)
    element_affinity = get_element_affinity(archetype, bazi_data.dominant_elements)
    score += element_affinity * 10

    # 归一化到0-100
    return max(0, min(100, score))
```

### 3.8 每日行运计算

（保持原有设计，略）

### 3.9 问答确认系统

（保持原有设计，略）

---

## 四、动态系统：Vibe OS

（保持原有设计，略）

---

## 五、数据结构（v5.0 升级）

### 5.1 用户画像 (VibeID Profile)

```typescript
interface VibeIDProfile {
  // 基础信息
  id: string;
  created_at: timestamp;
  updated_at: timestamp;

  // 出生信息
  birth_data: {
    year: number;
    month: number;
    day: number;
    hour: number;        // 默认12
    minute: number;      // 默认0
    location: {
      city: string;      // 默认"北京"
      timezone: string;
      latitude: number;
      longitude: number;
    };
  };

  // 八字数据（v5.0 扩展）
  bazi: {
    four_pillars: {
      year: { gan: string; zhi: string; };
      month: { gan: string; zhi: string; };
      day: { gan: string; zhi: string; };
      hour: { gan: string; zhi: string; };
    };
    day_master: string;
    day_master_strength: '极旺' | '偏旺' | '中和' | '偏弱' | '极弱';  // v5.0新增
    day_master_strength_score: number;  // v5.0新增 (-1.0 ~ 1.0)
    dominant_element: string;
    pattern: string;        // 格局
    useful_god: '财' | '官杀' | '印' | '食伤' | '比劫';  // v5.0新增
    archetype_driver: string;  // v5.0新增 e.g. "责任驱动型成就者"
  };

  // 星盘数据（v5.0 扩展为五点模型）
  natal_chart: {
    sun_sign: string;
    moon_sign: string;
    rising_sign: string;
    venus_sign: string;    // v5.0新增
    mars_sign: string;     // v5.0新增
    planets: {
      [planet: string]: {
        sign: string;
        house: number;
        degree: number;
      };
    };
  };

  // 四维原型（v5.0 更新）
  archetypes: {
    core: {
      primary: ArchetypeType;
      secondary: ArchetypeType | null;
      confidence: 'high' | 'medium' | 'low';
      source: {
        bazi_contribution: ArchetypeType;
        bazi_pattern: string;          // v5.0新增
        bazi_useful_god: string;       // v5.0新增
        zodiac_contribution: ArchetypeType;
        consistency_type: 'perfect_match' | 'similar' | 'neutral' | 'conflict';  // v5.0新增
      };
    };
    inner: {
      archetype: ArchetypeType;
      emotional_traits: string[];
      love_style: string;    // v5.0新增 (from Venus)
    };
    outer: {
      archetype: ArchetypeType;
      social_style: string[];
      action_style: string;  // v5.0新增 (from Mars)
    };
    shadow: {
      primary_tendency: ArchetypeType;
      alternative_tendencies: ArchetypeType[];
      confidence: 'high' | 'medium' | 'low';
      user_confirmed: boolean;
      confirmation_date: timestamp | null;
    };
  };

  // 12原型得分
  archetype_scores: {
    [archetype: string]: number;  // 0-100
  };

  // 可解释性模块（v5.0 新增）
  explanation: {
    summary: string;
    bazi_insight: string;
    zodiac_insight: string;
    integration_insight: string;
    growth_direction: string;
  };

  // 成长数据
  growth_data: {
    deep_days_count: number;
    last_deep_day: timestamp | null;
    courage_invitations_accepted: number;
    shadow_explorations: ShadowExplorationRecord[];
  };

  // 计算元数据（v5.0 新增）
  calculation_metadata: {
    version: string;  // "v5.0"
    calculated_at: timestamp;
    algorithm_params: {
      bazi_weight: number;      // 0.70
      zodiac_weight: number;    // 0.30
      consistency_bonus: number; // 0.15
    };
  };
}
```

### 5.2 简化展示结构（v5.0 新增）

```typescript
interface VibeIDDisplay {
  // 简化展示（前端使用）
  primary_archetype: string;  // 主原型名称
  primary_emoji: string;      // 主原型emoji
  primary_tagline: string;    // 一句话描述

  secondary_archetype: string;

  summary: string;            // 综合描述
  growth_tip: string;         // 成长提示

  // 归因简述（用户可展开查看）
  bazi_brief: string;         // "正官格 · 用神为财"
  zodiac_brief: string;       // "太阳狮子 · 月亮巨蟹 · 上升天蝎"
}

// 原型emoji映射
const ARCHETYPE_EMOJI = {
  "Innocent": "🌸",
  "Sage": "📚",
  "Explorer": "🧭",
  "Outlaw": "⚡",
  "Magician": "🔮",
  "Hero": "⚔️",
  "Lover": "💕",
  "Jester": "🎭",
  "Regular": "🏠",
  "Caregiver": "🤗",
  "Ruler": "👑",
  "Creator": "🎨"
};
```

### 5.3 每日 Vibe 数据

（保持原有设计，略）

---

## 六、产品呈现

### 6.1 VibeID 卡片（v5.0 更新）

**首次生成展示**：

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│                         VibeID                                  │
│                                                                 │
│                    ╭──────────────╮                             │
│                    │              │                             │
│                    │   🎨         │                             │
│                    │              │                             │
│                    ╰──────────────╯                             │
│                                                                 │
│                    Core: 创造者 / 审美在线本人                  │
│                    "表达是我的呼吸"                             │
│                                                                 │
│   ─────────────────────────────────────────────────────────    │
│                                                                 │
│   Inner: 🔮 魔术师        Outer: 🤗 照顾者                      │
│   情感风格: 深沉转化       社交风格: 温和保护                   │
│                                                                 │
│   ─────────────────────────────────────────────────────────    │
│                                                                 │
│   Shadow倾向: 🏠 凡人                                           │
│   核心张力: 独特 vs 归属                                        │
│                                                                 │
│   ─────────────────────────────────────────────────────────    │
│                                                                 │
│   📍 底层密码                                                   │
│   八字: 伤官格 · 用神为财 · 身偏旺                              │
│   星盘: 太阳狮子 · 月亮双鱼 · 上升天蝎                          │
│                                                                 │
│   ─────────────────────────────────────────────────────────    │
│                                                                 │
│   ✨ 成长方向                                                   │
│   "你的成长方向是完成作品而非追求完美，让创意真正落地。"        │
│                                                                 │
│                     [ 探索我的VibeID ]                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

（其余产品呈现部分保持原有设计，略）

---

## 七、架构扩展预留

（保持原有设计，略）

---

## 八、用户体验流程

（保持原有设计，略）

---

## 九、附录

### 9.1 术语表（v5.0 更新）

| 术语 | 定义 |
|------|------|
| VibeID | 用户的完整人格画像，包含四维原型和动态数据 |
| Vibe值 | 每日能量共振指数，0-100 |
| Core原型 | 灵魂本质，最深层的人格驱动力（八字主导） |
| Inner原型 | 内在世界，处理情绪和需求的方式（月亮+金星） |
| Outer原型 | 外在呈现，展示给世界的形象（上升+火星） |
| Shadow原型 | 阴影倾向，被否认或压抑的能量 |
| 日主强弱 | 八字日干的强弱程度，影响原型表达方式 |
| 用神 | 八字命局的需求方向，决定核心驱动力 |
| 五点模型 | 太阳、月亮、上升、金星、火星五个星盘关键点 |
| 一致性奖励 | 当八字和星座指向同一原型时的置信度加成 |
| 深度日 | 阴影能量被激活的日子，是成长机会 |
| 勇气邀请 | 每日的成长行动建议，非强制 |

### 9.2 原型一致性矩阵

```
           Hero  Ruler  Sage  Care  Creat Outl  Magi  Lover Jest  Regu  Inno  Expl
Hero        -     +      0     0     0     +     +     0     0     0     -     +
Ruler       +     -      +     +     0     -     +     0     0     +     0     0
Sage        0     +      -     +     +     0     +     0     -     +     0     0
Caregiver   0     +      +     -     0     0     0     +     0     +     +     -
Creator     0     0      +     0     -     +     +     +     +     0     0     +
Outlaw      +     -      0     0     +     -     +     0     +     -     0     +
Magician    +     +      +     0     +     +     -     0     0     0     0     0
Lover       0     0      0     +     +     0     0     -     +     +     +     0
Jester      0     0      -     0     +     +     0     +     -     +     +     +
Regular     0     +      +     +     0     -     0     +     +     -     +     0
Innocent    -     0      0     +     0     0     0     +     +     +     -     0
Explorer    +     0      0     -     +     +     0     0     +     0     0     -

+ = 相近 (similar)
- = 对立 (conflict)
0 = 中性 (neutral)
```

### 9.3 版本历史

| 版本 | 日期 | 主要变更 |
|------|------|----------|
| v3.0 | - | 初版四维模型设计 |
| v3.5 | - | 加入荣格阴影与阿德勒自卑感理论 |
| v4.0 | 2026-01-16 | 心理学应用优化、渐进式阴影发现、深度日重新定位、成长陪伴机制完善 |
| v4.1 | 2026-01-16 | 融合v1/v2精华：双命名系统、问答确认系统、用户体验流程、荣格理论深化、层间一致性分析、个体化成长路径、五行修正 |
| **v5.0** | **2026-01-16** | **核心算法升级：中等深度八字计算（日主强弱+用神喜忌）、五点星盘模型（太阳/月亮/上升/金星/火星）、八字主导融合（70%/30%）、一致性奖励机制、可解释性模块、成长方向建议** |

### 9.4 参考文献

1. Jung, C.G. (1959). *The Archetypes and the Collective Unconscious*
2. Adler, A. (1927). *Understanding Human Nature*
3. Pearson, C.S. (1991). *Awakening the Heroes Within*
4. 岸见一郎 (2013). *被讨厌的勇气*

---

*文档结束 - VibeID 设计文档 v5.0*
