"""
VibeLife V2 Frontend E2E Test - ä¸‰æ å¸ƒå±€æµ‹è¯•
"""
from playwright.sync_api import sync_playwright
import os

SCREENSHOTS_DIR = "/tmp/vibelife_v2_screenshots"
os.makedirs(SCREENSHOTS_DIR, exist_ok=True)

BASE_URL = "http://106.37.170.238:8230"

def main():
    print("=" * 60)
    print("VibeLife V2 Frontend Tests - ä¸‰æ å¸ƒå±€")
    print("=" * 60)

    with sync_playwright() as p:
        # PC æµ‹è¯•
        print("\n=== PC ç«¯æµ‹è¯• (1280x800) ===")
        browser = p.chromium.launch(headless=True)
        pc_context = browser.new_context(viewport={'width': 1280, 'height': 800})
        pc_page = pc_context.new_page()

        # Landing é¡µ
        print("\n[PC] Landing Page...")
        pc_page.goto(f"{BASE_URL}/")
        pc_page.wait_for_load_state('domcontentloaded')
        pc_page.wait_for_timeout(1000)
        pc_page.screenshot(path=f"{SCREENSHOTS_DIR}/pc_01_landing.png")
        print(f"  Title: {pc_page.title()}")

        # Chat é¡µ
        print("\n[PC] Chat Page (ä¸‰æ å¸ƒå±€)...")
        pc_page.goto(f"{BASE_URL}/chat")
        pc_page.wait_for_load_state('domcontentloaded')
        pc_page.wait_for_timeout(1500)
        pc_page.screenshot(path=f"{SCREENSHOTS_DIR}/pc_02_chat.png", full_page=True)

        # æ£€æŸ¥ä¸‰æ å…ƒç´ 
        navbar = pc_page.locator('nav').first
        print(f"  NavBar: {'âœ…' if navbar.count() > 0 else 'âŒ'}")

        # ç‚¹å‡» Chart Tab
        print("\n[PC] Chart Tab...")
        chart_btn = pc_page.locator('button:has-text("å›¾è¡¨")').first
        if chart_btn.count() > 0:
            chart_btn.click()
            pc_page.wait_for_timeout(500)
            pc_page.screenshot(path=f"{SCREENSHOTS_DIR}/pc_03_chart_tab.png", full_page=True)
            print("  âœ… Chart Tab åˆ‡æ¢æˆåŠŸ")
        else:
            print("  âš ï¸ Chart Tab æœªæ‰¾åˆ°")

        # ç‚¹å‡» Journey Tab
        print("\n[PC] Journey Tab...")
        journey_btn = pc_page.locator('button:has-text("å›é¡¾")').first
        if journey_btn.count() > 0:
            journey_btn.click()
            pc_page.wait_for_timeout(500)
            pc_page.screenshot(path=f"{SCREENSHOTS_DIR}/pc_04_journey_tab.png", full_page=True)
            print("  âœ… Journey Tab åˆ‡æ¢æˆåŠŸ")
        else:
            print("  âš ï¸ Journey Tab æœªæ‰¾åˆ°")

        # ç‚¹å‡» Me Tab
        print("\n[PC] Me Tab...")
        me_btn = pc_page.locator('button:has-text("æˆ‘çš„")').first
        if me_btn.count() > 0:
            me_btn.click()
            pc_page.wait_for_timeout(500)
            pc_page.screenshot(path=f"{SCREENSHOTS_DIR}/pc_05_me_tab.png", full_page=True)
            print("  âœ… Me Tab åˆ‡æ¢æˆåŠŸ")
        else:
            print("  âš ï¸ Me Tab æœªæ‰¾åˆ°")

        pc_context.close()

        # Mobile æµ‹è¯•
        print("\n=== Mobile ç«¯æµ‹è¯• (375x812) ===")
        mobile_context = browser.new_context(
            viewport={'width': 375, 'height': 812},
            user_agent='Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X)'
        )
        mobile_page = mobile_context.new_page()

        # Landing é¡µ
        print("\n[Mobile] Landing Page...")
        mobile_page.goto(f"{BASE_URL}/")
        mobile_page.wait_for_load_state('domcontentloaded')
        mobile_page.wait_for_timeout(1000)
        mobile_page.screenshot(path=f"{SCREENSHOTS_DIR}/mobile_01_landing.png")
        print(f"  Title: {mobile_page.title()}")

        # Chat é¡µ
        print("\n[Mobile] Chat Page...")
        mobile_page.goto(f"{BASE_URL}/chat")
        mobile_page.wait_for_load_state('domcontentloaded')
        mobile_page.wait_for_timeout(1500)
        mobile_page.screenshot(path=f"{SCREENSHOTS_DIR}/mobile_02_chat.png")

        # æ£€æŸ¥åº•éƒ¨ TabBar
        tabbar = mobile_page.locator('nav').last
        print(f"  åº•éƒ¨ TabBar: {'âœ…' if tabbar.count() > 0 else 'âŒ'}")

        # ç‚¹å‡»å„ä¸ª Tab
        tabs = ["å›¾è¡¨", "å›é¡¾", "æˆ‘çš„", "å¯¹è¯"]
        for i, tab_name in enumerate(tabs):
            tab_btn = mobile_page.locator(f'button:has-text("{tab_name}")').first
            if tab_btn.count() > 0:
                tab_btn.click()
                mobile_page.wait_for_timeout(300)
                mobile_page.screenshot(path=f"{SCREENSHOTS_DIR}/mobile_0{3+i}_{tab_name}.png")
                print(f"  [Mobile] {tab_name} Tab: âœ…")
            else:
                print(f"  [Mobile] {tab_name} Tab: âš ï¸ æœªæ‰¾åˆ°")

        mobile_context.close()
        browser.close()

    # Summary
    print("\n" + "=" * 60)
    print("æµ‹è¯•å®Œæˆ")
    print("=" * 60)
    print(f"æˆªå›¾ä¿å­˜è‡³: {SCREENSHOTS_DIR}")

    # List screenshots
    screenshots = sorted(os.listdir(SCREENSHOTS_DIR))
    for s in screenshots:
        print(f"  ğŸ“¸ {s}")

if __name__ == "__main__":
    main()
