-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- Skill Catalog Migration
-- Version: 016
-- Description: åˆ›å»º Skill ç›®å½•è¡¨ï¼Œå­˜å‚¨å•†ä¸šå…ƒæ•°æ®ï¼ˆå¯åŠ¨æ€é…ç½®ï¼‰
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 1. Skill ç›®å½•è¡¨
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CREATE TABLE IF NOT EXISTS skill_catalog (
    -- ä¸»é”®
    skill_id VARCHAR(50) PRIMARY KEY,

    -- åŸºç¡€ä¿¡æ¯
    name VARCHAR(100) NOT NULL,
    description TEXT,
    version VARCHAR(20) DEFAULT '1.0.0',

    -- å±•ç¤ºä¿¡æ¯
    icon VARCHAR(10) DEFAULT 'ğŸ’¡',           -- emoji å›¾æ ‡
    color VARCHAR(20) DEFAULT '#6B7280',     -- ä¸»é¢˜è‰² (hex)

    -- åˆ†ç±» (å†³å®šè®¢é˜…è¡Œä¸º)
    category VARCHAR(20) NOT NULL DEFAULT 'professional',  -- core | default | professional

    -- è§¦å‘è¯ (ç”¨äºæ¨èå’Œè·¯ç”±)
    triggers TEXT[] DEFAULT '{}',

    -- å®šä»·ä¿¡æ¯
    pricing JSONB DEFAULT '{
        "type": "premium",
        "trial_messages": 3,
        "credits_per_use": null
    }',

    -- å±•ç¤ºä¿¡æ¯ (Skill å¸‚åœº)
    showcase JSONB DEFAULT '{
        "tagline": "",
        "highlights": [],
        "preview_image": null,
        "demo_prompts": []
    }',

    -- è®¢é˜…æ§åˆ¶
    subscription JSONB DEFAULT '{
        "auto_subscribe": false,
        "can_unsubscribe": true,
        "push_default": true,
        "min_subscription_days": 0
    }',

    -- åŠŸèƒ½åˆ—è¡¨
    features JSONB DEFAULT '[]',

    -- æ’åºæƒé‡ (å±•ç¤ºé¡ºåº)
    sort_order INTEGER DEFAULT 100,

    -- æ˜¯å¦å¯ç”¨
    is_active BOOLEAN DEFAULT true,

    -- æ˜¯å¦ç²¾é€‰
    is_featured BOOLEAN DEFAULT false,
    featured_position INTEGER,
    featured_campaign JSONB,

    -- æ—¶é—´æˆ³
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now(),

    -- çº¦æŸ
    CONSTRAINT chk_category CHECK (category IN ('core', 'default', 'professional'))
);

-- ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_skill_catalog_category ON skill_catalog(category);
CREATE INDEX IF NOT EXISTS idx_skill_catalog_active ON skill_catalog(is_active) WHERE is_active = true;
CREATE INDEX IF NOT EXISTS idx_skill_catalog_featured ON skill_catalog(is_featured, featured_position) WHERE is_featured = true;
CREATE INDEX IF NOT EXISTS idx_skill_catalog_sort ON skill_catalog(sort_order);

-- å…¨æ–‡æœç´¢ç´¢å¼• (åŸºäºè§¦å‘è¯)
CREATE INDEX IF NOT EXISTS idx_skill_catalog_triggers ON skill_catalog USING GIN (triggers);

-- æ³¨é‡Š
COMMENT ON TABLE skill_catalog IS 'Skill ç›®å½•è¡¨ï¼Œå­˜å‚¨å•†ä¸šå…ƒæ•°æ®ï¼ˆåŠ¨æ€é…ç½®ï¼‰';
COMMENT ON COLUMN skill_catalog.category IS 'åˆ†ç±»: core=å§‹ç»ˆæ¿€æ´», default=é»˜è®¤å…è´¹, professional=éœ€è®¢é˜…';
COMMENT ON COLUMN skill_catalog.pricing IS 'å®šä»·: type=free|premium|credits, trial_messages=è¯•ç”¨æ¬¡æ•°';
COMMENT ON COLUMN skill_catalog.showcase IS 'å±•ç¤ºä¿¡æ¯: tagline, highlights, demo_prompts';
COMMENT ON COLUMN skill_catalog.subscription IS 'è®¢é˜…æ§åˆ¶: auto_subscribe, can_unsubscribe, push_default';


-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 2. è§¦å‘å™¨ï¼šæ›´æ–° updated_at
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CREATE OR REPLACE FUNCTION update_skill_catalog_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = now();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trg_skill_catalog_updated ON skill_catalog;
CREATE TRIGGER trg_skill_catalog_updated
    BEFORE UPDATE ON skill_catalog
    FOR EACH ROW
    EXECUTE FUNCTION update_skill_catalog_timestamp();


-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 3. åˆå§‹åŒ– Skill ç›®å½•æ•°æ®
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- Core Skill
INSERT INTO skill_catalog (skill_id, name, description, icon, color, category, triggers, pricing, showcase, subscription, sort_order)
VALUES (
    'core',
    'ç”Ÿå‘½å¯¹è¯è€…',
    'ç”Ÿå‘½å¯¹è¯è€… (Life Dialogue Partner) - VibeLife çš„çµé­‚ã€‚æä¾›æ·±åº¦å€¾å¬ã€æƒ…ç»ªæ„ŸçŸ¥ã€æ¨¡å¼è¯†åˆ«ã€å¼•å¯¼æ¢ç´¢èƒ½åŠ›ã€‚',
    'ğŸ’¬',
    '#6366F1',
    'core',
    ARRAY['èŠå¤©', 'é™ªæˆ‘èŠèŠ', 'èŠä¸€èŠ', 'è¯´è¯´è¯', 'å€¾è¯‰'],
    '{"type": "free", "trial_messages": 0}',
    '{"tagline": "ä½ çš„ç”Ÿå‘½å¯¹è¯è€…ï¼Œæ°¸è¿œåœ¨è¿™é‡Œé™ªä¼´ä½ ", "highlights": ["æ·±åº¦å€¾å¬ä¸å…±æƒ…", "æƒ…ç»ªæ„ŸçŸ¥ä¸è§‰å¯Ÿ", "æ¨¡å¼è¯†åˆ«ä¸å¼•å¯¼"], "demo_prompts": ["æˆ‘æƒ³å’Œä½ èŠèŠ", "æœ€è¿‘æœ‰ç‚¹çƒ¦"]}',
    '{"auto_subscribe": true, "can_unsubscribe": false, "push_default": true}',
    1
) ON CONFLICT (skill_id) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description,
    icon = EXCLUDED.icon,
    color = EXCLUDED.color,
    category = EXCLUDED.category,
    triggers = EXCLUDED.triggers,
    pricing = EXCLUDED.pricing,
    showcase = EXCLUDED.showcase,
    subscription = EXCLUDED.subscription,
    sort_order = EXCLUDED.sort_order,
    updated_at = now();

-- Mindfulness (Default)
INSERT INTO skill_catalog (skill_id, name, description, icon, color, category, triggers, pricing, showcase, subscription, sort_order)
VALUES (
    'mindfulness',
    'æ­£å¿µå¯¼å¸ˆ',
    '3åˆ†é’Ÿå†…è®©ä½ å¹³é™ä¸‹æ¥ï¼Œèåˆ Headspace/Calm äº§å“ç²¾é«“ã€‚',
    'ğŸ§˜',
    '#10B981',
    'default',
    ARRAY['æ­£å¿µ', 'å†¥æƒ³', 'å‘¼å¸', 'æ”¾æ¾', 'ç„¦è™‘', 'ç¡ä¸ç€', 'é™å¿ƒ', 'calm', 'æ·±å‘¼å¸'],
    '{"type": "free", "trial_messages": 0}',
    '{"tagline": "3åˆ†é’Ÿå†…è®©ä½ å¹³é™ä¸‹æ¥", "highlights": ["Headspace äº§å“ç²¾é«“", "æƒ…ç»ªæ€¥æ•‘å·¥å…·", "ç¡å‰æ”¾æ¾å¼•å¯¼"], "demo_prompts": ["æˆ‘æœ‰ç‚¹ç„¦è™‘", "å¸®æˆ‘æ”¾æ¾ä¸€ä¸‹"]}',
    '{"auto_subscribe": true, "can_unsubscribe": true, "push_default": true}',
    10
) ON CONFLICT (skill_id) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description,
    icon = EXCLUDED.icon,
    color = EXCLUDED.color,
    category = EXCLUDED.category,
    triggers = EXCLUDED.triggers,
    pricing = EXCLUDED.pricing,
    showcase = EXCLUDED.showcase,
    subscription = EXCLUDED.subscription,
    sort_order = EXCLUDED.sort_order,
    updated_at = now();

-- Bazi (Professional)
INSERT INTO skill_catalog (skill_id, name, description, icon, color, category, triggers, pricing, showcase, subscription, features, sort_order, is_featured, featured_position)
VALUES (
    'bazi',
    'å…«å­—å‘½ç†',
    'èæ±‡ã€Šæ»´å¤©é«“ã€‹ã€Šç©·é€šå®é‰´ã€‹ã€Šå­å¹³çœŸè¯ ã€‹ã€Šä¸œæ–¹ä»£ç å¯ç¤ºå½•ã€‹å››å¤§ç»å…¸çš„å…«å­—å‘½ç†å¤§å¸ˆã€‚',
    'ğŸ”®',
    '#D4A574',
    'professional',
    ARRAY['å…«å­—', 'å‘½ç†', 'ç”Ÿè¾°', 'æµ‹ç®—', 'ç®—å‘½', 'å‘½ç›˜', 'æ—¥ä¸»', 'å¤§è¿', 'æµå¹´'],
    '{"type": "premium", "trial_messages": 3}',
    '{"tagline": "æ´å¯Ÿå‘½è¿ç„æœºï¼ŒæŠŠæ¡äººç”Ÿæ–¹å‘", "highlights": ["èæ±‡å››å¤§ç»å…¸", "ä¸ªæ€§åŒ–è§£è¯»", "è¿åŠ¿è¶‹åŠ¿åˆ†æ"], "demo_prompts": ["å¸®æˆ‘çœ‹çœ‹å‘½ç›˜", "æˆ‘ä»Šå¹´è¿åŠ¿å¦‚ä½•", "ä»€ä¹ˆæ—¶å€™é€‚åˆè·³æ§½"]}',
    '{"auto_subscribe": false, "can_unsubscribe": true, "push_default": true}',
    '[{"name": "å‘½ç›˜è§£è¯»", "description": "å››æŸ±å…«å­—å®Œæ•´åˆ†æ", "icon": "ğŸ“œ", "tier": "free"}, {"name": "å¤§è¿æµå¹´", "description": "åå¹´å¤§è¿å‘¨æœŸåˆ†æ", "icon": "ğŸ“Š", "tier": "basic"}, {"name": "æ¯æ—¥è¿åŠ¿", "description": "åŸºäºæµæ—¥çš„æ¯æ—¥æŒ‡å¼•", "icon": "ğŸŒŸ", "tier": "premium"}]',
    20,
    true,
    1
) ON CONFLICT (skill_id) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description,
    icon = EXCLUDED.icon,
    color = EXCLUDED.color,
    category = EXCLUDED.category,
    triggers = EXCLUDED.triggers,
    pricing = EXCLUDED.pricing,
    showcase = EXCLUDED.showcase,
    subscription = EXCLUDED.subscription,
    features = EXCLUDED.features,
    sort_order = EXCLUDED.sort_order,
    is_featured = EXCLUDED.is_featured,
    featured_position = EXCLUDED.featured_position,
    updated_at = now();

-- Zodiac (Professional)
INSERT INTO skill_catalog (skill_id, name, description, icon, color, category, triggers, pricing, showcase, subscription, features, sort_order, is_featured, featured_position)
VALUES (
    'zodiac',
    'è¥¿æ–¹å æ˜Ÿ',
    'èæ±‡å¿ƒç†å æ˜Ÿå­¦å››å¤§æµæ´¾çš„å æ˜Ÿåˆ†æå¸ˆï¼šRobert Handã€Sue Tompkinsã€Howard Sasportasã€Stephen Arroyoã€‚',
    'â­',
    '#8B5CF6',
    'professional',
    ARRAY['æ˜Ÿåº§', 'æ˜Ÿç›˜', 'æ’æ˜Ÿç›˜', 'å æ˜Ÿ', 'è¡Œæ˜Ÿ', 'ä¸Šå‡', 'æœˆäº®æ˜Ÿåº§', 'å¤ªé˜³æ˜Ÿåº§', 'æ°´é€†', 'åˆç›˜', 'è¡Œè¿'],
    '{"type": "premium", "trial_messages": 3}',
    '{"tagline": "æ˜Ÿç›˜è§£è¯»ï¼Œæ­ç¤ºå†…åœ¨æ„å›¾", "highlights": ["å¿ƒç†å æ˜Ÿåˆ†æ", "è¡Œè¿è¶‹åŠ¿é¢„æµ‹", "åˆç›˜å…³ç³»è§£è¯»"], "demo_prompts": ["å¸®æˆ‘çœ‹æ˜Ÿç›˜", "æœ€è¿‘è¿åŠ¿å¦‚ä½•", "æˆ‘ä»¬åˆé€‚å—"]}',
    '{"auto_subscribe": false, "can_unsubscribe": true, "push_default": true}',
    '[{"name": "æ˜Ÿç›˜è§£è¯»", "description": "æœ¬å‘½ç›˜å®Œæ•´åˆ†æ", "icon": "ğŸŒŸ", "tier": "free"}, {"name": "è¡Œè¿åˆ†æ", "description": "å½“å‰è¡Œæ˜Ÿè¿åŠ¿", "icon": "ğŸ”„", "tier": "basic"}, {"name": "åˆç›˜é…å¯¹", "description": "å…³ç³»å…¼å®¹æ€§åˆ†æ", "icon": "ğŸ’•", "tier": "premium"}]',
    21,
    true,
    2
) ON CONFLICT (skill_id) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description,
    icon = EXCLUDED.icon,
    color = EXCLUDED.color,
    category = EXCLUDED.category,
    triggers = EXCLUDED.triggers,
    pricing = EXCLUDED.pricing,
    showcase = EXCLUDED.showcase,
    subscription = EXCLUDED.subscription,
    features = EXCLUDED.features,
    sort_order = EXCLUDED.sort_order,
    is_featured = EXCLUDED.is_featured,
    featured_position = EXCLUDED.featured_position,
    updated_at = now();

-- Tarot (Professional)
INSERT INTO skill_catalog (skill_id, name, description, icon, color, category, triggers, pricing, showcase, subscription, features, sort_order, is_featured, featured_position)
VALUES (
    'tarot',
    'å¡”ç½—å åœ',
    'èæ±‡ Rider-Waite-Smith ä¼ ç»Ÿä¸ Jodorowsky é©¬èµ›å¡”ç½—æ™ºæ…§çš„å¡”ç½—è§£è¯»ä¸“å®¶ã€‚',
    'ğŸ´',
    '#EC4899',
    'professional',
    ARRAY['å¡”ç½—', 'ç‰Œé˜µ', 'æŠ½ç‰Œ', 'å åœ', 'å¡”ç½—ç‰Œ'],
    '{"type": "premium", "trial_messages": 3}',
    '{"tagline": "ç…§è§å†…å¿ƒï¼Œè·å–æŒ‡å¼•", "highlights": ["æ¯æ—¥ä¸€ç‰ŒæŒ‡å¼•", "ä¸‰ç‰Œé˜µè§£è¯»", "å‡¯å°”ç‰¹åå­—ç‰Œé˜µ"], "demo_prompts": ["æŠ½ä¸€å¼ ç‰Œ", "å¸®æˆ‘å åœ", "ä¸‰ç‰Œé˜µè§£è¯»"]}',
    '{"auto_subscribe": false, "can_unsubscribe": true, "push_default": true}',
    '[{"name": "å•ç‰ŒæŠ½å–", "description": "æ¯æ—¥æŒ‡å¼•ä¸çµæ„Ÿ", "icon": "ğŸƒ", "tier": "free"}, {"name": "ä¸‰ç‰Œé˜µ", "description": "è¿‡å»-ç°åœ¨-æœªæ¥", "icon": "ğŸ“‹", "tier": "basic"}, {"name": "å‡¯å°”ç‰¹åå­—", "description": "æ·±åº¦å…¨é¢åˆ†æ", "icon": "ğŸ¯", "tier": "premium"}]',
    22,
    true,
    3
) ON CONFLICT (skill_id) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description,
    icon = EXCLUDED.icon,
    color = EXCLUDED.color,
    category = EXCLUDED.category,
    triggers = EXCLUDED.triggers,
    pricing = EXCLUDED.pricing,
    showcase = EXCLUDED.showcase,
    subscription = EXCLUDED.subscription,
    features = EXCLUDED.features,
    sort_order = EXCLUDED.sort_order,
    is_featured = EXCLUDED.is_featured,
    featured_position = EXCLUDED.featured_position,
    updated_at = now();

-- Jungastro (Professional)
INSERT INTO skill_catalog (skill_id, name, description, icon, color, category, triggers, pricing, showcase, subscription, sort_order)
VALUES (
    'jungastro',
    'è£æ ¼å¿ƒç†å æ˜Ÿ',
    'åŸºäº Carl Jung åˆ†æå¿ƒç†å­¦æ¡†æ¶ï¼Œå°†å æ˜Ÿä½œä¸ºå¿ƒç†è‡ªæˆ‘è®¤çŸ¥å·¥å…·ã€‚',
    'ğŸ§ ',
    '#F59E0B',
    'professional',
    ARRAY['è£æ ¼', 'è£æ ¼å æ˜Ÿ', 'å¿ƒç†å æ˜Ÿ', 'å¿ƒç†åˆ†æ', 'é˜´å½±æ•´åˆ', 'ä¸ªä½“åŒ–', 'åŸå‹åˆ†æ', 'æ·±å±‚å¿ƒç†'],
    '{"type": "premium", "trial_messages": 3}',
    '{"tagline": "æ·±å±‚å¿ƒç†è§‰å¯Ÿï¼Œèµ°å‘ä¸ªä½“åŒ–", "highlights": ["è£æ ¼åŸå‹åˆ†æ", "é˜´å½±æ•´åˆå·¥ä½œ", "ä¸ªä½“åŒ–è·¯å¾„"], "demo_prompts": ["åˆ†ææˆ‘çš„å¿ƒç†æ¨¡å¼", "æˆ‘çš„é˜´å½±æ˜¯ä»€ä¹ˆ"]}',
    '{"auto_subscribe": false, "can_unsubscribe": true, "push_default": true}',
    23
) ON CONFLICT (skill_id) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description,
    icon = EXCLUDED.icon,
    color = EXCLUDED.color,
    category = EXCLUDED.category,
    triggers = EXCLUDED.triggers,
    pricing = EXCLUDED.pricing,
    showcase = EXCLUDED.showcase,
    subscription = EXCLUDED.subscription,
    sort_order = EXCLUDED.sort_order,
    updated_at = now();

-- Career (Professional)
INSERT INTO skill_catalog (skill_id, name, description, icon, color, category, triggers, pricing, showcase, subscription, sort_order)
VALUES (
    'career',
    'èŒä¸šè§„åˆ’',
    'èåˆ MBTIã€ä¹å‹äººæ ¼ã€ç›–æ´›æ™®ä¼˜åŠ¿ç­‰å¤šå…ƒç†è®ºçš„èŒä¸šå‘å±•ä¸“å®¶ã€‚',
    'ğŸ’¼',
    '#3B82F6',
    'professional',
    ARRAY['èŒä¸š', 'å·¥ä½œ', 'è·³æ§½', 'å‡èŒ', 'åˆ›ä¸š', 'é€‚åˆä»€ä¹ˆ', 'èŒä¸šè§„åˆ’'],
    '{"type": "premium", "trial_messages": 3}',
    '{"tagline": "å‘ç°å¤©èµ‹ï¼Œè§„åˆ’èŒä¸š", "highlights": ["MBTI æ€§æ ¼åˆ†æ", "ç›–æ´›æ™®ä¼˜åŠ¿è¯†åˆ«", "èŒä¸šè½¬å‹æŒ‡å¯¼"], "demo_prompts": ["æˆ‘é€‚åˆä»€ä¹ˆå·¥ä½œ", "è¦ä¸è¦è·³æ§½", "å¦‚ä½•æå‡èŒåœºç«äº‰åŠ›"]}',
    '{"auto_subscribe": false, "can_unsubscribe": true, "push_default": true}',
    24
) ON CONFLICT (skill_id) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description,
    icon = EXCLUDED.icon,
    color = EXCLUDED.color,
    category = EXCLUDED.category,
    triggers = EXCLUDED.triggers,
    pricing = EXCLUDED.pricing,
    showcase = EXCLUDED.showcase,
    subscription = EXCLUDED.subscription,
    sort_order = EXCLUDED.sort_order,
    updated_at = now();

-- VibeID (Professional)
INSERT INTO skill_catalog (skill_id, name, description, icon, color, category, triggers, pricing, showcase, subscription, sort_order)
VALUES (
    'vibe_id',
    'VibeID äººæ ¼ç”»åƒ',
    'èåˆå…«å­—å‘½ç†ä¸è¥¿æ–¹å æ˜Ÿçš„å››ç»´äººæ ¼åˆ†æç³»ç»Ÿã€‚',
    'ğŸ­',
    '#14B8A6',
    'professional',
    ARRAY['äººæ ¼ç”»åƒ', 'VibeID', 'æˆ‘çš„åŸå‹', 'æ€§æ ¼åˆ†æ', 'å››ç»´åŸå‹'],
    '{"type": "premium", "trial_messages": 3}',
    '{"tagline": "å‘ç°ä½ çš„å››ç»´äººæ ¼åŸå‹", "highlights": ["ä¸œè¥¿æ–¹èåˆåˆ†æ", "12åŸå‹ä½“ç³»", "å››ç»´äººæ ¼ç”»åƒ"], "demo_prompts": ["åˆ†ææˆ‘çš„æ€§æ ¼", "æˆ‘æ˜¯ä»€ä¹ˆåŸå‹"]}',
    '{"auto_subscribe": false, "can_unsubscribe": true, "push_default": true}',
    25
) ON CONFLICT (skill_id) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description,
    icon = EXCLUDED.icon,
    color = EXCLUDED.color,
    category = EXCLUDED.category,
    triggers = EXCLUDED.triggers,
    pricing = EXCLUDED.pricing,
    showcase = EXCLUDED.showcase,
    subscription = EXCLUDED.subscription,
    sort_order = EXCLUDED.sort_order,
    updated_at = now();


-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 4. è§†å›¾ï¼šæ´»è·ƒ Skill åˆ—è¡¨ (å¸¦åˆ†ç±»ç»Ÿè®¡)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CREATE OR REPLACE VIEW v_active_skills AS
SELECT
    skill_id,
    name,
    description,
    icon,
    color,
    category,
    triggers,
    pricing,
    showcase,
    subscription,
    features,
    sort_order,
    is_featured,
    featured_position,
    featured_campaign
FROM skill_catalog
WHERE is_active = true
ORDER BY sort_order, skill_id;

COMMENT ON VIEW v_active_skills IS 'æ´»è·ƒ Skill åˆ—è¡¨è§†å›¾';


-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 5. è§†å›¾ï¼šç²¾é€‰ Skill åˆ—è¡¨
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CREATE OR REPLACE VIEW v_featured_skills AS
SELECT
    skill_id,
    name,
    icon,
    color,
    showcase->>'tagline' AS tagline,
    showcase->>'preview_image' AS preview_image,
    featured_position,
    featured_campaign
FROM skill_catalog
WHERE is_active = true AND is_featured = true
ORDER BY featured_position NULLS LAST, skill_id;

COMMENT ON VIEW v_featured_skills IS 'ç²¾é€‰ Skill åˆ—è¡¨è§†å›¾';


-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- å®Œæˆ
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DO $$
BEGIN
    RAISE NOTICE 'Migration 016: Skill Catalog table created successfully';
    RAISE NOTICE 'Initial data: 8 skills (core, mindfulness, bazi, zodiac, tarot, jungastro, career, vibe_id)';
END $$;
