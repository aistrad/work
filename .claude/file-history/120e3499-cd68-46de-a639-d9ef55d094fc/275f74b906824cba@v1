---
id: ingestion
name: 知识入库
impact: CRITICAL
impactDescription: 知识库的基础，影响后续所有抽取质量
tags: 入库, 格式转换, 切块, 向量化, embedding
---

# 知识入库规则

## 适用场景

用户需要将原始文档（PDF/EPUB/DOCX）转换并入库到知识库。

典型请求：
- "帮我入库这些八字书籍"
- "把这个 PDF 转换入库"
- "建立 zodiac 的知识库"

## 分析要点

| 步骤 | 执行要点 | 命令/操作 | 优先级 |
|-----|---------|----------|-------|
| 1 | 确认 skill_id 和源文件路径 | 询问用户 | 必须 |
| 2 | 检查源文件存在 | `ls /data/vibelife/knowledge/{skill_id}/source/` | 必须 |
| 3 | 执行格式转换 (Stage 0) | `python scripts/build_knowledge.py --skill {skill} --stages 0` | 必须 |
| 4 | 执行切块入库 (Stage 1-3) | `python scripts/build_knowledge.py --skill {skill} --stages 1-3` | 必须 |
| 5 | 查看入库结果 | 检查 knowledge_chunks 表记录数 | 必须 |

## 输出要求

1. **必须执行**：
   - 格式转换脚本
   - 切块入库脚本
   - 结果验证

2. **内容要求**：
   - 报告转换文件数量
   - 报告入库 chunks 数量
   - 报告任何错误或警告

3. **引导方向**：
   - 入库完成后询问是否进行 Case 抽取
   - 或进行 Rule 抽取

## 参数配置

```yaml
chunking:
  max_tokens: 2000
  min_tokens: 200
  overlap: 50

embedding:
  model: BAAI/bge-m3
  dimension: 1024

database:
  table: knowledge_chunks
```

## 常见问题

### PDF 转换失败
检查 PDF 是否为扫描版，如是则需要先 OCR 处理。

### 切块过小或过大
调整 max_tokens 和 min_tokens 参数。

### 向量化失败
检查 embedding 服务是否正常运行。
