'use client';

/**
 * SkillCard - Skill å±•ç¤ºå¡ç‰‡ç»„ä»¶
 *
 * æ”¯æŒ 4 ç§å˜ä½“ï¼š
 * - compact: åˆ—è¡¨é¡¹ï¼Œé«˜åº¦ 64px
 * - card: ç½‘æ ¼å¡ç‰‡ï¼Œç”¨äºå¸‚åœºå±•ç¤º
 * - detail: è¯¦æƒ…é¡µ Hero åŒºåŸŸ
 * - inline: å¯¹è¯å†…åµŒæ¨è
 */

import React from 'react';
import { X } from 'lucide-react';
import { cn } from '@/lib/utils';
import type { SkillCardProps, SkillCategory } from '@/types/skill';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// è¾…åŠ©ç»„ä»¶
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function CategoryBadge({ category }: { category: SkillCategory }) {
  const config = {
    core: { label: 'æ ¸å¿ƒ', bg: 'bg-indigo-100', text: 'text-indigo-700' },
    default: { label: 'åŸºç¡€', bg: 'bg-green-100', text: 'text-green-700' },
    professional: { label: 'ä¸“ä¸š', bg: 'bg-amber-100', text: 'text-amber-700' },
  };
  const c = config[category];
  return (
    <span className={cn('px-2 py-0.5 text-xs rounded-full', c.bg, c.text)}>
      {c.label}
    </span>
  );
}

function StatusBadge({
  subscribed,
  category
}: {
  subscribed?: boolean;
  category: SkillCategory
}) {
  if (category === 'core') {
    return (
      <span className="px-2 py-0.5 text-xs rounded-full bg-indigo-100 text-indigo-700">
        å§‹ç»ˆæ¿€æ´»
      </span>
    );
  }
  if (subscribed) {
    return (
      <span className="px-2 py-0.5 text-xs rounded-full bg-green-100 text-green-700">
        å·²è®¢é˜…
      </span>
    );
  }
  return null;
}

function TrialBadge({ remaining }: { remaining?: number }) {
  if (!remaining || remaining <= 0) return null;
  return (
    <span className="text-xs text-text-secondary">
      {remaining} æ¬¡å…è´¹ä½“éªŒ
    </span>
  );
}

function PushToggle({
  enabled,
  onChange
}: {
  enabled: boolean;
  onChange?: (enabled: boolean) => void
}) {
  return (
    <button
      onClick={(e) => {
        e.stopPropagation();
        onChange?.(!enabled);
      }}
      className={cn(
        'relative w-10 h-5 rounded-full transition-colors',
        enabled ? 'bg-accent' : 'bg-gray-300'
      )}
    >
      <span
        className={cn(
          'absolute top-0.5 w-4 h-4 rounded-full bg-white shadow transition-transform',
          enabled ? 'translate-x-5' : 'translate-x-0.5'
        )}
      />
    </button>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Compact å˜ä½“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function CompactCard({
  skill,
  userStatus,
  onSubscribe,
  onClick,
}: SkillCardProps) {
  return (
    <div
      onClick={onClick}
      className="flex items-center gap-3 p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-colors cursor-pointer"
    >
      {/* Icon */}
      <div
        className="w-10 h-10 rounded-xl flex items-center justify-center text-xl shrink-0"
        style={{ backgroundColor: `${skill.color}20` }}
      >
        {skill.icon}
      </div>

      {/* Content */}
      <div className="flex-1 min-w-0">
        <h4 className="text-sm font-medium text-text-primary truncate">
          {skill.name}
        </h4>
        <p className="text-xs text-text-secondary truncate">
          {skill.description}
        </p>
      </div>

      {/* Status / Action */}
      {userStatus?.subscribed ? (
        <StatusBadge subscribed category={skill.category} />
      ) : skill.category === 'core' ? (
        <StatusBadge subscribed={false} category="core" />
      ) : (
        <button
          onClick={(e) => {
            e.stopPropagation();
            onSubscribe?.();
          }}
          className="px-3 py-1 text-xs rounded-full bg-accent text-white hover:bg-accent/90 transition-colors"
        >
          è®¢é˜…
        </button>
      )}
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Card å˜ä½“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function CardVariant({
  skill,
  userStatus,
  onSubscribe,
  onTogglePush,
  onLearnMore,
  onTry,
  onClick,
}: SkillCardProps) {
  return (
    <div
      onClick={onClick}
      className="rounded-xl bg-white/5 border border-white/10 overflow-hidden hover:border-white/20 transition-all cursor-pointer"
    >
      {/* Header */}
      <div
        className="p-4 pb-3"
        style={{ background: `linear-gradient(135deg, ${skill.color}15, ${skill.color}05)` }}
      >
        <div className="flex items-start justify-between">
          <div className="flex items-center gap-3">
            <div
              className="w-12 h-12 rounded-xl flex items-center justify-center text-2xl"
              style={{ backgroundColor: `${skill.color}25` }}
            >
              {skill.icon}
            </div>
            <div>
              <h3 className="font-semibold text-text-primary">{skill.name}</h3>
              <p className="text-xs text-text-secondary line-clamp-1">
                {skill.showcase?.tagline || skill.description}
              </p>
            </div>
          </div>
          <StatusBadge subscribed={userStatus?.subscribed} category={skill.category} />
        </div>
      </div>

      {/* Features */}
      <div className="px-4 py-3 border-t border-white/5">
        <div className="flex flex-wrap gap-2">
          {skill.features.slice(0, 3).map((feature) => (
            <span
              key={feature.name}
              className="px-2 py-0.5 text-xs rounded-full bg-white/5 text-text-secondary"
            >
              {feature.icon || 'ğŸ“Œ'} {feature.name}
            </span>
          ))}
        </div>
      </div>

      {/* Actions */}
      <div className="px-4 py-3 border-t border-white/5 flex items-center justify-between">
        {userStatus?.subscribed ? (
          <>
            <div className="flex items-center gap-2">
              <span className="text-xs text-text-tertiary">æ¨é€</span>
              <PushToggle enabled={userStatus.push_enabled} onChange={onTogglePush} />
            </div>
            <button
              onClick={(e) => {
                e.stopPropagation();
                onLearnMore?.();
              }}
              className="text-sm text-accent hover:underline"
            >
              æŸ¥çœ‹è¯¦æƒ…
            </button>
          </>
        ) : skill.category !== 'core' ? (
          <>
            <TrialBadge remaining={userStatus?.trial_messages_remaining ?? skill.pricing.trial_messages} />
            <button
              onClick={(e) => {
                e.stopPropagation();
                onTry?.();
              }}
              className="px-4 py-1.5 text-sm rounded-lg bg-accent text-white hover:bg-accent/90 transition-colors"
            >
              ç«‹å³è¯•ç”¨
            </button>
          </>
        ) : (
          <span className="text-xs text-text-tertiary">å§‹ç»ˆå¯ç”¨</span>
        )}
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Detail å˜ä½“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function DetailCard({
  skill,
  userStatus,
  onSubscribe,
  onUnsubscribe,
  onTogglePush,
}: SkillCardProps) {
  return (
    <div className="relative overflow-hidden rounded-2xl">
      {/* Background */}
      <div
        className="absolute inset-0"
        style={{
          background: `linear-gradient(135deg, ${skill.color}30, ${skill.color}10)`,
        }}
      />

      {/* Content */}
      <div className="relative p-6 md:p-8">
        <div className="flex flex-col md:flex-row md:items-center gap-6">
          {/* Icon */}
          <div
            className="w-20 h-20 rounded-2xl flex items-center justify-center text-4xl shrink-0"
            style={{ backgroundColor: `${skill.color}25` }}
          >
            {skill.icon}
          </div>

          {/* Info */}
          <div className="flex-1">
            <div className="flex items-center gap-2 mb-2">
              <h1 className="text-2xl font-bold text-text-primary">{skill.name}</h1>
              <CategoryBadge category={skill.category} />
            </div>
            <p className="text-text-secondary mb-4">{skill.description}</p>

            {/* Highlights */}
            <div className="flex flex-wrap gap-2">
              {skill.showcase?.highlights?.map((highlight) => (
                <span
                  key={highlight}
                  className="px-3 py-1 text-sm rounded-full bg-white/20 text-text-primary"
                >
                  {highlight}
                </span>
              ))}
            </div>
          </div>

          {/* Action */}
          <div className="shrink-0 flex flex-col gap-2">
            {userStatus?.subscribed ? (
              <>
                <div className="flex items-center gap-3 p-3 rounded-lg bg-white/10">
                  <span className="text-sm text-text-secondary">æ¨é€é€šçŸ¥</span>
                  <PushToggle enabled={userStatus.push_enabled} onChange={onTogglePush} />
                </div>
                {skill.category !== 'core' && (
                  <button
                    onClick={onUnsubscribe}
                    className="text-sm text-red-400 hover:text-red-300"
                  >
                    å–æ¶ˆè®¢é˜…
                  </button>
                )}
              </>
            ) : skill.category !== 'core' ? (
              <button
                onClick={onSubscribe}
                className="px-6 py-3 text-lg rounded-xl bg-accent text-white hover:bg-accent/90 transition-colors"
              >
                ç«‹å³è®¢é˜…
              </button>
            ) : null}
          </div>
        </div>
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Inline å˜ä½“ï¼ˆå¯¹è¯å†…æ¨èï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function InlineCard({
  skill,
  context,
  onTry,
  onLearnMore,
  onDismiss,
}: SkillCardProps) {
  return (
    <div className="my-3 p-4 rounded-xl bg-white/5 border border-white/10">
      <div className="flex items-start gap-3">
        {/* Icon */}
        <div
          className="w-10 h-10 rounded-xl flex items-center justify-center text-xl shrink-0"
          style={{ backgroundColor: `${skill.color}20` }}
        >
          {skill.icon}
        </div>

        {/* Content */}
        <div className="flex-1 min-w-0">
          <div className="flex items-center gap-2 mb-1">
            <span className="text-xs text-accent font-medium">å‘ç°ç›¸å…³èƒ½åŠ›</span>
          </div>
          <h4 className="font-medium text-text-primary">{skill.name}</h4>
          <p className="text-sm text-text-secondary mt-1">
            {context || skill.showcase?.tagline || skill.description}
          </p>

          {/* Actions */}
          <div className="flex items-center gap-2 mt-3">
            <button
              onClick={onTry}
              className="px-3 py-1.5 text-sm rounded-lg bg-accent text-white hover:bg-accent/90 transition-colors"
            >
              ç«‹å³è¯•ç”¨
            </button>
            <button
              onClick={onLearnMore}
              className="px-3 py-1.5 text-sm rounded-lg border border-white/20 text-text-secondary hover:bg-white/5 transition-colors"
            >
              äº†è§£æ›´å¤š
            </button>
          </div>
        </div>

        {/* Dismiss */}
        {onDismiss && (
          <button
            onClick={onDismiss}
            className="text-text-tertiary hover:text-text-secondary"
          >
            <X className="w-4 h-4" />
          </button>
        )}
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ä¸»ç»„ä»¶
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export function SkillCard(props: SkillCardProps) {
  const { variant = 'card' } = props;

  switch (variant) {
    case 'compact':
      return <CompactCard {...props} />;
    case 'card':
      return <CardVariant {...props} />;
    case 'detail':
      return <DetailCard {...props} />;
    case 'inline':
      return <InlineCard {...props} />;
    default:
      return <CardVariant {...props} />;
  }
}

export default SkillCard;
