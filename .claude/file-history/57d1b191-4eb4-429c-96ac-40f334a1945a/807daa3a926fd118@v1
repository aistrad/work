/**
 * A2UI Card Types for Vercel AI SDK Tool Results
 *
 * These types define the structure of tool results that render as rich UI cards.
 * The frontend parses `toolInvocations[].result` and renders appropriate components.
 */

// Base card type
export interface A2UICard {
  type: 'a2ui_card';
  card_type: string;
  data: Record<string, unknown>;
  actions?: ActionButton[];
}

// Action button for cards
export interface ActionButton {
  label: string;
  action: string;
  params?: Record<string, unknown>;
  // Constraints: action must be a known frontend handler
  // e.g., 'navigate', 'share', 'copy', 'api_call'
}

// Bazi (八字) card types
export interface BaziCard extends A2UICard {
  card_type: 'bazi_pan';
  data: {
    birth_datetime: string;
    solar_date: string;
    lunar_date: string;
    four_pillars: {
      year: { gan: string; zhi: string };
      month: { gan: string; zhi: string };
      day: { gan: string; zhi: string };
      hour: { gan: string; zhi: string };
    };
    wu_xing_summary: Record<string, number>;
    day_master: string;
    day_master_strength: 'strong' | 'weak' | 'balanced';
  };
}

// Tieban (铁板) result card
export interface TiebanCard extends A2UICard {
  card_type: 'tieban_result';
  data: {
    question: string;
    gua_number: number;
    gua_name: string;
    interpretation: string;
    advice: string;
  };
}

// PERMA mood check-in card
export interface PermaCard extends A2UICard {
  card_type: 'perma_checkin';
  data: {
    timestamp: string;
    dimensions: {
      P: number; // Positive Emotions
      E: number; // Engagement
      R: number; // Relationships
      M: number; // Meaning
      A: number; // Accomplishment
    };
    overall_score: number;
    trend?: 'up' | 'down' | 'stable';
  };
}

// Goal/Commitment card
export interface GoalCard extends A2UICard {
  card_type: 'goal_created' | 'task_completed';
  data: {
    goal_id: string;
    title: string;
    description?: string;
    status: 'active' | 'completed' | 'abandoned';
    progress?: number;
    due_date?: string;
  };
}

// Yunshi (运势) daily fortune card
export interface YunshiCard extends A2UICard {
  card_type: 'yunshi_daily';
  data: {
    date: string;
    overall_score: number;
    aspects: {
      career: number;
      wealth: number;
      love: number;
      health: number;
    };
    lucky_elements: {
      color: string;
      number: number;
      direction: string;
    };
    advice: string;
  };
}

// Union type for all card types
export type ToolResultCard =
  | BaziCard
  | TiebanCard
  | PermaCard
  | GoalCard
  | YunshiCard
  | A2UICard; // Generic fallback

// Type guard functions
export function isA2UICard(result: unknown): result is A2UICard {
  return (
    typeof result === 'object' &&
    result !== null &&
    'type' in result &&
    (result as A2UICard).type === 'a2ui_card'
  );
}

export function isBaziCard(card: A2UICard): card is BaziCard {
  return card.card_type === 'bazi_pan';
}

export function isPermaCard(card: A2UICard): card is PermaCard {
  return card.card_type === 'perma_checkin';
}

export function isGoalCard(card: A2UICard): card is GoalCard {
  return card.card_type === 'goal_created' || card.card_type === 'task_completed';
}
