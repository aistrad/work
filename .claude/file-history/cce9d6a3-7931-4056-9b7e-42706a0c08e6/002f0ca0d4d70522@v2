"use client";

import { useState } from "react";
import { cn } from "@/lib/utils";
import type { LifecoachData } from "@/types/dashboard";
import { LifecoachCard } from "@/components/dashboard/lifecoach/LifecoachCard";
import { ChevronDown, ChevronUp } from "lucide-react";

interface LifecoachQuickViewProps {
  data: LifecoachData;
  onToggleLever: (leverId: string) => Promise<void>;
  onToggleRock: (rockId: string) => Promise<void>;
  onClickNorthStar?: () => void;
  className?: string;
}

/**
 * LifecoachQuickView - Chat ç©ºçŠ¶æ€ä¸­çš„ Lifecoach å¡ç‰‡
 *
 * ä¸¤ç§çŠ¶æ€ï¼š
 * - æŠ˜å ï¼šæ˜¾ç¤ºå…³é”®æŒ‡æ ‡æ‘˜è¦
 * - å±•å¼€ï¼šæ˜¾ç¤ºå®Œæ•´ LifecoachCard
 */
export function LifecoachQuickView({
  data,
  onToggleLever,
  onToggleRock,
  onClickNorthStar,
  className,
}: LifecoachQuickViewProps) {
  const [isExpanded, setIsExpanded] = useState(false);

  const completedLevers = data.todayLevers.filter((l) => l.completed).length;
  const completedRocks = data.weekRocks.filter((r) => r.completed).length;
  const monthlyProgress = data.monthlyProject?.progress || 0;

  // å±•å¼€çŠ¶æ€ï¼šæ˜¾ç¤ºå®Œæ•´å¡ç‰‡
  if (isExpanded) {
    return (
      <div className={cn("relative", className)}>
        <button
          onClick={() => setIsExpanded(false)}
          className="absolute top-4 right-4 z-10 p-1.5 rounded-lg hover:bg-gray-100 transition-colors"
          aria-label="æ”¶èµ·"
        >
          <ChevronUp className="w-5 h-5" style={{ color: 'var(--text-tertiary)' }} />
        </button>
        <LifecoachCard
          data={data}
          onToggleLever={onToggleLever}
          onToggleRock={onToggleRock}
          onClickNorthStar={onClickNorthStar}
        />
      </div>
    );
  }

  // æŠ˜å çŠ¶æ€ï¼šæ˜¾ç¤ºæ‘˜è¦
  return (
    <button
      onClick={() => setIsExpanded(true)}
      className={cn(
        "w-full text-left p-4 rounded-lg transition-all hover:shadow-md",
        className
      )}
      style={{
        background: 'var(--bg-card)',
        border: '1px solid var(--border-subtle)',
      }}
    >
      <div className="flex items-center justify-between">
        {/* å·¦ä¾§ï¼šå›¾æ ‡å’Œæ ‡é¢˜ */}
        <div className="flex items-center gap-2">
          <span className="text-xl">ğŸ§­</span>
          <span className="text-sm font-semibold" style={{ color: 'var(--text-primary)' }}>
            LIFECOACH
          </span>
        </div>

        {/* å³ä¾§ï¼šå±•å¼€å›¾æ ‡ */}
        <ChevronDown className="w-5 h-5" style={{ color: 'var(--text-tertiary)' }} />
      </div>

      {/* å…³é”®æŒ‡æ ‡æ‘˜è¦ */}
      <div className="mt-3 flex flex-wrap items-center gap-x-4 gap-y-2 text-sm">
        {/* åŒ—ææ˜Ÿ */}
        {data.northStar && (
          <div className="flex items-center gap-1.5">
            <span>â­</span>
            <span style={{ color: 'var(--text-secondary)' }} className="truncate max-w-[200px]">
              {data.northStar}
            </span>
          </div>
        )}

        {/* æœˆåº¦è¿›åº¦ */}
        {data.monthlyProject && (
          <div className="flex items-center gap-1.5">
            <span>ğŸ“Š</span>
            <span style={{ color: 'var(--text-secondary)' }}>
              æœˆåº¦ {monthlyProgress}%
            </span>
          </div>
        )}

        {/* ä»Šæ—¥æ æ† */}
        <div className="flex items-center gap-1.5">
          <span>â˜€ï¸</span>
          <span style={{ color: 'var(--text-secondary)' }}>
            æ æ† {completedLevers}/{data.todayLevers.length}
          </span>
        </div>

        {/* æœ¬å‘¨å¤§çŸ³å¤´ */}
        <div className="flex items-center gap-1.5">
          <span>ğŸ“…</span>
          <span style={{ color: 'var(--text-secondary)' }}>
            å¤§çŸ³å¤´ {completedRocks}/{data.weekRocks.length}
          </span>
        </div>
      </div>
    </button>
  );
}
