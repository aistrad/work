"use client";

import { InputHTMLAttributes, SelectHTMLAttributes, TextareaHTMLAttributes, forwardRef } from "react";
import { cn } from "@/lib/utils";

// ═══════════════════════════════════════════════════════════════════════════
// Input - LUMINOUS PAPER Design System
// Vibe Capsule 输入样式
// ═══════════════════════════════════════════════════════════════════════════

export interface InputProps extends InputHTMLAttributes<HTMLInputElement> {
  label?: string;
  error?: string;
  variant?: "default" | "capsule";
}

export const Input = forwardRef<HTMLInputElement, InputProps>(
  ({ className, label, error, type = "text", variant = "default", ...props }, ref) => {
    return (
      <div className="w-full">
        {label && (
          <label className="label">{label}</label>
        )}
        <input
          ref={ref}
          type={type}
          className={cn(
            variant === "default" && "input",
            variant === "capsule" && "input-capsule",
            error && "border-red-500 focus:ring-red-500",
            className
          )}
          {...props}
        />
        {error && (
          <p className="mt-1.5 text-sm text-red-500">{error}</p>
        )}
      </div>
    );
  }
);

Input.displayName = "Input";

// ═══════════════════════════════════════════════════════════════════════════
// Select - Dropdown select with custom styling
// ═══════════════════════════════════════════════════════════════════════════

export interface SelectProps extends SelectHTMLAttributes<HTMLSelectElement> {
  label?: string;
  error?: string;
  options: Array<{ value: string; label: string }>;
  placeholder?: string;
}

export const Select = forwardRef<HTMLSelectElement, SelectProps>(
  ({ className, label, error, options, placeholder, ...props }, ref) => {
    return (
      <div className="w-full">
        {label && (
          <label className="label">{label}</label>
        )}
        <select
          ref={ref}
          className={cn(
            "select",
            error && "border-red-500 focus:ring-red-500",
            className
          )}
          {...props}
        >
          {placeholder && (
            <option value="" disabled>
              {placeholder}
            </option>
          )}
          {options.map((option) => (
            <option key={option.value} value={option.value}>
              {option.label}
            </option>
          ))}
        </select>
        {error && (
          <p className="mt-1.5 text-sm text-red-500">{error}</p>
        )}
      </div>
    );
  }
);

Select.displayName = "Select";

// ═══════════════════════════════════════════════════════════════════════════
// Textarea - Multi-line input
// ═══════════════════════════════════════════════════════════════════════════

export interface TextareaProps extends TextareaHTMLAttributes<HTMLTextAreaElement> {
  label?: string;
  error?: string;
}

export const Textarea = forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, label, error, ...props }, ref) => {
    return (
      <div className="w-full">
        {label && (
          <label className="label">{label}</label>
        )}
        <textarea
          ref={ref}
          className={cn(
            "input min-h-[100px] resize-y",
            error && "border-red-500 focus:ring-red-500",
            className
          )}
          {...props}
        />
        {error && (
          <p className="mt-1.5 text-sm text-red-500">{error}</p>
        )}
      </div>
    );
  }
);

Textarea.displayName = "Textarea";

// ═══════════════════════════════════════════════════════════════════════════
// BirthDateInputs - Special inputs for birth date selection
// ═══════════════════════════════════════════════════════════════════════════

interface BirthDateInputsProps {
  year: string;
  month: string;
  day: string;
  hour?: string;
  onYearChange: (value: string) => void;
  onMonthChange: (value: string) => void;
  onDayChange: (value: string) => void;
  onHourChange?: (value: string) => void;
  showHour?: boolean;
  className?: string;
}

const years = Array.from({ length: 100 }, (_, i) => ({
  value: String(2024 - i),
  label: `${2024 - i}年`,
}));

const months = Array.from({ length: 12 }, (_, i) => ({
  value: String(i + 1).padStart(2, "0"),
  label: `${i + 1}月`,
}));

const days = Array.from({ length: 31 }, (_, i) => ({
  value: String(i + 1).padStart(2, "0"),
  label: `${i + 1}日`,
}));

const hours = [
  { value: "unknown", label: "不确定" },
  { value: "23-01", label: "子时 (23:00-01:00)" },
  { value: "01-03", label: "丑时 (01:00-03:00)" },
  { value: "03-05", label: "寅时 (03:00-05:00)" },
  { value: "05-07", label: "卯时 (05:00-07:00)" },
  { value: "07-09", label: "辰时 (07:00-09:00)" },
  { value: "09-11", label: "巳时 (09:00-11:00)" },
  { value: "11-13", label: "午时 (11:00-13:00)" },
  { value: "13-15", label: "未时 (13:00-15:00)" },
  { value: "15-17", label: "申时 (15:00-17:00)" },
  { value: "17-19", label: "酉时 (17:00-19:00)" },
  { value: "19-21", label: "戌时 (19:00-21:00)" },
  { value: "21-23", label: "亥时 (21:00-23:00)" },
];

export function BirthDateInputs({
  year,
  month,
  day,
  hour,
  onYearChange,
  onMonthChange,
  onDayChange,
  onHourChange,
  showHour = true,
  className,
}: BirthDateInputsProps) {
  return (
    <div className={cn("grid gap-3", showHour ? "grid-cols-4" : "grid-cols-3", className)}>
      <Select
        value={year}
        onChange={(e) => onYearChange(e.target.value)}
        options={years}
        placeholder="年份"
      />
      <Select
        value={month}
        onChange={(e) => onMonthChange(e.target.value)}
        options={months}
        placeholder="月份"
      />
      <Select
        value={day}
        onChange={(e) => onDayChange(e.target.value)}
        options={days}
        placeholder="日期"
      />
      {showHour && onHourChange && (
        <Select
          value={hour || "unknown"}
          onChange={(e) => onHourChange(e.target.value)}
          options={hours}
          placeholder="时辰"
        />
      )}
    </div>
  );
}
