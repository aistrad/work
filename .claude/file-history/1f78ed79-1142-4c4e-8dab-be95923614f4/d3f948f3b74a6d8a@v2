"use client";

import { cn } from "@/lib/utils";
import { type SkillType } from "./LuminousPaper";

// ═══════════════════════════════════════════════════════════════════════════
// InsightSeal - LUMINOUS PAPER Design System
// 个人化印章：基于八字/星座生成的专属徽记
// ═══════════════════════════════════════════════════════════════════════════

export type InsightType = "discovery" | "pattern" | "timing" | "growth";

interface InsightSealProps {
  type?: InsightType;
  skill?: SkillType;
  size?: "sm" | "md" | "lg";
  label?: string;
  className?: string;
}

const sizeClasses = {
  sm: "w-10 h-10 text-[8px]",
  md: "w-12 h-12 text-[10px]",
  lg: "w-16 h-16 text-xs",
};

const typeConfig: Record<InsightType, { label: string; icon: string }> = {
  discovery: { label: "DISCOVERY", icon: "" },
  pattern: { label: "PATTERN", icon: "" },
  timing: { label: "TIMING", icon: "" },
  growth: { label: "GROWTH", icon: "" },
};

const skillShapes: Record<SkillType, "circle" | "square" | "hexagon" | "diamond"> = {
  bazi: "square",      // 八字 - 方形柱
  zodiac: "circle",    // 星座 - 圆形
  mbti: "hexagon",     // MBTI - 六边形
  attach: "circle",    // 依恋 - 嵌套圆
  career: "diamond",   // 职业 - 菱形
};

export function InsightSeal({
  type = "discovery",
  skill = "bazi",
  size = "md",
  label,
  className,
}: InsightSealProps) {
  const config = typeConfig[type];
  const displayLabel = label || config.label;
  const shape = skillShapes[skill];

  return (
    <div
      className={cn(
        "insight-seal relative inline-flex items-center justify-center",
        "font-serif font-bold text-antique-gold",
        "border-2 border-antique-gold/30",
        "bg-gradient-to-br from-antique-gold/10 to-transparent",
        sizeClasses[size],
        shape === "circle" && "rounded-full",
        shape === "square" && "rounded-sm",
        shape === "hexagon" && "rounded-lg",
        shape === "diamond" && "rounded-md rotate-45",
        className
      )}
      style={{ transform: `rotate(-12deg)` }}
    >
      {/* Inner border */}
      <div
        className={cn(
          "absolute inset-1 border border-antique-gold/20",
          shape === "circle" && "rounded-full",
          shape === "square" && "rounded-[2px]",
          shape === "hexagon" && "rounded-md",
          shape === "diamond" && "rounded-sm"
        )}
      />

      {/* Label */}
      <span
        className={cn(
          "relative z-10 tracking-wider",
          shape === "diamond" && "-rotate-45"
        )}
      >
        {displayLabel.slice(0, 4)}
      </span>
    </div>
  );
}

// ═══════════════════════════════════════════════════════════════════════════
// PersonalSeal - User's unique seal based on birth data
// ═══════════════════════════════════════════════════════════════════════════

interface PersonalSealProps {
  birthYear?: number;
  birthMonth?: number;
  birthDay?: number;
  skill?: SkillType;
  size?: "sm" | "md" | "lg";
  className?: string;
}

// Generate a deterministic pattern from birth data
function generateSealPattern(year: number, month: number, day: number): string {
  const seed = year * 10000 + month * 100 + day;
  const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ";
  let result = "";
  let n = seed;
  for (let i = 0; i < 2; i++) {
    result += chars[n % chars.length];
    n = Math.floor(n / chars.length);
  }
  return result;
}

export function PersonalSeal({
  birthYear = 1990,
  birthMonth = 1,
  birthDay = 1,
  skill = "bazi",
  size = "md",
  className,
}: PersonalSealProps) {
  const pattern = generateSealPattern(birthYear, birthMonth, birthDay);

  return (
    <InsightSeal
      skill={skill}
      size={size}
      label={pattern}
      className={className}
    />
  );
}

// ═══════════════════════════════════════════════════════════════════════════
// SealBadge - Inline badge with seal styling
// ═══════════════════════════════════════════════════════════════════════════

interface SealBadgeProps {
  children: React.ReactNode;
  type?: InsightType;
  className?: string;
}

const badgeColors: Record<InsightType, string> = {
  discovery: "bg-element-water/10 text-element-water border-element-water/20",
  pattern: "bg-zodiac-primary/10 text-zodiac-primary border-zodiac-primary/20",
  timing: "bg-antique-gold/10 text-antique-gold border-antique-gold/20",
  growth: "bg-element-wood/10 text-element-wood border-element-wood/20",
};

export function SealBadge({
  children,
  type = "discovery",
  className,
}: SealBadgeProps) {
  return (
    <span
      className={cn(
        "inline-flex items-center gap-1 px-2 py-0.5",
        "text-xs font-medium rounded-full border",
        badgeColors[type],
        className
      )}
    >
      {children}
    </span>
  );
}

export default InsightSeal;
