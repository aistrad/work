"use client";

/**
 * Identity Page Components - v7.1 è®¾è®¡ç³»ç»Ÿ
 *
 * ç»„ä»¶åˆ—è¡¨:
 * - IdentityHero: ä¸»åŸå‹å±•ç¤º
 * - FourDimensionsGrid: å››ç»´åŸå‹ç½‘æ ¼
 * - UnderlyingCodeCard: åº•å±‚å¯†ç å¡ç‰‡
 * - GrowthDirectionCard: æˆé•¿æ–¹å‘å¡ç‰‡
 */

import { memo, useMemo } from "react";
import { cn } from "@/lib/utils";
import { Card } from "@/components/ui/Card";
import { Button } from "@/components/ui/Button";
import {
  ARCHETYPE_META,
  DIMENSION_META,
  type ArchetypeType,
  type DimensionId,
  getArchetypeMeta,
} from "@/types/vibe-id";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// IdentityHero - ä¸»åŸå‹å±•ç¤º
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface IdentityHeroProps {
  primaryArchetype: string;
  primaryName: string;
  primaryNickname: string;
  primarySlogan: string;
  secondaryArchetype?: string;
  confidence: "high" | "medium" | "low";
  onExplore?: () => void;
  className?: string;
}

export const IdentityHero = memo(function IdentityHero({
  primaryArchetype,
  primaryName,
  primaryNickname,
  primarySlogan,
  secondaryArchetype,
  confidence,
  onExplore,
  className,
}: IdentityHeroProps) {
  const archetypeId = primaryArchetype.toLowerCase() as ArchetypeId;
  const meta = ARCHETYPE_META[archetypeId] || {
    emoji: "ğŸ’",
    color: "#7A6B5A",
    colorLight: "#F8F7F4",
  };

  const confidenceConfig = {
    high: { label: "é«˜ç½®ä¿¡", color: "bg-success/10 text-success border-success/20" },
    medium: { label: "ä¸­ç½®ä¿¡", color: "bg-warning/10 text-warning border-warning/20" },
    low: { label: "ä½ç½®ä¿¡", color: "bg-ink-100 text-ink-600 border-ink-200" },
  };

  return (
    <Card
      variant="elevated"
      padding="lg"
      hover={false}
      className={cn("relative overflow-hidden text-center", className)}
    >
      {/* Background gradient */}
      <div
        className="absolute inset-0 opacity-30"
        style={{
          background: `radial-gradient(circle at 50% 30%, ${meta.colorLight} 0%, transparent 70%)`,
        }}
      />

      <div className="relative z-10">
        {/* Main Archetype Icon */}
        <div className="mb-4">
          <div
            className="w-24 h-24 mx-auto rounded-2xl flex items-center justify-center shadow-elevated"
            style={{
              background: `linear-gradient(135deg, ${meta.color}20 0%, ${meta.color}10 100%)`,
              border: `2px solid ${meta.color}40`,
            }}
          >
            <span className="text-5xl">{meta.emoji}</span>
          </div>
        </div>

        {/* Name & Nickname */}
        <h2 className="font-serif text-2xl font-bold text-text-primary mb-1">
          {primaryName}
        </h2>
        <p className="text-sm text-text-secondary mb-2">{primaryNickname}</p>

        {/* Slogan */}
        <p className="text-base text-text-tertiary mb-4">
          &ldquo;{primarySlogan}&rdquo;
        </p>

        {/* Secondary Archetype */}
        {secondaryArchetype && (
          <div className="flex items-center justify-center gap-2 mb-4">
            <span className="text-xs text-text-tertiary">å‰¯åŸå‹:</span>
            <span className="text-sm text-text-secondary">
              {ARCHETYPE_META[secondaryArchetype.toLowerCase() as ArchetypeId]?.emoji}{" "}
              {ARCHETYPE_META[secondaryArchetype.toLowerCase() as ArchetypeId]?.name}
            </span>
          </div>
        )}

        {/* Confidence Badge */}
        <div className="flex justify-center mb-6">
          <span
            className={cn(
              "px-3 py-1 rounded-full text-xs font-medium border",
              confidenceConfig[confidence].color
            )}
          >
            {confidenceConfig[confidence].label}
          </span>
        </div>

        {/* CTA */}
        {onExplore && (
          <Button variant="primary" onClick={onExplore}>
            æ¢ç´¢æˆ‘çš„ VibeID
          </Button>
        )}
      </div>
    </Card>
  );
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FourDimensionsGrid - å››ç»´åŸå‹ç½‘æ ¼
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface DimensionData {
  dimension: DimensionId;
  archetype: string;
  summary: string;
  tension?: string;
}

interface FourDimensionsGridProps {
  dimensions: DimensionData[];
  className?: string;
}

export const FourDimensionsGrid = memo(function FourDimensionsGrid({
  dimensions,
  className,
}: FourDimensionsGridProps) {
  return (
    <div className={cn("grid grid-cols-2 gap-3", className)}>
      {dimensions.map((dim) => {
        const dimensionMeta = DIMENSION_META[dim.dimension];
        const archetypeId = dim.archetype.toLowerCase() as ArchetypeId;
        const archetypeMeta = ARCHETYPE_META[archetypeId];

        return (
          <Card
            key={dim.dimension}
            variant="flat"
            padding="md"
            hover
            className={cn(
              "transition-all duration-normal",
              dim.dimension === "shadow" && "col-span-2"
            )}
          >
            {/* Header */}
            <div className="flex items-center gap-2 mb-2">
              <span className="text-base">{dimensionMeta?.icon}</span>
              <span className="text-xs text-text-tertiary">
                {dimensionMeta?.nameEn} Â· {dimensionMeta?.name}
              </span>
            </div>

            {/* Archetype */}
            <div className="flex items-center gap-2 mb-1">
              <span className="text-lg">{archetypeMeta?.emoji || "ğŸ’"}</span>
              <span className="text-sm font-medium text-text-primary">
                {archetypeMeta?.name || dim.archetype}
              </span>
            </div>

            {/* Summary */}
            <p className="text-xs text-text-secondary">{dim.summary}</p>

            {/* Tension (for shadow) */}
            {dim.tension && (
              <p className="text-xs text-text-tertiary mt-2">
                æ ¸å¿ƒå¼ åŠ›: {dim.tension}
              </p>
            )}
          </Card>
        );
      })}
    </div>
  );
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UnderlyingCodeCard - åº•å±‚å¯†ç å¡ç‰‡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface UnderlyingCodeCardProps {
  baziBrief: string;
  zodiacBrief: string;
  className?: string;
}

export const UnderlyingCodeCard = memo(function UnderlyingCodeCard({
  baziBrief,
  zodiacBrief,
  className,
}: UnderlyingCodeCardProps) {
  return (
    <Card variant="default" padding="md" hover={false} className={className}>
      <div className="flex items-center gap-2 mb-4">
        <span className="text-lg">ğŸ“</span>
        <h3 className="text-sm font-semibold text-text-primary">åº•å±‚å¯†ç </h3>
      </div>

      <div className="space-y-3">
        <div className="flex items-start gap-3 p-3 rounded-lg bg-vellum-100/50">
          <span className="text-lg">ğŸŒŸ</span>
          <div>
            <p className="text-xs text-text-tertiary mb-0.5">å…«å­—</p>
            <p className="text-sm text-text-primary">{baziBrief}</p>
          </div>
        </div>

        <div className="flex items-start gap-3 p-3 rounded-lg bg-mystic-100/50">
          <span className="text-lg">ğŸ”®</span>
          <div>
            <p className="text-xs text-text-tertiary mb-0.5">æ˜Ÿç›˜</p>
            <p className="text-sm text-text-primary">{zodiacBrief}</p>
          </div>
        </div>
      </div>
    </Card>
  );
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GrowthDirectionCard - æˆé•¿æ–¹å‘å¡ç‰‡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface GrowthDirectionCardProps {
  tip: string;
  className?: string;
}

export const GrowthDirectionCard = memo(function GrowthDirectionCard({
  tip,
  className,
}: GrowthDirectionCardProps) {
  return (
    <Card
      variant="default"
      padding="md"
      hover={false}
      className={cn("bg-gradient-to-br from-gold-50 to-vellum-50", className)}
    >
      <div className="flex items-center gap-2 mb-3">
        <span className="text-lg">âœ¨</span>
        <h3 className="text-sm font-semibold text-text-primary">æˆé•¿æ–¹å‘</h3>
      </div>

      <p className="text-sm text-text-secondary leading-relaxed">
        &ldquo;{tip}&rdquo;
      </p>
    </Card>
  );
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MemoryCard - è®°å¿†å¡ç‰‡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface Memory {
  content: string;
  date: string;
}

interface MemoryCardProps {
  memories: Memory[];
  onViewAll?: () => void;
  className?: string;
}

export const MemoryCard = memo(function MemoryCard({
  memories,
  onViewAll,
  className,
}: MemoryCardProps) {
  return (
    <Card variant="default" padding="md" hover={false} className={className}>
      <div className="flex items-center justify-between mb-3">
        <div className="flex items-center gap-2">
          <span className="text-lg">ğŸ’¡</span>
          <h3 className="text-sm font-semibold text-text-primary">VibeLife è®°ä½äº†</h3>
        </div>
        {onViewAll && (
          <button
            onClick={onViewAll}
            className="text-xs text-accent-primary hover:underline"
          >
            æŸ¥çœ‹å…¨éƒ¨
          </button>
        )}
      </div>

      <div className="space-y-2">
        {memories.map((memory, i) => (
          <div key={i} className="p-3 rounded-lg bg-bg-secondary">
            <p className="text-sm text-text-primary">{memory.content}</p>
            <p className="text-xs text-text-tertiary mt-1">{memory.date}</p>
          </div>
        ))}
      </div>
    </Card>
  );
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QuickActionsCard - å¿«æ·æ“ä½œå¡ç‰‡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface QuickAction {
  icon: string;
  label: string;
  onClick: () => void;
}

interface QuickActionsCardProps {
  actions: QuickAction[];
  className?: string;
}

export const QuickActionsCard = memo(function QuickActionsCard({
  actions,
  className,
}: QuickActionsCardProps) {
  return (
    <Card variant="default" padding="md" hover={false} className={className}>
      <div className="flex items-center gap-2 mb-3">
        <span className="text-lg">âš¡</span>
        <h3 className="text-sm font-semibold text-text-primary">å¿«æ·æ“ä½œ</h3>
      </div>

      <div className="space-y-2">
        {actions.map((action, i) => (
          <button
            key={i}
            onClick={action.onClick}
            className="w-full p-3 rounded-lg text-left text-sm text-text-primary bg-bg-secondary hover:bg-bg-tertiary transition-colors duration-fast"
          >
            {action.icon} {action.label}
          </button>
        ))}
      </div>
    </Card>
  );
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Exports
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export default {
  IdentityHero,
  FourDimensionsGrid,
  UnderlyingCodeCard,
  GrowthDirectionCard,
  MemoryCard,
  QuickActionsCard,
};
