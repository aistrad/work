# 第三方服务密钥配置清单

> **安全提示：** 本文档仅作为配置模板，实际密钥请勿提交到 Git 仓库

---

## 1️⃣ Cloudflare Turnstile（防机器人）

| 配置项 | 位置 | 示例值 | 获取方式 |
|--------|------|--------|----------|
| Site Key | `apps/web/.env.local` | `0x4AAA...` | [Turnstile 控制台](https://dash.cloudflare.com/turnstile) |
| Secret Key | `apps/api/.env` | `0x4AAA...` | 同上 |

**环境变量名称：**
```bash
# 前端（注意：代码使用 NEXT_PUBLIC_CF_SITE_KEY）
NEXT_PUBLIC_CF_SITE_KEY=

# 后端
CF_SECRET_KEY=
```

**当前状态：** ✅ 已配置（生产环境）

---

## 2️⃣ Resend（邮件服务）

| 配置项 | 位置 | 示例值 | 获取方式 |
|--------|------|--------|----------|
| API Key | `apps/api/.env` | `re_Zujx...` | [Resend Dashboard](https://resend.com/api-keys) |
| 发件地址 | `apps/api/.env` | `noreply@vibelife.app` | 自定义 |

**环境变量名称：**
```bash
RESEND_API_KEY=
RESEND_FROM=
```

**当前状态：** ✅ 已配置（生产环境）
**当前 API Key：** `re_Zujx2GAK_H1BAVWzjd387LJPpzC8Jo6Ry`（需验证有效期）

---

## 3️⃣ Google OAuth

| 配置项 | 位置 | 示例值 | 获取方式 |
|--------|------|--------|----------|
| Client ID | `apps/api/.env` | `xxx.apps.googleusercontent.com` | [Google Cloud Console](https://console.cloud.google.com/apis/credentials) |
| Client Secret | `apps/api/.env` | `GOCSPX-xxx` | 同上 |
| Client ID (前端) | `apps/web/.env.local` | `xxx.apps.googleusercontent.com` | 同上（与后端相同） |

**环境变量名称：**
```bash
# 后端
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=

# 前端（前端 OAuth 弹窗需要）
NEXT_PUBLIC_GOOGLE_CLIENT_ID=
```

**回调 URL 配置（需在 Google Console 添加）：**
- 生产：`https://vibelife.app/api/auth/oauth/google/callback`
- 开发：`http://localhost:3000/api/auth/oauth/google/callback`

**当前状态：** ✅ **已配置**
- Client ID: `577832101843-pg7l2ht29rhtsj3s9coc4lu17ci8ub42.apps.googleusercontent.com`
- 使用 Google Identity Services（ID Token 验证），无需 Client Secret

---

## 4️⃣ Apple Sign In

| 配置项 | 位置 | 示例值 | 获取方式 |
|--------|------|--------|----------|
| Service ID | `apps/api/.env` | `com.vibelife.signin` | [Apple Developer Console](https://developer.apple.com/account/resources/identifiers/list/serviceId) |
| Team ID | `apps/api/.env` | `ABCD123456` | [Membership Info](https://developer.apple.com/account) |
| Key ID | `apps/api/.env` | `XYZ1234567` | [Keys](https://developer.apple.com/account/resources/authkeys/list) |
| Private Key | 服务器文件系统 | `/secrets/AuthKey_XXX.p8` | 创建 Key 时下载 |
| Client ID (前端) | `apps/web/.env.local` | `com.vibelife.signin` | 同 Service ID |

**环境变量名称：**
```bash
# 后端
APPLE_CLIENT_ID=         # Service ID
APPLE_TEAM_ID=
APPLE_KEY_ID=
APPLE_PRIVATE_KEY_PATH=  # .p8 文件路径

# 前端（前端 OAuth 弹窗需要）
NEXT_PUBLIC_APPLE_CLIENT_ID=  # 与 APPLE_CLIENT_ID 相同
```

**回调 URL 配置（需在 Apple Developer Console 添加）：**
- 生产：`https://vibelife.app/api/auth/oauth/apple/callback`

**当前状态：** ⏸️ **暂不启用**（前端按钮已隐藏）

---

## 5️⃣ 微信开放平台

| 配置项 | 位置 | 示例值 | 获取方式 |
|--------|------|--------|----------|
| AppID | `apps/api/.env` | `wxXXXXXXXXXXXX` | [微信开放平台](https://open.weixin.qq.com/) |
| AppSecret | `apps/api/.env` | `XXXXXXXXXXXXXXXX` | 同上 |

**环境变量名称：**
```bash
# 后端
WECHAT_APP_ID=
WECHAT_APP_SECRET=
```

**回调域配置（需在微信开放平台添加）：**
- 授权回调域：`vibelife.app`（不加 https://）

**当前状态：** ⏸️ **暂不启用**（前端按钮已隐藏）

---

## 6️⃣ JWT 认证（自建）

| 配置项 | 位置 | 当前值 |
|--------|------|--------|
| JWT Secret | `.env` / `apps/api/.env` | `vibelife-jwt-secret-key-2026-aiscend` |
| Access Token 过期时间 | `.env` | `60` 分钟 |
| Refresh Token 过期时间 | `.env` | `30` 天 |

**环境变量名称：**
```bash
VIBELIFE_JWT_SECRET=
VIBELIFE_ACCESS_TOKEN_EXPIRE_MINUTES=60
VIBELIFE_REFRESH_TOKEN_EXPIRE_DAYS=30
```

**当前状态：** ✅ 已配置

---

## 配置优先级

### 已启用（当前生效）
1. ✅ Cloudflare Turnstile
2. ✅ Resend
3. ✅ JWT Secret
4. ✅ Google OAuth

### 暂不启用（前端已隐藏）
5. ⏸️ Apple Sign In
6. ⏸️ 微信开放平台

---

## 安全检查清单

部署前请确认：

- [ ] 所有 Secret Key / API Key 未提交到 Git
- [ ] `.env` 文件已添加到 `.gitignore`
- [ ] 生产环境使用独立的 API Key（与测试环境隔离）
- [ ] Resend API Key 有足够的邮件额度
- [ ] Google/Apple 回调 URL 配置正确
- [ ] Apple 私钥文件权限设置为 `600`（`chmod 600 AuthKey_XXX.p8`）
- [ ] JWT Secret 足够复杂（建议 32+ 字符随机字符串）

---

## 密钥轮换计划

建议定期轮换以下密钥：

| 密钥类型 | 轮换周期 | 最后更新 | 下次轮换 |
|---------|---------|---------|---------|
| JWT Secret | 每年 | 2026-01 | 2027-01 |
| Resend API Key | 每 6 个月 | 待确认 | 待确认 |
| Turnstile Secret | 每年 | 待确认 | 待确认 |
| Google Client Secret | 每年 | 未配置 | - |
| Apple Private Key | 每 2 年 | 未配置 | - |
| WeChat AppSecret | 每年 | 未配置 | - |

---

## 应急联系方式

| 服务 | 支持渠道 |
|------|---------|
| Cloudflare Turnstile | https://community.cloudflare.com |
| Resend | support@resend.com |
| Google Cloud | https://cloud.google.com/support |
| Apple Developer | https://developer.apple.com/contact/ |
| 微信开放平台 | https://open.weixin.qq.com/ 工单系统 |
