# 支付系统密钥配置清单

> **安全提示：** 本文档仅作为配置模板，实际密钥请勿提交到 Git 仓库

---

## 1️⃣ Stripe API 密钥

| 配置项 | 位置 | 示例值 | 获取方式 |
|--------|------|--------|----------|
| Secret Key | `apps/api/.env` | `sk_live_xxx` | [Stripe API Keys](https://dashboard.stripe.com/apikeys) |
| Publishable Key | `apps/api/.env` | `pk_live_xxx` | 同上 |
| Webhook Secret | `apps/api/.env` | `whsec_xxx` | [Stripe Webhooks](https://dashboard.stripe.com/webhooks) |

**环境变量名称：**
```bash
STRIPE_SECRET_KEY=
STRIPE_PUBLISHABLE_KEY=
STRIPE_WEBHOOK_SECRET=
```

**当前状态：** ⚠️ **待配置**

---

## 2️⃣ 订阅价格 ID（海外用户 - USD）

| 配置项 | 位置 | 周期 | 获取方式 |
|--------|------|------|----------|
| 月付 | `apps/api/.env` | Monthly | [Stripe Products](https://dashboard.stripe.com/products) |
| 季付 | `apps/api/.env` | Quarterly | 同上 |
| 年付 | `apps/api/.env` | Yearly | 同上 |

**环境变量名称：**
```bash
STRIPE_PRICE_SUB_MONTHLY_USD=price_xxx
STRIPE_PRICE_SUB_QUARTERLY_USD=price_xxx
STRIPE_PRICE_SUB_YEARLY_USD=price_xxx
```

**当前状态：** ⚠️ **待配置**

---

## 3️⃣ 预付价格 ID（大陆/香港用户 - HKD）

| 配置项 | 位置 | 时长 | 获取方式 |
|--------|------|------|----------|
| 1个月 | `apps/api/.env` | 1 Month | [Stripe Products](https://dashboard.stripe.com/products) |
| 3个月 | `apps/api/.env` | 3 Months | 同上 |
| 12个月 | `apps/api/.env` | 12 Months | 同上 |

**环境变量名称：**
```bash
STRIPE_PRICE_PREPAID_1M_HKD=price_xxx
STRIPE_PRICE_PREPAID_3M_HKD=price_xxx
STRIPE_PRICE_PREPAID_12M_HKD=price_xxx
```

**当前状态：** ⚠️ **待配置**

---

## 4️⃣ 回调 URL

| 配置项 | 位置 | 当前值 |
|--------|------|--------|
| 支付成功页面 | `apps/api/.env` | `https://vibelife.app/payment/success` |
| 支付取消页面 | `apps/api/.env` | `https://vibelife.app/pricing` |
| 账户管理返回 | `apps/api/.env` | `https://vibelife.app/account` |

**环境变量名称：**
```bash
PAYMENT_SUCCESS_URL=https://vibelife.app/payment/success
PAYMENT_CANCEL_URL=https://vibelife.app/pricing
BILLING_PORTAL_RETURN_URL=https://vibelife.app/account
```

**当前状态：** ✅ 已配置（默认值）

---

## 配置优先级

### 必需配置（支付功能）
1. ⚠️ Stripe Secret Key
2. ⚠️ Stripe Publishable Key
3. ⚠️ Stripe Webhook Secret
4. ⚠️ 至少一个 Price ID

### 推荐配置
5. ⚠️ 所有 Price IDs
6. ✅ 回调 URLs（有默认值）

---

## 安全检查清单

部署前请确认：

- [ ] 所有 Stripe 密钥未提交到 Git
- [ ] `.env` 文件已添加到 `.gitignore`
- [ ] 生产环境使用 `sk_live_` 密钥（非 `sk_test_`）
- [ ] Webhook 端点使用 HTTPS
- [ ] Webhook Secret 已正确配置
- [ ] 测试环境和生产环境使用不同的 API 密钥

---

## 密钥轮换计划

建议定期轮换以下密钥：

| 密钥类型 | 轮换周期 | 最后更新 | 下次轮换 |
|---------|---------|---------|---------|
| Stripe Secret Key | 每年 | 未配置 | - |
| Stripe Webhook Secret | 每年 | 未配置 | - |

**轮换步骤：**
1. 在 Stripe Dashboard 生成新密钥
2. 更新环境变量
3. 重启服务
4. 验证支付功能正常
5. 废弃旧密钥

---

## 应急联系方式

| 服务 | 支持渠道 |
|------|---------|
| Stripe | https://support.stripe.com |
| Stripe 状态页面 | https://status.stripe.com |
| Stripe Discord | https://discord.gg/stripe |

---

## 测试卡号（仅测试环境）

| 卡号 | 场景 |
|------|------|
| `4242 4242 4242 4242` | 成功支付 |
| `4000 0000 0000 9995` | 卡片被拒 |
| `4000 0000 0000 3220` | 需要 3D Secure |
| `4000 0025 0000 3155` | 需要验证 |

详细测试卡列表：https://docs.stripe.com/testing
