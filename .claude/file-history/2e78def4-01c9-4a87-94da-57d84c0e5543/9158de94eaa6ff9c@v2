# Relationship Intelligence Skill å®ç°è®¡åˆ’

## æ¦‚è¿°

æ–°å»ºç‹¬ç«‹ `relationship` Skillï¼Œä½œä¸ºç¼–æ’å±‚è°ƒç”¨ç°æœ‰ zodiac/synastry èƒ½åŠ›ï¼Œèšç„¦**æƒ…ä¾£/å¤«å¦»æ¯æ—¥ç›¸å¤„åœºæ™¯**ã€‚

## MVP æ ¸å¿ƒåŠŸèƒ½

1. **ä»Šæ—¥å…³ç³»å¤©æ°”** - ç»¼åˆåŒæ–¹ä»Šæ—¥è¿åŠ¿ï¼Œç»™å‡ºèƒ½é‡è¯„åˆ†å’Œç›¸å¤„å»ºè®®
2. **è¯æœ¯å»ºè®®** - åŸºäºå¯¹æ–¹æ€§æ ¼+ä»Šæ—¥çŠ¶æ€ï¼Œç”Ÿæˆä¸ªæ€§åŒ–æ²Ÿé€šè¯æœ¯
3. **å…³ç³»åŸºç¡€æ´å¯Ÿ** - å¤ç”¨ synastry åˆç›˜æ•°æ®ï¼ˆä¸é‡æ–°è®¡ç®—ï¼‰

## æ¶æ„è®¾è®¡

```
relationship (æ–° Skill - ç¼–æ’å±‚)
    â”‚
    â”œâ”€â”€ get_user_profile â†’ è·å–ç”¨æˆ·+ä¼´ä¾£ç”»åƒ
    â”œâ”€â”€ zodiac.calculate_transit â†’ è·å–åŒæ–¹ä»Šæ—¥è¿åŠ¿
    â”œâ”€â”€ synastry (å·²æœ‰æ•°æ®) â†’ è·å–å…³ç³»åŸºç¡€åˆ†æ
    â”‚
    â””â”€â”€ è‡ªæœ‰å·¥å…·ï¼š
        â”œâ”€â”€ get_active_partner â†’ è·å–å½“å‰ä¼´ä¾£
        â”œâ”€â”€ calculate_relationship_weather â†’ ç»¼åˆä»Šæ—¥å…³ç³»å¤©æ°”
        â”œâ”€â”€ suggest_communication â†’ ç”Ÿæˆè¯æœ¯å»ºè®®
        â”œâ”€â”€ show_relationship_weather â†’ å±•ç¤ºå¤©æ°”å¡ç‰‡
        â””â”€â”€ show_communication_suggestion â†’ å±•ç¤ºè¯æœ¯å¡ç‰‡
```

## æ–‡ä»¶æ¸…å•

### åç«¯ (apps/api/skills/relationship/)

| æ–‡ä»¶ | èŒè´£ |
|-----|------|
| `SKILL.md` | ä¸“å®¶èº«ä»½ã€å¯¹è¯åŸåˆ™ã€å·¥å…·è°ƒç”¨è§„åˆ™ |
| `tools/tools.yaml` | å·¥å…·å®šä¹‰ |
| `tools/handlers.py` | å·¥å…·å®ç°ï¼ˆç¼–æ’ zodiac transitï¼‰ |

### å‰ç«¯ (apps/web/src/skills/relationship/)

| æ–‡ä»¶ | èŒè´£ |
|-----|------|
| `cards/RelationshipWeatherCard.tsx` | ä»Šæ—¥å…³ç³»å¤©æ°”å¡ç‰‡ |
| `cards/CommunicationSuggestionCard.tsx` | è¯æœ¯å»ºè®®å¡ç‰‡ |
| `index.ts` | Card æ³¨å†Œ |

### é…ç½®æ›´æ–°

| æ–‡ä»¶ | æ”¹åŠ¨ |
|-----|------|
| `apps/api/skills/core/config/routing.yaml` | æ·»åŠ  relationship skill è·¯ç”±é…ç½® |
| `apps/web/src/skills/initCards.ts` | å¯¼å…¥ relationship cards |

## å…³é”®å®ç°

### 1. routing.yaml é…ç½®

```yaml
relationship:
  name: å…³ç³»ç»è¥æ™ºèƒ½
  short_desc: æƒ…ä¾£/å¤«å¦»æ¯æ—¥ç›¸å¤„æŒ‡å—
  category: relationship
  triggers:
    - å…³ç³»å¤©æ°”
    - ä»Šå¤©å’Œè€å…¬
    - ä»Šå¤©å’Œè€å©†
    - ä»Šå¤©å’Œç”·æœ‹å‹
    - ä»Šå¤©å’Œå¥³æœ‹å‹
    - æ€ä¹ˆè·ŸTAè¯´
    - æ²Ÿé€šå»ºè®®
  requires_birth_info: true
  requires_compute: false
  skill_data: [zodiac]
  includes: [synastry]
  global_tools: [show_card, request_info]
```

### 2. æ ¸å¿ƒç¼–æ’é€»è¾‘ (handlers.py)

```python
@tool_handler("calculate_relationship_weather")
async def execute_calculate_relationship_weather(args, context):
    # 1. è·å–åŒæ–¹å‡ºç”Ÿä¿¡æ¯
    user_birth_info = context.profile.identity.birth_info
    partner_birth_info = partner.birth_info

    # 2. è°ƒç”¨ zodiac transit (å¤ç”¨ç°æœ‰è®¡ç®—)
    from skills.zodiac.services import calculate_transit
    user_transits = calculate_transit(user_birth_info, today)
    partner_transits = calculate_transit(partner_birth_info, today)

    # 3. ç»¼åˆè¯„ä¼°å…³ç³»èƒ½é‡
    energy_score, weather_icon, advice = _calculate_combined_energy(
        user_transits, partner_transits
    )

    # 4. ä¿å­˜åˆ° skills.relationship
    await _save_weather_record(user_id, partner_id, result)

    return result
```

### 3. æ•°æ®ç»“æ„ (skills.relationship)

```json
{
  "active_partner_id": "rel_xxx",
  "today_weather": {
    "partner_id": "rel_xxx",
    "date": "2026-01-24",
    "energy_score": 78,
    "weather_icon": "â›…ï¸"
  },
  "weather_history": [
    {"date": "2026-01-23", "energy_score": 85}
  ]
}
```

### 4. å‰ç«¯å¡ç‰‡ (RelationshipWeatherCard)

- èƒ½é‡è¯„åˆ†ç¯å½¢å›¾ (0-100)
- å¤©æ°”å›¾æ ‡ (â˜€ï¸/â›…ï¸/ğŸŒ§ï¸)
- åŒæ–¹ä»Šæ—¥çŠ¶æ€æ‘˜è¦
- ç›¸å¤„å»ºè®®

## å®æ–½æ­¥éª¤

### Phase 1: åç«¯åŸºç¡€ (1-2h)

1. åˆ›å»º `apps/api/skills/relationship/` ç›®å½•ç»“æ„
2. ç¼–å†™ `SKILL.md`
3. ç¼–å†™ `tools/tools.yaml`
4. å®ç° `tools/handlers.py` æ ¸å¿ƒé€»è¾‘
5. æ›´æ–° `routing.yaml`

### Phase 2: å‰ç«¯å¡ç‰‡ (1h)

1. åˆ›å»º `apps/web/src/skills/relationship/cards/`
2. å®ç° `RelationshipWeatherCard.tsx`
3. å®ç° `CommunicationSuggestionCard.tsx`
4. æ³¨å†Œåˆ° CardRegistry

### Phase 3: é›†æˆæµ‹è¯• (30min)

1. å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
2. æµ‹è¯•ä»Šæ—¥å…³ç³»å¤©æ°”æµç¨‹
3. æµ‹è¯•è¯æœ¯å»ºè®®æµç¨‹
4. éªŒè¯æ•°æ®æŒä¹…åŒ–

## éªŒè¯æ–¹æ³•

```bash
# 1. å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
cd apps/api && python main.py

# 2. æµ‹è¯•å…³ç³»å¤©æ°”
curl -X POST http://localhost:8100/api/v1/chat/v5 \
  -H "Content-Type: application/json" \
  -d '{"message": "ä»Šå¤©å’Œè€å…¬ç›¸å¤„æ€ä¹ˆæ ·"}'

# 3. æµ‹è¯•è¯æœ¯å»ºè®®
curl -X POST http://localhost:8100/api/v1/chat/v5 \
  -H "Content-Type: application/json" \
  -d '{"message": "æˆ‘æƒ³è·Ÿä»–è¯´è®©ä»–å°‘åŠ ç­ï¼Œæ€ä¹ˆè¯´æ¯”è¾ƒå¥½"}'
```

## è®¾è®¡å†³ç­–

| é—®é¢˜ | å†³ç­– |
|-----|------|
| Partner åˆ‡æ¢ | MVP åªæ”¯æŒä¸€ä¸ª active partner |
| ç¼“å­˜ç­–ç•¥ | å¤ç”¨ zodiac transit ç¼“å­˜ï¼Œskill çº§åˆ«å­˜å½“æ—¥å¤©æ°” |
| æ²Ÿé€šæ—¥å¿— | å­˜æœ€è¿‘ 7 æ¡è®°å½• |
| æ¨é€é€šçŸ¥ | è¶…å‡º MVP èŒƒå›´ |
| Synastry ä¾èµ– | å¯é€‰ï¼Œä»…ç”¨ zodiac transit ä¹Ÿèƒ½å·¥ä½œ |
