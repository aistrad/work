"use client";

/**
 * Zodiac Chat Page - /zodiac/chat
 * 星座占星对话页面
 */

import { useMemo } from "react";
import { useRouter } from "next/navigation";
import { AppShell, useAppShell } from "@/components/layout";
import { ChatPanel, ChartPanel, JourneyPanel, MePanel } from "@/components/layout/panels";
import { ChatContainer } from "@/components/chat/ChatContainer";
import { LuminousPaper, BreathAura } from "@/components/core";

function PanelContent() {
  const router = useRouter();
  const { activeTab } = useAppShell();
  const skill = "zodiac";

  const handleOpenRelationship = () => router.push("/zodiac/relationship");
  const handleGenerateReport = () => router.push("/interview?returnTo=/zodiac/report");
  const handleViewKLine = () => console.log("View K-Line");

  const demoProfile = useMemo(() => ({ sunSign: "双子座", moonSign: "天蝎座", risingSign: "狮子座" }), []);
  const demoNowNext = useMemo(() => ({ now: { theme: "水星逆行期 - 适合回顾和反思" }, next: { startDate: "2026年2月", theme: "木星入摩羯" } }), []);

  switch (activeTab) {
    case "chat":
      return <ChatPanel skill={skill} profile={demoProfile} insights={[]} onOpenRelationship={handleOpenRelationship} />;
    case "chart":
      return <ChartPanel skill={skill} nowNextData={demoNowNext} klinePreview={{ currentScore: 78, trend: "stable", period: "2026年" }} onViewKLine={handleViewKLine} onGenerateReport={handleGenerateReport} />;
    case "journey":
      return <JourneyPanel skill={skill} totalConversations={8} totalInsights={3} memberSince="2025年12月" timeline={[{ id: "1", date: "今天", title: "关于感情运势", summary: "金星过境影响", type: "conversation" }]} />;
    case "me":
      return <MePanel skill={skill} user={{ name: "测试用户", email: "test@vibelife.app", isPro: false }} onLogout={() => console.log("Logout")} />;
    default:
      return null;
  }
}

function ChatContent() {
  const { voiceMode } = useAppShell();
  return (
    <LuminousPaper skill="zodiac" variant="default" className="h-full relative">
      <BreathAura skill="zodiac" size="xl" position="top" intensity="low" className="opacity-30" />
      <ChatContainer skillId="zodiac" skill="zodiac" voiceMode={voiceMode} />
    </LuminousPaper>
  );
}

export default function ZodiacChatPage() {
  return (
    <AppShell skill="zodiac" panelContent={<PanelContent />}>
      <ChatContent />
    </AppShell>
  );
}
