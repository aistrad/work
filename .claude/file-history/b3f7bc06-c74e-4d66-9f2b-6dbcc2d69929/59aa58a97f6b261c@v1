"use client";

/**
 * Zodiac Chat Page - 星座占星对话页面（三栏布局）
 */

import { useMemo } from "react";
import { useRouter } from "next/navigation";
import { AppShell, useAppShell } from "@/components/layout";
import { ChatPanel, ChartPanel, JourneyPanel, MePanel } from "@/components/layout/panels";
import { ChatContainer } from "@/components/chat/ChatContainer";
import { LuminousPaper, BreathAura } from "@/components/core";

// ═══════════════════════════════════════════════════════════════════════════
// Panel Content Switcher
// ═══════════════════════════════════════════════════════════════════════════

function PanelContent() {
  const router = useRouter();
  const { activeTab } = useAppShell();
  const skill = "zodiac";

  // Navigation handlers
  const handleOpenRelationship = () => {
    router.push("/zodiac/relationship");
  };

  const handleGenerateReport = () => {
    router.push("/interview?returnTo=/zodiac/report");
  };

  const handleViewKLine = () => {
    console.log("View K-Line");
  };

  // Demo data for zodiac
  const demoProfile = useMemo(() => ({
    sunSign: "双子座",
    moonSign: "天蝎座",
    risingSign: "狮子座",
  }), []);

  const demoNowNext = useMemo(() => ({
    now: {
      theme: "水星逆行期 - 适合回顾和反思，避免重大决定",
    },
    next: {
      startDate: "2026年2月",
      theme: "木星入摩羯",
    },
  }), []);

  switch (activeTab) {
    case "chat":
      return (
        <ChatPanel
          skill={skill}
          profile={demoProfile}
          insights={[]}
          onOpenRelationship={handleOpenRelationship}
        />
      );
    case "chart":
      return (
        <ChartPanel
          skill={skill}
          nowNextData={demoNowNext}
          klinePreview={{
            currentScore: 78,
            trend: "stable",
            period: "2026年",
          }}
          onViewKLine={handleViewKLine}
          onGenerateReport={handleGenerateReport}
        />
      );
    case "journey":
      return (
        <JourneyPanel
          skill={skill}
          totalConversations={8}
          totalInsights={3}
          memberSince="2025年12月"
          timeline={[
            {
              id: "1",
              date: "今天",
              title: "关于感情运势的对话",
              summary: "探讨了金星过境对感情的影响",
              type: "conversation",
            },
            {
              id: "2",
              date: "昨天",
              title: "你的星盘特质",
              summary: "双子座太阳，善于沟通与变通",
              type: "insight",
            },
          ]}
        />
      );
    case "me":
      return (
        <MePanel
          skill={skill}
          user={{
            name: "测试用户",
            email: "test@vibelife.app",
            isPro: false,
          }}
          onLogout={() => console.log("Logout")}
        />
      );
    default:
      return null;
  }
}

// ═══════════════════════════════════════════════════════════════════════════
// Chat Content
// ═══════════════════════════════════════════════════════════════════════════

function ChatContent() {
  const { voiceMode } = useAppShell();
  const skill = "zodiac";

  return (
    <LuminousPaper skill={skill} variant="default" className="h-full relative">
      <BreathAura
        skill={skill}
        size="xl"
        position="top"
        intensity="low"
        className="opacity-30"
      />
      <ChatContainer
        skillId={skill}
        skill={skill}
        voiceMode={voiceMode}
      />
    </LuminousPaper>
  );
}

// ═══════════════════════════════════════════════════════════════════════════
// Main Page
// ═══════════════════════════════════════════════════════════════════════════

export default function ZodiacChatPage() {
  return (
    <AppShell skill="zodiac" panelContent={<PanelContent />}>
      <ChatContent />
    </AppShell>
  );
}
