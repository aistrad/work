import React, { useState, useEffect } from 'react';
import { 
  Send, 
  Sparkles, 
  Compass, 
  BookOpen, 
  Moon, 
  Sun, 
  MoreHorizontal, 
  Play, 
  CheckCircle2, 
  Circle,
  Lightbulb,
  ArrowRight
} from 'lucide-react';

/**
 * SOUL OS DESIGN SYSTEM
 * * Palette (Morandi/Earth Tones):
 * - Background: #F9F9F7 (Cream/Off-White)
 * - Text Main: #37352F (Charcoal)
 * - Text Muted: #9B9A97 (Warm Gray)
 * - Accent: #E16259 (Terracotta - used sparingly)
 * * PERMA Colors:
 * - P (Positive): #94A3B8 (Cool Gray/Blueish) -> Adjusted to Sage: #84A59D
 * - E (Engagement): #F28482 (Soft Red/Pink)
 * - R (Relationships): #F6BD60 (Mustard/Sand)
 * - M (Meaning): #84A59D (Sage) -> Swapped logic for better balance
 * - A (Accomplishment): #7B68EE (Slate Purple/Periwinkle)
 */

// --- Components ---

// 1. Customized Button (Notion Style)
const SoulButton = ({ children, icon: Icon, onClick, className = "" }) => (
  <button 
    onClick={onClick}
    className={`
      group flex items-center justify-center gap-2 px-4 py-2 rounded-md
      transition-all duration-200 ease-out
      hover:bg-[#EFEFED] active:bg-[#E5E5E3]
      text-[#37352F] text-sm font-medium
      ${className}
    `}
  >
    {Icon && <Icon size={16} className="text-[#9B9A97] group-hover:text-[#37352F] transition-colors" />}
    {children}
  </button>
);

// 2. Prompt Card (Zone A)
const PromptCard = ({ emoji, title, subtitle, onClick }) => (
  <div 
    onClick={onClick}
    className="
      cursor-pointer group relative overflow-hidden
      bg-white border border-[#E9E9E7] rounded-xl p-5
      shadow-[0_2px_8px_rgba(0,0,0,0.02)]
      hover:shadow-[0_8px_16px_rgba(0,0,0,0.06)]
      hover:-translate-y-1 hover:border-[#D3D1CB]
      transition-all duration-300 ease-out
    "
  >
    <div className="flex flex-col gap-3">
      <span className="text-3xl filter grayscale-[0.2] group-hover:grayscale-0 transition-all">{emoji}</span>
      <div>
        <h3 className="font-serif text-lg text-[#37352F] mb-1">{title}</h3>
        <p className="text-xs text-[#9B9A97] font-medium tracking-wide">{subtitle}</p>
      </div>
    </div>
    {/* Decorative light gradient on hover */}
    <div className="absolute inset-0 bg-gradient-to-br from-transparent to-[#F9F9F7]/50 opacity-0 group-hover:opacity-100 transition-opacity" />
  </div>
);

// 3. Radar Chart for PERMA (Zone B)
const RadarChart = ({ data }) => {
  // Config
  const size = 200;
  const center = size / 2;
  const radius = (size / 2) - 30; // padding
  const axes = ['P', 'E', 'R', 'M', 'A'];
  
  // Calculate points
  const points = axes.map((axis, i) => {
    const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2; // Start from top
    const value = data[axis] / 10; // Normalized 0-1
    const x = center + radius * value * Math.cos(angle);
    const y = center + radius * value * Math.sin(angle);
    return `${x},${y}`;
  }).join(' ');

  // Calculate axis lines
  const axisLines = axes.map((axis, i) => {
    const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
    const x = center + radius * Math.cos(angle);
    const y = center + radius * Math.sin(angle);
    return (
      <line 
        key={axis} 
        x1={center} y1={center} x2={x} y2={y} 
        stroke="#E9E9E7" strokeWidth="1" 
        strokeDasharray="4 4"
      />
    );
  });

  // Calculate label positions
  const labels = axes.map((axis, i) => {
    const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
    const x = center + (radius + 20) * Math.cos(angle);
    const y = center + (radius + 20) * Math.sin(angle);
    return (
      <text 
        key={axis} 
        x={x} y={y} 
        textAnchor="middle" 
        dominantBaseline="middle"
        className="text-[10px] fill-[#9B9A97] font-serif font-bold"
      >
        {axis}
      </text>
    );
  });

  return (
    <div className="flex flex-col items-center justify-center py-4">
      <svg width={size} height={size} className="overflow-visible">
        {/* Background Pentagon */}
        <polygon 
          points={axes.map((_, i) => {
            const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
            const x = center + radius * Math.cos(angle);
            const y = center + radius * Math.sin(angle);
            return `${x},${y}`;
          }).join(' ')}
          fill="#F9F9F7"
          stroke="#E9E9E7"
          strokeWidth="1"
        />
        {/* Axes */}
        {axisLines}
        {/* Data Shape */}
        <polygon 
          points={points}
          fill="rgba(132, 165, 157, 0.2)" // Sage Green tint
          stroke="#84A59D" 
          strokeWidth="2"
          className="transition-all duration-1000 ease-out"
        />
        {/* Points */}
        {axes.map((axis, i) => {
          const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
          const value = data[axis] / 10;
          const x = center + radius * value * Math.cos(angle);
          const y = center + radius * value * Math.sin(angle);
          return (
            <circle 
              key={i} cx={x} cy={y} r="3" 
              fill="#FFFFFF" stroke="#84A59D" strokeWidth="2"
            />
          );
        })}
        {labels}
      </svg>
      <div className="mt-2 text-xs text-[#9B9A97] tracking-wider">‰∫îÁª¥ÂøÉÁêÜÂπ≥Ë°°</div>
    </div>
  );
};

// 4. Task Item (Zone B)
const TaskItem = ({ title, tag, isCompleted }) => (
  <div className="group flex items-center justify-between py-3 border-b border-[#F0F0EE] last:border-0">
    <div className="flex items-center gap-3">
      <button className="text-[#D3D1CB] hover:text-[#84A59D] transition-colors">
        {isCompleted ? <CheckCircle2 size={20} className="text-[#84A59D]" /> : <Circle size={20} />}
      </button>
      <span className={`text-sm ${isCompleted ? 'text-[#D3D1CB] line-through' : 'text-[#37352F]'}`}>
        {title}
      </span>
    </div>
    <div className="flex items-center gap-3 opacity-0 group-hover:opacity-100 transition-opacity">
      <span className="text-[10px] px-2 py-0.5 rounded-full bg-[#F0F0EE] text-[#9B9A97] uppercase tracking-wider">
        {tag}
      </span>
      <button className="text-[#9B9A97] hover:text-[#37352F]">
        <Play size={12} />
      </button>
    </div>
  </div>
);


// --- Main Application ---

const App = () => {
  const [inputValue, setInputValue] = useState("");
  const [messages, setMessages] = useState([]);
  
  // Fake PERMA Data
  const permaData = { P: 8, E: 6, R: 7, M: 9, A: 5 };

  const handleSend = () => {
    if (!inputValue.trim()) return;
    setMessages([...messages, { type: 'user', text: inputValue }]);
    setInputValue("");
    // Simulate AI thinking
    setTimeout(() => {
      setMessages(prev => [...prev, { 
        type: 'ai', 
        text: "ÊàëÁêÜËß£‰Ω†ÁöÑÊÑüÂèó„ÄÇÂú®Ê∑∑‰π±‰∏≠ÂØªÊâæÁß©Â∫èÊòØÈáçÂª∫ÂÜÖÂøÉÂπ≥ÈùôÁöÑÁ¨¨‰∏ÄÊ≠•„ÄÇ‰Ω†Áé∞Âú®ÊÑüËßâÂ¶Ç‰ΩïÔºü" 
      }]);
    }, 1000);
  };

  const handleKeyDown = (e) => {
    if (e.key === 'Enter') handleSend();
  };

  return (
    <div className="min-h-screen bg-[#F9F9F7] text-[#37352F] font-sans selection:bg-[#E16259] selection:text-white flex overflow-hidden">
      
      {/* LAYOUT ARCHITECTURE 
        Left: Zone A (Interaction) - 60%
        Right: Zone B (Dashboard) - 40%
        Mobile: Stacked
      */}

      {/* --- ZONE A: The Canvas (Chat/Interaction) --- */}
      <div className="flex-1 flex flex-col relative h-screen p-6 md:p-10 transition-all duration-500">
        
        {/* Header */}
        <header className="flex justify-between items-center mb-10">
          <div className="flex items-center gap-3">
            <div className="w-8 h-8 rounded-full bg-[#37352F] flex items-center justify-center text-[#F9F9F7] font-serif italic">
              F
            </div>
            <h1 className="font-serif text-2xl font-semibold tracking-tight text-[#37352F]">
              Fortune AI
            </h1>
          </div>
          <div className="flex gap-2">
            <SoulButton icon={Moon} />
            <SoulButton icon={MoreHorizontal} />
          </div>
        </header>

        {/* Content Area */}
        <div className="flex-1 overflow-y-auto scrollbar-hide pb-32">
          {messages.length === 0 ? (
            <div className="max-w-3xl mx-auto mt-10 animate-fade-in-up">
              <h2 className="font-serif text-4xl md:text-5xl text-[#37352F] mb-4 leading-tight">
                Good morning, Traveler. <br />
                <span className="text-[#9B9A97] text-3xl">How is your soul aligned today?</span>
              </h2>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-12">
                <PromptCard 
                  emoji="üîÆ"
                  title="Daily Tarot"
                  subtitle="Draw a card for insight"
                  onClick={() => setInputValue("ÊäΩ‰∏ÄÂº†‰ªäÊó•Â°îÁΩóÁâå")}
                />
                <PromptCard 
                  emoji="üå±"
                  title="Growth Journal"
                  subtitle="Reflect on your progress"
                  onClick={() => setInputValue("ÂõûÈ°æÊàëËøôÂë®ÁöÑÊàêÈïø")}
                />
                <PromptCard 
                  emoji="üåå"
                  title="Dream Interpret"
                  subtitle="Decode your subconscious"
                  onClick={() => setInputValue("ÊàëÊò®ÊôöÂÅö‰∫Ü‰∏Ä‰∏™Ê¢¶...")}
                />
                <PromptCard 
                  emoji="üßò"
                  title="Mindfulness"
                  subtitle="Quick 5-min guided session"
                  onClick={() => setInputValue("ÂºÄÂßã5ÂàÜÈíüÊ≠£ÂøµÂºïÂØº")}
                />
              </div>
            </div>
          ) : (
            <div className="max-w-3xl mx-auto space-y-8">
              {messages.map((msg, idx) => (
                <div key={idx} className={`flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'}`}>
                  <div className={`
                    max-w-[80%] p-5 rounded-2xl text-base leading-relaxed
                    ${msg.type === 'user' 
                      ? 'bg-[#EFEFED] text-[#37352F]' 
                      : 'bg-white border border-[#E9E9E7] shadow-sm text-[#37352F] font-serif'}
                  `}>
                    {msg.text}
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>

        {/* Floating Capsule Input (Omnibar) */}
        <div className="absolute bottom-10 left-0 right-0 flex justify-center px-4">
          <div className="
            w-full max-w-2xl 
            bg-white/80 backdrop-blur-md 
            border border-[#E9E9E7] rounded-full 
            shadow-[0_8px_30px_rgba(0,0,0,0.04)]
            flex items-center p-2 pl-6 gap-2
            transition-all duration-300 focus-within:shadow-[0_8px_30px_rgba(0,0,0,0.08)] focus-within:border-[#D3D1CB]
          ">
            <span className="text-[#9B9A97] font-serif italic text-lg mr-2">/</span>
            <input 
              type="text" 
              value={inputValue}
              onChange={(e) => setInputValue(e.target.value)}
              onKeyDown={handleKeyDown}
              placeholder="Type '/' for commands or ask anything..."
              className="flex-1 bg-transparent outline-none text-[#37352F] placeholder-[#9B9A97] h-10"
            />
            <button 
              onClick={handleSend}
              className="w-10 h-10 rounded-full bg-[#37352F] text-white flex items-center justify-center hover:bg-[#2D2B26] transition-colors"
            >
              <ArrowRight size={18} />
            </button>
          </div>
        </div>
      </div>

      {/* --- ZONE B: The Dashboard (Soul Metrics) --- */}
      <div className="hidden lg:flex w-[400px] flex-col p-6 border-l border-[#E9E9E7]/60 bg-[#FCFCFA]">
        
        {/* Banner Callout */}
        <div className="mb-8 p-4 rounded-lg bg-[#F0F0EE]/50 border border-[#E9E9E7] flex gap-3 items-start">
          <Lightbulb size={20} className="text-[#E16259] mt-0.5 flex-shrink-0" />
          <div>
            <h4 className="font-medium text-[#37352F] text-sm">Daily Wisdom</h4>
            <p className="text-xs text-[#9B9A97] mt-1 leading-5">
              "The quieter you become, the more you can hear." ‚Äî Ram Dass
            </p>
          </div>
        </div>

        {/* PERMA Radar Chart */}
        <div className="mb-8">
          <div className="flex items-center justify-between mb-2">
            <h3 className="font-serif text-[#37352F] font-medium">Energy Balance</h3>
            <button className="text-[#9B9A97] hover:text-[#37352F] text-xs">Details</button>
          </div>
          <div className="bg-white rounded-xl border border-[#E9E9E7] shadow-sm p-2 flex justify-center">
            <RadarChart data={permaData} />
          </div>
        </div>

        {/* Task List */}
        <div className="flex-1 overflow-hidden flex flex-col">
          <div className="flex items-center justify-between mb-4">
            <h3 className="font-serif text-[#37352F] font-medium">Rituals</h3>
            <span className="text-xs bg-[#EFEFED] px-2 py-1 rounded text-[#9B9A97]">3 Left</span>
          </div>
          
          <div className="bg-white rounded-xl border border-[#E9E9E7] shadow-sm p-4 flex-1 overflow-y-auto scrollbar-thin">
            <TaskItem title="Êô®Èó¥ÂÜ•ÊÉ≥ (10min)" tag="Mind" isCompleted={true} />
            <TaskItem title="ÊÑüÊÅ©Êó•ËÆ∞" tag="Soul" isCompleted={false} />
            <TaskItem title="ÈòÖËØªÊñØÂ§öËëõÂì≤Â≠¶" tag="Wisdom" isCompleted={false} />
            <TaskItem title="Deep Work Session" tag="Flow" isCompleted={false} />
            <TaskItem title="Êï£Ê≠•Êé•Ëß¶Ëá™ÁÑ∂" tag="Body" isCompleted={false} />
          </div>
        </div>

        {/* Footer */}
        <div className="mt-6 pt-6 border-t border-[#E9E9E7] text-center">
          <p className="text-[10px] text-[#D3D1CB] uppercase tracking-widest">
            Designed for Inner Peace
          </p>
        </div>

      </div>
    </div>
  );
};

export default App;