"use client"

import { useState, useRef, useCallback } from "react"
import { useRouter } from "next/navigation"
import { AnimatePresence } from "framer-motion"
import { HeroSection, GatewaySection, BootingSequence } from "@/components/landing"

export default function LandingPage() {
  const router = useRouter()
  const gatewayRef = useRef<HTMLDivElement>(null)
  const [isBooting, setIsBooting] = useState(false)

  const scrollToGateway = useCallback(() => {
    gatewayRef.current?.scrollIntoView({ behavior: "smooth" })
  }, [])

  const handleRegister = useCallback(
    async (method: "google" | "apple" | "email", email?: string) => {
      // In production, this would trigger actual OAuth or email registration
      // For now, we'll simulate the registration flow
      console.log("Register:", method, email)

      // Start booting sequence
      setIsBooting(true)
    },
    []
  )

  const handleBootComplete = useCallback(() => {
    // Navigate to the main app
    router.push("/new")
  }, [router])

  return (
    <>
      <AnimatePresence>
        {isBooting && (
          <BootingSequence onComplete={handleBootComplete} />
        )}
      </AnimatePresence>

      <main className="relative">
        {/* Stage 1 & 2: Hero with Soul Orb and Input */}
        <HeroSection onScrollToGateway={scrollToGateway} />

        {/* Stage 4: Gateway (Registration) */}
        <div ref={gatewayRef}>
          <GatewaySection onRegister={handleRegister} />
        </div>
      </main>
    </>
  )
}
