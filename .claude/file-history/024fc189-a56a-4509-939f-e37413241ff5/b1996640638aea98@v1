"use client";

/**
 * ArchetypeCard - è£æ ¼åŸå‹ç”»åƒå¡ç‰‡ï¼ˆv3.0 è§†è§‰å‡çº§ï¼‰
 *
 * æ‰¿è½½ä¸‰ä¸ªä»·å€¼ï¼š
 * - è®¤çŸ¥ï¼šæˆ‘æ˜¯ä»€ä¹ˆï¼ˆåŸå‹æ„æˆï¼‰
 * - æŒ‡å¯¼ï¼šæˆ‘åº”è¯¥æ€ä¹ˆåšï¼ˆè¡ŒåŠ¨å»ºè®®ï¼‰
 * - è§‚å¯Ÿï¼šæˆ‘çš„å˜åŒ–ï¼ˆè¶‹åŠ¿ + é˜´å½±è§‰å¯Ÿï¼‰
 *
 * v3.0 è®¾è®¡å‡çº§ï¼š
 * - ä¸»åŸå‹ä½¿ç”¨ GradientEmojiIcon åŒ…è£¹ emoji
 * - ä¸œè¥¿æ–¹èåˆå®¡ç¾ - ä½¿ç”¨ Noto Serif SC å­—ä½“
 * - åŸå‹æƒé‡ç”¨æ›´ç²¾è‡´çš„æ¸å˜æ¡
 * - æ•´ä½“å¡ç‰‡ä½¿ç”¨åŸå‹å¯¹åº”çš„å¾®å¦™æ¸å˜
 */

import { cn } from "@/lib/utils";
import { ChevronRight, TrendingUp, AlertTriangle, Lightbulb, Sparkles } from "lucide-react";
import { ArchetypeIcon, GradientEmojiIcon } from "@/components/core/GradientEmojiIcon";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Types
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export interface ArchetypeData {
  primary: {
    name: string;
    name_cn: string;
    tagline: string;
    weight: number;
  };
  weights: Record<string, number>;
  guidance: string[];
  trend?: {
    rising: string;
    delta: number;
    evidence: string;
  };
  shadow?: {
    name: string;
    warning: string;
  };
}

export interface ArchetypeCardProps {
  data?: ArchetypeData | null;
  onExplore?: () => void;
  className?: string;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Static Constants - Archetype Colors (upgraded with gradients)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const ARCHETYPE_STYLES: Record<string, {
  gradient: string;
  text: string;
  bg: string;
  barGradient: string;
  cardBg: string;
}> = {
  åˆ›é€ è€…: {
    gradient: "from-amber-400 to-orange-500",
    text: "text-amber-700",
    bg: "bg-amber-100",
    barGradient: "from-amber-400 to-orange-500",
    cardBg: "from-amber-50/50 to-orange-50/30",
  },
  æ¢ç´¢è€…: {
    gradient: "from-teal-400 to-emerald-500",
    text: "text-teal-700",
    bg: "bg-teal-100",
    barGradient: "from-teal-400 to-emerald-500",
    cardBg: "from-teal-50/50 to-emerald-50/30",
  },
  æ™ºè€…: {
    gradient: "from-indigo-400 to-purple-500",
    text: "text-indigo-700",
    bg: "bg-indigo-100",
    barGradient: "from-indigo-400 to-purple-500",
    cardBg: "from-indigo-50/50 to-purple-50/30",
  },
  è‹±é›„: {
    gradient: "from-red-400 to-rose-500",
    text: "text-red-700",
    bg: "bg-red-100",
    barGradient: "from-red-400 to-rose-500",
    cardBg: "from-red-50/50 to-rose-50/30",
  },
  ç…§é¡¾è€…: {
    gradient: "from-green-400 to-emerald-500",
    text: "text-green-700",
    bg: "bg-green-100",
    barGradient: "from-green-400 to-emerald-500",
    cardBg: "from-green-50/50 to-emerald-50/30",
  },
  æ‹äºº: {
    gradient: "from-pink-400 to-rose-500",
    text: "text-pink-700",
    bg: "bg-pink-100",
    barGradient: "from-pink-400 to-rose-500",
    cardBg: "from-pink-50/50 to-rose-50/30",
  },
  é­”æœ¯å¸ˆ: {
    gradient: "from-purple-400 to-violet-500",
    text: "text-purple-700",
    bg: "bg-purple-100",
    barGradient: "from-purple-400 to-violet-500",
    cardBg: "from-purple-50/50 to-violet-50/30",
  },
  ç»Ÿæ²»è€…: {
    gradient: "from-yellow-400 to-amber-500",
    text: "text-yellow-700",
    bg: "bg-yellow-100",
    barGradient: "from-yellow-400 to-amber-500",
    cardBg: "from-yellow-50/50 to-amber-50/30",
  },
  å¤©çœŸè€…: {
    gradient: "from-sky-400 to-blue-500",
    text: "text-sky-700",
    bg: "bg-sky-100",
    barGradient: "from-sky-400 to-blue-500",
    cardBg: "from-sky-50/50 to-blue-50/30",
  },
  å‡¡äºº: {
    gradient: "from-slate-400 to-gray-500",
    text: "text-slate-700",
    bg: "bg-slate-100",
    barGradient: "from-slate-400 to-gray-500",
    cardBg: "from-slate-50/50 to-gray-50/30",
  },
  å›é€†è€…: {
    gradient: "from-orange-400 to-red-500",
    text: "text-orange-700",
    bg: "bg-orange-100",
    barGradient: "from-orange-400 to-red-500",
    cardBg: "from-orange-50/50 to-red-50/30",
  },
  æ„šè€…: {
    gradient: "from-cyan-400 to-teal-500",
    text: "text-cyan-700",
    bg: "bg-cyan-100",
    barGradient: "from-cyan-400 to-teal-500",
    cardBg: "from-cyan-50/50 to-teal-50/30",
  },
};

function getArchetypeStyle(name: string) {
  return ARCHETYPE_STYLES[name] || ARCHETYPE_STYLES["åˆ›é€ è€…"];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Sub-components
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function PrimaryArchetypeHero({
  name,
  name_cn,
  tagline,
}: {
  name: string;
  name_cn: string;
  tagline: string;
}) {
  const style = getArchetypeStyle(name_cn);

  return (
    <div
      className={cn(
        "relative p-6 rounded-2xl text-center overflow-hidden",
        "bg-gradient-to-br from-white via-vellum-50/50 to-white",
        "border border-vellum-200/50",
        "shadow-soft"
      )}
    >
      {/* Decorative background glow */}
      <div
        className={cn(
          "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",
          "w-32 h-32 rounded-full blur-3xl opacity-20",
          "bg-gradient-to-br",
          style.gradient
        )}
      />

      <div className="relative">
        {/* Gradient Emoji Icon - v3.0 æ ¸å¿ƒå‡çº§ */}
        <div className="flex justify-center mb-4">
          <ArchetypeIcon archetype={name_cn} size="xl" glow />
        </div>

        {/* Name - ä½¿ç”¨ Noto Serif SC å­—ä½“ */}
        <h3 className="font-serif text-2xl font-bold text-text-primary mb-1">
          {name_cn}
        </h3>
        <p className="text-xs text-text-tertiary uppercase tracking-widest mb-4">
          {name}
        </p>

        {/* Elegant Divider */}
        <div className="flex items-center justify-center gap-3 mb-4">
          <div className="w-12 h-px bg-gradient-to-r from-transparent via-vellum-300 to-transparent" />
          <Sparkles className="w-3 h-3 text-vellum-400" />
          <div className="w-12 h-px bg-gradient-to-r from-transparent via-vellum-300 to-transparent" />
        </div>

        {/* Tagline */}
        <p className="text-sm text-text-secondary italic">
          ã€Œ{tagline}ã€
        </p>
      </div>
    </div>
  );
}

function ArchetypeWeightsChart({ weights, primaryName }: { weights: Record<string, number>; primaryName: string }) {
  const sortedWeights = Object.entries(weights)
    .sort(([, a], [, b]) => b - a)
    .slice(0, 4); // Show top 4

  const maxValue = Math.max(...Object.values(weights), 1);

  return (
    <div className="space-y-3">
      {sortedWeights.map(([name, value], index) => {
        const style = getArchetypeStyle(name);
        const percentage = (value / maxValue) * 100;
        const isPrimary = name === primaryName;

        return (
          <div key={name} className="flex items-center gap-3">
            {/* Mini Icon */}
            <div
              className={cn(
                "w-6 h-6 rounded-md flex items-center justify-center text-xs",
                "bg-gradient-to-br",
                style.gradient,
                "text-white shadow-sm"
              )}
            >
              {index + 1}
            </div>

            {/* Name */}
            <span className={cn(
              "w-14 text-xs truncate",
              isPrimary ? "font-medium text-text-primary" : "text-text-secondary"
            )}>
              {name}
            </span>

            {/* Progress Bar */}
            <div className="flex-1 h-2 bg-vellum-100 rounded-full overflow-hidden">
              <div
                className={cn(
                  "h-full rounded-full transition-all duration-700 ease-out",
                  "bg-gradient-to-r",
                  style.barGradient
                )}
                style={{ width: `${percentage}%` }}
              />
            </div>

            {/* Percentage */}
            <span className={cn(
              "w-10 text-xs text-right tabular-nums",
              isPrimary ? "font-medium text-text-primary" : "text-text-tertiary"
            )}>
              {value}%
            </span>
          </div>
        );
      })}
    </div>
  );
}

function GuidanceSection({ guidance }: { guidance: string[] }) {
  return (
    <div className="p-4 rounded-xl bg-gradient-to-br from-amber-50/80 to-yellow-50/60 border border-amber-200/30">
      <div className="flex items-center gap-2 mb-3">
        <GradientEmojiIcon emoji="ğŸ’¡" theme="amber" size="xs" />
        <span className="text-xs font-medium text-amber-700">è¡ŒåŠ¨å»ºè®®</span>
      </div>
      <ul className="space-y-2">
        {guidance.map((tip, index) => (
          <li key={index} className="flex items-start gap-2 text-sm text-ink-700">
            <span className="text-amber-500 mt-0.5 font-medium">{index + 1}.</span>
            <span>{tip}</span>
          </li>
        ))}
      </ul>
    </div>
  );
}

function TrendSection({
  trend,
  shadow,
}: {
  trend?: ArchetypeData["trend"];
  shadow?: ArchetypeData["shadow"];
}) {
  if (!trend && !shadow) return null;

  return (
    <div className="p-4 rounded-xl bg-gradient-to-br from-slate-50/80 to-gray-50/60 border border-slate-200/30">
      <div className="flex items-center gap-2 mb-3">
        <GradientEmojiIcon emoji="ğŸ“ˆ" theme="slate" size="xs" />
        <span className="text-xs font-medium text-slate-700">è¿‘æœŸè¶‹åŠ¿</span>
      </div>

      <div className="space-y-3">
        {trend ? (
          <div className="flex items-start gap-3 p-2.5 rounded-lg bg-white/60">
            <div className="w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
              <TrendingUp className="w-3.5 h-3.5 text-green-600" />
            </div>
            <div>
              <div className="flex items-center gap-2 mb-0.5">
                <span className="text-sm font-medium text-text-primary">
                  {trend.rising}
                </span>
                <span className="text-xs text-green-600 font-medium">
                  +{trend.delta}%
                </span>
              </div>
              <p className="text-xs text-text-tertiary">
                ã€Œ{trend.evidence}ã€
              </p>
            </div>
          </div>
        ) : null}

        {shadow ? (
          <div className="flex items-start gap-3 p-2.5 rounded-lg bg-amber-50/50">
            <div className="w-6 h-6 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0">
              <AlertTriangle className="w-3.5 h-3.5 text-amber-600" />
            </div>
            <div>
              <div className="flex items-center gap-2 mb-0.5">
                <span className="text-xs text-text-tertiary">é˜´å½±è§‰å¯Ÿ</span>
                <span className="text-sm font-medium text-amber-700">
                  {shadow.name}
                </span>
              </div>
              <p className="text-xs text-text-tertiary">
                ã€Œ{shadow.warning}ã€
              </p>
            </div>
          </div>
        ) : null}
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Section Header
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function SectionHeader({ title }: { title: string }) {
  return (
    <h4 className="text-xs text-text-tertiary mb-3 flex items-center gap-2">
      <span className="w-4 h-px bg-vellum-300" />
      {title}
      <span className="flex-1 h-px bg-vellum-300" />
    </h4>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Main Component
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export function ArchetypeCard({
  data,
  onExplore,
  className,
}: ArchetypeCardProps) {
  // Empty state
  if (!data) {
    return (
      <div
        onClick={onExplore}
        className={cn(
          "relative p-5 rounded-2xl cursor-pointer overflow-hidden",
          "bg-gradient-to-br from-vellum-50/50 to-gold-50/30",
          "border border-vellum-200/30 shadow-card",
          "hover:shadow-card-hover hover:border-vellum-200/50",
          "transition-all duration-200",
          className
        )}
      >
        <div className="flex items-center gap-3 mb-4">
          <GradientEmojiIcon emoji="âœ¦" theme="gold" size="md" glow />
          <div>
            <span className="font-serif text-base font-semibold text-text-primary">
              ä½ çš„åŸå‹ç”»åƒ
            </span>
            <p className="text-xs text-text-tertiary">å‘ç°ä½ çš„è£æ ¼åŸå‹</p>
          </div>
        </div>
        <p className="text-sm text-text-secondary mb-4">
          ç»§ç»­å¯¹è¯ï¼Œç³»ç»Ÿä¼šåˆ†æä½ çš„æ€§æ ¼ç‰¹è´¨ï¼Œæ­ç¤ºä½ å†…åœ¨çš„åŸå‹åŠ›é‡ã€‚
        </p>
        <div className="flex items-center justify-center gap-2 px-4 py-2.5 bg-gold-500/10 hover:bg-gold-500/20 text-gold-700 rounded-xl text-sm font-medium transition-colors">
          <Sparkles className="w-4 h-4" />
          <span>å¼€å§‹æ¢ç´¢</span>
          <ChevronRight className="w-4 h-4" />
        </div>
      </div>
    );
  }

  const primaryStyle = getArchetypeStyle(data.primary.name_cn);

  return (
    <div
      onClick={onExplore}
      className={cn(
        "relative p-5 rounded-2xl cursor-pointer overflow-hidden",
        "bg-gradient-to-br",
        primaryStyle.cardBg,
        "border border-vellum-200/30 shadow-card",
        "hover:shadow-card-hover hover:border-vellum-200/50",
        "transition-all duration-200 hover:scale-[1.01]",
        className
      )}
    >
      {/* Header */}
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center gap-2">
          <GradientEmojiIcon emoji="âœ¦" theme="gold" size="sm" />
          <span className="font-serif text-base font-semibold text-text-primary">
            ä½ çš„åŸå‹ç”»åƒ
          </span>
        </div>
        <div className="flex items-center gap-1 text-vellum-600">
          <span className="text-xs">æ·±å…¥</span>
          <ChevronRight className="w-4 h-4" />
        </div>
      </div>

      {/* Primary Archetype Hero */}
      <PrimaryArchetypeHero
        name={data.primary.name}
        name_cn={data.primary.name_cn}
        tagline={data.primary.tagline}
      />

      {/* Section: è®¤çŸ¥ */}
      <div className="mt-5">
        <SectionHeader title="è®¤çŸ¥ï¼šæˆ‘æ˜¯ä»€ä¹ˆ" />
        <ArchetypeWeightsChart weights={data.weights} primaryName={data.primary.name_cn} />
      </div>

      {/* Section: æŒ‡å¯¼ */}
      <div className="mt-5">
        <SectionHeader title="æŒ‡å¯¼ï¼šæˆ‘åº”è¯¥æ€ä¹ˆåš" />
        <GuidanceSection guidance={data.guidance} />
      </div>

      {/* Section: è§‚å¯Ÿ */}
      {(data.trend || data.shadow) ? (
        <div className="mt-5">
          <SectionHeader title="è§‚å¯Ÿï¼šæˆ‘çš„å˜åŒ–" />
          <TrendSection trend={data.trend} shadow={data.shadow} />
        </div>
      ) : null}
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Skeleton
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export function ArchetypeCardSkeleton({ className }: { className?: string }) {
  return (
    <div
      className={cn(
        "p-5 rounded-2xl",
        "bg-gradient-to-br from-vellum-50/30 to-white",
        "border border-vellum-200/30 shadow-card animate-pulse",
        className
      )}
    >
      {/* Header */}
      <div className="flex items-center gap-2 mb-4">
        <div className="w-10 h-10 rounded-xl bg-vellum-200" />
        <div className="h-5 bg-vellum-200 rounded w-28" />
      </div>

      {/* Hero */}
      <div className="p-6 rounded-2xl bg-vellum-100/50 text-center mb-5">
        <div className="w-16 h-16 rounded-2xl bg-vellum-200 mx-auto mb-4" />
        <div className="h-7 bg-vellum-200 rounded w-20 mx-auto mb-2" />
        <div className="h-4 bg-vellum-100 rounded w-16 mx-auto mb-4" />
        <div className="w-16 h-px bg-vellum-200 mx-auto mb-4" />
        <div className="h-4 bg-vellum-200 rounded w-32 mx-auto" />
      </div>

      {/* Weights */}
      <div className="space-y-3 mb-5">
        {[1, 2, 3, 4].map((i) => (
          <div key={i} className="flex items-center gap-3">
            <div className="w-6 h-6 bg-vellum-200 rounded-md" />
            <div className="w-14 h-4 bg-vellum-200 rounded" />
            <div className="flex-1 h-2 bg-vellum-100 rounded-full" />
            <div className="w-10 h-4 bg-vellum-200 rounded" />
          </div>
        ))}
      </div>

      {/* Guidance */}
      <div className="p-4 rounded-xl bg-vellum-100/50">
        <div className="h-4 bg-vellum-200 rounded w-20 mb-3" />
        <div className="space-y-2">
          <div className="h-4 bg-vellum-200 rounded w-full" />
          <div className="h-4 bg-vellum-200 rounded w-4/5" />
          <div className="h-4 bg-vellum-200 rounded w-3/4" />
        </div>
      </div>
    </div>
  );
}

export default ArchetypeCard;
