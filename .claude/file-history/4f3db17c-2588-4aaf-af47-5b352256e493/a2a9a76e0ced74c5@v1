version: "2.0"
skill_id: bazi

# ═══════════════════════════════════════════════════════════════════════════
# 收集型工具
# ═══════════════════════════════════════════════════════════════════════════
collect:
  - name: collect_bazi_info
    description: |
      收集用户的出生信息以进行八字分析。
      当用户想要进行八字分析但尚未提供出生信息时调用。
    card_type: bazi_form
    when_to_call: |
      - 用户想进行八字分析但没有提供出生信息
      - 用户说"帮我算命"但 profile 中没有 birth_info
      - 用户主动要求填写出生信息
    card_props:
      form_fields:
        - name: birth_date
          type: date
          required: true
          label: 出生日期
        - name: birth_time
          type: time
          required: true
          label: 出生时间（时辰）
        - name: birth_location
          type: location
          required: false
          label: 出生地点
        - name: gender
          type: select
          required: true
          label: 性别
          options:
            - value: male
              label: 男
            - value: female
              label: 女
      allow_text_input: true
      text_input_placeholder: 请描述你当前的困惑或问题...
    parameters:
      - name: question
        type: string
        required: false
        description: 用户的问题或困惑
      - name: include_question
        type: boolean
        required: false
        default: true
        description: 是否包含问题输入框

# ═══════════════════════════════════════════════════════════════════════════
# 计算型工具
# ═══════════════════════════════════════════════════════════════════════════
compute:
  - name: calculate_bazi
    description: |
      根据出生信息计算八字命盘。
      包括四柱、日主、五行分布、十神关系、大运流年。
    implementation: tools.bazi.calculate_bazi_chart
    card_type: bazi_chart
    when_to_call: |
      - 内部计算使用，通常由展示工具自动调用
      - 需要获取原始命盘数据时
    parameters:
      - name: birth_date
        type: string
        required: true
        description: 出生日期 (YYYY-MM-DD)
      - name: birth_time
        type: string
        required: true
        description: 出生时间 (HH:MM)
      - name: birth_location
        type: string
        required: false
        description: 出生地点
      - name: gender
        type: string
        required: true
        description: 性别 (male/female)
    returns:
      type: object
      description: |
        包含四柱、日主、五行分布、十神、大运等完整命盘数据

# ═══════════════════════════════════════════════════════════════════════════
# 展示型工具
# ═══════════════════════════════════════════════════════════════════════════
display:
  - name: show_bazi_chart
    description: |
      展示用户的八字命盘，包括四柱、日主、五行分布和十神关系。
      当用户想要查看自己的八字、命盘或想了解基本命理信息时调用此工具。
    card_type: bazi_chart
    when_to_call: |
      - 用户说"看看我的命盘"、"我的八字是什么"
      - 用户想了解基本命理信息
      - 进行命盘分析前展示命盘图
      - 用户说"排盘"、"算命"
    parameters:
      - name: show_details
        type: boolean
        required: false
        description: 是否显示详细分析
        default: true

  - name: show_bazi_fortune
    description: |
      展示用户的大运流年分析，包括：
      - 当前所处的十年大运周期
      - 指定年份的流年运势分析
      - 大运与流年的组合影响
      - 关键建议和注意事项
    card_type: bazi_fortune
    when_to_call: |
      - 用户问"大运"、"十年运"、"走什么运"
      - 用户问"今年运势"、"明年运势"、"流年"
      - 用户问特定年份运势（如"2027年运势"）
      - 用户想了解运势周期
    parameters:
      - name: year
        type: integer
        required: false
        description: 要分析的年份（默认当前年）
      - name: include_past
        type: boolean
        required: false
        description: 是否包含过去的大运
        default: false

  - name: show_bazi_kline
    description: |
      展示用户的运势 K 线图，可视化展示运势变化趋势。
      当用户想要查看运势变化趋势时调用。
    card_type: bazi_kline
    when_to_call: |
      - 用户说"看看运势趋势"、"运势K线"
      - 用户想可视化查看运势变化
      - 用户问"人生运势走向"
    parameters:
      - name: start_year
        type: integer
        required: false
        description: 起始年份
      - name: end_year
        type: integer
        required: false
        description: 结束年份

# ═══════════════════════════════════════════════════════════════════════════
# 注意事项
# ═══════════════════════════════════════════════════════════════════════════
# 1. show_report 和 show_insight 已在 core/tools/tools.yaml 中定义为全局工具
# 2. search_db 已在 core/tools/tools.yaml 中定义为全局工具
# 3. 所有展示工具会自动从 context.profile 读取出生信息
# 4. 如果缺少出生信息，应返回 need_info 错误而非 demo 数据
