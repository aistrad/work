"use client";

import { ReactNode } from "react";
import { Toaster } from "sonner";
import { SkillProvider } from "./SkillProvider";
import { AuthProvider } from "./AuthProvider";
import { ErrorBoundary } from "@/components/error";
import { type SkillType } from "@/components/core";

// 导入 initCards 会触发 side-effect 注册所有卡片组件到 CardRegistry
import "@/skills/initCards";

interface ProvidersProps {
  children: ReactNode;
  initialSkill?: SkillType;
}

export function Providers({ children, initialSkill }: ProvidersProps) {
  return (
    <ErrorBoundary
      onError={(error, errorInfo) => {
        // Log to console in development
        if (process.env.NODE_ENV === "development") {
          console.error("Global ErrorBoundary:", error, errorInfo);
        }
        // TODO: Send to error reporting service (Sentry)
      }}
    >
      <AuthProvider>
        <SkillProvider initialSkill={initialSkill}>
          {children}
          {/* Toast notifications - positioned at bottom center */}
          <Toaster
            position="bottom-center"
            toastOptions={{
              className: "font-sans",
              style: {
                background: "hsl(var(--card))",
                border: "1px solid hsl(var(--border))",
                color: "hsl(var(--foreground))",
              },
            }}
            richColors
            closeButton
          />
        </SkillProvider>
      </AuthProvider>
    </ErrorBoundary>
  );
}

export {
  useSkill,
  useSkillConfig,
  useSkillPanels,
  useSkillTools,
  useSkillRegistry,
  useCurrentSkill,
} from "./SkillProvider";
export { useAuth, useUser, useClerk, UserButton } from "./AuthProvider";
