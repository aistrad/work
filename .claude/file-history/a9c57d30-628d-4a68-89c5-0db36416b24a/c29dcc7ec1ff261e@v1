/**
 * ExpertAvatar - Skill 专家头像组件
 *
 * 复用现有 Lucide 图标，增强视觉效果：
 * - 圆形背景 + skill 主题色渐变
 * - 图标居中显示，白色
 * - 支持 sm(24px)/md(32px)/lg(40px) 尺寸
 * - 可选外发光效果
 */

"use client";

import React from "react";
import { cn } from "@/lib/utils";
import { skillRegistry } from "@/skills/registry";
import type { SkillId } from "@/skills/types";
import type { LucideIcon } from "lucide-react";

// 尺寸配置
const SIZES = {
  sm: {
    container: "w-6 h-6",
    padding: "p-1",
    icon: 14,
  },
  md: {
    container: "w-8 h-8",
    padding: "p-1.5",
    icon: 18,
  },
  lg: {
    container: "w-10 h-10",
    padding: "p-2",
    icon: 22,
  },
} as const;

type AvatarSize = keyof typeof SIZES;

// 主题色配置（与各 skill config 保持一致）
const SKILL_GRADIENTS: Record<SkillId, { from: string; to: string; glow: string }> = {
  bazi: {
    from: "#B8860B",
    to: "#DAA520",
    glow: "rgba(184, 134, 11, 0.4)",
  },
  zodiac: {
    from: "#6366F1",
    to: "#818CF8",
    glow: "rgba(99, 102, 241, 0.4)",
  },
  lifecoach: {
    from: "#9B59B6",
    to: "#8E44AD",
    glow: "rgba(155, 89, 182, 0.4)",
  },
  mbti: {
    from: "#10B981",
    to: "#34D399",
    glow: "rgba(16, 185, 129, 0.4)",
  },
  tarot: {
    from: "#8B5CF6",
    to: "#A78BFA",
    glow: "rgba(139, 92, 246, 0.4)",
  },
  attach: {
    from: "#EC4899",
    to: "#F472B6",
    glow: "rgba(236, 72, 153, 0.4)",
  },
  career: {
    from: "#F59E0B",
    to: "#FBBF24",
    glow: "rgba(245, 158, 11, 0.4)",
  },
};

export interface ExpertAvatarProps {
  /** Skill ID */
  skill: SkillId;
  /** 尺寸 */
  size?: AvatarSize;
  /** 是否显示外发光效果 */
  showGlow?: boolean;
  /** 自定义类名 */
  className?: string;
}

export function ExpertAvatar({
  skill,
  size = "md",
  showGlow = false,
  className,
}: ExpertAvatarProps) {
  // 获取 skill 配置
  const skillConfig = skillRegistry.get(skill);
  const Icon: LucideIcon | undefined = skillConfig?.icon;

  // 获取渐变色配置
  const gradient = SKILL_GRADIENTS[skill] || SKILL_GRADIENTS.bazi;
  const sizeConfig = SIZES[size];

  // 渐变背景样式
  const gradientStyle = {
    background: `linear-gradient(135deg, ${gradient.from} 0%, ${gradient.to} 100%)`,
    boxShadow: showGlow ? `0 0 12px ${gradient.glow}` : undefined,
  };

  return (
    <div
      className={cn(
        "rounded-full flex items-center justify-center flex-shrink-0",
        sizeConfig.container,
        sizeConfig.padding,
        showGlow && "shadow-lg",
        className
      )}
      style={gradientStyle}
    >
      {Icon && (
        <Icon
          size={sizeConfig.icon}
          className="text-white"
          strokeWidth={2}
        />
      )}
    </div>
  );
}

export default ExpertAvatar;
