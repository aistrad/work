"use client";

/**
 * VoiceModeToggle - ËØ≠Ê∞îÊ®°ÂºèÂàáÊç¢ÁªÑ‰ª∂
 * ÊîØÊåÅ warm (Ê∏©Êöñ) Âíå sarcastic (ÂêêÊßΩ) ‰∏§ÁßçÊ®°Âºè
 */

import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { cn } from "@/lib/utils";

export type VoiceMode = "warm" | "sarcastic";

interface VoiceModeToggleProps {
  value: VoiceMode;
  onChange: (mode: VoiceMode) => void;
  disabled?: boolean;
  size?: "sm" | "md" | "lg";
  className?: string;
}

const MODE_CONFIG: Record<VoiceMode, { label: string; emoji: string; description: string }> = {
  warm: {
    label: "Ê∏©Êöñ",
    emoji: "üå∏",
    description: "Ê∏©Êüî‰ΩìË¥¥ÔºåÂæ™Âæ™ÂñÑËØ±",
  },
  sarcastic: {
    label: "ÂêêÊßΩ",
    emoji: "üî•",
    description: "ÁäÄÂà©Áõ¥Êé•Ôºå‰∏ÄÈíàËßÅË°Ä",
  },
};

export function VoiceModeToggle({
  value,
  onChange,
  disabled = false,
  size = "md",
  className,
}: VoiceModeToggleProps) {
  const [showTooltip, setShowTooltip] = useState(false);

  const sizeClasses = {
    sm: "h-8 text-xs",
    md: "h-10 text-sm",
    lg: "h-12 text-base",
  };

  const handleToggle = () => {
    if (disabled) return;
    const newMode = value === "warm" ? "sarcastic" : "warm";
    onChange(newMode);
  };

  return (
    <div className={cn("relative inline-flex", className)}>
      <button
        onClick={handleToggle}
        onMouseEnter={() => setShowTooltip(true)}
        onMouseLeave={() => setShowTooltip(false)}
        disabled={disabled}
        className={cn(
          "relative flex items-center gap-2 px-4 rounded-full border transition-all duration-300",
          sizeClasses[size],
          value === "warm"
            ? "bg-rose-50 border-rose-200 text-rose-700 dark:bg-rose-950/30 dark:border-rose-800 dark:text-rose-300"
            : "bg-amber-50 border-amber-200 text-amber-700 dark:bg-amber-950/30 dark:border-amber-800 dark:text-amber-300",
          disabled && "opacity-50 cursor-not-allowed",
          !disabled && "hover:shadow-md cursor-pointer"
        )}
        aria-label={`ÂàáÊç¢ËØ≠Ê∞îÊ®°ÂºèÔºåÂΩìÂâç: ${MODE_CONFIG[value].label}`}
      >
        {/* Emoji */}
        <motion.span
          key={value}
          initial={{ scale: 0.5, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          exit={{ scale: 0.5, opacity: 0 }}
          transition={{ type: "spring", stiffness: 500, damping: 30 }}
        >
          {MODE_CONFIG[value].emoji}
        </motion.span>

        {/* Label */}
        <motion.span
          key={`label-${value}`}
          initial={{ y: 10, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          exit={{ y: -10, opacity: 0 }}
          className="font-medium"
        >
          {MODE_CONFIG[value].label}
        </motion.span>

        {/* Toggle indicator */}
        <div className="w-4 h-4 rounded-full bg-current/20 flex items-center justify-center">
          <motion.div
            className="w-2 h-2 rounded-full bg-current"
            animate={{
              x: value === "warm" ? -2 : 2,
            }}
            transition={{ type: "spring", stiffness: 500, damping: 30 }}
          />
        </div>
      </button>

      {/* Tooltip */}
      <AnimatePresence>
        {showTooltip && (
          <motion.div
            initial={{ opacity: 0, y: 5 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: 5 }}
            className="absolute top-full left-1/2 -translate-x-1/2 mt-2 px-3 py-2 bg-popover border border-border rounded-lg shadow-lg text-xs text-muted-foreground whitespace-nowrap z-50"
          >
            <div className="font-medium text-foreground mb-1">
              {MODE_CONFIG[value].label}Ê®°Âºè
            </div>
            <div>{MODE_CONFIG[value].description}</div>
            <div className="mt-1 text-[10px] opacity-60">
              ÁÇπÂáªÂàáÊç¢Âà∞{MODE_CONFIG[value === "warm" ? "sarcastic" : "warm"].label}Ê®°Âºè
            </div>
            {/* Arrow */}
            <div className="absolute -top-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-popover border-l border-t border-border rotate-45" />
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}

/**
 * VoiceModeSwitch - Êõ¥Á¥ßÂáëÁöÑÂºÄÂÖ≥Ê†∑Âºè
 */
interface VoiceModeSwitchProps {
  value: VoiceMode;
  onChange: (mode: VoiceMode) => void;
  disabled?: boolean;
  className?: string;
}

export function VoiceModeSwitch({
  value,
  onChange,
  disabled = false,
  className,
}: VoiceModeSwitchProps) {
  return (
    <div
      className={cn(
        "inline-flex items-center gap-1 p-1 bg-muted rounded-full",
        disabled && "opacity-50",
        className
      )}
    >
      {(["warm", "sarcastic"] as VoiceMode[]).map((mode) => (
        <button
          key={mode}
          onClick={() => !disabled && onChange(mode)}
          disabled={disabled}
          className={cn(
            "relative px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-200",
            value === mode
              ? "text-white"
              : "text-muted-foreground hover:text-foreground"
          )}
        >
          {value === mode && (
            <motion.div
              layoutId="voice-mode-indicator"
              className={cn(
                "absolute inset-0 rounded-full",
                mode === "warm" ? "bg-rose-500" : "bg-amber-500"
              )}
              transition={{ type: "spring", stiffness: 500, damping: 30 }}
            />
          )}
          <span className="relative z-10 flex items-center gap-1">
            {MODE_CONFIG[mode].emoji}
            {MODE_CONFIG[mode].label}
          </span>
        </button>
      ))}
    </div>
  );
}

export default VoiceModeToggle;
