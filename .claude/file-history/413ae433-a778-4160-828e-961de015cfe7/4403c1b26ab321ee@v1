"""
Health Check Endpoints
"""
from fastapi import APIRouter
from stores.db import get_db

router = APIRouter()


@router.get("/health")
async def health_check():
    """Health check endpoint"""
    # Check database connection
    db_status = "ok"
    try:
        pool = await get_db()
        async with pool.acquire() as conn:
            await conn.fetchval("SELECT 1")
    except Exception as e:
        db_status = f"error: {str(e)}"

    return {
        "status": "ok" if db_status == "ok" else "degraded",
        "service": "vibelife-api",
        "version": "1.0.0",
        "database": db_status,
    }


@router.get("/health/live")
async def liveness():
    """Kubernetes liveness probe"""
    return {"status": "alive"}


@router.get("/health/ready")
async def readiness():
    """Kubernetes readiness probe"""
    try:
        pool = await get_db()
        async with pool.acquire() as conn:
            await conn.fetchval("SELECT 1")
        return {"status": "ready"}
    except Exception:
        return {"status": "not_ready"}
