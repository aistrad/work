/**
 * Greeting System - Dashboard v2.0
 *
 * æ—¶é—´æ„ŸçŸ¥çš„é—®å€™è¯­ç”Ÿæˆ
 */

/**
 * æ ¹æ®æ—¶é—´ç”Ÿæˆé—®å€™è¯­
 */
export function getGreeting(name?: string): string {
  const hour = new Date().getHours();
  const displayName = name || "æœ‹å‹";

  if (hour >= 5 && hour < 12) {
    return `æ—©å®‰ï¼Œ${displayName}`;
  } else if (hour >= 12 && hour < 14) {
    return `åˆå®‰ï¼Œ${displayName}`;
  } else if (hour >= 14 && hour < 18) {
    return `ä¸‹åˆå¥½ï¼Œ${displayName}`;
  } else if (hour >= 18 && hour < 22) {
    return `æ™šä¸Šå¥½ï¼Œ${displayName}`;
  } else {
    return `å¤œæ·±äº†ï¼Œ${displayName}`;
  }
}

/**
 * èŽ·å–é—®å€™è¯­çš„ emoji
 */
export function getGreetingEmoji(): string {
  const hour = new Date().getHours();

  if (hour >= 5 && hour < 12) {
    return "â˜€ï¸";
  } else if (hour >= 12 && hour < 14) {
    return "ðŸŒ¤ï¸";
  } else if (hour >= 14 && hour < 18) {
    return "â›…";
  } else if (hour >= 18 && hour < 22) {
    return "ðŸŒ™";
  } else {
    return "ðŸŒ›";
  }
}

/**
 * æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
 */
export function formatDate(date: Date = new Date()): string {
  const year = date.getFullYear();
  const month = date.getMonth() + 1;
  const day = date.getDate();
  const weekDay = ["å‘¨æ—¥", "å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­"][
    date.getDay()
  ];

  return `${year}å¹´${month}æœˆ${day}æ—¥ ${weekDay}`;
}

/**
 * èŽ·å–å½“å‰èŠ‚æ°”ï¼ˆç®€åŒ–ç‰ˆï¼‰
 * å®žé™…åº”ç”¨ä¸­åº”è¯¥ä»ŽåŽç«¯ API èŽ·å–ç²¾ç¡®çš„èŠ‚æ°”ä¿¡æ¯
 */
export function getSolarTerm(): string | undefined {
  const month = new Date().getMonth() + 1;
  const day = new Date().getDate();

  // ç®€åŒ–çš„èŠ‚æ°”æ˜ å°„ï¼ˆä»…ä½œç¤ºä¾‹ï¼‰
  const solarTerms: Record<string, [number, number, number, number]> = {
    å°å¯’: [1, 5, 1, 19],
    å¤§å¯’: [1, 20, 2, 3],
    ç«‹æ˜¥: [2, 4, 2, 18],
    é›¨æ°´: [2, 19, 3, 5],
    æƒŠè›°: [3, 6, 3, 20],
    æ˜¥åˆ†: [3, 21, 4, 4],
    æ¸…æ˜Ž: [4, 5, 4, 19],
    è°·é›¨: [4, 20, 5, 5],
    ç«‹å¤: [5, 6, 5, 20],
    å°æ»¡: [5, 21, 6, 5],
    èŠ’ç§: [6, 6, 6, 20],
    å¤è‡³: [6, 21, 7, 6],
    å°æš‘: [7, 7, 7, 22],
    å¤§æš‘: [7, 23, 8, 7],
    ç«‹ç§‹: [8, 8, 8, 22],
    å¤„æš‘: [8, 23, 9, 7],
    ç™½éœ²: [9, 8, 9, 22],
    ç§‹åˆ†: [9, 23, 10, 7],
    å¯’éœ²: [10, 8, 10, 23],
    éœœé™: [10, 24, 11, 7],
    ç«‹å†¬: [11, 8, 11, 22],
    å°é›ª: [11, 23, 12, 6],
    å¤§é›ª: [12, 7, 12, 21],
    å†¬è‡³: [12, 22, 1, 5],
  };

  for (const [term, [startMonth, startDay, endMonth, endDay]] of Object.entries(
    solarTerms
  )) {
    // è·¨å¹´æƒ…å†µ
    if (startMonth > endMonth) {
      if (
        (month === startMonth && day >= startDay) ||
        (month === endMonth && day <= endDay)
      ) {
        return term;
      }
    } else {
      if (
        (month === startMonth && day >= startDay) ||
        (month === endMonth && day <= endDay) ||
        (month > startMonth && month < endMonth)
      ) {
        return term;
      }
    }
  }

  return undefined;
}
