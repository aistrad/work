"use client";

import { useRouter } from "next/navigation";
import { cn } from "@/lib/utils";
import { useDashboard } from "@/hooks/useDashboard";
import { AmbientHeader } from "./ambient";
import { LifecoachCard } from "./lifecoach";
import { SkillCarousel, DiscoverCarousel } from "./skills";
import { DashboardSkeleton } from "./DashboardSkeleton";

interface DashboardContentProps {
  className?: string;
}

/**
 * DashboardContent - Dashboard 主内容组件
 *
 * 组合所有 Dashboard Layer 组件:
 * - Layer 0: AmbientHeader
 * - Layer 1: LifecoachCard
 * - Layer 2: SkillCarousel (My Skills)
 * - Layer 3: DiscoverCarousel
 */
export function DashboardContent({ className }: DashboardContentProps) {
  const router = useRouter();
  const {
    dashboard,
    isLoading,
    error,
    checkIn,
    toggleLever,
    toggleRock,
    subscribeSkill,
  } = useDashboard();

  // Loading state
  if (isLoading) {
    return <DashboardSkeleton />;
  }

  // Error state
  if (error) {
    return (
      <div className="rounded-2xl bg-white/90 p-8 text-center">
        <span className="text-3xl mb-2 block">⚠️</span>
        <p className="text-gray-600 mb-4">加载数据时出错</p>
        <button
          onClick={() => window.location.reload()}
          className="px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600"
        >
          重试
        </button>
      </div>
    );
  }

  // No data state
  if (!dashboard) {
    return <DashboardSkeleton />;
  }

  const handleSkillCardClick = (skillId: string) => {
    router.push(`/chat?skill=${skillId}`);
  };

  const handleNorthStarClick = () => {
    router.push("/chat?skill=lifecoach");
  };

  return (
    <div className={cn("space-y-4", className)}>
      {/* Layer 0: Ambient */}
      <AmbientHeader
        ambient={dashboard.ambient}
        status={dashboard.status}
        onCheckIn={checkIn}
      />

      {/* Layer 1: Lifecoach */}
      <LifecoachCard
        data={dashboard.lifecoach}
        onToggleLever={toggleLever}
        onToggleRock={toggleRock}
        onClickNorthStar={handleNorthStarClick}
      />

      {/* Layer 2: My Skills */}
      <SkillCarousel
        skills={dashboard.mySkills}
        onCardClick={handleSkillCardClick}
      />

      {/* Layer 3: Discover */}
      <DiscoverCarousel
        skills={dashboard.discover}
        onSubscribe={subscribeSkill}
      />
    </div>
  );
}

export default DashboardContent;
