"use client";

/**
 * EnhancedFortuneCard - ä¸ªæ€§åŒ–ä»Šæ—¥èƒ½é‡ç›˜
 *
 * ä¼˜åŒ–ç‚¹ï¼š
 * 1. æ ¹æ®ç”¨æˆ·å½“å‰å…³æ³¨é¢†åŸŸä¸ªæ€§åŒ–
 * 2. è¡ŒåŠ¨å¯¼å‘çš„å»ºè®®ï¼ˆè€Œéé€šç”¨æè¿°ï¼‰
 * 3. æ¸©æš–çš„æ¸å˜èƒŒæ™¯
 * 4. èƒ½é‡æ¡æ›¿ä»£æ˜Ÿçº§è¯„åˆ†
 */

import { useMemo } from "react";
import { cn } from "@/lib/utils";

interface FocusedArea {
  name: string;
  score: number;
  emoji: string;
  tip: string;
}

interface FortuneData {
  headline: string;          // "ä»Šå¤©é€‚åˆæ¨è¿›ä½ çš„åˆ›ä½œé¡¹ç›®"
  insights: string[];        // è¡ŒåŠ¨å»ºè®®
  rating: {
    overall: number;
    focused_area?: FocusedArea;
  };
}

interface EnhancedFortuneCardProps {
  data: FortuneData;
  className?: string;
}

export function EnhancedFortuneCard({ data, className }: EnhancedFortuneCardProps) {
  const { headline, insights, rating } = data;

  // å¦‚æœæ²¡æœ‰ focused_areaï¼Œä½¿ç”¨æ•´ä½“è¯„åˆ†
  const displayArea = rating.focused_area || {
    name: "ç»¼åˆèƒ½é‡",
    score: rating.overall,
    emoji: "ğŸŒŸ",
    tip: headline
  };

  return (
    <div className={cn(
      "bg-gradient-to-br from-amber-50 to-orange-50 rounded-lg p-3 mb-3 border border-amber-100",
      className
    )}>
      {/* ä¸ªæ€§åŒ–æ ‡é¢˜ */}
      <div className="flex items-center gap-2 mb-2">
        <span className="text-lg">{displayArea.emoji}</span>
        <span className="text-sm font-semibold text-amber-900">
          {displayArea.tip || headline}
        </span>
      </div>

      {/* å½“å‰å…³æ³¨é¢†åŸŸçš„èƒ½é‡è¯„åˆ† */}
      <div className="flex items-center gap-2 mb-3">
        <span className="text-xs text-amber-700 min-w-[60px]">
          {displayArea.name}
        </span>
        <EnergyBar value={displayArea.score} max={5} />
        <span className="text-xs font-medium text-amber-900">
          {displayArea.score}/5
        </span>
      </div>

      {/* è¡ŒåŠ¨å»ºè®® */}
      <div className="space-y-1">
        {insights.map((insight, i) => (
          <div key={i} className="flex items-start gap-2 text-xs text-amber-800">
            <span className="text-amber-500 mt-0.5">â€¢</span>
            <span>{insight}</span>
          </div>
        ))}
      </div>
    </div>
  );
}

// èƒ½é‡æ¡ç»„ä»¶
function EnergyBar({ value, max }: { value: number; max: number }) {
  const percentage = (value / max) * 100;

  return (
    <div className="flex-1 h-2 bg-amber-200 rounded-full overflow-hidden">
      <div
        className="h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all duration-500"
        style={{ width: `${percentage}%` }}
      />
    </div>
  );
}
