version: "1.0"
skill_id: core
description: 全局工具 - 所有 Skill 共享

# 搜索型工具
search:
  - name: search_db
    description: |
      从数据库检索知识或案例。
      - table='knowledge_chunks': 检索专业知识
      - table='cases': 检索参考案例
      LLM 根据 SOP 自己判断何时需要检索。
    parameters:
      - name: table
        type: string
        required: true
        description: 要查询的表
        enum:
          - knowledge_chunks
          - cases
      - name: query
        type: string
        required: true
        description: 检索查询词
      - name: filters
        type: object
        required: false
        description: 可选过滤条件，如 skill_id, scenario_id, tags 等
      - name: top_k
        type: integer
        required: false
        description: 返回结果数量
        default: 5

# 收集型工具
collect:
  - name: ask_user_question
    description: |
      主动向用户提问以获取更多信息。
      何时调用：
      - 用户意图不明确，需要澄清
      - 需要用户做出选择
      - 缺少必要信息无法继续
      提问原则：
      - 问题要具体、明确
      - 提供选项时不超过4个
      - 避免连续追问
    card_type: question_card
    parameters:
      - name: question
        type: string
        required: true
        description: 要问用户的问题
      - name: options
        type: array
        required: false
        description: 可选的选项列表（最多4个）

  - name: request_info
    description: |
      向用户请求信息。当需要收集出生信息或其他必要信息时调用。
    card_type: collect_form
    parameters:
      - name: info_type
        type: string
        required: true
        description: 信息类型
        enum:
          - birth
          - context
          - goals
          - concerns
      - name: question
        type: string
        required: false
        description: 自定义问题

# 展示型工具
display:
  - name: show_service_menu
    description: |
      展示服务目录卡片。
      何时调用：
      - 新用户首次进入
      - 用户询问"有什么服务"
      - 用户表现出不知道如何开始
    card_type: service_menu
    when_to_call: 新用户首次进入或询问有什么服务时
    parameters:
      - name: services
        type: array
        required: false
        description: 服务列表（可选，默认显示所有服务）

  - name: show_skill_services
    description: |
      展示当前 Skill 的服务目录。
      何时调用：
      - 用户主动选择进入某个 Skill 时
      - 用户询问"你能做什么"、"有什么服务"时
      - 用户表现出不知道如何开始时
      何时不调用：
      - 用户已经有明确需求时（如"帮我看看命盘"）
      - 对话已经在进行中时
    card_type: skill_services
    when_to_call: 用户主动进入 Skill 或询问有什么服务时
    parameters:
      - name: skill_id
        type: string
        required: true
        description: Skill ID (bazi/zodiac/tarot/career)

  - name: recommend_service
    description: |
      根据对话上下文，向用户推荐相关的升级服务。
      何时调用：
      - 完成一个 entry 级别服务后，检测到用户可能需要更深入分析
      - 用户表现出对某个话题的持续关注
      - 用户的问题超出当前服务范围
      推荐原则：
      - 一次只推荐一个最相关的服务
      - 推荐要自然，不能太商业化
    card_type: service_recommendation
    when_to_call: 完成基础服务后推荐升级服务
    parameters:
      - name: scenario_id
        type: string
        required: true
        description: 推荐的场景 ID
      - name: reason
        type: string
        required: true
        description: 推荐理由（对用户可见）
      - name: highlights
        type: array
        required: false
        description: 服务亮点（2-3个）

  - name: show_insight
    description: |
      展示洞察卡片。当需要突出关键发现或建议时调用。
    card_type: insight_card
    when_to_call: 需要突出关键发现或建议时
    parameters:
      - name: insight_type
        type: string
        required: true
        description: 洞察类型
        enum:
          - career
          - relationship
          - fortune
          - health
          - general
      - name: title
        type: string
        required: true
        description: 洞察标题
      - name: content
        type: string
        required: true
        description: 洞察内容

  - name: show_report
    description: |
      展示完整报告。当用户想查看详细分析报告时调用。
    card_type: report_card
    when_to_call: 用户想查看详细分析报告时
    parameters:
      - name: report_type
        type: string
        required: false
        description: 报告类型
        default: lite
        enum:
          - lite
          - full

  - name: show_relationship
    description: |
      展示关系分析结果。当用户想分析与他人的关系兼容性时调用。
    card_type: relationship_card
    when_to_call: 用户想分析与他人的关系兼容性时
    parameters:
      - name: partner_info
        type: object
        required: false
        description: 对方信息（姓名、出生日期等）
      - name: relationship_type
        type: string
        required: false
        description: 关系类型
        enum:
          - romantic
          - friendship
          - family
          - work
          - general

# ═══════════════════════════════════════════════════════════════════════════
# 用户数据工具 (复杂组合指令基础)
# ═══════════════════════════════════════════════════════════════════════════
action:
  - name: read_user_data
    description: |
      读取用户存储的数据。
      何时调用：
      - 用户询问自己的目标、计划、任务时
      - 需要获取用户之前保存的信息时
      - 查看打卡记录或进度时
    parameters:
      - name: path
        type: string
        required: true
        description: |
          数据路径，如：
          - goals/2026/year - 年度目标
          - goals/2026/q1 - 季度目标
          - plans/daily/2026-01-18 - 每日计划
          - checkins/2026-01-18 - 打卡记录

  - name: write_user_data
    description: |
      写入或更新用户数据。
      何时调用：
      - 用户设定新目标时
      - 用户修改计划时
      - 记录打卡或反思时
      - 保存用户的任何结构化信息时
    parameters:
      - name: path
        type: string
        required: true
        description: 数据路径
      - name: content
        type: object
        required: true
        description: |
          JSON 数据内容。建议包含：
          - title: 标题
          - status: 状态 (active/completed/archived)
          - items: 子项列表（如适用）
          - notes: 用户备注
      - name: data_type
        type: string
        required: false
        description: 数据类型（可选，默认从路径推断）
        enum:
          - goals
          - tasks
          - checkins
          - plans
          - reflections
          - files

  - name: query_user_data
    description: |
      查询用户数据。支持按类型、路径前缀、内容过滤。
      何时调用：
      - 列出用户所有目标
      - 查找特定时间段的计划
      - 搜索包含特定关键词的记录
    parameters:
      - name: data_type
        type: string
        required: false
        description: 数据类型过滤
        enum:
          - goals
          - tasks
          - checkins
          - plans
          - reflections
          - files
      - name: path_prefix
        type: string
        required: false
        description: 路径前缀过滤，如 "goals/2026"
      - name: filters
        type: object
        required: false
        description: JSONB 过滤条件，如 {"status": "active"}
      - name: limit
        type: integer
        required: false
        description: 返回数量限制
        default: 20

  - name: delete_user_data
    description: |
      删除用户数据。
      何时调用：
      - 用户明确要求删除某个目标或计划时
      注意：删除前应确认用户意图
    parameters:
      - name: path
        type: string
        required: true
        description: 要删除的数据路径

# ═══════════════════════════════════════════════════════════════════════════
# 提醒工具
# ═══════════════════════════════════════════════════════════════════════════
  - name: schedule_reminder
    description: |
      为用户设置定时提醒。
      何时调用：
      - 用户要求每日提醒打卡时
      - 设置目标截止日期提醒时
      - 用户说"提醒我"时
    parameters:
      - name: title
        type: string
        required: true
        description: 提醒标题
      - name: schedule
        type: string
        required: true
        description: |
          调度表达式：
          - daily: "08:00" (每天8点)
          - weekly: "1,3,5 09:00" (周一三五9点)
          - once: "2026-01-20T10:00:00" (一次性)
          - cron: "0 8 * * *" (cron 表达式)
      - name: schedule_type
        type: string
        required: true
        description: 调度类型
        enum:
          - once
          - daily
          - weekly
          - cron
      - name: reminder_type
        type: string
        required: false
        description: 提醒类型
        default: custom
        enum:
          - goal_checkin
          - daily_plan
          - milestone
          - custom
      - name: description
        type: string
        required: false
        description: 提醒描述
      - name: metadata
        type: object
        required: false
        description: 关联元数据，如 goal_id, task_id

  - name: list_reminders
    description: |
      列出用户的提醒。
      何时调用：
      - 用户询问"我有哪些提醒"时
      - 需要展示用户的提醒设置时
    parameters:
      - name: reminder_type
        type: string
        required: false
        description: 按类型过滤
        enum:
          - goal_checkin
          - daily_plan
          - milestone
          - custom
      - name: status
        type: string
        required: false
        description: 按状态过滤
        default: active
        enum:
          - active
          - paused
          - completed
          - cancelled

  - name: cancel_reminder
    description: |
      取消用户的提醒。
      何时调用：
      - 用户要求取消某个提醒时
      - 目标完成后自动取消关联提醒时
    parameters:
      - name: reminder_id
        type: string
        required: true
        description: 要取消的提醒 ID

# ═══════════════════════════════════════════════════════════════════════════
# 目标追踪展示工具
# ═══════════════════════════════════════════════════════════════════════════
  - name: show_goal_tree
    description: |
      展示目标树卡片。显示目标的层级结构和进度。
      何时调用：
      - 用户查看目标总览时
      - 展示目标分解结果时
    card_type: goal_tree
    parameters:
      - name: root_goal_path
        type: string
        required: false
        description: 根目标路径，默认显示所有年度目标

  - name: show_daily_plan
    description: |
      展示今日计划卡片。
      何时调用：
      - 用户询问今天做什么时
      - 早间计划推送时
    card_type: daily_plan
    parameters:
      - name: date
        type: string
        required: false
        description: 日期，默认今天。格式 YYYY-MM-DD

  - name: show_checkin_form
    description: |
      展示打卡表单卡片。让用户勾选完成的任务并写反思。
      何时调用：
      - 用户说"打卡"时
      - 晚间复盘提醒时
    card_type: checkin_form
    parameters:
      - name: date
        type: string
        required: false
        description: 打卡日期，默认今天。格式 YYYY-MM-DD
