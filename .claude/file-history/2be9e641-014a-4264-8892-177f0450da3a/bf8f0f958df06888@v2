version: "1.0"
skill_id: psych

# ============================================================
# 评估工具
# ============================================================
compute:
  - name: start_assessment
    description: |
      启动心理健康评估。当用户想做心理测试、PHQ-9、GAD-7、DASS-21 时调用。
      禁止自己编造问卷题目，必须通过此工具启动正式评估。
    card_type: assessment_form
    when_to_call: |
      - 用户请求做心理测试
      - 用户想了解自己的抑郁/焦虑程度
      - 用户提到 PHQ-9、GAD-7、DASS-21
      - 首次使用 Psych Skill（建议基线评估）
    parameters:
      - name: assessment_type
        type: string
        required: true
        description: "评估类型：phq2, gad2, phq9, gad7, dass21"
        enum: ["phq2", "gad2", "phq9", "gad7", "dass21"]

  - name: calculate_assessment
    description: |
      计算评估得分。当用户完成问卷回答后调用。
      禁止猜测或编造分数，必须基于用户实际回答计算。
    card_type: assessment_result
    when_to_call: |
      - 用户完成问卷回答后
      - 收到评估响应数据后
    parameters:
      - name: assessment_type
        type: string
        required: true
        description: "评估类型"
      - name: responses
        type: array
        required: true
        description: "用户对各题目的回答（0-3）"

  - name: analyze_thought
    description: |
      分析用户的负面想法，识别认知扭曲类型。
      当用户分享负面想法或自我批评时必须调用。
      禁止直接在文本中罗列认知扭曲，必须通过此工具分析。
    card_type: distortion_analysis
    when_to_call: |
      - 用户分享负面想法
      - 用户表达自我批评
      - 用户陷入负面思维循环
    parameters:
      - name: thought
        type: string
        required: true
        description: "用户的原始想法（原话）"
      - name: context
        type: string
        required: false
        description: "想法产生的情境"

# ============================================================
# 展示工具
# ============================================================
display:
  - name: show_assessment_result
    description: |
      展示评估结果卡片。评估完成后必须调用此工具展示结果。
      禁止只用文字描述评估结果。
    card_type: assessment_result
    when_to_call: |
      - 评估计算完成后
      - 用户要求查看之前的评估结果
    parameters:
      - name: assessment_type
        type: string
        required: true
        description: "评估类型"
      - name: total_score
        type: integer
        required: true
        description: "总分"
      - name: severity_level
        type: string
        required: true
        description: "严重程度"
      - name: interpretation
        type: string
        required: true
        description: "结果解读"
      - name: recommendations
        type: array
        required: true
        description: "建议列表"
      - name: subscales
        type: object
        required: false
        description: "分量表得分（DASS-21 用）"

  - name: show_distortion_analysis
    description: |
      展示认知扭曲分析卡片。分析完成后必须调用此工具展示。
      禁止只用文字描述分析结果。
    card_type: distortion_card
    when_to_call: |
      - analyze_thought 完成后
      - 需要展示认知扭曲分析结果
    parameters:
      - name: original_thought
        type: string
        required: true
        description: "原始想法"
      - name: distortions
        type: array
        required: true
        description: "识别的认知扭曲类型列表"
      - name: challenge_questions
        type: array
        required: true
        description: "挑战问题列表"
      - name: reframed_thought
        type: string
        required: false
        description: "重构后的想法"

  - name: show_exercise
    description: |
      展示心理练习卡片。当用户想做放松、正念、认知练习时调用。
      禁止只用文字描述练习步骤。
    card_type: exercise_card
    when_to_call: |
      - 用户请求做练习
      - 工作坊中需要展示练习
      - 推荐用户尝试某个技术时
    parameters:
      - name: exercise_type
        type: string
        required: true
        description: "练习类型"
        enum: ["breathing_478", "grounding_54321", "pmr", "behavioral_activation", "thought_record", "gratitude", "self_compassion", "shadow_projection", "worry_time"]
      - name: title
        type: string
        required: true
        description: "练习标题"
      - name: duration
        type: string
        required: false
        description: "预计时长"
      - name: instructions
        type: array
        required: false
        description: "练习步骤"

  - name: show_crisis_resources
    description: |
      展示危机资源卡片。当检测到自杀/自伤相关表达时必须立即调用。
      这是安全优先的工具，不可延迟。
    card_type: crisis_alert
    when_to_call: |
      - 检测到高风险关键词（自杀、想死、自伤等）
      - PHQ-9 第 9 题得分 >= 2
      - 用户表达绝望或无意义感
    parameters:
      - name: message
        type: string
        required: false
        description: "关怀消息"
      - name: risk_level
        type: string
        required: false
        description: "风险等级：high, medium"

# ============================================================
# 工作坊工具
# ============================================================
action:
  - name: start_workshop
    description: |
      启动专题工作坊。当用户想参加系统性的焦虑管理、情绪低落等课程时调用。
    card_type: workshop_intro
    when_to_call: |
      - 用户明确表示想参加工作坊
      - 评估结果建议参加特定工作坊
    parameters:
      - name: workshop_type
        type: string
        required: true
        description: "工作坊类型"
        enum: ["anxiety_management", "depression_coping", "stress_management", "relationship", "self_discovery"]

  - name: save_progress
    description: |
      保存用户进度。完成练习或工作坊模块后调用。
    when_to_call: |
      - 用户完成练习后
      - 用户完成工作坊模块后
    parameters:
      - name: progress_type
        type: string
        required: true
        description: "进度类型：exercise, workshop_module, assessment"
      - name: item_id
        type: string
        required: true
        description: "项目 ID"
      - name: data
        type: object
        required: false
        description: "相关数据"
