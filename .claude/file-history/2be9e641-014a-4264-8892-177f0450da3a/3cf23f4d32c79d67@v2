# VibeLife Skill 创建器

> 基于 zodiac, bazi, synastry, psych 等生产级 Skill 提取的最佳实践

快速创建高质量 VibeLife Skill 的标准化工作流。

## 触发方式

```
/vibelife-create
创建skill
新建skill
build skill
```

## 核心最佳实践 (从现有代码学习)

### 后端架构

| 模式 | 说明 | 参考 |
|------|------|------|
| **LLM 工具路由** | 禁止 Python 硬编码路由，只允许 LLM 决定 | 所有 Skill |
| **数据优先级链** | args → profile → skill_data → default | zodiac handlers.py |
| **卡片委托** | 展示工具统一委托 `show_card` | zodiac handlers.py |
| **_hint 通信** | 引导 AI 下一步动作（用户不可见） | zodiac handlers.py |
| **数据自包含** | 后端返回完整数据，前端不计算 | zodiac handlers.py |

### 前端架构

| 模式 | 说明 | 参考 |
|------|------|------|
| **双格式支持** | 同时支持 camelCase 和 snake_case | ZodiacChartCard |
| **映射表集中** | 支持多种输入格式的转换表 | ZodiacChartCard |
| **懒加载** | registerLazyCard 减少初始 bundle | initCards.ts |
| **文件结构** | Types → Constants → Helpers → Component → Register | 所有卡片 |

## 文件结构

```
.claude/skills/vibelife-create/
├── SKILL.md                           # 主入口，定义5阶段工作流
├── README.md                          # 使用指南
├── rules/
│   ├── workflow.md                    # 详细工作流 (Phase 1-5)
│   └── best-practices.md              # 最佳实践 (8章节，具体代码示例)
└── templates/
    ├── SKILL.md.template              # 后端 SKILL.md 模板 (强制工具规则+能力索引表)
    ├── tools.yaml.template            # 工具定义模板 (when_to_call 字段)
    ├── handlers.py.template           # 工具处理器模板 (数据优先级链+_hint)
    ├── rules-index.md.template        # 规则索引模板
    ├── rules-topic.md.template        # 规则主题模板 (frontmatter+分析表)
    ├── frontend-config.ts.template    # 前端配置模板
    ├── frontend-index.ts.template     # 前端入口模板
    ├── frontend-cards-index.ts.template # 卡片导出模板
    └── frontend-card.tsx.template     # 卡片组件模板 (双格式支持)
```

## 工作流程

### Phase 1: 需求收集 (~10分钟)

收集信息：
- Skill ID (小写，如 `psych`)
- 中文名称、描述、触发词
- 功能范围、工具类型
- 定价策略

### Phase 2: 设计文档 (~30分钟)

输出到 `docs/components/{skill_name}/`:
- README.md - 快速概览
- DESIGN.md - 完整设计
- 可选：KNOWLEDGE_BASE.md, TECHNICAL_SPEC.md

### Phase 3: 后端实现 (~45分钟)

创建 `apps/api/skills/{skill_name}/`:
```
├── SKILL.md           # 元数据 + 强制工具规则 + 能力索引表
├── tools/
│   ├── tools.yaml     # when_to_call + 参数默认值
│   └── handlers.py    # 数据优先级链 + _hint + show_card 委托
└── rules/
    ├── _index.md      # frontmatter 索引
    └── *.md           # 分析要点表 + 输出要求
```

### Phase 4: 前端实现 (~45分钟)

创建 `apps/web/src/skills/{skill_name}/`:
```
├── index.ts           # 入口
├── config.ts          # 配置
└── cards/
    ├── index.ts       # 导出
    └── *.tsx          # 双格式支持 + 映射表
```

更新:
- `CardRegistry.ts` - 添加卡片类型常量
- `initCards.ts` - registerLazyCard 懒加载注册

### Phase 5: 验证 (~10分钟)

- TypeScript 编译
- Python 语法检查
- 组件导入验证

## 关键检查清单

### SKILL.md
- [ ] 强制工具调用规则（加粗 + ⚠️ + 重复）
- [ ] 核心能力索引表（优先级 + 规则文件 + 触发场景）
- [ ] 工具快速参考表（分类 + 何时调用）
- [ ] 知识检索策略（Query 模板）

### tools.yaml
- [ ] when_to_call 字段（具体场景列表）
- [ ] compute/collect/display 三层分类
- [ ] 参数默认值

### handlers.py
- [ ] 数据优先级链：args → profile → default
- [ ] 前置检查快速失败
- [ ] _hint 内部通信
- [ ] 统一委托 show_card

### 前端卡片
- [ ] 类型定义支持 camelCase 和 snake_case
- [ ] 映射表支持多种输入格式
- [ ] registerLazyCard 懒加载

## 参考示例

| 组件 | 参考文件 |
|------|---------|
| SKILL.md | `apps/api/skills/zodiac/SKILL.md` |
| tools.yaml | `apps/api/skills/zodiac/tools/tools.yaml` |
| handlers.py | `apps/api/skills/zodiac/tools/handlers.py` |
| rules | `apps/api/skills/zodiac/rules/basic-reading.md` |
| 前端卡片 | `apps/web/src/skills/zodiac/cards/ZodiacChartCard.tsx` |

## 详细文档

- `@rules/workflow.md` - 完整工作流程
- `@rules/best-practices.md` - 编码最佳实践（8章节，具体代码示例）
- `@templates/` - 代码模板
