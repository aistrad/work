"use client"

import { cn } from "@/lib/utils"
import { useAppStore } from "@/stores/app-store"

export function StatusTab() {
  const { status } = useAppStore()

  return (
    <div className="p-4 space-y-6">
      {/* L1 å…ƒæ•°æ® */}
      <section>
        <h2 className="text-lg font-semibold mb-4">å…ƒæ•°æ®</h2>
        <div className="grid grid-cols-2 gap-3">
          <MetadataCard
            icon="â™ˆ"
            label="æ˜Ÿåº§"
            value="ç™½ç¾Šåº§"
            description="ç«è±¡ãƒ»å¼€åˆ›å‹"
          />
          <MetadataCard
            icon="ğŸ”®"
            label="MBTI"
            value="INFJ"
            description="æå€¡è€…"
          />
          <MetadataCard
            icon="ğŸ‹"
            label="å…«å­—"
            value="ç”²æœ¨æ—¥ä¸»"
            description="èº«å¼ºãƒ»å–œæ°´æœ¨"
          />
          <MetadataCard
            icon="ğŸ”¢"
            label="ç”Ÿå‘½æ•°å­—"
            value="7"
            description="æ¢ç´¢è€…"
          />
        </div>
      </section>

      {/* L2 åŠ¨æ€çŠ¶æ€ */}
      <section>
        <h2 className="text-lg font-semibold mb-4">åŠ¨æ€çŠ¶æ€</h2>
        <div className="space-y-4">
          <StatusDimension
            label="èƒ½é‡"
            value={status.energy}
            change={+5}
            reason="è§„å¾‹ä½œæ¯"
            color="bg-status-foreground"
          />
          <StatusDimension
            label="æƒ…ç»ª"
            value={status.emotion}
            change={+3}
            reason="å†¥æƒ³ç»ƒä¹ "
            color="bg-advice-foreground"
          />
          <StatusDimension
            label="è¿æ¥"
            value={status.connection}
            change={-2}
            reason="ç¤¾äº¤å‡å°‘"
            color="bg-mystic-foreground"
          />
          <StatusDimension
            label="æˆé•¿"
            value={status.growth}
            change={+8}
            reason="å®Œæˆè¯¾ç¨‹"
            color="bg-alert-foreground"
          />
          <StatusDimension
            label="è¿åŠ¿"
            value={status.fortune}
            change={0}
            reason="å¹³ç¨³"
            color="bg-foreground"
          />
        </div>
      </section>
    </div>
  )
}

function MetadataCard({
  icon,
  label,
  value,
  description,
}: {
  icon: string
  label: string
  value: string
  description: string
}) {
  return (
    <div className="p-3 rounded-lg bg-sidebar">
      <div className="flex items-center gap-2 mb-2">
        <span className="text-lg">{icon}</span>
        <span className="text-xs text-muted-foreground">{label}</span>
      </div>
      <div className="font-medium text-foreground">{value}</div>
      <div className="text-xs text-muted-foreground mt-0.5">{description}</div>
    </div>
  )
}

function StatusDimension({
  label,
  value,
  change,
  reason,
  color,
}: {
  label: string
  value: number
  change: number
  reason: string
  color: string
}) {
  return (
    <div className="p-4 rounded-lg bg-sidebar">
      <div className="flex items-center justify-between mb-2">
        <span className="font-medium text-foreground">{label}</span>
        <div className="flex items-center gap-2">
          <span className="text-lg font-semibold">{value}</span>
          {change !== 0 && (
            <span
              className={cn(
                "text-xs px-1.5 py-0.5 rounded",
                change > 0
                  ? "bg-status text-status-foreground"
                  : "bg-alert text-alert-foreground"
              )}
            >
              {change > 0 ? `+${change}` : change}
            </span>
          )}
        </div>
      </div>
      <div className="h-2 bg-hover rounded-full overflow-hidden mb-2">
        <div
          className={cn("h-full rounded-full transition-all duration-500", color)}
          style={{ width: `${value}%` }}
        />
      </div>
      <div className="text-xs text-muted-foreground">
        {change !== 0 ? `å› ${reason}` : reason}
      </div>
    </div>
  )
}
