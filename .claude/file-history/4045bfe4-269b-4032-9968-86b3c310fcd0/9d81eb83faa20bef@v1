"""
Mentis OS v3.0 - Pytest 配置
"""

import pytest
import sys
import os

# 添加项目路径
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))


@pytest.fixture(autouse=True)
def mock_db(monkeypatch):
    """Mock 数据库连接"""
    # 简单的 mock，避免实际数据库连接
    def mock_fetch_one(*args, **kwargs):
        return None

    def mock_fetch_all(*args, **kwargs):
        return []

    def mock_execute(*args, **kwargs):
        return 0

    def mock_execute_returning_one(*args, **kwargs):
        return {"id": "test-id"}

    try:
        from stores import mentis_db
        monkeypatch.setattr(mentis_db, "fetch_one", mock_fetch_one)
        monkeypatch.setattr(mentis_db, "fetch_all", mock_fetch_all)
        monkeypatch.setattr(mentis_db, "execute", mock_execute)
        monkeypatch.setattr(mentis_db, "execute_returning_one", mock_execute_returning_one)
    except ImportError:
        pass


@pytest.fixture
def sample_emotion():
    """示例情绪结果"""
    from services.emotion_engine import EmotionResult
    return EmotionResult(
        primary="anger",
        intensity=7,
        secondary=["frustration"],
        confidence=0.85,
        energy_delta=-4,
    )


@pytest.fixture
def sample_user_id():
    """示例用户 ID"""
    return "550e8400-e29b-41d4-a716-446655440000"
