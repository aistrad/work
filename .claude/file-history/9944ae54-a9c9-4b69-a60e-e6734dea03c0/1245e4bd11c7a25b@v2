/**
 * StreakCelebrationCard - è¿ç»­æ‰“å¡åº†ç¥å¡ç‰‡
 *
 * åº†ç¥ç”¨æˆ·è¾¾æˆè¿ç»­æ‰“å¡é‡Œç¨‹ç¢‘
 * é€šè¿‡ CardRegistry æ³¨å†Œï¼Œç”± card_type: "streak_celebration" è§¦å‘
 */

"use client";

import { motion } from "framer-motion";
import { registerCard } from "@/skills/CardRegistry";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Types
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface StreakCelebrationData {
  streak_days: number;
  total_minutes?: number;
  total_sessions?: number;
  milestone_type?: "3day" | "7day" | "14day" | "21day" | "30day" | "custom";
  celebration_message?: string;
  next_milestone?: {
    days: number;
    days_remaining: number;
  };
  achievements?: string[];
}

interface StreakCelebrationCardProps {
  data: StreakCelebrationData;
  cardProps?: Record<string, unknown>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Constants
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const MILESTONE_EMOJIS: Record<string, string> = {
  "3day": "ğŸŒ±",
  "7day": "ğŸŒ¿",
  "14day": "ğŸŒ³",
  "21day": "ğŸ†",
  "30day": "ğŸ‘‘",
  "custom": "â­",
};

const MILESTONE_TITLES: Record<string, string> = {
  "3day": "åˆå¿ƒèŒèŠ½",
  "7day": "ä¹ æƒ¯å…»æˆ",
  "14day": "åšæŒä¸æ‡ˆ",
  "21day": "é«˜æ‰‹ä¹‹è·¯",
  "30day": "æ­£å¿µå¤§å¸ˆ",
  "custom": "é‡Œç¨‹ç¢‘",
};

const MILESTONE_MESSAGES: Record<string, string> = {
  "3day": "å¤ªæ£’äº†ï¼è¿ç»­3å¤©çš„åšæŒï¼Œä½ å·²ç»è¿ˆå‡ºäº†æœ€é‡è¦çš„ç¬¬ä¸€æ­¥ï¼",
  "7day": "ä¸€å‘¨çš„åšæŒï¼æ­£å¿µå·²ç»å¼€å§‹èå…¥ä½ çš„ç”Ÿæ´»èŠ‚å¥ã€‚",
  "14day": "è¿ç»­ä¸¤å‘¨ï¼ä½ æ­£åœ¨å»ºç«‹ä¸€ä¸ªå¼ºå¤§çš„ä¹ æƒ¯ã€‚",
  "21day": "21å¤©ï¼ä¹ æƒ¯å½¢æˆçš„å…³é”®æœŸï¼Œä½ åšåˆ°äº†ï¼",
  "30day": "è¿ç»­30å¤©ï¼ä½ å·²ç»æˆä¸ºæ­£å¿µçš„è·µè¡Œè€…ï¼",
  "custom": "æ­å–œä½ è¾¾æˆè¿™ä¸ªé‡è¦çš„é‡Œç¨‹ç¢‘ï¼",
};

const CELEBRATION_COLORS = [
  "#FF6B6B", "#4ECDC4", "#45B7D1", "#FFA07A", "#98D8C8",
  "#F7DC6F", "#BB8FCE", "#85C1E2", "#F8B739", "#52C79F"
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Component
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function StreakCelebrationCard({ data }: StreakCelebrationCardProps) {
  // V7: é”™è¯¯çŠ¶æ€æ£€æŸ¥
  if ((data as any)?.status === "error" || (data as any)?.need_info) {
    return null;
  }

  const milestoneType = data.milestone_type || "custom";
  const emoji = MILESTONE_EMOJIS[milestoneType];
  const title = MILESTONE_TITLES[milestoneType];
  const message = data.celebration_message || MILESTONE_MESSAGES[milestoneType];

  return (
    <motion.div
      initial={{ opacity: 0, scale: 0.9 }}
      animate={{ opacity: 1, scale: 1 }}
      transition={{ duration: 0.6, type: "spring" }}
      className="streak-celebration-card bg-gradient-to-br from-yellow-50 via-orange-50 to-pink-50 dark:from-yellow-950/30 dark:via-orange-950/30 dark:to-pink-950/30 rounded-xl border-2 border-yellow-300 dark:border-yellow-700 p-6 my-2 relative overflow-hidden"
    >
      {/* Confetti Background */}
      <div className="absolute inset-0 pointer-events-none overflow-hidden">
        {Array.from({ length: 20 }).map((_, i) => (
          <motion.div
            key={i}
            initial={{
              x: Math.random() * 100 + "%",
              y: -20,
              rotate: Math.random() * 360,
              opacity: 1,
            }}
            animate={{
              y: "120%",
              rotate: Math.random() * 360 + 360,
              opacity: 0,
            }}
            transition={{
              duration: 3 + Math.random() * 2,
              delay: Math.random() * 2,
              repeat: Infinity,
              repeatDelay: Math.random() * 3,
            }}
            className="absolute w-2 h-2 rounded-full"
            style={{
              backgroundColor: CELEBRATION_COLORS[i % CELEBRATION_COLORS.length],
            }}
          />
        ))}
      </div>

      {/* Content */}
      <div className="relative z-10">
        {/* Emoji with pulse animation */}
        <motion.div
          initial={{ scale: 0 }}
          animate={{ scale: [0, 1.2, 1] }}
          transition={{ duration: 0.6, times: [0, 0.6, 1] }}
          className="text-center mb-4"
        >
          <div className="text-6xl">{emoji}</div>
        </motion.div>

        {/* Title */}
        <motion.h3
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.3 }}
          className="text-2xl font-bold text-center mb-2 bg-gradient-to-r from-yellow-600 via-orange-500 to-pink-500 bg-clip-text text-transparent"
        >
          {title}
        </motion.h3>

        {/* Streak Days */}
        <motion.div
          initial={{ opacity: 0, scale: 0.8 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ delay: 0.5 }}
          className="text-center mb-4"
        >
          <div className="inline-flex items-center gap-2 px-4 py-2 bg-white/80 dark:bg-black/40 rounded-full shadow-lg">
            <span className="text-3xl">ğŸ”¥</span>
            <span className="text-3xl font-bold text-orange-600 dark:text-orange-400">
              {data.streak_days}
            </span>
            <span className="text-lg text-muted-foreground">å¤©è¿ç»­</span>
          </div>
        </motion.div>

        {/* Message */}
        <motion.div
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.7 }}
          className="text-center mb-4"
        >
          <p className="text-sm text-accent-700 dark:text-accent-300 leading-relaxed">
            {message}
          </p>
        </motion.div>

        {/* Stats */}
        <motion.div
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.9 }}
          className="grid grid-cols-2 gap-3 mb-4"
        >
          {data.total_sessions !== undefined && (
            <div className="bg-white/60 dark:bg-black/30 rounded-lg p-3 text-center">
              <div className="text-2xl font-bold text-blue-600 dark:text-blue-400">
                {data.total_sessions}
              </div>
              <div className="text-xs text-muted-foreground">æ€»ç»ƒä¹ æ¬¡æ•°</div>
            </div>
          )}
          {data.total_minutes !== undefined && (
            <div className="bg-white/60 dark:bg-black/30 rounded-lg p-3 text-center">
              <div className="text-2xl font-bold text-green-600 dark:text-green-400">
                {data.total_minutes}
              </div>
              <div className="text-xs text-muted-foreground">æ€»ç»ƒä¹ åˆ†é’Ÿ</div>
            </div>
          )}
        </motion.div>

        {/* Achievements */}
        {data.achievements && data.achievements.length > 0 && (
          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 1.1 }}
            className="bg-yellow-100/60 dark:bg-yellow-900/30 rounded-lg p-3 mb-4"
          >
            <div className="text-sm font-medium text-yellow-700 dark:text-yellow-300 mb-2 flex items-center gap-1">
              <span>ğŸ‰</span>
              <span>ä½ çš„æˆå°±</span>
            </div>
            <ul className="space-y-1">
              {data.achievements.map((achievement, idx) => (
                <motion.li
                  key={idx}
                  initial={{ opacity: 0, x: -10 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 1.2 + idx * 0.1 }}
                  className="text-xs text-accent-700 dark:text-accent-300 flex items-start gap-2"
                >
                  <span className="text-yellow-600 dark:text-yellow-400">âœ¨</span>
                  <span>{achievement}</span>
                </motion.li>
              ))}
            </ul>
          </motion.div>
        )}

        {/* Next Milestone */}
        {data.next_milestone && (
          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 1.3 }}
            className="bg-gradient-to-r from-purple-100/80 to-pink-100/80 dark:from-purple-900/30 dark:to-pink-900/30 rounded-lg p-3 text-center"
          >
            <div className="text-xs text-muted-foreground mb-1">ä¸‹ä¸€ä¸ªé‡Œç¨‹ç¢‘</div>
            <div className="font-semibold text-purple-700 dark:text-purple-300">
              è¿ç»­ {data.next_milestone.days} å¤©
            </div>
            <div className="text-xs text-muted-foreground mt-1">
              è¿˜å·® {data.next_milestone.days_remaining} å¤©
            </div>
            <div className="mt-2 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
              <motion.div
                initial={{ width: 0 }}
                animate={{
                  width: `${
                    ((data.streak_days) / data.next_milestone.days) * 100
                  }%`,
                }}
                transition={{ delay: 1.5, duration: 0.8 }}
                className="h-full bg-gradient-to-r from-purple-500 to-pink-500"
              />
            </div>
          </motion.div>
        )}

        {/* Encouraging Message */}
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 1.7 }}
          className="mt-4 text-center"
        >
          <p className="text-xs text-muted-foreground italic">
            &ldquo;æ¯ä¸€æ¬¡ç»ƒä¹ ï¼Œéƒ½æ˜¯å¯¹è‡ªå·±çš„æŠ•èµ„ã€‚ç»§ç»­åŠ æ²¹ï¼&rdquo;
          </p>
        </motion.div>
      </div>
    </motion.div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Register to CardRegistry
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

registerCard("streak_celebration", StreakCelebrationCard);

export default StreakCelebrationCard;
