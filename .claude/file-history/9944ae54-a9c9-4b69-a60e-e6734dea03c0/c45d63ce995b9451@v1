#!/usr/bin/env python3
"""æµ‹è¯•å‰ç«¯å¡ç‰‡æ³¨å†Œæƒ…å†µ"""
import os
import re

# æ£€æŸ¥æ‰€æœ‰æ–°å¢çš„å¡ç‰‡æ–‡ä»¶
card_files = {
    "tarot": [
        "/home/aiscend/work/vibelife/apps/web/src/skills/tarot/cards/TarotSpreadCard.tsx",
    ],
    "career": [
        "/home/aiscend/work/vibelife/apps/web/src/skills/career/cards/CareerAnalysisCard.tsx",
        "/home/aiscend/work/vibelife/apps/web/src/skills/career/cards/PersonalityProfileCard.tsx",
    ],
    "mindfulness": [
        "/home/aiscend/work/vibelife/apps/web/src/skills/mindfulness/cards/PracticeGuideCard.tsx",
        "/home/aiscend/work/vibelife/apps/web/src/skills/mindfulness/cards/MindfulnessStatsCard.tsx",
        "/home/aiscend/work/vibelife/apps/web/src/skills/mindfulness/cards/StreakCelebrationCard.tsx",
        "/home/aiscend/work/vibelife/apps/web/src/skills/mindfulness/cards/EmotionCheckCard.tsx",
    ],
}

print("\n" + "="*70)
print("å‰ç«¯å¡ç‰‡æ³¨å†Œæµ‹è¯•")
print("="*70 + "\n")

registered_cards = []

for skill, files in card_files.items():
    print(f"ğŸ“¦ {skill.upper()}")
    for file_path in files:
        card_name = os.path.basename(file_path).replace('.tsx', '')

        if os.path.exists(file_path):
            with open(file_path, 'r', encoding='utf-8') as f:
                content = f.read()

            # æ£€æŸ¥ registerCard è°ƒç”¨
            register_match = re.search(r'registerCard\(["\']([^"\']+)["\']', content)

            if register_match:
                card_type = register_match.group(1)
                print(f"  âœ… {card_name:30} â†’ {card_type}")
                registered_cards.append(card_type)
            else:
                print(f"  âŒ {card_name:30} â†’ NOT REGISTERED!")
        else:
            print(f"  âŒ {card_name:30} â†’ FILE NOT FOUND!")

    print()

# æ£€æŸ¥ index.ts æ–‡ä»¶
index_files = {
    "tarot": "/home/aiscend/work/vibelife/apps/web/src/skills/tarot/cards/index.ts",
    "career": "/home/aiscend/work/vibelife/apps/web/src/skills/career/cards/index.ts",
    "mindfulness": "/home/aiscend/work/vibelife/apps/web/src/skills/mindfulness/cards/index.ts",
}

print("ğŸ“‹ Index æ–‡ä»¶æ£€æŸ¥")
for skill, index_path in index_files.items():
    if os.path.exists(index_path):
        print(f"  âœ… {skill}/cards/index.ts exists")
    else:
        print(f"  âŒ {skill}/cards/index.ts NOT FOUND!")

print()

# æ£€æŸ¥ initCards.ts
init_cards_path = "/home/aiscend/work/vibelife/apps/web/src/skills/initCards.ts"
if os.path.exists(init_cards_path):
    with open(init_cards_path, 'r', encoding='utf-8') as f:
        init_content = f.read()

    print("ğŸ“¥ initCards.ts å¯¼å…¥æ£€æŸ¥")
    for skill in ["tarot", "career", "mindfulness"]:
        import_pattern = f"import './{skill}/cards'"
        if import_pattern in init_content:
            print(f"  âœ… {skill}/cards imported")
        else:
            print(f"  âŒ {skill}/cards NOT imported!")

print()
print("="*70)
print(f"æ€»è®¡æ³¨å†Œçš„å¡ç‰‡: {len(registered_cards)}")
print(f"æ³¨å†Œçš„ card_type: {', '.join(registered_cards)}")
print("="*70 + "\n")
