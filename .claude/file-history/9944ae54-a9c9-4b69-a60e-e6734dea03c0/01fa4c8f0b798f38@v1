version: "2.0"
skill_id: vibe_id
description: VibeID 人格画像工具 (V7 架构)

# ═══════════════════════════════════════════════════════════════════════════
# 计算工具
# ═══════════════════════════════════════════════════════════════════════════
compute:
  - name: calculate_vibe_id
    description: |
      计算用户的 VibeID 四维人格画像。

      前置条件:
      - skill_data.bazi.chart 或 skill_data.zodiac.chart 至少存在一个

      流程:
      1. 从 skill_data 读取 bazi.chart 和 zodiac.chart
      2. 使用 BaziAnalyzer 和 ZodiacAnalyzer 分析原型
      3. 使用 FusionEngine 融合计算
      4. 写入 skill_data.vibe_id

      如果前置数据不存在，返回错误提示用户先完成八字或星盘分析。
    parameters:
      - name: force_recalculate
        type: boolean
        default: false
        description: 是否强制重新计算（忽略缓存）
    returns:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        data:
          type: object
          description: VibeID 画像数据
        cached:
          type: boolean
          description: 是否来自缓存

  - name: get_archetype_info
    description: |
      获取指定原型的详细信息（从配置加载）。
      包括中文名、描述、超能力、成长点、最佳匹配等。
    parameters:
      - name: archetype_id
        type: string
        required: true
        description: 原型ID
        enum:
          - Innocent
          - Explorer
          - Sage
          - Hero
          - Outlaw
          - Magician
          - Regular
          - Lover
          - Jester
          - Caregiver
          - Creator
          - Ruler
    returns:
      type: object
      description: 原型详细信息

# ═══════════════════════════════════════════════════════════════════════════
# 展示工具 - 委托给 show_card (V7 模式)
# ═══════════════════════════════════════════════════════════════════════════
display:
  - name: show_skill_intro
    description: |
      展示 Skill 介绍卡片。用于首次使用或用户想了解功能时。
      卡片包含：功能介绍、快速开始提示、订阅状态。
    type: display
    card_type: skill_intro
    when_to_call: |
      - 用户首次使用此 Skill 时
      - 用户问"这个能做什么"、"有什么功能"时
      - 用户说"介绍一下"、"帮助"时
    parameters:
      - name: variant
        type: string
        enum: [full, compact, mini]
        default: compact
        description: 卡片变体（full=完整版, compact=精简版, mini=迷你版）
      - name: reason
        type: string
        description: 展示原因（如"首次使用"、"功能介绍"）

  - name: show_vibe_id
    description: |
      展示用户的 VibeID 人格画像卡片。
      内部委托给 show_card(custom, vibe_id_card)。
      Handler 先从 unified_profiles.skill_data 读取数据，再用 inline 方式传给 show_card。
    card_type: custom
    when_to_call: |
      - 用户说"看看我的人格画像"
      - 用户说"我的VibeID是什么"
      - 用户说"分析我的性格"
      - 用户说"我是什么原型"
    parameters: []
    # V7: 委托给 show_card，使用 inline 数据源
    delegates_to: show_card
    delegate_params:
      card_type: custom
      data_source:
        type: inline
        # data 由 handler 动态填充
      options:
        componentId: vibe_id_card

  - name: show_archetype_radar
    description: |
      展示用户的12原型雷达图。
      内部委托给 show_card(chart, radar)。
      Handler 先从 unified_profiles.skill_data 读取数据，再用 inline 方式传给 show_card。
    card_type: chart
    when_to_call: |
      - 用户说"看看我的原型分布"
      - 用户说"我的12原型得分"
      - 用户说"原型雷达图"
    parameters: []
    # V7: 委托给 show_card，使用 inline 数据源
    delegates_to: show_card
    delegate_params:
      card_type: chart
      data_source:
        type: inline
        # data 由 handler 动态填充
      options:
        chartType: radar
        title: 12原型能量分布
