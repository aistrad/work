/**
 * 注册所有 Skill 卡片组件 (V7 重构版)
 *
 * v7.0 架构：
 * - 通用视图组件由 ShowCard 直接处理，无需注册
 * - Skill 自定义卡片通过 CardRegistry 注册
 * - 向后兼容旧卡片组件
 */

import { registerCard, getRegisteredCardTypes, CARD_TYPES } from './CardRegistry';

// 通用视图组件 (由 ShowCard 直接处理)
import ShowCard from './shared/ShowCard';

// 向后兼容: 旧卡片组件
import CollectFormCard from './shared/CollectFormCard';
import InsightCard from './shared/InsightCard';
import ReportCard from './panels/ReportPanel';
import SkillServicesCard from './shared/SkillServicesCard';
import ServiceRecommendationCard from './shared/ServiceRecommendationCard';
import SkillRecommendationCard from './shared/SkillRecommendationCard';

// 边界控制卡片 (V7.1)
import SkillListCard from './shared/SkillListCard';

// Skill 卡片 - 导入即注册
import './bazi/cards';
import './zodiac/cards';
import './jungastro/cards';
import './lifecoach/cards';
import './tarot/cards';

// VibeID 卡片
import { ShowVibeID } from './vibe-id/tools/show-vibe-id';

// SkillIntroCard
import SkillIntroCard from './shared/SkillIntroCard';

// 通用视图类型列表
const GENERIC_VIEW_TYPES = [
  CARD_TYPES.LIST,
  CARD_TYPES.TREE,
  CARD_TYPES.TABLE,
  CARD_TYPES.TIMELINE,
  CARD_TYPES.FORM,
  CARD_TYPES.SELECT,
  CARD_TYPES.CHART,
  CARD_TYPES.PROGRESS,
  CARD_TYPES.COUNTER,
  CARD_TYPES.MODAL,
  CARD_TYPES.TOAST,
  CARD_TYPES.CUSTOM,
] as const;

// 向后兼容卡片映射
const LEGACY_CARDS: Record<string, React.FC<any>> = {
  [CARD_TYPES.COLLECT_FORM]: CollectFormCard,
  [CARD_TYPES.INSIGHT_CARD]: InsightCard,
  [CARD_TYPES.REPORT_CARD]: ReportCard,
  [CARD_TYPES.SKILL_SERVICES]: SkillServicesCard,
  [CARD_TYPES.SERVICE_RECOMMENDATION]: ServiceRecommendationCard,
  [CARD_TYPES.SKILL_RECOMMENDATION]: SkillRecommendationCard,
  [CARD_TYPES.SKILL_LIST]: SkillListCard,
};

/**
 * 初始化卡片注册表
 * 在应用启动时调用
 */
export function initializeCardRegistry(): void {
  // 注册通用视图组件 (V7)
  for (const type of GENERIC_VIEW_TYPES) {
    registerCard(type, ShowCard);
  }

  // 注册向后兼容卡片
  for (const [type, component] of Object.entries(LEGACY_CARDS)) {
    registerCard(type, component);
  }

  // 注册 VibeID 卡片
  registerCard(CARD_TYPES.VIBE_ID, ShowVibeID);
  registerCard(CARD_TYPES.VIBE_ID_RADAR, ShowVibeID);

  // 注册 SkillIntroCard
  registerCard(CARD_TYPES.SKILL_INTRO, SkillIntroCard);

  if (process.env.NODE_ENV === 'development') {
    console.log('[CardRegistry] V7 Initialized:', getRegisteredCardTypes());
  }
}

// 导出 ShowCard 供直接使用
export { ShowCard };

export default initializeCardRegistry;
