/**
 * 后端 API 配置
 *
 * 统一管理所有后端 API 地址配置，避免硬编码分散在各个文件中。
 *
 * 环境变量说明：
 * - VIBELIFE_API_INTERNAL: Next.js 服务端调用后端 API 的内部地址
 * - NEXT_PUBLIC_API_BASE: 客户端调用后端 API 的公开地址
 */

// 服务端内部 API 地址 (用于 Next.js API Routes)
// 注意：此变量不带 NEXT_PUBLIC_ 前缀，仅在服务端可用
export const API_INTERNAL = process.env.VIBELIFE_API_INTERNAL || "http://127.0.0.1:8000";

// 客户端公开 API 地址 (用于浏览器端请求)
export const API_PUBLIC = process.env.NEXT_PUBLIC_API_BASE || "http://localhost:8000/api/v1";

// API 路径常量
export const API_PATHS = {
  // 认证相关
  AUTH: {
    LOGIN: "/api/v1/account/auth/login",
    REGISTER: "/api/v1/account/auth/register",
    REFRESH: "/api/v1/account/auth/refresh",
    LOGOUT: "/api/v1/account/auth/logout",
    ME: "/api/v1/account/auth/me",
    OAUTH_GOOGLE: "/api/v1/account/auth/oauth/google",
    OAUTH_APPLE: "/api/v1/account/auth/oauth/apple",
    SSO_CALLBACK: "/api/v1/account/auth/sso/callback",
  },

  // 访客会话
  GUEST: {
    SESSION: "/api/v1/account/guest/session",
  },

  // 通知
  NOTIFICATIONS: {
    LIST: "/api/v1/notifications",
    READ: (id: string) => `/api/v1/notifications/${id}/read`,
    DAILY: "/api/v1/notifications/daily",
  },

  // 支付
  PAYMENT: {
    CREATE_CHECKOUT: "/api/v1/commerce/payment/create-checkout",
    CONFIG: "/api/v1/commerce/payment/config",
    VERIFY: "/api/v1/commerce/payment/verify",
  },

  // 聊天
  CHAT: {
    STREAM: "/api/v1/chat/v5/stream",
    GUEST: "/api/v1/chat/guest",
  },

  // 工具
  TOOLS: {
    SCHEMA: "/api/v1/tools/schema",
  },

  // 面试
  INTERVIEW: {
    START: "/api/v1/interview/start",
    ANSWER: "/api/v1/interview/answer",
  },

  // 关系分析
  RELATIONSHIP: {
    ANALYZE: "/api/v1/relationship/analyze",
  },
} as const;

// 构建完整的内部 API URL
export function getInternalApiUrl(path: string): string {
  return `${API_INTERNAL}${path}`;
}

// 构建完整的公开 API URL
export function getPublicApiUrl(path: string): string {
  // 去掉 /api/v1 前缀，因为 API_PUBLIC 已经包含了
  const cleanPath = path.replace(/^\/api\/v1/, "");
  return `${API_PUBLIC}${cleanPath}`;
}
