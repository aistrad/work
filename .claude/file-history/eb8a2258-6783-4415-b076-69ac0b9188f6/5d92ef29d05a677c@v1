"use client";

import Link from "next/link";
import { ArrowLeft, FileText } from "lucide-react";
import { LuminousPaper, VibeGlyph, BreathAura, type SkillType } from "@/components/core";
import { IconButton } from "@/components/ui/Button";

// ═══════════════════════════════════════════════════════════════════════════
// ChatLayout - LUMINOUS PAPER Design System
// 统一聊天页面布局：光纸背景 + 玻璃态 Header + 呼吸光晕
// ═══════════════════════════════════════════════════════════════════════════

interface ChatLayoutProps {
  skill: SkillType;
  title: string;
  backHref: string;
  onViewProfile?: () => void;
  children: React.ReactNode;
}

const SKILL_CONFIG: Record<SkillType, { profileLabel: string }> = {
  bazi: { profileLabel: "查看命盘" },
  zodiac: { profileLabel: "查看星盘" },
  mbti: { profileLabel: "查看档案" },
  attach: { profileLabel: "查看档案" },
  career: { profileLabel: "查看档案" },
};

export function ChatLayout({
  skill,
  title,
  backHref,
  onViewProfile,
  children,
}: ChatLayoutProps) {
  const config = SKILL_CONFIG[skill];

  return (
    <LuminousPaper skill={skill} variant="default" className="h-screen flex flex-col">
      {/* Background aura */}
      <BreathAura skill={skill} size="xl" position="top" intensity="low" className="opacity-40" />

      {/* Glass Header */}
      <header className="nav">
        <div className="nav-container">
          {/* Left: Back + Logo + Title */}
          <div className="flex items-center gap-3">
            <Link href={backHref} className="nav-link flex items-center gap-1">
              <ArrowLeft className="w-4 h-4" />
              <span>返回</span>
            </Link>
            <div className="flex items-center gap-2">
              <VibeGlyph size="sm" skill={skill} showAura={false} animate={false} />
              <span className="font-serif font-semibold text-foreground">{title}</span>
            </div>
          </div>

          {/* Right: Profile Button */}
          <div className="flex items-center gap-2">
            {onViewProfile && (
              <IconButton
                variant="ghost"
                size="sm"
                onClick={onViewProfile}
                aria-label={config.profileLabel}
              >
                <FileText className="w-5 h-5" />
              </IconButton>
            )}
          </div>
        </div>
      </header>

      {/* Main Content */}
      <div className="flex-1 overflow-hidden relative">
        {children}
      </div>
    </LuminousPaper>
  );
}
