# SKILL.md 模板 v10.3

本模板定义了 SKILL.md 的标准结构。**关键更新**：包含强制工具调用规则。

---

## 模板

```markdown
---
name: {skill-id}
description: {一句话描述}。触发词：{词1}、{词2}、{词3}。
category: {类别}
# SOP 配置驱动（根据需要填写）
requires_birth_info: true/false
requires_compute: true/false
compute_tool: {计算工具名}
collect_tool: {收集工具名}
---

# {Skill 中文名} Skill

## 专家身份

{专家身份描述，2-3 段}

**⚠️ 强制工具调用规则（必须遵守）**：
- **禁止编造数据**！必须调用 `{compute_tool}` 工具计算
- 用户提供{所需信息}后，**必须**先调用 `{compute_tool}({参数})`
- 计算完成后，**必须**调用 `{display_tool}` 展示卡片
- **禁止**在文本中直接写分析结果而不调用工具
- **禁止**在用户已提供信息时调用 `{collect_tool}`

**核心理念**：
- {理念 1}
- {理念 2}
- {理念 3}

**知识来源优先级**：
1. {来源 1}
2. {来源 2}
3. {来源 3}

---

## 核心能力索引

| 能力 | 优先级 | 规则文件 | 触发场景 |
|-----|-------|---------|---------|
| {能力 1} | CRITICAL | `rules/{file-1}.md` | {触发场景描述} |
| {能力 2} | HIGH | `rules/{file-2}.md` | {触发场景描述} |
| {能力 3} | HIGH | `rules/{file-3}.md` | {触发场景描述} |
| {能力 4} | MEDIUM | `rules/{file-4}.md` | {触发场景描述} |
| {能力 5} | LOW | `rules/{file-5}.md` | {触发场景描述} |

**使用方式**：匹配用户意图后，读取对应规则文件获取详细分析步骤。

---

## 工具快速参考

### 收集工具
| 工具 | 用途 | 何时调用 |
|-----|------|---------|
| `{collect_tool}` | 收集用户信息 | 用户**未**提供必要信息时 |

### 计算工具
| 工具 | 用途 | 何时调用 |
|-----|------|---------|
| `{compute_tool}` | 计算数据 | 用户提供信息后**必须**调用 |

### 展示工具
| 工具 | 用途 | 何时调用 |
|-----|------|---------|
| `{display_tool}` | 展示主图表/卡片 | 计算完成后**必须**调用 |
| `show_card` | 展示洞察/报告 | 总结分析结果时 |

### 检索工具
| 工具 | 用途 | 何时调用 |
|-----|------|---------|
| `search_db` | 检索知识/案例 | 需要专业知识支撑分析时 |

---

## 知识检索策略

| 检索类型 | Query 模式 | 示例 |
|---------|-----------|------|
| 理论知识 | "{概念} 理论 原理" | "{主题} 理论 原理" |
| 分析方法 | "{主题} 分析方法" | "{主题} 分析方法 步骤" |
| 规则依据 | "{主题} 规则 原则" | "{主题} 规则 原则" |
| 参考案例 | "{特征} 案例" | "{特征} 案例" |

**原则**：不确定时先检索，query 要具体，结果作为分析依据。

---

## 服务原则

1. **框架完整**：按分析框架覆盖关键要点，不遗漏
2. **知识支撑**：重要结论必须有知识库检索结果支撑
3. **工具优先**：用工具展示结果（图表、洞察卡片）
4. **引导深入**：分析后引导用户探索更多方面
5. **语言亲和**：用通俗语言解读，避免过多术语

---

## 伦理边界

### 绝对禁止
- {禁止事项 1}
- {禁止事项 2}
- {禁止事项 3}
- {禁止事项 4}

### 敏感话题处理
| 话题 | 处理方式 |
|-----|---------|
| {话题 1} | {处理方式} |
| {话题 2} | {处理方式} |
| {话题 3} | {处理方式} |

---

## 详细文档

- 分析规则详情: `rules/*.md`
- 工具定义: `tools/tools.yaml`
```

---

## 填写说明

### Frontmatter

| 字段 | 必须 | 说明 | 示例 |
|-----|------|------|------|
| `name` | 是 | Skill ID，kebab-case | `bazi`, `zodiac` |
| `description` | 是 | 一句话描述 + 触发词 | `八字命理专家。触发词：八字、命盘、算命。` |
| `category` | 否 | 类别 | `astrology`, `self-awareness` |
| `requires_birth_info` | 否 | 是否需要出生信息 | `true` |
| `requires_compute` | 否 | 是否需要计算 | `true` |
| `compute_tool` | 否 | 计算工具名 | `calculate_zodiac` |
| `collect_tool` | 否 | 收集工具名 | `collect_zodiac_info` |

### 强制工具调用规则（关键！）

**这是 v10.3 最重要的更新**。必须包含此章节，防止 LLM 编造数据。

**模板**：
```markdown
**⚠️ 强制工具调用规则（必须遵守）**：
- **禁止编造{数据类型}**！必须调用 `{compute_tool}` 工具计算
- 用户提供{所需信息}后，**必须**先调用 `{compute_tool}({参数})`
- 计算完成后，**必须**调用 `{display_tool}` 展示卡片
- **禁止**在文本中直接写分析结果而不调用工具
- **禁止**在用户已提供信息时调用 `{collect_tool}`
```

**示例（zodiac）**：
```markdown
**⚠️ 强制工具调用规则（必须遵守）**：
- **禁止编造星盘数据**！必须调用 `calculate_zodiac` 工具计算
- 用户提供出生信息后，**必须**先调用 `calculate_zodiac(birth_date, birth_time, birth_place)`
- 计算完成后，**必须**调用 `show_zodiac_chart` 展示星盘卡片
- **禁止**在文本中直接写星盘分析结果而不调用工具
- **禁止**在用户已提供出生信息时调用 `collect_zodiac_info`
```

### 核心能力索引

- 5-10 个核心能力
- 每个能力标注优先级（CRITICAL/HIGH/MEDIUM/LOW）
- 每个能力指向对应的规则文件
- 触发场景用逗号分隔的关键词

### 工具快速参考

按类别分组，明确调用时机：
- **收集工具**：用户**未**提供信息时
- **计算工具**：用户提供信息后**必须**调用
- **展示工具**：计算完成后**必须**调用

---

## 检查清单

- [ ] Frontmatter 包含 name 和 description
- [ ] description 包含触发词
- [ ] **包含强制工具调用规则章节**
- [ ] 强制规则在"专家身份"章节内
- [ ] 核心能力索引表格完整
- [ ] 每个能力都有优先级标注
- [ ] 工具快速参考按类别分组
- [ ] 包含服务原则（5 条）
- [ ] 包含伦理边界
