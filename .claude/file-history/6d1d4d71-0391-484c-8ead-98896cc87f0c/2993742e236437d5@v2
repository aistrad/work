"use client";

/**
 * MobileTabBar - ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆªæ 
 * Based on: vibelife spec v3.0 + AI SDK 6 Compatible
 *
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚  å¯¹è¯  â”‚  å‘½ç›˜  â”‚  å†å²  â”‚  æˆ‘çš„  â”‚
 * â”‚   ğŸ’¬   â”‚   ğŸ“Š   â”‚   ğŸ•   â”‚   ğŸ‘¤   â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 * ä» skillRegistry åŠ¨æ€è·å–é¢æ¿åˆ—è¡¨
 */

import { useMemo } from "react";
import { cn } from "@/lib/utils";
import {
  MessageSquare,
  Compass,
  History,
  User,
} from "lucide-react";
import type { LucideIcon } from "lucide-react";
import { useSkillPanels } from "@/providers";
import { type TabType } from "./AppShell";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Types & Config
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

interface MobileTabBarProps {
  activeTab: TabType;
  onTabChange: (tab: TabType) => void;
  className?: string;
}

interface TabItem {
  id: string;
  icon: LucideIcon;
  label: string;
  ariaLabel: string;
}

// Fallback items (when registry not available)
const DEFAULT_TAB_ITEMS: TabItem[] = [
  { id: "chat", icon: MessageSquare, label: "å¯¹è¯", ariaLabel: "å¯¹è¯èŠå¤©" },
  { id: "chart", icon: Compass, label: "å‘½ç›˜", ariaLabel: "æŸ¥çœ‹å‘½ç›˜å›¾è¡¨" },
  { id: "journey", icon: History, label: "å†å²", ariaLabel: "å¯¹è¯å†å²è®°å½•" },
  { id: "me", icon: User, label: "æˆ‘çš„", ariaLabel: "ä¸ªäººä¸­å¿ƒ" },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MobileTabBar Component
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export function MobileTabBar({ activeTab, onTabChange, className }: MobileTabBarProps) {
  // Get panels from skill registry
  const skillPanels = useSkillPanels();

  // Convert skill panels to tab items
  const tabItems = useMemo<TabItem[]>(() => {
    if (!skillPanels || skillPanels.length === 0) {
      return DEFAULT_TAB_ITEMS;
    }

    // Filter to main navigation panels only (chat, chart, journey, me)
    const mainNavIds = ["chat", "chart", "journey", "me"];
    const mainPanels = skillPanels.filter(p => mainNavIds.includes(p.id));

    if (mainPanels.length === 0) {
      return DEFAULT_TAB_ITEMS;
    }

    return mainPanels.map(panel => ({
      id: panel.id,
      icon: panel.icon,
      label: panel.label,
      ariaLabel: panel.label,
    }));
  }, [skillPanels]);

  return (
    <nav
      className={cn(
        "relative flex items-center justify-around",
        "h-16 bg-card/95 backdrop-blur-sm border-t border-border",
        "safe-area-pb", // iOS safe area
        className
      )}
      role="tablist"
      aria-label="ä¸»å¯¼èˆª"
    >
      {tabItems.map((item) => {
        const Icon = item.icon;
        const isActive = activeTab === item.id;

        return (
          <button
            key={item.id}
            onClick={() => onTabChange(item.id as TabType)}
            role="tab"
            aria-selected={isActive}
            aria-label={item.ariaLabel}
            className={cn(
              "relative flex-1 flex flex-col items-center justify-center gap-1 py-2",
              "transition-all duration-200",
              isActive
                ? "text-skill-primary"
                : "text-muted-foreground hover:text-foreground"
            )}
          >
            {/* Active indicator bar - top position */}
            {isActive && (
              <span
                className="absolute -top-0.5 left-1/2 -translate-x-1/2 w-8 h-1 rounded-full bg-gradient-to-r from-skill-primary to-skill-primary/70"
                aria-hidden="true"
              />
            )}

            {/* Icon with background on active */}
            <div
              className={cn(
                "relative flex items-center justify-center w-10 h-7 rounded-full transition-all duration-200",
                isActive && "bg-skill-primary/10"
              )}
            >
              <Icon
                className={cn(
                  "w-5 h-5 transition-transform duration-200",
                  isActive && "scale-110"
                )}
              />
            </div>

            {/* Label */}
            <span
              className={cn(
                "text-xs transition-all duration-200",
                isActive ? "font-semibold" : "font-medium"
              )}
            >
              {item.label}
            </span>
          </button>
        );
      })}
    </nav>
  );
}
