/**
 * Onboarding Flow Types - v3.0
 *
 * ç”¨æˆ·æµç¨‹é˜¶æ®µå®šä¹‰å’ŒçŠ¶æ€ç±»å‹
 * æ”¯æŒå¤šå˜ä½“å…¥å£ï¼šbazi / zodiac / jungastro / dankoe
 */

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å˜ä½“ç±»å‹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export type VariantId = 'bazi' | 'zodiac' | 'jungastro' | 'dankoe'

export interface VariantLanding {
  headline: string
  subheadline: string
  cta: string
  skip_birth_info: boolean
}

export interface VariantConfig {
  id: string
  name: string
  description: string
  requires: Array<{ skill: string; compute: boolean }>
  landing: VariantLanding
  theme: {
    skill: string
    primary_color: string
    icon: string
  }
}

export const VARIANT_DEFAULTS: Record<VariantId, VariantLanding> = {
  bazi: {
    headline: 'å‘Šè¯‰æˆ‘ä½ çš„ç”Ÿæ—¥',
    subheadline: '90ç§’ Â· å…«å­—å‘½ç† Â· ä¸‰ä¸ªç²¾å‡†æ´å¯Ÿ',
    cta: 'çœ‹çœ‹æˆ‘çš„å‘½ç›˜',
    skip_birth_info: false,
  },
  zodiac: {
    headline: 'å‘Šè¯‰æˆ‘ä½ çš„ç”Ÿæ—¥',
    subheadline: '90ç§’ Â· å æ˜Ÿå­¦ Â· å¤ªé˜³æœˆäº®ä¸Šå‡è§£è¯»',
    cta: 'çœ‹çœ‹æˆ‘çš„æ˜Ÿç›˜',
    skip_birth_info: false,
  },
  jungastro: {
    headline: 'å‘Šè¯‰æˆ‘ä½ çš„ç”Ÿæ—¥',
    subheadline: '90ç§’ Â· è£æ ¼å æ˜Ÿ Â· æ¢ç´¢å†…å¿ƒæ·±å¤„',
    cta: 'å¼€å§‹å†…åœ¨ä¹‹æ—…',
    skip_birth_info: false,
  },
  dankoe: {
    headline: 'å‡†å¤‡å¥½é‡ç½®ä½ çš„äººç”Ÿå—ï¼Ÿ',
    subheadline: '10åˆ†é’Ÿ Â· Dan Koe æ–¹æ³• Â· å¿«é€Ÿæ‰¾åˆ°æ–¹å‘',
    cta: 'å¼€å§‹é‡ç½®',
    skip_birth_info: true,
  },
}

// SkillType from core: "bazi" | "zodiac" | "mbti" | "attach" | "career" | "lifecoach"
export type ThemeSkill = 'bazi' | 'zodiac' | 'lifecoach'

export const VARIANT_THEMES: Record<VariantId, { skill: ThemeSkill; icon: string }> = {
  bazi: { skill: 'bazi', icon: 'ğŸŒ²' },
  zodiac: { skill: 'zodiac', icon: 'âœ¨' },
  jungastro: { skill: 'zodiac', icon: 'ğŸŒ‘' },  // jungastro uses zodiac theme
  dankoe: { skill: 'lifecoach', icon: 'ğŸ”¥' },
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æµç¨‹æ­¥éª¤
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export type OnboardingStep =
  | 'landing'        // Phase 1: ç›¸é‡ - ç”Ÿæ—¥è¾“å…¥ï¼ˆdankoe è·³è¿‡ï¼‰
  | 'loading'        // Phase 2: æ´å¯Ÿ - è®¡ç®—ï¼ˆdankoe è·³è¿‡ï¼‰
  | 'embeddedChat'   // Phase 3: é¦–æ¬¡ç›¸é‡ - åµŒå…¥å¼å¯¹è¯
  | 'conversion'     // Phase 4: æœŸå¾… - ä»˜è´¹å¼•å¯¼

export type PersonaType = 'warm' | 'sharp' | 'wise'

export interface PersonaConfig {
  id: PersonaType
  name: string
  nameEn: string
  emotionValue: number // -100 to 100
  description: string
  sampleText: string
  icon: string
}

export const PERSONAS: Record<PersonaType, PersonaConfig> = {
  warm: {
    id: 'warm',
    name: 'æš–å¿ƒé—ºèœœ',
    nameEn: 'Bestie',
    emotionValue: 80,
    description: 'ç†è§£ä½ ã€æ”¯æŒä½ ï¼Œç”¨æ¸©æš–çš„æ–¹å¼é™ªä¼´ä½ ',
    sampleText: 'æˆ‘ç†è§£ä½ æœ€è¿‘å‹åŠ›å¾ˆå¤§ï¼Œè¿™æ˜¯æ­£å¸¸çš„...',
    icon: 'ğŸŒ¸',
  },
  sharp: {
    id: 'sharp',
    name: 'æ¯’èˆŒæŸå‹',
    nameEn: 'Roaster',
    emotionValue: -20,
    description: 'ç›´è¨€ä¸è®³ï¼Œè¯´ä½ éœ€è¦å¬ä½†å¯èƒ½ä¸æƒ³å¬çš„è¯',
    sampleText: 'å¾—äº†å§ï¼Œä½ çœŸæ­£æƒ³è¦çš„å…¶å®æ˜¯...',
    icon: 'âš¡',
  },
  wise: {
    id: 'wise',
    name: 'äººç”Ÿå¯¼å¸ˆ',
    nameEn: 'Mentor',
    emotionValue: 50,
    description: 'æ·±åº¦åˆ†æï¼Œä»å‘½ç†è§’åº¦ç»™ä½ ç†æ€§å»ºè®®',
    sampleText: 'ä»å‘½ç›˜æ¥çœ‹ï¼Œä½ ç›®å‰å¤„äºä¸€ä¸ªè½¬æŠ˜æœŸ...',
    icon: 'ğŸŒ™',
  },
}

export type ConcernType = 'love' | 'career' | 'self' | 'health' | 'wealth'

export interface ConcernConfig {
  id: ConcernType
  label: string
  icon: string
}

export const CONCERNS: ConcernConfig[] = [
  { id: 'love', label: 'æ„Ÿæƒ…', icon: 'ğŸ’•' },
  { id: 'career', label: 'äº‹ä¸š', icon: 'ğŸ’¼' },
  { id: 'self', label: 'è‡ªæˆ‘', icon: 'ğŸŒŸ' },
  { id: 'health', label: 'å¥åº·', icon: 'ğŸŒ¿' },
  { id: 'wealth', label: 'è´¢è¿', icon: 'ğŸ’°' },
]

export interface BirthInfo {
  year: number
  month: number
  day: number
  hour: number | null  // å¯é€‰
  isLunar?: boolean    // æ˜¯å¦å†œå†
  gender?: 'male' | 'female'
}

export interface OnboardingState {
  variant: VariantId
  variantConfig: VariantConfig | null
  step: OnboardingStep
  birthInfo: BirthInfo | null
  concerns: ConcernType[]
  gender: string | null  // 'male' | 'female' | 'private'
  persona: PersonaType | null
  baziData: BaziData | null
  interviewAnswers: InterviewAnswer[]
  letterContent: string | null
}

export interface BaziData {
  yearPillar: { stem: string; branch: string }
  monthPillar: { stem: string; branch: string }
  dayPillar: { stem: string; branch: string }
  hourPillar: { stem: string; branch: string } | null
  dayMaster: string
  dayMasterElement: string
  insight: string
  fortune: {
    score: number
    luckyColor: string
    luckyNumber: number
    advice: string
  }
  // æ˜Ÿåº§æ•°æ®
  sunSign?: string
  moonSign?: string
  risingSign?: string
}

export interface InterviewAnswer {
  questionId: string
  questionText: string
  selectedOptions: string[]
  openAnswer: string
}

export interface InterviewQuestion {
  id: string
  questionText: string
  reasoning: string  // æ¨ç†è¿‡ç¨‹å±•ç¤º
  options: Array<{
    id: string
    text: string
  }>
  allowMultiple: boolean
  showOpenInput: boolean
  openInputPlaceholder?: string
}

// è®¡ç®—æ­¥éª¤
export interface CalculationStep {
  id: string
  label: string
  status: 'pending' | 'loading' | 'done'
}

export const CALCULATION_STEPS: Omit<CalculationStep, 'status'>[] = [
  { id: 'paipan', label: 'æ’ç›˜å®Œæˆ' },
  { id: 'wuxing', label: 'åˆ†æäº”è¡Œå¼ºå¼±' },
  { id: 'dayun', label: 'è®¡ç®—å¤§è¿æµå¹´' },
  { id: 'fortune', label: 'ç”Ÿæˆä»Šæ—¥è¿åŠ¿' },
  { id: 'kline', label: 'ç»˜åˆ¶äººç”Ÿ K çº¿' },
]
