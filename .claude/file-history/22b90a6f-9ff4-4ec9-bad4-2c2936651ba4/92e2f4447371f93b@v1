-- Migration: 003_drop_scenario_tables
-- Description: Drop deprecated scenario_candidates and scenario_index tables
-- Date: 2026-01-14
-- Reason:
--   - Scenario 现在直接从 skills/{skill}/scenarios/*.md 文件加载
--   - 触发词路由改为文件解析，不再使用 DB 索引
--   - unified_extractor.py 实现了 LLM 自动审核入库，取代人工审核流程

-- =============================================================================
-- 1. Drop scenario_candidates table (人工审核队列 - 已废弃)
-- =============================================================================

DROP TABLE IF EXISTS scenario_candidates CASCADE;

-- =============================================================================
-- 2. Drop scenario_index table (触发词索引 - 改为文件解析)
-- =============================================================================

DROP TABLE IF EXISTS scenario_index CASCADE;

-- =============================================================================
-- 3. Drop related functions (if any)
-- =============================================================================

DROP FUNCTION IF EXISTS match_scenario_for_skill CASCADE;

-- =============================================================================
-- Note: Related code files marked as legacy (not deleted):
-- - apps/api/workers/scenario_generator.py (Stage 4b - legacy)
-- - apps/api/workers/scenario_reviewer.py (人工审核 - legacy)
--
-- New flow:
--   Stage 4 (unified_extractor.py) → LLM Auto Review →
--     - Cases → cases table (status='approved')
--     - Scenarios → skills/{skill}/scenarios/*.md (direct publish)
-- =============================================================================
