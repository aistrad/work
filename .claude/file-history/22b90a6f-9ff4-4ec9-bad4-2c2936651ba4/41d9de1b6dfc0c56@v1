# 案例提取 Prompt 模板 v2

> 此 Prompt 在 Claude Code 中手动执行，不调用外部 LLM API。
> **核心理念**：从"结论导向"转向"推理导向"，提取专家的思维过程而非仅提取结论。

## 设计原则

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   旧模式：提取"结论"                                                        │
│   ─────────────────                                                        │
│   { "pattern": "正官格", "strength": "身强" }  ← 用户只能看到结论           │
│                                                                             │
│   新模式：提取"推理链条"                                                    │
│   ─────────────────────                                                    │
│   { "reasoning_chain": [                                                   │
│       { "observation": "...", "analysis": "...", "conclusion": "..." }    │
│     ]                                                                      │
│   }  ← 用户能看到专家的思维过程                                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 使用方法

1. 从 knowledge_chunks 表中读取待分析的文本
2. 确定该 Skill 的思维架构体系（参考 SKILL.md）
3. 将文本填入下方模板
4. 在 Claude Code 中执行 prompt
5. 将结果手动写入 cases 表

---

## Prompt 模板

```
请从以下{skill_name}专业文本中提取案例。

## Skill类型: {skill_id}

## 该 Skill 的思维架构体系

{thinking_frameworks}

## 案例数据结构

### core_data (核心数据)
{core_data_schema}

### features (特征数据)
{features_schema}

## 待分析文本

{text}

## 提取要求

### 1. 基础信息提取
- name: 案例名称/标题
- core_data: 核心数据 (按上述结构)
- features: 特征数据 (按上述结构)

### 2. 推理链条提取 (关键)

从文本中识别专家的推理过程，提取为 reasoning_chain 数组：

每个推理步骤包含：
| 字段 | 说明 |
|------|------|
| step | 步骤序号 (1, 2, 3...) |
| framework | 使用的思维架构名称 |
| observation | 专家观察到的特征/现象 |
| analysis | 专家的分析推理过程 |
| conclusion | 该步骤得出的结论 |

示例：
{
  "reasoning_chain": [
    {
      "step": 1,
      "framework": "客体思维架构",
      "observation": "劫财辛金透出于年柱",
      "analysis": "劫财被正官丁火克制，力量被削弱",
      "conclusion": "劫财弱势，反衬比肩特质强势"
    },
    {
      "step": 2,
      "framework": "柱位思维架构",
      "observation": "劫财位于年柱",
      "analysis": "年柱代表童年时期和祖辈宫位",
      "conclusion": "童年期会有贵人相助的机遇"
    }
  ]
}

### 3. 指导模式提取 (关键)

从文本中提取可复用的指导建议，提取为 guidance_patterns 数组：

每个指导模式包含：
| 字段 | 说明 |
|------|------|
| pattern_name | 模式名称 |
| condition | 适用条件 (什么情况下使用) |
| advice | 具体建议 |
| source | 来源依据 (如哪本书、哪个理论) |

示例：
{
  "guidance_patterns": [
    {
      "pattern_name": "劫弱反补法",
      "condition": "劫财被克弱时",
      "advice": "不宜合伙创业，适合独立发展或寻求贵人扶持",
      "source": "正偏转换理论"
    }
  ]
}

### 4. 思维架构标注

标注该案例使用了哪些思维架构：
- thinking_frameworks_used: ["架构1", "架构2", ...]

### 5. 其他字段
- tags: 标签数组 (如: ["事业", "财运"])
- scenario_ids: 适用场景ID数组 (如: ["basic_reading", "career"])

## 输出格式

以JSON格式输出，完整结构如下：

{
  "name": "案例名称",
  "core_data": {...},
  "features": {...},
  "thinking_frameworks_used": ["架构1", "架构2"],
  "reasoning_chain": [
    {"step": 1, "framework": "...", "observation": "...", "analysis": "...", "conclusion": "..."},
    {"step": 2, ...}
  ],
  "guidance_patterns": [
    {"pattern_name": "...", "condition": "...", "advice": "...", "source": "..."}
  ],
  "tags": ["标签1", "标签2"],
  "scenario_ids": ["scenario1", "scenario2"]
}

如果文本中没有案例，返回: {"no_case": true, "reason": "原因说明"}

请直接输出JSON，不要添加其他说明。
```

---

## Skill 特定配置

### Bazi (八字)

**思维架构体系**:
- 主体思维架构：身强/身弱判定
- 客体思维架构：十神分析
- 五行思维架构：五行分布特征
- 柱位思维架构：四柱位置含义
- 冲合思维架构：冲合关系解读
- 时运思维架构：大运流年分析
- 正偏思维架构：正偏十神转换

**core_data**:
- year: 年柱 (如: 甲子)
- month: 月柱
- day: 日柱
- hour: 时柱
- gender: 性别 (男/女)

**features**:
- daymaster: 日主 (如: 甲木)
- strength: 身强/身弱
- pattern: 格局 (如: 正官格)
- key_gods: 关键十神 (数组)

### Zodiac (占星)

**思维架构体系**:
- 元素思维架构：火/土/风/水元素分析
- 模式思维架构：基本/固定/变动模式分析
- 相位思维架构：行星相位解读
- 宫位思维架构：十二宫位分析
- 行运思维架构：行运推进分析

**core_data**:
- sun_sign: 太阳星座
- moon_sign: 月亮星座
- rising_sign: 上升星座
- birth_chart: 星盘配置摘要

**features**:
- dominant_element: 主导元素
- dominant_modality: 主导模式
- key_aspects: 关键相位
- stellium: 星群 (如有)

### Tarot (塔罗)

**思维架构体系**:
- 大小牌思维架构：大牌vs小牌分析
- 花色思维架构：权杖/圣杯/宝剑/钱币
- 数字思维架构：牌号数字含义
- 叙事思维架构：牌阵故事整合
- 元素尊严架构：元素强弱分析

**core_data**:
- spread_type: 牌阵类型
- cards: 抽到的牌 (数组)
- question: 问题类型

**features**:
- major_count: 大牌数量
- dominant_suit: 主导花色
- reversed_count: 逆位数量
- key_cards: 关键牌

### Career (职业)

**思维架构体系**:
- 职业锚思维架构：核心职业动机分析
- 霍兰德思维架构：职业兴趣类型分析
- MBTI思维架构：性格类型分析
- 技能矩阵架构：技能组合分析
- 发展阶段架构：职业周期分析

**core_data**:
- background: 职业背景
- current_role: 当前职位
- challenge: 面临挑战

**features**:
- industry: 行业
- career_stage: 职业阶段
- key_skills: 核心技能
- goals: 职业目标

---

## 数据库写入 SQL

```sql
INSERT INTO cases (
    id, skill_id, scenario_ids, name,
    core_data, features,
    thinking_frameworks_used,
    reasoning_chain,
    guidance_patterns,
    tags, authority
)
VALUES (
    'CASE_{skill_id}_{uuid}',
    '{skill_id}',
    ARRAY['basic_reading', 'career'],
    '案例名称',
    '{"year":"甲子","month":"乙丑","day":"丙寅","hour":"丁卯","gender":"男"}'::jsonb,
    '{"daymaster":"丙火","strength":"身强","pattern":"正官格","key_gods":["正官","正印"]}'::jsonb,
    ARRAY['客体思维架构', '柱位思维架构'],
    '[{"step":1,"framework":"客体思维架构","observation":"...","analysis":"...","conclusion":"..."}]'::jsonb,
    '[{"pattern_name":"劫弱反补法","condition":"劫财被克弱时","advice":"...","source":"正偏转换理论"}]'::jsonb,
    ARRAY['事业', '财运'],
    'medium'
);
```

---

## 提取质量标准

| 维度 | 标准 |
|------|------|
| 推理链条 | 至少2-3步完整的推理过程 |
| 思维架构 | 至少标注1个使用的架构 |
| 指导模式 | 至少提取1个可复用的指导建议 |
| 来源追溯 | 指导模式必须标注来源 |
