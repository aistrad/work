"use client";

/**
 * ArchetypeCard - è£æ ¼åŸå‹ç”»åƒå¡ç‰‡ï¼ˆæ ¸å¿ƒåˆ›æ–°ç»„ä»¶ï¼‰
 *
 * æ‰¿è½½ä¸‰ä¸ªä»·å€¼ï¼š
 * - è®¤çŸ¥ï¼šæˆ‘æ˜¯ä»€ä¹ˆï¼ˆåŸå‹æ„æˆï¼‰
 * - æŒ‡å¯¼ï¼šæˆ‘åº”è¯¥æ€ä¹ˆåšï¼ˆè¡ŒåŠ¨å»ºè®®ï¼‰
 * - è§‚å¯Ÿï¼šæˆ‘çš„å˜åŒ–ï¼ˆè¶‹åŠ¿ + é˜´å½±è§‰å¯Ÿï¼‰
 *
 * è®¾è®¡è¦ç‚¹ï¼š
 * - ä¸»åŸå‹ç”¨å¡ç‰‡ä¸­å¡ç‰‡ï¼ˆhero sectionï¼‰å¼ºè°ƒ
 * - åŸå‹æƒé‡ç”¨æ¸å˜è‰²æ¡ï¼ˆå“ç‰Œè‰²ç³»ï¼‰
 * - è¡ŒåŠ¨å»ºè®®ç”¨ tips åˆ—è¡¨å½¢å¼
 * - å˜åŒ–è¶‹åŠ¿ç”¨ä¸Šå‡/ä¸‹é™ç®­å¤´ + è¯æ®
 * - é˜´å½±è§‰å¯Ÿç”¨å¾®å¦™çš„è­¦ç¤ºè‰²
 */

import { cn } from "@/lib/utils";
import { ChevronRight, TrendingUp, AlertTriangle, Lightbulb } from "lucide-react";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Types
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export interface ArchetypeData {
  primary: {
    name: string;
    name_cn: string;
    tagline: string;
    weight: number;
  };
  weights: Record<string, number>;
  guidance: string[];
  trend?: {
    rising: string;
    delta: number;
    evidence: string;
  };
  shadow?: {
    name: string;
    warning: string;
  };
}

export interface ArchetypeCardProps {
  data?: ArchetypeData | null;
  onExplore?: () => void;
  className?: string;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Static Constants - Archetype Colors
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const ARCHETYPE_COLORS: Record<string, { gradient: string; text: string; bg: string }> = {
  åˆ›é€ è€…: { gradient: "from-amber-400 to-orange-500", text: "text-amber-700", bg: "bg-amber-100" },
  æ¢ç´¢è€…: { gradient: "from-teal-400 to-emerald-500", text: "text-teal-700", bg: "bg-teal-100" },
  æ™ºè€…: { gradient: "from-indigo-400 to-purple-500", text: "text-indigo-700", bg: "bg-indigo-100" },
  è‹±é›„: { gradient: "from-red-400 to-rose-500", text: "text-red-700", bg: "bg-red-100" },
  ç…§é¡¾è€…: { gradient: "from-green-400 to-emerald-500", text: "text-green-700", bg: "bg-green-100" },
  æ‹äºº: { gradient: "from-pink-400 to-rose-500", text: "text-pink-700", bg: "bg-pink-100" },
  é­”æœ¯å¸ˆ: { gradient: "from-purple-400 to-violet-500", text: "text-purple-700", bg: "bg-purple-100" },
  ç»Ÿæ²»è€…: { gradient: "from-yellow-400 to-amber-500", text: "text-yellow-700", bg: "bg-yellow-100" },
  å¤©çœŸè€…: { gradient: "from-sky-400 to-blue-500", text: "text-sky-700", bg: "bg-sky-100" },
  å‡¡äºº: { gradient: "from-slate-400 to-gray-500", text: "text-slate-700", bg: "bg-slate-100" },
  å›é€†è€…: { gradient: "from-orange-400 to-red-500", text: "text-orange-700", bg: "bg-orange-100" },
  æ„šè€…: { gradient: "from-cyan-400 to-teal-500", text: "text-cyan-700", bg: "bg-cyan-100" },
};

const ARCHETYPE_ICONS: Record<string, string> = {
  åˆ›é€ è€…: "ğŸ¨",
  æ¢ç´¢è€…: "ğŸ§­",
  æ™ºè€…: "ğŸ“š",
  è‹±é›„: "âš”ï¸",
  ç…§é¡¾è€…: "ğŸ’",
  æ‹äºº: "ğŸ’•",
  é­”æœ¯å¸ˆ: "âœ¨",
  ç»Ÿæ²»è€…: "ğŸ‘‘",
  å¤©çœŸè€…: "ğŸŒˆ",
  å‡¡äºº: "ğŸ¤",
  å›é€†è€…: "ğŸ”¥",
  æ„šè€…: "ğŸƒ",
};

function getArchetypeStyle(name: string) {
  return ARCHETYPE_COLORS[name] || ARCHETYPE_COLORS["åˆ›é€ è€…"];
}

function getArchetypeIcon(name: string) {
  return ARCHETYPE_ICONS[name] || "âœ¦";
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Sub-components
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function PrimaryArchetypeHero({
  name,
  name_cn,
  tagline,
}: {
  name: string;
  name_cn: string;
  tagline: string;
}) {
  const style = getArchetypeStyle(name_cn);
  const icon = getArchetypeIcon(name_cn);

  return (
    <div
      className={cn(
        "p-6 rounded-xl text-center",
        "bg-gradient-to-br from-vellum-50 to-white",
        "border-2 border-vellum-200/50",
        "shadow-soft"
      )}
    >
      {/* Icon */}
      <div className="text-4xl mb-3">{icon}</div>

      {/* Name */}
      <h3 className="font-serif text-2xl font-bold text-foreground mb-1">
        {name_cn}
      </h3>
      <p className="text-xs text-muted-foreground uppercase tracking-wider mb-4">
        {name}
      </p>

      {/* Divider */}
      <div className="w-16 h-px bg-gradient-to-r from-transparent via-vellum-300 to-transparent mx-auto mb-4" />

      {/* Tagline */}
      <p className="text-sm text-ink-600 italic">
        &ldquo;{tagline}&rdquo;
      </p>
    </div>
  );
}

function ArchetypeWeightsChart({ weights }: { weights: Record<string, number> }) {
  const sortedWeights = Object.entries(weights)
    .sort(([, a], [, b]) => b - a)
    .slice(0, 4); // Show top 4

  const maxValue = Math.max(...Object.values(weights), 1);

  return (
    <div className="space-y-2.5">
      {sortedWeights.map(([name, value]) => {
        const style = getArchetypeStyle(name);
        const percentage = (value / maxValue) * 100;

        return (
          <div key={name} className="flex items-center gap-3">
            <span className="w-16 text-xs text-ink-600 truncate">{name}</span>
            <div className="flex-1 h-2 bg-vellum-100 rounded-full overflow-hidden">
              <div
                className={cn(
                  "h-full rounded-full transition-all duration-700 ease-out",
                  "bg-gradient-to-r",
                  style.gradient
                )}
                style={{ width: `${percentage}%` }}
              />
            </div>
            <span className="w-10 text-xs text-muted-foreground text-right">
              {value}%
            </span>
          </div>
        );
      })}
    </div>
  );
}

function GuidanceSection({ guidance }: { guidance: string[] }) {
  return (
    <div className="p-4 rounded-lg bg-gradient-to-br from-amber-50/50 to-yellow-50/50 border border-amber-200/30">
      <div className="flex items-center gap-2 mb-3">
        <Lightbulb className="w-4 h-4 text-amber-600" />
        <span className="text-xs font-medium text-amber-700">è¡ŒåŠ¨å»ºè®®</span>
      </div>
      <ul className="space-y-2">
        {guidance.map((tip, index) => (
          <li key={index} className="flex items-start gap-2 text-sm text-ink-700">
            <span className="text-amber-500 mt-0.5">â€¢</span>
            <span>{tip}</span>
          </li>
        ))}
      </ul>
    </div>
  );
}

function TrendSection({
  trend,
  shadow,
}: {
  trend?: ArchetypeData["trend"];
  shadow?: ArchetypeData["shadow"];
}) {
  if (!trend && !shadow) return null;

  return (
    <div className="p-4 rounded-lg bg-gradient-to-br from-slate-50/50 to-gray-50/50 border border-slate-200/30">
      <div className="flex items-center gap-2 mb-3">
        <TrendingUp className="w-4 h-4 text-slate-600" />
        <span className="text-xs font-medium text-slate-700">è¿‘æœŸè¶‹åŠ¿</span>
      </div>

      <div className="space-y-3">
        {trend ? (
          <div className="flex items-start gap-2">
            <span className="text-green-500 text-lg">â†—</span>
            <div>
              <div className="flex items-center gap-2">
                <span className="text-sm font-medium text-foreground">
                  {trend.rising}
                </span>
                <span className="text-xs text-green-600">+{trend.delta}%</span>
              </div>
              <p className="text-xs text-muted-foreground mt-0.5">
                ã€Œ{trend.evidence}ã€
              </p>
            </div>
          </div>
        ) : null}

        {shadow ? (
          <>
            <div className="h-px bg-slate-200/50" />
            <div className="flex items-start gap-2">
              <AlertTriangle className="w-4 h-4 text-amber-500 flex-shrink-0 mt-0.5" />
              <div>
                <div className="flex items-center gap-2">
                  <span className="text-xs text-muted-foreground">é˜´å½±è§‰å¯Ÿï¼š</span>
                  <span className="text-sm font-medium text-amber-700">
                    {shadow.name}
                  </span>
                </div>
                <p className="text-xs text-muted-foreground mt-0.5">
                  ã€Œ{shadow.warning}ã€
                </p>
              </div>
            </div>
          </>
        ) : null}
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Main Component
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export function ArchetypeCard({
  data,
  onExplore,
  className,
}: ArchetypeCardProps) {
  // Empty state
  if (!data) {
    return (
      <div
        onClick={onExplore}
        className={cn(
          "p-5 rounded-xl cursor-pointer",
          "bg-gradient-to-br from-vellum-50/50 to-white",
          "border border-vellum-200/30 shadow-card",
          "hover:shadow-card-hover hover:border-vellum-200/50",
          "transition-all duration-200",
          className
        )}
      >
        <div className="flex items-center gap-2 mb-3">
          <span className="text-2xl">âœ¦</span>
          <span className="font-serif text-base font-semibold text-foreground">
            ä½ çš„åŸå‹ç”»åƒ
          </span>
        </div>
        <p className="text-sm text-muted-foreground mb-4">
          ç»§ç»­å¯¹è¯ï¼Œå‘ç°ä½ çš„è£æ ¼åŸå‹
        </p>
        <div className="flex items-center justify-center gap-2 px-4 py-2.5 bg-vellum-500/10 hover:bg-vellum-500/20 text-vellum-700 rounded-lg text-sm font-medium transition-colors">
          <span>å¼€å§‹æ¢ç´¢</span>
          <ChevronRight className="w-4 h-4" />
        </div>
      </div>
    );
  }

  return (
    <div
      onClick={onExplore}
      className={cn(
        "p-5 rounded-xl cursor-pointer",
        "bg-gradient-to-br from-vellum-50/30 to-white",
        "border border-vellum-200/30 shadow-card",
        "hover:shadow-card-hover hover:border-vellum-200/50",
        "transition-all duration-200 hover:scale-[1.01]",
        className
      )}
    >
      {/* Header */}
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center gap-2">
          <span className="text-xl">âœ¦</span>
          <span className="font-serif text-base font-semibold text-foreground">
            ä½ çš„åŸå‹ç”»åƒ
          </span>
        </div>
        <div className="flex items-center gap-1 text-vellum-600">
          <span className="text-xs">æ·±å…¥</span>
          <ChevronRight className="w-4 h-4" />
        </div>
      </div>

      {/* Primary Archetype Hero */}
      <PrimaryArchetypeHero
        name={data.primary.name}
        name_cn={data.primary.name_cn}
        tagline={data.primary.tagline}
      />

      {/* Section: è®¤çŸ¥ */}
      <div className="mt-5">
        <h4 className="text-xs text-muted-foreground mb-3 flex items-center gap-2">
          <span className="w-4 h-px bg-vellum-300" />
          è®¤çŸ¥ï¼šæˆ‘æ˜¯ä»€ä¹ˆ
          <span className="flex-1 h-px bg-vellum-300" />
        </h4>
        <div className="mb-2">
          <span className="text-xs text-muted-foreground">åŸå‹æ„æˆ</span>
        </div>
        <ArchetypeWeightsChart weights={data.weights} />
      </div>

      {/* Section: æŒ‡å¯¼ */}
      <div className="mt-5">
        <h4 className="text-xs text-muted-foreground mb-3 flex items-center gap-2">
          <span className="w-4 h-px bg-vellum-300" />
          æŒ‡å¯¼ï¼šæˆ‘åº”è¯¥æ€ä¹ˆåš
          <span className="flex-1 h-px bg-vellum-300" />
        </h4>
        <GuidanceSection guidance={data.guidance} />
      </div>

      {/* Section: è§‚å¯Ÿ */}
      {(data.trend || data.shadow) ? (
        <div className="mt-5">
          <h4 className="text-xs text-muted-foreground mb-3 flex items-center gap-2">
            <span className="w-4 h-px bg-vellum-300" />
            è§‚å¯Ÿï¼šæˆ‘çš„å˜åŒ–
            <span className="flex-1 h-px bg-vellum-300" />
          </h4>
          <TrendSection trend={data.trend} shadow={data.shadow} />
        </div>
      ) : null}
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Skeleton
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export function ArchetypeCardSkeleton({ className }: { className?: string }) {
  return (
    <div
      className={cn(
        "p-5 rounded-xl",
        "bg-gradient-to-br from-vellum-50/30 to-white",
        "border border-vellum-200/30 shadow-card animate-pulse",
        className
      )}
    >
      {/* Header */}
      <div className="flex items-center gap-2 mb-4">
        <div className="w-6 h-6 rounded bg-vellum-200" />
        <div className="h-5 bg-vellum-200 rounded w-28" />
      </div>

      {/* Hero */}
      <div className="p-6 rounded-xl bg-vellum-100/50 text-center mb-5">
        <div className="w-12 h-12 rounded-full bg-vellum-200 mx-auto mb-3" />
        <div className="h-7 bg-vellum-200 rounded w-20 mx-auto mb-2" />
        <div className="h-4 bg-vellum-100 rounded w-16 mx-auto mb-4" />
        <div className="w-16 h-px bg-vellum-200 mx-auto mb-4" />
        <div className="h-4 bg-vellum-200 rounded w-32 mx-auto" />
      </div>

      {/* Weights */}
      <div className="space-y-2.5 mb-5">
        {[1, 2, 3, 4].map((i) => (
          <div key={i} className="flex items-center gap-3">
            <div className="w-16 h-4 bg-vellum-200 rounded" />
            <div className="flex-1 h-2 bg-vellum-100 rounded-full" />
            <div className="w-10 h-4 bg-vellum-200 rounded" />
          </div>
        ))}
      </div>

      {/* Guidance */}
      <div className="p-4 rounded-lg bg-vellum-100/50">
        <div className="h-4 bg-vellum-200 rounded w-20 mb-3" />
        <div className="space-y-2">
          <div className="h-4 bg-vellum-200 rounded w-full" />
          <div className="h-4 bg-vellum-200 rounded w-4/5" />
          <div className="h-4 bg-vellum-200 rounded w-3/4" />
        </div>
      </div>
    </div>
  );
}

export default ArchetypeCard;
