"use client";

import { cn } from "@/lib/utils";
import { type SkillType } from "./LuminousPaper";
import { BreathAura } from "./BreathAura";
import { useId } from "react";

// ═══════════════════════════════════════════════════════════════════════════
// VibeGlyph - 橙子 Logo
// 品牌图标：可爱的橙子 + 呼吸光晕
// ═══════════════════════════════════════════════════════════════════════════

interface VibeGlyphProps {
  size?: "sm" | "md" | "lg" | "xl";
  skill?: SkillType;
  showAura?: boolean;
  animate?: boolean;
  className?: string;
}

const sizeConfig = {
  sm: { container: "w-8 h-8", icon: 28, aura: "sm" as const },
  md: { container: "w-10 h-10", icon: 36, aura: "md" as const },
  lg: { container: "w-14 h-14", icon: 48, aura: "lg" as const },
  xl: { container: "w-20 h-20", icon: 72, aura: "xl" as const },
};

// 橙子 SVG 图标
function OrangeIcon({ size, id }: { size: number; id: string }) {
  const gradientId = `orange-gradient-${id}`;
  const highlightId = `highlight-gradient-${id}`;

  return (
    <svg
      width={size}
      height={size}
      viewBox="0 0 48 48"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      {/* 渐变定义 */}
      <defs>
        <radialGradient id={gradientId} cx="30%" cy="30%" r="70%">
          <stop offset="0%" stopColor="#EFAD6D" />
          <stop offset="50%" stopColor="#D4915D" />
          <stop offset="100%" stopColor="#B87A4A" />
        </radialGradient>
        <radialGradient id={highlightId} cx="50%" cy="50%" r="50%">
          <stop offset="0%" stopColor="white" stopOpacity="0.4" />
          <stop offset="100%" stopColor="white" stopOpacity="0" />
        </radialGradient>
      </defs>

      {/* 橙子主体圆形 */}
      <circle cx="24" cy="26" r="18" fill={`url(#${gradientId})`} />

      {/* 高光 */}
      <ellipse cx="17" cy="20" rx="5" ry="3.5" fill={`url(#${highlightId})`} />

      {/* 橙子纹理 - 简化的分瓣线条 */}
      <path d="M24 8 L24 44" stroke="#C4824E" strokeWidth="0.8" strokeOpacity="0.25" />
      <path d="M8 26 L40 26" stroke="#C4824E" strokeWidth="0.8" strokeOpacity="0.25" />
      <path d="M12 13 L36 39" stroke="#C4824E" strokeWidth="0.6" strokeOpacity="0.15" />
      <path d="M36 13 L12 39" stroke="#C4824E" strokeWidth="0.6" strokeOpacity="0.15" />

      {/* 叶子 */}
      <ellipse cx="22" cy="7" rx="5" ry="2.5" fill="#5A9F5A" transform="rotate(-20, 22, 7)" />
      <ellipse cx="28" cy="6" rx="4" ry="2" fill="#6AB36A" transform="rotate(15, 28, 6)" />

      {/* 茎 */}
      <rect x="23" y="4" width="2.5" height="5" rx="1.25" fill="#4A7A4A" />
    </svg>
  );
}

export function VibeGlyph({
  size = "md",
  skill = "bazi",
  showAura = false,
  animate = false,
  className,
}: VibeGlyphProps) {
  const config = sizeConfig[size];
  const uniqueId = useId();

  return (
    <div
      className={cn(
        "vibe-glyph relative flex items-center justify-center",
        config.container,
        animate && "animate-float",
        className
      )}
    >
      {/* Breath aura background */}
      {showAura && (
        <BreathAura
          skill={skill}
          size={config.aura}
          position="center"
          intensity="medium"
          className="absolute"
        />
      )}

      {/* 橙子图标 */}
      <div className="vibe-glyph-inner relative z-10">
        <OrangeIcon size={config.icon} id={uniqueId} />
      </div>
    </div>
  );
}

// ═══════════════════════════════════════════════════════════════════════════
// SimpleVibeGlyph - 简化版橙子图标（用于小尺寸场景）
// ═══════════════════════════════════════════════════════════════════════════

interface SimpleVibeGlyphProps {
  size?: number;
  skill?: SkillType;
  className?: string;
}

export function SimpleVibeGlyph({
  size = 24,
  skill = "bazi",
  className,
}: SimpleVibeGlyphProps) {
  return (
    <svg
      width={size}
      height={size}
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      {/* 橙子主体 */}
      <circle cx="12" cy="13" r="9" fill="#D4915D" />
      {/* 高光 */}
      <circle cx="9" cy="10" r="2" fill="white" fillOpacity="0.3" />
      {/* 叶子 */}
      <ellipse cx="11" cy="4" rx="2.5" ry="1.2" fill="#5A9F5A" transform="rotate(-15, 11, 4)" />
      <ellipse cx="14" cy="3.5" rx="2" ry="1" fill="#6AB36A" transform="rotate(10, 14, 3.5)" />
      {/* 茎 */}
      <rect x="11.5" y="2" width="1.2" height="2.5" rx="0.6" fill="#4A7A4A" />
    </svg>
  );
}

export default VibeGlyph;
