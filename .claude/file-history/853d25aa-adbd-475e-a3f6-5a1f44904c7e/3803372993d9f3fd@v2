'use client';

/**
 * SkillShowcaseCard - App Store 风格的 Skill 展示卡片
 *
 * 中等尺寸，突出视觉效果和关键信息
 */

import React from 'react';
import { cn } from '@/lib/utils';
import type { SkillMetadata, SkillUserStatus } from '@/types/skill';

interface SkillShowcaseCardProps {
  skill: SkillMetadata;
  userStatus?: SkillUserStatus;
  size?: 'medium' | 'large';
  onClick: () => void;
  onSubscribe?: () => void;
}

export function SkillShowcaseCard({
  skill,
  userStatus,
  size = 'medium',
  onClick,
  onSubscribe,
}: SkillShowcaseCardProps) {
  const isSubscribed = userStatus?.subscribed || skill.category === 'core';
  const isFree = skill.pricing.type === 'free';
  const trialRemaining = userStatus?.trial_messages_remaining;

  return (
    <div
      onClick={onClick}
      className={cn(
        'group relative overflow-hidden rounded-2xl cursor-pointer transition-all hover:scale-[1.02]',
        'bg-bg-card border border-subtle shadow-card hover:shadow-card-hover',
        size === 'large' ? 'p-8' : 'p-6'
      )}
    >
      {/* 背景渐变 */}
      <div
        className="absolute inset-0 opacity-5 group-hover:opacity-10 transition-opacity"
        style={{
          background: `linear-gradient(135deg, ${skill.color} 0%, transparent 100%)`,
        }}
      />

      {/* 内容 */}
      <div className="relative space-y-4">
        {/* Header */}
        <div className="flex items-start justify-between">
          {/* 图标 */}
          <div
            className={cn(
              'rounded-2xl flex items-center justify-center transition-transform group-hover:scale-110',
              size === 'large' ? 'w-16 h-16 lg:w-20 lg:h-20 text-4xl lg:text-5xl' : 'w-12 h-12 lg:w-16 lg:h-16 text-3xl lg:text-4xl'
            )}
            style={{
              backgroundColor: `${skill.color}20`,
              boxShadow: `0 8px 24px ${skill.color}20`,
            }}
          >
            {skill.icon}
          </div>

          {/* 订阅状态 */}
          {isSubscribed && (
            <div className="px-2.5 py-1 rounded-full bg-green-500/10 border border-green-500/20">
              <span className="text-xs font-medium text-green-600">
                {skill.category === 'core' ? '始终激活' : '已订阅'}
              </span>
            </div>
          )}
        </div>

        {/* 标题和描述 */}
        <div className="space-y-2">
          <h3 className={cn(
            'font-semibold text-text-primary',
            size === 'large' ? 'text-2xl' : 'text-xl'
          )}>
            {skill.name}
          </h3>
          <p className="text-sm text-text-secondary line-clamp-2">
            {skill.showcase?.tagline || skill.description}
          </p>
        </div>

        {/* 特性标签 */}
        {skill.features && skill.features.length > 0 && (
          <div className="flex flex-wrap gap-2">
            {skill.features.slice(0, 3).map((feature, i) => (
              <div
                key={i}
                className="px-2.5 py-1 rounded-lg bg-bg-secondary text-xs text-text-secondary"
              >
                {feature.icon && <span className="mr-1">{feature.icon}</span>}
                {feature.name}
              </div>
            ))}
          </div>
        )}

        {/* 底部行动区 */}
        <div className="flex items-center justify-between pt-2">
          {/* 价格信息 */}
          <div className="text-sm">
            {isFree ? (
              <span className="font-medium text-green-600">免费</span>
            ) : trialRemaining && trialRemaining > 0 ? (
              <span className="text-text-secondary">
                {trialRemaining} 次免费体验
              </span>
            ) : (
              <span className="font-medium text-accent-primary">Premium</span>
            )}
          </div>

          {/* 行动按钮 */}
          {!isSubscribed && (
            <button
              onClick={(e) => {
                e.stopPropagation();
                onSubscribe?.();
              }}
              className="px-4 py-2 rounded-full bg-accent-primary text-text-inverse text-sm font-medium hover:bg-accent-primary/90 transition-colors"
            >
              获取
            </button>
          )}
        </div>
      </div>
    </div>
  );
}
