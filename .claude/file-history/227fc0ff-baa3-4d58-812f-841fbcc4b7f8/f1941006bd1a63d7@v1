"use client"

import { useRef, useMemo } from "react"
import { motion } from "framer-motion"
import { cn } from "@/lib/utils"

interface SoulOrbProps {
  className?: string
  element?: "wood" | "fire" | "earth" | "metal" | "water" | null
  isInsightMode?: boolean
  size?: "sm" | "md" | "lg" | "xl"
}

const ELEMENT_GRADIENTS = {
  wood: ["#4ade80", "#22c55e"],
  fire: ["#f87171", "#ef4444"],
  earth: ["#fbbf24", "#f59e0b"],
  metal: ["#f5f5f4", "#d6d3d1"],
  water: ["#60a5fa", "#3b82f6"],
}

const SIZE_MAP = {
  sm: "w-32 h-32",
  md: "w-48 h-48",
  lg: "w-64 h-64",
  xl: "w-80 h-80",
}

export function SoulOrb({
  className,
  element = null,
  isInsightMode = false,
  size = "lg",
}: SoulOrbProps) {
  const containerRef = useRef<HTMLDivElement>(null)

  const gradientColors = useMemo(() => {
    if (element && ELEMENT_GRADIENTS[element]) {
      return ELEMENT_GRADIENTS[element]
    }
    if (isInsightMode) {
      return ["#434343", "#8A2387"]
    }
    return ["#FFECD2", "#E0EAFC"]
  }, [element, isInsightMode])

  return (
    <div
      ref={containerRef}
      className={cn(
        "relative flex items-center justify-center",
        SIZE_MAP[size],
        className
      )}
    >
      {/* Outer glow */}
      <motion.div
        className="absolute inset-0 rounded-full opacity-40 blur-3xl"
        style={{
          background: `radial-gradient(circle, ${gradientColors[0]}40 0%, transparent 70%)`,
        }}
        animate={{
          scale: [1, 1.1, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{
          duration: 4,
          repeat: Infinity,
          ease: "easeInOut",
        }}
      />

      {/* Main orb */}
      <motion.div
        className="relative w-full h-full rounded-full"
        style={{
          background: `linear-gradient(135deg, ${gradientColors[0]} 0%, ${gradientColors[1]} 100%)`,
          boxShadow: `
            0 0 60px ${gradientColors[0]}30,
            inset 0 0 60px ${gradientColors[1]}20,
            inset -20px -20px 60px rgba(0, 0, 0, 0.1),
            inset 20px 20px 60px rgba(255, 255, 255, 0.3)
          `,
        }}
        animate={{
          scale: [1, 1.02, 1],
        }}
        transition={{
          duration: 4,
          repeat: Infinity,
          ease: "easeInOut",
        }}
      >
        {/* Inner highlight */}
        <div
          className="absolute top-[15%] left-[20%] w-[35%] h-[25%] rounded-full opacity-60"
          style={{
            background: "linear-gradient(135deg, rgba(255,255,255,0.8) 0%, transparent 100%)",
            filter: "blur(8px)",
          }}
        />

        {/* Flowing gradient overlay */}
        <motion.div
          className="absolute inset-0 rounded-full opacity-30"
          style={{
            background: `conic-gradient(from 0deg, ${gradientColors[0]}80, ${gradientColors[1]}80, ${gradientColors[0]}80)`,
          }}
          animate={{
            rotate: [0, 360],
          }}
          transition={{
            duration: 20,
            repeat: Infinity,
            ease: "linear",
          }}
        />

        {/* Particle effects */}
        <div className="absolute inset-0 overflow-hidden rounded-full">
          {[...Array(6)].map((_, i) => (
            <motion.div
              key={i}
              className="absolute w-1 h-1 rounded-full bg-white/60"
              style={{
                left: `${20 + Math.random() * 60}%`,
                top: `${20 + Math.random() * 60}%`,
              }}
              animate={{
                y: [-10, 10, -10],
                x: [-5, 5, -5],
                opacity: [0.3, 0.8, 0.3],
                scale: [0.8, 1.2, 0.8],
              }}
              transition={{
                duration: 3 + Math.random() * 2,
                repeat: Infinity,
                ease: "easeInOut",
                delay: Math.random() * 2,
              }}
            />
          ))}
        </div>
      </motion.div>

      {/* Ring accent */}
      <motion.div
        className="absolute inset-[-8px] rounded-full border opacity-20"
        style={{
          borderColor: gradientColors[0],
        }}
        animate={{
          scale: [1, 1.05, 1],
          opacity: [0.1, 0.25, 0.1],
        }}
        transition={{
          duration: 3,
          repeat: Infinity,
          ease: "easeInOut",
        }}
      />
    </div>
  )
}
