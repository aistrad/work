"use client"

import { useEffect } from "react"
import { Omnibar } from "@/components/chat/omnibar"
import { DynamicAura } from "@/components/hud/dynamic-aura"
import { StreamFeed } from "./stream-feed"
import { TopStatusBar } from "./top-status-bar"
import { useStreamStore } from "@/stores/stream-store"

export function StreamScreen() {
  const {
    entries,
    actionCards,
    isStreaming,
    userState,
    sendInput,
    completeActionCard,
    dismissActionCard,
    subscribeRealtime,
    unsubscribeRealtime,
  } = useStreamStore()

  useEffect(() => {
    subscribeRealtime()
    return () => unsubscribeRealtime()
  }, [subscribeRealtime, unsubscribeRealtime])

  return (
    <div className="relative h-screen w-full overflow-hidden bg-background">
      <DynamicAura state={userState.aura_state} />
      <div className="relative z-10 flex h-full flex-col">
        <TopStatusBar
          energy={userState.energy_score}
          momentum={userState.momentum}
          aura={userState.aura_state}
        />
        <StreamFeed
          entries={entries}
          actionCards={actionCards}
          onCompleteCard={completeActionCard}
          onDismissCard={dismissActionCard}
        />
        <Omnibar onSubmit={sendInput} isLoading={isStreaming} />
      </div>
    </div>
  )
}
