"use client"

import { useState, useCallback } from "react"
import { motion, AnimatePresence } from "framer-motion"
import Link from "next/link"
import { MentisSoulOrb } from "@/components/landing/mentis-soul-orb"
import { BirthInputCapsule } from "@/components/landing/birth-input-capsule"
import { InstantInsightCard } from "@/components/landing/instant-insight-card"
import { Mic, MessageSquare, Brain, TrendingUp, Menu, X } from "lucide-react"

type ViewState = "input" | "loading" | "insight"

// 模拟洞察数据
const MOCK_INSIGHTS = [
  {
    element: "wood" as const,
    title: "The Visionary Pioneer",
    insight: "Your chart reveals a natural leader with boundless creativity. The Wood element grants you resilience and the ability to adapt and grow through any challenge.",
    insightCn: "命盘显示你是天生的领袖，拥有无限创造力。木行赋予你韧性，让你能够适应并在任何挑战中成长。",
  },
  {
    element: "fire" as const,
    title: "The Passionate Creator",
    insight: "Fire energy dominates your chart, blessing you with charisma and enthusiasm. Your natural warmth draws others to you.",
    insightCn: "火行主宰你的命盘，赐予你魅力与热情。你天生的温暖吸引着他人。",
  },
  {
    element: "water" as const,
    title: "The Intuitive Sage",
    insight: "Water flows through your destiny, granting deep intuition and emotional intelligence. You navigate life's currents with wisdom.",
    insightCn: "水行流淌于你的命运，赋予深层直觉和情感智慧。你以智慧驾驭人生的洪流。",
  },
]

export default function LandingPage() {
  const [viewState, setViewState] = useState<ViewState>("input")
  const [insightData, setInsightData] = useState(MOCK_INSIGHTS[0])
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false)

  const handleBirthSubmit = useCallback(async (info: { date: string; time: string; gender: string }) => {
    setViewState("loading")

    // 模拟 API 调用
    await new Promise((resolve) => setTimeout(resolve, 2000))

    // 随机选择一个洞察
    const randomInsight = MOCK_INSIGHTS[Math.floor(Math.random() * MOCK_INSIGHTS.length)]
    setInsightData(randomInsight)
    setViewState("insight")
  }, [])

  const handleReset = useCallback(() => {
    setViewState("input")
  }, [])

  return (
    <div className="min-h-screen relative overflow-hidden">
      {/* Background Gradient */}
      <div className="fixed inset-0 -z-10">
        <div className="absolute inset-0 bg-gradient-to-b from-background via-background to-background-subtle" />
        <div className="absolute top-0 left-1/4 w-96 h-96 bg-accent/5 rounded-full blur-3xl" />
        <div className="absolute bottom-0 right-1/4 w-80 h-80 bg-blue-500/5 rounded-full blur-3xl" />
      </div>

      {/* Navigation */}
      <nav className="fixed top-0 inset-x-0 z-50">
        <div className="glass border-b border-border/50">
          <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="flex items-center justify-between h-16">
              {/* Logo */}
              <Link href="/" className="flex items-center gap-2">
                <span className="font-serif text-xl font-semibold">MENTIS</span>
              </Link>

              {/* Desktop Nav */}
              <div className="hidden md:flex items-center gap-6">
                <Link href="#features" className="text-sm text-foreground-muted hover:text-foreground transition-colors">
                  Features
                </Link>
                <Link href="#pricing" className="text-sm text-foreground-muted hover:text-foreground transition-colors">
                  Pricing
                </Link>
                <Link
                  href="/login"
                  className="text-sm px-4 py-2 rounded-full bg-foreground text-background hover:opacity-90 transition-opacity"
                >
                  Login
                </Link>
              </div>

              {/* Mobile Menu Button */}
              <button
                onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                className="md:hidden p-2 rounded-lg hover:bg-muted transition-colors"
              >
                {mobileMenuOpen ? <X className="w-5 h-5" /> : <Menu className="w-5 h-5" />}
              </button>
            </div>
          </div>
        </div>

        {/* Mobile Menu */}
        <AnimatePresence>
          {mobileMenuOpen && (
            <motion.div
              initial={{ opacity: 0, height: 0 }}
              animate={{ opacity: 1, height: "auto" }}
              exit={{ opacity: 0, height: 0 }}
              className="md:hidden glass border-b border-border/50"
            >
              <div className="px-4 py-4 space-y-3">
                <Link href="#features" className="block text-sm text-foreground-muted hover:text-foreground">
                  Features
                </Link>
                <Link href="#pricing" className="block text-sm text-foreground-muted hover:text-foreground">
                  Pricing
                </Link>
                <Link href="/login" className="block text-sm font-medium">
                  Login
                </Link>
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      </nav>

      {/* Hero Section */}
      <main className="pt-24 pb-16 px-4 sm:px-6 lg:px-8">
        <div className="max-w-4xl mx-auto text-center">
          {/* Soul Orb */}
          <motion.div
            className="flex justify-center mb-8"
            animate={{
              scale: viewState === "insight" ? 0.7 : 1,
              y: viewState === "insight" ? -20 : 0,
            }}
            transition={{ duration: 0.6, ease: [0.16, 1, 0.3, 1] }}
          >
            <MentisSoulOrb
              state={
                viewState === "loading"
                  ? "loading"
                  : viewState === "insight"
                  ? insightData.element
                  : "default"
              }
              size={viewState === "insight" ? "md" : "lg"}
            />
          </motion.div>

          {/* Content */}
          <AnimatePresence mode="wait">
            {viewState === "input" && (
              <motion.div
                key="input"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -20 }}
                transition={{ duration: 0.4 }}
                className="space-y-8"
              >
                {/* Tagline */}
                <div className="space-y-4">
                  <h1 className="hero-title">
                    Decode. Reframe. Evolve.
                  </h1>
                  <p className="hero-subtitle max-w-md mx-auto">
                    解码命运 · 重塑认知 · 进化人生
                  </p>
                </div>

                {/* Birth Input */}
                <BirthInputCapsule onSubmit={handleBirthSubmit} />

                {/* Social Proof */}
                <p className="text-sm text-foreground-muted">
                  已有 <span className="text-foreground font-medium">10,000+</span> 用户发现他们的命运密码
                </p>
              </motion.div>
            )}

            {viewState === "loading" && (
              <motion.div
                key="loading"
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                exit={{ opacity: 0 }}
                className="space-y-4"
              >
                <h2 className="serif-heading text-2xl">解读你的命盘...</h2>
                <p className="text-foreground-muted">正在分析八字与紫微斗数</p>
              </motion.div>
            )}

            {viewState === "insight" && (
              <motion.div
                key="insight"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -20 }}
                className="space-y-6"
              >
                <InstantInsightCard
                  data={insightData}
                  onSaveProfile={() => {
                    // TODO: 打开登录弹窗
                    window.location.href = "/login"
                  }}
                />

                <button
                  onClick={handleReset}
                  className="text-sm text-foreground-muted hover:text-foreground transition-colors"
                >
                  重新输入生辰 →
                </button>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      </main>

      {/* Features Section */}
      <section id="features" className="py-20 px-4 sm:px-6 lg:px-8 border-t border-border/50">
        <div className="max-w-5xl mx-auto">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6 }}
            className="text-center mb-12"
          >
            <h2 className="serif-heading text-3xl mb-4">Stream-Centric Agentic OS</h2>
            <p className="text-foreground-muted max-w-lg mx-auto">
              一个以生活流为核心的智能体个人操作系统
            </p>
          </motion.div>

          <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            {[
              {
                icon: <Mic className="w-6 h-6" />,
                title: "Vibe Diary",
                desc: "语音/图片/文字记录，零摩擦输入",
              },
              {
                icon: <MessageSquare className="w-6 h-6" />,
                title: "命理解读",
                desc: "八字、紫微、占星，多维度洞察",
              },
              {
                icon: <Brain className="w-6 h-6" />,
                title: "认知重塑",
                desc: "CBT/ACT 技术，重构思维模式",
              },
              {
                icon: <TrendingUp className="w-6 h-6" />,
                title: "动量追踪",
                desc: "习惯养成，持续进化的成长系统",
              },
            ].map((feature, i) => (
              <motion.div
                key={feature.title}
                initial={{ opacity: 0, y: 20 }}
                whileInView={{ opacity: 1, y: 0 }}
                viewport={{ once: true }}
                transition={{ duration: 0.4, delay: i * 0.1 }}
                className="glass-card rounded-xl p-6 text-center hover:shadow-lg transition-shadow"
              >
                <div className="w-12 h-12 rounded-full bg-accent/10 text-accent flex items-center justify-center mx-auto mb-4">
                  {feature.icon}
                </div>
                <h3 className="font-medium mb-2">{feature.title}</h3>
                <p className="text-sm text-foreground-muted">{feature.desc}</p>
              </motion.div>
            ))}
          </div>
        </div>
      </section>

      {/* Footer */}
      <footer className="py-8 px-4 border-t border-border/50 text-center text-sm text-foreground-muted">
        <p>© 2026 Mentis. Decode. Reframe. Evolve.</p>
      </footer>
    </div>
  )
}
