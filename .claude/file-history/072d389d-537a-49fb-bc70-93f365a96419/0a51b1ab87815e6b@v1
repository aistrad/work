"""
Proactive Engine - 主动计算和推送系统 v3.0 (LLM-First)

架构:
- ProactiveOrchestrator: 主编排器，协调触发评估、内容生成、推送投递
- TriggerEvaluator: 静态优先 + LLM 回退的触发评估器
- ProactiveAgentAdapter: Agent 适配器，调用 CoreAgent 生成内容

v3.0 关键更新:
- 消除 TriggerDetector 和 ContentGenerator 中的硬编码逻辑
- 声明式 conditions + 静态求值优先
- 复用 CoreAgent Phase 2 生成内容

数据源: unified_profiles (唯一真源)
配置源: skills/{skill}/reminders.yaml (v3.0 格式)

DEPRECATED v2.0 类 (将在 v4.0 删除):
- ProactiveEngine -> 使用 ProactiveOrchestrator
- TriggerDetector -> 使用 TriggerEvaluator
- ContentGenerator -> 使用 ProactiveAgentAdapter
"""

import warnings

# v3.0 新架构
from .orchestrator import ProactiveOrchestrator
from .trigger_evaluator import TriggerEvaluator
from .agent_adapter import ProactiveAgentAdapter
from .models import ReminderTask, ReminderContent, ReminderPriority


def __getattr__(name):
    """Lazy import with deprecation warnings for v2.0 classes."""
    deprecated_classes = {
        "ProactiveEngine": ("engine", "ProactiveEngine", "ProactiveOrchestrator"),
        "TriggerDetector": ("trigger_detector", "TriggerDetector", "TriggerEvaluator"),
        "ContentGenerator": ("content_generator", "ContentGenerator", "ProactiveAgentAdapter"),
    }

    if name in deprecated_classes:
        module_name, class_name, replacement = deprecated_classes[name]
        warnings.warn(
            f"{class_name} is deprecated and will be removed in v4.0. "
            f"Use {replacement} instead.",
            DeprecationWarning,
            stacklevel=2,
        )
        import importlib
        module = importlib.import_module(f".{module_name}", __name__)
        return getattr(module, class_name)

    raise AttributeError(f"module {__name__!r} has no attribute {name!r}")


__all__ = [
    # v3.0 新架构 (推荐使用)
    "ProactiveOrchestrator",
    "TriggerEvaluator",
    "ProactiveAgentAdapter",
    "ReminderTask",
    "ReminderContent",
    "ReminderPriority",
    # v2.0 兼容 (已废弃，将在 v4.0 删除)
    "ProactiveEngine",
    "TriggerDetector",
    "ContentGenerator",
]
