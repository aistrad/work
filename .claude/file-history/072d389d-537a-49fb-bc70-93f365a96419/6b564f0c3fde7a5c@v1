# Core Skill 提醒定义 v3.0
# LLM-First 架构：声明式 conditions + Agent 内容生成
# 定义全局/跨 Skill 的主动推送类型

version: "3.0"
skill_id: core
enabled: true

reminders:
  # ═══════════════════════════════════════════════════════════════════════════
  # 每周总结
  # ═══════════════════════════════════════════════════════════════════════════
  - id: weekly_summary
    name: 每周总结

    trigger:
      type: time_based
      schedule: "0 9 * * 0"  # 每周日早上9点
      cooldown_hours: 168    # 7天

    conditions:
      - description: "用户有活跃订阅"
        data_path: "preferences.push_settings.enabled"
        operator: "!="
        value: false

    content:
      rule: rules/proactive/weekly-summary-push.md
      card_type: InsightCard
      suggested_prompt: "想了解本周运势回顾？"
      quick_actions:
        - label: "周运回顾"
          prompt: "请帮我回顾一下这周的运势表现"
        - label: "下周展望"
          prompt: "下周的运势趋势如何？有什么需要注意的？"

    priority: medium

  # ═══════════════════════════════════════════════════════════════════════════
  # 每月报告
  # ═══════════════════════════════════════════════════════════════════════════
  - id: monthly_report
    name: 每月报告

    trigger:
      type: time_based
      schedule: "0 9 1 * *"  # 每月1号早上9点
      cooldown_hours: 720    # 30天

    conditions:
      - description: "用户有活跃订阅"
        data_path: "preferences.push_settings.enabled"
        operator: "!="
        value: false

    content:
      rule: rules/proactive/monthly-report-push.md
      card_type: InsightCard
      suggested_prompt: "想了解本月深度分析？"
      quick_actions:
        - label: "月度运势"
          prompt: "请分析我这个月的整体运势"
        - label: "重点领域"
          prompt: "这个月在事业、感情、健康方面有什么需要关注的？"

    priority: high

  # ═══════════════════════════════════════════════════════════════════════════
  # 生日提醒
  # ═══════════════════════════════════════════════════════════════════════════
  - id: birthday
    name: 生日提醒

    trigger:
      type: event_based
      event: birthday
      advance_days: [7, 0]  # 提前7天、当天

    conditions:
      - description: "用户生日信息存在"
        data_path: "identity.birth_info.date"
        operator: "exists"

    content:
      rule: rules/proactive/birthday-push.md
      card_type: InsightCard
      suggested_prompt: "想了解新的一岁运势？"
      quick_actions:
        - label: "生日运势"
          prompt: "请分析我新的一岁运势"
        - label: "生日许愿"
          prompt: "今年最适合许什么愿望？"

    priority: high

  # ═══════════════════════════════════════════════════════════════════════════
  # 目标追踪 - 每日计划
  # ═══════════════════════════════════════════════════════════════════════════
  - id: daily_plan
    name: 每日计划

    trigger:
      type: time_based
      schedule: "0 8 * * *"  # 每天早上8点
      cooldown_hours: 24

    conditions:
      - description: "用户有活跃目标"
        data_path: "skills.lifecoach.goals"
        operator: "exists"
      - description: "用户启用了目标追踪"
        data_path: "skills.lifecoach.enabled"
        operator: "!="
        value: false

    content:
      rule: rules/proactive/daily-plan-push.md
      card_type: InsightCard
      suggested_prompt: "想规划今天的重点？"
      quick_actions:
        - label: "今日重点"
          prompt: "根据我的目标，今天应该重点做什么？"
        - label: "能量建议"
          prompt: "结合今天的运势，如何更好地完成目标？"

    priority: medium

  # ═══════════════════════════════════════════════════════════════════════════
  # 目标追踪 - 每日打卡
  # ═══════════════════════════════════════════════════════════════════════════
  - id: daily_checkin
    name: 每日打卡

    trigger:
      type: time_based
      schedule: "0 21 * * *"  # 每天晚上9点
      cooldown_hours: 24

    conditions:
      - description: "用户有活跃目标"
        data_path: "skills.lifecoach.goals"
        operator: "exists"
      - description: "用户启用了目标追踪"
        data_path: "skills.lifecoach.enabled"
        operator: "!="
        value: false

    content:
      rule: rules/proactive/daily-checkin-push.md
      card_type: InsightCard
      suggested_prompt: "想回顾今天的进展？"
      quick_actions:
        - label: "今日复盘"
          prompt: "帮我复盘一下今天的进展"
        - label: "明日计划"
          prompt: "明天我应该重点关注什么？"

    priority: medium

  # ═══════════════════════════════════════════════════════════════════════════
  # 目标追踪 - 周复盘
  # ═══════════════════════════════════════════════════════════════════════════
  - id: weekly_review
    name: 周复盘

    trigger:
      type: time_based
      schedule: "0 18 * * 0"  # 每周日下午6点
      cooldown_hours: 168    # 7天

    conditions:
      - description: "用户有活跃目标"
        data_path: "skills.lifecoach.goals"
        operator: "exists"
      - description: "用户启用了目标追踪"
        data_path: "skills.lifecoach.enabled"
        operator: "!="
        value: false

    content:
      rule: rules/proactive/weekly-review-push.md
      card_type: InsightCard
      suggested_prompt: "想做周复盘？"
      quick_actions:
        - label: "周进展"
          prompt: "帮我回顾一下这周目标的完成情况"
        - label: "下周计划"
          prompt: "根据这周的进展，下周应该如何调整？"

    priority: medium

  # ═══════════════════════════════════════════════════════════════════════════
  # 目标追踪 - 里程碑提醒
  # ═══════════════════════════════════════════════════════════════════════════
  - id: milestone_reminder
    name: 里程碑提醒

    trigger:
      type: event_based
      event: goal_deadline_approaching
      advance_days: [7, 3, 1]  # 提前7/3/1天提醒
      cooldown_hours: 24

    conditions:
      - description: "用户有活跃目标"
        data_path: "skills.lifecoach.goals"
        operator: "exists"
      - description: "存在即将到期的目标"
        # 复杂条件，由 LLM 评估
        description: "检查用户目标列表中是否有deadline即将到来的目标"

    content:
      rule: rules/proactive/milestone-push.md
      card_type: AlertCard
      suggested_prompt: "想了解如何加速完成目标？"
      quick_actions:
        - label: "进度检查"
          prompt: "距离目标截止还有多少，我现在进展如何？"
        - label: "冲刺建议"
          prompt: "如何在剩余时间内完成目标？"

    priority: high

  # ═══════════════════════════════════════════════════════════════════════════
  # 目标追踪 - 连续打卡庆祝
  # ═══════════════════════════════════════════════════════════════════════════
  - id: streak_celebration
    name: 连续打卡庆祝

    trigger:
      type: event_based
      event: checkin_streak
      milestones: [7, 14, 21, 30, 60, 90]  # 连续天数里程碑

    conditions:
      - description: "用户当前连续签到天数达到里程碑"
        data_path: "skills.lifecoach.progress.current_streak"
        operator: ">"
        value: 0

    content:
      rule: rules/proactive/celebration-push.md
      card_type: InsightCard
      suggested_prompt: "想了解坚持带来的变化？"
      quick_actions:
        - label: "成长回顾"
          prompt: "这段时间的坚持给我带来了什么变化？"
        - label: "继续前进"
          prompt: "如何保持这个好习惯？"

    priority: low

# ═══════════════════════════════════════════════════════════════════════════
# 全局事件定义
# ═══════════════════════════════════════════════════════════════════════════
global_events:
  # 节气日期 (简化版，实际计算在 trigger_evaluator.py)
  solar_terms:
    - name: 立春
      month: 2
      day_range: [3, 5]
    - name: 雨水
      month: 2
      day_range: [18, 20]
    - name: 惊蛰
      month: 3
      day_range: [5, 7]
    - name: 春分
      month: 3
      day_range: [20, 22]
    - name: 清明
      month: 4
      day_range: [4, 6]
    - name: 谷雨
      month: 4
      day_range: [19, 21]
    - name: 立夏
      month: 5
      day_range: [5, 7]
    - name: 小满
      month: 5
      day_range: [20, 22]
    - name: 芒种
      month: 6
      day_range: [5, 7]
    - name: 夏至
      month: 6
      day_range: [21, 22]
    - name: 小暑
      month: 7
      day_range: [6, 8]
    - name: 大暑
      month: 7
      day_range: [22, 24]
    - name: 立秋
      month: 8
      day_range: [7, 9]
    - name: 处暑
      month: 8
      day_range: [22, 24]
    - name: 白露
      month: 9
      day_range: [7, 9]
    - name: 秋分
      month: 9
      day_range: [22, 24]
    - name: 寒露
      month: 10
      day_range: [8, 9]
    - name: 霜降
      month: 10
      day_range: [23, 24]
    - name: 立冬
      month: 11
      day_range: [7, 8]
    - name: 小雪
      month: 11
      day_range: [22, 23]
    - name: 大雪
      month: 12
      day_range: [6, 8]
    - name: 冬至
      month: 12
      day_range: [21, 23]
    - name: 小寒
      month: 1
      day_range: [5, 7]
    - name: 大寒
      month: 1
      day_range: [20, 21]

# ═══════════════════════════════════════════════════════════════════════════
# 全局配置
# ═══════════════════════════════════════════════════════════════════════════
global_config:
  default_push_hour: 9   # 默认推送时间（用户本地时间）
  cooldown_hours: 24     # 同类型提醒的冷却时间
  max_daily_pushes: 5    # 每日最大推送数
  quiet_hours:
    start: 22
    end: 7
