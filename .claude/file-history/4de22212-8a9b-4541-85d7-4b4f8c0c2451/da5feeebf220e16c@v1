# Mindfulness Skill 提醒定义 v2.0
# 支持对话引导、情绪触发、专家联动
# 配置与 SKILL.md 通过 skill_id 关联

skill_id: mindfulness
enabled: true

reminders:
  # ═══════════════════════════════════════════════════════════════════════════
  # 定时提醒 - 晨间正念
  # ═══════════════════════════════════════════════════════════════════════════
  - id: morning_mindfulness
    name: 晨间正念
    trigger:
      type: time_based
      schedule: "30 7 * * *"  # 每天早上7:30
      time_window: "07:00-09:00"
      condition: user_has_enabled_morning_reminder
    content:
      generator: rules/morning.md
      card_type: InsightCard
      suggested_prompt: "用 3 分钟正念开始这一天？"
      quick_actions:
        - label: "开始练习"
          prompt: "开始晨间正念练习"
        - label: "稍后提醒"
          prompt: "30分钟后再提醒我"
    priority: medium

  # ═══════════════════════════════════════════════════════════════════════════
  # 定时提醒 - 睡前放松
  # ═══════════════════════════════════════════════════════════════════════════
  - id: evening_relaxation
    name: 睡前放松
    trigger:
      type: time_based
      schedule: "0 22 * * *"  # 每天晚上10点
      time_window: "21:00-23:00"
      condition: user_has_enabled_evening_reminder
    content:
      generator: rules/sleep.md
      card_type: InsightCard
      suggested_prompt: "睡前放松一下？帮你更好入睡"
      quick_actions:
        - label: "5分钟放松"
          prompt: "开始5分钟睡前放松练习"
        - label: "10分钟深度"
          prompt: "开始10分钟深度放松练习"
    priority: medium

  # ═══════════════════════════════════════════════════════════════════════════
  # 情绪触发 - 焦虑检测
  # ═══════════════════════════════════════════════════════════════════════════
  - id: anxiety_detected
    name: 焦虑检测
    trigger:
      type: emotion_based
      emotion: anxiety
      keywords:
        - 焦虑
        - 着急
        - 担心
        - 紧张
        - 不安
        - 慌
    content:
      generator: rules/stop.md
      card_type: AlertCard
      suggested_prompt: "要不要先做个 1 分钟呼吸？"
      quick_actions:
        - label: "STOP练习"
          prompt: "开始STOP练习，帮我平复焦虑"
        - label: "继续聊"
          prompt: "我想先继续聊聊"
    priority: high

  # ═══════════════════════════════════════════════════════════════════════════
  # 情绪触发 - 愤怒检测
  # ═══════════════════════════════════════════════════════════════════════════
  - id: anger_detected
    name: 愤怒检测
    trigger:
      type: emotion_based
      emotion: anger
      keywords:
        - 生气
        - 愤怒
        - 火大
        - 气死
        - 烦
        - 讨厌
    content:
      generator: rules/stop.md
      card_type: AlertCard
      suggested_prompt: "要不要先用 STOP 让自己平静一下？"
      quick_actions:
        - label: "试试 STOP"
          prompt: "开始STOP练习，帮我冷静下来"
        - label: "继续聊"
          prompt: "我想先继续聊聊"
    priority: high

  # ═══════════════════════════════════════════════════════════════════════════
  # 情绪触发 - 悲伤检测
  # ═══════════════════════════════════════════════════════════════════════════
  - id: sadness_detected
    name: 悲伤检测
    trigger:
      type: emotion_based
      emotion: sadness
      keywords:
        - 难过
        - 悲伤
        - 想哭
        - 心痛
        - 失落
        - 委屈
    content:
      generator: rules/rain.md
      card_type: InsightCard
      suggested_prompt: "要不要用 RAIN 练习来处理这个情绪？"
      quick_actions:
        - label: "RAIN练习"
          prompt: "开始RAIN练习，帮我处理悲伤情绪"
        - label: "现在不想"
          prompt: "我现在不想做练习"
    priority: medium

  # ═══════════════════════════════════════════════════════════════════════════
  # 情绪触发 - 压力过载检测
  # ═══════════════════════════════════════════════════════════════════════════
  - id: overwhelm_detected
    name: 压力过载检测
    trigger:
      type: emotion_based
      emotion: overwhelm
      keywords:
        - 崩溃
        - 受不了
        - 太多了
        - 压力大
        - 喘不过气
    content:
      generator: rules/stop.md
      card_type: AlertCard
      suggested_prompt: "先做个 1 分钟 STOP，让自己喘口气？"
      quick_actions:
        - label: "STOP练习"
          prompt: "开始1分钟STOP练习"
        - label: "继续聊"
          prompt: "我想先继续聊聊"
    priority: high

  # ═══════════════════════════════════════════════════════════════════════════
  # 专家联动 - 八字对话收尾
  # ═══════════════════════════════════════════════════════════════════════════
  - id: bazi_completion
    name: 八字对话收尾
    trigger:
      type: skill_completion
      preceding_skill: bazi
      condition:
        session_depth: ">= 3"
        topic_depth: deep
    content:
      generator: rules/integration.md
      card_type: InsightCard
      suggested_prompt: "用 2 分钟正念，让这些洞察沉淀一下？"
      quick_actions:
        - label: "整合练习"
          prompt: "开始整合练习，沉淀刚才的洞察"
        - label: "不用了"
          prompt: "暂时不需要"
    priority: low

  # ═══════════════════════════════════════════════════════════════════════════
  # 专家联动 - 星座对话收尾
  # ═══════════════════════════════════════════════════════════════════════════
  - id: zodiac_completion
    name: 星座对话收尾
    trigger:
      type: skill_completion
      preceding_skill: zodiac
      condition:
        session_depth: ">= 3"
    content:
      generator: rules/integration.md
      card_type: InsightCard
      suggested_prompt: "用 2 分钟正念，让这些洞察沉淀一下？"
      quick_actions:
        - label: "整合练习"
          prompt: "开始整合练习，沉淀星象洞察"
        - label: "不用了"
          prompt: "暂时不需要"
    priority: low

  # ═══════════════════════════════════════════════════════════════════════════
  # 专家联动 - 塔罗对话收尾
  # ═══════════════════════════════════════════════════════════════════════════
  - id: tarot_completion
    name: 塔罗对话收尾
    trigger:
      type: skill_completion
      preceding_skill: tarot
      condition:
        cards_drawn: ">= 1"
    content:
      generator: rules/integration.md
      card_type: InsightCard
      suggested_prompt: "让这张牌的信息沉淀一下，做 2 分钟冥想？"
      quick_actions:
        - label: "整合练习"
          prompt: "开始整合练习，沉淀塔罗指引"
        - label: "不用了"
          prompt: "暂时不需要"
    priority: low

  # ═══════════════════════════════════════════════════════════════════════════
  # 专家联动 - 职业对话收尾
  # ═══════════════════════════════════════════════════════════════════════════
  - id: career_completion
    name: 职业对话收尾
    trigger:
      type: skill_completion
      preceding_skill: career
      condition:
        session_depth: ">= 3"
    content:
      generator: rules/breathing.md
      card_type: InsightCard
      suggested_prompt: "用 1 分钟呼吸，给自己一点空间消化？"
      quick_actions:
        - label: "呼吸练习"
          prompt: "开始1分钟呼吸练习"
        - label: "不用了"
          prompt: "暂时不需要"
    priority: low

  # ═══════════════════════════════════════════════════════════════════════════
  # 里程碑庆祝 - 连续打卡
  # ═══════════════════════════════════════════════════════════════════════════
  - id: streak_3
    name: 连续3天
    trigger:
      type: event_based
      event: checkin_streak
      milestones: [3]
    content:
      generator: rules/celebration.md  # TODO: 创建此规则
      card_type: InsightCard
      suggested_prompt: "连续 3 天打卡，习惯正在形成！"
      quick_actions:
        - label: "继续坚持"
          prompt: "帮我规划接下来的练习"
        - label: "分享成就"
          prompt: "我想分享这个成就"
    priority: low

  - id: streak_7
    name: 连续7天
    trigger:
      type: event_based
      event: checkin_streak
      milestones: [7]
    content:
      generator: rules/celebration.md
      card_type: InsightCard
      suggested_prompt: "一周坚持！你已经超越了 80% 的人。"
      quick_actions:
        - label: "继续坚持"
          prompt: "帮我规划下一周的练习"
        - label: "回顾变化"
          prompt: "这一周的坚持给我带来了什么变化？"
    priority: low

  - id: streak_21
    name: 连续21天
    trigger:
      type: event_based
      event: checkin_streak
      milestones: [21]
    content:
      generator: rules/celebration.md
      card_type: InsightCard
      suggested_prompt: "21 天，心理学上的习惯养成点！"
      quick_actions:
        - label: "深化练习"
          prompt: "我想尝试更深度的练习"
        - label: "回顾成长"
          prompt: "21天来我有什么成长？"
    priority: medium

  - id: streak_30
    name: 连续30天
    trigger:
      type: event_based
      event: checkin_streak
      milestones: [30]
    content:
      generator: rules/celebration.md
      card_type: InsightCard
      suggested_prompt: "一个月！你已经是正念达人了！"
      quick_actions:
        - label: "进阶学习"
          prompt: "我想学习更高级的正念技巧"
        - label: "分享经验"
          prompt: "帮我总结这个月的正念之旅"
    priority: medium

  - id: total_100_minutes
    name: 累计100分钟
    trigger:
      type: event_based
      event: practice_milestone
      milestones: [100]
      metric: total_minutes
    content:
      generator: rules/celebration.md
      card_type: InsightCard
      suggested_prompt: "累计练习 100 分钟！感受到变化了吗？"
      quick_actions:
        - label: "回顾变化"
          prompt: "100分钟的练习给我带来了什么变化？"
        - label: "继续前进"
          prompt: "帮我设定下一个里程碑目标"
    priority: low

# ═══════════════════════════════════════════════════════════════════════════
# 全局配置
# ═══════════════════════════════════════════════════════════════════════════
global_config:
  default_push_hour: 8   # 默认推送时间（用户本地时间）
  cooldown_hours: 2      # 同类型提醒的冷却时间（正念需要更频繁）
  emotion_detect_enabled: true  # 是否开启情绪检测
  expert_handoff_enabled: true  # 是否开启专家联动

# ═══════════════════════════════════════════════════════════════════════════
# 用户偏好默认值
# ═══════════════════════════════════════════════════════════════════════════
default_preferences:
  morning_reminder_enabled: true
  morning_reminder_time: "07:30"
  evening_reminder_enabled: true
  evening_reminder_time: "22:00"
  emotion_detect_enabled: true
  expert_handoff_enabled: true
  preferred_duration: 3  # 默认练习时长（分钟）
