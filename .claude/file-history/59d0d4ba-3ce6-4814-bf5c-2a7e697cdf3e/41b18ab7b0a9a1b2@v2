@import url("https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;600;700&family=Noto+Serif+SC:wght@400;600&display=swap");

:root{
  /* 基础色彩 */
  --bg:#f6f2ec;--surface:#fbf8f3;--surface-2:#eef5ff;--ink:#1f1b16;--muted:#5a5a5a;
  --line:rgba(15,23,42,.08);--shadow:rgba(15,23,42,.14);--brand:linear-gradient(120deg,#0f766e,#2dd4bf,#f59e0b);
  --brand-solid:#0f766e;--gold:#c49b54;--ok:#1f8b4c;--warn:#b56900;--info:#1b4d85;

  /* 新中式色彩 */
  --cinnabar:#e54d42;--ink-black:#1a1a1a;--rice-paper:#faf8f5;--jade:#0f766e;

  /* 光影层级 */
  --shadow-sm:0 2px 8px rgba(15,23,42,.06);
  --shadow-md:0 8px 24px rgba(15,23,42,.08);
  --shadow-lg:0 16px 48px rgba(15,23,42,.12);
  --shadow-glow:0 0 40px rgba(15,118,110,.15);

  /* 毛玻璃 */
  --glass-bg:rgba(255,255,255,.7);--glass-blur:blur(16px);--glass-border:rgba(255,255,255,.4);

  /* 尺寸 */
  --header-h:60px;--page-pad:22px;--radius-xl:28px;--radius-lg:18px;--radius-md:12px
}
*{box-sizing:border-box}html,body{height:100%}
body{
  margin:0;
  background:
    radial-gradient(1200px 520px at 12% -10%, rgba(59,130,246,.18), rgba(255,255,255,0) 60%),
    radial-gradient(900px 520px at 92% -5%, rgba(245,158,11,.2), rgba(255,255,255,0) 55%),
    var(--bg);
  color:var(--ink);
  font:15px/1.7 "Space Grotesk","Noto Sans SC",sans-serif
}
.ui-page{min-height:100%;display:flex;flex-direction:column}
.ui-header{
  display:flex;justify-content:space-between;align-items:center;padding:12px 18px;
  border-bottom:1px solid var(--glass-border);
  min-height:var(--header-h);position:sticky;top:0;z-index:20;
  background:rgba(251,248,243,.75);
  backdrop-filter:saturate(180%) blur(16px);-webkit-backdrop-filter:saturate(180%) blur(16px);
  box-shadow:0 4px 30px rgba(15,23,42,.06)
}
.ui-brand{
  font-weight:700;letter-spacing:.12em;text-transform:uppercase;
  background:var(--brand);-webkit-background-clip:text;background-clip:text;color:transparent
}
.ui-topbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.ui-topbar__label{color:var(--muted);font-size:12px}
.ui-select{padding:8px 10px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.9);color:var(--ink)}
.ui-btn{
  padding:8px 12px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.9);
  cursor:pointer;color:var(--ink);transition:transform .18s ease,box-shadow .18s ease,border-color .18s ease
}
.ui-btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(15,23,42,.12)}
.ui-btn-ghost{background:transparent}
.ui-btn-primary{background:var(--brand);border:none;color:#fff;box-shadow:0 10px 22px rgba(15,118,110,.22)}
.ui-layout{display:grid;grid-template-columns:minmax(0,1fr) minmax(360px,1fr);gap:18px;max-width:1380px;margin:0 auto;padding:16px var(--page-pad) 28px;align-items:stretch;flex:1}
.ui-col{
  background:rgba(251,248,243,.8);border-radius:var(--radius-lg);min-height:0;border:1px solid var(--line);
  box-shadow:0 14px 34px rgba(15,23,42,.08)
}
.ui-chat{background:transparent;box-shadow:none;display:grid;grid-template-rows:1fr auto auto;min-height:0;animation:floatIn .6s ease both}
.ui-workbench{animation:floatIn .6s ease .08s both}
.ui-thread{padding:28px 18px 160px;overflow:auto;max-width:860px;width:100%;margin:0 auto}
.msg{display:flex;gap:12px;margin:16px 0;align-items:flex-start;animation:msgIn .35s ease both}
.msg-user{justify-content:flex-end;animation:msgSend .4s cubic-bezier(.34,1.56,.64,1) both}
@keyframes msgSend{0%{opacity:0;transform:translateX(20px) scale(.95)}100%{opacity:1;transform:translateX(0) scale(1)}}
.msg-user .msg__bubble{background:#fff;border-radius:16px;padding:10px 14px;max-width:70%;color:var(--ink);border:1px solid var(--line)}
.msg-bot .msg__icon{width:28px;height:28px;border-radius:50%;background:var(--brand);color:#fff;display:flex;align-items:center;justify-content:center;font-size:12px;flex:0 0 auto}
.msg-bot .msg__content{flex:1;max-width:760px}
.msg__bubble,.msg__content{white-space:pre-wrap;word-break:break-word;overflow-wrap:anywhere}
.msg.card .msg__content{background:#fff;border:1px solid var(--line);border-radius:16px;padding:12px 14px;box-shadow:0 10px 22px rgba(15,23,42,.06)}
.msg.progress .msg__content{background:#fff;border:1px solid var(--line);border-left:4px solid var(--warn);border-radius:16px;padding:12px 14px}
.msg a{color:var(--brand-solid);text-decoration:none}
.msg a:hover{text-decoration:underline}
.msg blockquote{margin:10px 0;padding:8px 12px;border-left:3px solid #c7d2f2;background:#f7f9ff;border-radius:12px;color:#2d2f36}
.msg .md-code{background:#0b1020;color:#e6e6e6;padding:12px 14px;border-radius:14px;overflow:auto;border:1px solid #1f2a4a}
.msg .md-code code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:13px;white-space:pre}
.msg .meta{color:var(--muted);font-size:12px;margin-top:6px}
.msg .actions{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
/* 骨架屏 - 品牌色调 */
.msg.skel .msg__content{
  background:linear-gradient(90deg,rgba(15,118,110,.05) 25%,rgba(45,212,191,.1) 37%,rgba(15,118,110,.05) 63%);
  background-size:400% 100%;animation:shine 1.4s ease infinite;border-radius:16px;min-height:60px
}
@keyframes shine{0%{background-position:100% 0}100%{background-position:0 0}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes msgIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
@keyframes floatIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.ui-input{
  display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;padding:12px 14px;
  background:rgba(255,255,255,.95);border-radius:var(--radius-xl);border:2px solid transparent;
  box-shadow:var(--shadow-lg);position:sticky;bottom:24px;margin:0 auto 12px;max-width:860px;width:100%;
  transition:all .3s ease
}
.ui-input:focus-within{
  background:#fff;border-color:var(--brand-solid);
  box-shadow:0 0 0 4px rgba(15,118,110,.1),var(--shadow-lg)
}
.ui-input textarea{width:100%;resize:vertical;border:none;background:transparent;outline:none;font:inherit;min-height:36px;max-height:160px}
.ui-icon-btn{width:36px;height:36px;border-radius:50%;border:none;background:#fff;cursor:pointer;color:var(--brand-solid);font-size:18px;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 14px rgba(15,23,42,.12);transition:transform .2s ease,box-shadow .2s ease}
.ui-icon-btn:hover{transform:scale(1.05);box-shadow:0 8px 20px rgba(15,23,42,.15)}
.ui-send-btn{position:relative;padding:8px 14px;border-radius:18px;border:none;background:var(--brand);color:#fff;cursor:pointer;font-weight:600;box-shadow:0 10px 22px rgba(15,118,110,.2);transition:transform .2s ease,box-shadow .2s ease;overflow:hidden}
.ui-send-btn:hover{transform:translateY(-1px);box-shadow:0 12px 28px rgba(15,118,110,.28)}
/* 发送按钮加载态 */
.ui-send-btn.loading{pointer-events:none;color:transparent}
.ui-send-btn.loading::after{
  content:"";position:absolute;top:50%;left:50%;margin:-8px 0 0 -8px;
  width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;
  border-radius:50%;animation:spin .8s linear infinite
}
.ui-context-pill{
  display:inline-flex;gap:8px;background:#fff;border:1px solid var(--line);padding:6px 12px;border-radius:999px;color:var(--muted);
  max-width:860px;width:fit-content;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;margin:6px auto 12px;position:sticky;bottom:98px;
  box-shadow:0 6px 16px rgba(15,23,42,.08)
}
.ui-pill-dirty{color:var(--warn)}
.ui-workbench{
  padding:12px;min-height:0;display:flex;flex-direction:column;border:1px solid var(--line);
  background:rgba(251,248,243,.85);box-shadow:0 16px 36px rgba(15,23,42,.08)
}
.ui-viewer{border:1px solid var(--line);border-radius:var(--radius-lg);background:#fff;overflow:hidden;display:flex;flex-direction:column;min-height:240px;max-height:50vh;margin-bottom:12px;box-shadow:0 14px 30px rgba(15,23,42,.1)}
.ui-viewer__bar{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,rgba(255,255,255,.9),rgba(255,255,255,.6))}
.ui-viewer__title{font-weight:700;letter-spacing:.02em}
.ui-viewer__actions{display:flex;gap:8px;align-items:center}
.ui-viewer__content{padding:12px 14px;overflow:auto;font-family:"Noto Serif SC","Songti SC","STZhongsong","SimSun",serif}
.ui-viewer__content a{color:#1a73e8;text-decoration:none}
.ui-viewer__content a:hover{text-decoration:underline}
.ui-viewer__content blockquote{margin:10px 0;padding:8px 12px;border-left:3px solid #c7d2f2;background:#f7f9ff;border-radius:12px;color:#2d2f36}
.ui-viewer__content .md-code{background:#0b1020;color:#e6e6e6;padding:12px 14px;border-radius:14px;overflow:auto;border:1px solid #1f2a4a}
.ui-viewer__content .md-code code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:13px;white-space:pre}
.ui-tabs{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;align-items:center}
.ui-tab{padding:8px 14px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.9);cursor:pointer;color:var(--muted);transition:all .2s ease}
.ui-tab--active{border-color:rgba(15,118,110,.4);color:var(--brand-solid);box-shadow:0 4px 12px rgba(15,118,110,.18)}
.ui-panels{position:relative;min-height:0;flex:1}
.ui-panel{border:1px solid var(--line);border-radius:var(--radius-lg);padding:14px;background:rgba(255,255,255,.96);height:100%;overflow:auto}
.ui-form label{display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--muted)}
.ui-form input,.ui-form select,.ui-form textarea{padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#fff;font:inherit}
.ui-grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.ui-actions-row{margin-top:8px}
.ui-hint{margin-top:6px;color:var(--muted);font-size:12px}
.ui-reader{display:grid;grid-template-rows:auto 1fr;height:60vh}
.ui-reader__bar{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--line);padding:6px 8px}
.ui-reader__content{padding:12px;overflow:auto;font-family:"Noto Serif SC","Songti SC","STZhongsong","SimSun",serif}

/* Bento cards */
.ui-bento{display:grid;gap:16px}

/* 功能分组 */
.ui-bento-group{margin-bottom:8px}
.ui-bento-group__title{
  font-size:11px;font-weight:600;color:var(--muted);
  text-transform:uppercase;letter-spacing:1px;
  margin-bottom:10px;padding-left:4px
}
.ui-bento-group__cards{display:grid;gap:12px}
/* 高优先级分组视觉强调 */
.ui-bento-group[data-priority="high"] .ui-card{border-left:3px solid var(--brand-solid)}
.ui-card{
  position:relative;
  border:1px solid var(--line);border-radius:var(--radius-lg);
  background:rgba(255,255,255,.88);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);
  overflow:hidden;box-shadow:var(--shadow-md);
  transition:transform .25s ease,box-shadow .25s ease
}
/* 镭射边框效果 */
.ui-card::before{
  content:"";position:absolute;inset:0;border-radius:inherit;padding:1px;
  background:linear-gradient(135deg,rgba(15,118,110,.3),rgba(45,212,191,.4),rgba(245,158,11,.3),rgba(15,118,110,.3));
  -webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);
  -webkit-mask-composite:xor;mask-composite:exclude;
  pointer-events:none;opacity:0;transition:opacity .3s ease
}
.ui-card:hover::before{opacity:1}
.ui-card:hover{transform:translateY(-4px);box-shadow:var(--shadow-lg),var(--shadow-glow)}
.ui-card--flat{margin-bottom:12px}
.ui-card__hd{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid var(--line);gap:10px}
.ui-card__hd-left{display:flex;align-items:center;gap:8px}
.ui-card__title{font-weight:700}
.ui-card__status{
  display:inline-flex;align-items:center;gap:4px;padding:2px 8px;
  font-size:10px;font-weight:600;border-radius:999px;
  background:rgba(15,118,110,.1);color:var(--brand-solid)
}
.ui-card__status--active{background:rgba(31,139,76,.1);color:var(--ok)}
.ui-card__status--pending{background:rgba(181,105,0,.1);color:var(--warn)}
.ui-card__hd-right{display:flex;align-items:center;gap:6px}
.ui-card__btn{padding:6px 10px;border-radius:10px}
/* 折叠按钮 */
.ui-card__toggle{
  width:24px;height:24px;display:flex;align-items:center;justify-content:center;
  cursor:pointer;border:none;background:transparent;color:var(--muted);
  transition:transform .3s ease;border-radius:6px
}
.ui-card__toggle:hover{background:var(--line)}
.ui-card__toggle svg{width:16px;height:16px}
.ui-card.collapsed .ui-card__toggle{transform:rotate(-90deg)}
/* 卡片内容折叠 */
.ui-card__bd{padding:12px 14px;color:var(--ink);transition:max-height .3s ease,padding .3s ease,opacity .2s ease;overflow:hidden}
.ui-card.collapsed .ui-card__bd{max-height:0;padding:0 14px;opacity:0}
.ui-task{display:flex;justify-content:space-between;gap:10px;align-items:flex-start;padding:10px 0;border-bottom:1px dashed rgba(15,23,42,.12)}
.ui-task:last-child{border-bottom:none}
.ui-task__meta{color:var(--muted);font-size:12px}

/* 进度条 */
.ui-progress{height:4px;background:var(--line);border-radius:2px;overflow:hidden;margin:12px 0}
.ui-progress__bar{height:100%;background:var(--brand);border-radius:2px;transition:width .3s ease}
.ui-progress--indeterminate .ui-progress__bar{
  width:30%;animation:progressIndeterminate 1.5s ease-in-out infinite
}
@keyframes progressIndeterminate{
  0%{transform:translateX(-100%)}
  100%{transform:translateX(400%)}
}

/* 步骤指示器 */
.ui-steps{display:flex;gap:8px;margin:16px 0;justify-content:center}
.ui-step{
  width:28px;height:28px;border-radius:50%;border:2px solid var(--line);
  display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;
  transition:all .3s ease;background:#fff;color:var(--muted)
}
.ui-step.current{border-color:var(--brand-solid);background:var(--brand);color:#fff;box-shadow:0 0 0 4px rgba(15,118,110,.15)}
.ui-step.completed{border-color:var(--ok);background:var(--ok);color:#fff}
.ui-step__dot{
  width:24px;height:24px;border-radius:50%;border:2px solid var(--line);
  display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600;
  transition:all .3s ease;background:#fff
}
.ui-step.active .ui-step__dot{border-color:var(--brand-solid);background:var(--brand);color:#fff}
.ui-step.completed .ui-step__dot{border-color:var(--ok);background:var(--ok);color:#fff}
.ui-step__label{font-size:11px;color:var(--muted);text-align:center}

/* 进度包装器 */
.ui-progress-wrapper{padding:8px 0}

/* Session drawer */
.ui-drawer{position:fixed;inset:0;display:none;z-index:40}
.ui-drawer.open{display:block}
.ui-drawer__overlay{position:absolute;inset:0;background:rgba(0,0,0,.35)}
.ui-drawer__panel{position:absolute;top:0;bottom:0;left:0;width:min(420px, 92vw);background:var(--surface);border-right:1px solid var(--line);padding:12px;display:grid;grid-template-rows:auto auto 1fr;gap:10px}
.ui-drawer__hd{display:flex;gap:10px;align-items:center;justify-content:space-between}
.ui-drawer__title{font-weight:700}
.ui-drawer__search input{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:14px;background:#fff}
.ui-drawer__list{overflow:auto;min-height:0;display:grid;gap:8px}
.ui-session-item{padding:10px 12px;border-radius:14px;cursor:pointer;border:1px solid transparent;transition:background .2s ease}
.ui-session-item:hover{background:#fff;border-color:rgba(15,23,42,.08)}
.ui-session-item .title{font-size:13px;font-weight:600}
.ui-session-item .sub{font-size:12px;color:var(--muted);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
@media (min-width:1081px){
  body{overflow:hidden}
  .ui-layout{height:calc(100vh - var(--header-h))}
}
@media (max-width:1080px){
  body{overflow:auto}
  .ui-layout{grid-template-columns:1fr;min-height:calc(100vh - var(--header-h))}
  .ui-context-pill{bottom:140px}
  .ui-panel{height:auto}

  /* Mobile: Bento becomes bottom sheet */
  .ui-workbench{
    position:fixed;left:0;right:0;bottom:0;
    height:85vh;max-height:calc(100vh - 60px);max-height:calc(100dvh - 60px);
    transform:translateY(100%);
    transition:transform .35s cubic-bezier(.32,.72,0,1);
    z-index:30;border-radius:24px 24px 0 0;
    box-shadow:0 -10px 40px rgba(15,23,42,.15);
    will-change:transform
  }

  /* 拖拽指示器 */
  .ui-workbench::before{
    content:"";position:absolute;top:8px;left:50%;transform:translateX(-50%);
    width:40px;height:4px;background:rgba(15,23,42,.2);border-radius:2px;
    z-index:1
  }

  .ui-viewer{max-height:28vh;min-height:120px}

  /* 展开态 */
  body.show-bento .ui-workbench{transform:translateY(0)}

  /* 半展开态（peek mode） */
  body.show-bento-peek .ui-workbench{transform:translateY(calc(100% - 200px))}

  /* 遮罩层 */
  body.show-bento::before,body.show-bento-peek::before{
    content:"";position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:29;
    animation:fadeIn .3s ease
  }
  @keyframes fadeIn{from{opacity:0}to{opacity:1}}

  /* 移动端卡片禁用hover效果 */
  .ui-card:hover{transform:none}
  .ui-card:hover::before{opacity:0}
  .ui-card:active{transform:scale(.98);transition:transform .1s ease}
}
