# In ./CLAUDE.md
@vibelife/docs/archive/v8/ARCHITECTURE.md

@vibelife/docs/deployment-test.md
@vibelife/docs/config-test.md

## Plan Mode
- Make the plan extremely concise
- At the end, give a list of unresolved questions

## Agent SDK Best Practices

### LLM-First 架构（强制）

**核心原则**：让 LLM 做决策，系统提供工具和数据，通过配置和 Prompt 引导而非代码硬编码。

#### Agentic Loop 本质
```
用户消息 → LLM 思考 → 工具调用 → 环境反馈 → LLM 继续
```
不要用代码硬编码决策逻辑，让 LLM 自己判断。

#### 三层架构

| 维度 | 硬编码（禁止） | LLM 驱动（正确） |
|------|--------------|----------------|
| 路由 | `if "关键词" in msg:` | LLM 读 SKILL.md triggers |
| 状态 | `_compute_status()` | LLM 从历史推断 |
| 流程 | `step = 1, 2, 3` | Rule 文件 + LLM 自推进 |
| 配置 | Python 常量 | YAML/Markdown 文件 |

#### 渐进式加载

- **Phase 1**：Core + Skill 列表（轻量）
- **Phase 2**：已选 Skill 全文 + tools + rules（完整）

#### 配置位置

| 规则类型 | 位置 | 示例 |
|---------|------|------|
| Skill 触发词 | SKILL.md frontmatter | `triggers: [八字, 命理]` |
| SOP 流程 | rules/*.md | 步骤定义 |
| 工具属性 | tools.yaml | `_should_checkpoint: true` |
| 案例 | cases/ 或 DB | Prompt 注入 |

#### 系统占位符

| 占位符 | 值示例 | 用途 |
|-------|-------|-----|
| `{current_year}` | 2026 | 避免 LLM 用知识截止日期 |
| `{current_date}` | 2026-01-25 | 日期相关判断 |

在需要日期的 SKILL.md 中添加：
```markdown
## 系统信息
当前日期：{current_date}，当前年份：{current_year}年
```

**已启用的 Skill**：bazi, zodiac, lifecoach, jungastro, tarot
