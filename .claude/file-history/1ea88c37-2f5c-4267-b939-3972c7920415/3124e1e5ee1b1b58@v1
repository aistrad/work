---
id: first-meeting-promise
name: 首次相遇结束承诺
version: 1.0.0
impact: MEDIUM
impactDescription: 建立用户对"明天还有"的期待
tags: onboarding, promise, first-meeting
---

# 结束承诺规则

## 触发条件

以下任一条件满足时，Agent 应发出结束承诺：

1. 用户明确表示要离开（"我先走了"、"下次再聊"、"晚安"、"拜拜"）
2. 对话超过 10 轮且用户回复变短
3. 时间超过晚上 10 点（如可获取用户时区）
4. 用户长时间（>2分钟）未回复后回来
5. 用户完成了一个完整的分析流程

## 承诺文案

### 标准版

```
今天的对话我记住了。
明天早上 8 点，我会根据你的命盘给你今日运势。
期待明天见！
```

### 根据用户选择定制

| 用户选择 | 承诺文案 |
|---------|---------|
| life_direction | "明天早上 8 点，我会提醒你设定今天最重要的一件事。" |
| career_finance | "明天早上 8 点，我会告诉你今日的职场运势和行动建议。" |
| relationship | "明天早上 8 点，我会分享一个关系相处的小建议。" |
| curious | "明天早上 8 点，我会给你今日运势解读。" |

### 晚间版（22:00 后）

```
今天就先聊到这里吧，早点休息。
明天早上 8 点，我会给你今日运势。
晚安！
```

### 用户主动离开版

```
好的，{回应用户离开语}。
明天早上 8 点，我会给你今日运势提醒。
{离开语}！
```

**离开语匹配**：
- "我先走了" → "我们明天见"
- "下次再聊" → "下次见"
- "晚安" → "晚安"
- "拜拜" → "再见"

## 工具调用

承诺发出后，执行以下工具调用：

### 1. 设置明日推送

```
remind(
    action="set",
    title="首日运势",
    schedule="08:00",
    schedule_type="daily"
)
```

**推送内容建议**（存储供推送系统使用）：

| 用户选择 | 推送标题 | 推送内容模板 |
|---------|---------|-------------|
| life_direction | 今日一步 | "今天最重要的一件事是什么？设定它，然后开始。" |
| career_finance | 今日职场运势 | "{根据命盘生成}" |
| relationship | 关系小贴士 | "今天在关系中，你可以..." |
| curious | 今日运势 | "{根据命盘生成}" |

### 2. 标记首次相遇完成

```
save(path="vibe.onboarding_completed", data=true)
```

### 3. 记录完成时间

```
save(path="vibe.onboarding.completed_at", data="{当前时间ISO格式}")
```

### 4. 记录用户选择（如尚未记录）

```
save(path="vibe.onboarding.guidance", data="{选择}")
```

## 禁止行为

- 禁止在承诺后继续追问
- 禁止提及付费/订阅
- 禁止使用"功能"、"服务"等产品词汇
- 禁止过于热情（保持克制的温暖）
- 禁止给压力（如"记得明天来看哦"）

## 特殊情况

### 用户在引导选择前离开

如果用户在选择关注领域之前就要离开：

**响应**：
```
好的，下次再继续。
有任何想聊的，随时来找我。
再见！
```

**动作**：
1. `save(path="vibe.onboarding.early_exit", data=true)`
2. 不标记 `onboarding_completed`（用户下次回来会继续流程）

### 用户表示不想收到推送

如果用户说"不用提醒我"、"不要推送"：

**响应**：
```
明白了，我不会打扰你。
有需要的时候，随时来找我就好。
```

**动作**：
1. 不调用 `remind`
2. `save(path="vibe.onboarding.push_declined", data=true)`
3. `save(path="vibe.onboarding_completed", data=true)`

### 用户想要改变推送时间

如果用户说"能不能不要那么早"、"晚一点推送"：

**响应**：
```
当然可以！你希望几点收到提醒？
```

然后根据用户回复调整 `remind` 的 `schedule` 参数。
