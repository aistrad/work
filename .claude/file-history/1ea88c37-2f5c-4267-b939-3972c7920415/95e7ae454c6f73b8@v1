version: "1.0"
skill_id: onboarding
description: 首次相遇 Skill 工具

tools:
  # ═══════════════════════════════════════════════════════════════════════════
  # 核心工具：生成三个洞察
  # ═══════════════════════════════════════════════════════════════════════════
  - name: generate_insights
    description: |
      基于用户命盘生成三个精准洞察。
      只在首次相遇时使用，生成后返回洞察数据供 show 工具展示。

      ## 何时调用
      - 首次相遇流程开始时
      - 用户刚完成 Onboarding，进入 Chat 后

      ## 返回数据
      返回三个洞察，每个包含：
      - type: inner_conflict | external_expression | current_state
      - content: 洞察内容（一句话）
      - basis: 生成依据（仅供内部记录，不展示给用户）

      ## 后续操作
      调用 show(type="card", card_type="insights_card", data={insights: [...]})
    type: action
    when_to_call: 首次相遇流程开始时，生成三个洞察
    _internal:
      llm_generate: true
      rule_file: rules/insights-generation.md
    parameters:
      - name: bazi_chart
        type: object
        required: false
        description: 八字命盘数据（如果未提供，自动从 profile 读取）
      - name: zodiac_data
        type: object
        required: false
        description: 星座数据（如果未提供，自动从 profile 读取）
    returns:
      type: object
      properties:
        insights:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                enum: [inner_conflict, external_expression, current_state]
              content:
                type: string
              basis:
                type: string
        pattern_name:
          type: string
          description: 格局名称（如"七杀格"）
        sun_sign:
          type: string
          description: 太阳星座（如"双子座"）

  # ═══════════════════════════════════════════════════════════════════════════
  # 展示工具：洞察卡片
  # ═══════════════════════════════════════════════════════════════════════════
  - name: show_insights
    description: |
      展示首次相遇的三个洞察卡片。

      ## 卡片内容
      - 三个洞察（内在矛盾、外在表现、当下状态）
      - 三个反馈按钮（说得准、不太准、有话想说）

      ## 用户交互
      用户点击按钮后，会发送对应的反馈文本：
      - "说得准" → 用户发送 "准"
      - "不太准" → 用户发送 "不准"
      - "有话想说" → 用户发送 "想说话"
    type: display
    card_type: insights_card
    when_to_call: generate_insights 返回后，展示洞察
    parameters:
      - name: insights
        type: array
        required: true
        description: 三个洞察内容
      - name: pattern_name
        type: string
        required: true
        description: 格局名称（如"七杀格"）
      - name: sun_sign
        type: string
        required: true
        description: 太阳星座（如"双子座"）

  # ═══════════════════════════════════════════════════════════════════════════
  # 展示工具：引导选择卡片
  # ═══════════════════════════════════════════════════════════════════════════
  - name: show_guidance
    description: |
      展示首次相遇的引导选择卡片。

      ## 卡片内容
      三个选项：
      - "想找到人生方向" → 触发 lifecoach
      - "想改善职场/财务" → 触发 bazi + career
      - "想改善感情/关系" → 触发 synastry + zodiac

      ## 用户交互
      用户点击选项后，会发送对应的选择文本
    type: display
    card_type: guidance_card
    when_to_call: 反馈收集完成后，引导用户选择关注领域
    parameters:
      - name: question
        type: string
        required: false
        default: "最近有什么让你困扰的事吗？"
        description: 引导问题
      - name: options
        type: array
        required: false
        description: 自定义选项列表（默认使用标准三个选项）
