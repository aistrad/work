"""
Onboarding Skill Tool Handlers - é¦–æ¬¡ç›¸é‡å·¥å…·æ‰§è¡Œå™¨

V1.0 æ¶æ„ï¼š
- generate_insights: LLM é©±åŠ¨çš„æ´å¯Ÿç”Ÿæˆï¼ˆè¯»å–å‘½ç›˜ï¼Œè¿”å›ä¸‰ä¸ªæ´å¯Ÿï¼‰
- show_insights: å±•ç¤ºæ´å¯Ÿå¡ç‰‡ï¼ˆLLM è°ƒç”¨ show å·¥å…·ï¼‰
- show_guidance: å±•ç¤ºå¼•å¯¼é€‰æ‹©å¡ç‰‡ï¼ˆLLM è°ƒç”¨ show å·¥å…·ï¼‰

å·¥å…·ç”± LLM æ ¹æ® SKILL.md è§„åˆ™è‡ªä¸»è°ƒç”¨ï¼Œæ— ç¡¬ç¼–ç æµç¨‹ã€‚
"""
import logging
from datetime import datetime, timezone
from typing import Dict, Any, List, Optional

from services.agent.tool_registry import tool_handler, ToolContext

logger = logging.getLogger(__name__)


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# å¸¸é‡ï¼šæ´å¯Ÿç”Ÿæˆå‚è€ƒæ•°æ®
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ—¥ä¸»ç‰¹è´¨æ˜ å°„
DAYMASTER_TRAITS = {
    "ç”²": {"core": "ç”Ÿå‘ã€è¿›å–ã€æ­£ç›´", "positive": "æœ‰æŠ±è´Ÿ", "negative": "å›ºæ‰§"},
    "ä¹™": {"core": "æŸ”éŸ§ã€é€‚åº”ã€è‰ºæœ¯", "positive": "çµæ´»", "negative": "ä¼˜æŸ”"},
    "ä¸™": {"core": "çƒ­æƒ…ã€å¼€æœ—ã€è¡¨è¾¾", "positive": "é˜³å…‰", "negative": "å†²åŠ¨"},
    "ä¸": {"core": "ç»†è…»ã€æ¸©æš–ã€åšæŒ", "positive": "ä¸“æ³¨", "negative": "å†…è€—"},
    "æˆŠ": {"core": "ç¨³é‡ã€åŒ…å®¹ã€ä¿¡ä»»", "positive": "å¯é ", "negative": "ä¿å®ˆ"},
    "å·±": {"core": "åŠ¡å®ã€ç»†å¿ƒã€æœåŠ¡", "positive": "è¸å®", "negative": "çº ç»“"},
    "åºš": {"core": "æœæ–­ã€ä¹‰æ°”ã€æ‰§è¡Œ", "positive": "æœ‰é­„åŠ›", "negative": "å¤ªç›´"},
    "è¾›": {"core": "ç²¾è‡´ã€æ•æ„Ÿã€æ ‡å‡†", "positive": "å“å‘³é«˜", "negative": "æŒ‘å‰”"},
    "å£¬": {"core": "æ™ºæ…§ã€è‡ªç”±ã€é€‚åº”", "positive": "èªæ˜", "negative": "æ•£æ¼«"},
    "ç™¸": {"core": "ç»†è…»ã€å†…æ•›ã€æ·±æ²‰", "positive": "æ•é”", "negative": "å¤šè™‘"},
}

# å¤ªé˜³æ˜Ÿåº§ç‰¹è´¨æ˜ å°„
SUN_SIGN_TRAITS = {
    "ç™½ç¾Šåº§": {"element": "fire", "core": "è¡ŒåŠ¨ã€çƒ­æƒ…ã€è‡ªä¿¡", "conflict_a": "è¿½æ±‚è‡ªç”±", "conflict_b": "æ¸´æœ›è®¤å¯"},
    "é‡‘ç‰›åº§": {"element": "earth", "core": "ç¨³å®šã€åŠ¡å®ã€äº«å—", "conflict_a": "è¿½æ±‚å®‰å…¨", "conflict_b": "æ¸´æœ›æ”¹å˜"},
    "åŒå­åº§": {"element": "air", "core": "æ€è€ƒã€å¥½å¥‡ã€å¤šå˜", "conflict_a": "è¿½æ±‚è‡ªç”±è¡¨è¾¾", "conflict_b": "æ¸´æœ›è¢«ç†è§£"},
    "å·¨èŸ¹åº§": {"element": "water", "core": "æƒ…æ„Ÿã€ç›´è§‰ã€ä¿æŠ¤", "conflict_a": "æ¸´æœ›å½’å±", "conflict_b": "å®³æ€•è¢«ä¼¤å®³"},
    "ç‹®å­åº§": {"element": "fire", "core": "è‡ªä¿¡ã€åˆ›é€ ã€é¢†å¯¼", "conflict_a": "æ¸´æœ›é—ªè€€", "conflict_b": "å®³æ€•è¢«å¦å®š"},
    "å¤„å¥³åº§": {"element": "earth", "core": "åˆ†æã€æœåŠ¡ã€å®Œç¾", "conflict_a": "è¿½æ±‚å®Œç¾", "conflict_b": "æ¥å—ä¸å®Œç¾"},
    "å¤©ç§¤åº§": {"element": "air", "core": "å’Œè°ã€å®¡ç¾ã€å…¬æ­£", "conflict_a": "è¿½æ±‚å’Œè°", "conflict_b": "è¡¨è¾¾çœŸå®æƒ³æ³•"},
    "å¤©èåº§": {"element": "water", "core": "æ·±åº¦ã€æŒæ§ã€è½¬åŒ–", "conflict_a": "è¿½æ±‚æ·±åº¦", "conflict_b": "ææƒ§æš´éœ²"},
    "å°„æ‰‹åº§": {"element": "fire", "core": "æ¢ç´¢ã€ä¹è§‚ã€è‡ªç”±", "conflict_a": "è¿½æ±‚è‡ªç”±", "conflict_b": "æ‰¿æ‹…è´£ä»»"},
    "æ‘©ç¾¯åº§": {"element": "earth", "core": "é‡å¿ƒã€è´£ä»»ã€æˆå°±", "conflict_a": "è¿½æ±‚æˆå°±", "conflict_b": "äº«å—å½“ä¸‹"},
    "æ°´ç“¶åº§": {"element": "air", "core": "åˆ›æ–°ã€ç‹¬ç«‹ã€äººé“", "conflict_a": "è¿½æ±‚ç‹¬ç‰¹", "conflict_b": "æ¸´æœ›å½’å±"},
    "åŒé±¼åº§": {"element": "water", "core": "çµæ€§ã€åŒç†ã€è‰ºæœ¯", "conflict_a": "è¿½æ±‚ç†æƒ³", "conflict_b": "é¢å¯¹ç°å®"},
}

# æ—¶æŸ±åç¥ç‰¹è´¨æ˜ å°„ï¼ˆèŒåœº/ç¤¾äº¤è¡¨ç°ï¼‰
HOUR_PILLAR_TRAITS = {
    "åå®˜": {"domain": "èŒåœº", "positive": "æ‰§è¡ŒåŠ›å¼ºã€æœ‰é­„åŠ›", "risk": "å› ä¸ºå¤ªç›´æ¥å¾—ç½ªäºº"},
    "ä¸ƒæ€": {"domain": "èŒåœº", "positive": "æ‰§è¡ŒåŠ›å¼ºã€æœ‰é­„åŠ›", "risk": "å› ä¸ºå¤ªç›´æ¥å¾—ç½ªäºº"},
    "åè´¢": {"domain": "èŒåœº", "positive": "èµ„æºæ•´åˆèƒ½åŠ›å¼º", "risk": "è¿‡äºè¿½æ±‚æ•ˆç‡"},
    "æ­£è´¢": {"domain": "ç¤¾äº¤", "positive": "è¸å®å¯é ", "risk": "ä¸å–„äºè¡¨è¾¾éœ€æ±‚"},
    "æ­£å°": {"domain": "ç¤¾äº¤", "positive": "å—äººå°Šæ•¬ã€æœ‰å¨ä¿¡", "risk": "è¿‡äºåœ¨æ„å½¢è±¡"},
    "åå°": {"domain": "ä¸äººç›¸å¤„æ—¶", "positive": "æ€ç»´ç‹¬ç‰¹", "risk": "éš¾ä»¥è¢«ç†è§£"},
    "é£Ÿç¥": {"domain": "ç¤¾äº¤", "positive": "äº²å’ŒåŠ›å¼ºã€æœ‰åˆ›æ„", "risk": "è¿‡äºåœ¨æ„ä»–äººçœ‹æ³•"},
    "ä¼¤å®˜": {"domain": "ç¤¾äº¤", "positive": "è¡¨è¾¾èƒ½åŠ›å¼º", "risk": "è¨€è¯­è¿‡äºçŠ€åˆ©"},
    "æ¯”è‚©": {"domain": "ä¸äººç›¸å¤„æ—¶", "positive": "ç‹¬ç«‹è‡ªä¸»", "risk": "ä¸å–„äºæ±‚åŠ©"},
    "åŠ«è´¢": {"domain": "èŒåœº", "positive": "ç«äº‰æ„è¯†å¼º", "risk": "è¿‡äºå¥½èƒœ"},
}

# æµå¹´çŠ¶æ€æ˜ å°„
FORTUNE_STATES = {
    "å…‹åˆ¶æœŸ": "æƒ³è¦æ”¹å˜ä½†ä¸çŸ¥é“ä»å“ªå¼€å§‹",
    "å‹åŠ›æœŸ": "æ„Ÿè§‰è¢«å›°ä½äº†ï¼Œéœ€è¦çªç ´",
    "æ¶ˆè€—æœŸ": "æœ‰å¾ˆå¤šæƒ³æ³•ä½†éš¾ä»¥è¡ŒåŠ¨",
    "æ‰©å±•æœŸ": "å¯¹æœªæ¥æ—¢æœŸå¾…åˆç„¦è™‘",
    "è°ƒæ•´æœŸ": "æƒ³è¦è¢«ç†è§£ä½†ä¸çŸ¥å¦‚ä½•è¡¨è¾¾",
    "è½¬æŠ˜æœŸ": "ç«™åœ¨äººç”Ÿçš„åå­—è·¯å£",
}


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æ ¸å¿ƒå·¥å…·ï¼šgenerate_insights
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@tool_handler("generate_insights")
async def execute_generate_insights(args: Dict[str, Any], context: ToolContext) -> Dict[str, Any]:
    """
    åŸºäºç”¨æˆ·å‘½ç›˜ç”Ÿæˆä¸‰ä¸ªç²¾å‡†æ´å¯Ÿã€‚

    å·¥å…·ä¼šä» profile ä¸­è¯»å– bazi_chart å’Œ zodiac_dataï¼Œ
    ç”Ÿæˆä¸‰ä¸ªç»´åº¦çš„æ´å¯Ÿï¼š
    1. å†…åœ¨çŸ›ç›¾ (inner_conflict)
    2. å¤–åœ¨è¡¨ç° (external_expression)
    3. å½“ä¸‹çŠ¶æ€ (current_state)

    è¿”å›æ•°æ®ä¾› show å·¥å…·å±•ç¤ºã€‚
    """
    # ä»å‚æ•°æˆ– context.skill_data è·å–å‘½ç›˜æ•°æ®
    bazi_chart = args.get("bazi_chart")
    zodiac_data = args.get("zodiac_data")

    # å¦‚æœå‚æ•°ä¸­æ²¡æœ‰ï¼Œä» profile è¯»å–
    if not bazi_chart or not zodiac_data:
        profile = context.profile or {}
        skills_data = profile.get("skills", {})

        if not bazi_chart:
            bazi_chart = skills_data.get("bazi", {}).get("chart", {})

        if not zodiac_data:
            zodiac_data = skills_data.get("zodiac", {}).get("chart", {})

    # éªŒè¯å¿…è¦æ•°æ®
    if not bazi_chart:
        return {
            "status": "error",
            "error": "ç¼ºå°‘å…«å­—å‘½ç›˜æ•°æ®ã€‚è¯·å…ˆå®Œæˆå‡ºç”Ÿä¿¡æ¯æ”¶é›†ã€‚",
        }

    # æå–å…³é”®æ•°æ®
    day_master = bazi_chart.get("day_master", {})
    day_master_element = day_master.get("element", "ç”²")  # æ—¥ä¸»å¤©å¹²
    month_pillar = bazi_chart.get("month_pillar", {})
    hour_pillar = bazi_chart.get("hour_pillar", {})
    pattern = bazi_chart.get("pattern", {})
    pattern_name = pattern.get("name", "æ­£å®˜æ ¼")

    # å¤ªé˜³æ˜Ÿåº§
    sun_sign = "åŒå­åº§"
    if zodiac_data:
        planets = zodiac_data.get("planets", {})
        sun = planets.get("sun", {})
        sun_sign = sun.get("sign", "åŒå­åº§")

    # ä¸Šå‡æ˜Ÿåº§
    rising_sign = "ç‹®å­åº§"
    if zodiac_data:
        rising = zodiac_data.get("ascendant", {})
        rising_sign = rising.get("sign", "ç‹®å­åº§")

    # æ—¶æŸ±åç¥
    hour_god = hour_pillar.get("ten_god", "åè´¢")

    # ç”Ÿæˆä¸‰ä¸ªæ´å¯Ÿ
    insights = []

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # æ´å¯Ÿ 1: å†…åœ¨çŸ›ç›¾
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    dm_traits = DAYMASTER_TRAITS.get(day_master_element, DAYMASTER_TRAITS["ç”²"])
    sun_traits = SUN_SIGN_TRAITS.get(sun_sign, SUN_SIGN_TRAITS["åŒå­åº§"])

    inner_conflict = f"ä½ çš„å†…åœ¨çŸ›ç›¾ï¼š{sun_traits['conflict_a']} vs {sun_traits['conflict_b']}"

    insights.append({
        "type": "inner_conflict",
        "content": inner_conflict,
        "basis": f"æ—¥ä¸»{day_master_element} + {sun_sign}ç‰¹è´¨",
    })

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # æ´å¯Ÿ 2: å¤–åœ¨è¡¨ç°
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    hour_traits = HOUR_PILLAR_TRAITS.get(hour_god, HOUR_PILLAR_TRAITS["åè´¢"])

    external_expression = (
        f"ä½ åœ¨{hour_traits['domain']}ï¼š{hour_traits['positive']}ï¼Œ"
        f"ä½†å¯èƒ½{hour_traits['risk']}"
    )

    insights.append({
        "type": "external_expression",
        "content": external_expression,
        "basis": f"æ—¶æŸ±{hour_god} + {rising_sign}ä¸Šå‡",
    })

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # æ´å¯Ÿ 3: å½“ä¸‹çŠ¶æ€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ç®€åŒ–ç‰ˆï¼šæ ¹æ®æ ¼å±€ç±»å‹æ¨æµ‹å½“å‰çŠ¶æ€
    current_state = _infer_current_state(pattern_name, sun_sign)

    insights.append({
        "type": "current_state",
        "content": f"ä½ æœ€è¿‘å¯èƒ½æ„Ÿåˆ°ï¼š{current_state}",
        "basis": f"æ ¼å±€{pattern_name} + å½“å‰è¿åŠ¿å‘¨æœŸ",
    })

    return {
        "status": "success",
        "insights": insights,
        "pattern_name": pattern_name,
        "sun_sign": sun_sign,
        "message": "æ´å¯Ÿç”Ÿæˆå®Œæˆï¼Œè¯·ä½¿ç”¨ show_insights å±•ç¤ºç»™ç”¨æˆ·",
    }


def _infer_current_state(pattern_name: str, sun_sign: str) -> str:
    """æ ¹æ®æ ¼å±€å’Œæ˜Ÿåº§æ¨æµ‹å½“å‰çŠ¶æ€"""
    # ç®€åŒ–é€»è¾‘ï¼šæ ¹æ®æ ¼å±€ç±»å‹æ˜ å°„
    if "æ€" in pattern_name or "å®˜" in pattern_name:
        return FORTUNE_STATES.get("å…‹åˆ¶æœŸ", "æƒ³è¦æ”¹å˜ä½†ä¸çŸ¥é“ä»å“ªå¼€å§‹")
    elif "å°" in pattern_name:
        return FORTUNE_STATES.get("è°ƒæ•´æœŸ", "æƒ³è¦è¢«ç†è§£ä½†ä¸çŸ¥å¦‚ä½•è¡¨è¾¾")
    elif "è´¢" in pattern_name:
        return FORTUNE_STATES.get("æ‰©å±•æœŸ", "å¯¹æœªæ¥æ—¢æœŸå¾…åˆç„¦è™‘")
    elif "é£Ÿ" in pattern_name or "ä¼¤" in pattern_name:
        return FORTUNE_STATES.get("æ¶ˆè€—æœŸ", "æœ‰å¾ˆå¤šæƒ³æ³•ä½†éš¾ä»¥è¡ŒåŠ¨")
    else:
        return FORTUNE_STATES.get("è½¬æŠ˜æœŸ", "ç«™åœ¨äººç”Ÿçš„åå­—è·¯å£")


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# å±•ç¤ºå·¥å…·ï¼šshow_insights
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@tool_handler("show_insights")
async def execute_show_insights(args: Dict[str, Any], context: ToolContext) -> Dict[str, Any]:
    """
    å±•ç¤ºé¦–æ¬¡ç›¸é‡çš„ä¸‰ä¸ªæ´å¯Ÿå¡ç‰‡ã€‚

    è¿”å› insights_card ç±»å‹çš„æ•°æ®ä¾›å‰ç«¯æ¸²æŸ“ã€‚
    """
    insights = args.get("insights", [])
    pattern_name = args.get("pattern_name", "")
    sun_sign = args.get("sun_sign", "")

    if not insights:
        return {
            "status": "error",
            "error": "ç¼ºå°‘æ´å¯Ÿæ•°æ®ï¼Œè¯·å…ˆè°ƒç”¨ generate_insights",
        }

    return {
        "status": "success",
        "cardType": "insights_card",
        "insights": insights,
        "pattern_name": pattern_name,
        "sun_sign": sun_sign,
        "feedback_buttons": [
            {"id": "accurate", "label": "è¯´å¾—å‡†", "emoji": "ğŸ‘", "message": "å‡†"},
            {"id": "not_accurate", "label": "ä¸å¤ªå‡†", "emoji": "ğŸ‘", "message": "ä¸å‡†"},
            {"id": "want_to_talk", "label": "æœ‰è¯æƒ³è¯´", "emoji": "ğŸ’¬", "message": "æƒ³è¯´è¯"},
        ],
    }


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# å±•ç¤ºå·¥å…·ï¼šshow_guidance
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@tool_handler("show_guidance")
async def execute_show_guidance(args: Dict[str, Any], context: ToolContext) -> Dict[str, Any]:
    """
    å±•ç¤ºé¦–æ¬¡ç›¸é‡çš„å¼•å¯¼é€‰æ‹©å¡ç‰‡ã€‚

    è¿”å› guidance_card ç±»å‹çš„æ•°æ®ä¾›å‰ç«¯æ¸²æŸ“ã€‚
    """
    question = args.get("question", "æœ€è¿‘æœ‰ä»€ä¹ˆè®©ä½ å›°æ‰°çš„äº‹å—ï¼Ÿ")
    custom_options = args.get("options")

    # é»˜è®¤ä¸‰ä¸ªé€‰é¡¹
    default_options = [
        {
            "id": "life_direction",
            "label": "æƒ³æ‰¾åˆ°äººç”Ÿæ–¹å‘",
            "icon": "compass",
            "emoji": "ğŸ§­",
            "skills": ["lifecoach"],
        },
        {
            "id": "career_finance",
            "label": "æƒ³æ”¹å–„èŒåœº/è´¢åŠ¡",
            "icon": "briefcase",
            "emoji": "ğŸ’¼",
            "skills": ["bazi", "career"],
        },
        {
            "id": "relationship",
            "label": "æƒ³æ”¹å–„æ„Ÿæƒ…/å…³ç³»",
            "icon": "heart",
            "emoji": "â¤ï¸",
            "skills": ["zodiac", "synastry"],
        },
    ]

    options = custom_options if custom_options else default_options

    return {
        "status": "success",
        "cardType": "guidance_card",
        "question": question,
        "options": options,
        "allow_skip": True,
        "skip_label": "æˆ‘åªæ˜¯å¥½å¥‡",
    }
