# VibeLife ç”¨æˆ·æ³¨å†Œ/ç®¡ç†/æ”¶è´¹æµç¨‹åˆ†ææŠ¥å‘Š

> **ç‰ˆæœ¬**: v1.0
> **æ—¥æœŸ**: 2026-01-15
> **ç±»å‹**: Ultra Deep Analysis Report

---

## ä¸€ã€ç”¨æˆ·å…¨ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾

### 1.1 ç”¨æˆ·èº«ä»½çŠ¶æ€æµè½¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VibeLife ç”¨æˆ·èº«ä»½çŠ¶æ€æœº                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚                              â”‚   è®¿å®¢æµé‡    â”‚                                   â”‚
â”‚                              â”‚  (Landing)   â”‚                                   â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                     â”‚                                           â”‚
â”‚                                     â–¼                                           â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                    â”‚           GUEST (æ¸¸å®¢)              â”‚                       â”‚
â”‚                    â”‚  Â· session_id (cookie, 30å¤©)       â”‚                       â”‚
â”‚                    â”‚  Â· å®Œæ•´ onboarding                 â”‚                       â”‚
â”‚                    â”‚  Â· ç®€ç‰ˆæŠ¥å‘Š                        â”‚                       â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                  â”‚                                              â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚                   â”‚                   â”‚                          â”‚
â”‚              â–¼                   â–¼                   â–¼                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚ é‚®ç®±+å¯†ç æ³¨å†Œ   â”‚  â”‚ æ‰‹æœºå·+å¯†ç æ³¨å†Œ â”‚  â”‚ OAuth æ³¨å†Œ     â”‚                  â”‚
â”‚     â”‚  (æµ·å¤–ç”¨æˆ·)     â”‚  â”‚  (å¤§é™†ç”¨æˆ·)     â”‚  â”‚ Google/Apple  â”‚                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚             â”‚                   â”‚                   â”‚                          â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                 â”‚                                              â”‚
â”‚                                 â–¼                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                    â”‚         FREE USER (å…è´¹ç”¨æˆ·)        â”‚                       â”‚
â”‚                    â”‚  Â· user_id + vibe_id               â”‚                       â”‚
â”‚                    â”‚  Â· æ¯æ—¥10æ¡å¯¹è¯                     â”‚                       â”‚
â”‚                    â”‚  Â· 3æ¬¡å…³ç³»åˆ†æ                      â”‚                       â”‚
â”‚                    â”‚  Â· 1æ¬¡æŠ¥å‘Šç”Ÿæˆ                      â”‚                       â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                  â”‚                                              â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚                   â”‚                   â”‚                          â”‚
â”‚              â–¼                   â–¼                   â–¼                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚ USD æœˆä»˜ $9.9  â”‚  â”‚ HKD 1æœˆ $39   â”‚  â”‚ å•æ¬¡æŠ¥å‘Š Â¥19.9 â”‚                  â”‚
â”‚     â”‚ å­£ä»˜/å¹´ä»˜      â”‚  â”‚ 3æœˆ/12æœˆ      â”‚  â”‚  (ä¸€æ¬¡æ€§)       â”‚                  â”‚
â”‚     â”‚  (è‡ªåŠ¨ç»­è´¹)    â”‚  â”‚  (é¢„ä»˜æ¨¡å¼)    â”‚  â”‚               â”‚                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚             â”‚                   â”‚                   â”‚                          â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                 â”‚                                              â”‚
â”‚                                 â–¼                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                    â”‚         PAID USER (ä»˜è´¹ç”¨æˆ·)        â”‚                       â”‚
â”‚                    â”‚  Â· subscription (active/prepaid)   â”‚                       â”‚
â”‚                    â”‚  Â· æ— é™å¯¹è¯                         â”‚                       â”‚
â”‚                    â”‚  Â· å®Œæ•´æŠ¥å‘Š + AIæµ·æŠ¥                â”‚                       â”‚
â”‚                    â”‚  Â· å…¨éƒ¨åŠŸèƒ½                         â”‚                       â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                  â”‚                                              â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚                                       â”‚                          â”‚
â”‚              â–¼                                       â–¼                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚   ç»­è´¹æˆåŠŸ     â”‚                      â”‚  åˆ°æœŸ/å–æ¶ˆ     â”‚                  â”‚
â”‚     â”‚  (å¾ªç¯ â†»)      â”‚                      â”‚               â”‚                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                     â”‚                          â”‚
â”‚                                                     â–¼                          â”‚
â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                                        â”‚  FREE USER (é™çº§)      â”‚              â”‚
â”‚                                        â”‚  Â· ä¿ç•™å†å²æ•°æ®        â”‚              â”‚
â”‚                                        â”‚  Â· æ¢å¤ä½¿ç”¨é™åˆ¶        â”‚              â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ³¨å†Œæµç¨‹è¯¦å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ç”¨æˆ·æ³¨å†Œè¯¦ç»†æµç¨‹                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                           Stage 1: Landing Page                             â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚  è¾“å…¥: ç”Ÿè¾°ä¿¡æ¯(é”®ç›˜) + æ€§åˆ«(å¯é€‰) + å…³æ³¨ç‚¹(å¯é€‰)                       â”‚â”‚â”‚
â”‚  â”‚  â”‚                                                                         â”‚â”‚â”‚
â”‚  â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚â”‚â”‚
â”‚  â”‚  â”‚         â”‚     åç«¯: POST /guest/session      â”‚                          â”‚â”‚â”‚
â”‚  â”‚  â”‚         â”‚     ç”Ÿæˆ gs_xxxx session_id        â”‚                          â”‚â”‚â”‚
â”‚  â”‚  â”‚         â”‚     å­˜å…¥ cookie (30å¤©æœ‰æ•ˆ)         â”‚                          â”‚â”‚â”‚
â”‚  â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â”‚                                     â”‚                                       â”‚â”‚
â”‚  â”‚                                     â–¼                                       â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚                           Stage 2-6: ä½“éªŒæµç¨‹                           â”‚â”‚â”‚
â”‚  â”‚  â”‚  Loading â†’ Aha Moment â†’ äººæ ¼é€‰æ‹© â†’ æ·±åº¦è®¿è°ˆ â†’ æ¥è‡ªæœªæ¥çš„ä¿¡              â”‚â”‚â”‚
â”‚  â”‚  â”‚                                                                         â”‚â”‚â”‚
â”‚  â”‚  â”‚  [æ•°æ®å­˜å‚¨ä½ç½®]                                                         â”‚â”‚â”‚
â”‚  â”‚  â”‚   Â· guest_sessions.interview_responses                                  â”‚â”‚â”‚
â”‚  â”‚  â”‚   Â· guest_sessions.focus_areas                                          â”‚â”‚â”‚
â”‚  â”‚  â”‚   Â· guest_sessions.voice_mode                                           â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â”‚                                     â”‚                                       â”‚â”‚
â”‚  â”‚                                     â–¼                                       â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚                         Stage 7: æ³¨å†Œ/ä»˜è´¹å¢™                            â”‚â”‚â”‚
â”‚  â”‚  â”‚                                                                         â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚                   ç”¨æˆ·é€‰æ‹©æ³¨å†Œæ–¹å¼                      â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚                                                        â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚   [å¤§é™†ç”¨æˆ·]              [æµ·å¤–ç”¨æˆ·]                   â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚   æ‰‹æœºå·+å¯†ç              Google OAuth                 â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚   (æœªæ¥: å¾®ä¿¡)            Apple OAuth                  â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚                          é‚®ç®±+å¯†ç                      â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚â”‚â”‚
â”‚  â”‚  â”‚                                     â”‚                                   â”‚â”‚â”‚
â”‚  â”‚  â”‚                                     â–¼                                   â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚              POST /auth/register                       â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚                                                        â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚  Request:                                              â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚   Â· email/phone + password                            â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚   Â· session_id (from cookie)                          â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚   Â· onboarding: {birth, gender, voice_mode, etc}      â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚                                                        â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚  Process:                                              â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚   1. åˆ›å»º vibe_users è®°å½•                              â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚   2. åˆ›å»º user_auth è®°å½• (hash password)              â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚   3. å…³è” guest_session â†’ converted_user_id           â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚   4. åˆ›å»º unified_profiles è®°å½•                       â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚   5. ç”Ÿæˆ JWT access_token + refresh_token            â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚                                                        â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚  Response:                                             â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚   Â· access_token, refresh_token                       â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â”‚   Â· user: {user_id, vibe_id, display_name}            â”‚          â”‚â”‚â”‚
â”‚  â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æ”¯ä»˜æµç¨‹è¯¦å›¾ (åŒè½¨åˆ¶)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            æ”¯ä»˜æµç¨‹è¯¦å›¾ (Stripe åŒè½¨åˆ¶)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                              Step 1: åœ°åŒºæ£€æµ‹                               â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚     GET /payment/detect-region                                              â”‚â”‚
â”‚  â”‚     â””â”€ IP æ£€æµ‹ (api.ip.sb/geoip) â†’ CN/HK â†’ "CN" | å…¶ä»– â†’ "GLOBAL"           â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚                                           â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚                                 â”‚                          â”‚
â”‚                    â–¼                                 â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚      CN è½¨é“ (é¢„ä»˜æ¨¡å¼)       â”‚  â”‚    GLOBAL è½¨é“ (è®¢é˜…æ¨¡å¼)    â”‚             â”‚
â”‚  â”‚                              â”‚  â”‚                              â”‚             â”‚
â”‚  â”‚  äº§å“:                       â”‚  â”‚  äº§å“:                       â”‚             â”‚
â”‚  â”‚   Â· cn_1m  (HK$39/1æœˆ)      â”‚  â”‚   Â· global_monthly  ($9.9)  â”‚             â”‚
â”‚  â”‚   Â· cn_3m  (HK$99/3æœˆ)      â”‚  â”‚   Â· global_quarterly ($24.9)â”‚             â”‚
â”‚  â”‚   Â· cn_12m (HK$298/12æœˆ)    â”‚  â”‚   Â· global_yearly ($69.9)   â”‚             â”‚
â”‚  â”‚                              â”‚  â”‚                              â”‚             â”‚
â”‚  â”‚  æ”¯ä»˜æ–¹å¼:                   â”‚  â”‚  æ”¯ä»˜æ–¹å¼:                   â”‚             â”‚
â”‚  â”‚   Â· æ”¯ä»˜å® (Alipay)         â”‚  â”‚   Â· ä¿¡ç”¨å¡ (Card)           â”‚             â”‚
â”‚  â”‚   Â· å¾®ä¿¡æ”¯ä»˜ (WeChat Pay)   â”‚  â”‚   Â· Apple Pay               â”‚             â”‚
â”‚  â”‚   Â· ä¿¡ç”¨å¡                   â”‚  â”‚   Â· Google Pay              â”‚             â”‚
â”‚  â”‚                              â”‚  â”‚                              â”‚             â”‚
â”‚  â”‚  Stripe mode: "payment"     â”‚  â”‚  Stripe mode: "subscription"â”‚             â”‚
â”‚  â”‚  (ä¸€æ¬¡æ€§)                    â”‚  â”‚  (è‡ªåŠ¨ç»­è´¹)                  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                    â”‚                                 â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                     â”‚                                           â”‚
â”‚                                     â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                       Step 2: åˆ›å»º Checkout Session                         â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  POST /payment/create-checkout                                              â”‚â”‚
â”‚  â”‚   Â· user_id                                                                 â”‚â”‚
â”‚  â”‚   Â· product_id (cn_1m | global_monthly | ...)                              â”‚â”‚
â”‚  â”‚   Â· success_url, cancel_url                                                 â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  Process:                                                                   â”‚â”‚
â”‚  â”‚   1. è§£æ product_id â†’ ç¡®å®š region + plan                                   â”‚â”‚
â”‚  â”‚   2. è·å– Stripe Price ID (from env)                                        â”‚â”‚
â”‚  â”‚   3. è°ƒç”¨ stripe.checkout.Session.create()                                  â”‚â”‚
â”‚  â”‚   4. å†™å…¥ payments è¡¨ (status=pending)                                      â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  Response:                                                                  â”‚â”‚
â”‚  â”‚   Â· checkout_url (Stripe æ‰˜ç®¡æ”¯ä»˜é¡µ)                                        â”‚â”‚
â”‚  â”‚   Â· session_id (cs_xxx)                                                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚                                           â”‚
â”‚                                     â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                         Step 3: ç”¨æˆ·å®Œæˆæ”¯ä»˜                                 â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  æµè§ˆå™¨è·³è½¬åˆ° Stripe Checkout é¡µé¢                                           â”‚â”‚
â”‚  â”‚   Â· ç”¨æˆ·é€‰æ‹©æ”¯ä»˜æ–¹å¼                                                         â”‚â”‚
â”‚  â”‚   Â· å®Œæˆæ”¯ä»˜                                                                 â”‚â”‚
â”‚  â”‚   Â· é‡å®šå‘åˆ° success_url                                                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚                                           â”‚
â”‚                                     â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                          Step 4: Webhook å¤„ç†                               â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  POST /payment/webhook (Stripe â†’ Backend)                                   â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚  Event: checkout.session.completed                                      â”‚â”‚â”‚
â”‚  â”‚  â”‚                                                                         â”‚â”‚â”‚
â”‚  â”‚  â”‚  CN è½¨é“ (é¢„ä»˜):                    GLOBAL è½¨é“ (è®¢é˜…):                  â”‚â”‚â”‚
â”‚  â”‚  â”‚   Â· è¯»å– service_days              Â· è¯»å– subscription_id              â”‚â”‚â”‚
â”‚  â”‚  â”‚   Â· è®¡ç®— expire_at                 Â· è¯»å– customer_id                  â”‚â”‚â”‚
â”‚  â”‚  â”‚   Â· æ›´æ–° payments.status=success   Â· æ›´æ–° payments.status=success      â”‚â”‚â”‚
â”‚  â”‚  â”‚   Â· âš ï¸ TODO: å†™å…¥ subscriptions è¡¨  Â· âš ï¸ TODO: å†™å…¥ subscriptions è¡¨    â”‚â”‚â”‚
â”‚  â”‚  â”‚                                                                         â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  å…¶ä»–äº‹ä»¶:                                                                   â”‚â”‚
â”‚  â”‚   Â· payment_intent.succeeded â†’ æ›´æ–°æ”¯ä»˜çŠ¶æ€                                 â”‚â”‚
â”‚  â”‚   Â· payment_intent.payment_failed â†’ è®°å½•å¤±è´¥                                â”‚â”‚
â”‚  â”‚   Â· customer.subscription.updated â†’ åŒæ­¥è®¢é˜…çŠ¶æ€                            â”‚â”‚
â”‚  â”‚   Â· customer.subscription.deleted â†’ æ ‡è®°å–æ¶ˆ                                â”‚â”‚
â”‚  â”‚   Â· invoice.payment_failed â†’ ç»­è´¹å¤±è´¥å¤„ç†                                   â”‚â”‚
â”‚  â”‚   Â· invoice.paid â†’ ç»­è´¹æˆåŠŸå»¶æœŸ                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.4 ç”¨æˆ·ç®¡ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ç”¨æˆ·ç®¡ç†æµç¨‹                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                             è®¤è¯æµç¨‹                                         â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚â”‚
â”‚  â”‚  â”‚    ç™»å½•       â”‚    â”‚   Token åˆ·æ–°   â”‚    â”‚    ç™»å‡º       â”‚               â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚â”‚
â”‚  â”‚          â”‚                    â”‚                    â”‚                       â”‚â”‚
â”‚  â”‚          â–¼                    â–¼                    â–¼                       â”‚â”‚
â”‚  â”‚  POST /auth/login      POST /auth/refresh   POST /auth/logout              â”‚â”‚
â”‚  â”‚   Â· email/phone+pass    Â· refresh_token      Â· å®¢æˆ·ç«¯æ¸…é™¤ token            â”‚â”‚
â”‚  â”‚   Â· è¿”å› JWT tokens     Â· è¿”å›æ–° tokens      Â· (æ— æœåŠ¡ç«¯çŠ¶æ€)              â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                            å¯†ç é‡ç½®æµç¨‹                                      â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  Step 1: è¯·æ±‚é‡ç½®                                                           â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚  POST /auth/password/reset-request                                 â”‚    â”‚â”‚
â”‚  â”‚  â”‚   Â· email æˆ– phone                                                 â”‚    â”‚â”‚
â”‚  â”‚  â”‚   Â· ç”Ÿæˆ token (1å°æ—¶æœ‰æ•ˆ)                                         â”‚    â”‚â”‚
â”‚  â”‚  â”‚   Â· å†™å…¥ password_reset_tokens è¡¨                                  â”‚    â”‚â”‚
â”‚  â”‚  â”‚   Â· âš ï¸ TODO: å‘é€é‚®ä»¶/çŸ­ä¿¡                                         â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â”‚                                     â”‚                                       â”‚â”‚
â”‚  â”‚                                     â–¼                                       â”‚â”‚
â”‚  â”‚  Step 2: éªŒè¯ Token                                                         â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚  POST /auth/password/verify-token                                  â”‚    â”‚â”‚
â”‚  â”‚  â”‚   Â· æ£€æŸ¥ token æœ‰æ•ˆæ€§                                              â”‚    â”‚â”‚
â”‚  â”‚  â”‚   Â· è¿”å› valid: true/false                                        â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â”‚                                     â”‚                                       â”‚â”‚
â”‚  â”‚                                     â–¼                                       â”‚â”‚
â”‚  â”‚  Step 3: é‡ç½®å¯†ç                                                            â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚  POST /auth/password/reset                                         â”‚    â”‚â”‚
â”‚  â”‚  â”‚   Â· token + new_password                                           â”‚    â”‚â”‚
â”‚  â”‚  â”‚   Â· æ›´æ–° user_auth.password_hash                                   â”‚    â”‚â”‚
â”‚  â”‚  â”‚   Â· æ ‡è®° token å·²ä½¿ç”¨                                              â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                            æƒé™æ£€æŸ¥æµç¨‹                                      â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  æ¯æ¬¡ API è¯·æ±‚:                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚                                                                    â”‚    â”‚â”‚
â”‚  â”‚  â”‚  Request Header: Authorization: Bearer <access_token>             â”‚    â”‚â”‚
â”‚  â”‚  â”‚                           â”‚                                        â”‚    â”‚â”‚
â”‚  â”‚  â”‚                           â–¼                                        â”‚    â”‚â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚â”‚
â”‚  â”‚  â”‚  â”‚            get_current_user() Dependency                    â”‚  â”‚    â”‚â”‚
â”‚  â”‚  â”‚  â”‚                                                             â”‚  â”‚    â”‚â”‚
â”‚  â”‚  â”‚  â”‚  1. ä» Header æå– Bearer token                             â”‚  â”‚    â”‚â”‚
â”‚  â”‚  â”‚  â”‚  2. JWTService.verify_access_token(token)                   â”‚  â”‚    â”‚â”‚
â”‚  â”‚  â”‚  â”‚  3. ä» payload æå– user_id, vibe_id                        â”‚  â”‚    â”‚â”‚
â”‚  â”‚  â”‚  â”‚  4. UserRepository.get_by_id(user_id) éªŒè¯ç”¨æˆ·å­˜åœ¨          â”‚  â”‚    â”‚â”‚
â”‚  â”‚  â”‚  â”‚  5. è¿”å› CurrentUser å¯¹è±¡                                   â”‚  â”‚    â”‚â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚â”‚
â”‚  â”‚  â”‚                                                                    â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚  ä½¿ç”¨é™åˆ¶æ£€æŸ¥ (å…è´¹ç”¨æˆ·):                                                    â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚  â”‚  â”‚  FREE_USER_LIMITS = {                                              â”‚    â”‚â”‚
â”‚  â”‚  â”‚      "chat_message": {"daily": 10},         # æ¯æ—¥å¯¹è¯            â”‚    â”‚â”‚
â”‚  â”‚  â”‚      "relationship_analysis": {"total": 3}, # å…³ç³»åˆ†ææ€»æ¬¡æ•°      â”‚    â”‚â”‚
â”‚  â”‚  â”‚      "life_kline": {"total": 3},            # Kçº¿æŸ¥çœ‹æ€»æ¬¡æ•°       â”‚    â”‚â”‚
â”‚  â”‚  â”‚      "report_generation": {"total": 1},     # æŠ¥å‘Šç”Ÿæˆæ€»æ¬¡æ•°      â”‚    â”‚â”‚
â”‚  â”‚  â”‚  }                                                                 â”‚    â”‚â”‚
â”‚  â”‚  â”‚                                                                    â”‚    â”‚â”‚
â”‚  â”‚  â”‚  å­˜å‚¨: user_usage è¡¨ (user_id, usage_type, count, period_start)   â”‚    â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.5 æ•°æ®è¡¨å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              æ ¸å¿ƒæ•°æ®è¡¨å…³ç³»                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚      vibe_users         â”‚                                                    â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚                                                    â”‚
â”‚  â”‚  id (UUID) PK           â”‚                                                    â”‚
â”‚  â”‚  vibe_id (VARCHAR)      â”‚                                                    â”‚
â”‚  â”‚  display_name           â”‚                                                    â”‚
â”‚  â”‚  avatar_url             â”‚                                                    â”‚
â”‚  â”‚  is_guest (BOOL)        â”‚                                                    â”‚
â”‚  â”‚  status (active/...)    â”‚                                                    â”‚
â”‚  â”‚  created_at             â”‚                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚              â”‚ 1                                                                â”‚
â”‚              â”‚                                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚    â”‚         â”‚         â”‚             â”‚             â”‚             â”‚              â”‚
â”‚    â–¼ *       â–¼ *       â–¼ *           â–¼ 0..1        â–¼ *           â–¼ *            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚user_  â”‚ â”‚unifiedâ”‚ â”‚ payments  â”‚ â”‚subscript- â”‚ â”‚user_      â”‚ â”‚ conversa- â”‚   â”‚
â”‚  â”‚auth   â”‚ â”‚profilesâ”‚ â”‚          â”‚ â”‚  ions     â”‚ â”‚usage      â”‚ â”‚   tions   â”‚   â”‚
â”‚  â”‚â•â•â•â•â•â•â•â”‚ â”‚â•â•â•â•â•â•â•â”‚ â”‚â•â•â•â•â•â•â•â•â•â•â•â”‚ â”‚â•â•â•â•â•â•â•â•â•â•â•â”‚ â”‚â•â•â•â•â•â•â•â•â•â•â•â”‚ â”‚â•â•â•â•â•â•â•â•â•â•â•â”‚   â”‚
â”‚  â”‚user_idâ”‚ â”‚user_idâ”‚ â”‚user_id    â”‚ â”‚user_id    â”‚ â”‚user_id    â”‚ â”‚user_id    â”‚   â”‚
â”‚  â”‚auth_  â”‚ â”‚skill  â”‚ â”‚amount     â”‚ â”‚plan_id    â”‚ â”‚usage_type â”‚ â”‚skill      â”‚   â”‚
â”‚  â”‚ type  â”‚ â”‚versionâ”‚ â”‚currency   â”‚ â”‚status     â”‚ â”‚count      â”‚ â”‚voice_mode â”‚   â”‚
â”‚  â”‚auth_  â”‚ â”‚profileâ”‚ â”‚status     â”‚ â”‚stripe_id  â”‚ â”‚period_    â”‚ â”‚messages[] â”‚   â”‚
â”‚  â”‚identi-â”‚ â”‚(JSONB)â”‚ â”‚provider   â”‚ â”‚current_   â”‚ â”‚ start     â”‚ â”‚           â”‚   â”‚
â”‚  â”‚ fier  â”‚ â”‚       â”‚ â”‚provider_  â”‚ â”‚ period_   â”‚ â”‚period_    â”‚ â”‚           â”‚   â”‚
â”‚  â”‚pass-  â”‚ â”‚       â”‚ â”‚ payment_  â”‚ â”‚ end       â”‚ â”‚ type      â”‚ â”‚           â”‚   â”‚
â”‚  â”‚word_  â”‚ â”‚       â”‚ â”‚ id        â”‚ â”‚           â”‚ â”‚           â”‚ â”‚           â”‚   â”‚
â”‚  â”‚ hash  â”‚ â”‚       â”‚ â”‚           â”‚ â”‚           â”‚ â”‚           â”‚ â”‚           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚    guest_sessions       â”‚  (ç‹¬ç«‹è¡¨ï¼Œæ³¨å†Œåé€šè¿‡ converted_user_id å…³è”)       â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚                                                    â”‚
â”‚  â”‚  session_id (VARCHAR)   â”‚                                                    â”‚
â”‚  â”‚  birth_datetime         â”‚                                                    â”‚
â”‚  â”‚  gender, voice_mode     â”‚                                                    â”‚
â”‚  â”‚  interview_responses    â”‚                                                    â”‚
â”‚  â”‚  converted_user_id FK   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â”‚  expires_at             â”‚                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€ç°çŠ¶è¯„ä¼°

### 2.1 ä¼˜ç‚¹

| æ–¹é¢ | è¯„ä»· |
|------|------|
| **æ¶æ„è®¾è®¡** | æ¸…æ™°çš„æ¸¸å®¢â†’å…è´¹â†’ä»˜è´¹ä¸‰å±‚æ¨¡å‹ï¼Œç¬¦åˆ SaaS æœ€ä½³å®è·µ |
| **åŒè½¨æ”¶è´¹** | é’ˆå¯¹å¤§é™†/æµ·å¤–ç”¨æˆ·åŒºåˆ†å¤„ç†ï¼Œè€ƒè™‘äº†åˆè§„æ€§å’Œç”¨æˆ·ä¹ æƒ¯ |
| **OAuth æ”¯æŒ** | Google/Apple ç™»å½•å·²å®ç°ï¼Œé™ä½æ³¨å†Œé—¨æ§› |
| **æ¸¸å®¢è½¬åŒ–** | session æ•°æ®å¯å…³è”åˆ°æ³¨å†Œç”¨æˆ·ï¼Œä¸ä¸¢å¤± onboarding ä¿¡æ¯ |
| **JWT å®ç°** | æ ‡å‡†çš„ access/refresh token æœºåˆ¶ |

### 2.2 é—®é¢˜è¯†åˆ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              é—®é¢˜æ¸…å• (æŒ‰ä¸¥é‡ç¨‹åº¦)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  ğŸ”´ P0 - é˜»æ–­æ€§é—®é¢˜ (å½±å“æ”¶å…¥)                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 1. Webhook è®¢é˜…çŠ¶æ€æœªæŒä¹…åŒ–                                                 â”‚â”‚
â”‚  â”‚    ä½ç½®: routes/payment.py:743-779                                          â”‚â”‚
â”‚  â”‚    ç°çŠ¶: _handle_checkout_completed ä¸­æ ‡æ³¨ # TODOï¼Œå®é™…æœªå†™å…¥ subscriptions  â”‚â”‚
â”‚  â”‚    å½±å“: ç”¨æˆ·ä»˜æ¬¾æˆåŠŸä½†ç³»ç»Ÿä¸çŸ¥é“ï¼ŒåŠŸèƒ½æ— æ³•è§£é”                                â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚ 2. è®¢é˜…çŠ¶æ€æŸ¥è¯¢è¿”å› mock æ•°æ®                                               â”‚â”‚
â”‚  â”‚    ä½ç½®: routes/payment.py:632-652                                          â”‚â”‚
â”‚  â”‚    ç°çŠ¶: /payment/subscription æ°¸è¿œè¿”å› has_subscription=False              â”‚â”‚
â”‚  â”‚    å½±å“: å‰ç«¯æ— æ³•æ­£ç¡®æ˜¾ç¤ºç”¨æˆ·ä»˜è´¹çŠ¶æ€                                          â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚ 3. Stripe Price ID æœªé…ç½®                                                   â”‚â”‚
â”‚  â”‚    ä½ç½®: routes/payment.py:109-119 / .env                                   â”‚â”‚
â”‚  â”‚    ç°çŠ¶: STRIPE_PRICE_* ç¯å¢ƒå˜é‡ä¸ºç©º                                         â”‚â”‚
â”‚  â”‚    å½±å“: æ— æ³•åˆ›å»ºçœŸå®çš„ Checkout Session                                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â”‚  ğŸŸ¡ P1 - é‡è¦é—®é¢˜ (å½±å“è½¬åŒ–ç‡)                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 4. å¤§é™†é¢„ä»˜ç»­è´¹æé†’æœªå®ç°                                                   â”‚â”‚
â”‚  â”‚    è®¾è®¡: payment-design.md å®šä¹‰äº† 7å¤©/3å¤©/1å¤© æé†’                          â”‚â”‚
â”‚  â”‚    ç°çŠ¶: æ— å¯¹åº”ä»£ç                                                           â”‚â”‚
â”‚  â”‚    å½±å“: é¢„ä»˜ç”¨æˆ·åˆ°æœŸä¸çŸ¥é“ï¼Œæµå¤±                                             â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚ 5. å¾®ä¿¡ç™»å½•ç¼ºå¤±                                                             â”‚â”‚
â”‚  â”‚    ç°çŠ¶: åªæœ‰ Google/Apple OAuth                                            â”‚â”‚
â”‚  â”‚    å½±å“: å¤§é™†ä¸»æµç”¨æˆ·æ— æ³•å¿«é€Ÿæ³¨å†Œ                                             â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚ 6. æ‰‹æœºå·æ— çŸ­ä¿¡éªŒè¯                                                         â”‚â”‚
â”‚  â”‚    ç°çŠ¶: æ‰‹æœºå·+å¯†ç æ³¨å†Œï¼Œæ— éªŒè¯ç                                             â”‚â”‚
â”‚  â”‚    å½±å“: å®‰å…¨æ€§é™ä½ï¼Œå¯èƒ½è¢«åˆ·å·                                               â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚ 7. é‚®ä»¶/çŸ­ä¿¡å‘é€æœåŠ¡æœªé›†æˆ                                                  â”‚â”‚
â”‚  â”‚    ä½ç½®: routes/auth.py:340 "# åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‘é€é‚®ä»¶/çŸ­ä¿¡"                    â”‚â”‚
â”‚  â”‚    ç°çŠ¶: å¯†ç é‡ç½®é“¾æ¥åªåœ¨ API å“åº”ä¸­è¿”å›                                      â”‚â”‚
â”‚  â”‚    å½±å“: çœŸå®ç”¨æˆ·æ— æ³•æ”¶åˆ°é‡ç½®é“¾æ¥                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â”‚  ğŸŸ¢ P2 - æ”¹è¿›é¡¹ (æå‡ä½“éªŒ)                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 8. Customer Portal æœªæ¥å…¥                                                   â”‚â”‚
â”‚  â”‚    å·²æœ‰: StripeService.create_billing_portal_session()                      â”‚â”‚
â”‚  â”‚    ç¼ºå¤±: æ—  API ç«¯ç‚¹æš´éœ²ç»™å‰ç«¯                                               â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚ 9. å…è´¹ç”¨æˆ·ä½¿ç”¨é‡é‡ç½®é€»è¾‘                                                   â”‚â”‚
â”‚  â”‚    å®šä¹‰: FREE_USER_LIMITS åŒ…å« daily å’Œ total ä¸¤ç§                         â”‚â”‚
â”‚  â”‚    ç°çŠ¶: æ— å®šæ—¶ä»»åŠ¡é‡ç½® daily è®¡æ•°                                           â”‚â”‚
â”‚  â”‚                                                                             â”‚â”‚
â”‚  â”‚ 10. SSO è·¨ç«™ç‚¹ç™»å½•                                                          â”‚â”‚
â”‚  â”‚     å·²æœ‰: /auth/sso/generate, /auth/sso/callback                           â”‚â”‚
â”‚  â”‚     é—®é¢˜: ç›®æ ‡ç«™ç‚¹é…ç½®æœªå®Œæˆ (bazi/zodiac/mbti.vibelife.app)               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æˆ˜ç•¥çº§ä¼˜åŒ–æ–¹æ¡ˆ

### 3.1 ä¼˜åŒ–è·¯çº¿å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ä¼˜åŒ–è·¯çº¿å›¾ (æˆ˜ç•¥çº§)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  Phase 1: æ‰“é€šæ”¶è´¹é—­ç¯ (å¿…é¡»ä¼˜å…ˆ)                                                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  â”‚                                                                             â”‚
â”‚  â”‚  ç›®æ ‡: ç”¨æˆ·ä»˜æ¬¾åèƒ½æ­£ç¡®è·å¾—æƒç›Š                                              â”‚
â”‚  â”‚                                                                             â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â”‚  1.1 å®Œæˆ Webhook è®¢é˜…çŠ¶æ€æŒä¹…åŒ–                                     â”‚  â”‚
â”‚  â”‚  â”‚      Â· _handle_checkout_completed â†’ å†™å…¥ subscriptions è¡¨            â”‚  â”‚
â”‚  â”‚  â”‚      Â· CN: type=prepaid, expire_at=now+service_days                  â”‚  â”‚
â”‚  â”‚  â”‚      Â· GLOBAL: type=subscription, stripe_subscription_id             â”‚  â”‚
â”‚  â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  â”‚  1.2 å®ç° /payment/subscription çœŸå®æŸ¥è¯¢                             â”‚  â”‚
â”‚  â”‚  â”‚      Â· æŸ¥è¯¢ subscriptions è¡¨                                         â”‚  â”‚
â”‚  â”‚  â”‚      Â· è¿”å› {type, status, expire_at, plan}                         â”‚  â”‚
â”‚  â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  â”‚  1.3 é…ç½® Stripe Price ID                                            â”‚  â”‚
â”‚  â”‚  â”‚      Â· åœ¨ Stripe Dashboard åˆ›å»ºäº§å“å’Œä»·æ ¼                            â”‚  â”‚
â”‚  â”‚  â”‚      Â· æ›´æ–° .env ä¸­çš„ STRIPE_PRICE_* å˜é‡                            â”‚  â”‚
â”‚  â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  â”‚  1.4 æƒç›Šæ£€æŸ¥ä¸­é—´ä»¶                                                   â”‚  â”‚
â”‚  â”‚  â”‚      Â· ä¿®æ”¹ get_current_user æ³¨å…¥è®¢é˜…çŠ¶æ€                            â”‚  â”‚
â”‚  â”‚  â”‚      Â· æˆ–æ–°å¢ get_user_entitlements() ä¾èµ–                           â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚                                                                             â”‚
â”‚                                                                                 â”‚
â”‚  Phase 2: æå‡è½¬åŒ–ç‡                                                            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  â”‚                                                                             â”‚
â”‚  â”‚  ç›®æ ‡: é™ä½æ³¨å†Œé—¨æ§›ï¼Œæé«˜ä»˜è´¹è½¬åŒ–                                            â”‚
â”‚  â”‚                                                                             â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â”‚  2.1 å¤§é™†é¢„ä»˜ç»­è´¹æé†’ç³»ç»Ÿ                                             â”‚  â”‚
â”‚  â”‚  â”‚      Â· å®šæ—¶ä»»åŠ¡æ£€æŸ¥ expire_at                                        â”‚  â”‚
â”‚  â”‚  â”‚      Â· 7å¤©/3å¤©/1å¤© åˆ†çº§æé†’                                          â”‚  â”‚
â”‚  â”‚  â”‚      Â· æ¨é€æ¸ é“: Appå†…é€šçŸ¥ + (æœªæ¥)å¾®ä¿¡æœåŠ¡å·                         â”‚  â”‚
â”‚  â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  â”‚  2.2 é‚®ä»¶å‘é€æœåŠ¡é›†æˆ                                                 â”‚  â”‚
â”‚  â”‚  â”‚      Â· é€‰å‹: SendGrid / AWS SES / Resend                             â”‚  â”‚
â”‚  â”‚  â”‚      Â· åœºæ™¯: å¯†ç é‡ç½® + ç»­è´¹æé†’ + å‘¨æŠ¥                              â”‚  â”‚
â”‚  â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  â”‚  2.3 Customer Portal ç«¯ç‚¹                                             â”‚  â”‚
â”‚  â”‚  â”‚      Â· POST /billing/portal â†’ è¿”å› Stripe Portal URL                 â”‚  â”‚
â”‚  â”‚  â”‚      Â· ä»…è®¢é˜…ç”¨æˆ·å¯ç”¨ (éé¢„ä»˜)                                        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚                                                                             â”‚
â”‚                                                                                 â”‚
â”‚  Phase 3: å¤§é™†æœ¬åœ°åŒ– (é•¿æœŸ)                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  â”‚                                                                             â”‚
â”‚  â”‚  ç›®æ ‡: è¦†ç›–å¤§é™†ä¸»æµç”¨æˆ·ä¹ æƒ¯                                                  â”‚
â”‚  â”‚                                                                             â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â”‚  3.1 å¾®ä¿¡ç™»å½•                                                         â”‚  â”‚
â”‚  â”‚  â”‚      Â· å¾®ä¿¡å¼€æ”¾å¹³å°æ³¨å†Œ                                               â”‚  â”‚
â”‚  â”‚  â”‚      Â· æ‰«ç ç™»å½• (PC) + æˆæƒç™»å½• (å¾®ä¿¡æµè§ˆå™¨)                          â”‚  â”‚
â”‚  â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  â”‚  3.2 çŸ­ä¿¡éªŒè¯ç                                                        â”‚  â”‚
â”‚  â”‚  â”‚      Â· é€‰å‹: é˜¿é‡Œäº‘SMS / è…¾è®¯äº‘SMS                                    â”‚  â”‚
â”‚  â”‚  â”‚      Â· åœºæ™¯: æ³¨å†Œ + ç™»å½• + å¯†ç é‡ç½®                                   â”‚  â”‚
â”‚  â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  â”‚  3.3 å¾®ä¿¡æœåŠ¡å·æ¨é€                                                   â”‚  â”‚
â”‚  â”‚  â”‚      Â· å…³æ³¨å…¬ä¼—å·ç»‘å®šç”¨æˆ·                                             â”‚  â”‚
â”‚  â”‚  â”‚      Â· æ¨¡æ¿æ¶ˆæ¯æ¨é€ç»­è´¹æé†’                                           â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚                                                                             â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ¶æ„æ”¹è¿›å»ºè®®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æ¶æ„æ”¹è¿›å»ºè®®                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  1. è®¢é˜…æœåŠ¡æŠ½è±¡å±‚                                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                                 â”‚
â”‚    ç°çŠ¶: è®¢é˜…é€»è¾‘æ•£è½åœ¨ payment.py webhook handler ä¸­                            â”‚
â”‚    å»ºè®®: æ–°å»º services/subscription/subscription_service.py                      â”‚
â”‚                                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚  class SubscriptionService:                                            â”‚  â”‚
â”‚    â”‚      async def create_prepaid(user_id, days, payment_id)              â”‚  â”‚
â”‚    â”‚      async def create_subscription(user_id, stripe_sub_id)            â”‚  â”‚
â”‚    â”‚      async def get_active(user_id) -> Subscription | None             â”‚  â”‚
â”‚    â”‚      async def check_entitlement(user_id, feature) -> bool            â”‚  â”‚
â”‚    â”‚      async def extend(user_id, days)                                  â”‚  â”‚
â”‚    â”‚      async def cancel(user_id)                                        â”‚  â”‚
â”‚    â”‚      async def get_expiring_soon(days_before=7) -> List[Subscription] â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  2. é€šçŸ¥æœåŠ¡ç»Ÿä¸€                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                                 â”‚
â”‚    ç°çŠ¶: æ— ç»Ÿä¸€é€šçŸ¥å‡ºå£                                                          â”‚
â”‚    å»ºè®®: æ–°å»º services/notification/notification_service.py                      â”‚
â”‚                                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚  class NotificationService:                                            â”‚  â”‚
â”‚    â”‚      async def send_email(to, template, data)                         â”‚  â”‚
â”‚    â”‚      async def send_sms(phone, template, data)                        â”‚  â”‚
â”‚    â”‚      async def send_push(user_id, title, body)                        â”‚  â”‚
â”‚    â”‚      async def send_wechat(openid, template_id, data)  # æœªæ¥         â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  3. æƒé™æ£€æŸ¥ç»Ÿä¸€                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                                 â”‚
â”‚    ç°çŠ¶: get_current_user() åªè¿”å›èº«ä»½ï¼Œä¸å«æƒé™                                 â”‚
â”‚    å»ºè®®: æ‰©å±• CurrentUser æˆ–æ–°å¢ä¾èµ–                                             â”‚
â”‚                                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚  class CurrentUser:                                                    â”‚  â”‚
â”‚    â”‚      user_id: UUID                                                    â”‚  â”‚
â”‚    â”‚      vibe_id: str                                                     â”‚  â”‚
â”‚    â”‚      tier: Literal["guest", "free", "premium"]  # æ–°å¢                â”‚  â”‚
â”‚    â”‚      subscription: Optional[Subscription]       # æ–°å¢                â”‚  â”‚
â”‚    â”‚                                                                        â”‚  â”‚
â”‚    â”‚      def can(self, feature: str) -> bool:                             â”‚  â”‚
â”‚    â”‚          if self.tier == "premium": return True                       â”‚  â”‚
â”‚    â”‚          return feature in FREE_FEATURES                              â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å…³é”®æŒ‡æ ‡å»ºè®®

| æŒ‡æ ‡ | å½“å‰çŠ¶æ€ | ç›®æ ‡å€¼ | å…³é”®æ”¹è¿›ç‚¹ |
|------|---------|--------|-----------|
| **ä»˜è´¹é—­ç¯** | ğŸ”´ æ–­é“¾ | âœ… 100%æ‰“é€š | Phase 1 å®Œæˆ |
| **å…è´¹â†’ä»˜è´¹è½¬åŒ–** | æœªçŸ¥ | > 5% | ç»­è´¹æé†’ + ä½“éªŒä¼˜åŒ– |
| **æ¬¡æ—¥ç•™å­˜** | æœªçŸ¥ | > 40% | æ¨é€ç³»ç»Ÿ + ä¸ªæ€§åŒ– |
| **é¢„ä»˜ç»­è´¹ç‡** | 0% (æ— æé†’) | > 30% | Phase 2.1 |

---

## å››ã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®

1. **ç«‹å³è¡ŒåŠ¨**: å®Œæˆ Phase 1ï¼ˆæ‰“é€šæ”¶è´¹é—­ç¯ï¼‰ï¼Œè¿™æ˜¯æ”¶å…¥çš„å‰æ
2. **çŸ­æœŸä¼˜å…ˆ**: é›†æˆé‚®ä»¶æœåŠ¡ï¼Œè®©å¯†ç é‡ç½®å¯ç”¨
3. **ä¸­æœŸè§„åˆ’**: å®ç°é¢„ä»˜ç»­è´¹æé†’ç³»ç»Ÿ
4. **é•¿æœŸå‚¨å¤‡**: è¯„ä¼°å¾®ä¿¡ç™»å½•/çŸ­ä¿¡éªŒè¯çš„ ROI

---

## é™„å½•: ç›¸å…³æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `apps/api/routes/auth.py` | è®¤è¯è·¯ç”± (æ³¨å†Œ/ç™»å½•/OAuth/å¯†ç é‡ç½®) |
| `apps/api/routes/payment.py` | æ”¯ä»˜è·¯ç”± (Checkout/Webhook/éªŒè¯) |
| `apps/api/routes/guest.py` | æ¸¸å®¢ä¼šè¯è·¯ç”± |
| `apps/api/services/identity/auth.py` | è®¤è¯æœåŠ¡ |
| `apps/api/services/identity/oauth.py` | OAuth æœåŠ¡ |
| `apps/api/services/identity/guest_session.py` | æ¸¸å®¢ä¼šè¯æœåŠ¡ |
| `apps/api/services/identity/usage_limits.py` | ä½¿ç”¨é™åˆ¶å®šä¹‰ |
| `apps/api/services/billing/stripe_service.py` | Stripe æœåŠ¡å°è£… |
| `apps/api/services/billing/subscription.py` | è®¢é˜…æœåŠ¡ (å¾…å®Œå–„) |
| `docs/auth-system-design.md` | ç™»å½•ä½“ç³»è®¾è®¡æ–‡æ¡£ |
| `docs/archive/v5/payment-design.md` | æ”¯ä»˜ä½“ç³»è®¾è®¡æ–‡æ¡£ |
| `docs/archive/v4/user-flow-design-v2.1.md` | ç”¨æˆ·æµç¨‹è®¾è®¡æ–‡æ¡£ |
