/**
 * show-vibe-id å·¥å…·å¡ç‰‡
 *
 * åŸºäºè®¾è®¡æ–‡æ¡£ v5.0 å’Œå‰ç«¯è§„èŒƒ v7.1
 * åœ¨èŠå¤©ä¸­å±•ç¤º VibeID ç»“æœ
 */

'use client'

import { memo } from 'react'
import { cn } from '@/lib/utils'
import type { VibeIDDisplay, ArchetypeScores } from '@/types/vibe-id'
import { VibeIDCard, VibeIDCardSkeleton } from '../components/VibeIDCard'
import { ArchetypeRadar } from '../components/ArchetypeRadar'

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Types
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export interface ShowVibeIDProps {
  /** VibeID å±•ç¤ºæ•°æ® */
  data?: VibeIDDisplay
  /** åŸå‹å¾—åˆ†ï¼ˆç”¨äºé›·è¾¾å›¾ï¼‰ */
  scores?: ArchetypeScores
  /** å±•ç¤ºå˜ä½“ */
  variant?: 'full' | 'compact' | 'mini' | 'radar'
  /** æ˜¯å¦åŠ è½½ä¸­ */
  isLoading?: boolean
  /** é”™è¯¯ä¿¡æ¯ */
  error?: string
  /** è‡ªå®šä¹‰ç±»å */
  className?: string
  /** æ¢ç´¢æŒ‰é’®å›è°ƒ */
  onExplore?: () => void
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Tool Card Component
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export const ShowVibeID = memo(function ShowVibeID({
  data,
  scores,
  variant = 'compact',
  isLoading = false,
  error,
  className,
  onExplore,
}: ShowVibeIDProps) {
  // Loading state
  if (isLoading) {
    return (
      <div className={cn('w-full md:max-w-md', className)}>
        <VibeIDCardSkeleton variant={variant === 'radar' ? 'full' : variant} />
      </div>
    )
  }

  // Error state
  if (error) {
    return (
      <div className={cn('w-full md:max-w-md p-4 rounded-xl bg-red-50 border border-red-200', className)}>
        <div className="flex items-center gap-2 text-red-700">
          <span>âš ï¸</span>
          <span className="text-sm">{error}</span>
        </div>
      </div>
    )
  }

  // No data state
  if (!data) {
    return (
      <div className={cn('w-full md:max-w-md p-6 rounded-xl bg-vellum-50 border border-vellum-200/50 text-center', className)}>
        <div className="text-4xl mb-3">ğŸ”®</div>
        <h3 className="font-medium text-ink-800 mb-2">å°šæœªç”Ÿæˆ VibeID</h3>
        <p className="text-sm text-ink-500 mb-4">
          å®Œå–„ä½ çš„å‡ºç”Ÿä¿¡æ¯ï¼Œè§£é”ä¸“å±çš„äººæ ¼åŸå‹åˆ†æ
        </p>
        {onExplore && (
          <button
            onClick={onExplore}
            className="px-4 py-2 bg-accent text-white rounded-lg text-sm font-medium hover:bg-accent-hover transition-colors"
          >
            å¼€å§‹æ¢ç´¢
          </button>
        )}
      </div>
    )
  }

  // Radar variant
  if (variant === 'radar' && scores) {
    return (
      <div className={cn('w-full md:max-w-md', className)}>
        <div className="p-6 rounded-2xl bg-white shadow-card border border-vellum-200/30">
          <h3 className="font-serif text-lg text-ink-800 text-center mb-4">åŸå‹åˆ†å¸ƒ</h3>
          <div className="flex justify-center">
            <ArchetypeRadar
              scores={scores}
              highlightArchetype={data.primaryArchetype}
              size={280}
              showLabels
              showScores
            />
          </div>
          <div className="mt-4 pt-4 border-t border-vellum-200/50 text-center">
            <p className="text-sm text-ink-500">
              ä¸»åŸå‹: <span className="text-ink-800 font-medium">{data.primaryName}</span>
            </p>
          </div>
        </div>
      </div>
    )
  }

  // Standard card variants
  return (
    <div className={cn('w-full md:max-w-md', className)}>
      <VibeIDCard
        data={data}
        variant={variant === 'radar' ? 'full' : variant}
        showExplanation={variant === 'full'}
        onExplore={onExplore}
      />
    </div>
  )
})

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Tool Registration
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * å·¥å…·å…ƒæ•°æ®
 * ç”¨äº CardRegistry æ³¨å†Œ
 */
export const showVibeIDMeta = {
  name: 'show_vibe_id',
  displayName: 'VibeID å±•ç¤º',
  description: 'å±•ç¤ºç”¨æˆ·çš„ VibeID äººæ ¼åŸå‹åˆ†æç»“æœ',
  skill: 'vibe_id',
  component: ShowVibeID,
}

export default ShowVibeID
