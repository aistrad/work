apiVersion: batch/v1
kind: CronJob
metadata:
  name: vibelife-reminder-scheduler
  labels:
    app: vibelife
    component: scheduler
spec:
  # Run every day at 8:00 AM Beijing Time (UTC+8 = 00:00 UTC)
  schedule: "0 0 * * *"
  concurrencyPolicy: Forbid
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 3
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          containers:
            - name: scheduler
              image: curlimages/curl:latest
              command:
                - /bin/sh
                - -c
                - |
                  curl -X POST http://vibelife-api:8000/api/v1/reminders/scheduler/run \
                    -H "Content-Type: application/json" \
                    -H "X-Internal-Key: ${INTERNAL_API_KEY}"
              env:
                - name: INTERNAL_API_KEY
                  valueFrom:
                    secretKeyRef:
                      name: vibelife-secrets
                      key: INTERNAL_API_KEY
---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: vibelife-weekly-review
  labels:
    app: vibelife
    component: scheduler
spec:
  # Run every Sunday at 9:00 PM Beijing Time (13:00 UTC)
  schedule: "0 13 * * 0"
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          containers:
            - name: weekly-review
              image: curlimages/curl:latest
              command:
                - /bin/sh
                - -c
                - |
                  curl -X POST http://vibelife-api:8000/api/v1/mirror/weekly/generate-all \
                    -H "Content-Type: application/json" \
                    -H "X-Internal-Key: ${INTERNAL_API_KEY}"
              env:
                - name: INTERNAL_API_KEY
                  valueFrom:
                    secretKeyRef:
                      name: vibelife-secrets
                      key: INTERNAL_API_KEY
