# VibeLife 前端部署 - 阿里云

## 部署方案对比

| 方案 | 成本 | 复杂度 | 适用场景 |
|------|------|--------|----------|
| **Vercel** | 免费/低 | 最简单 | 推荐首选 |
| 阿里云 OSS + CDN | 低 | 中等 | 纯静态站点 |
| 阿里云 ECS | 中等 | 较复杂 | 需要 SSR |
| 阿里云 Serverless | 按量 | 中等 | 弹性伸缩 |

---

## 方案 A: Vercel 部署 (推荐)

### 优势
- 自动 CI/CD
- 全球 CDN
- 自动 HTTPS
- 免费额度充足
- Next.js 官方支持

### 步骤

1. **连接 GitHub 仓库**
   ```
   https://vercel.com/new
   选择 vibelife 仓库
   ```

2. **配置项目**
   - Root Directory: `apps/web`
   - Framework Preset: Next.js
   - Build Command: `pnpm build`
   - Output Directory: `.next`

3. **环境变量**
   ```
   NEXT_PUBLIC_API_URL=https://api.vibelife.app
   ```

4. **域名配置**
   - 添加自定义域名: `vibelife.app`
   - 添加子域名: `bazi.vibelife.app`, `zodiac.vibelife.app`

5. **DNS 配置 (阿里云)**
   ```
   vibelife.app        CNAME    cname.vercel-dns.com
   bazi.vibelife.app   CNAME    cname.vercel-dns.com
   zodiac.vibelife.app CNAME    cname.vercel-dns.com
   ```

---

## 方案 B: 阿里云 OSS + CDN

### 适用场景
- 纯静态导出 (`next export`)
- 不需要 SSR/ISR

### 步骤

1. **创建 OSS Bucket**
   ```
   Bucket 名称: vibelife-web
   地域: 华东1 (杭州)
   存储类型: 标准存储
   读写权限: 公共读
   ```

2. **开启静态网站托管**
   - 默认首页: index.html
   - 默认 404 页: 404.html

3. **配置 CDN**
   ```
   域名: vibelife.app
   源站: vibelife-web.oss-cn-hangzhou.aliyuncs.com
   ```

4. **CI/CD 脚本**
   ```bash
   # 构建
   cd apps/web
   pnpm build
   pnpm export

   # 上传到 OSS
   ossutil cp -r out/ oss://vibelife-web/ --update

   # 刷新 CDN
   aliyun cdn RefreshObjectCaches --ObjectPath "vibelife.app/"
   ```

---

## 方案 C: 阿里云 ECS

### 适用场景
- 需要 SSR
- 需要更多控制

### 配置建议
```
实例规格: ecs.t6-c1m1.large (1核2G)
系统: Ubuntu 22.04
带宽: 按量付费 或 5Mbps
```

### 部署脚本
```bash
# 安装依赖
curl -fsSL https://get.docker.com | sh
apt install -y nginx certbot

# 启动前端
docker run -d \
  --name vibelife-web \
  -p 3000:3000 \
  -e NEXT_PUBLIC_API_URL=https://api.vibelife.app \
  your-registry/vibelife-web:latest

# Nginx 反向代理
# /etc/nginx/sites-available/vibelife
server {
    listen 443 ssl;
    server_name vibelife.app;

    ssl_certificate /etc/letsencrypt/live/vibelife.app/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/vibelife.app/privkey.pem;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
    }
}
```

---

## 域名配置

### DNS 记录 (阿里云云解析)

| 记录类型 | 主机记录 | 记录值 | 说明 |
|----------|----------|--------|------|
| A | @ | [阿里云 ECS IP] | 主站 (ECS 方案) |
| CNAME | @ | cname.vercel-dns.com | 主站 (Vercel 方案) |
| A | api | 106.37.170.238 | API 服务 (aiscend) |
| CNAME | bazi | cname.vercel-dns.com | 八字站 |
| CNAME | zodiac | cname.vercel-dns.com | 星座站 |

---

## 环境变量

前端需要配置的环境变量：

```env
# API 地址 (指向 aiscend 服务器)
NEXT_PUBLIC_API_URL=https://api.vibelife.app

# 站点配置
NEXT_PUBLIC_SITE_URL=https://vibelife.app

# Stripe 公钥
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_live_xxx
```

---

## 推荐方案

**初期推荐: Vercel**
- 零运维成本
- 自动 CI/CD
- 免费 HTTPS
- 全球 CDN

**流量增长后: 阿里云 CDN**
- 国内访问更快
- 成本可控
- 可与 Vercel 并行
