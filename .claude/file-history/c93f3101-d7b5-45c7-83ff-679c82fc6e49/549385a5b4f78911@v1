"use client";

/**
 * useDashboardWelcomeData - å°† Dashboard æ•°æ®è½¬æ¢ä¸ºæ¬¢è¿æ¶ˆæ¯æ ¼å¼
 *
 * ä»åŸå§‹ DashboardDTO æå–å¹¶è½¬æ¢æ•°æ®ä¸º ChatWelcomeMessage æ‰€éœ€æ ¼å¼
 */

import { useMemo } from "react";
import type { DashboardDTO } from "@/types/dashboard";

export function useDashboardWelcomeData(dashboard: DashboardDTO | null | undefined) {
  return useMemo(() => {
    if (!dashboard) return null;

    // æå– bazi skill æ•°æ®ï¼ˆå‡è®¾æ˜¯ mySkills çš„ç¬¬ä¸€ä¸ªï¼‰
    const baziCard = dashboard.mySkills.find(s => s.skillId === "bazi");

    // æ„å»º fortuneData
    const fortuneData = baziCard ? {
      headline: baziCard.content.headline || "ä»Šæ—¥è¿åŠ¿è‰¯å¥½",
      insights: Array.isArray(baziCard.content.insights)
        ? baziCard.content.insights.slice(0, 3)  // æœ€å¤š 3 æ¡
        : [],
      rating: {
        overall: baziCard.content.rating?.overall || 4,
        focused_area: baziCard.content.rating?.details ? {
          name: "ç»¼åˆèƒ½é‡",
          score: baziCard.content.rating.overall || 4,
          emoji: "ğŸŒŸ",
          tip: baziCard.content.headline || "ä»Šæ—¥è¿åŠ¿è‰¯å¥½"
        } : undefined
      }
    } : {
      headline: "å¼€å¯ç¾å¥½çš„ä¸€å¤©",
      insights: ["ä¿æŒä¸“æ³¨ï¼Œä¸€æ­¥ä¸€æ­¥æ¥"],
      rating: {
        overall: 4,
        focused_area: {
          name: "ç»¼åˆèƒ½é‡",
          score: 4,
          emoji: "ğŸŒŸ",
          tip: "å¼€å¯ç¾å¥½çš„ä¸€å¤©"
        }
      }
    };

    return {
      greeting: dashboard.ambient.greeting || "æ—©ä¸Šå¥½",
      solarTerm: dashboard.ambient.solarTerm,
      streak: dashboard.status.streak || 0,
      fortuneData,
      lifecoachData: dashboard.lifecoach,
      status: dashboard.status
    };
  }, [dashboard]);
}
