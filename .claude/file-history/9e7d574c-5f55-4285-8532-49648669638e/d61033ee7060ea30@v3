# VibeLife Frontend v7.0 Specification

> **Version**: 7.0 | 2026-01-16
> **Target**: AI Agent Optimized
> **Backend**: V7 API Architecture
> **Design System**: ã€Œæš–é˜³ç¥ç§˜ã€+ åŸå‹è§†è§‰ç³»ç»Ÿ
> **Priority Source**: VibeIDè®¾è®¡-v5.md > SPEC-v7.md > Frontend-v6.md

---

## Table of Contents

1. [System Architecture](#1-system-architecture)
2. [VibeID Core Module](#2-vibeid-core-module)
3. [Design System](#3-design-system)
4. [Performance Optimization](#4-performance-optimization)
5. [Component Library & Card System](#5-component-library--card-system)
6. [API Integration & Data Flow](#6-api-integration--data-flow)
7. [Implementation Plan & Verification](#7-implementation-plan--verification)

---

## 1. System Architecture

### 1.1 Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           VibeLife Frontend v7.0                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         App Shell (Next.js 14)                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚   Layout    â”‚  â”‚   Router    â”‚  â”‚   Auth      â”‚  â”‚   Theme    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  Provider   â”‚  â”‚  (App Dir)  â”‚  â”‚  Provider   â”‚  â”‚  Provider  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        Feature Modules                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚   VibeID    â”‚  â”‚    Chat     â”‚  â”‚   Skills    â”‚  â”‚  Commerce  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   Module    â”‚  â”‚   Module    â”‚  â”‚   Module    â”‚  â”‚   Module   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ (Archetype) â”‚  â”‚ (Agentic)   â”‚  â”‚ (Bazi/Zodiacâ”‚  â”‚ (Payment)  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        Core Services Layer                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚    API      â”‚  â”‚   State     â”‚  â”‚   Stream    â”‚  â”‚   Card     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   Client    â”‚  â”‚   Store     â”‚  â”‚   Handler   â”‚  â”‚  Registry  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  (SWR 2.x)  â”‚  â”‚(Zustand 4.x)â”‚  â”‚ (AI SDK 6)  â”‚  â”‚ (Dynamic)  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        Design System Layer                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  UI Core    â”‚  â”‚  Archetype  â”‚  â”‚  Animation  â”‚  â”‚   Theme    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Components  â”‚  â”‚   Visuals   â”‚  â”‚   System    â”‚  â”‚   Tokens   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Backend API (V7)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  CoreAgent  â”‚  â”‚   Skill     â”‚  â”‚    Tool     â”‚  â”‚      Knowledge      â”‚â”‚
â”‚  â”‚  (Agentic   â”‚  â”‚  Service    â”‚  â”‚  Registry   â”‚  â”‚       Store         â”‚â”‚
â”‚  â”‚   Loop)     â”‚  â”‚  Registry   â”‚  â”‚  (Schema)   â”‚  â”‚     (Qdrant)        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Technology Stack

| Category | Technology | Version | Purpose |
|----------|------------|---------|---------|
| Framework | Next.js | 14.x | App Router, RSC, Streaming |
| Language | TypeScript | 5.3+ | Type Safety |
| Styling | Tailwind CSS | 3.4 | Utility-first CSS |
| State | Zustand | 4.x | Client State Management |
| Data Fetching | SWR | 2.x | Server State + Caching |
| AI | AI SDK | 6.x | Streaming + Tool Calls |
| Charts | ECharts | 5.x | Data Visualization |
| Animation | Framer Motion | 10.x | UI Animations |
| Form | React Hook Form | 7.x | Form Handling |
| Validation | Zod | 3.x | Schema Validation |

### 1.3 Directory Structure

```
apps/web/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (auth)/                   # Auth routes group
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ register/
â”‚   â”‚   â”œâ”€â”€ (main)/                   # Main app routes
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”‚   â”œâ”€â”€ vibe-id/              # VibeID feature
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ archetype/[id]/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ journey/
â”‚   â”‚   â”‚   â””â”€â”€ skills/
â”‚   â”‚   â”‚       â”œâ”€â”€ bazi/
â”‚   â”‚   â”‚       â”œâ”€â”€ zodiac/
â”‚   â”‚   â”‚       â”œâ”€â”€ tarot/
â”‚   â”‚   â”‚       â””â”€â”€ career/
â”‚   â”‚   â”œâ”€â”€ api/                      # API routes (if needed)
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                   # Shared components
â”‚   â”‚   â”œâ”€â”€ ui/                       # Design system primitives
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ layout/                   # Layout components
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â””â”€â”€ BottomNav.tsx
â”‚   â”‚   â”œâ”€â”€ chat/                     # Chat components
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatContainer.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatMessage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ MessageInput.tsx
â”‚   â”‚   â””â”€â”€ shared/                   # Cross-feature components
â”‚   â”‚       â”œâ”€â”€ BreathAura.tsx
â”‚   â”‚       â”œâ”€â”€ VibeGlyph.tsx
â”‚   â”‚       â””â”€â”€ InsightSeal.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ skills/                       # Skill-specific modules
â”‚   â”‚   â”œâ”€â”€ bazi/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ tools/                # Tool result cards
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts          # Card exports
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ show-bazi-chart.tsx
â”‚   â”‚   â”‚   â””â”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ zodiac/
â”‚   â”‚   â”œâ”€â”€ tarot/
â”‚   â”‚   â”œâ”€â”€ career/
â”‚   â”‚   â”œâ”€â”€ vibe-id/                  # VibeID skill components
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ VibeIDCard.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ArchetypeWheel.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ArchetypeBadge.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ DimensionRow.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ show-vibe-id.tsx
â”‚   â”‚   â”‚   â””â”€â”€ hooks/
â”‚   â”‚   â”‚       â””â”€â”€ useVibeID.ts
â”‚   â”‚   â”œâ”€â”€ CardRegistry.ts           # Dynamic card registry
â”‚   â”‚   â””â”€â”€ initCards.ts              # Card initialization
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                        # Shared hooks
â”‚   â”‚   â”œâ”€â”€ useVibeChat.ts            # Chat hook with streaming
â”‚   â”‚   â”œâ”€â”€ useToolSchema.ts          # Tool schema fetching
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â””â”€â”€ useTheme.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/                       # Zustand stores
â”‚   â”‚   â”œâ”€â”€ chatStore.ts
â”‚   â”‚   â”œâ”€â”€ userStore.ts
â”‚   â”‚   â””â”€â”€ vibeIdStore.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                     # API services
â”‚   â”‚   â”œâ”€â”€ api.ts                    # Base API client
â”‚   â”‚   â”œâ”€â”€ chat.ts                   # Chat API
â”‚   â”‚   â””â”€â”€ skills.ts                 # Skills API
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                        # TypeScript types
â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ chat.ts
â”‚   â”‚   â”œâ”€â”€ vibe-id.ts
â”‚   â”‚   â””â”€â”€ skills.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                        # Utility functions
â”‚   â”‚   â”œâ”€â”€ cn.ts                     # Class name merger
â”‚   â”‚   â”œâ”€â”€ format.ts
â”‚   â”‚   â””â”€â”€ validation.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ providers/                    # React providers
â”‚   â”‚   â”œâ”€â”€ AuthProvider.tsx
â”‚   â”‚   â”œâ”€â”€ ThemeProvider.tsx
â”‚   â”‚   â””â”€â”€ Providers.tsx             # Combined provider
â”‚   â”‚
â”‚   â””â”€â”€ styles/                       # Global styles
â”‚       â”œâ”€â”€ globals.css
â”‚       â””â”€â”€ variables.css
â”‚
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ fonts/
â”‚   â”œâ”€â”€ icons/
â”‚   â””â”€â”€ images/
â”‚
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ next.config.js
â””â”€â”€ tsconfig.json
```

### 1.4 Data Flow Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           User Interaction                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Chat Component Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ChatContainer.tsx                                               â”‚   â”‚
â”‚  â”‚  - User input handling                                           â”‚   â”‚
â”‚  â”‚  - Message rendering                                             â”‚   â”‚
â”‚  â”‚  - Tool result display via CardRegistry                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      useVibeChat Hook       â”‚   â”‚           CardRegistry               â”‚
â”‚  - Stream handling          â”‚   â”‚  - Dynamic component loading         â”‚
â”‚  - Tool call processing     â”‚   â”‚  - Tool name â†’ Component mapping     â”‚
â”‚  - Message state            â”‚   â”‚  - Lazy loading for performance      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Backend API (V7)                                 â”‚
â”‚  POST /chat/v5/stream                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Request: { user_id, messages, skill_id?, context? }            â”‚   â”‚
â”‚  â”‚  Response: SSE Stream                                            â”‚   â”‚
â”‚  â”‚    - type: "text" | "tool_call" | "tool_result" | "done"        â”‚   â”‚
â”‚  â”‚    - Tool results contain structured data for card rendering     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.5 Stream Event Types

```typescript
// SSE Event Types from Backend
type StreamEventType =
  | 'text'           // Text content chunk
  | 'tool_call'      // Tool being called
  | 'tool_result'    // Tool execution result
  | 'thinking'       // Agent thinking process
  | 'error'          // Error occurred
  | 'done';          // Stream completed

interface StreamEvent {
  type: StreamEventType;
  data: unknown;
  timestamp: number;
}

interface ToolCallEvent {
  type: 'tool_call';
  data: {
    tool_name: string;      // e.g., "show_bazi_chart"
    tool_id: string;        // Unique call ID
    arguments: Record<string, unknown>;
  };
}

interface ToolResultEvent {
  type: 'tool_result';
  data: {
    tool_name: string;
    tool_id: string;
    result: Record<string, unknown>;  // Structured data for card
    skill_id?: string;                // Which skill this belongs to
  };
}
```

---

## 2. VibeID Core Module

> **Source**: VibeIDè®¾è®¡-v5.md (Primary), SPEC-v7.md
> **Priority**: Core Feature - All implementations must align with VibeID-v5.md specifications

### 2.1 Four-Dimensional Archetype System

VibeID uses Carl Jung's 12 archetypes organized across 4 dimensions to create a comprehensive personality profile.

#### 2.1.1 Dimension Definitions

| Dimension | Chinese | Description | Visibility |
|-----------|---------|-------------|------------|
| **Core** | æ ¸å¿ƒåŸå‹ | True self, fundamental nature | Private |
| **Inner** | å†…åœ¨åŸå‹ | Inner world, emotional patterns | Semi-private |
| **Outer** | å¤–åœ¨åŸå‹ | Social presentation, public persona | Public |
| **Shadow** | é˜´å½±åŸå‹ | Hidden aspects, growth areas | Private |

#### 2.1.2 The 12 Archetypes

```typescript
// src/types/vibe-id.ts

/**
 * The 12 Jungian Archetypes
 * Each archetype has associated metadata for visual presentation
 */
export type ArchetypeId =
  | 'innocent'    // å¤©çœŸè€…
  | 'explorer'    // æ¢ç´¢è€…
  | 'sage'        // æ™ºè€…
  | 'hero'        // è‹±é›„
  | 'outlaw'      // å›é€†è€…
  | 'magician'    // é­”æœ¯å¸ˆ
  | 'regular'     // å‡¡äºº
  | 'lover'       // æƒ…äºº
  | 'jester'      // æ„šè€…
  | 'caregiver'   // ç…§é¡¾è€…
  | 'creator'     // åˆ›é€ è€…
  | 'ruler';      // ç»Ÿæ²»è€…

export type DimensionId = 'core' | 'inner' | 'outer' | 'shadow';

/**
 * Archetype metadata for UI rendering
 */
export interface ArchetypeMeta {
  id: ArchetypeId;
  name: string;           // English name
  nameCn: string;         // Chinese name
  emoji: string;          // Visual identifier
  color: string;          // Hex color
  gradient: string;       // CSS gradient
  slogan: string;         // One-line description
  superpower: string;     // Key strength
  growthPoints: string[]; // Areas for development
  element: 'fire' | 'earth' | 'air' | 'water';  // Associated element
}

/**
 * Four-dimensional archetype profile
 */
export interface FourDimensionArchetypes {
  core: ArchetypeId;
  inner: ArchetypeId;
  outer: ArchetypeId;
  shadow: ArchetypeId;
}

/**
 * Complete VibeID profile
 */
export interface VibeIDProfile {
  userId: string;
  archetypes: FourDimensionArchetypes;
  scores: Record<ArchetypeId, number>;  // 0-100 score per archetype
  confidence: number;                    // 0-1 calculation confidence
  calculatedAt: string;                  // ISO timestamp
  source: 'bazi' | 'zodiac' | 'interview' | 'combined';

  // Optional extended data
  dimensionScores?: {
    core: Record<ArchetypeId, number>;
    inner: Record<ArchetypeId, number>;
    outer: Record<ArchetypeId, number>;
    shadow: Record<ArchetypeId, number>;
  };
}
```

### 2.2 Archetype Metadata Constant

```typescript
// src/skills/vibe-id/constants/archetypes.ts

import type { ArchetypeMeta, ArchetypeId } from '@/types/vibe-id';

/**
 * Complete archetype metadata registry
 * Source: VibeIDè®¾è®¡-v5.md Section 3.2
 */
export const ARCHETYPE_META: Record<ArchetypeId, ArchetypeMeta> = {
  innocent: {
    id: 'innocent',
    name: 'Innocent',
    nameCn: 'å¤©çœŸè€…',
    emoji: 'ğŸŒ¸',
    color: '#FFB7C5',
    gradient: 'linear-gradient(135deg, #FFB7C5 0%, #FFF0F3 100%)',
    slogan: 'è¿½æ±‚çº¯ç²¹ä¸ç¾å¥½',
    superpower: 'ä¿æŒä¹è§‚ä¸ä¿¡ä»»çš„èƒ½åŠ›',
    growthPoints: ['é¢å¯¹ç°å®çš„å¤æ‚æ€§', 'å»ºç«‹å¥åº·çš„è¾¹ç•Œ'],
    element: 'air'
  },
  explorer: {
    id: 'explorer',
    name: 'Explorer',
    nameCn: 'æ¢ç´¢è€…',
    emoji: 'ğŸ§­',
    color: '#87CEEB',
    gradient: 'linear-gradient(135deg, #87CEEB 0%, #E0F4FF 100%)',
    slogan: 'è¿½å¯»è‡ªç”±ä¸å‘ç°',
    superpower: 'å‹‡äºæ¢ç´¢æœªçŸ¥çš„å‹‡æ°”',
    growthPoints: ['å­¦ä¼šæ‰¿è¯ºä¸æ‰æ ¹', 'å¹³è¡¡å†’é™©ä¸è´£ä»»'],
    element: 'air'
  },
  sage: {
    id: 'sage',
    name: 'Sage',
    nameCn: 'æ™ºè€…',
    emoji: 'ğŸ“š',
    color: '#9B59B6',
    gradient: 'linear-gradient(135deg, #9B59B6 0%, #E8D5F2 100%)',
    slogan: 'è¿½æ±‚çœŸç†ä¸æ™ºæ…§',
    superpower: 'æ´å¯Ÿæœ¬è´¨çš„åˆ†æèƒ½åŠ›',
    growthPoints: ['å°†çŸ¥è¯†è½¬åŒ–ä¸ºè¡ŒåŠ¨', 'æ¥çº³éç†æ€§çš„æƒ…æ„Ÿ'],
    element: 'air'
  },
  hero: {
    id: 'hero',
    name: 'Hero',
    nameCn: 'è‹±é›„',
    emoji: 'âš”ï¸',
    color: '#E74C3C',
    gradient: 'linear-gradient(135deg, #E74C3C 0%, #FADBD8 100%)',
    slogan: 'å‹‡æ•¢é¢å¯¹æŒ‘æˆ˜',
    superpower: 'å…‹æœå›°éš¾çš„å‹‡æ°”ä¸æ¯…åŠ›',
    growthPoints: ['å­¦ä¼šæ¥å—å¸®åŠ©', 'å¹³è¡¡åˆšå¼ºä¸æŸ”è½¯'],
    element: 'fire'
  },
  outlaw: {
    id: 'outlaw',
    name: 'Outlaw',
    nameCn: 'å›é€†è€…',
    emoji: 'ğŸ”¥',
    color: '#8B0000',
    gradient: 'linear-gradient(135deg, #8B0000 0%, #E6B8AF 100%)',
    slogan: 'æ‰“ç ´å¸¸è§„åˆ›é€ å˜é©',
    superpower: 'æŒ‘æˆ˜æƒå¨çš„å‹‡æ°”',
    growthPoints: ['å»ºè®¾æ€§åœ°ä½¿ç”¨ç ´ååŠ›', 'æ‰¾åˆ°å½’å±æ„Ÿ'],
    element: 'fire'
  },
  magician: {
    id: 'magician',
    name: 'Magician',
    nameCn: 'é­”æœ¯å¸ˆ',
    emoji: 'âœ¨',
    color: '#8E44AD',
    gradient: 'linear-gradient(135deg, #8E44AD 0%, #D7BDE2 100%)',
    slogan: 'åŒ–ä¸å¯èƒ½ä¸ºå¯èƒ½',
    superpower: 'è½¬åŒ–ä¸åˆ›é€ å¥‡è¿¹çš„èƒ½åŠ›',
    growthPoints: ['è„šè¸å®åœ°è½åœ°', 'é¿å…æ“æ§ä»–äºº'],
    element: 'fire'
  },
  regular: {
    id: 'regular',
    name: 'Regular',
    nameCn: 'å‡¡äºº',
    emoji: 'ğŸ¤',
    color: '#27AE60',
    gradient: 'linear-gradient(135deg, #27AE60 0%, #D5F5E3 100%)',
    slogan: 'è„šè¸å®åœ°èå…¥ç¾¤ä½“',
    superpower: 'å»ºç«‹çœŸè¯šè¿æ¥çš„èƒ½åŠ›',
    growthPoints: ['å‘å±•ç‹¬ç‰¹ä¸ªæ€§', 'ä¸æƒ§ä¸ä¼—ä¸åŒ'],
    element: 'earth'
  },
  lover: {
    id: 'lover',
    name: 'Lover',
    nameCn: 'æƒ…äºº',
    emoji: 'ğŸ’•',
    color: '#E91E63',
    gradient: 'linear-gradient(135deg, #E91E63 0%, #F8BBD9 100%)',
    slogan: 'è¿½æ±‚äº²å¯†ä¸çƒ­æƒ…',
    superpower: 'æ·±åº¦è¿æ¥ä¸æ„Ÿå—ç¾çš„èƒ½åŠ›',
    growthPoints: ['ä¿æŒç‹¬ç«‹è‡ªæˆ‘', 'å¹³è¡¡ä»˜å‡ºä¸æ¥å—'],
    element: 'water'
  },
  jester: {
    id: 'jester',
    name: 'Jester',
    nameCn: 'æ„šè€…',
    emoji: 'ğŸ­',
    color: '#F39C12',
    gradient: 'linear-gradient(135deg, #F39C12 0%, #FDEBD0 100%)',
    slogan: 'æ´»åœ¨å½“ä¸‹äº«å—äººç”Ÿ',
    superpower: 'å¸¦æ¥æ¬¢ä¹ä¸è½»æ¾çš„èƒ½åŠ›',
    growthPoints: ['é¢å¯¹ä¸¥è‚ƒè®®é¢˜', 'å‘å±•æ·±åº¦å…³ç³»'],
    element: 'fire'
  },
  caregiver: {
    id: 'caregiver',
    name: 'Caregiver',
    nameCn: 'ç…§é¡¾è€…',
    emoji: 'ğŸŒ¿',
    color: '#2ECC71',
    gradient: 'linear-gradient(135deg, #2ECC71 0%, #E8F8F5 100%)',
    slogan: 'å…³çˆ±ä»–äººæ— ç§å¥‰çŒ®',
    superpower: 'æ»‹å…»ä¸æ”¯æŒä»–äººçš„èƒ½åŠ›',
    growthPoints: ['å­¦ä¼šè‡ªæˆ‘å…³æ€€', 'è®¾ç«‹å¥åº·è¾¹ç•Œ'],
    element: 'earth'
  },
  creator: {
    id: 'creator',
    name: 'Creator',
    nameCn: 'åˆ›é€ è€…',
    emoji: 'ğŸ¨',
    color: '#3498DB',
    gradient: 'linear-gradient(135deg, #3498DB 0%, #D6EAF8 100%)',
    slogan: 'åˆ›é€ ç‹¬ç‰¹ä»·å€¼',
    superpower: 'å°†æƒ³è±¡å˜ä¸ºç°å®çš„èƒ½åŠ›',
    growthPoints: ['å®Œæˆè€Œéåªæ˜¯å¼€å§‹', 'æ¥å—ä¸å®Œç¾'],
    element: 'water'
  },
  ruler: {
    id: 'ruler',
    name: 'Ruler',
    nameCn: 'ç»Ÿæ²»è€…',
    emoji: 'ğŸ‘‘',
    color: '#D4AF37',
    gradient: 'linear-gradient(135deg, #D4AF37 0%, #FEF9E7 100%)',
    slogan: 'æŒæ§å…¨å±€å¼•é¢†æ–¹å‘',
    superpower: 'ç»„ç»‡ä¸é¢†å¯¼çš„èƒ½åŠ›',
    growthPoints: ['å€¾å¬ä»–äººå£°éŸ³', 'æ”¾ä¸‹æ§åˆ¶æ¬²'],
    element: 'earth'
  }
};

/**
 * Get archetype metadata by ID
 */
export function getArchetypeMeta(id: ArchetypeId): ArchetypeMeta {
  return ARCHETYPE_META[id];
}

/**
 * Get all archetypes as array
 */
export function getAllArchetypes(): ArchetypeMeta[] {
  return Object.values(ARCHETYPE_META);
}

/**
 * Group archetypes by element
 */
export function getArchetypesByElement(element: ArchetypeMeta['element']): ArchetypeMeta[] {
  return getAllArchetypes().filter(a => a.element === element);
}
```

### 2.3 VibeID Hook

```typescript
// src/skills/vibe-id/hooks/useVibeID.ts

import { useCallback } from 'react';
import useSWR from 'swr';
import { create } from 'zustand';
import type { VibeIDProfile, ArchetypeId, DimensionId } from '@/types/vibe-id';
import { getArchetypeMeta } from '../constants/archetypes';

// ============================================================================
// Store
// ============================================================================

interface VibeIDState {
  profile: VibeIDProfile | null;
  isLoading: boolean;
  error: Error | null;

  // Actions
  setProfile: (profile: VibeIDProfile) => void;
  clearProfile: () => void;
}

export const useVibeIDStore = create<VibeIDState>((set) => ({
  profile: null,
  isLoading: false,
  error: null,

  setProfile: (profile) => set({ profile, isLoading: false, error: null }),
  clearProfile: () => set({ profile: null }),
}));

// ============================================================================
// API Fetcher
// ============================================================================

const fetcher = async (url: string): Promise<VibeIDProfile> => {
  const res = await fetch(url, {
    credentials: 'include',
    headers: { 'Content-Type': 'application/json' }
  });

  if (!res.ok) {
    const error = new Error('Failed to fetch VibeID profile');
    throw error;
  }

  return res.json();
};

// ============================================================================
// Main Hook
// ============================================================================

interface UseVibeIDOptions {
  userId?: string;
  autoFetch?: boolean;
}

interface UseVibeIDReturn {
  // Data
  profile: VibeIDProfile | null;
  isLoading: boolean;
  error: Error | null;

  // Computed
  coreArchetype: ReturnType<typeof getArchetypeMeta> | null;
  innerArchetype: ReturnType<typeof getArchetypeMeta> | null;
  outerArchetype: ReturnType<typeof getArchetypeMeta> | null;
  shadowArchetype: ReturnType<typeof getArchetypeMeta> | null;

  // Actions
  getArchetype: (dimension: DimensionId) => ReturnType<typeof getArchetypeMeta> | null;
  getTopArchetypes: (count?: number) => Array<{ id: ArchetypeId; score: number }>;
  refresh: () => Promise<void>;
}

export function useVibeID(options: UseVibeIDOptions = {}): UseVibeIDReturn {
  const { userId, autoFetch = true } = options;
  const { profile: storeProfile, setProfile } = useVibeIDStore();

  // SWR for data fetching with automatic deduplication (Vercel rule: client-swr-dedup)
  const { data, error, isLoading, mutate } = useSWR<VibeIDProfile>(
    autoFetch && userId ? `/api/vibe-id/${userId}` : null,
    fetcher,
    {
      revalidateOnFocus: false,
      revalidateOnReconnect: false,
      dedupingInterval: 60000, // 1 minute deduplication
      onSuccess: (data) => setProfile(data),
    }
  );

  const profile = data || storeProfile;

  // Get archetype for a specific dimension
  const getArchetype = useCallback((dimension: DimensionId) => {
    if (!profile) return null;
    const archetypeId = profile.archetypes[dimension];
    return getArchetypeMeta(archetypeId);
  }, [profile]);

  // Get top N archetypes by score
  const getTopArchetypes = useCallback((count = 4) => {
    if (!profile?.scores) return [];

    return Object.entries(profile.scores)
      .map(([id, score]) => ({ id: id as ArchetypeId, score }))
      .sort((a, b) => b.score - a.score)
      .slice(0, count);
  }, [profile]);

  // Refresh profile data
  const refresh = useCallback(async () => {
    await mutate();
  }, [mutate]);

  return {
    profile,
    isLoading,
    error: error || null,

    // Computed archetypes
    coreArchetype: getArchetype('core'),
    innerArchetype: getArchetype('inner'),
    outerArchetype: getArchetype('outer'),
    shadowArchetype: getArchetype('shadow'),

    // Actions
    getArchetype,
    getTopArchetypes,
    refresh,
  };
}
```

### 2.4 VibeID Components

#### 2.4.1 ArchetypeBadge

```tsx
// src/skills/vibe-id/components/ArchetypeBadge.tsx

import { memo } from 'react';
import { motion } from 'framer-motion';
import type { ArchetypeId, DimensionId } from '@/types/vibe-id';
import { getArchetypeMeta } from '../constants/archetypes';
import { cn } from '@/utils/cn';

interface ArchetypeBadgeProps {
  archetypeId: ArchetypeId;
  dimension?: DimensionId;
  size?: 'sm' | 'md' | 'lg';
  showLabel?: boolean;
  showDimension?: boolean;
  interactive?: boolean;
  className?: string;
  onClick?: () => void;
}

const DIMENSION_LABELS: Record<DimensionId, string> = {
  core: 'æ ¸å¿ƒ',
  inner: 'å†…åœ¨',
  outer: 'å¤–åœ¨',
  shadow: 'é˜´å½±',
};

const SIZE_CLASSES = {
  sm: 'w-10 h-10 text-lg',
  md: 'w-14 h-14 text-2xl',
  lg: 'w-20 h-20 text-4xl',
};

// Memoized to prevent unnecessary re-renders (Vercel rule: rerender-memo)
export const ArchetypeBadge = memo(function ArchetypeBadge({
  archetypeId,
  dimension,
  size = 'md',
  showLabel = false,
  showDimension = false,
  interactive = false,
  className,
  onClick,
}: ArchetypeBadgeProps) {
  const meta = getArchetypeMeta(archetypeId);

  return (
    <motion.div
      className={cn(
        'flex flex-col items-center gap-1',
        interactive && 'cursor-pointer',
        className
      )}
      whileHover={interactive ? { scale: 1.05 } : undefined}
      whileTap={interactive ? { scale: 0.95 } : undefined}
      onClick={onClick}
    >
      {/* Badge circle */}
      <div
        className={cn(
          'rounded-full flex items-center justify-center',
          'shadow-md transition-shadow hover:shadow-lg',
          SIZE_CLASSES[size]
        )}
        style={{ background: meta.gradient }}
      >
        <span role="img" aria-label={meta.name}>
          {meta.emoji}
        </span>
      </div>

      {/* Dimension label */}
      {showDimension && dimension && (
        <span className="text-xs text-ink-400 font-medium">
          {DIMENSION_LABELS[dimension]}
        </span>
      )}

      {/* Archetype name */}
      {showLabel && (
        <span className="text-sm text-ink-700 font-medium">
          {meta.nameCn}
        </span>
      )}
    </motion.div>
  );
});
```

#### 2.4.2 DimensionRow

```tsx
// src/skills/vibe-id/components/DimensionRow.tsx

import { memo } from 'react';
import type { ArchetypeId, DimensionId } from '@/types/vibe-id';
import { ArchetypeBadge } from './ArchetypeBadge';
import { getArchetypeMeta } from '../constants/archetypes';
import { cn } from '@/utils/cn';

interface DimensionRowProps {
  dimension: DimensionId;
  archetypeId: ArchetypeId;
  score?: number;
  expanded?: boolean;
  className?: string;
  onToggle?: () => void;
}

const DIMENSION_INFO: Record<DimensionId, { label: string; description: string; icon: string }> = {
  core: {
    label: 'æ ¸å¿ƒåŸå‹',
    description: 'ä½ æœ€çœŸå®çš„è‡ªæˆ‘ï¼Œå†…å¿ƒæ·±å¤„çš„æœ¬è´¨',
    icon: 'ğŸ’',
  },
  inner: {
    label: 'å†…åœ¨åŸå‹',
    description: 'ä½ çš„æƒ…æ„Ÿä¸–ç•Œä¸å†…åœ¨é©±åŠ¨åŠ›',
    icon: 'ğŸŒ™',
  },
  outer: {
    label: 'å¤–åœ¨åŸå‹',
    description: 'ä½ å‘ˆç°ç»™ä¸–ç•Œçš„æ ·å­',
    icon: 'â˜€ï¸',
  },
  shadow: {
    label: 'é˜´å½±åŸå‹',
    description: 'éšè—çš„æ½œèƒ½ä¸æˆé•¿ç©ºé—´',
    icon: 'ğŸŒ‘',
  },
};

export const DimensionRow = memo(function DimensionRow({
  dimension,
  archetypeId,
  score,
  expanded = false,
  className,
  onToggle,
}: DimensionRowProps) {
  const dimensionInfo = DIMENSION_INFO[dimension];
  const archetype = getArchetypeMeta(archetypeId);

  return (
    <div
      className={cn(
        'flex items-center gap-4 p-4 rounded-xl',
        'bg-vellum-50 hover:bg-vellum-100 transition-colors',
        'cursor-pointer',
        className
      )}
      onClick={onToggle}
    >
      {/* Dimension icon */}
      <span className="text-2xl">{dimensionInfo.icon}</span>

      {/* Dimension info */}
      <div className="flex-1 min-w-0">
        <div className="flex items-center gap-2">
          <span className="font-medium text-ink-800">
            {dimensionInfo.label}
          </span>
          {score !== undefined && (
            <span className="text-xs text-ink-400 bg-ink-100 px-2 py-0.5 rounded-full">
              {Math.round(score)}%
            </span>
          )}
        </div>
        <p className="text-sm text-ink-500 truncate">
          {dimensionInfo.description}
        </p>
      </div>

      {/* Archetype badge */}
      <ArchetypeBadge
        archetypeId={archetypeId}
        size="sm"
        showLabel
      />

      {/* Expanded content */}
      {expanded && (
        <div className="mt-4 pt-4 border-t border-ink-100">
          <p className="text-sm text-ink-600 mb-2">
            {archetype.slogan}
          </p>
          <div className="flex flex-wrap gap-2">
            {archetype.growthPoints.map((point, i) => (
              <span
                key={i}
                className="text-xs bg-mystic-100 text-mystic-700 px-2 py-1 rounded-full"
              >
                {point}
              </span>
            ))}
          </div>
        </div>
      )}
    </div>
  );
});
```

#### 2.4.3 VibeIDCard (Main Display Component)

```tsx
// src/skills/vibe-id/components/VibeIDCard.tsx

import { memo, useState, useCallback } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import type { VibeIDProfile, DimensionId } from '@/types/vibe-id';
import { ArchetypeBadge } from './ArchetypeBadge';
import { DimensionRow } from './DimensionRow';
import { ArchetypeWheel } from './ArchetypeWheel';
import { cn } from '@/utils/cn';

interface VibeIDCardProps {
  profile: VibeIDProfile;
  variant?: 'compact' | 'full' | 'expanded';
  showWheel?: boolean;
  className?: string;
}

const DIMENSIONS: DimensionId[] = ['core', 'inner', 'outer', 'shadow'];

export const VibeIDCard = memo(function VibeIDCard({
  profile,
  variant = 'full',
  showWheel = true,
  className,
}: VibeIDCardProps) {
  const [expandedDimension, setExpandedDimension] = useState<DimensionId | null>(null);

  // Stable callback using functional pattern (Vercel rule: rerender-functional-setstate)
  const toggleDimension = useCallback((dimension: DimensionId) => {
    setExpandedDimension(prev => prev === dimension ? null : dimension);
  }, []);

  if (variant === 'compact') {
    return (
      <div className={cn('flex items-center gap-2', className)}>
        {DIMENSIONS.map(dim => (
          <ArchetypeBadge
            key={dim}
            archetypeId={profile.archetypes[dim]}
            dimension={dim}
            size="sm"
            showDimension
          />
        ))}
      </div>
    );
  }

  return (
    <div
      className={cn(
        'bg-white rounded-2xl shadow-card overflow-hidden',
        'border border-ink-100',
        className
      )}
    >
      {/* Header with main archetypes */}
      <div className="p-6 bg-gradient-to-br from-vellum-50 to-white">
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-lg font-semibold text-ink-800">
            ä½ çš„ VibeID
          </h3>
          <span className="text-xs text-ink-400">
            ç½®ä¿¡åº¦: {Math.round(profile.confidence * 100)}%
          </span>
        </div>

        {/* Four dimension badges in a row */}
        <div className="flex justify-around">
          {DIMENSIONS.map(dim => (
            <ArchetypeBadge
              key={dim}
              archetypeId={profile.archetypes[dim]}
              dimension={dim}
              size="md"
              showLabel
              showDimension
              interactive
              onClick={() => toggleDimension(dim)}
            />
          ))}
        </div>
      </div>

      {/* Archetype wheel visualization */}
      {showWheel && variant === 'expanded' && (
        <div className="p-6 border-t border-ink-100">
          <ArchetypeWheel
            scores={profile.scores}
            highlighted={profile.archetypes}
          />
        </div>
      )}

      {/* Dimension details */}
      <div className="p-4 space-y-2">
        <AnimatePresence mode="popLayout">
          {DIMENSIONS.map(dim => (
            <motion.div
              key={dim}
              layout
              initial={{ opacity: 0, y: 10 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -10 }}
            >
              <DimensionRow
                dimension={dim}
                archetypeId={profile.archetypes[dim]}
                score={profile.dimensionScores?.[dim]?.[profile.archetypes[dim]]}
                expanded={expandedDimension === dim}
                onToggle={() => toggleDimension(dim)}
              />
            </motion.div>
          ))}
        </AnimatePresence>
      </div>

      {/* Footer with source info */}
      <div className="px-6 py-3 bg-ink-50 text-xs text-ink-400">
        åŸºäº {profile.source === 'bazi' ? 'å…«å­—' : profile.source === 'zodiac' ? 'æ˜Ÿç›˜' : 'ç»¼åˆ'} åˆ†æ Â·
        æ›´æ–°äº {new Date(profile.calculatedAt).toLocaleDateString('zh-CN')}
      </div>
    </div>
  );
});
```

#### 2.4.4 ArchetypeWheel (Radar Chart)

```tsx
// src/skills/vibe-id/components/ArchetypeWheel.tsx

import { memo, useMemo } from 'react';
import ReactECharts from 'echarts-for-react';
import type { ArchetypeId, FourDimensionArchetypes } from '@/types/vibe-id';
import { ARCHETYPE_META, getAllArchetypes } from '../constants/archetypes';

interface ArchetypeWheelProps {
  scores: Record<ArchetypeId, number>;
  highlighted?: FourDimensionArchetypes;
  size?: number;
  className?: string;
}

export const ArchetypeWheel = memo(function ArchetypeWheel({
  scores,
  highlighted,
  size = 300,
  className,
}: ArchetypeWheelProps) {
  // Memoize chart options to prevent re-computation (Vercel rule: rerender-memo)
  const option = useMemo(() => {
    const archetypes = getAllArchetypes();

    // Build indicator array for radar
    const indicator = archetypes.map(a => ({
      name: a.emoji + ' ' + a.nameCn,
      max: 100,
    }));

    // Build data array
    const data = archetypes.map(a => scores[a.id] || 0);

    // Determine highlighted points
    const highlightedIds = highlighted
      ? Object.values(highlighted)
      : [];

    return {
      tooltip: {
        trigger: 'item',
      },
      radar: {
        indicator,
        shape: 'polygon',
        splitNumber: 4,
        axisName: {
          color: '#3D3D3D',
          fontSize: 11,
        },
        splitLine: {
          lineStyle: {
            color: 'rgba(139, 115, 85, 0.2)',
          },
        },
        splitArea: {
          areaStyle: {
            color: ['rgba(255, 250, 240, 0.3)', 'rgba(255, 250, 240, 0.5)'],
          },
        },
        axisLine: {
          lineStyle: {
            color: 'rgba(139, 115, 85, 0.3)',
          },
        },
      },
      series: [
        {
          type: 'radar',
          data: [
            {
              value: data,
              name: 'VibeID',
              areaStyle: {
                color: 'rgba(138, 79, 125, 0.3)',
              },
              lineStyle: {
                color: '#8A4F7D',
                width: 2,
              },
              itemStyle: {
                color: (params: { dataIndex: number }) => {
                  const archetype = archetypes[params.dataIndex];
                  return highlightedIds.includes(archetype.id)
                    ? archetype.color
                    : '#8A4F7D';
                },
              },
              symbol: 'circle',
              symbolSize: (value: number, params: { dataIndex: number }) => {
                const archetype = archetypes[params.dataIndex];
                return highlightedIds.includes(archetype.id) ? 10 : 6;
              },
            },
          ],
        },
      ],
    };
  }, [scores, highlighted]);

  return (
    <div className={className}>
      <ReactECharts
        option={option}
        style={{ width: size, height: size }}
        opts={{ renderer: 'svg' }}
      />
    </div>
  );
});
```

### 2.5 VibeID Tool Card (for Chat)

```tsx
// src/skills/vibe-id/tools/show-vibe-id.tsx

import { memo } from 'react';
import type { VibeIDProfile } from '@/types/vibe-id';
import { VibeIDCard } from '../components/VibeIDCard';

interface ShowVibeIDProps {
  data: {
    profile: VibeIDProfile;
    analysis?: string;
    recommendations?: string[];
  };
}

/**
 * Tool result card for displaying VibeID in chat
 * Registered in CardRegistry as 'show_vibe_id'
 */
export const ShowVibeID = memo(function ShowVibeID({ data }: ShowVibeIDProps) {
  const { profile, analysis, recommendations } = data;

  return (
    <div className="space-y-4 max-w-md">
      <VibeIDCard
        profile={profile}
        variant="full"
        showWheel={false}
      />

      {analysis && (
        <div className="p-4 bg-vellum-50 rounded-xl">
          <h4 className="text-sm font-medium text-ink-700 mb-2">
            åŸå‹è§£è¯»
          </h4>
          <p className="text-sm text-ink-600 leading-relaxed">
            {analysis}
          </p>
        </div>
      )}

      {recommendations && recommendations.length > 0 && (
        <div className="p-4 bg-mystic-50 rounded-xl">
          <h4 className="text-sm font-medium text-mystic-700 mb-2">
            æˆé•¿å»ºè®®
          </h4>
          <ul className="space-y-1">
            {recommendations.map((rec, i) => (
              <li key={i} className="text-sm text-mystic-600 flex items-start gap-2">
                <span className="text-mystic-400">â€¢</span>
                {rec}
              </li>
            ))}
          </ul>
        </div>
      )}
    </div>
  );
});

// Export for CardRegistry
export default ShowVibeID;
```

---

## 3. Design System

> **Theme**: ã€Œæš–é˜³ç¥ç§˜ã€ - Warm mysticism combining ancient wisdom aesthetics with modern clarity
> **Source**: VibeLife-frontend-v6.md Section 3

### 3.1 Design Principles

1. **Warm Mystery** (æš–é˜³ç¥ç§˜): Balance between approachable warmth and mystical depth
2. **Quiet Confidence**: Designs that inspire trust without overwhelming
3. **Ink Aesthetics**: Traditional Chinese ink painting inspiration with modern execution
4. **Progressive Revelation**: Information unveiled gradually, respecting user's journey

### 3.2 Color System

#### 3.2.1 CSS Variables

```css
/* src/styles/variables.css */

:root {
  /* ====================================================================== */
  /* INK COLORS - Primary text and UI elements                              */
  /* Inspired by Chinese ink gradations                                      */
  /* ====================================================================== */
  --ink-50: #F5F5F5;
  --ink-100: #E8E8E8;
  --ink-200: #D1D1D1;
  --ink-300: #A3A3A3;
  --ink-400: #737373;
  --ink-500: #525252;
  --ink-600: #404040;
  --ink-700: #303030;
  --ink-800: #1F1F1F;
  --ink-900: #0F0F0F;

  /* ====================================================================== */
  /* VELLUM COLORS - Backgrounds and surfaces                               */
  /* Inspired by aged paper and parchment                                    */
  /* ====================================================================== */
  --vellum-50: #FFFDF8;
  --vellum-100: #FFF9ED;
  --vellum-200: #FFF3DB;
  --vellum-300: #FFE9C2;
  --vellum-400: #FFDFA8;
  --vellum-500: #F5D08C;
  --vellum-600: #E6B85C;
  --vellum-700: #D4A03C;
  --vellum-800: #B8862C;
  --vellum-900: #8C661C;

  /* ====================================================================== */
  /* ANTIQUE GOLD - Accents and highlights                                  */
  /* Represents wisdom and value                                             */
  /* ====================================================================== */
  --gold-50: #FEF9E7;
  --gold-100: #FCF0C8;
  --gold-200: #F9E38F;
  --gold-300: #F5D257;
  --gold-400: #E6B800;
  --gold-500: #D4AF37;  /* Primary gold */
  --gold-600: #B8972F;
  --gold-700: #9A7F27;
  --gold-800: #7C671F;
  --gold-900: #5E4F17;

  /* ====================================================================== */
  /* MYSTIC PURPLE - Mystery and insight                                    */
  /* The spiritual dimension of the design                                   */
  /* ====================================================================== */
  --mystic-50: #F8F4FA;
  --mystic-100: #EDE4F2;
  --mystic-200: #DBC9E5;
  --mystic-300: #C4A7D4;
  --mystic-400: #A87FC0;
  --mystic-500: #8A4F7D;  /* Primary mystic */
  --mystic-600: #6E3F64;
  --mystic-700: #52304B;
  --mystic-800: #372032;
  --mystic-900: #1B1019;

  /* ====================================================================== */
  /* FIVE ELEMENT COLORS - Chinese cosmology                                */
  /* Used for Bazi, Zodiac, and elemental representations                   */
  /* ====================================================================== */

  /* Wood (æœ¨) - Growth, creativity */
  --element-wood: #228B22;
  --element-wood-light: #90EE90;
  --element-wood-dark: #006400;

  /* Fire (ç«) - Passion, transformation */
  --element-fire: #DC143C;
  --element-fire-light: #FF6B6B;
  --element-fire-dark: #8B0000;

  /* Earth (åœŸ) - Stability, nurturing */
  --element-earth: #DAA520;
  --element-earth-light: #F4D03F;
  --element-earth-dark: #8B4513;

  /* Metal (é‡‘) - Precision, value */
  --element-metal: #C0C0C0;
  --element-metal-light: #E8E8E8;
  --element-metal-dark: #808080;

  /* Water (æ°´) - Wisdom, flow */
  --element-water: #1E90FF;
  --element-water-light: #87CEEB;
  --element-water-dark: #000080;

  /* ====================================================================== */
  /* SEMANTIC COLORS                                                         */
  /* ====================================================================== */
  --color-success: #22C55E;
  --color-warning: #F59E0B;
  --color-error: #EF4444;
  --color-info: #3B82F6;

  /* ====================================================================== */
  /* SHADOWS                                                                 */
  /* ====================================================================== */
  --shadow-sm: 0 1px 2px 0 rgba(31, 31, 31, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(31, 31, 31, 0.1), 0 2px 4px -2px rgba(31, 31, 31, 0.1);
  --shadow-lg: 0 10px 15px -3px rgba(31, 31, 31, 0.1), 0 4px 6px -4px rgba(31, 31, 31, 0.1);
  --shadow-xl: 0 20px 25px -5px rgba(31, 31, 31, 0.1), 0 8px 10px -6px rgba(31, 31, 31, 0.1);
  --shadow-card: 0 4px 20px rgba(139, 115, 85, 0.12);
  --shadow-glow: 0 0 20px rgba(138, 79, 125, 0.3);

  /* ====================================================================== */
  /* SPACING                                                                 */
  /* ====================================================================== */
  --space-1: 0.25rem;   /* 4px */
  --space-2: 0.5rem;    /* 8px */
  --space-3: 0.75rem;   /* 12px */
  --space-4: 1rem;      /* 16px */
  --space-5: 1.25rem;   /* 20px */
  --space-6: 1.5rem;    /* 24px */
  --space-8: 2rem;      /* 32px */
  --space-10: 2.5rem;   /* 40px */
  --space-12: 3rem;     /* 48px */
  --space-16: 4rem;     /* 64px */

  /* ====================================================================== */
  /* TYPOGRAPHY                                                              */
  /* ====================================================================== */
  --font-sans: 'Inter', 'Noto Sans SC', system-ui, sans-serif;
  --font-serif: 'Noto Serif SC', 'Songti SC', serif;
  --font-mono: 'JetBrains Mono', 'Fira Code', monospace;

  --text-xs: 0.75rem;     /* 12px */
  --text-sm: 0.875rem;    /* 14px */
  --text-base: 1rem;      /* 16px */
  --text-lg: 1.125rem;    /* 18px */
  --text-xl: 1.25rem;     /* 20px */
  --text-2xl: 1.5rem;     /* 24px */
  --text-3xl: 1.875rem;   /* 30px */
  --text-4xl: 2.25rem;    /* 36px */

  /* ====================================================================== */
  /* BORDER RADIUS                                                           */
  /* ====================================================================== */
  --radius-sm: 0.25rem;   /* 4px */
  --radius-md: 0.5rem;    /* 8px */
  --radius-lg: 0.75rem;   /* 12px */
  --radius-xl: 1rem;      /* 16px */
  --radius-2xl: 1.5rem;   /* 24px */
  --radius-full: 9999px;

  /* ====================================================================== */
  /* Z-INDEX                                                                 */
  /* ====================================================================== */
  --z-dropdown: 100;
  --z-sticky: 200;
  --z-fixed: 300;
  --z-modal-backdrop: 400;
  --z-modal: 500;
  --z-popover: 600;
  --z-tooltip: 700;
  --z-toast: 800;
}

/* Dark mode overrides */
[data-theme="dark"] {
  --ink-50: #0F0F0F;
  --ink-100: #1F1F1F;
  --ink-200: #303030;
  --ink-300: #404040;
  --ink-400: #525252;
  --ink-500: #737373;
  --ink-600: #A3A3A3;
  --ink-700: #D1D1D1;
  --ink-800: #E8E8E8;
  --ink-900: #F5F5F5;

  --vellum-50: #1A1814;
  --vellum-100: #252119;
  --vellum-200: #302A1E;
  --vellum-300: #3B3323;
  --vellum-400: #463C28;
}
```

#### 3.2.2 Tailwind Configuration

```typescript
// tailwind.config.ts

import type { Config } from 'tailwindcss';

const config: Config = {
  content: [
    './src/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        // Ink palette
        ink: {
          50: 'var(--ink-50)',
          100: 'var(--ink-100)',
          200: 'var(--ink-200)',
          300: 'var(--ink-300)',
          400: 'var(--ink-400)',
          500: 'var(--ink-500)',
          600: 'var(--ink-600)',
          700: 'var(--ink-700)',
          800: 'var(--ink-800)',
          900: 'var(--ink-900)',
        },
        // Vellum palette
        vellum: {
          50: 'var(--vellum-50)',
          100: 'var(--vellum-100)',
          200: 'var(--vellum-200)',
          300: 'var(--vellum-300)',
          400: 'var(--vellum-400)',
          500: 'var(--vellum-500)',
          600: 'var(--vellum-600)',
          700: 'var(--vellum-700)',
          800: 'var(--vellum-800)',
          900: 'var(--vellum-900)',
        },
        // Gold palette
        gold: {
          50: 'var(--gold-50)',
          100: 'var(--gold-100)',
          200: 'var(--gold-200)',
          300: 'var(--gold-300)',
          400: 'var(--gold-400)',
          500: 'var(--gold-500)',
          600: 'var(--gold-600)',
          700: 'var(--gold-700)',
          800: 'var(--gold-800)',
          900: 'var(--gold-900)',
        },
        // Mystic palette
        mystic: {
          50: 'var(--mystic-50)',
          100: 'var(--mystic-100)',
          200: 'var(--mystic-200)',
          300: 'var(--mystic-300)',
          400: 'var(--mystic-400)',
          500: 'var(--mystic-500)',
          600: 'var(--mystic-600)',
          700: 'var(--mystic-700)',
          800: 'var(--mystic-800)',
          900: 'var(--mystic-900)',
        },
        // Five elements
        element: {
          wood: 'var(--element-wood)',
          'wood-light': 'var(--element-wood-light)',
          'wood-dark': 'var(--element-wood-dark)',
          fire: 'var(--element-fire)',
          'fire-light': 'var(--element-fire-light)',
          'fire-dark': 'var(--element-fire-dark)',
          earth: 'var(--element-earth)',
          'earth-light': 'var(--element-earth-light)',
          'earth-dark': 'var(--element-earth-dark)',
          metal: 'var(--element-metal)',
          'metal-light': 'var(--element-metal-light)',
          'metal-dark': 'var(--element-metal-dark)',
          water: 'var(--element-water)',
          'water-light': 'var(--element-water-light)',
          'water-dark': 'var(--element-water-dark)',
        },
      },
      fontFamily: {
        sans: ['var(--font-sans)'],
        serif: ['var(--font-serif)'],
        mono: ['var(--font-mono)'],
      },
      boxShadow: {
        card: 'var(--shadow-card)',
        glow: 'var(--shadow-glow)',
      },
      borderRadius: {
        '2xl': 'var(--radius-2xl)',
      },
      animation: {
        'breath': 'breath 4s ease-in-out infinite',
        'glow-pulse': 'glow-pulse 2s ease-in-out infinite',
        'float': 'float 6s ease-in-out infinite',
        'shimmer': 'shimmer 2s linear infinite',
      },
      keyframes: {
        breath: {
          '0%, 100%': { transform: 'scale(1)', opacity: '0.8' },
          '50%': { transform: 'scale(1.05)', opacity: '1' },
        },
        'glow-pulse': {
          '0%, 100%': { boxShadow: '0 0 20px rgba(138, 79, 125, 0.3)' },
          '50%': { boxShadow: '0 0 40px rgba(138, 79, 125, 0.5)' },
        },
        float: {
          '0%, 100%': { transform: 'translateY(0)' },
          '50%': { transform: 'translateY(-10px)' },
        },
        shimmer: {
          '0%': { backgroundPosition: '-200% 0' },
          '100%': { backgroundPosition: '200% 0' },
        },
      },
    },
  },
  plugins: [],
};

export default config;
```

### 3.3 Typography System

```css
/* src/styles/typography.css */

/* Heading styles */
.heading-1 {
  font-family: var(--font-serif);
  font-size: var(--text-4xl);
  font-weight: 700;
  line-height: 1.2;
  color: var(--ink-800);
  letter-spacing: -0.02em;
}

.heading-2 {
  font-family: var(--font-serif);
  font-size: var(--text-3xl);
  font-weight: 600;
  line-height: 1.25;
  color: var(--ink-800);
}

.heading-3 {
  font-family: var(--font-sans);
  font-size: var(--text-2xl);
  font-weight: 600;
  line-height: 1.3;
  color: var(--ink-700);
}

.heading-4 {
  font-family: var(--font-sans);
  font-size: var(--text-xl);
  font-weight: 600;
  line-height: 1.4;
  color: var(--ink-700);
}

/* Body text */
.body-large {
  font-family: var(--font-sans);
  font-size: var(--text-lg);
  line-height: 1.6;
  color: var(--ink-600);
}

.body {
  font-family: var(--font-sans);
  font-size: var(--text-base);
  line-height: 1.6;
  color: var(--ink-600);
}

.body-small {
  font-family: var(--font-sans);
  font-size: var(--text-sm);
  line-height: 1.5;
  color: var(--ink-500);
}

/* Caption and labels */
.caption {
  font-family: var(--font-sans);
  font-size: var(--text-xs);
  line-height: 1.4;
  color: var(--ink-400);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.label {
  font-family: var(--font-sans);
  font-size: var(--text-sm);
  font-weight: 500;
  line-height: 1.4;
  color: var(--ink-700);
}

/* Chinese-specific adjustments */
:lang(zh) {
  /* Slightly increase line height for Chinese text */
  line-height: 1.8;
  /* Use full-width punctuation */
  font-feature-settings: "fwid";
}
```

### 3.4 Archetype Visual System

Each archetype has a unique visual identity integrated into the design system:

```typescript
// src/skills/vibe-id/styles/archetype-styles.ts

import type { ArchetypeId } from '@/types/vibe-id';

/**
 * Archetype-specific CSS classes for visual theming
 */
export const ARCHETYPE_STYLES: Record<ArchetypeId, {
  gradient: string;
  glow: string;
  border: string;
  text: string;
  bg: string;
}> = {
  innocent: {
    gradient: 'bg-gradient-to-br from-pink-200 via-pink-100 to-white',
    glow: 'shadow-[0_0_20px_rgba(255,183,197,0.4)]',
    border: 'border-pink-200',
    text: 'text-pink-600',
    bg: 'bg-pink-50',
  },
  explorer: {
    gradient: 'bg-gradient-to-br from-sky-200 via-sky-100 to-white',
    glow: 'shadow-[0_0_20px_rgba(135,206,235,0.4)]',
    border: 'border-sky-200',
    text: 'text-sky-600',
    bg: 'bg-sky-50',
  },
  sage: {
    gradient: 'bg-gradient-to-br from-purple-200 via-purple-100 to-white',
    glow: 'shadow-[0_0_20px_rgba(155,89,182,0.4)]',
    border: 'border-purple-200',
    text: 'text-purple-600',
    bg: 'bg-purple-50',
  },
  hero: {
    gradient: 'bg-gradient-to-br from-red-200 via-red-100 to-white',
    glow: 'shadow-[0_0_20px_rgba(231,76,60,0.4)]',
    border: 'border-red-200',
    text: 'text-red-600',
    bg: 'bg-red-50',
  },
  outlaw: {
    gradient: 'bg-gradient-to-br from-rose-300 via-rose-200 to-rose-50',
    glow: 'shadow-[0_0_20px_rgba(139,0,0,0.4)]',
    border: 'border-rose-300',
    text: 'text-rose-700',
    bg: 'bg-rose-50',
  },
  magician: {
    gradient: 'bg-gradient-to-br from-violet-200 via-violet-100 to-white',
    glow: 'shadow-[0_0_20px_rgba(142,68,173,0.4)]',
    border: 'border-violet-200',
    text: 'text-violet-600',
    bg: 'bg-violet-50',
  },
  regular: {
    gradient: 'bg-gradient-to-br from-green-200 via-green-100 to-white',
    glow: 'shadow-[0_0_20px_rgba(39,174,96,0.4)]',
    border: 'border-green-200',
    text: 'text-green-600',
    bg: 'bg-green-50',
  },
  lover: {
    gradient: 'bg-gradient-to-br from-fuchsia-200 via-fuchsia-100 to-white',
    glow: 'shadow-[0_0_20px_rgba(233,30,99,0.4)]',
    border: 'border-fuchsia-200',
    text: 'text-fuchsia-600',
    bg: 'bg-fuchsia-50',
  },
  jester: {
    gradient: 'bg-gradient-to-br from-amber-200 via-amber-100 to-white',
    glow: 'shadow-[0_0_20px_rgba(243,156,18,0.4)]',
    border: 'border-amber-200',
    text: 'text-amber-600',
    bg: 'bg-amber-50',
  },
  caregiver: {
    gradient: 'bg-gradient-to-br from-emerald-200 via-emerald-100 to-white',
    glow: 'shadow-[0_0_20px_rgba(46,204,113,0.4)]',
    border: 'border-emerald-200',
    text: 'text-emerald-600',
    bg: 'bg-emerald-50',
  },
  creator: {
    gradient: 'bg-gradient-to-br from-blue-200 via-blue-100 to-white',
    glow: 'shadow-[0_0_20px_rgba(52,152,219,0.4)]',
    border: 'border-blue-200',
    text: 'text-blue-600',
    bg: 'bg-blue-50',
  },
  ruler: {
    gradient: 'bg-gradient-to-br from-yellow-200 via-yellow-100 to-white',
    glow: 'shadow-[0_0_20px_rgba(212,175,55,0.4)]',
    border: 'border-yellow-300',
    text: 'text-yellow-700',
    bg: 'bg-yellow-50',
  },
};

/**
 * Get archetype style classes
 */
export function getArchetypeStyles(id: ArchetypeId) {
  return ARCHETYPE_STYLES[id];
}
```

### 3.5 Animation Patterns

```tsx
// src/components/shared/animations.ts

import { Variants } from 'framer-motion';

/**
 * Standard animation variants for consistent motion design
 */

// Fade and slide up (for content reveal)
export const fadeInUp: Variants = {
  initial: { opacity: 0, y: 20 },
  animate: { opacity: 1, y: 0 },
  exit: { opacity: 0, y: -10 },
};

// Fade and scale (for modals and cards)
export const fadeInScale: Variants = {
  initial: { opacity: 0, scale: 0.95 },
  animate: { opacity: 1, scale: 1 },
  exit: { opacity: 0, scale: 0.95 },
};

// Stagger children (for lists)
export const staggerContainer: Variants = {
  animate: {
    transition: {
      staggerChildren: 0.05,
    },
  },
};

// Slide in from right (for navigation)
export const slideInRight: Variants = {
  initial: { x: '100%' },
  animate: { x: 0 },
  exit: { x: '100%' },
};

// Spring physics for interactive elements
export const springConfig = {
  type: 'spring',
  stiffness: 300,
  damping: 30,
};

// Smooth easing for non-interactive animations
export const smoothConfig = {
  duration: 0.3,
  ease: [0.4, 0, 0.2, 1],
};

/**
 * BreathAura animation component
 * Creates a subtle pulsing glow effect
 */
export const breathAuraVariants: Variants = {
  animate: {
    scale: [1, 1.02, 1],
    opacity: [0.6, 0.8, 0.6],
    transition: {
      duration: 4,
      repeat: Infinity,
      ease: 'easeInOut',
    },
  },
};
```

### 3.6 Component Patterns

#### 3.6.1 Card Pattern

```tsx
// src/components/ui/Card.tsx

import { forwardRef, HTMLAttributes } from 'react';
import { cn } from '@/utils/cn';

interface CardProps extends HTMLAttributes<HTMLDivElement> {
  variant?: 'default' | 'elevated' | 'outlined' | 'mystical';
  padding?: 'none' | 'sm' | 'md' | 'lg';
}

const VARIANT_CLASSES = {
  default: 'bg-white border border-ink-100',
  elevated: 'bg-white shadow-card',
  outlined: 'bg-transparent border-2 border-ink-200',
  mystical: 'bg-gradient-to-br from-vellum-50 to-white border border-gold-200 shadow-glow',
};

const PADDING_CLASSES = {
  none: '',
  sm: 'p-3',
  md: 'p-4',
  lg: 'p-6',
};

export const Card = forwardRef<HTMLDivElement, CardProps>(
  ({ variant = 'default', padding = 'md', className, children, ...props }, ref) => {
    return (
      <div
        ref={ref}
        className={cn(
          'rounded-xl',
          VARIANT_CLASSES[variant],
          PADDING_CLASSES[padding],
          className
        )}
        {...props}
      >
        {children}
      </div>
    );
  }
);

Card.displayName = 'Card';
```

#### 3.6.2 Button Pattern

```tsx
// src/components/ui/Button.tsx

import { forwardRef, ButtonHTMLAttributes } from 'react';
import { cn } from '@/utils/cn';

interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'ghost' | 'mystical';
  size?: 'sm' | 'md' | 'lg';
  loading?: boolean;
}

const VARIANT_CLASSES = {
  primary: 'bg-mystic-500 text-white hover:bg-mystic-600 active:bg-mystic-700',
  secondary: 'bg-vellum-100 text-ink-700 hover:bg-vellum-200 active:bg-vellum-300',
  ghost: 'bg-transparent text-ink-600 hover:bg-ink-50 active:bg-ink-100',
  mystical: 'bg-gradient-to-r from-mystic-500 to-gold-500 text-white hover:opacity-90',
};

const SIZE_CLASSES = {
  sm: 'h-8 px-3 text-sm',
  md: 'h-10 px-4 text-base',
  lg: 'h-12 px-6 text-lg',
};

export const Button = forwardRef<HTMLButtonElement, ButtonProps>(
  ({ variant = 'primary', size = 'md', loading, className, disabled, children, ...props }, ref) => {
    return (
      <button
        ref={ref}
        className={cn(
          'inline-flex items-center justify-center gap-2',
          'font-medium rounded-lg transition-colors',
          'focus:outline-none focus:ring-2 focus:ring-mystic-300 focus:ring-offset-2',
          'disabled:opacity-50 disabled:cursor-not-allowed',
          VARIANT_CLASSES[variant],
          SIZE_CLASSES[size],
          className
        )}
        disabled={disabled || loading}
        {...props}
      >
        {loading && (
          <svg className="animate-spin h-4 w-4" viewBox="0 0 24 24">
            <circle
              className="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              strokeWidth="4"
              fill="none"
            />
            <path
              className="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"
            />
          </svg>
        )}
        {children}
      </button>
    );
  }
);

Button.displayName = 'Button';
```

---

## 4. æ€§èƒ½ä¼˜åŒ–

> **æ¥æº**: Vercel React Best Practices (45æ¡è§„åˆ™)
> **ä¼˜å…ˆçº§**: æŒ‰å½±å“ç¨‹åº¦æ’åºï¼ŒCRITICAL > HIGH > MEDIUM > LOW

### 4.1 è§„åˆ™æ€»è§ˆ

| ä¼˜å…ˆçº§ | ç±»åˆ« | å½±å“ç¨‹åº¦ | å‰ç¼€ | è§„åˆ™æ•° |
|--------|------|----------|------|--------|
| 1 | æ¶ˆé™¤ç€‘å¸ƒæµ | CRITICAL | `async-` | 5 |
| 2 | åŒ…ä½“ç§¯ä¼˜åŒ– | CRITICAL | `bundle-` | 5 |
| 3 | æœåŠ¡ç«¯æ€§èƒ½ | HIGH | `server-` | 5 |
| 4 | å®¢æˆ·ç«¯æ•°æ®è·å– | MEDIUM-HIGH | `client-` | 2 |
| 5 | é‡æ¸²æŸ“ä¼˜åŒ– | MEDIUM | `rerender-` | 7 |
| 6 | æ¸²æŸ“æ€§èƒ½ | MEDIUM | `rendering-` | 7 |
| 7 | JavaScript æ€§èƒ½ | LOW-MEDIUM | `js-` | 12 |
| 8 | é«˜çº§æ¨¡å¼ | LOW | `advanced-` | 2 |

### 4.2 CRITICAL: æ¶ˆé™¤ç€‘å¸ƒæµ (async-*)

ç€‘å¸ƒæµæ˜¯æ€§èƒ½çš„å¤´å·æ€æ‰‹ã€‚æ¯ä¸ªé¡ºåºæ‰§è¡Œçš„ await éƒ½ä¼šå¢åŠ å®Œæ•´çš„ç½‘ç»œå»¶è¿Ÿã€‚

#### 4.2.1 async-parallel: å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹æ“ä½œ

```typescript
// âŒ é”™è¯¯: é¡ºåºæ‰§è¡Œé€ æˆç€‘å¸ƒæµ
async function loadDashboard(userId: string) {
  const profile = await fetchProfile(userId);      // 200ms
  const vibeId = await fetchVibeId(userId);        // 150ms
  const history = await fetchChatHistory(userId);  // 180ms
  // æ€»è®¡: 530ms
  return { profile, vibeId, history };
}

// âœ… æ­£ç¡®: ä½¿ç”¨ Promise.all å¹¶è¡Œæ‰§è¡Œ
async function loadDashboard(userId: string) {
  const [profile, vibeId, history] = await Promise.all([
    fetchProfile(userId),      // â”
    fetchVibeId(userId),       // â”œâ”€ å¹¶è¡Œæ‰§è¡Œ
    fetchChatHistory(userId),  // â”˜
  ]);
  // æ€»è®¡: max(200, 150, 180) = 200ms
  return { profile, vibeId, history };
}
```

#### 4.2.2 async-defer-await: å»¶è¿Ÿ await åˆ°å®é™…ä½¿ç”¨æ—¶

```typescript
// âŒ é”™è¯¯: ç«‹å³ await
async function getInsight(userId: string) {
  const profile = await fetchProfile(userId);  // ç«‹å³é˜»å¡

  if (someCondition) {
    return cachedInsight;  // profile ä»æœªä½¿ç”¨
  }

  return generateInsight(profile);
}

// âœ… æ­£ç¡®: å»¶è¿Ÿ await åˆ°ä½¿ç”¨åˆ†æ”¯
async function getInsight(userId: string) {
  const profilePromise = fetchProfile(userId);  // å¯åŠ¨ä½†ä¸ç­‰å¾…

  if (someCondition) {
    return cachedInsight;  // æ— éœ€ç­‰å¾… profile
  }

  const profile = await profilePromise;  // ä»…åœ¨éœ€è¦æ—¶ç­‰å¾…
  return generateInsight(profile);
}
```

#### 4.2.3 async-suspense-boundaries: ä½¿ç”¨ Suspense æµå¼ä¼ è¾“

```tsx
// âŒ é”™è¯¯: æ•´ä¸ªé¡µé¢ç­‰å¾…æ‰€æœ‰æ•°æ®
async function VibeIDPage() {
  const profile = await fetchVibeID();
  const insights = await fetchInsights();

  return (
    <div>
      <VibeIDCard profile={profile} />
      <InsightsList insights={insights} />
    </div>
  );
}

// âœ… æ­£ç¡®: ä½¿ç”¨ Suspense è¾¹ç•Œæµå¼ä¼ è¾“
function VibeIDPage() {
  return (
    <div>
      <Suspense fallback={<VibeIDSkeleton />}>
        <VibeIDSection />  {/* ç‹¬ç«‹åŠ è½½ */}
      </Suspense>
      <Suspense fallback={<InsightsSkeleton />}>
        <InsightsSection />  {/* ç‹¬ç«‹åŠ è½½ */}
      </Suspense>
    </div>
  );
}

async function VibeIDSection() {
  const profile = await fetchVibeID();
  return <VibeIDCard profile={profile} />;
}
```

### 4.3 CRITICAL: åŒ…ä½“ç§¯ä¼˜åŒ– (bundle-*)

å‡å°‘åˆå§‹åŒ…ä½“ç§¯å¯æ”¹å–„ Time to Interactive å’Œ Largest Contentful Paintã€‚

#### 4.3.1 bundle-barrel-imports: é¿å…æ¡¶æ–‡ä»¶å¯¼å…¥

```typescript
// âŒ é”™è¯¯: ä»æ¡¶æ–‡ä»¶å¯¼å…¥ (å¯èƒ½å¯¼å…¥æ•´ä¸ªåº“)
import { Button } from '@/components/ui';
import { useVibeID } from '@/hooks';

// âœ… æ­£ç¡®: ç›´æ¥ä»æºæ–‡ä»¶å¯¼å…¥
import { Button } from '@/components/ui/Button';
import { useVibeID } from '@/skills/vibe-id/hooks/useVibeID';
```

#### 4.3.2 bundle-dynamic-imports: åŠ¨æ€å¯¼å…¥é‡å‹ç»„ä»¶

```tsx
// âŒ é”™è¯¯: é™æ€å¯¼å…¥å¤§å‹å›¾è¡¨åº“
import { ArchetypeWheel } from '@/skills/vibe-id/components/ArchetypeWheel';

// âœ… æ­£ç¡®: ä½¿ç”¨ next/dynamic åŠ¨æ€å¯¼å…¥
import dynamic from 'next/dynamic';

const ArchetypeWheel = dynamic(
  () => import('@/skills/vibe-id/components/ArchetypeWheel'),
  {
    loading: () => <WheelSkeleton />,
    ssr: false,  // ECharts ä¸æ”¯æŒ SSR
  }
);
```

#### 4.3.3 bundle-defer-third-party: å»¶è¿ŸåŠ è½½ç¬¬ä¸‰æ–¹è„šæœ¬

```tsx
// âŒ é”™è¯¯: åœ¨ hydration å‰åŠ è½½åˆ†æè„šæœ¬
useEffect(() => {
  initAnalytics();  // é˜»å¡ hydration
}, []);

// âœ… æ­£ç¡®: ä½¿ç”¨ requestIdleCallback å»¶è¿ŸåŠ è½½
useEffect(() => {
  if ('requestIdleCallback' in window) {
    requestIdleCallback(() => {
      initAnalytics();
    });
  } else {
    setTimeout(initAnalytics, 1000);
  }
}, []);
```

#### 4.3.4 bundle-conditional: æ¡ä»¶åŠ è½½æ¨¡å—

```tsx
// âŒ é”™è¯¯: æ€»æ˜¯åŠ è½½å¡”ç½—ç‰Œç»„ä»¶
import { TarotDeck } from '@/skills/tarot/components/TarotDeck';

function SkillPanel({ skill }) {
  return skill === 'tarot' ? <TarotDeck /> : <OtherSkill />;
}

// âœ… æ­£ç¡®: ä»…åœ¨éœ€è¦æ—¶åŠ è½½
function SkillPanel({ skill }) {
  const [TarotDeck, setTarotDeck] = useState(null);

  useEffect(() => {
    if (skill === 'tarot' && !TarotDeck) {
      import('@/skills/tarot/components/TarotDeck')
        .then(mod => setTarotDeck(() => mod.TarotDeck));
    }
  }, [skill]);

  if (skill === 'tarot') {
    return TarotDeck ? <TarotDeck /> : <TarotSkeleton />;
  }
  return <OtherSkill />;
}
```

#### 4.3.5 bundle-preload: æ‚¬åœæ—¶é¢„åŠ è½½

```tsx
// âœ… é¢„åŠ è½½ä»¥æå‡æ„ŸçŸ¥é€Ÿåº¦
function SkillNav() {
  const prefetchSkill = (skillId: string) => {
    // é¢„å–æ•°æ®
    router.prefetch(`/skills/${skillId}`);
    // é¢„åŠ è½½ç»„ä»¶
    import(`@/skills/${skillId}/components`);
  };

  return (
    <nav>
      {SKILLS.map(skill => (
        <Link
          key={skill.id}
          href={`/skills/${skill.id}`}
          onMouseEnter={() => prefetchSkill(skill.id)}
          onFocus={() => prefetchSkill(skill.id)}
        >
          {skill.name}
        </Link>
      ))}
    </nav>
  );
}
```

### 4.4 HIGH: æœåŠ¡ç«¯æ€§èƒ½ (server-*)

ä¼˜åŒ–æœåŠ¡ç«¯æ¸²æŸ“å’Œæ•°æ®è·å–å¯æ¶ˆé™¤æœåŠ¡ç«¯ç€‘å¸ƒæµå¹¶å‡å°‘å“åº”æ—¶é—´ã€‚

#### 4.4.1 server-cache-react: ä½¿ç”¨ React.cache() è¯·æ±‚çº§å»é‡

```typescript
// âŒ é”™è¯¯: åŒä¸€è¯·æ±‚å†…å¤šæ¬¡è·å–ç›¸åŒæ•°æ®
// ç»„ä»¶ A
const user = await fetchUser(userId);
// ç»„ä»¶ B
const user = await fetchUser(userId);  // é‡å¤è¯·æ±‚!

// âœ… æ­£ç¡®: ä½¿ç”¨ React.cache åŒ…è£…
import { cache } from 'react';

export const getUser = cache(async (userId: string) => {
  const res = await fetch(`/api/users/${userId}`);
  return res.json();
});

// ç»„ä»¶ A å’Œ B ç°åœ¨å…±äº«åŒä¸€ä¸ªç¼“å­˜çš„ Promise
```

#### 4.4.2 server-parallel-fetching: é‡æ„ç»„ä»¶ä»¥å¹¶è¡Œè·å–

```tsx
// âŒ é”™è¯¯: ç»„ä»¶åµŒå¥—å¯¼è‡´é¡ºåºè·å–
async function ParentComponent() {
  const user = await fetchUser();  // ç­‰å¾…
  return <ChildComponent userId={user.id} />;  // ç„¶åæ‰å¼€å§‹å­ç»„ä»¶è·å–
}

async function ChildComponent({ userId }) {
  const vibeId = await fetchVibeId(userId);  // åˆä¸€æ¬¡ç­‰å¾…
  return <VibeIDCard profile={vibeId} />;
}

// âœ… æ­£ç¡®: åœ¨çˆ¶ç»„ä»¶å¹¶è¡Œå¯åŠ¨æ‰€æœ‰è·å–
async function ParentComponent() {
  const [user, vibeId] = await Promise.all([
    fetchUser(),
    fetchVibeId(),  // ä½¿ç”¨è®¤è¯ä¸­é—´ä»¶è·å–å½“å‰ç”¨æˆ·ID
  ]);

  return (
    <>
      <UserProfile user={user} />
      <VibeIDCard profile={vibeId} />
    </>
  );
}
```

#### 4.4.3 server-serialization: æœ€å°åŒ–ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶çš„æ•°æ®

```tsx
// âŒ é”™è¯¯: ä¼ é€’æ•´ä¸ªå¤§å¯¹è±¡
async function VibeIDPage() {
  const fullProfile = await fetchFullVibeIDProfile();  // åŒ…å«å¤§é‡æ•°æ®
  return <VibeIDClient profile={fullProfile} />;  // å…¨éƒ¨åºåˆ—åŒ–åˆ°å®¢æˆ·ç«¯
}

// âœ… æ­£ç¡®: ä»…ä¼ é€’å¿…è¦æ•°æ®
async function VibeIDPage() {
  const fullProfile = await fetchFullVibeIDProfile();

  // ä»…æå–å®¢æˆ·ç«¯éœ€è¦çš„å­—æ®µ
  const clientData = {
    archetypes: fullProfile.archetypes,
    confidence: fullProfile.confidence,
    calculatedAt: fullProfile.calculatedAt,
  };

  return <VibeIDClient profile={clientData} />;
}
```

### 4.5 MEDIUM-HIGH: å®¢æˆ·ç«¯æ•°æ®è·å– (client-*)

#### 4.5.1 client-swr-dedup: ä½¿ç”¨ SWR è‡ªåŠ¨å»é‡

```tsx
// âŒ é”™è¯¯: æ‰‹åŠ¨ç®¡ç†è¯·æ±‚çŠ¶æ€ï¼Œå¯èƒ½é‡å¤è¯·æ±‚
function useVibeID(userId: string) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetch(`/api/vibe-id/${userId}`)
      .then(res => res.json())
      .then(setData)
      .finally(() => setLoading(false));
  }, [userId]);

  return { data, loading };
}

// âœ… æ­£ç¡®: SWR è‡ªåŠ¨å¤„ç†å»é‡ã€ç¼“å­˜ã€é‡éªŒè¯
import useSWR from 'swr';

function useVibeID(userId: string) {
  const { data, error, isLoading, mutate } = useSWR(
    userId ? `/api/vibe-id/${userId}` : null,
    fetcher,
    {
      dedupingInterval: 60000,  // 1åˆ†é’Ÿå†…å»é‡
      revalidateOnFocus: false,
    }
  );

  return { data, error, isLoading, refresh: mutate };
}
```

### 4.6 MEDIUM: é‡æ¸²æŸ“ä¼˜åŒ– (rerender-*)

#### 4.6.1 rerender-memo: æå–æ˜‚è´µè®¡ç®—åˆ° memo ç»„ä»¶

```tsx
// âŒ é”™è¯¯: æ¯æ¬¡çˆ¶ç»„ä»¶æ›´æ–°éƒ½é‡æ–°æ¸²æŸ“
function VibeIDDisplay({ profile, onUpdate }) {
  return (
    <div>
      <ExpensiveChart data={profile.scores} />  {/* æ˜‚è´µ! */}
      <button onClick={onUpdate}>åˆ·æ–°</button>
    </div>
  );
}

// âœ… æ­£ç¡®: memo åŒ…è£…æ˜‚è´µç»„ä»¶
const ExpensiveChart = memo(function ExpensiveChart({ data }) {
  // ä»…åœ¨ data å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“
  return <ReactECharts option={buildChartOption(data)} />;
});

function VibeIDDisplay({ profile, onUpdate }) {
  return (
    <div>
      <ExpensiveChart data={profile.scores} />
      <button onClick={onUpdate}>åˆ·æ–°</button>
    </div>
  );
}
```

#### 4.6.2 rerender-functional-setstate: ä½¿ç”¨å‡½æ•°å¼ setState åˆ›å»ºç¨³å®šå›è°ƒ

```tsx
// âŒ é”™è¯¯: æ¯æ¬¡æ¸²æŸ“åˆ›å»ºæ–°å‡½æ•°
function Counter() {
  const [count, setCount] = useState(0);

  // æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯æ–°å‡½æ•°
  const increment = () => setCount(count + 1);

  return <Button onClick={increment}>+1</Button>;
}

// âœ… æ­£ç¡®: ä½¿ç”¨å‡½æ•°å¼æ›´æ–°
function Counter() {
  const [count, setCount] = useState(0);

  // ç¨³å®šå¼•ç”¨ï¼Œä¸ä¾èµ– count
  const increment = useCallback(() => {
    setCount(prev => prev + 1);
  }, []);

  return <Button onClick={increment}>+1</Button>;
}
```

#### 4.6.3 rerender-lazy-state-init: æƒ°æ€§åˆå§‹åŒ–æ˜‚è´µçŠ¶æ€

```tsx
// âŒ é”™è¯¯: æ¯æ¬¡æ¸²æŸ“éƒ½è®¡ç®—åˆå§‹å€¼
function VibeIDEditor() {
  // computeInitialState() æ¯æ¬¡æ¸²æŸ“éƒ½è°ƒç”¨!
  const [state, setState] = useState(computeInitialState());
  return <Editor state={state} />;
}

// âœ… æ­£ç¡®: ä¼ é€’å‡½æ•°å®ç°æƒ°æ€§åˆå§‹åŒ–
function VibeIDEditor() {
  // å‡½æ•°ä»…åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶è°ƒç”¨
  const [state, setState] = useState(() => computeInitialState());
  return <Editor state={state} />;
}
```

#### 4.6.4 rerender-derived-state: è®¢é˜…æ´¾ç”Ÿå¸ƒå°”å€¼è€ŒéåŸå§‹å€¼

```tsx
// âŒ é”™è¯¯: è®¢é˜…æ•´ä¸ª profileï¼Œä»»ä½•å­—æ®µå˜åŒ–éƒ½è§¦å‘é‡æ¸²æŸ“
function ProfileBadge() {
  const profile = useVibeIDStore(state => state.profile);
  const hasVibeID = profile !== null;

  return hasVibeID ? <Badge /> : null;
}

// âœ… æ­£ç¡®: ä»…è®¢é˜…æ´¾ç”Ÿçš„å¸ƒå°”å€¼
function ProfileBadge() {
  const hasVibeID = useVibeIDStore(state => state.profile !== null);

  return hasVibeID ? <Badge /> : null;
}
```

#### 4.6.5 rerender-transitions: ä½¿ç”¨ startTransition å¤„ç†éç´§æ€¥æ›´æ–°

```tsx
// âŒ é”™è¯¯: å¤§å‹åˆ—è¡¨è¿‡æ»¤é˜»å¡è¾“å…¥
function ArchetypeFilter() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);

  const handleChange = (e) => {
    setQuery(e.target.value);
    setResults(filterArchetypes(e.target.value));  // é˜»å¡!
  };

  return (
    <input value={query} onChange={handleChange} />
  );
}

// âœ… æ­£ç¡®: ä½¿ç”¨ transition å»¶è¿Ÿéç´§æ€¥æ›´æ–°
function ArchetypeFilter() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);
  const [isPending, startTransition] = useTransition();

  const handleChange = (e) => {
    setQuery(e.target.value);  // ç´§æ€¥: ç«‹å³æ›´æ–°è¾“å…¥
    startTransition(() => {
      setResults(filterArchetypes(e.target.value));  // éç´§æ€¥: å¯ä¸­æ–­
    });
  };

  return (
    <>
      <input value={query} onChange={handleChange} />
      {isPending && <Spinner />}
      <Results items={results} />
    </>
  );
}
```

### 4.7 MEDIUM: æ¸²æŸ“æ€§èƒ½ (rendering-*)

#### 4.7.1 rendering-hoist-jsx: æå–é™æ€ JSX åˆ°ç»„ä»¶å¤–éƒ¨

```tsx
// âŒ é”™è¯¯: æ¯æ¬¡æ¸²æŸ“åˆ›å»ºæ–°çš„ JSX å¯¹è±¡
function VibeIDCard({ profile }) {
  const header = (
    <div className="header">
      <h3>ä½ çš„ VibeID</h3>
    </div>
  );

  return (
    <Card>
      {header}
      <Content profile={profile} />
    </Card>
  );
}

// âœ… æ­£ç¡®: é™æ€ JSX æå‡åˆ°å¤–éƒ¨
const CardHeader = (
  <div className="header">
    <h3>ä½ çš„ VibeID</h3>
  </div>
);

function VibeIDCard({ profile }) {
  return (
    <Card>
      {CardHeader}  {/* ç¨³å®šå¼•ç”¨ */}
      <Content profile={profile} />
    </Card>
  );
}
```

#### 4.7.2 rendering-content-visibility: ä½¿ç”¨ content-visibility ä¼˜åŒ–é•¿åˆ—è¡¨

```css
/* å¯¹äºè¶…å‡ºè§†å£çš„å†…å®¹ */
.archetype-list-item {
  content-visibility: auto;
  contain-intrinsic-size: 0 80px;  /* é¢„ä¼°é«˜åº¦ */
}
```

#### 4.7.3 rendering-conditional-render: ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦è€Œé &&

```tsx
// âŒ å¯èƒ½å‡ºé—®é¢˜: && å¯èƒ½æ¸²æŸ“ falsy å€¼
function Badge({ count }) {
  return (
    <div>
      {count && <span>{count}</span>}  {/* count=0 æ—¶æ¸²æŸ“ "0" */}
    </div>
  );
}

// âœ… æ­£ç¡®: ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦æ˜ç¡®å¤„ç†
function Badge({ count }) {
  return (
    <div>
      {count > 0 ? <span>{count}</span> : null}
    </div>
  );
}
```

### 4.8 LOW-MEDIUM: JavaScript æ€§èƒ½ (js-*)

#### 4.8.1 js-set-map-lookups: ä½¿ç”¨ Set/Map å®ç° O(1) æŸ¥æ‰¾

```typescript
// âŒ é”™è¯¯: O(n) æ•°ç»„æŸ¥æ‰¾
const selectedIds = ['explorer', 'sage', 'creator'];
const isSelected = (id) => selectedIds.includes(id);  // O(n)

// âœ… æ­£ç¡®: O(1) Set æŸ¥æ‰¾
const selectedIds = new Set(['explorer', 'sage', 'creator']);
const isSelected = (id) => selectedIds.has(id);  // O(1)
```

#### 4.8.2 js-combine-iterations: åˆå¹¶å¤šæ¬¡è¿­ä»£

```typescript
// âŒ é”™è¯¯: å¤šæ¬¡éå†æ•°ç»„
const activeArchetypes = archetypes.filter(a => a.score > 50);
const sortedArchetypes = activeArchetypes.sort((a, b) => b.score - a.score);
const topNames = sortedArchetypes.slice(0, 4).map(a => a.name);

// âœ… æ­£ç¡®: å•æ¬¡éå† + é«˜æ•ˆæ’åº
const topNames = archetypes
  .reduce((acc, a) => {
    if (a.score > 50) {
      // æ’å…¥æ’åºï¼Œä¿æŒå‰4ä¸ª
      const idx = acc.findIndex(x => x.score < a.score);
      if (idx !== -1) acc.splice(idx, 0, a);
      else if (acc.length < 4) acc.push(a);
      if (acc.length > 4) acc.pop();
    }
    return acc;
  }, [])
  .map(a => a.name);
```

#### 4.8.3 js-early-exit: æå‰è¿”å›

```typescript
// âŒ é”™è¯¯: ä¸å¿…è¦çš„åµŒå¥—
function processArchetype(archetype) {
  if (archetype) {
    if (archetype.isValid) {
      if (archetype.score > 0) {
        return calculateInsight(archetype);
      }
    }
  }
  return null;
}

// âœ… æ­£ç¡®: æå‰è¿”å›å‡å°‘åµŒå¥—
function processArchetype(archetype) {
  if (!archetype) return null;
  if (!archetype.isValid) return null;
  if (archetype.score <= 0) return null;

  return calculateInsight(archetype);
}
```

#### 4.8.4 js-cache-function-results: ç¼“å­˜å‡½æ•°ç»“æœ

```typescript
// âŒ é”™è¯¯: æ¯æ¬¡è°ƒç”¨éƒ½é‡æ–°è®¡ç®—
function getArchetypeMeta(id: ArchetypeId) {
  return ARCHETYPE_META[id];  // ç®€å•æŸ¥æ‰¾è¿˜å¥½
}

// å¯¹äºå¤æ‚è®¡ç®—ï¼Œä½¿ç”¨æ¨¡å—çº§ç¼“å­˜
const insightCache = new Map<string, Insight>();

function getInsight(archetypeId: string, dimension: string): Insight {
  const key = `${archetypeId}:${dimension}`;

  if (!insightCache.has(key)) {
    insightCache.set(key, computeInsight(archetypeId, dimension));
  }

  return insightCache.get(key)!;
}
```

### 4.9 VibeLife ç‰¹å®šä¼˜åŒ–ç­–ç•¥

åŸºäºä»¥ä¸Šè§„åˆ™ï¼ŒVibeLife å‰ç«¯åº”å®æ–½ä»¥ä¸‹å…·ä½“ä¼˜åŒ–:

#### 4.9.1 èŠå¤©æµå¤„ç†ä¼˜åŒ–

```typescript
// src/hooks/useVibeChat.ts

export function useVibeChat() {
  const [messages, setMessages] = useState<Message[]>([]);

  // ä½¿ç”¨ useCallback ç¨³å®šå›è°ƒ (rerender-functional-setstate)
  const appendMessage = useCallback((msg: Message) => {
    setMessages(prev => [...prev, msg]);
  }, []);

  // ä½¿ç”¨ startTransition å¤„ç†å¤§é‡æ–‡æœ¬æ›´æ–° (rerender-transitions)
  const handleStreamChunk = useCallback((chunk: string) => {
    startTransition(() => {
      setMessages(prev => {
        const last = prev[prev.length - 1];
        if (last?.role === 'assistant') {
          return [...prev.slice(0, -1), { ...last, content: last.content + chunk }];
        }
        return prev;
      });
    });
  }, []);

  return { messages, appendMessage, handleStreamChunk };
}
```

#### 4.9.2 å·¥å…·å¡ç‰‡åŠ¨æ€åŠ è½½

```typescript
// src/skills/CardRegistry.ts

type CardLoader = () => Promise<{ default: React.ComponentType<any> }>;

const CARD_LOADERS: Record<string, CardLoader> = {
  // æŒ‰éœ€åŠ è½½ï¼Œé¿å…åˆå§‹åŒ…ä½“ç§¯è¿‡å¤§ (bundle-dynamic-imports)
  'show_bazi_chart': () => import('@/skills/bazi/tools/show-bazi-chart'),
  'show_zodiac_chart': () => import('@/skills/zodiac/tools/show-zodiac-chart'),
  'show_vibe_id': () => import('@/skills/vibe-id/tools/show-vibe-id'),
  'show_tarot_spread': () => import('@/skills/tarot/tools/show-tarot-spread'),
};

// ç»„ä»¶ç¼“å­˜ (js-cache-function-results)
const cardCache = new Map<string, React.ComponentType<any>>();

export async function getCard(toolName: string): Promise<React.ComponentType<any> | null> {
  if (cardCache.has(toolName)) {
    return cardCache.get(toolName)!;
  }

  const loader = CARD_LOADERS[toolName];
  if (!loader) return null;

  const module = await loader();
  cardCache.set(toolName, module.default);
  return module.default;
}
```

#### 4.9.3 VibeID æ•°æ®é¢„åŠ è½½

```tsx
// åœ¨ç”¨æˆ·ç™»å½•åé¢„åŠ è½½ VibeID æ•°æ® (bundle-preload)
function useVibeIDPrefetch() {
  const { user } = useAuth();

  useEffect(() => {
    if (user?.id) {
      // é¢„çƒ­ SWR ç¼“å­˜
      preload(`/api/vibe-id/${user.id}`, fetcher);
    }
  }, [user?.id]);
}
```

---

## 5. ç»„ä»¶åº“ä¸å¡ç‰‡ç³»ç»Ÿ

### 5.1 ç»„ä»¶åº“æ¶æ„

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                    # åŸºç¡€ UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”œâ”€â”€ Card.tsx
â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”œâ”€â”€ Modal.tsx
â”‚   â”‚   â”œâ”€â”€ Skeleton.tsx
â”‚   â”‚   â”œâ”€â”€ Toast.tsx
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ layout/                # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”œâ”€â”€ BottomNav.tsx
â”‚   â”‚   â”œâ”€â”€ Container.tsx
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ chat/                  # èŠå¤©ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ChatContainer.tsx
â”‚   â”‚   â”œâ”€â”€ ChatMessage.tsx
â”‚   â”‚   â”œâ”€â”€ MessageInput.tsx
â”‚   â”‚   â”œâ”€â”€ ToolResultCard.tsx
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â””â”€â”€ shared/                # å…±äº«è£…é¥°ç»„ä»¶
â”‚       â”œâ”€â”€ BreathAura.tsx     # å‘¼å¸å…‰ç¯æ•ˆæœ
â”‚       â”œâ”€â”€ VibeGlyph.tsx      # ç¥ç§˜ç¬¦æ–‡
â”‚       â”œâ”€â”€ InsightSeal.tsx    # æ´è§å°ç« 
â”‚       â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ skills/                    # æŠ€èƒ½æ¨¡å—
â”‚   â”œâ”€â”€ bazi/
â”‚   â”‚   â”œâ”€â”€ components/        # å…«å­—ä¸“ç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ BaziChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PillarCard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ElementBalance.tsx
â”‚   â”‚   â””â”€â”€ tools/             # å·¥å…·ç»“æœå¡ç‰‡
â”‚   â”‚       â”œâ”€â”€ index.ts
â”‚   â”‚       â”œâ”€â”€ show-bazi-chart.tsx
â”‚   â”‚       â””â”€â”€ show-daily-fortune.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ zodiac/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ZodiacChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PlanetCard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ AspectLine.tsx
â”‚   â”‚   â””â”€â”€ tools/
â”‚   â”‚       â”œâ”€â”€ index.ts
â”‚   â”‚       â”œâ”€â”€ show-zodiac-chart.tsx
â”‚   â”‚       â””â”€â”€ show-transit.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ tarot/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ TarotCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ SpreadLayout.tsx
â”‚   â”‚   â”‚   â””â”€â”€ CardReveal.tsx
â”‚   â”‚   â””â”€â”€ tools/
â”‚   â”‚       â”œâ”€â”€ index.ts
â”‚   â”‚       â””â”€â”€ show-tarot-spread.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ vibe-id/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ VibeIDCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ArchetypeBadge.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ArchetypeWheel.tsx
â”‚   â”‚   â”‚   â””â”€â”€ DimensionRow.tsx
â”‚   â”‚   â””â”€â”€ tools/
â”‚   â”‚       â”œâ”€â”€ index.ts
â”‚   â”‚       â””â”€â”€ show-vibe-id.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ CardRegistry.ts        # å¡ç‰‡æ³¨å†Œè¡¨
â”‚   â””â”€â”€ initCards.ts           # å¡ç‰‡åˆå§‹åŒ–
```

### 5.2 å¡ç‰‡æ³¨å†Œç³»ç»Ÿ

#### 5.2.1 CardRegistry å®ç°

```typescript
// src/skills/CardRegistry.ts

import { ComponentType, lazy, Suspense } from 'react';

/**
 * å·¥å…·å¡ç‰‡ç»„ä»¶çš„ Props æ¥å£
 */
export interface ToolCardProps<T = unknown> {
  data: T;
  toolId: string;
  skillId?: string;
}

/**
 * å¡ç‰‡åŠ è½½å™¨ç±»å‹
 */
type CardLoader = () => Promise<{ default: ComponentType<ToolCardProps<any>> }>;

/**
 * å¡ç‰‡æ³¨å†Œè¡¨
 * ä½¿ç”¨åŠ¨æ€å¯¼å…¥å®ç°æŒ‰éœ€åŠ è½½ (Vercel: bundle-dynamic-imports)
 */
class CardRegistryClass {
  private loaders = new Map<string, CardLoader>();
  private cache = new Map<string, ComponentType<ToolCardProps<any>>>();

  /**
   * æ³¨å†Œå·¥å…·å¡ç‰‡
   */
  register(toolName: string, loader: CardLoader): void {
    this.loaders.set(toolName, loader);
  }

  /**
   * æ‰¹é‡æ³¨å†Œ
   */
  registerAll(cards: Record<string, CardLoader>): void {
    Object.entries(cards).forEach(([name, loader]) => {
      this.register(name, loader);
    });
  }

  /**
   * è·å–å¡ç‰‡ç»„ä»¶ (å¸¦ç¼“å­˜)
   */
  async getCard(toolName: string): Promise<ComponentType<ToolCardProps<any>> | null> {
    // ä¼˜å…ˆä»ç¼“å­˜è·å– (Vercel: js-cache-function-results)
    if (this.cache.has(toolName)) {
      return this.cache.get(toolName)!;
    }

    const loader = this.loaders.get(toolName);
    if (!loader) {
      console.warn(`[CardRegistry] æœªæ‰¾åˆ°å·¥å…·å¡ç‰‡: ${toolName}`);
      return null;
    }

    try {
      const module = await loader();
      this.cache.set(toolName, module.default);
      return module.default;
    } catch (error) {
      console.error(`[CardRegistry] åŠ è½½å¡ç‰‡å¤±è´¥: ${toolName}`, error);
      return null;
    }
  }

  /**
   * åˆ›å»ºæ‡’åŠ è½½ç»„ä»¶
   */
  getLazyCard(toolName: string): ComponentType<ToolCardProps<any>> | null {
    const loader = this.loaders.get(toolName);
    if (!loader) return null;

    return lazy(loader);
  }

  /**
   * é¢„åŠ è½½å¡ç‰‡ (ç”¨äºæ‚¬åœé¢„åŠ è½½)
   */
  preload(toolName: string): void {
    if (!this.cache.has(toolName)) {
      this.getCard(toolName);  // è§¦å‘åŠ è½½
    }
  }

  /**
   * æ£€æŸ¥å¡ç‰‡æ˜¯å¦å·²æ³¨å†Œ
   */
  has(toolName: string): boolean {
    return this.loaders.has(toolName);
  }

  /**
   * è·å–æ‰€æœ‰å·²æ³¨å†Œçš„å·¥å…·å
   */
  getRegisteredTools(): string[] {
    return Array.from(this.loaders.keys());
  }
}

// å•ä¾‹å¯¼å‡º
export const CardRegistry = new CardRegistryClass();
```

#### 5.2.2 å¡ç‰‡åˆå§‹åŒ–

```typescript
// src/skills/initCards.ts

import { CardRegistry } from './CardRegistry';

/**
 * åˆå§‹åŒ–æ‰€æœ‰å·¥å…·å¡ç‰‡
 * åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨ä¸€æ¬¡
 */
export function initializeCards(): void {
  CardRegistry.registerAll({
    // ========================================
    // VibeID å·¥å…·å¡ç‰‡
    // ========================================
    'show_vibe_id': () => import('./vibe-id/tools/show-vibe-id'),

    // ========================================
    // å…«å­—å·¥å…·å¡ç‰‡
    // ========================================
    'show_bazi_chart': () => import('./bazi/tools/show-bazi-chart'),
    'show_daily_fortune': () => import('./bazi/tools/show-daily-fortune'),
    'show_bazi_analysis': () => import('./bazi/tools/show-bazi-analysis'),

    // ========================================
    // æ˜Ÿç›˜å·¥å…·å¡ç‰‡
    // ========================================
    'show_zodiac_chart': () => import('./zodiac/tools/show-zodiac-chart'),
    'show_transit': () => import('./zodiac/tools/show-transit'),
    'show_lunar_phase': () => import('./zodiac/tools/show-lunar-phase'),

    // ========================================
    // å¡”ç½—å·¥å…·å¡ç‰‡
    // ========================================
    'show_tarot_spread': () => import('./tarot/tools/show-tarot-spread'),
    'show_tarot_card': () => import('./tarot/tools/show-tarot-card'),

    // ========================================
    // èŒä¸šå·¥å…·å¡ç‰‡
    // ========================================
    'show_career_analysis': () => import('./career/tools/show-career-analysis'),
  });

  console.log('[CardRegistry] å·²æ³¨å†Œå·¥å…·å¡ç‰‡:', CardRegistry.getRegisteredTools());
}
```

### 5.3 èŠå¤©ä¸­æ¸²æŸ“å·¥å…·å¡ç‰‡

```tsx
// src/components/chat/ToolResultCard.tsx

import { memo, useState, useEffect, Suspense } from 'react';
import { CardRegistry, ToolCardProps } from '@/skills/CardRegistry';
import { Card } from '@/components/ui/Card';
import { Skeleton } from '@/components/ui/Skeleton';

interface ToolResultCardProps {
  toolName: string;
  toolId: string;
  result: unknown;
  skillId?: string;
}

/**
 * å·¥å…·ç»“æœå¡ç‰‡æ¸²æŸ“å™¨
 * åŠ¨æ€åŠ è½½å¯¹åº”çš„å¡ç‰‡ç»„ä»¶
 */
export const ToolResultCard = memo(function ToolResultCard({
  toolName,
  toolId,
  result,
  skillId,
}: ToolResultCardProps) {
  const [CardComponent, setCardComponent] = useState<React.ComponentType<ToolCardProps> | null>(null);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    let cancelled = false;

    CardRegistry.getCard(toolName)
      .then(component => {
        if (!cancelled) {
          if (component) {
            setCardComponent(() => component);
          } else {
            setError(`æœªçŸ¥çš„å·¥å…·ç±»å‹: ${toolName}`);
          }
        }
      })
      .catch(err => {
        if (!cancelled) {
          setError(`åŠ è½½å¡ç‰‡å¤±è´¥: ${err.message}`);
        }
      });

    return () => {
      cancelled = true;
    };
  }, [toolName]);

  // åŠ è½½ä¸­çŠ¶æ€
  if (!CardComponent && !error) {
    return <ToolCardSkeleton />;
  }

  // é”™è¯¯çŠ¶æ€
  if (error) {
    return (
      <Card variant="outlined\" className="p-4 text-ink-500">
        <p className="text-sm">{error}</p>
        <pre className="mt-2 text-xs bg-ink-50 p-2 rounded overflow-auto">
          {JSON.stringify(result, null, 2)}
        </pre>
      </Card>
    );
  }

  // æ¸²æŸ“å¡ç‰‡
  return (
    <Suspense fallback={<ToolCardSkeleton />}>
      <CardComponent
        data={result}
        toolId={toolId}
        skillId={skillId}
      />
    </Suspense>
  );
});

/**
 * å¡ç‰‡éª¨æ¶å±
 */
function ToolCardSkeleton() {
  return (
    <Card className="p-4 space-y-3">
      <Skeleton className="h-6 w-1/3" />
      <Skeleton className="h-32 w-full" />
      <div className="flex gap-2">
        <Skeleton className="h-8 w-20" />
        <Skeleton className="h-8 w-20" />
      </div>
    </Card>
  );
}
```

### 5.4 å·¥å…·å¡ç‰‡å¼€å‘è§„èŒƒ

#### 5.4.1 å¡ç‰‡ç»„ä»¶æ¨¡æ¿

```tsx
// src/skills/{skill}/tools/{tool-name}.tsx

import { memo } from 'react';
import type { ToolCardProps } from '@/skills/CardRegistry';
import { Card } from '@/components/ui/Card';

/**
 * å·¥å…·ç»“æœæ•°æ®æ¥å£
 */
interface ToolResultData {
  // å®šä¹‰å·¥å…·è¿”å›çš„æ•°æ®ç»“æ„
  title: string;
  content: Record<string, unknown>;
}

/**
 * å·¥å…·å¡ç‰‡ç»„ä»¶
 *
 * @description åœ¨èŠå¤©ä¸­å±•ç¤ºå·¥å…·æ‰§è¡Œç»“æœ
 * @vercel-rule rerender-memo - ä½¿ç”¨ memo é˜²æ­¢ä¸å¿…è¦çš„é‡æ¸²æŸ“
 */
const ToolNameCard = memo(function ToolNameCard({
  data,
  toolId,
  skillId,
}: ToolCardProps<ToolResultData>) {
  const { title, content } = data;

  return (
    <Card variant="elevated" className="max-w-md">
      {/* å¡ç‰‡å¤´éƒ¨ */}
      <div className="flex items-center gap-2 mb-4">
        <span className="text-xl">ğŸ”®</span>
        <h3 className="font-medium text-ink-800">{title}</h3>
      </div>

      {/* å¡ç‰‡å†…å®¹ */}
      <div className="space-y-3">
        {/* æ ¹æ®æ•°æ®ç»“æ„æ¸²æŸ“å†…å®¹ */}
      </div>

      {/* å¡ç‰‡æ“ä½œ (å¯é€‰) */}
      <div className="mt-4 pt-3 border-t border-ink-100 flex gap-2">
        <button className="text-sm text-mystic-600 hover:text-mystic-700">
          æŸ¥çœ‹è¯¦æƒ…
        </button>
      </div>
    </Card>
  );
});

export default ToolNameCard;
```

#### 5.4.2 å¡ç‰‡å¼€å‘æ£€æŸ¥æ¸…å•

```markdown
## å·¥å…·å¡ç‰‡å¼€å‘æ£€æŸ¥æ¸…å•

### å¿…é¡»é¡¹
- [ ] ä½¿ç”¨ memo() åŒ…è£…ç»„ä»¶
- [ ] å®šä¹‰æ˜ç¡®çš„ TypeScript æ¥å£
- [ ] ä½¿ç”¨ default export å¯¼å‡ºç»„ä»¶
- [ ] åœ¨ CardRegistry ä¸­æ³¨å†Œ

### æ€§èƒ½ä¼˜åŒ–
- [ ] å›¾è¡¨ç»„ä»¶ä½¿ç”¨ dynamic import
- [ ] å¤§å‹æ•°æ®ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
- [ ] å›¾ç‰‡ä½¿ç”¨ next/image ä¼˜åŒ–

### æ ·å¼è§„èŒƒ
- [ ] ä½¿ç”¨è®¾è®¡ç³»ç»Ÿçš„é¢œè‰²å˜é‡
- [ ] æœ€å¤§å®½åº¦é™åˆ¶ (max-w-md æˆ– max-w-lg)
- [ ] å“åº”å¼é€‚é…ç§»åŠ¨ç«¯

### å¯è®¿é—®æ€§
- [ ] æ·»åŠ  aria-label
- [ ] æ”¯æŒé”®ç›˜å¯¼èˆª
- [ ] é¢œè‰²å¯¹æ¯”åº¦ç¬¦åˆ WCAG 2.1
```

### 5.5 å…±äº«è£…é¥°ç»„ä»¶

#### 5.5.1 BreathAura - å‘¼å¸å…‰ç¯

```tsx
// src/components/shared/BreathAura.tsx

import { memo } from 'react';
import { motion } from 'framer-motion';
import { cn } from '@/utils/cn';

interface BreathAuraProps {
  color?: string;
  size?: number;
  intensity?: 'subtle' | 'normal' | 'strong';
  className?: string;
}

const INTENSITY_CONFIG = {
  subtle: { scale: [1, 1.02, 1], opacity: [0.3, 0.4, 0.3] },
  normal: { scale: [1, 1.05, 1], opacity: [0.4, 0.6, 0.4] },
  strong: { scale: [1, 1.08, 1], opacity: [0.5, 0.8, 0.5] },
};

/**
 * å‘¼å¸å…‰ç¯æ•ˆæœ
 * ä¸ºå…ƒç´ æ·»åŠ ç¥ç§˜çš„è„‰åŠ¨å…‰æ™•
 */
export const BreathAura = memo(function BreathAura({
  color = 'rgba(138, 79, 125, 0.3)',
  size = 100,
  intensity = 'normal',
  className,
}: BreathAuraProps) {
  const config = INTENSITY_CONFIG[intensity];

  return (
    <motion.div
      className={cn('absolute rounded-full blur-xl pointer-events-none', className)}
      style={{
        width: size,
        height: size,
        background: `radial-gradient(circle, ${color} 0%, transparent 70%)`,
      }}
      animate={{
        scale: config.scale,
        opacity: config.opacity,
      }}
      transition={{
        duration: 4,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
    />
  );
});
```

#### 5.5.2 InsightSeal - æ´è§å°ç« 

```tsx
// src/components/shared/InsightSeal.tsx

import { memo } from 'react';
import { motion } from 'framer-motion';
import { cn } from '@/utils/cn';

interface InsightSealProps {
  type: 'bazi' | 'zodiac' | 'tarot' | 'vibe-id';
  size?: 'sm' | 'md' | 'lg';
  animated?: boolean;
  className?: string;
}

const SEAL_CONFIG = {
  'bazi': { icon: 'å‘½', color: 'gold' },
  'zodiac': { icon: 'æ˜Ÿ', color: 'mystic' },
  'tarot': { icon: 'å ', color: 'mystic' },
  'vibe-id': { icon: 'çµ', color: 'gold' },
};

const SIZE_CLASSES = {
  sm: 'w-8 h-8 text-sm',
  md: 'w-12 h-12 text-lg',
  lg: 'w-16 h-16 text-2xl',
};

/**
 * æ´è§å°ç« 
 * æ ‡è¯†ä¸åŒæŠ€èƒ½çš„ä¸“å±å°è®°
 */
export const InsightSeal = memo(function InsightSeal({
  type,
  size = 'md',
  animated = true,
  className,
}: InsightSealProps) {
  const config = SEAL_CONFIG[type];
  const colorClass = config.color === 'gold' ? 'text-gold-600 border-gold-300' : 'text-mystic-600 border-mystic-300';

  const seal = (
    <div
      className={cn(
        'rounded-full border-2 flex items-center justify-center',
        'bg-vellum-50 font-serif',
        SIZE_CLASSES[size],
        colorClass,
        className
      )}
    >
      {config.icon}
    </div>
  );

  if (!animated) return seal;

  return (
    <motion.div
      initial={{ scale: 0, rotate: -180 }}
      animate={{ scale: 1, rotate: 0 }}
      transition={{ type: 'spring', stiffness: 200, damping: 15 }}
    >
      {seal}
    </motion.div>
  );
});
```

### 5.6 Skeleton ç»„ä»¶ç³»ç»Ÿ

```tsx
// src/components/ui/Skeleton.tsx

import { cn } from '@/utils/cn';

interface SkeletonProps {
  className?: string;
  variant?: 'text' | 'circular' | 'rectangular';
  animation?: 'pulse' | 'wave' | 'none';
}

/**
 * éª¨æ¶å±ç»„ä»¶
 * ç”¨äºå†…å®¹åŠ è½½æ—¶çš„å ä½æ˜¾ç¤º
 */
export function Skeleton({
  className,
  variant = 'rectangular',
  animation = 'pulse',
}: SkeletonProps) {
  return (
    <div
      className={cn(
        'bg-ink-100',
        variant === 'circular' && 'rounded-full',
        variant === 'rectangular' && 'rounded-md',
        variant === 'text' && 'rounded h-4',
        animation === 'pulse' && 'animate-pulse',
        animation === 'wave' && 'animate-shimmer bg-gradient-to-r from-ink-100 via-ink-50 to-ink-100 bg-[length:200%_100%]',
        className
      )}
    />
  );
}

/**
 * å¸¸ç”¨éª¨æ¶å±æ¨¡æ¿
 */
export function VibeIDSkeleton() {
  return (
    <div className="p-4 space-y-4">
      <div className="flex justify-around">
        {[1, 2, 3, 4].map(i => (
          <div key={i} className="flex flex-col items-center gap-2">
            <Skeleton variant="circular" className="w-14 h-14" />
            <Skeleton className="h-3 w-12" />
          </div>
        ))}
      </div>
      <Skeleton className="h-24" />
    </div>
  );
}

export function ChatMessageSkeleton() {
  return (
    <div className="flex gap-3 p-4">
      <Skeleton variant="circular" className="w-10 h-10 flex-shrink-0" />
      <div className="flex-1 space-y-2">
        <Skeleton className="h-4 w-24" />
        <Skeleton className="h-4 w-full" />
        <Skeleton className="h-4 w-3/4" />
      </div>
    </div>
  );
}
```

---

## 6. API å¯¹æ¥ä¸æ•°æ®æµ

### 6.1 åç«¯ API æ¦‚è§ˆ

> **æ¥æº**: SPEC-v7.md

#### 6.1.1 æ ¸å¿ƒç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° | è®¤è¯ |
|------|------|------|------|
| `/chat/v5/stream` | POST | èŠå¤©æµå¼å“åº” | Required |
| `/skills/{id}/{action}` | POST | æŠ€èƒ½æ‰§è¡Œ | Required |
| `/tools/schema` | GET | è·å–å·¥å…· Schema | Optional |
| `/vibe-id/{user_id}` | GET | è·å– VibeID | Required |
| `/account/profile` | GET/PUT | ç”¨æˆ·èµ„æ–™ | Required |
| `/account/usage` | GET | ä½¿ç”¨ç»Ÿè®¡ | Required |
| `/commerce/products` | GET | å•†å“åˆ—è¡¨ | Optional |
| `/commerce/orders` | POST | åˆ›å»ºè®¢å• | Required |
| `/notifications/subscribe` | POST | æ¨é€è®¢é˜… | Required |

#### 6.1.2 èŠå¤©æµäº‹ä»¶ç±»å‹

```typescript
// src/types/chat.ts

/**
 * SSE æµäº‹ä»¶ç±»å‹
 */
export type StreamEventType =
  | 'text'           // æ–‡æœ¬å†…å®¹å—
  | 'tool_call'      // å·¥å…·è°ƒç”¨å¼€å§‹
  | 'tool_result'    // å·¥å…·æ‰§è¡Œç»“æœ
  | 'thinking'       // Agent æ€è€ƒè¿‡ç¨‹
  | 'error'          // é”™è¯¯ä¿¡æ¯
  | 'done';          // æµç»“æŸ

/**
 * æµäº‹ä»¶åŸºç¡€ç»“æ„
 */
export interface StreamEvent<T = unknown> {
  type: StreamEventType;
  data: T;
  timestamp: number;
}

/**
 * æ–‡æœ¬äº‹ä»¶
 */
export interface TextEvent extends StreamEvent<string> {
  type: 'text';
}

/**
 * å·¥å…·è°ƒç”¨äº‹ä»¶
 */
export interface ToolCallEvent extends StreamEvent<{
  tool_name: string;
  tool_id: string;
  arguments: Record<string, unknown>;
}> {
  type: 'tool_call';
}

/**
 * å·¥å…·ç»“æœäº‹ä»¶
 */
export interface ToolResultEvent extends StreamEvent<{
  tool_name: string;
  tool_id: string;
  result: Record<string, unknown>;
  skill_id?: string;
}> {
  type: 'tool_result';
}

/**
 * æ¶ˆæ¯ç±»å‹
 */
export interface Message {
  id: string;
  role: 'user' | 'assistant' | 'system';
  content: string;
  toolCalls?: ToolCall[];
  toolResults?: ToolResult[];
  createdAt: string;
}

export interface ToolCall {
  toolId: string;
  toolName: string;
  arguments: Record<string, unknown>;
  status: 'pending' | 'running' | 'completed' | 'error';
}

export interface ToolResult {
  toolId: string;
  toolName: string;
  result: Record<string, unknown>;
  skillId?: string;
}
```

### 6.2 API å®¢æˆ·ç«¯

```typescript
// src/services/api.ts

const API_BASE = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';

/**
 * API é”™è¯¯ç±»
 */
export class APIError extends Error {
  constructor(
    message: string,
    public status: number,
    public code?: string
  ) {
    super(message);
    this.name = 'APIError';
  }
}

/**
 * åŸºç¡€ fetch å°è£…
 */
async function baseFetch<T>(
  endpoint: string,
  options: RequestInit = {}
): Promise<T> {
  const url = `${API_BASE}${endpoint}`;

  const response = await fetch(url, {
    ...options,
    credentials: 'include',
    headers: {
      'Content-Type': 'application/json',
      ...options.headers,
    },
  });

  if (!response.ok) {
    const error = await response.json().catch(() => ({ message: 'Unknown error' }));
    throw new APIError(
      error.message || `HTTP ${response.status}`,
      response.status,
      error.code
    );
  }

  return response.json();
}

/**
 * API å®¢æˆ·ç«¯
 */
export const api = {
  get: <T>(endpoint: string) => baseFetch<T>(endpoint, { method: 'GET' }),
  post: <T>(endpoint: string, body: unknown) =>
    baseFetch<T>(endpoint, { method: 'POST', body: JSON.stringify(body) }),
  put: <T>(endpoint: string, body: unknown) =>
    baseFetch<T>(endpoint, { method: 'PUT', body: JSON.stringify(body) }),
  delete: <T>(endpoint: string) => baseFetch<T>(endpoint, { method: 'DELETE' }),
};
```

### 6.3 èŠå¤©æµå¤„ç†

```typescript
// src/hooks/useVibeChat.ts

import { useState, useCallback, useRef } from 'react';
import type { Message, StreamEvent, ToolCall, ToolResult } from '@/types/chat';

interface UseChatOptions {
  skillId?: string;
  onToolCall?: (toolCall: ToolCall) => void;
  onToolResult?: (result: ToolResult) => void;
  onError?: (error: Error) => void;
}

interface UseChatReturn {
  messages: Message[];
  isLoading: boolean;
  error: Error | null;
  sendMessage: (content: string) => Promise<void>;
  clearMessages: () => void;
  stopGeneration: () => void;
}

const API_BASE = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';

export function useVibeChat(options: UseChatOptions = {}): UseChatReturn {
  const { skillId, onToolCall, onToolResult, onError } = options;

  const [messages, setMessages] = useState<Message[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<Error | null>(null);

  const abortControllerRef = useRef<AbortController | null>(null);

  /**
   * å‘é€æ¶ˆæ¯å¹¶å¤„ç†æµå¼å“åº”
   */
  const sendMessage = useCallback(async (content: string) => {
    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    const userMessage: Message = {
      id: crypto.randomUUID(),
      role: 'user',
      content,
      createdAt: new Date().toISOString(),
    };

    setMessages(prev => [...prev, userMessage]);
    setIsLoading(true);
    setError(null);

    // åˆ›å»ºåŠ©æ‰‹æ¶ˆæ¯å ä½
    const assistantMessageId = crypto.randomUUID();
    const assistantMessage: Message = {
      id: assistantMessageId,
      role: 'assistant',
      content: '',
      toolCalls: [],
      toolResults: [],
      createdAt: new Date().toISOString(),
    };

    setMessages(prev => [...prev, assistantMessage]);

    // åˆ›å»º AbortController ç”¨äºå–æ¶ˆ
    abortControllerRef.current = new AbortController();

    try {
      const response = await fetch(`${API_BASE}/chat/v5/stream`, {
        method: 'POST',
        credentials: 'include',
        headers: { 'Content-Type': 'application/json' },
        signal: abortControllerRef.current.signal,
        body: JSON.stringify({
          messages: [...messages, userMessage].map(m => ({
            role: m.role,
            content: m.content,
          })),
          skill_id: skillId,
        }),
      });

      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }

      const reader = response.body?.getReader();
      if (!reader) throw new Error('No response body');

      const decoder = new TextDecoder();
      let buffer = '';

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        buffer += decoder.decode(value, { stream: true });

        // è§£æ SSE äº‹ä»¶
        const lines = buffer.split('\n');
        buffer = lines.pop() || '';  // ä¿ç•™æœªå®Œæˆçš„è¡Œ

        for (const line of lines) {
          if (!line.startsWith('data: ')) continue;

          const data = line.slice(6);
          if (data === '[DONE]') continue;

          try {
            const event: StreamEvent = JSON.parse(data);
            handleStreamEvent(event, assistantMessageId);
          } catch {
            // å¿½ç•¥è§£æé”™è¯¯
          }
        }
      }
    } catch (err) {
      if (err instanceof Error && err.name !== 'AbortError') {
        setError(err);
        onError?.(err);
      }
    } finally {
      setIsLoading(false);
      abortControllerRef.current = null;
    }
  }, [messages, skillId, onToolCall, onToolResult, onError]);

  /**
   * å¤„ç†æµäº‹ä»¶
   */
  const handleStreamEvent = useCallback((
    event: StreamEvent,
    messageId: string
  ) => {
    switch (event.type) {
      case 'text':
        // ä½¿ç”¨ startTransition å¤„ç†æ–‡æœ¬æ›´æ–° (Vercel: rerender-transitions)
        setMessages(prev => prev.map(m =>
          m.id === messageId
            ? { ...m, content: m.content + (event.data as string) }
            : m
        ));
        break;

      case 'tool_call':
        const toolCallData = event.data as ToolCall;
        setMessages(prev => prev.map(m =>
          m.id === messageId
            ? { ...m, toolCalls: [...(m.toolCalls || []), { ...toolCallData, status: 'running' }] }
            : m
        ));
        onToolCall?.(toolCallData);
        break;

      case 'tool_result':
        const toolResultData = event.data as ToolResult;
        setMessages(prev => prev.map(m =>
          m.id === messageId
            ? { ...m, toolResults: [...(m.toolResults || []), toolResultData] }
            : m
        ));
        onToolResult?.(toolResultData);
        break;

      case 'error':
        setError(new Error(event.data as string));
        break;
    }
  }, [onToolCall, onToolResult]);

  /**
   * æ¸…ç©ºæ¶ˆæ¯
   */
  const clearMessages = useCallback(() => {
    setMessages([]);
    setError(null);
  }, []);

  /**
   * åœæ­¢ç”Ÿæˆ
   */
  const stopGeneration = useCallback(() => {
    abortControllerRef.current?.abort();
    setIsLoading(false);
  }, []);

  return {
    messages,
    isLoading,
    error,
    sendMessage,
    clearMessages,
    stopGeneration,
  };
}
```

### 6.4 æ•°æ®è·å– Hooks

#### 6.4.1 é€šç”¨ SWR é…ç½®

```typescript
// src/services/swr-config.ts

import { SWRConfiguration } from 'swr';

/**
 * å…¨å±€ SWR é…ç½®
 * åº”ç”¨ Vercel æœ€ä½³å®è·µ
 */
export const swrConfig: SWRConfiguration = {
  // å»é‡é—´éš” (client-swr-dedup)
  dedupingInterval: 60000,

  // ç¦ç”¨èšç„¦æ—¶è‡ªåŠ¨é‡éªŒè¯ (é¿å…ä¸å¿…è¦çš„è¯·æ±‚)
  revalidateOnFocus: false,

  // ç½‘ç»œæ¢å¤æ—¶é‡éªŒè¯
  revalidateOnReconnect: true,

  // é”™è¯¯é‡è¯•é…ç½®
  errorRetryCount: 3,
  errorRetryInterval: 1000,

  // è‡ªå®šä¹‰ fetcher
  fetcher: async (url: string) => {
    const res = await fetch(url, { credentials: 'include' });
    if (!res.ok) {
      const error = new Error('Failed to fetch');
      throw error;
    }
    return res.json();
  },
};
```

#### 6.4.2 VibeID Hook

```typescript
// src/skills/vibe-id/hooks/useVibeID.ts

import useSWR from 'swr';
import type { VibeIDProfile } from '@/types/vibe-id';

const API_BASE = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';

interface UseVibeIDOptions {
  userId?: string;
  enabled?: boolean;
}

export function useVibeID({ userId, enabled = true }: UseVibeIDOptions = {}) {
  const { data, error, isLoading, mutate } = useSWR<VibeIDProfile>(
    enabled && userId ? `${API_BASE}/vibe-id/${userId}` : null,
    {
      dedupingInterval: 300000,  // 5åˆ†é’Ÿå»é‡
      revalidateOnFocus: false,
    }
  );

  return {
    profile: data,
    isLoading,
    error,
    refresh: mutate,
  };
}
```

#### 6.4.3 å·¥å…· Schema Hook

```typescript
// src/hooks/useToolSchema.ts

import useSWR from 'swr';

const API_BASE = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';

interface ToolSchema {
  name: string;
  description: string;
  parameters: {
    type: string;
    properties: Record<string, unknown>;
    required?: string[];
  };
}

interface UseToolSchemaReturn {
  schemas: Record<string, ToolSchema> | undefined;
  isLoading: boolean;
  error: Error | undefined;
}

/**
 * è·å–å·¥å…· Schema
 * ç”¨äºå‰ç«¯åŠ¨æ€æ¸²æŸ“å·¥å…·å¡ç‰‡
 */
export function useToolSchema(): UseToolSchemaReturn {
  const { data, error, isLoading } = useSWR<Record<string, ToolSchema>>(
    `${API_BASE}/tools/schema`,
    {
      dedupingInterval: 3600000,  // 1å°æ—¶ç¼“å­˜
      revalidateOnFocus: false,
      revalidateOnReconnect: false,
    }
  );

  return {
    schemas: data,
    isLoading,
    error,
  };
}
```

### 6.5 çŠ¶æ€ç®¡ç†

#### 6.5.1 Zustand Store ç»“æ„

```typescript
// src/stores/userStore.ts

import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface User {
  id: string;
  name: string;
  email: string;
  avatar?: string;
}

interface UserState {
  user: User | null;
  isAuthenticated: boolean;

  // Actions
  setUser: (user: User) => void;
  logout: () => void;
}

export const useUserStore = create<UserState>()(
  persist(
    (set) => ({
      user: null,
      isAuthenticated: false,

      setUser: (user) => set({ user, isAuthenticated: true }),
      logout: () => set({ user: null, isAuthenticated: false }),
    }),
    {
      name: 'user-storage',
      partialize: (state) => ({ user: state.user }),  // ä»…æŒä¹…åŒ– user
    }
  )
);
```

#### 6.5.2 èŠå¤© Store

```typescript
// src/stores/chatStore.ts

import { create } from 'zustand';
import type { Message } from '@/types/chat';

interface ChatState {
  // çŠ¶æ€
  currentSessionId: string | null;
  sessions: Record<string, Message[]>;

  // Actions
  setCurrentSession: (sessionId: string) => void;
  addMessage: (sessionId: string, message: Message) => void;
  updateMessage: (sessionId: string, messageId: string, updates: Partial<Message>) => void;
  clearSession: (sessionId: string) => void;
}

export const useChatStore = create<ChatState>((set) => ({
  currentSessionId: null,
  sessions: {},

  setCurrentSession: (sessionId) => set({ currentSessionId: sessionId }),

  addMessage: (sessionId, message) => set((state) => ({
    sessions: {
      ...state.sessions,
      [sessionId]: [...(state.sessions[sessionId] || []), message],
    },
  })),

  updateMessage: (sessionId, messageId, updates) => set((state) => ({
    sessions: {
      ...state.sessions,
      [sessionId]: (state.sessions[sessionId] || []).map((m) =>
        m.id === messageId ? { ...m, ...updates } : m
      ),
    },
  })),

  clearSession: (sessionId) => set((state) => {
    const { [sessionId]: _, ...rest } = state.sessions;
    return { sessions: rest };
  }),
}));
```

### 6.6 æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ç”¨æˆ·æ“ä½œ                                    â”‚
â”‚                          (è¾“å…¥æ¶ˆæ¯/ç‚¹å‡»æŒ‰é’®)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           React ç»„ä»¶å±‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ChatContainer                                                   â”‚   â”‚
â”‚  â”‚  â”œâ”€ è°ƒç”¨ useVibeChat().sendMessage()                            â”‚   â”‚
â”‚  â”‚  â””â”€ æ¸²æŸ“ messages + ToolResultCard                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     useVibeChat       â”‚ â”‚   useChatStore  â”‚ â”‚       SWR Cache         â”‚
â”‚  â”œâ”€ ç®¡ç†æµçŠ¶æ€        â”‚ â”‚  â”œâ”€ ä¼šè¯çŠ¶æ€    â”‚ â”‚  â”œâ”€ VibeID Profile      â”‚
â”‚  â”œâ”€ å¤„ç† SSE äº‹ä»¶     â”‚ â”‚  â””â”€ æ¶ˆæ¯å†å²    â”‚ â”‚  â”œâ”€ Tool Schemas        â”‚
â”‚  â””â”€ æ›´æ–°æ¶ˆæ¯          â”‚ â”‚                 â”‚ â”‚  â””â”€ ç”¨æˆ·æ•°æ®            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           API è°ƒç”¨å±‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  fetch('/chat/v5/stream', { ... })                              â”‚   â”‚
â”‚  â”‚  â”œâ”€ SSE æµ                                                       â”‚   â”‚
â”‚  â”‚  â””â”€ äº‹ä»¶: text | tool_call | tool_result | done                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           åç«¯ V7 API                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  CoreAgent (Agentic Loop)                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€ SkillServiceRegistry                                         â”‚   â”‚
â”‚  â”‚  â”œâ”€ ToolRegistry                                                 â”‚   â”‚
â”‚  â”‚  â””â”€ KnowledgeStore (Qdrant)                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. å®æ–½è®¡åˆ’ä¸éªŒè¯

### 7.1 å®æ–½é˜¶æ®µ

#### é˜¶æ®µä¸€ï¼šåŸºç¡€æ¶æ„ (Phase 1)

**ç›®æ ‡**: æ­å»ºæ ¸å¿ƒåŸºç¡€è®¾æ–½å’Œè®¾è®¡ç³»ç»Ÿ

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | ä¾èµ– |
|------|--------|------|
| é¡¹ç›®åˆå§‹åŒ– (Next.js 14 + TypeScript) | P0 | - |
| è®¾è®¡ç³»ç»Ÿ CSS å˜é‡é…ç½® | P0 | é¡¹ç›®åˆå§‹åŒ– |
| Tailwind é…ç½®æ‰©å±• | P0 | è®¾è®¡ç³»ç»Ÿ |
| åŸºç¡€ UI ç»„ä»¶ (Button, Card, Input) | P0 | Tailwind |
| API å®¢æˆ·ç«¯å°è£… | P0 | é¡¹ç›®åˆå§‹åŒ– |
| SWR å…¨å±€é…ç½® | P1 | API å®¢æˆ·ç«¯ |
| Zustand Store ç»“æ„ | P1 | é¡¹ç›®åˆå§‹åŒ– |

**éªŒæ”¶æ ‡å‡†**:
- [ ] `npm run build` æˆåŠŸ
- [ ] è®¾è®¡ç³»ç»Ÿé¢œè‰²åœ¨ Storybook ä¸­æ­£ç¡®å±•ç¤º
- [ ] API å®¢æˆ·ç«¯èƒ½æ­£ç¡®å¤„ç†é”™è¯¯
- [ ] TypeScript ä¸¥æ ¼æ¨¡å¼æ— æŠ¥é”™

#### é˜¶æ®µäºŒï¼šæ ¸å¿ƒåŠŸèƒ½ (Phase 2)

**ç›®æ ‡**: å®ç°èŠå¤©æµå’Œå·¥å…·å¡ç‰‡ç³»ç»Ÿ

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | ä¾èµ– |
|------|--------|------|
| useVibeChat Hook | P0 | API å®¢æˆ·ç«¯ |
| ChatContainer ç»„ä»¶ | P0 | useVibeChat |
| ChatMessage ç»„ä»¶ | P0 | åŸºç¡€ UI |
| CardRegistry å®ç° | P0 | - |
| ToolResultCard æ¸²æŸ“å™¨ | P0 | CardRegistry |
| Skeleton ç»„ä»¶ç³»ç»Ÿ | P1 | åŸºç¡€ UI |
| æ¶ˆæ¯è¾“å…¥ç»„ä»¶ | P1 | åŸºç¡€ UI |

**éªŒæ”¶æ ‡å‡†**:
- [ ] èƒ½ä¸åç«¯å»ºç«‹ SSE è¿æ¥
- [ ] æ–‡æœ¬æµå¼æ˜¾ç¤ºæ­£å¸¸
- [ ] å·¥å…·è°ƒç”¨äº‹ä»¶æ­£ç¡®å¤„ç†
- [ ] å·¥å…·å¡ç‰‡åŠ¨æ€åŠ è½½æˆåŠŸ

#### é˜¶æ®µä¸‰ï¼šVibeID æ¨¡å— (Phase 3)

**ç›®æ ‡**: å®Œæ•´å®ç°å››ç»´åŸå‹ç³»ç»Ÿ

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | ä¾èµ– |
|------|--------|------|
| VibeID TypeScript ç±»å‹å®šä¹‰ | P0 | - |
| ARCHETYPE_META å¸¸é‡ | P0 | ç±»å‹å®šä¹‰ |
| ArchetypeBadge ç»„ä»¶ | P0 | è®¾è®¡ç³»ç»Ÿ |
| DimensionRow ç»„ä»¶ | P0 | ArchetypeBadge |
| VibeIDCard ç»„ä»¶ | P0 | DimensionRow |
| ArchetypeWheel å›¾è¡¨ | P1 | ECharts |
| useVibeID Hook | P1 | SWR |
| show_vibe_id å·¥å…·å¡ç‰‡ | P0 | VibeIDCard, CardRegistry |

**éªŒæ”¶æ ‡å‡†**:
- [ ] 12 ä¸ªåŸå‹æ­£ç¡®å±•ç¤º
- [ ] å››ç»´å¸ƒå±€æ¸…æ™°
- [ ] é›·è¾¾å›¾æ•°æ®å‡†ç¡®
- [ ] å¡ç‰‡åœ¨èŠå¤©ä¸­æ­£ç¡®æ¸²æŸ“

#### é˜¶æ®µå››ï¼šæŠ€èƒ½å¡ç‰‡ (Phase 4)

**ç›®æ ‡**: å®ç°å„æŠ€èƒ½çš„å·¥å…·å¡ç‰‡

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | ä¾èµ– |
|------|--------|------|
| å…«å­—å›¾è¡¨ç»„ä»¶ | P1 | ECharts |
| show_bazi_chart å¡ç‰‡ | P1 | CardRegistry |
| æ˜Ÿç›˜å›¾è¡¨ç»„ä»¶ | P1 | ECharts |
| show_zodiac_chart å¡ç‰‡ | P1 | CardRegistry |
| å¡”ç½—ç‰Œç»„ä»¶ | P2 | åŠ¨ç”»ç³»ç»Ÿ |
| show_tarot_spread å¡ç‰‡ | P2 | CardRegistry |
| å¡ç‰‡æ³¨å†Œåˆå§‹åŒ– | P0 | æ‰€æœ‰å¡ç‰‡ |

**éªŒæ”¶æ ‡å‡†**:
- [ ] å„æŠ€èƒ½å¡ç‰‡æ­£ç¡®æ¸²æŸ“
- [ ] å›¾è¡¨äº¤äº’æµç•…
- [ ] åŠ¨æ€å¯¼å…¥æ­£å¸¸å·¥ä½œ
- [ ] ç§»åŠ¨ç«¯é€‚é…è‰¯å¥½

#### é˜¶æ®µäº”ï¼šæ€§èƒ½ä¼˜åŒ– (Phase 5)

**ç›®æ ‡**: åº”ç”¨ Vercel æœ€ä½³å®è·µ

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | ä¾èµ– |
|------|--------|------|
| Bundle åˆ†æå’Œä¼˜åŒ– | P0 | Phase 4 å®Œæˆ |
| åŠ¨æ€å¯¼å…¥é‡å‹ç»„ä»¶ | P0 | Bundle åˆ†æ |
| SWR å»é‡é…ç½®ä¼˜åŒ– | P1 | - |
| React.memo åº”ç”¨ | P1 | - |
| è™šæ‹Ÿæ»šåŠ¨ (é•¿åˆ—è¡¨) | P2 | - |
| é¢„åŠ è½½ç­–ç•¥å®ç° | P2 | - |

**éªŒæ”¶æ ‡å‡†**:
- [ ] åˆå§‹åŒ…ä½“ç§¯ < 200KB (gzipped)
- [ ] LCP < 2.5s
- [ ] FID < 100ms
- [ ] CLS < 0.1

### 7.2 æ€§èƒ½éªŒè¯æŒ‡æ ‡

#### 7.2.1 Core Web Vitals ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|------|--------|----------|
| **LCP** (Largest Contentful Paint) | < 2.5s | Lighthouse |
| **FID** (First Input Delay) | < 100ms | Web Vitals |
| **CLS** (Cumulative Layout Shift) | < 0.1 | Lighthouse |
| **TTFB** (Time to First Byte) | < 800ms | Chrome DevTools |
| **TTI** (Time to Interactive) | < 3.8s | Lighthouse |

#### 7.2.2 åŒ…ä½“ç§¯ç›®æ ‡

| èµ„æº | ç›®æ ‡ (gzipped) |
|------|----------------|
| åˆå§‹ JS Bundle | < 200KB |
| åˆå§‹ CSS | < 50KB |
| é¦–å±æ€»èµ„æº | < 500KB |
| å„æŠ€èƒ½æ¨¡å— | < 80KB each |

#### 7.2.3 è¿è¡Œæ—¶æ€§èƒ½

| æŒ‡æ ‡ | ç›®æ ‡ |
|------|------|
| èŠå¤©æ¶ˆæ¯æ¸²æŸ“ | < 16ms/å¸§ |
| å·¥å…·å¡ç‰‡åŠ è½½ | < 200ms |
| å›¾è¡¨æ¸²æŸ“ | < 500ms |
| åˆ—è¡¨æ»šåŠ¨ | 60fps |

### 7.3 æµ‹è¯•ç­–ç•¥

#### 7.3.1 å•å…ƒæµ‹è¯•

```typescript
// ç¤ºä¾‹ï¼šVibeID ç±»å‹æµ‹è¯•
// src/types/__tests__/vibe-id.test.ts

import { describe, it, expect } from 'vitest';
import type { ArchetypeId, VibeIDProfile } from '../vibe-id';
import { ARCHETYPE_META, getArchetypeMeta } from '@/skills/vibe-id/constants/archetypes';

describe('VibeID Types', () => {
  it('æ‰€æœ‰ 12 ä¸ªåŸå‹éƒ½æœ‰å…ƒæ•°æ®', () => {
    const archetypeIds: ArchetypeId[] = [
      'innocent', 'explorer', 'sage', 'hero', 'outlaw', 'magician',
      'regular', 'lover', 'jester', 'caregiver', 'creator', 'ruler'
    ];

    archetypeIds.forEach(id => {
      const meta = getArchetypeMeta(id);
      expect(meta).toBeDefined();
      expect(meta.name).toBeTruthy();
      expect(meta.nameCn).toBeTruthy();
      expect(meta.emoji).toBeTruthy();
    });
  });

  it('åŸå‹å…ƒæ•°æ®åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ', () => {
    Object.values(ARCHETYPE_META).forEach(meta => {
      expect(meta.id).toBeTruthy();
      expect(meta.color).toMatch(/^#[0-9A-Fa-f]{6}$/);
      expect(meta.slogan).toBeTruthy();
      expect(meta.superpower).toBeTruthy();
      expect(meta.growthPoints).toHaveLength(2);
    });
  });
});
```

#### 7.3.2 ç»„ä»¶æµ‹è¯•

```typescript
// ç¤ºä¾‹ï¼šArchetypeBadge ç»„ä»¶æµ‹è¯•
// src/skills/vibe-id/components/__tests__/ArchetypeBadge.test.tsx

import { render, screen } from '@testing-library/react';
import { describe, it, expect } from 'vitest';
import { ArchetypeBadge } from '../ArchetypeBadge';

describe('ArchetypeBadge', () => {
  it('æ¸²æŸ“æ­£ç¡®çš„ emoji', () => {
    render(<ArchetypeBadge archetypeId="explorer" />);
    expect(screen.getByRole('img', { name: 'Explorer' })).toHaveTextContent('ğŸ§­');
  });

  it('æ˜¾ç¤ºç»´åº¦æ ‡ç­¾', () => {
    render(<ArchetypeBadge archetypeId="sage" dimension="core" showDimension />);
    expect(screen.getByText('æ ¸å¿ƒ')).toBeInTheDocument();
  });

  it('æ˜¾ç¤ºåŸå‹åç§°', () => {
    render(<ArchetypeBadge archetypeId="hero" showLabel />);
    expect(screen.getByText('è‹±é›„')).toBeInTheDocument();
  });
});
```

#### 7.3.3 é›†æˆæµ‹è¯•

```typescript
// ç¤ºä¾‹ï¼šèŠå¤©æµé›†æˆæµ‹è¯•
// src/hooks/__tests__/useVibeChat.integration.test.ts

import { renderHook, act, waitFor } from '@testing-library/react';
import { describe, it, expect, vi } from 'vitest';
import { useVibeChat } from '../useVibeChat';

describe('useVibeChat Integration', () => {
  it('å¤„ç†å®Œæ•´çš„èŠå¤©æµç¨‹', async () => {
    const { result } = renderHook(() => useVibeChat());

    // å‘é€æ¶ˆæ¯
    act(() => {
      result.current.sendMessage('å¸®æˆ‘çœ‹çœ‹æˆ‘çš„ VibeID');
    });

    // ç­‰å¾…å“åº”
    await waitFor(() => {
      expect(result.current.messages).toHaveLength(2);
    });

    // éªŒè¯æ¶ˆæ¯ç»“æ„
    expect(result.current.messages[0].role).toBe('user');
    expect(result.current.messages[1].role).toBe('assistant');
  });

  it('æ­£ç¡®å¤„ç†å·¥å…·è°ƒç”¨', async () => {
    const onToolCall = vi.fn();
    const { result } = renderHook(() => useVibeChat({ onToolCall }));

    act(() => {
      result.current.sendMessage('æ˜¾ç¤ºæˆ‘çš„ VibeID');
    });

    await waitFor(() => {
      expect(onToolCall).toHaveBeenCalledWith(
        expect.objectContaining({ toolName: 'show_vibe_id' })
      );
    });
  });
});
```

#### 7.3.4 E2E æµ‹è¯•

```typescript
// ç¤ºä¾‹ï¼šPlaywright E2E æµ‹è¯•
// e2e/vibe-id.spec.ts

import { test, expect } from '@playwright/test';

test.describe('VibeID åŠŸèƒ½', () => {
  test.beforeEach(async ({ page }) => {
    // ç™»å½•
    await page.goto('/login');
    await page.fill('[name="email"]', 'test@example.com');
    await page.fill('[name="password"]', 'password');
    await page.click('button[type="submit"]');
    await page.waitForURL('/');
  });

  test('æ˜¾ç¤º VibeID å¡ç‰‡', async ({ page }) => {
    await page.goto('/chat');

    // è¾“å…¥æ¶ˆæ¯
    await page.fill('[data-testid="message-input"]', 'æ˜¾ç¤ºæˆ‘çš„ VibeID');
    await page.click('[data-testid="send-button"]');

    // ç­‰å¾…å¡ç‰‡å‡ºç°
    const card = await page.waitForSelector('[data-testid="vibe-id-card"]');
    expect(card).toBeTruthy();

    // éªŒè¯å››ä¸ªç»´åº¦
    const badges = await page.$$('[data-testid="archetype-badge"]');
    expect(badges).toHaveLength(4);
  });

  test('åŸå‹è¯¦æƒ…äº¤äº’', async ({ page }) => {
    await page.goto('/vibe-id');

    // ç‚¹å‡»ç»´åº¦è¡Œ
    await page.click('[data-testid="dimension-row-core"]');

    // éªŒè¯å±•å¼€å†…å®¹
    const expanded = await page.waitForSelector('[data-testid="dimension-expanded"]');
    expect(expanded).toBeTruthy();
  });
});
```

### 7.4 éƒ¨ç½²æ£€æŸ¥æ¸…å•

#### 7.4.1 é¢„å‘å¸ƒæ£€æŸ¥

```markdown
## é¢„å‘å¸ƒæ£€æŸ¥æ¸…å•

### æ„å»ºéªŒè¯
- [ ] `npm run build` æ— é”™è¯¯
- [ ] `npm run type-check` é€šè¿‡
- [ ] `npm run lint` æ— é”™è¯¯
- [ ] `npm run test` å…¨éƒ¨é€šè¿‡

### æ€§èƒ½éªŒè¯
- [ ] Lighthouse åˆ†æ•° > 90
- [ ] Bundle åˆ†ææ— å¼‚å¸¸å¤§ä¾èµ–
- [ ] é¦–å±åŠ è½½ < 3s (3G)

### åŠŸèƒ½éªŒè¯
- [ ] èŠå¤©æµæ­£å¸¸å·¥ä½œ
- [ ] æ‰€æœ‰å·¥å…·å¡ç‰‡æ¸²æŸ“æ­£ç¡®
- [ ] VibeID å®Œæ•´æ˜¾ç¤º
- [ ] ç§»åŠ¨ç«¯é€‚é…æ­£å¸¸

### å®‰å…¨æ£€æŸ¥
- [ ] æ— æ•æ„Ÿä¿¡æ¯æ³„éœ²
- [ ] API è°ƒç”¨æ­£ç¡®å¤„ç†è®¤è¯
- [ ] CORS é…ç½®æ­£ç¡®
```

#### 7.4.2 ç›‘æ§é…ç½®

```typescript
// src/utils/monitoring.ts

import { getCLS, getFID, getLCP, getFCP, getTTFB } from 'web-vitals';

/**
 * åˆå§‹åŒ–æ€§èƒ½ç›‘æ§
 */
export function initMonitoring() {
  // Core Web Vitals
  getCLS(metric => reportMetric('CLS', metric));
  getFID(metric => reportMetric('FID', metric));
  getLCP(metric => reportMetric('LCP', metric));
  getFCP(metric => reportMetric('FCP', metric));
  getTTFB(metric => reportMetric('TTFB', metric));
}

function reportMetric(name: string, metric: any) {
  // å‘é€åˆ°ç›‘æ§æœåŠ¡
  if (process.env.NODE_ENV === 'production') {
    fetch('/api/metrics', {
      method: 'POST',
      body: JSON.stringify({
        name,
        value: metric.value,
        id: metric.id,
        page: window.location.pathname,
      }),
    });
  }

  // å¼€å‘ç¯å¢ƒæ‰“å°
  console.log(`[Metric] ${name}:`, metric.value);
}
```

---

## é™„å½•

### A. Vercel 45 è§„åˆ™é€ŸæŸ¥è¡¨

| è§„åˆ™ID | ç±»åˆ« | ç®€è¿° |
|--------|------|------|
| `async-parallel` | æ¶ˆé™¤ç€‘å¸ƒæµ | Promise.all å¹¶è¡Œæ‰§è¡Œ |
| `async-defer-await` | æ¶ˆé™¤ç€‘å¸ƒæµ | å»¶è¿Ÿ await åˆ°ä½¿ç”¨åˆ†æ”¯ |
| `async-suspense-boundaries` | æ¶ˆé™¤ç€‘å¸ƒæµ | Suspense æµå¼ä¼ è¾“ |
| `bundle-barrel-imports` | åŒ…ä½“ç§¯ | é¿å…æ¡¶æ–‡ä»¶å¯¼å…¥ |
| `bundle-dynamic-imports` | åŒ…ä½“ç§¯ | next/dynamic æ‡’åŠ è½½ |
| `bundle-defer-third-party` | åŒ…ä½“ç§¯ | å»¶è¿ŸåŠ è½½ç¬¬ä¸‰æ–¹è„šæœ¬ |
| `server-cache-react` | æœåŠ¡ç«¯ | React.cache å»é‡ |
| `server-serialization` | æœåŠ¡ç«¯ | æœ€å°åŒ–å®¢æˆ·ç«¯æ•°æ® |
| `client-swr-dedup` | å®¢æˆ·ç«¯ | SWR è‡ªåŠ¨å»é‡ |
| `rerender-memo` | é‡æ¸²æŸ“ | memo åŒ…è£…æ˜‚è´µç»„ä»¶ |
| `rerender-functional-setstate` | é‡æ¸²æŸ“ | å‡½æ•°å¼ setState |
| `rerender-transitions` | é‡æ¸²æŸ“ | startTransition |
| `rendering-hoist-jsx` | æ¸²æŸ“ | æå‡é™æ€ JSX |
| `js-set-map-lookups` | JSæ€§èƒ½ | Set/Map O(1) æŸ¥æ‰¾ |

### B. æ–‡ä»¶å‘½åçº¦å®š

| ç±»å‹ | çº¦å®š | ç¤ºä¾‹ |
|------|------|------|
| ç»„ä»¶ | PascalCase | `VibeIDCard.tsx` |
| Hook | camelCase + useå‰ç¼€ | `useVibeID.ts` |
| å·¥å…·å¡ç‰‡ | kebab-case | `show-vibe-id.tsx` |
| ç±»å‹æ–‡ä»¶ | kebab-case | `vibe-id.ts` |
| å¸¸é‡ | kebab-case | `archetypes.ts` |
| æ ·å¼ | kebab-case | `archetype-styles.ts` |

### C. å‚è€ƒèµ„æº

- [VibeIDè®¾è®¡-v5.md](../prd/VibeID/VibeIDè®¾è®¡-v5.md) - å››ç»´åŸå‹ç³»ç»Ÿè®¾è®¡
- [SPEC-v7.md](./SPEC-v7.md) - åç«¯ API æ¶æ„
- [Vercel React Best Practices](/.claude/skills/react-best-practices/AGENTS.md) - 45æ¡æ€§èƒ½è§„åˆ™
- [Next.js 14 æ–‡æ¡£](https://nextjs.org/docs)
- [SWR æ–‡æ¡£](https://swr.vercel.app)
- [Zustand æ–‡æ¡£](https://zustand-demo.pmnd.rs)

---

> **æ–‡æ¡£ç‰ˆæœ¬**: 7.0
> **æœ€åæ›´æ–°**: 2026-01-16
> **ç»´æŠ¤è€…**: AI Agent
> **çŠ¶æ€**: Draft

