  vibe_users 表迁移后还剩什么？                                                                                                                  
                                                                                                                                                 
  迁移前 vibe_users                    迁移后 vibe_users                                                                                         
  ─────────────────────               ─────────────────────                                                                                      
  id (UUID PK)          ───────────►  id (UUID PK)         ✅ 保留（外键依赖）                                                                   
  vibe_id               ───────────►  vibe_id              ✅ 保留（唯一标识）                                                                   
  display_name          ──► unified   display_name         ❓ 可移除                                                                             
  avatar_url            ──► unified   avatar_url           ❓ 可移除                                                                             
  birth_datetime        ──► unified   (删除)                                                                                                     
  birth_location        ──► unified   (删除)                                                                                                     
  gender                ──► unified   (删除)                                                                                                     
  timezone              ──► unified   (删除)                                                                                                     
  language              ──► unified   (删除)                                                                                                     
  status                ───────────►  status               ✅ 保留（账户状态）                                                                   
  tier                  ───────────►  tier                 ❓ 可移除                                                                             
  created_at            ───────────►  created_at           ✅ 保留                                                                               
  updated_at            ───────────►  updated_at           ✅ 保留                                                                               
                                                                                                                                                 
  必须保留 vibe_users 的理由                                                                                                                     
                                                                                                                                                 
  -- vibe_user_auth 表有外键依赖                                                                                                                 
  CREATE TABLE vibe_user_auth (                                                                                                                  
      user_id UUID REFERENCES vibe_users(id),  -- ← 外键！                                                                                       
      auth_type VARCHAR(20),                                                                                                                     
      auth_identifier VARCHAR(255),                                                                                                              
      ...                                                                                                                                        
  );                                                                                                                                             
                                                                                                                                                 
  认证系统需要一个"账户主表"，这是无法完全消除的。                                                                                               
                                                                                                                                                 
  最佳方案：精简为"账户核心表"                                                                                                                   
                                                                                                                                                 
  -- 精简后的 vibe_users（只保留账户级别信息）                                                                                                   
  CREATE TABLE vibe_users (                                                                                                                      
      id UUID PRIMARY KEY,                                                                                                                       
      vibe_id VARCHAR(20) UNIQUE NOT NULL,                                                                                                       
      status VARCHAR(20) DEFAULT 'active',  -- active | pending_deletion | deleted                                                               
      created_at TIMESTAMP DEFAULT NOW(),                                                                                                        
      updated_at TIMESTAMP DEFAULT NOW()                                                                                                         
  );                                                                                                                                             
                                                                                                                                                 
  -- 所有业务数据放 unified_profiles                                                                                                             
  -- display_name, avatar_url, tier, birth_info, preferences... 全部在这里                                                                       
                                                                                                                                                 
  架构对比                                                                                                                                       
  ┌─────────────────────┬────────────────────┬────────────────────────────────────┐                                                              
  │        方案         │        优点        │                缺点                │                                                              
  ├─────────────────────┼────────────────────┼────────────────────────────────────┤                                                              
  │ 完全删除 vibe_users │ 消除冗余           │ 需要重构整个认证系统，外键迁移复杂 │                                                              
  ├─────────────────────┼────────────────────┼────────────────────────────────────┤                                                              
  │ 保留但精简 ✅       │ 改动最小，职责清晰 │ 仍有两张表                         │                                                              
  ├─────────────────────┼────────────────────┼────────────────────────────────────┤                                                              
  │ 保持现状            │ 无改动             │ 数据冗余，同步复杂                 │                                                              
  └─────────────────────┴────────────────────┴────────────────────────────────────┘                                                              
  推荐的最终架构                                                                                                                                 
                                                                                                                                                 
  ┌─────────────────────────────────────────────────────────────────────┐                                                                        
  │                        User Data Space                               │                                                                       
  ├─────────────────────────────────────────────────────────────────────┤                                                                        
  │                                                                      │                                                                       
  │  vibe_users (Account Layer)        unified_profiles (Profile Layer)  │                                                                       
  │  ─────────────────────────        ─────────────────────────────────  │                                                                       
  │  • id (PK)                        • user_id (FK → vibe_users.id)     │                                                                       
  │  • vibe_id                        • profile (JSONB)                  │                                                                       
  │  • status                           ├─ account (display_name, tier)  │                                                                       
  │  • created_at                       ├─ birth_info                    │                                                                       
  │                                     ├─ preferences                   │                                                                       
  │         │                           ├─ skill_data                    │                                                                       
  │         │                           ├─ life_context                  │                                                                       
  │         ▼                           └─ extracted                     │                                                                       
  │  vibe_user_auth                                                      │                                                                       
  │  • user_id (FK)                                                      │                                                                       
  │  • auth_type                                                         │                                                                       
  │  • auth_identifier                                                   │                                                                       
  │                                                                      │                                                                       
  └─────────────────────────────────────────────────────────────────────┘                                                                        
                                                                                                                                                 
  结论                                                                                                                                           
  ┌───────────────────────────┬─────────────────────────────────────────────────────────────┐                                                    
  │           问题            │                            答案                             │                                                    
  ├───────────────────────────┼─────────────────────────────────────────────────────────────┤                                                    
  │ 能否完全删除 vibe_users？ │ ❌ 不能，认证系统外键依赖                                   │                                                    
  ├───────────────────────────┼─────────────────────────────────────────────────────────────┤                                                    
  │ 应该怎么做？              │ ✅ 精简为账户核心表，只保留 id, vibe_id, status, timestamps │                                                    
  ├───────────────────────────┼─────────────────────────────────────────────────────────────┤                                                    
  │ 好处是什么？              │ 职责清晰、消除双写、简化 trigger                            │                                                    
  └───────────────────────────┴─────────────────────────────────────────────────────────────┘                                                    
  最终状态：                                                                                                                                     
  - vibe_users = Who can login（账户/认证）                                                                                                      
  - unified_profiles = Who they are（画像/业务数据）                                                                                             
                                                                                                                                                 
  这样就不需要复杂的 trigger 同步了，因为 vibe_users 只存储最核心的账户信息，其他一切都在 unified_profiles。                                     
                                                                                                                                                 
  需要我帮你制定这个精简方案的迁移计划吗？                                                                                                       
                                                                                     