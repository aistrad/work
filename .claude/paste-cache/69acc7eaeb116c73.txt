● 现在修改 Account Deletion Service 的 _hard_delete_user 函数：                                                                                  
                                                                                                                                                 
● Update(apps/api/services/identity/account_deletion.py)                                                                                         
  ⎿  Added 21 lines, removed 9 lines                                                                                                             
      278              user_id                                                                                                                   
      279          )                                                                                                                             
      280                                                                                                                                        
      281 -        # 12. Finally, mark the user record as deleted                                                                                
      282 -        # We keep a tombstone record for audit purposes                                                                               
      281 +        # 12. Delete unified_profiles record (CASCADE removes all business data)                                                      
      282          await conn.execute(                                                                                                           
      283 +            "DELETE FROM unified_profiles WHERE user_id = $1",                                                                        
      284 +            user_id                                                                                                                   
      285 +        )                                                                                                                             
      286 +                                                                                                                                      
      287 +        # 13. Delete authentication records (email/phone are in vibe_user_auth, not vibe_users)                                       
      288 +        await conn.execute(                                                                                                           
      289 +            "DELETE FROM vibe_user_auth WHERE user_id = $1",                                                                          
      290 +            user_id                                                                                                                   
      291 +        )                                                                                                                             
      292 +                                                                                                                                      
      293 +        # 14. Mark vibe_users as deleted (keep tombstone for audit)                                                                   
      294 +        # Retain: id, vibe_id, status, tier, created_at (for audit trail)                                                             
      295 +        # Clear: billing data (no longer needed after deletion)                                                                       
      296 +        await conn.execute(                                                                                                           
      297              """                                                                                                                       
      298              UPDATE vibe_users                                                                                                         
      299              SET status = 'deleted',                                                                                                   
      287 -                display_name = NULL,                                                                                                  
      288 -                avatar_url = NULL,                                                                                                    
      289 -                birth_datetime = NULL,                                                                                                
      290 -                birth_location = NULL,                                                                                                
      291 -                gender = NULL,                                                                                                        
      292 -                email = NULL,                                                                                                         
      293 -                phone = NULL,                                                                                                         
      300 +                daily_quota = 0,                                                                                                      
      301 +                billing_summary = '{}'::jsonb,                                                                                        
      302                  updated_at = NOW()                                                                                                    
      303              WHERE id = $1                                                                                                             
      304              """,                                                                                                                      
      305              user_id                                                                                                                   
      306          )                                                                                                                             
      307 +                                                                                                                                      
      308 +        # Note: Week 1-3 migration removes business fields (display_name, avatar_url, etc.)                                           
      309 +        # from vibe_users, so no need to NULL them here. They're in unified_profiles which                                            
      310 +        # is deleted above.                                                                                                           
                                                                                                                                                 
● 现在创建最后的 Migration 022（Schema Cleanup）：                                                                                               
                                                                                                                                                 
● Write(apps/api/stores/migrations/022_cleanup_vibe_users.sql)                                                                                   
  ⎿  Wrote 263 lines to apps/api/stores/migrations/022_cleanup_vibe_users.sql                                                                    
       1 -- Migration 022: Cleanup vibe_users - Remove business fields                                                                           
       2 -- Created: 2026-01-20                                                                                                                  
       3 --                                                                                                                                      
       4 -- Purpose: Complete the migration by removing business fields from vibe_users                                                          
       5 --          Final state: vibe_users = pure account + billing table                                                                      
       6 --                                                                                                                                      
       7 -- IMPORTANT: This is a DESTRUCTIVE migration. Run after thorough testing.                                                              
       8 --            Requires maintenance window.                                                                                              
       9 --                                                                                                                                      
      10 -- Changes:                                                                                                                             
     … +253 lines (ctrl+o to expand)                                                                                                             
                                                                                                                                                 
● 现在创建一个实施总结文档：                                                                                                                     
                                                                                                                                                 
● Write(docs/migration-021-022-summary.md)                                                                                                       
  ⎿  Wrote 359 lines to docs/migration-021-022-summary.md                                                                                        
      1 # 数据架构重构实施总结                                                                                                                   
      2 ## 概述                                                                                                                                  
      3 将 `vibe_users` 表从"账户+业务数据混合表"精简为"纯账户核心表"，所有业务数据迁移到 `unified_profiles`。                                   
      4 ## 实施状态                                                                                                                              
      5 ✅ **所有代码已完成** - 准备进行测试和部署                                                                                               
     … +349 lines (ctrl+o to expand)                                                                                                             
                                                                                                                                                 
● 最后创建一个快速开始指南：                                                                                                                     
                                                                                                                                                 
● Write(docs/migration-021-022-quickstart.md)                                                                                                    
  ⎿  Wrote 409 lines to docs/migration-021-022-quickstart.md                                                                                     
      1 # Migration 021-022 快速开始指南                                                                                                         
      2 ## 5 分钟快速理解                                                                                                                        
      3 ### 做什么？                                                                                                                             
      4 将 `vibe_users` 表从"大杂烩"变成"纯账户表"：                                                                                             
      5 **Before**: vibe_users 包含账户 + 个人资料 + 偏好 + 删除状态...                                                                          
      6 **After**: vibe_users 只包含账户核心（id, vibe_id, status）+ 计费信息                                                                    
     … +399 lines (ctrl+o to expand)                                                                                                             
  ⎿  You've hit your limit · resets 11pm (Asia/Shanghai)   