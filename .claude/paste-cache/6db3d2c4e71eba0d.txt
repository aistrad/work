 现在我完全理解问题了。让我给你一个清晰的总结：                                                                                             
                                                                                                                                             
  问题分析                                                                                                                                   
                                                                                                                                             
  数据存储位置                                                                                                                               
  ┌───────────────────────┬───────────────────────────────────────────────┬───────────────────────────────────────────────────┐              
  │      Skill 类型       │                 数据存储位置                  │                       示例                        │              
  ├───────────────────────┼───────────────────────────────────────────────┼───────────────────────────────────────────────────┤              
  │ 命理类 (bazi, zodiac) │ profile.skill_data.{skill_id}                 │ profile.skill_data.bazi.chart                     │              
  ├───────────────────────┼───────────────────────────────────────────────┼───────────────────────────────────────────────────┤              
  │ 教练类 (lifecoach)    │ profile.life_context._paths.lifecoach.content │ 使用 read_life_context_path(user_id, "lifecoach") │              
  └───────────────────────┴───────────────────────────────────────────────┴───────────────────────────────────────────────────┘              
  PromptBuilder 的 _build_profile_context 方法                                                                                               
                                                                                                                                             
  # Layer 1: Base - 读取 identity 和 extracted                                                                                               
  identity = profile.get("identity", {})                                                                                                     
  extracted = profile.get("extracted", {})                                                                                                   
                                                                                                                                             
  # Layer 2: Skill - 只读取 skill_data                                                                                                       
  skill_ids = get_skill_required_data(skill_id)  # ["lifecoach"]                                                                             
  for sid in skill_ids:                                                                                                                      
      data = skill_data.get(sid, {})  # ← 这里永远是空的！                                                                                   
                                                                                                                                             
  根本问题                                                                                                                                   
                                                                                                                                             
  Lifecoach 的数据在 life_context 中，但 _build_profile_context 只读取 skill_data，所以 lifecoach 的用户数据（north_star, goals, identity    
  等）永远不会被注入到 prompt 中！                                                                                                           
                                                                                                                                             
  数据流示意                                                                                                                                 
                                                                                                                                             
  ┌─────────────────────────────────────────────────────────────┐                                                                            
  │                    unified_profiles.profile                 │                                                                            
  ├─────────────────────────────────────────────────────────────┤                                                                            
  │  identity:                                                  │                                                                            
  │    birth_info: {...}    ← bazi/zodiac 需要                  │                                                                            
  │  extracted:                                                 │                                                                            
  │    goals: [...]         ← 被注入到 prompt ✓                 │                                                                            
  │  life_context:                                              │                                                                            
  │    _paths:                                                  │                                                                            
  │      lifecoach:                                             │                                                                            
  │        content:                                             │                                                                            
  │          north_star: {...}   ← 没被注入 ✗                   │                                                                            
  │          goals: [...]        ← 没被注入 ✗                   │                                                                            
  │          identity: {...}     ← 没被注入 ✗                   │                                                                            
  │          current: {...}      ← 没被注入 ✗                   │                                                                            
  │  skill_data:                                                │                                                                            
  │    bazi: {chart: {...}}      ← 被注入 ✓                     │                                                                            
  │    zodiac: {chart: {...}}    ← 被注入 ✓                     │                                                                            
  │    lifecoach: {}             ← 空的，因为数据在 life_context│                                                                            
  └─────────────────────────────────────────────────────────────┘                                                                            
                                                                                                                                             
  解决方案                                                                                                                                   
                                                                                                                                             
  需要在 _build_profile_context 中添加对 life_context 的读取逻辑。对于声明了 requires_life_context: true 或特定 skill（如 lifecoach,         
  career），从 life_context._paths.{skill_id}.content 中读取数据并注入。                       