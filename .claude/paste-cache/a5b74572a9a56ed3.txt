  ÊñπÊ°à B: Áªü‰∏ÄÂà∞ unified_profilesÔºàÊé®ËçêÔºâ                                                                                                       
                                                                                                                                                
  ÁõÆÊ†á: ÂΩªÂ∫ïÂÆûÁé∞ VibeProfile Êû∂ÊûÑËÆæËÆ°                                                                                                           
                                                                                                                                                
  1Ô∏è‚É£ ‰øÆÊîπ Settings API Áõ¥Êé•ÂÜôÂÖ• unified_profiles                                                                                                
                                                                                                                                                
  # routes/account.py:475                                                                                                                       
                                                                                                                                                
  @router.put("/profile", response_model=ProfileResponse)                                                                                       
  async def update_profile(                                                                                                                     
      request: ProfileUpdateRequest,                                                                                                            
      current_user: CurrentUser = Depends(get_current_user)                                                                                     
  ):                                                                                                                                            
      """Update current user's profile"""                                                                                                       
      update_data = request.model_dump(exclude_unset=True)                                                                                      
                                                                                                                                                
      # üÜï ÂàÜÁ¶ªÂ≠óÊÆµÔºöaccount vs identity vs preferences                                                                                         
      account_updates = {}                                                                                                                      
      identity_updates = {}                                                                                                                     
      preferences_updates = {}                                                                                                                  
                                                                                                                                                
      if "display_name" in update_data:                                                                                                         
          account_updates["display_name"] = update_data["display_name"]                                                                         
          # ‰ªçÁÑ∂ÂêåÊ≠•Âà∞ vibe_usersÔºàÂêëÂêéÂÖºÂÆπÔºâ                                                                                                   
          await UserRepository.update(current_user.user_id,                                                                                     
                                     display_name=update_data["display_name"])                                                                  
                                                                                                                                                
      if "birth_datetime" in update_data:                                                                                                       
          identity_updates["birth_info"] = {                                                                                                    
              "date": update_data["birth_datetime"],                                                                                            
              "location": update_data.get("birth_location")                                                                                     
          }                                                                                                                                     
                                                                                                                                                
      if "timezone" in update_data or "language" in update_data:                                                                                
          preferences_updates = {                                                                                                               
              "timezone": update_data.get("timezone"),                                                                                          
              "language": update_data.get("language")                                                                                           
          }                                                                                                                                     
                                                                                                                                                
      # üÜï ÂÜôÂÖ• unified_profiles                                                                                                                
      if identity_updates:                                                                                                                      
          await UnifiedProfileRepository.update_birth_info(                                                                                     
              current_user.user_id, identity_updates["birth_info"]                                                                              
          )                                                                                                                                     
                                                                                                                                                
      if preferences_updates:                                                                                                                   
          await UnifiedProfileRepository.update_preferences(                                                                                    
              current_user.user_id, preferences_updates                                                                                         
          )                                                                                                                                     
                                                                                                                                                
      # ËøîÂõûÂÆåÊï¥ Profile                                                                                                                        
      profile = await UnifiedProfileRepository.get_profile(current_user.user_id)                                                                
      # ... ÊûÑÈÄ† ProfileResponse                                                                                                                
                                                                                                                                                
  2Ô∏è‚É£ ‰øÆÊîπËØªÂèñÈÄªËæëÔºå‰ºòÂÖà‰ªé unified_profiles ËØª                                                                                                   
                                                                                                                                                
  @router.get("/profile", response_model=ProfileResponse)                                                                                       
  async def get_profile(current_user: CurrentUser = Depends(get_current_user)):                                                                 
      """Get current user's full profile"""                                                                                                     
      # üÜï ‰ªé unified_profiles ËØªÂèñ                                                                                                             
      profile = await UnifiedProfileRepository.get_profile(current_user.user_id)                                                                
                                                                                                                                                
      if not profile:                                                                                                                           
          # Fallback: ‰ªé vibe_users ËØªÂèñÂπ∂ËøÅÁßª                                                                                                  
          user = await UserRepository.get_by_id(current_user.user_id)                                                                           
          # ÂàõÂª∫ÂàùÂßã Profile                                                                                                                    
          await UnifiedProfileRepository.create_profile(current_user.user_id, {                                                                 
              "identity": {                                                                                                                     
                  "birth_info": {                                                                                                               
                      "date": user.get("birth_datetime"),                                                                                       
                      "location": user.get("birth_location")                                                                                    
                  }                                                                                                                             
              },                                                                                                                                
              "preferences": {                                                                                                                  
                  "timezone": user.get("timezone", "Asia/Shanghai"),                                                                            
                  "language": user.get("language", "zh-CN")                                                                                     
              }                                                                                                                                 
          })                                                                                                                                    
          profile = await UnifiedProfileRepository.get_profile(current_user.user_id)                                                            
                                                                                                                                                
      return ProfileResponse(                                                                                                                   
          user_id=str(current_user.user_id),                                                                                                    
          vibe_id=profile["account"]["vibe_id"],                                                                                                
          display_name=profile["account"].get("display_name"),                                                                                  
          birth_datetime=profile.get("identity", {}).get("birth_info", {}).get("date"),                                                         
          birth_location=profile.get("identity", {}).get("birth_info", {}).get("location"),                                                     
          timezone=profile.get("preferences", {}).get("timezone", "Asia/Shanghai"),                                                             
          language=profile.get("preferences", {}).get("language", "zh-CN"),                                                                     
          created_at=datetime.utcnow()                                                                                                          
      )                                                                                                                                         
                                                                                                                                                
  ‰ºòÁÇπ:                                                                                                                                         
  - Á¨¶ÂêàÊû∂ÊûÑËÆæËÆ°                                                                                                                                
  - Âçï‰∏ÄÊï∞ÊçÆÊ∫ê                                                                                                                                  
  - ÈÅøÂÖçÂêåÊ≠•ÈóÆÈ¢ò                                                                                                                                
                                                                                                                                                
  Áº∫ÁÇπ:                                                                                                                                         
  - ÈúÄË¶Å‰øÆÊîπÂ§öÂ§Ñ‰ª£Á†Å                                                                                                                            
  - ÈúÄË¶ÅÊï∞ÊçÆËøÅÁßª                                           