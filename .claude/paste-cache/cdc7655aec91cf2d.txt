  方案 1: 修复 companion 子目录规则加载 (P1, P2)                                                                                          
                                                                                                                                          
  问题根因：load_rule() 和 get_skill_rules() 只扫描 rules/*.md，不递归子目录。                                                            
                                                                                                                                          
  方案 A: 支持路径格式（推荐）                                                                                                            
                                                                                                                                          
  # skill_loader.py                                                                                                                       
                                                                                                                                          
  def load_rule(skill_id: str, rule_id: str) -> Optional[RuleConfig]:                                                                     
      """加载规则 - 支持子目录路径"""                                                                                                     
      # 支持 "companion/weekly-review" 格式                                                                                               
      rule_path = SKILLS_DIR / skill_id / "rules" / f"{rule_id}.md"                                                                       
      if not rule_path.exists():                                                                                                          
          # 尝试直接作为路径（兼容 companion/xxx 格式）                                                                                   
          rule_path = SKILLS_DIR / skill_id / "rules" / rule_id                                                                           
          if rule_path.is_dir():                                                                                                          
              return None                                                                                                                 
          if not rule_path.suffix:                                                                                                        
              rule_path = rule_path.with_suffix(".md")                                                                                    
                                                                                                                                          
      if not rule_path.exists():                                                                                                          
          return None                                                                                                                     
      # ... 其余逻辑不变                                                                                                                  
                                                                                                                                          
                                                                                                                                          
  def get_skill_rules(skill_id: str) -> List[str]:                                                                                        
      """获取所有规则 ID - 递归子目录"""                                                                                                  
      rules_dir = SKILLS_DIR / skill_id / "rules"                                                                                         
      if not rules_dir.exists():                                                                                                          
          return []                                                                                                                       
                                                                                                                                          
      rules = []                                                                                                                          
      for p in rules_dir.rglob("*.md"):  # 改为 rglob 递归                                                                                
          if p.stem.startswith("_"):                                                                                                      
              continue                                                                                                                    
          # 返回相对路径: companion/weekly-review                                                                                         
          rel_path = p.relative_to(rules_dir)                                                                                             
          rule_id = str(rel_path.with_suffix(""))                                                                                         
          rules.append(rule_id)                                                                                                           
                                                                                                                                          
      return rules                                                                                                                        
                                                                                                                                          
  前端适配：                                                                                                                              
  // 修改为                                                                                                                               
  router.push("/chat?skill=lifecoach&scenario=companion/weekly-review&prompt=周复盘");                                                    
                                                                                                