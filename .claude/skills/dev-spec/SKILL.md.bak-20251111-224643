---
name: dev-spec
description: 适用【dev】；当采用规格驱动的 specs 模式进行系统或功能构建/规划/修改时触发；用于从需求澄清→设计→任务拆分→实现→验证的规范化交付；输入包含目标、范围、约束、技术栈与验收口径；输出规格文档、设计稿、任务清单与变更日志；默认先计划，确认后执行。
---

# **Overview and Intent**

## **本技能的意图 (Intent of this Skill)**

本技能（Skill）旨在将严格的、规范驱动的软件开发方法论，形式化为一个可供 AI 代理（Agent）执行的、可审计的流程。

**核心理念 (Core Philosophy):** 本流程将“规范”（Specification）视为可执行的蓝图。其核心是“意图驱动开发”（Intent-driven development），首先在 requirements.md 中明确“构建什么”，然后在 design.md 中规划“如何构建”，最后在 tasks.md 中分解“执行步骤”。

本技能的主要功能是充当项目“宪法”的*执行者*，确保 AI 代理的开发活动严格遵守既定规程，防止“代理漂移”（agent drift）或创造性的误解。

## **核心原则 (Core Principles)**

* **1\. 规范是唯一的真相来源 (Spec is the Single Source of Truth):** design.md 中的“详细执行流程设计”（Detailed Execution Flow Design）是所有代码实现的**权威参考**。代码**必须**（MUST）与此设计保持1:1的一致性。  
* **2\. 强制上下文感知 (Mandatory Context-Awareness):** 在开始任何任务之前，**必须**（MANDATORY）对**父级或相关项目目录**进行全面的项目发现和分析。  
* **3\. 严格的阶段性审批 (Strict Gated Approval):** 工作流程划分为 A/需求、B/设计、C/任务三阶段。每阶段**必须**执行“预览→确认→落盘”：在写入前先输出将写入的文件清单与摘要预览，只有当用户明确选择“确认”时才写入；写入完成后**必须**询问是否进入下一阶段，统一确认选项为`[确认/修改/回退/取消]`。Workflow 0（上下文分析）为只读且自动执行，不设确认闸门。  
* **4\. 日志和验证的优先性 (Logging and Validation First):** 全面的日志记录（Logging）和计算验证（Computational Validation）不是事后添加的，它们是**需求阶段**的核心组成部分，并在**设计和实施**中被强制执行。

# **Quick Start**

## **工作流程触发 (Workflow Invocation)**

这是一个端到端（end-to-end）的规范创建或修改技能。

1. **用户 (Human):** 提出一个系统蓝图(System Spec)，或功能特性想法（feature idea），或修改意见。  
2. **AI代理 (Agent):** (在执行工作流程 0 上下文分析后) **必须**（MUST）首先判断并且向用户确认此想法是**创建新项目**，**创建新功能**还是**修改现有功能**。  
   * **如果创建新项目:** 代理**必须**（MUST）要求用户显式提供 `system_spec_path`（不设默认路径），通读后生成 `./claude/specs/CONSTITUTION.md`；按需与用户确认是否在 `./claude/specs/` 下为各模块/功能创建子目录（例如 `./claude/specs/<module>/`）。  
   * **如果创建或修改新功能:** 代理**必须**（MUST）确认这个功能所属模块的目录 `./claude/specs/<feature_name>/`，并通读其中所有文件（若存在）。  
3. **AI代理 (Agent):** 自动执行 Workflow 0（只读上下文分析），不会写入或修改任何文件。  
4. **阶段执行约束:** 对 A/需求、B/设计、C/任务，均遵循“预览→确认→落盘”：阶段开始前先展示将写入的文件清单与摘要预览，仅在用户选择“确认”后写入；写入完成后询问是否进入下一阶段，并提供`[确认/修改/回退/取消]`。  
5. **AI代理 (Agent):** 在获得最终批准后，工作流程结束。所有工件（artifacts）将位于 `./claude/specs/`（顶层 `CONSTITUTION.md` + 模块/功能子目录）中。

**注意:** 本技能**只负责**（ONLY）创建或更新规划工件。代码实现是一个独立于此的后续流程。

# **Workflows / Function / Inputs / Outputs**

## **工作流程 0: (强制) 项目上下文分析 (Workflow 0: Mandatory Project Context Analysis)**

* **描述:** 这是在任何规范或编程任务开始之前的\*\*强制性（MANDATORY）\*\*前提步骤。  
* **触发:** 任何新功能请求的开始。  
* **输入:** 系统蓝图(System Spec)，或功能特性想法（feature idea），或修改意见（隐式输入为**本目录，和父级或相关项目目录**）。  
* **功能 (MANDATORY):**  
  1. 代理**必须**（MUST）彻底阅读并理解**本目录，和父级或相关项目目录**下的**所有**项目。  
  2. **必须**（MUST）系统地遍历目录，理解现有项目结构和架构。  
  3. **必须**（MUST）识别可重用的组件、库、数据模型、模式、依赖关系和已建立的最佳实践。
  4. 代理**必须**（MUST）必须完整读取用户提供的输入，如 `system spec` 文档，新功能文档，或修改意见；结合对相关项目的理解，返回你对用户的目标，核心原则，资源和技术规约限制，如果是新系统/功能，还包括这个新系统/功能完整的输入，输出，功能及核心流程的理解描述；
* **输出:**  
  1. （内部）对用户的目标，核心原则，资源和技术规约限制，如果是新系统/功能，还包括这个新系统/功能完整的输入，输出，功能及核心流程的理解描述。  
  2. **必须**（MUST）在后续的需求、设计和实施阶段，在文档中明确记录（Document）哪些现有组件被重用、借鉴了哪些模式，以及新功能如何与现有系统集成。

### **下一步 (Next Step)**
- 本步骤为只读且自动执行。完成后，展示阶段 A/需求的“将写入文件清单与摘要预览”，等待用户确认进入阶段 A。

### **Fit 三重适配闸门 (Mandatory Fit Gates)**

- Constitutional Fit：任何新功能/变更先对照 `CONSTITUTION.md` 的目标、原则与边界，自查并给出结论 `PASS/WARN/FAIL`。  
- Stage Fit：声明所属阶段（MVP/v1/v2…）与升级路径；禁止跨阶段“抢跑”。  
- Module Fit：归属唯一模块，并在模块契约内落地（输入/输出/依赖/质量门槛）。

## **新项目流程：宪法生成 (New Project Constitution Flow)**

* **宗旨 (Purpose):** 核心任务是“提炼”和“固化”蓝图中的战略意图，而不是“创造”需求。此阶段生成的 `CONSTITUTION.md`（系统宪法）是后续所有设计与实施阶段的最高纲领。  
* **输入 (Inputs):**  
  * `system_spec_path`（必填）：用户显式提供的 System Spec 文件路径；不设默认路径。  
* **功能 (Functions):**  
  1. **定位与读取 System Spec（MANDATORY）**：严格使用用户提供的 `system_spec_path` 完整读取蓝图全文；除非用户明确要求“列举候选”，否则不进行目录扫描与默认选择。  
  2. **战略意图提炼**：从 System Spec 中提炼以下五个核心章节的“事实陈述 + 你的优化建议”：  
     - 系统愿景与目标 (Vision & Objectives)  
     - 核心原则与哲学 (Principles & Philosophy)  
     - 整体架构，核心组件  
     - 资源与技术约束  
     - 关键工作流与用例 (Workflows & Use Cases)  
  3. **预览与门控**：在任何写入前输出预览与影响范围：  
     - 将写入：`./claude/specs/CONSTITUTION.md`  
     - 变更摘要：各章节要点（每节≤10行）与“优化建议”清单  
     - 可选：拟创建的模块目录列表 `./claude/specs/<module>/`  
     - 仅在用户选择“确认”后落盘。  
  4. **写入策略（幂等）**：  
     - 若 `CONSTITUTION.md` 不存在：直接创建。  
     - 若已存在：默认不覆盖；生成 `CONSTITUTION.draft.<ts>.md` 并展示 diff，用户选择【保留/合并/覆盖】后再原子替换。  
  5. **可选模块骨架**：经确认后，可在 `./claude/specs/<module>/` 下按需生成 `requirements.md`、`design.md`、`tasks.md` 的空白骨架（含最小头部与占位目录索引）。  
  6. **可追溯性**：生成 `./claude/specs/constitution.report.json`，记录来源路径、哈希、创建时间、章节完整度与模块索引。  
* **输出 (Outputs):**  
  - `./claude/specs/CONSTITUTION.md`  
  - 可选的 `./claude/specs/<module>/` 目录骨架  
  - `./claude/specs/constitution.report.json`
* **治理 (Governance):**  
  - 宪法确认后默认“冻结”（受保护）。任何修改需提交“修宪提案（ADR）”，仅在出现新事实或阶段切换时触发；通过后同步更新模块契约与受影响的需求引用；此类操作归入红区，需二次确认。

## **新功能流程：规范化交付 (New Feature Flow)**

* **范围:** 适用于在已存在的 `./claude/specs/CONSTITUTION.md` 基础上新增模块/功能。  
* **路径:** 依次执行“工作流程 1/2/3”，产物均落在 `./claude/specs/<feature_name>/` 下（`requirements.md → design.md → tasks.md`），并在必要时将模块索引登记/更新到 `CONSTITUTION.md` 的“结构映射”。  
* **合宪前置:** 在 `./claude/specs/<feature_name>/requirements.md` 的开头固定写入“Constitutional Fit”小节（结论 PASS/WARN/FAIL；引用条目；偏差与处置），随后再撰写用户故事与 EARS 验收；设计与任务阶段必须携带对宪法条目与阶段目标的回链以便追溯。

## **修改流程：合宪性审查与变更记录 (Modify Flow)**

* **输入:**  
  - `./claude/specs/<feature_name>/` 目标模块路径  
  - 变更动机与范围说明（必须可追溯到需求/缺陷/风险）  
* **功能:**  
  1. **加载文档**：读取 `./claude/specs/CONSTITUTION.md` 与目标模块的 `requirements.md / design.md / tasks.md`。  
  2. **合宪性校验**：评估拟变更是否违背“愿景与目标”“核心原则”“资源与技术约束”；如存在冲突，先提出解决策略与权衡。  
  3. **差异预览**：生成各文件的差异摘要；写入前展示“影响范围 + 关键变更”。  
  4. **变更记录**：在 `./claude/specs/changes/YYYYMMDD-<slug>.md` 写入变更说明（动机、决策、评审者、受影响模块、回滚方案）；更新模块索引。  
  5. **门控**：遵循“预览→确认→落盘”，对覆盖性写入一律先生成 `*.draft.<ts>.md` 并要求明确确认。  
* **输出:** 更新后的模块文档与变更记录文件。

## **修宪与治理 (Amendment Governance)**

- 宪法为项目最高纲领与不变量载体，默认冻结；任何修改均以“修宪提案（ADR）”发起并评审。  
- 触发条件：新事实出现或阶段切换（MVP→v1→v2…）；通过后同步更新模块契约与受影响的 `requirements.md` 引用。  
- 权限与门控：修宪归红区操作；写入前生成 `CONSTITUTION.draft.<ts>.md`，展示差异并二次确认后原子替换。

## **工作流程 1: 需求收集 (Workflow 1: Requirements Gathering)**

* **描述:** 创建或迭代 `requirements.md` 文件，直到用户批准。  
* **输入:** 用户的初始功能想法；`./claude/specs/CONSTITUTION.md` 已存在且目标模块目录（`./claude/specs/<feature_name>/`）已确认。  
* **功能:**  
  1. **必须**（MUST）**加载或创建** `./claude/specs/{feature_name}/requirements.md` 文件。  
  2. **合宪自查（Mandatory Constitutional Fit）**：在文档开头写入“Constitutional Fit”小节，给出 `PASS/WARN/FAIL` 结论、引用的宪法条目（目标/原则/边界/阶段/模块契约）与偏差处置；`FAIL` 时不得落盘，转“修宪提案”或需求收敛。  
  2. **必须**（MUST）根据功能想法，**加载现有文档进行修改**（如果修改）或**生成初始版本**（如果新建）。不得（MUST NOT）在未加载或生成文档前先进行顺序提问。  
  3. **必须**（MUST）遵循特定格式，包括：  
     * 系统愿景与目标（Vision & Target）。 
     * 核心原则与哲学 (Principles & Philosophy)。 
     * 核心原则与哲学 (Principles & Philosophy)。 
     * 核心原则与哲学 (Principles & Philosophy)。           
     * 用户故事（User Story）。  
     * 使用 **EARS 格式**（Easy Approach to Requirements Syntax）的验收标准。  
  4. **必须**（MUST）包含一个**强制性的日志记录要求 (Mandatory logging requirements)** 部分，详细说明需要记录的事件、日志级别（DEBUG, INFO, WARN, ERROR, FATAL）、格式、保留策略等。  
  5. 代理**必须**（MUST）专注于核心需求，避免功能蔓延（feature creep）。  
* **门控 (GATING):**  
  1. 写入前预览：先输出“将写入文件清单与摘要预览”，提示：`将写入: ./claude/specs/{feature_name}/requirements.md；是否执行？[确认/修改/取消]`；仅在选择“确认”时执行写入。  
  2. 若合宪结论为 `FAIL`：阻断写入并提示进入“修宪提案（ADR）”或调整需求直至 `PASS/WARN`。  
  2. 写入后审批：代理**必须**使用 userInput（reason: `spec-requirements-review`）请求审批；若未获明确批准，依据反馈修改并再次预览与确认。  
  3. 阶段结束闸门：需求已落盘。询问“是否进入阶段 B/设计？”；选项`[确认/回退/取消]`。  
* **输出:** 经用户批准的 `./claude/specs/{feature_name}/requirements.md`。

## **工作流程 2: 设计文档创建 (Workflow 2: Design Document Creation)**

* **描述:** 基于已批准的需求，创建或更新全面的 design.md。  
* **输入:** 经批准的 `requirements.md`。  
* **功能:**  
  1. **必须**（MUST）**加载或创建** `./claude/specs/{feature_name}/design.md` 文件，并在开头引用本功能对应的宪法条目与阶段目标（回链）。  
  2. **必须**（MUST）在 design.md 中包含以下**所有**部分：  
     * Overview  
     * Architecture  
     * Detailed Execution Flow Design (这是**最关键**的部分)  
     * Components and Interfaces  
     * Data Models  
     * Directory Structure (必须分离核心代码、测试和临时文件)  
     * Logging Architecture (全面的日志设计)  
     * Error Handling  
     * Testing Strategy  
     * Documentation Synchronization Plan  
  3. **详细执行流程设计 (Detailed Execution Flow Design):** 此部分**必须**（MUST）作为所有代码修改的**权威参考**。**必须**（MUST）包含：操作的逐步流程、决策点（branching logic）、错误处理路径、数据流、**每个操作步骤的日志记录点和日志级别**、以及性能监控点。  
* **门控 (GATING):**  
  1. 写入前预览：展示设计大纲、关键接口/表结构与数据流预览，提示：`将写入: ./claude/specs/{feature_name}/design.md；是否执行？[确认/修改/回退/取消]`；仅在选择“确认”时写入。  
  2. 写入后审批：代理**必须**使用 userInput（reason: `spec-design-review`）请求审批；未获明确批准则依据反馈修订并再次预览与确认。  
  3. 阶段结束闸门：设计已落盘。询问“是否进入阶段 C/任务？”；选项`[确认/回退/取消]`。  
* **输出:** 经用户批准的 `./claude/specs/{feature_name}/design.md`。

## **工作流程 3: 实施规划 (Workflow 3: Implementation Planning)**

* **描述:** 基于已批准的设计，创建或更新可操作的 tasks.md 编码任务清单。  
* **输入:** 经批准的 `design.md`。  
* **功能:**  
  1. **必须**（MUST）**加载或创建** `./claude/specs/{feature_name}/tasks.md` 文件，并在任务项中附带对应的宪法条目与阶段目标引用，支撑端到端追溯。  
  2. **必须**（MUST）将设计文档转换为一系列用于代码生成LLM的**严格的测试驱动 (strict test-driven)** 提示。  
  3. **必须**（MUST）将 tasks.md 格式化为**编号的复选框列表**（最多两级层次结构）。  
  4. **自动测试与验证 (Automated Testing & Validation):**  
     * tasks.md **必须**（MUST）遵循TDD（测试驱动开发）方法。  
     * 对于每个功能组件或关键逻辑，任务必须（MUST）按以下顺序明确定义：  
       a. 任务：自动生成单元测试/集成测试（例如，使用 pytest）。  
       b. 任务：编写/修改实现代码。  
       c. 任务：执行（运行）生成的测试并验证结果，确保代码通过测试并符合“详细执行流程设计”中定义的计算验证要求。  
  5. 每个任务项**必须**（MUST）是可操作的（编写、修改、测试代码），并**必须**（MUST）包含：  
     * 对 requirements.md 中具体需求的引用。  
     * 关于文件放置位置的**目录组织说明**。  
     * **直接映射到 design.md 中“详细执行流程设计”的特定步骤**。  
  6. **必须**（MUST）包含用于**全面计算验证 (Comprehensive computational validation)** 和**内存安全 (Memory safety / overflow prevention)** 的特定测试任务。  
  7. **分阶段的代码审查和验证 (Phased Code Review and Validation):** tasks.md **必须**（MUST）被划分为逻辑阶段或主要功能里程碑。  
     * 在每个阶段的末尾，**必须**（MUST）包含一个**强制性的“阶段性审查”任务** (Mandatory Phase Review task)。  
     * 此审查任务必须（MUST）明确指示对该阶段实现的代码进行验证，确保：  
       a. 代码与设计的1:1一致性审查 (Design-to-Code Consistency Review)。  
       b. 实际代码执行完全（exactly）遵循“详细执行流程设计”的相关步骤。  
* **门控 (GATING):**  
  1. 写入前预览：展示里程碑（M0/M1/M2）与 DoD、任务清单摘要，提示：`将写入: ./claude/specs/{feature_name}/tasks.md，并在 changelog.md 追加记录；是否执行？[确认/修改/回退/取消]`；仅在选择“确认”时写入并追加变更记录。  
  2. 写入后审批：代理**必须**使用 userInput（reason: `spec-tasks-review`）请求审批；未获明确批准则依据反馈修订并再次预览与确认。  
  3. 阶段结束：流程完成；或选择`[回退]`返回设计阶段进行修订，或`[取消]`终止。  
* **输出:** 经用户批准的 `./claude/specs/{feature_name}/tasks.md`。

## **工作流程 4: 工作流程结束 (Workflow 4: Workflow Completion)**

* **描述:** 在 tasks.md 获得批准后，本技能的工作即告完成。  
* **功能:**  
  1. 代理**必须**（MUST）停止，并**不得**（MUST NOT）尝试执行 tasks.md 中的任何任务。  
  2. 代理**必须**（MUST）明确通知用户："This workflow is ONLY for creating design and planning artifacts. The actual implementation... should be done through a separate workflow. You can begin executing tasks by opening the tasks.md file."。  
* **输出:** 流程终止。

## **开发流程补充 (Process Addendum)**

- 端到端节拍：0/上下文分析（只读） → A/宪法生成（冻结） → B/模块契约（索引化） → C/需求（合宪/分阶段/归模块） → D/设计（执行流+接口+NFR验证） → E/任务（TDD） → F/联调与契约测试 → G/发布与复盘。  
- 强制门控：每阶段“将写入→确认→落盘”；覆盖性写入先走 `*.draft.<ts>.md`；宪法与模块契约属红区操作（需二次确认）。  
- 里程碑驱动：以阶段里程碑和 DoD 作为评审准入；跨阶段升级需满足事先约定的门槛（如覆盖率、SLO、负载验证）。  
- 角色与协作：明确 Owner/Reviewer，修宪与跨模块变更需联合评审与签字。

## **交互模板 (Interaction Templates)**

* 标准确认提示（写入前一律先展示）  
  `将写入: <paths>；关键变更: <summary>。是否执行？[确认/修改/回退/取消]`  
* 选项语义  
  * 确认：执行写入（幂等；覆盖前展示差异）。  
  * 修改：停留在当前阶段，接受修订后再次生成预览。  
  * 回退：返回上一阶段并以其文档为真源进入修订流。  
  * 取消：立即终止，不做任何写入。  

## **写入安全 (Write Safety & Idempotency)**

* 作用域：仅写入 `./claude/specs/`（顶层 `CONSTITUTION.md` 与 `./claude/specs/{feature_name}/` 模块子目录）；不改动代码实现或其他技能文件。  
* 幂等策略：写入前展示 diff；必要时生成带时间戳的备份；采用原子写入避免中断。  
* 日志与遮蔽：确认提示与日志中隐藏密钥等敏感信息。  

# **Scripts / Reference / Best Practices / Integration Points**

## **最佳实践与核心原则 (Best Practices & Core Principles) (Mandatory Reference)**

* **1\. 执行流程一致性 (Execution Flow Consistency)**  
  * Detailed Execution Flow Design 是**权威规范**。  
  * **任何**（Any）代码修改都**必须**（MUST）伴随对执行流程设计的相应更新。  
  * **必须**（MUST）包含验证任务，以核实实际程序执行与文档化的流程在**每一步**都完全匹配。  
* **2\. 全面的日志记录 (Comprehensive Logging)**  
  * **必须**（MUST）实施 design.md 中设计的日志架构。  
  * 日志级别 (Log Levels): **必须**（MUST）支持 DEBUG, INFO, WARN, ERROR, FATAL。  
  * 结构化日志 (Structured Logging): **必须**（MUST）使用一致的格式（推荐JSON），包含时间戳、级别、组件名和消息。  
  * **必须**（MUST）记录性能指标、执行时间、详细的错误堆栈跟踪和审计跟踪 (Audit Trail)。  
* **3\. 严格的测试与验证 (Rigorous Testing and Validation)**  
  * **必须**（MUST）实施严格的**逐步计算验证 (Step-by-Step Calculation Verification)**，核实：  
    * 每个计算步骤都符合需求的数学预期。  
    * 业务逻辑符合规定的业务规则。  
    * 算法实现符合算法设计规范。  
  * **必须**（MUST）实施**内存安全 (Memory Safety)** 和**资源管理**验证，以防止：  
    * 内存溢出 (Buffer overflows, stack overflows, heap overflows)。  
    * 资源泄漏 (Memory leaks, file handle leaks)。

## **参考: 项目与目录结构 (Reference: Project & Directory Structure)**

如果是在已存在的项目中运行这个skill，要优先遵从现有项目目录的规范。

项目结构需要根据项目特点设计，但建议遵循以下包含必须目录的结构：

project-root/  
├── claude/           \# Specifications & project artifacts  
│   └── specs/        \# Project constitution + feature specs  
├── src/              \# Source code  
│   ├── core/         \# Core application logic  
│   ├── models/       \# Data models  
│   ├── services/     \# Business logic services  
│   └── utils/        \# Utility functions  
├── config/           \# Configuration files  
├── tests/            \# Test files  
│   ├── unit/         \# Unit tests  
│   ├── integration/  \# Integration tests  
│   └── fixtures/     \# Test fixtures  
├── logs/             \# Log files  
├── docs/             \# Documentation  
├── scripts/          \# Utility scripts  
├── temp/             \# Temporary files (gitignored)

## **参考: 技术栈与数据库 (Reference: Technology Stack & Database)**

* **技术栈 (Technology Stack)**  
  * Language: Python 3.11+  
  * Database: PostgreSQL 16+  
  * Logging: Python logging module with structured formatting  
* **AiScend 数据库连接 (AiScend Database Connection)**  
  * **必须**（MUST）使用以下配置：

Python  
\# Database connection configuration  
DATABASE\_CONFIG \= {  
    "host": "localhost",  
    "port": 8224,  
    "database": "aiscend",  
    "user": "postgres",  
    "password": "Ak4\_9lScd-69WX"  
}

\# Connection string  
CONNECTION\_STRING \= "postgresql://postgres:Ak4\_9lScd-69WX@localhost:8224/aiscend"

* **数据库最佳实践 (Database Best Practices)**  
  * **MANDATORY:** 所有数据库操作**必须**（MUST）使用事务 (transactions)。  
  * **MANDATORY:** 在修改字段前，**必须**（MUST）先查询数据库结构。  
  * **MANDATORY:** **必须**（MUST）使用参数化查询 (parameterized queries) 以防止SQL注入。

## **参考: 权限设置 (Reference: Permission Settings) (Action Directives)**

代理**必须**（MUST）遵守以下操作权限区域。

**权限控制表 (Permission Control Table)**

| 区域 (Zone) | 描述 (Description) | 示例操作 (Example Operations) |
| :---- | :---- | :---- |
| 🟢 **绿区 (Green Zone)** | **自动批准 (Auto-approve)**。可无需确认地执行。 | Git (status, diff, add, commit, push, pull), 文件读取, 创建新文件, pytest, pip install, 数据库 SELECT |
| 🟡 **黄区 (Yellow Zone)** | **确认一次 (Confirm once)**。执行前需要初始确认。 | 系统命令 (ls, ps), 网络请求, CREATE TABLE, ALTER TABLE, 创建新目录, 修改配置文件 |
| 🔴 **红区 (Red Zone)** | **始终确认 (Always confirm)**。每次执行都**必须**（MUST）获得明确确认。 | **DELETE** (文件或数据库记录), **DROP TABLE**, **TRUNCATE**, 修改生产数据库, 修改凭证, 递归文件操作, git push \--force |

## **集成点 (Integration Points)**

* **userInput 工具:**  
  * spec-requirements-review (用于批准需求)  
  * spec-design-review (用于批准设计)  
  * spec-tasks-review (用于批准任务)  
* **文件 I/O:**  
  * （读/写）`./claude/specs/CONSTITUTION.md` 与 `./claude/specs/{feature_name}/`  
* **System Spec 提供:**  
  * 新项目场景下，`system_spec_path` 必须由用户显式输入；不设任何默认路径。若用户要求，可辅助列举 `docs/` 等目录的候选文件供选择，但不自动选取。  
* **项目上下文 (Project Context):**  
  * （只读）**父级或相关项目目录**

## **Templates: CONSTITUTION.md（系统宪法）**

> 用途：作为从用户项目蓝图到整个项目实施的最高纲领文件；位置：`./claude/specs/CONSTITUTION.md`。

建议的模板增强（面向 AIS 的阶段与模块特性）：  
- 系统愿景与远期目标（含阶段化 KR）。  
- 不变量与原则（不可变 vs. 可演进）。  
- 整体架构与层级（C4/C3 与依赖约束）。  
- 模块分解与契约（skill/l1/l2/l3/data/factor/strategy…的输入/输出/依赖/质量门槛）。  
- 阶段化路线图（MVP → v1 → v2… 的能力包、里程碑与发布准则）。

Front‑matter（可选）  
```
---
source: <system_spec_path>
created_at: <ISO8601>
hash: <sha256-of-source>
---
```

1. 系统愿景与目标 (Vision & Objectives)
- 摘要：<从 system spec 精炼的3–5条可度量目标，含KPI/时间边界>
- 优化建议：<目标粒度/可观测性/反脆弱性建议>

2. 核心原则与哲学 (Principles & Philosophy)
- 摘要：<不变原则/演进策略；MUST/SHOULD/SHOULD NOT>
- 优化建议：<冲突消解矩阵、优先级序列、异常门槛>

3. 整体架构，核心组件
- 摘要：<C4/C3视图；核心职责、输入/输出、边界>
- 优化建议：<耦合/内聚、替代实现、扩展点>

4. 资源与技术约束
- 摘要：<人力/时限/预算/合规、技术栈、数据与外部依赖>
- 优化建议：<约束缓冲、降级/退化运行、风险控制>

5. 关键工作流与用例 (Workflows & Use Cases)
- 摘要：<Top 5：触发→步骤→产出→验收口径>
- 优化建议：<可观测性埋点、SLO/错误预算、回滚演练>

附录 A. 结构映射（模块索引表）
- `<module>` → `./claude/specs/<module>/{requirements.md, design.md, tasks.md}`

附录 B. 变更治理（合宪性审查）
- 变更类型：新增/修改/废止；审批角色与判定口径；记录路径 `./claude/specs/changes/YYYYMMDD-<slug>.md`

附录 C. 术语与上下文边界
- 关键术语、系统边界与外部接口清单

## **Templates: requirements.md 开头的 “Constitutional Fit”**

```
## Constitutional Fit

Conclusion: PASS | WARN | FAIL
References: [OBJ-xxx, PRIN-xxx, BOUND-xxx, STAGE-x, MOD-xxx]
Deviations & Mitigations: <若有，注明影响与处置/修宪提案链接>
```
