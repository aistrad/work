# Onboarding é‡æ„è®¡åˆ’ - å¢å¼ºæ··åˆæ–¹æ¡ˆ

> **æ–¹æ¡ˆ**: C. å¢å¼ºæ··åˆæ–¹æ¡ˆ - ä¿ç•™ 90 ç§’ Onboardingï¼Œå°† AhaStep æ›¿æ¢ä¸ºåµŒå…¥å¼ Chat
> **ä»˜è´¹æ—¶æœº**: ç§»åˆ°é¦–æ¬¡ç›¸é‡å¯¹è¯ç»“æŸæ—¶
> **è®¾è®¡æ–‡æ¡£**: `/home/aiscend/work/vibelife/docs/archive/v9/FIRST-MEETING-SKILL-DESIGN.md`
> **çŠ¶æ€**: å¾…å®æ–½

---

## ä¸€ã€æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é‡æ„åçš„ Onboarding æµç¨‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [ä¿ç•™] LandingStep (0-15s)     [ä¿ç•™] LoadingStep (15-45s)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ ç”Ÿæ—¥è¾“å…¥              â”‚â”€â”€â”€â”€â–¶â”‚ å…«å­— + æ˜Ÿåº§è®¡ç®—        â”‚               â”‚
â”‚  â”‚ - å¹´æœˆæ—¥æ—¶            â”‚     â”‚ - å¹¶è¡Œ API è°ƒç”¨       â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                          â”‚                              â”‚
â”‚                                          â–¼                              â”‚
â”‚  [æ–°å¢] EmbeddedChatStep (45-180s) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ InsightsCard (LLM ç”Ÿæˆä¸‰ä¸ªæ´å¯Ÿ)                             â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ å†…åœ¨çŸ›ç›¾: "è¿½æ±‚è‡ªç”± vs æ¸´æœ›æ§åˆ¶"                          â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ å¤–åœ¨è¡¨ç°: "æ‰§è¡ŒåŠ›å¼ºï¼Œä½†å¯èƒ½å¤ªç›´æ¥"                        â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ å½“ä¸‹çŠ¶æ€: "æƒ³è¦æ”¹å˜ä½†ä¸çŸ¥ä»å“ªå¼€å§‹"                        â”‚â”‚   â”‚
â”‚  â”‚  â”‚ [è¯´å¾—å‡† ğŸ‘] [ä¸å¤ªå‡† ğŸ‘] [æœ‰è¯æƒ³è¯´ ğŸ’¬]                       â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                          â†“ ç”¨æˆ·åé¦ˆ                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ è‡ªç„¶å¯¹è¯åŒºåŸŸ (ChatMessages)                                 â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Agent å“åº”åé¦ˆ                                            â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ è¿½é—®/å…±æƒ…å¯¹è¯                                             â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                          â†“ è¿‡æ¸¡åˆ°å¼•å¯¼                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ GuidanceCard (ä¸‰ä¸ªå¼•å¯¼é€‰é¡¹)                                 â”‚â”‚   â”‚
â”‚  â”‚  â”‚ [æƒ³æ‰¾åˆ°äººç”Ÿæ–¹å‘] [æƒ³æ”¹å–„èŒåœº/è´¢åŠ¡] [æƒ³æ”¹å–„æ„Ÿæƒ…/å…³ç³»]        â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                          â†“ ç»“æŸæ‰¿è¯º                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ "ä»Šå¤©çš„å¯¹è¯æˆ‘è®°ä½äº†ã€‚æ˜å¤©æ—©ä¸Š8ç‚¹ï¼Œæˆ‘ä¼šç»™ä½ ä»Šæ—¥è¿åŠ¿..."      â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                          â”‚                              â”‚
â”‚                                          â–¼                              â”‚
â”‚  [ç§»åŠ¨] ConversionStep (å¯¹è¯ç»“æŸå) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ ä»˜è´¹é€‰é¡¹ (æœˆ/å­£/å¹´)                                           â”‚   â”‚
â”‚  â”‚ â€¢ "ç»§ç»­å…è´¹ä½“éªŒ" â†’ /chat                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ­¥éª¤å˜æ›´

| æ­¥éª¤ | å˜æ›´ | æ—¶é•¿ | è¯´æ˜ |
|------|------|------|------|
| `landing` | ä¿ç•™ | 0-15s | ç”Ÿæ—¥è¾“å…¥ |
| `loading` | ä¿ç•™ | 15-45s | å…«å­—+æ˜Ÿåº§è®¡ç®— |
| `aha` | **åˆ é™¤** | - | è¢« embeddedChat æ›¿ä»£ |
| `embeddedChat` | **æ–°å¢** | 45-180s+ | åµŒå…¥å¼ Chatï¼Œå±•ç¤º InsightsCard + GuidanceCard |
| `conversion` | ç§»åŠ¨ | ç»“æŸæ—¶ | ä»˜è´¹å¼•å¯¼ï¼Œæ£€æµ‹é¦–æ¬¡ç›¸é‡å®Œæˆåè§¦å‘ |

---

## ä¸‰ã€æ–‡ä»¶å˜æ›´æ¸…å•

### å‰ç«¯ (apps/web)

| æ–‡ä»¶ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| `src/app/onboarding/types.ts` | ä¿®æ”¹ | å°† `'aha'` æ”¹ä¸º `'embeddedChat'` |
| `src/app/onboarding/context.tsx` | ä¿®æ”¹ | æ›´æ–° STEP_ORDERï¼Œç§»é™¤ aha ç›¸å…³çŠ¶æ€ |
| `src/app/onboarding/page.tsx` | ä¿®æ”¹ | æ›¿æ¢ AhaStep ä¸º EmbeddedChatStep |
| `src/app/onboarding/steps/EmbeddedChatStep.tsx` | **æ–°å¢** | åµŒå…¥å¼ Chatï¼ˆå¤ç”¨ ChatContainerï¼‰ |
| `src/app/onboarding/steps/AhaStep.tsx` | **åˆ é™¤** | è¢« EmbeddedChatStep æ›¿ä»£ |
| `src/app/onboarding/steps/ConversionStep.tsx` | ä¿®æ”¹ | æ·»åŠ é¦–æ¬¡ç›¸é‡å®Œæˆæ£€æµ‹ |
| `src/hooks/useVibeChat.ts` | ä¿®æ”¹ | SkillId ç±»å‹æ·»åŠ  `'onboarding'` |
| `src/types/skill.ts` | ä¿®æ”¹ | SkillId ç±»å‹æ·»åŠ  `'onboarding'` |
| `src/components/chat/ChatContainer.tsx` | ä¿®æ”¹ | æ·»åŠ  onboarding å®Œæˆæ£€æµ‹é€»è¾‘ |

### åç«¯ (apps/api) - éªŒè¯ç¡®è®¤

| æ–‡ä»¶ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| `skills/onboarding/SKILL.md` | éªŒè¯ | ç¡®è®¤ 4-phase æµç¨‹æ­£ç¡® |
| `skills/onboarding/tools/tools.yaml` | éªŒè¯ | ç¡®è®¤å·¥å…·å®šä¹‰å®Œæ•´ |
| `skills/onboarding/rules/*.md` | éªŒè¯ | ç¡®è®¤è§„åˆ™æ–‡ä»¶æ­£ç¡® |

---

## å››ã€å…³é”®å®ç°

### 4.1 EmbeddedChatStep.tsx (æ–°å¢)

**è®¾è®¡åŸåˆ™**: å®Œå…¨å¤ç”¨ ChatContainer ç»„ä»¶ï¼Œä¸ /chat é¡µé¢é£æ ¼ 100% ä¸€è‡´

```tsx
'use client';

/**
 * EmbeddedChatStep - é¦–æ¬¡ç›¸é‡åµŒå…¥å¼å¯¹è¯
 *
 * è®¾è®¡åŸåˆ™ï¼š
 * - å¤ç”¨ ChatContainerï¼Œä¿æŒä¸ /chat é¡µé¢å®Œå…¨ä¸€è‡´çš„ UI
 * - ä½¿ç”¨ LuminousPaper + BreathAura èƒŒæ™¯
 * - è‡ªåŠ¨è§¦å‘ onboarding skill
 * - æ£€æµ‹é¦–æ¬¡ç›¸é‡å®Œæˆåè·³è½¬ ConversionStep
 */

import { useEffect, useMemo, useState, useRef } from 'react';
import dynamic from 'next/dynamic';
import { useOnboarding } from '../context';
import { LuminousPaper, BreathAura } from '@/components/core';

// åŠ¨æ€å¯¼å…¥ ChatContainerï¼Œä¸ /chat é¡µé¢ä¸€è‡´
const ChatContainer = dynamic(
  () => import('@/components/chat/ChatContainer').then(mod => ({ default: mod.ChatContainer })),
  { ssr: false, loading: () => <ChatLoadingFallback /> }
);

function ChatLoadingFallback() {
  return (
    <div className="flex-1 flex items-center justify-center">
      <div className="flex flex-col items-center gap-3">
        <div className="w-12 h-12 rounded-full bg-accent-primary/10 animate-pulse flex items-center justify-center">
          <span className="text-2xl">âœ¨</span>
        </div>
        <p className="text-text-secondary text-sm">æ­£åœ¨å‡†å¤‡é¦–æ¬¡ç›¸é‡...</p>
      </div>
    </div>
  );
}

export default function EmbeddedChatStep() {
  const { state, nextStep } = useOnboarding();
  const [conversationId, setConversationId] = useState<string | undefined>();
  const hasStartedRef = useRef(false);

  // æ£€æµ‹é¦–æ¬¡ç›¸é‡å®Œæˆçš„æ ‡å¿—ï¼ˆé€šè¿‡ conversationId å˜åŒ–æˆ–æ¶ˆæ¯å†…å®¹ï¼‰
  // åç«¯ä¼šåœ¨å®Œæˆæ—¶è®¾ç½® profile.vibe.onboarding_completed = true
  // è¿™é‡Œé€šè¿‡æ£€æµ‹åç«¯è¿”å›çš„ç‰¹å®šå…³é”®è¯æ¥åˆ¤æ–­

  const handleConversationStart = (id: string) => {
    setConversationId(id);
  };

  // åˆå§‹æ¶ˆæ¯ - è‡ªåŠ¨è§¦å‘ onboarding skill
  const initialPrompt = hasStartedRef.current ? undefined : 'å¼€å§‹';

  useEffect(() => {
    hasStartedRef.current = true;
  }, []);

  // æ³¨æ„ï¼šé¦–æ¬¡ç›¸é‡å®Œæˆçš„æ£€æµ‹é€»è¾‘åœ¨ ChatContainer å†…éƒ¨å¤„ç†
  // é€šè¿‡ç›‘å¬åç«¯è¿”å›çš„æ‰¿è¯ºæ¶ˆæ¯å…³é”®è¯ï¼Œåœ¨ ChatMessage æ¸²æŸ“æ—¶æ£€æµ‹
  // è¿™é‡Œæˆ‘ä»¬é€šè¿‡ URL å˜åŒ–æˆ– localStorage æ ‡è®°æ¥æ£€æµ‹å®Œæˆ

  useEffect(() => {
    // ç›‘å¬ localStorage ä¸­çš„ onboarding_completed æ ‡è®°
    const checkComplete = () => {
      const completed = localStorage.getItem('vibelife_onboarding_chat_completed');
      if (completed === 'true') {
        localStorage.removeItem('vibelife_onboarding_chat_completed');
        setTimeout(() => nextStep(), 2000);
      }
    };

    // æ¯ç§’æ£€æŸ¥ä¸€æ¬¡
    const interval = setInterval(checkComplete, 1000);
    return () => clearInterval(interval);
  }, [nextStep]);

  return (
    <LuminousPaper skill="bazi" variant="default" className="min-h-screen">
      {/* å‘¼å¸å…‰æ™•èƒŒæ™¯ - ä¸ /chat é¡µé¢ä¸€è‡´ */}
      <BreathAura
        skill="bazi"
        intensity="low"
        className="fixed inset-0 pointer-events-none"
      />

      {/* åµŒå…¥å¼ Chat - å®Œå…¨å¤ç”¨ ChatContainer */}
      <div className="relative z-10 h-screen flex flex-col">
        <ChatContainer
          skillId="onboarding"
          skill="bazi"  // UI ä¸»é¢˜
          initialPrompt={initialPrompt}
          onConversationStart={handleConversationStart}
          onInitialPromptSent={() => {
            // åˆå§‹æ¶ˆæ¯å·²å‘é€
          }}
        />
      </div>
    </LuminousPaper>
  );
}
```

**å…³é”®ç‚¹**ï¼š
1. å®Œå…¨å¤ç”¨ `ChatContainer` ç»„ä»¶ï¼ŒUI ä¸ /chat é¡µé¢ 100% ä¸€è‡´
2. ä½¿ç”¨ `LuminousPaper` + `BreathAura` èƒŒæ™¯å±‚
3. é€šè¿‡ `skillId="onboarding"` æŒ‡å®šæŠ€èƒ½
4. é€šè¿‡ `initialPrompt="å¼€å§‹"` è‡ªåŠ¨è§¦å‘é¦–æ¬¡ç›¸é‡
5. é¦–æ¬¡ç›¸é‡å®Œæˆæ£€æµ‹é€šè¿‡ localStorage æ ‡è®°ï¼ˆåç«¯åœ¨æ‰¿è¯ºæ¶ˆæ¯åè®¾ç½®ï¼‰

### 4.2 types.ts ä¿®æ”¹

```typescript
// åˆ é™¤ 'aha'ï¼Œæ·»åŠ  'embeddedChat'
export type OnboardingStep =
  | 'landing'
  | 'loading'
  | 'embeddedChat'  // æ›¿ä»£ aha
  | 'conversion';
```

### 4.3 context.tsx ä¿®æ”¹

```typescript
const STEP_ORDER: OnboardingStep[] = [
  'landing',
  'loading',
  'embeddedChat',  // æ›¿ä»£ aha
  'conversion',
];
```

### 4.4 page.tsx ä¿®æ”¹

```typescript
const EmbeddedChatStep = dynamic(() => import('./steps/EmbeddedChatStep'), {
  loading: () => <LoadingSkeleton />,
  ssr: false
});

// åœ¨ renderStep ä¸­
{state.step === 'embeddedChat' && <EmbeddedChatStep />}
```

### 4.5 useVibeChat.ts ä¿®æ”¹

```typescript
export type SkillId =
  | 'bazi'
  | 'zodiac'
  | 'tarot'
  | 'career'
  | 'lifecoach'
  | 'jungastro'
  | 'synastry'
  | 'psych'
  | 'vibe_id'
  | 'mindfulness'
  | 'onboarding';  // æ–°å¢
```

---

## äº”ã€æ•°æ®æµ

```
LandingStep
    â”‚ setBirthInfo({ year, month, day, hour })
    â–¼
LoadingStep
    â”‚ 1. POST /api/v1/bazi/chart
    â”‚ 2. POST /api/v1/zodiac/chart
    â”‚ setBaziData({ ... })
    â–¼
EmbeddedChatStep
    â”‚ 1. useVibeChat({ skillId: 'onboarding' })
    â”‚ 2. sendMessage('å¼€å§‹') è§¦å‘ onboarding skill
    â”‚ 3. åç«¯è¿”å› InsightsCard (show tool)
    â”‚ 4. ç”¨æˆ·åé¦ˆ â†’ åç«¯å¤„ç† â†’ GuidanceCard
    â”‚ 5. ç”¨æˆ·é€‰æ‹© â†’ åç«¯å‘é€æ‰¿è¯ºæ¶ˆæ¯
    â”‚ 6. æ£€æµ‹åˆ°æ‰¿è¯ºå…³é”®è¯ â†’ nextStep()
    â–¼
ConversionStep
    â”‚ å±•ç¤ºä»˜è´¹é€‰é¡¹
    â”‚ "ç»§ç»­å…è´¹ä½“éªŒ" â†’ router.push('/chat')
    â–¼
/chat (æ­£å¸¸å¯¹è¯)
```

---

## å…­ã€åç«¯äº¤äº’

### 6.1 é¦–æ¬¡ç›¸é‡è§¦å‘

å‰ç«¯å‘é€ `å¼€å§‹` æ¶ˆæ¯ï¼Œåç«¯ onboarding skill è‡ªåŠ¨æ¥ç®¡ï¼š

1. **Phase 1**: è°ƒç”¨ `generate_insights` å·¥å…·ï¼ŒåŸºäº bazi+zodiac ç”Ÿæˆä¸‰ä¸ªæ´å¯Ÿ
2. **Phase 1**: è°ƒç”¨ `show` å·¥å…·è¿”å› InsightsCard
3. **Phase 2**: æ”¶é›†ç”¨æˆ·åé¦ˆï¼Œè°ƒç”¨ `save` å­˜å‚¨
4. **Phase 3**: è°ƒç”¨ `show` è¿”å› GuidanceCard
5. **Phase 4**: ç”¨æˆ·é€‰æ‹©åï¼Œå‘é€æ‰¿è¯ºæ¶ˆæ¯ï¼Œè°ƒç”¨ `remind` è®¾ç½®æ¨é€

### 6.2 Profile æ›´æ–°

é¦–æ¬¡ç›¸é‡å®Œæˆåï¼Œåç«¯æ›´æ–°ï¼š
```json
{
  "vibe": {
    "onboarding_completed": true,
    "onboarding": {
      "feedback": "accurate",
      "guidance": "life_direction",
      "completed_at": "2026-01-26T12:00:00Z"
    }
  }
}
```

---

## ä¸ƒã€éªŒè¯æ­¥éª¤

### 7.1 æ‰‹åŠ¨æµ‹è¯•æ¸…å•

- [ ] LandingStep æ­£å¸¸æ”¶é›†ç”Ÿæ—¥ä¿¡æ¯
- [ ] LoadingStep æ­£å¸¸è®¡ç®—å…«å­—/æ˜Ÿåº§
- [ ] EmbeddedChatStep è‡ªåŠ¨è§¦å‘ onboarding skill
- [ ] InsightsCard æ˜¾ç¤ºä¸‰ä¸ªä¸ªæ€§åŒ–æ´å¯Ÿ
- [ ] åé¦ˆæŒ‰é’®ï¼ˆå‡†/ä¸å‡†/æƒ³è¯´ï¼‰æ­£å¸¸å·¥ä½œ
- [ ] GuidanceCard æ˜¾ç¤ºä¸‰ä¸ªå¼•å¯¼é€‰é¡¹
- [ ] é€‰æ‹©å Agent å‘é€æ‰¿è¯ºæ¶ˆæ¯
- [ ] æ£€æµ‹åˆ°æ‰¿è¯ºåè‡ªåŠ¨è·³è½¬ ConversionStep
- [ ] ä»˜è´¹é€‰é¡¹æ­£å¸¸æ˜¾ç¤º
- [ ] "ç»§ç»­å…è´¹ä½“éªŒ" è·³è½¬åˆ° /chat
- [ ] Profile æ ‡è®° onboarding_completed

### 7.2 æµ‹è¯•å‘½ä»¤

```bash
# 1. å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
bash /home/aiscend/work/vibelife/scripts/start-test.sh

# 2. è®¿é—® onboarding é¡µé¢
# http://106.37.170.238:8232/onboarding

# 3. æ£€æŸ¥åç«¯æ—¥å¿—
tail -f /data/vibelife/logs/test/api.log | grep onboarding
```

---

## å…«ã€é£é™©ä¸ç¼“è§£

| é£é™© | ç¼“è§£æªæ–½ |
|------|---------|
| åµŒå…¥å¼ Chat æ»šåŠ¨é—®é¢˜ | ä½¿ç”¨ `flex flex-col` + `overflow-y-auto` |
| ç§»åŠ¨ç«¯é”®ç›˜é®æŒ¡ | å›ºå®šè¾“å…¥æ¡†åœ¨åº•éƒ¨ï¼Œæ¶ˆæ¯åŒºåŸŸæ»šåŠ¨ |
| ç½‘ç»œé”™è¯¯å¯¼è‡´å¡ä½ | æ·»åŠ é‡è¯•æŒ‰é’®å’Œé”™è¯¯æç¤º |
| é¦–æ¬¡ç›¸é‡æ£€æµ‹è¯¯åˆ¤ | ä½¿ç”¨å¤šä¸ªå…³é”®è¯ + åç«¯æ˜¾å¼ä¿¡å· |

---

## ä¹ã€å®æ–½é¡ºåº

1. **ä¿®æ”¹ç±»å‹å®šä¹‰** - types.ts, useVibeChat.ts
2. **ä¿®æ”¹ context** - æ›´æ–° STEP_ORDER
3. **åˆ›å»º EmbeddedChatStep** - æ–°ç»„ä»¶
4. **ä¿®æ”¹ page.tsx** - æ›¿æ¢æ¸²æŸ“é€»è¾‘
5. **åˆ é™¤ AhaStep** - æ¸…ç†æ—§ä»£ç 
6. **ä¿®æ”¹ ConversionStep** - è°ƒæ•´è·³è½¬é€»è¾‘
7. **E2E æµ‹è¯•** - å®Œæ•´æµç¨‹éªŒè¯
