============================= test session starts ==============================
platform linux -- Python 3.13.3, pytest-8.4.2, pluggy-1.6.0 -- /data/anaconda3/envs/ai/bin/python
cachedir: .pytest_cache
rootdir: /home/aiscend/work/vibelife/apps/api
configfile: pytest.ini
plugins: mock-3.15.0, time-machine-2.17.0, asyncio-1.1.0, cov-7.0.0, anyio-4.9.0
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 31 items

tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_exists_operator_returns_true_when_data_exists PASSED [  3%]
tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_exists_operator_returns_false_when_data_missing PASSED [  6%]
tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_not_exists_operator PASSED [  9%]
tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_equals_operator_string PASSED [ 12%]
tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_not_equals_operator PASSED [ 16%]
tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_greater_than_operator PASSED [ 19%]
tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_greater_than_or_equal_operator PASSED [ 22%]
tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_contains_operator PASSED [ 25%]
tests/services/proactive/test_trigger_evaluator.py::TestPlaceholderPreprocessing::test_today_placeholder_replaced PASSED [ 29%]
tests/services/proactive/test_trigger_evaluator.py::TestPlaceholderPreprocessing::test_now_placeholder_replaced PASSED [ 32%]
tests/services/proactive/test_trigger_evaluator.py::TestCronMatching::test_cron_matches_at_scheduled_time PASSED [ 35%]
tests/services/proactive/test_trigger_evaluator.py::TestCronMatching::test_cron_does_not_match_outside_window PASSED [ 38%]
tests/services/proactive/test_trigger_evaluator.py::TestCronMatching::test_cron_returns_bucket_key_for_idempotency FAILED [ 41%]
tests/services/proactive/test_trigger_evaluator.py::TestCronMatching::test_invalid_cron_returns_false PASSED [ 45%]
tests/services/proactive/test_trigger_evaluator.py::TestConditionClassification::test_condition_with_data_path_and_static_operator_is_static PASSED [ 48%]
tests/services/proactive/test_trigger_evaluator.py::TestConditionClassification::test_condition_without_data_path_is_complex PASSED [ 51%]
tests/services/proactive/test_trigger_evaluator.py::TestConditionClassification::test_condition_with_non_static_operator_is_complex PASSED [ 54%]
tests/services/proactive/test_trigger_evaluator.py::TestEventBasedDetection::test_birthday_detected_7_days_before PASSED [ 58%]
tests/services/proactive/test_trigger_evaluator.py::TestEventBasedDetection::test_birthday_detected_on_day PASSED [ 61%]
tests/services/proactive/test_trigger_evaluator.py::TestEventBasedDetection::test_birthday_not_detected_outside_advance_days PASSED [ 64%]
tests/services/proactive/test_trigger_evaluator.py::TestEventBasedDetection::test_birthday_not_detected_without_birth_info PASSED [ 67%]
tests/services/proactive/test_trigger_evaluator.py::TestNestedValueAccess::test_get_nested_value_success PASSED [ 70%]
tests/services/proactive/test_trigger_evaluator.py::TestNestedValueAccess::test_get_nested_value_missing_path PASSED [ 74%]
tests/services/proactive/test_trigger_evaluator.py::TestNestedValueAccess::test_get_nested_value_non_dict PASSED [ 77%]
tests/services/proactive/test_trigger_evaluator.py::TestEvaluateConditions::test_all_static_conditions_pass PASSED [ 80%]
tests/services/proactive/test_trigger_evaluator.py::TestEvaluateConditions::test_one_static_condition_fails_short_circuits PASSED [ 83%]
tests/services/proactive/test_trigger_evaluator.py::TestEvaluateConditions::test_empty_conditions_return_true PASSED [ 87%]
tests/services/proactive/test_trigger_evaluator.py::TestTimeBasedTrigger::test_time_based_trigger_with_matching_cron PASSED [ 90%]
tests/services/proactive/test_trigger_evaluator.py::TestTimeBasedTrigger::test_time_based_trigger_fails_when_conditions_not_met PASSED [ 93%]
tests/services/proactive/test_trigger_evaluator.py::TestEventBasedTrigger::test_event_based_birthday_trigger PASSED [ 96%]
tests/services/proactive/test_trigger_evaluator.py::TestDataConditionTrigger::test_data_condition_trigger PASSED [100%]

=================================== FAILURES ===================================
________ TestCronMatching.test_cron_returns_bucket_key_for_idempotency _________
tests/services/proactive/test_trigger_evaluator.py:205: in test_cron_returns_bucket_key_for_idempotency
    assert bucket_key == "2026-01-26T08:00"
E   AssertionError: assert '2026-01-25T08:00' == '2026-01-26T08:00'
E     
E     - 2026-01-26T08:00
E     ?          ^
E     + 2026-01-25T08:00
E     ?          ^
=============================== warnings summary ===============================
tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_exists_operator_returns_true_when_data_exists
  /data/anaconda3/envs/ai/lib/python3.13/site-packages/jieba/_compat.py:18: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
    import pkg_resources

tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_exists_operator_returns_true_when_data_exists
  /data/anaconda3/envs/ai/lib/python3.13/site-packages/pkg_resources/__init__.py:3147: DeprecationWarning: Deprecated call to `pkg_resources.declare_namespace('mpl_toolkits')`.
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(pkg)

tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_exists_operator_returns_true_when_data_exists
tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_exists_operator_returns_true_when_data_exists
tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_exists_operator_returns_true_when_data_exists
tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_exists_operator_returns_true_when_data_exists
tests/services/proactive/test_trigger_evaluator.py::TestStaticConditionEvaluation::test_exists_operator_returns_true_when_data_exists
  /data/anaconda3/envs/ai/lib/python3.13/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

tests/services/proactive/test_trigger_evaluator.py: 15 warnings
  /data/anaconda3/envs/ai/lib/python3.13/site-packages/croniter/croniter.py:161: DeprecationWarning: datetime.datetime.utcfromtimestamp() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.fromtimestamp(timestamp, datetime.UTC).
    result = datetime.datetime.utcfromtimestamp(timestamp)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/services/proactive/test_trigger_evaluator.py::TestCronMatching::test_cron_returns_bucket_key_for_idempotency - AssertionError: assert '2026-01-25T08:00' == '2026-01-26T08:00'
  
  - 2026-01-26T08:00
  ?          ^
  + 2026-01-25T08:00
  ?          ^
================== 1 failed, 30 passed, 22 warnings in 2.00s ===================
Shell cwd was reset to /home/aiscend/work/docs