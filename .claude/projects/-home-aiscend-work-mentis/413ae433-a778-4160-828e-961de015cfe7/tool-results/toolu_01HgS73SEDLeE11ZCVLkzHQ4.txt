   500→│                                                                             │
   501→│    不一定要说什么，但如果想聊，我在这里。                                    │
   502→│                                                                             │
   503→│    有时候，仅仅是被看见，就已经是一种力量了。"                               │
   504→│                                                                             │
   505→│   ═══════════════════════════════════════════════════════════════════════   │
   506→│                                                                             │
   507→│   SCENARIO 3: 运势提醒                                                      │
   508→│   ─────────────────────────────────────────────────────────────────────     │
   509→│                                                                             │
   510→│   ❌ 工具化表达：                                                            │
   511→│   "系统提醒：您将于2026年2月4日进入新的流月运势周期（丙寅月）。              │
   512→│    届时您的事业运指数将上升15%，建议把握机会。"                              │
   513→│                                                                             │
   514→│   ✓ 朋友化表达：                                                             │
   515→│   "下周四（2月4日）你就进入新的月运了——丙寅月，火木相生。                   │
   516→│                                                                             │
   517→│    对你来说，这是一个能量变强的时期。                                        │
   518→│    如果最近有什么想推进的事情，下周开始会更顺。                              │
   519→│                                                                             │
   520→│    有什么计划吗？"                                                           │
   521→│                                                                             │
   522→└─────────────────────────────────────────────────────────────────────────────┘
   523→```
   524→
   525→---
   526→
   527→# Part 4: Insight Card System
   528→
   529→## 4.1 Insight Card Overview
   530→```
   531→╔═══════════════════════════════════════════════════════════════════════════════╗
   532→║                                                                               ║
   533→║   INSIGHT CARD SYSTEM                                                         ║
   534→║   让洞察自然涌现，而非生硬展示                                                ║
   535→║                                                                               ║
   536→║   ─────────────────────────────────────────────────────────────────────────   ║
   537→║                                                                               ║
   538→║   设计理念：                                                                  ║
   539→║                                                                               ║
   540→║   Insight Card 不是"报告"，是"发现"。                                        ║
   541→║   它应该像朋友突然说"嘿，我发现了一个有趣的事情"，                           ║
   542→║   而不是系统弹出"分析结果已生成"。                                           ║
   543→║                                                                               ║
   544→║   ─────────────────────────────────────────────────────────────────────────   ║
   545→║                                                                               ║
   546→║   核心原则：                                                                  ║
   547→║   • 有价值才出现 — 不是为了展示而展示                                        ║
   548→║   • 自然融入对话 — 不打断用户                                                ║
   549→║   • 可展开可忽略 — 用户有控制权                                              ║
   550→║   • 语言温暖 — 符合 Persona Guidelines                                       ║
   551→║                                                                               ║
   552→╚═══════════════════════════════════════════════════════════════════════════════╝
   553→```
   554→
   555→## 4.2 Insight Card Types
   556→```
   557→┌─────────────────────────────────────────────────────────────────────────────┐
   558→│                                                                             │
   559→│   INSIGHT CARD TYPE TAXONOMY                                                │
   560→│                                                                             │
   561→│   ═══════════════════════════════════════════════════════════════════════   │
   562→│                                                                             │
   563→│   TYPE 1: DISCOVERY（发现卡片）                                             │
   564→│   ─────────────────────────────────────────────────────────────────────     │
   565→│                                                                             │
   566→│   触发条件：                                                                │
   567→│   • 发现用户新的特征 / 模式                                                 │
   568→│   • confidence > 0.8                                                        │
   569→│   • 首次出现（不重复推送相同发现）                                          │
   570→│                                                                             │
   571→│   示例场景：                                                                │
   572→│   • 首次发现用户是"偏财格"                                                  │
   573→│   • 首次识别用户的依恋类型                                                  │
   574→│   • 首次发现用户的情绪触发模式                                              │
   575→│                                                                             │
   576→│   卡片结构：                                                                │
   577→│   ┌─────────────────────────────────────────────────────────────────────┐   │
   578→│   │                                                                     │   │
   579→│   │  💡 我发现了一些有趣的事情                                          │   │
   580→│   │                                                                     │   │
   581→│   │  {discovery_content}                                                │   │
   582→│   │                                                                     │   │
   583→│   │  [展开了解更多]  [收到了]                                           │   │
   584→│   │                                                                     │   │
   585→│   └─────────────────────────────────────────────────────────────────────┘   │
   586→│                                                                             │
   587→│   ═══════════════════════════════════════════════════════════════════════   │
   588→│                                                                             │
   589→│   TYPE 2: PATTERN（模式卡片）                                               │
   590→│   ─────────────────────────────────────────────────────────────────────     │
   591→│                                                                             │
   592→│   触发条件：                                                                │
   593→│   • 同一主题/模式出现 3+ 次                                                 │
   594→│   • 形成可识别的规律                                                        │
   595→│                                                                             │
   596→│   示例场景：                                                                │
   597→│   • 用户第三次提到"和老板的冲突"                                           │
   598→│   • 用户多次在深夜情绪低落                                                  │
   599→│   • 用户反复提到某个人                                                      │
   600→│                                                                             │
   601→│   卡片结构：                                                                │
   602→│   ┌─────────────────────────────────────────────────────────────────────┐   │
   603→│   │                                                                     │   │
   604→│   │  🔄 我注意到一个模式                                                │   │
   605→│   │                                                                     │   │
   606→│   │  {pattern_description}                                              │   │
   607→│   │                                                                     │   │
   608→│   │  这是第 {count} 次出现了。                                          │   │
   609→│   │                                                                     │   │
   610→│   │  [想聊聊这个]  [只是巧合]                                           │   │
   611→│   │                                                                     │   │
   612→│   └─────────────────────────────────────────────────────────────────────┘   │
   613→│                                                                             │
   614→│   ═══════════════════════════════════════════════════════════════════════   │
   615→│                                                                             │
   616→│   TYPE 3: TIMING（时机卡片）                                                │
   617→│   ─────────────────────────────────────────────────────────────────────     │
   618→│                                                                             │
   619→│   触发条件：                                                                │
   620→│   • 用户询问"适合做某事吗"类问题                                           │
   621→│   • 即将到来的运势节点与用户关注相关                                        │
   622→│   • 当前运势与用户提到的计划有关联                                          │
   623→│                                                                             │
   624→│   示例场景：                                                                │
   625→│   • 用户问"该不该换工作"，正好下月事业运转好                               │
   626→│   • 水逆期间用户说要签合同                                                  │
   627→│   • 用户生日月，适合开始新项目                                              │
   628→│                                                                             │
   629→│   卡片结构：                                                                │
   630→│   ┌─────────────────────────────────────────────────────────────────────┐   │
   631→│   │                                                                     │   │
   632→│   │  ⏰ 关于时机                                                        │   │
   633→│   │                                                                     │   │
   634→│   │  {timing_insight}                                                   │   │
   635→│   │                                                                     │   │
   636→│   │  [告诉我更多]  [知道了]                                             │   │
   637→│   │                                                                     │   │
   638→│   └─────────────────────────────────────────────────────────────────────┘   │
   639→│                                                                             │
   640→│   ═══════════════════════════════════════════════════════════════════════   │
   641→│                                                                             │
   642→│   TYPE 4: GROWTH（成长卡片）                                                │
   643→│   ─────────────────────────────────────────────────────────────────────     │
   644→│                                                                             │
   645→│   触发条件：                                                                │
   646→│   • 检测到行为突破（与历史自述对比）                                        │
   647→│   • 检测到认知转变                                                          │
   648→│   • 检测到积极变化                                                          │
   649→│                                                                             │
   650→│   示例场景：                                                                │
   651→│   • 一个月前说"我总是拖延"，现在主动执行                                   │
   652→│   • 之前回避冲突，现在主动表达需求                                          │
   653→│   • 情绪恢复速度比以前快                                                    │
   654→│                                                                             │
   655→│   卡片结构：                                                                │
   656→│   ┌─────────────────────────────────────────────────────────────────────┐   │
   657→│   │                                                                     │   │
   658→│   │  🌱 我看到你在成长                                                  │   │
   659→│   │                                                                     │   │
   660→│   │  {growth_observation}                                               │   │
   661→│   │                                                                     │   │
   662→│   │  [详细说说]  [谢谢你看见]                                           │   │
   663→│   │                                                                     │   │
   664→│   └─────────────────────────────────────────────────────────────────────┘   │
   665→│                                                                             │
   666→└─────────────────────────────────────────────────────────────────────────────┘
   667→```
   668→
   669→## 4.3 Trigger Logic
   670→```
   671→┌─────────────────────────────────────────────────────────────────────────────┐
   672→│                                                                             │
   673→│   INSIGHT CARD TRIGGER LOGIC                                                │
   674→│                                                                             │
   675→│   ═══════════════════════════════════════════════════════════════════════   │
   676→│                                                                             │
   677→│   TRIGGER FLOW                                                              │
   678→│                                                                             │
   679→│   User Message                                                              │
   680→│        │                                                                    │
   681→│        ▼                                                                    │
   682→│   ┌─────────────────────────────────────────────────────────────────────┐   │
   683→│   │  INSIGHT ENGINE                                                     │   │
   684→│   │                                                                     │   │
   685→│   │  1. Analyze conversation context                                    │   │
   686→│   │  2. Check against trigger conditions                                │   │
   687→│   │  3. Calculate confidence score                                      │   │
   688→│   │  4. Check cooldown (avoid spam)                                     │   │
   689→│   │  5. Generate or skip                                                │   │
   690→│   │                                                                     │   │
   691→│   └─────────────────────────────────────────────────────────────────────┘   │
   692→│        │                                                                    │
   693→│        ├─── confidence < 0.7 ───▶ No Card                                  │
   694→│        │                                                                    │
   695→│        ├─── cooldown active ───▶ No Card                                   │
   696→│        │                                                                    │
   697→│        └─── confidence ≥ 0.8 ───▶ Generate Card                            │
   698→│                                                                             │
   699→│   ═══════════════════════════════════════════════════════════════════════   │
   700→│                                                                             │
   701→│   CONFIDENCE THRESHOLDS                                                     │
   702→│                                                                             │
   703→│   Type        Threshold    Cooldown                                         │
   704→│   ─────────────────────────────────────────────────────────────────────     │
   705→│   DISCOVERY   0.8          7 days (same topic)                              │
   706→│   PATTERN     0.75         3 days (same pattern)                            │
   707→│   TIMING      0.7          1 day                                            │
   708→│   GROWTH      0.85         14 days (same aspect)                            │
   709→│                                                                             │
   710→│   ═══════════════════════════════════════════════════════════════════════   │
   711→│                                                                             │
   712→│   DAILY LIMITS                                                              │
   713→│                                                                             │
   714→│   • Max 3 Insight Cards per day per user                                    │
   715→│   • Max 1 of each type per day                                              │
   716→│   • GROWTH cards are rare (celebrate, don't spam)                           │
   717→│                                                                             │
   718→└─────────────────────────────────────────────────────────────────────────────┘
   719→4.4 Implementation
   720→typescriptinterface InsightCard {
   721→  id: string
   722→  type: 'discovery' | 'pattern' | 'timing' | 'growth'
   723→  
   724→  // 内容
   725→  title: string
   726→  content: string
   727→  evidence?: string[]  // 支撑证据
   728→  
   729→  // 元数据
   730→  confidence: number
   731→  skillSource: string  // 产生洞察的 Skill
   732→  createdAt: Date
   733→  
   734→  // 交互
   735→  actions: {
   736→    primary: { label: string; action: string }
   737→    secondary: { label: string; action: string }
   738→  }
   739→  
   740→  // 状态
   741→  status: 'pending' | 'shown' | 'expanded' | 'dismissed'
   742→  userReaction?: 'positive' | 'negative' | 'neutral'
   743→}
   744→
   745→interface InsightEngine {
   746→  // 分析对话，判断是否触发
   747→  analyze(
   748→    conversation: Conversation,
   749→    userProfile: UserProfile,
   750→    skillContext: SkillContext
   751→  ): Promise<InsightCard | null>
   752→  
   753→  // 检查冷却期
   754→  checkCooldown(
   755→    userId: string,
   756→    cardType: string,
   757→    topic?: string
   758→  ): Promise<boolean>
   759→  
   760→  // 检查每日上限
   761→  checkDailyLimit(userId: string): Promise<boolean>
   762→  
   763→  // 生成卡片内容（使用 Persona Guidelines）
   764→  generateContent(
   765→    type: string,
   766→    rawInsight: any,
   767→    userProfile: UserProfile
   768→  ): Promise<{ title: string; content: string }>
   769→}
   770→
   771→// 触发条件示例
   772→const triggerConditions = {
   773→  discovery: {
   774→    // 新特征发现
   775→    newTrait: (analysis) => 
   776→      analysis.isNew && analysis.confidence > 0.8,
   777→    
   778→    // 首次完整解读
   779→    firstFullReading: (context) =>
   780→      context.isFirstReading && context.completeness > 0.9
   781→  },
   782→  
   783→  pattern: {
   784→    // 重复主题
   785→    repeatedTopic: (history, current) =>
   786→      countOccurrences(history, current.topic) >= 3,
   787→    
   788→    // 时间模式
   789→    temporalPattern: (history) =>
   790→      detectTemporalPattern(history).confidence > 0.75
   791→  },
   792→  
   793→  timing: {
   794→    // 时机询问
   795→    timingQuestion: (message) =>
   796→      containsTimingQuestion(message),
   797→    
   798→    // 运势节点关联
   799→    transitRelevance: (userPlan, currentTransit) =>
   800→      calculateRelevance(userPlan, currentTransit) > 0.7
   801→  },
   802→  
   803→  growth: {
   804→    // 行为变化
   805→    behaviorChange: (history, current) =>
   806→      detectBehaviorChange(history, current).isPositive &&
   807→      detectBehaviorChange(history, current).confidence > 0.85,
   808→    
   809→    // 认知转变
   810→    cognitiveShift: (history, current) =>
   811→      detectCognitiveShift(history, current).confidence > 0.85
   812→  }
   813→}
   814→```
   815→
   816→---
   817→
   818→# Part 5: Proactive Reminder System
   819→
   820→## 5.1 Overview
   821→```
   822→╔═══════════════════════════════════════════════════════════════════════════════╗
   823→║                                                                               ║
   824→║   PROACTIVE REMINDER SYSTEM                                                   ║
   825→║   Phase 1: 运势节点提醒                                                       ║
   826→║                                                                               ║
   827→║   ─────────────────────────────────────────────────────────────────────────   ║
   828→║                                                                               ║
   829→║   设计理念：                                                                  ║
   830→║                                                                               ║
   831→║   "等你开口" vs "主动关心" 是工具和朋友的本质区别。                           ║
   832→║                                                                               ║
   833→║   Phase 1 聚焦于"运势节点提醒"——                                             ║
   834→║   这是唯一不需要用户历史数据的主动功能，                                      ║
   835→║   用户第一天注册就能用，直接体现产品差异化。                                  ║
   836→║                                                                               ║
   837→║   ─────────────────────────────────────────────────────────────────────────   ║
   838→║                                                                               ║
   839→║   核心价值：                                                                  ║
   840→║   • 直接体现"主动关心"差异化                                                 ║
   841→║   • 订阅的核心价值点                                                         ║
   842→║   • 留存的直接驱动                                                           ║
   843→║                                                                               ║
   844→╚═══════════════════════════════════════════════════════════════════════════════╝
   845→```
   846→
   847→## 5.2 Reminder Types (Phase 1)
   848→```
   849→┌─────────────────────────────────────────────────────────────────────────────┐
   850→│                                                                             │
   851→│   PHASE 1 REMINDER TYPES                                                    │
   852→│                                                                             │
   853→│   ═══════════════════════════════════════════════════════════════════════   │
   854→│                                                                             │
   855→│   BAZI SKILL REMINDERS                                                      │
   856→│   ─────────────────────────────────────────────────────────────────────     │
   857→│                                                                             │
   858→│   1. 月运交接提醒                                                           │
   859→│      ─────────────────────────────────────────────────────────────────      │
   860→│      触发：每月节气交接前 1-2 天                                            │
   861→│      频率：每月 1 次                                                        │
   862→│      内容：下月运势概述 + 关键建议                                          │
   863→│                                                                             │
   864→│      示例：                                                                 │
   865→│      "后天（2月4日）立春，你就进入丙寅月了。                                │
   866→│                                                                             │
   867→│       这个月火木相生，对你来说是能量上升的时期。                            │
   868→│       如果有什么想推进的项目，这个月是好时机。                              │
   869→│                                                                             │
   870→│       不过寅木冲你的申金，注意别太激进。                                    │
   871→│       稳扎稳打会更顺。                                                      │
   872→│                                                                             │
   873→│       想详细聊聊这个月吗？"                                                 │
   874→│                                                                             │
   875→│   2. 流年交接提醒                                                           │
   876→│      ─────────────────────────────────────────────────────────────────      │
   877→│      触发：立春前 3-5 天                                                    │
   878→│      频率：每年 1 次                                                        │
   879→│      内容：新年运势概述 + 年度主题                                          │
   880→│                                                                             │
   881→│   3. 大运交接提醒（如适用）                                                 │
   882→│      ─────────────────────────────────────────────────────────────────      │
   883→│      触发：大运交接前 1 个月                                                │
   884→│      频率：约每 10 年 1 次                                                  │
   885→│      内容：新大运主题 + 重要转变提示                                        │
   886→│                                                                             │
   887→│   ═══════════════════════════════════════════════════════════════════════   │
   888→│                                                                             │
   889→│   ZODIAC SKILL REMINDERS                                                    │
   890→│   ─────────────────────────────────────────────────────────────────────     │
   891→│                                                                             │
   892→│   1. 水逆提醒                                                               │
   893→│      ─────────────────────────────────────────────────────────────────      │
   894→│      触发：水逆开始前 2-3 天 / 水逆结束时                                   │
   895→│      频率：每年约 3-4 次                                                    │
   896→│      内容：水逆影响 + 注意事项 / 水逆结束庆祝                               │
   897→│                                                                             │
   898→│      示例（水逆开始）：                                                     │
   899→│      "水逆要来了（3月15日-4月7日）。                                        │
   900→│                                                                             │
   901→│       作为天蝎座，这次水逆在你的第五宫，                                    │
   902→│       可能会影响创意表达和恋爱关系。                                        │
   903→│                                                                             │
   904→│       不用太担心，水逆不是'倒霉期'，                                        │
   905→│       更像是一个'回顾期'——适合整理，不急着推新。                           │
   906→│                                                                             │
   907→│       上次水逆你说工作上有些沟通问题，这次注意一下。"                        │
   908→│                                                                             │
   909→│      示例（水逆结束）：                                                     │
   910→│      "水逆结束了！🎉                                                        │
   911→│                                                                             │
   912→│       这三周你有什么体会吗？                                                │
   913→│       现在可以安心推进之前搁置的事情了。"                                   │
   914→│                                                                             │
   915→│   2. 新月/满月提醒（可选）                                                  │
   916→│      ─────────────────────────────────────────────────────────────────      │
   917→│      触发：新月/满月当天                                                    │
   918→│      频率：每月 2 次                                                        │
   919→│      内容：新月许愿指南 / 满月收获回顾                                      │
   920→│                                                                             │
   921→│   3. 周运推送（可选）                                                       │
   922→│      ─────────────────────────────────────────────────────────────────      │
   923→│      触发：每周日/周一                                                      │
   924→│      频率：每周 1 次                                                        │
   925→│      内容：本周运势概述                                                     │
   926→│                                                                             │
   927→└─────────────────────────────────────────────────────────────────────────────┘
   928→```
   929→
   930→## 5.3 Reminder Content Templates
   931→```
   932→┌─────────────────────────────────────────────────────────────────────────────┐
   933→│                                                                             │
   934→│   REMINDER CONTENT TEMPLATES                                                │
   935→│                                                                             │
   936→│   ═══════════════════════════════════════════════════════════════════════   │
   937→│                                                                             │
   938→│   STRUCTURE                                                                 │
   939→│   ─────────────────────────────────────────────────────────────────────     │
   940→│                                                                             │
   941→│   1. Hook（引起注意）                                                       │
   942→│      简短，点明时间节点                                                     │
   943→│                                                                             │
   944→│   2. Context（背景说明）                                                    │
   945→│      这个节点对用户意味着什么                                               │
   946→│                                                                             │
   947→│   3. Personal Relevance（个人关联）                                         │
   948→│      基于用户命盘/星座的具体影响                                            │
   949→│                                                                             │
   950→│   4. Actionable Advice（可行建议）                                          │
   951→│      具体可以做什么                                                         │
   952→│                                                                             │
   953→│   5. Invitation（邀请互动）                                                 │
   954→│      引导用户进入对话                                                       │
   955→│                                                                             │
   956→│   ═══════════════════════════════════════════════════════════════════════   │
   957→│                                                                             │
   958→│   TEMPLATE: 月运交接（八字）                                                │
   959→│   ─────────────────────────────────────────────────────────────────────     │
   960→│                                                                             │
   961→│   "{days}天后就是{节气}了，你将进入{干支}月。                                │
   962→│                                                                             │
   963→│    这个月对你来说，{overall_theme}。                                        │
   964→│                                                                             │
   965→│    {personal_analysis}                                                      │
   966→│                                                                             │
   967→│    {specific_advice}                                                        │
   968→│                                                                             │
   969→│    想详细聊聊吗？"                                                          │
   970→│                                                                             │
   971→│   ═══════════════════════════════════════════════════════════════════════   │
   972→│                                                                             │
   973→│   TEMPLATE: 水逆提醒（星座）                                                │
   974→│   ─────────────────────────────────────────────────────────────────────     │
   975→│                                                                             │
   976→│   "水逆要来了（{start_date}-{end_date}）。                                  │
   977→│                                                                             │
   978→│    作为{zodiac_sign}，这次水逆在你的{house}，                               │
   979→│    可能会影响{affected_areas}。                                             │
   980→│                                                                             │
   981→│    不用太担心，水逆不是'倒霉期'，                                           │
   982→│    更像是一个'回顾期'——{positive_reframe}。                                │
   983→│                                                                             │
   984→│    {personal_reminder_if_any}                                               │
   985→│                                                                             │
   986→│    有什么想提前准备的吗？"                                                  │
   987→│                                                                             │
   988→└─────────────────────────────────────────────────────────────────────────────┘
   989→```
   990→
   991→## 5.4 Technical Architecture
   992→```
   993→┌─────────────────────────────────────────────────────────────────────────────┐
   994→│                                                                             │
   995→│   PROACTIVE REMINDER ARCHITECTURE                                           │
   996→│                                                                             │
   997→│   ═══════════════════════════════════════════════════════════════════════   │
   998→│                                                                             │
   999→│                                                                             │

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
