     1→# VibeLife 用户场景分析与系统优化报告
     2→
     3→> **版本**: 1.0
     4→> **日期**: 2026-01-07
     5→> **分析范围**: 13 个核心用户场景 vs 系统实现能力
     6→
     7→---
     8→
     9→## 1. 执行摘要
    10→
    11→### 1.1 关键发现
    12→
    13→```
    14→╔═══════════════════════════════════════════════════════════════════════════════╗
    15→║                                                                               ║
    16→║   13 个用户场景覆盖度分析结果                                                   ║
    17→║                                                                               ║
    18→║   ─────────────────────────────────────────────────────────────────────────   ║
    19→║                                                                               ║
    20→║   ✅ 可满足 (基础能力已实现):     3 个场景 (23%)                               ║
    21→║   ⚠️ 需完善 (框架有/功能弱):      5 个场景 (38%)                               ║
    22→║   ❌ 需新建 (完全缺失):           5 个场景 (38%)                               ║
    23→║                                                                               ║
    24→║   ─────────────────────────────────────────────────────────────────────────   ║
    25→║                                                                               ║
    26→║   核心阻塞问题:                                                                ║
    27→║   1. 知识库严重缺失 (仅1个测试文件) → 无法提供专业解读                          ║
    28→║   2. 主动推送未闭环 → 差异化价值无法体现                                        ║
    29→║   3. 可视化组件缺失 → 用户期望的"图表"无法实现                                  ║
    30→║   4. 行动追踪系统缺失 → "如何改变"类场景全部无法满足                            ║
    31→║                                                                               ║
    32→╚═══════════════════════════════════════════════════════════════════════════════╝
    33→```
    34→
    35→### 1.2 Top 5 紧急任务
    36→
    37→| 优先级 | 任务 | 影响场景 | 工作量 |
    38→|-------|------|---------|-------|
    39→| **P0-1** | 知识库内容建设 (八字+星座) | 场景 1,2,4,10 | 2-3周 |
    40→| **P0-2** | 主动推送系统完善 | 场景 5 (核心差异化) | 1周 |
    41→| **P0-3** | 情绪急救 SOS 模式 | 场景 11 (高价值场景) | 3天 |
    42→| **P1-1** | 每日微行动系统 | 场景 7 (高频使用) | 1周 |
    43→| **P1-2** | 可视化图表组件 | 场景 1,3 (用户期望) | 1周 |
    44→
    45→---
    46→
    47→## 2. 用户场景覆盖度详细分析
    48→
    49→### 2.1 认识自我 (3个场景)
    50→
    51→#### 场景 1: 深度自我认知 (BaZi)
    52→
    53→```
    54→┌─────────────────────────────────────────────────────────────────────────────┐
    55→│ 用户诉求                                                                     │
    56→├─────────────────────────────────────────────────────────────────────────────┤
    57→│ Alex 想了解本质，明白为何内心总有与外在表现不符的纠结感。                       │
    58→│                                                                             │
    59→│ 用户期望:                                                                   │
    60→│ • 不想要晦涩的术语（如"财滋弱杀"）                                           │
    61→│ • 想要能看懂的图表                                                          │
    62→│ • 解释清楚内在与外在的反差                                                   │
    63→└─────────────────────────────────────────────────────────────────────────────┘
    64→
    65→┌─────────────────────────────────────────────────────────────────────────────┐
    66→│ 系统能力评估                                            评分: ⚠️ 需完善 (60%) │
    67→├─────────────────────────────────────────────────────────────────────────────┤
    68→│                                                                             │
    69→│ ✅ 已实现:                                                                  │
    70→│    • 八字排盘计算 (tools/bazi/calculator.py - 541行)                        │
    71→│    • Persona 现代化表达风格定义 (agent/persona.py)                          │
    72→│    • 对话系统基础框架                                                       │
    73→│                                                                             │
    74→│ ⚠️ 部分实现:                                                                │
    75→│    • 现代化语言解读 - Persona定义有，但知识库几乎为空                         │
    76→│    • "内外反差"解读 - 需要十神组合知识支撑                                   │
    77→│                                                                             │
    78→│ ❌ 未实现:                                                                  │
    79→│    • 可视化图表 - 用户期望的"能看懂的图表"                                   │
    80→│    • 命盘交互组件 - DeductionBridge 推演动画                                │
    81→│                                                                             │
    82→├─────────────────────────────────────────────────────────────────────────────┤
    83→│ 差距分析                                                                    │
    84→├─────────────────────────────────────────────────────────────────────────────┤
    85→│                                                                             │
    86→│ 1. 知识库差距 (严重)                                                        │
    87→│    当前: knowledge/bazi/ 仅1个测试文件 (2KB)                                │
    88→│    需要: 十神详解、格局分析、性格解读框架 (~50KB)                            │
    89→│                                                                             │
    90→│ 2. 可视化差距 (中等)                                                        │
    91→│    当前: 无图表组件                                                         │
    92→│    需要: BaziChart 可视化组件                                               │
    93→│                                                                             │
    94→│ 3. 内外反差解读 (需知识支撑)                                                │
    95→│    • 外在 = 年柱/月柱表现                                                   │
    96→│    • 内在 = 日柱/时柱本性                                                   │
    97→│    • 需要专业知识库支撑此类解读                                             │
    98→│                                                                             │
    99→└─────────────────────────────────────────────────────────────────────────────┘
   100→```
   101→
   102→**满足此场景需要:**
   103→1. 八字知识库建设 (十神详解、格局分析)
   104→2. BaziChart 可视化组件
   105→3. 性格解读框架 (内外对比)
   106→
   107→---
   108→
   109→#### 场景 2: 情绪模式识别 (Zodiac)
   110→
   111→```
   112→┌─────────────────────────────────────────────────────────────────────────────┐
   113→│ 用户诉求                                                                     │
   114→├─────────────────────────────────────────────────────────────────────────────┤
   115→│ Chloe 陷入情绪死循环（如等待消息时的焦虑），想知道原因。                        │
   116→│                                                                             │
   117→│ 用户期望:                                                                   │
   118→│ • 被"看见"和"理解"                                                          │
   119→│ • 指出没意识到的潜意识模式                                                   │
   120→│ • 不是泛泛的性格描述                                                        │
   121→└─────────────────────────────────────────────────────────────────────────────┘
   122→
   123→┌─────────────────────────────────────────────────────────────────────────────┐
   124→│ 系统能力评估                                            评分: ⚠️ 需完善 (50%) │
   125→├─────────────────────────────────────────────────────────────────────────────┤
   126→│                                                                             │
   127→│ ✅ 已实现:                                                                  │
   128→│    • 星盘计算 (tools/zodiac/chart.py - 420行)                               │
   129→│    • 情绪引擎框架 (emotion_engine.py - 314行)                               │
   130→│    • 洞察系统框架 (PATTERN 类型洞察定义)                                    │
   131→│                                                                             │
   132→│ ⚠️ 部分实现:                                                                │
   133→│    • 情绪识别 - 规则库不完整                                                │
   134→│    • 模式洞察 - PATTERN card 触发规则弱                                     │
   135→│                                                                             │
   136→│ ❌ 未实现:                                                                  │
   137→│    • 星座知识库 - knowledge/zodiac/ 为空                                    │
   138→│    • 潜意识模式解读 - 需要月亮/上升/宫位知识                                 │
   139→│    • "被看见"体验 - 需要更细腻的情绪响应                                    │
   140→│                                                                             │
   141→├─────────────────────────────────────────────────────────────────────────────┤
   142→│ 差距分析                                                                    │
   143→├─────────────────────────────────────────────────────────────────────────────┤
   144→│                                                                             │
   145→│ 1. 情绪感知差距 (中等)                                                      │
   146→│    emotion_engine.py 框架存在但规则不完整                                   │
   147→│    需要: 扩展情绪规则库 + LLM 辅助判断                                      │
   148→│                                                                             │
   149→│ 2. 知识库差距 (严重)                                                        │
   150→│    • 12星座情绪模式                                                         │
   151→│    • 月亮星座与潜意识                                                       │
   152→│    • 焦虑型依恋与星座关联                                                   │
   153→│                                                                             │
   154→│ 3. 模式洞察差距 (需完善)                                                    │
   155→│    PATTERN 洞察需要累积 3+ 次才触发                                         │
   156→│    需要: 情绪模式专属触发规则                                               │
   157→│                                                                             │
   158→└─────────────────────────────────────────────────────────────────────────────┘
   159→```
   160→
   161→---
   162→
   163→#### 场景 3: 认知盲点可视化 (MBTI)
   164→
   165→```
   166→┌─────────────────────────────────────────────────────────────────────────────┐
   167→│ 用户诉求                                                                     │
   168→├─────────────────────────────────────────────────────────────────────────────┤
   169→│ David 想直观看到自己的认知短板（为什么总想得多做得少）。                        │
   170→│                                                                             │
   171→│ 用户期望:                                                                   │
   172→│ • 可视化方式看到思维强项和行动弱项                                           │
   173→│ • 不觉得被冒犯                                                              │
   174→└─────────────────────────────────────────────────────────────────────────────┘
   175→
   176→┌─────────────────────────────────────────────────────────────────────────────┐
   177→│ 系统能力评估                                            评分: ❌ 需新建 (20%) │
   178→├─────────────────────────────────────────────────────────────────────────────┤
   179→│                                                                             │
   180→│ ✅ 已实现:                                                                  │
   181→│    • MBTI 页面骨架 (apps/web/src/app/mbti/)                                │
   182→│    • Skill 隔离架构                                                         │
   183→│                                                                             │
   184→│ ❌ 未实现:                                                                  │
   185→│    • MBTI 分析工具 (tools/mbti/ 为空)                                       │
   186→│    • MBTI 知识库 (knowledge/mbti/ 为空)                                     │
   187→│    • 认知功能可视化组件                                                     │
   188→│    • 强弱项光谱图表                                                         │
   189→│                                                                             │
   190→├─────────────────────────────────────────────────────────────────────────────┤
   191→│ 备注: MBTI 为 Phase 2 功能，MVP 暂不覆盖                                     │
   192→└─────────────────────────────────────────────────────────────────────────────┘
   193→```
   194→
   195→---
   196→
   197→### 2.2 理解当下 (3个场景)
   198→
   199→#### 场景 4: 运势归因 (BaZi)
   200→
   201→```
   202→┌─────────────────────────────────────────────────────────────────────────────┐
   203→│ 用户诉求                                                                     │
   204→├─────────────────────────────────────────────────────────────────────────────┤
   205→│ Alex 觉得最近诸事不顺，很累，想知道是不是自己能力有问题。                       │
   206→│                                                                             │
   207→│ 用户期望:                                                                   │
   208→│ • 客观的解释（归因）                                                        │
   209→│ • 确认这是暂时的还是长期的                                                   │
   210→│ • 减轻心理负担                                                              │
   211→└─────────────────────────────────────────────────────────────────────────────┘
   212→
   213→┌─────────────────────────────────────────────────────────────────────────────┐
   214→│ 系统能力评估                                            评分: ⚠️ 需完善 (55%) │
   215→├─────────────────────────────────────────────────────────────────────────────┤
   216→│                                                                             │
   217→│ ✅ 已实现:                                                                  │
   218→│    • 流年大运计算 (tools/bazi/transit.py)                                   │
   219→│    • 运势节点识别                                                           │
   220→│    • Persona 安抚式表达风格                                                 │
   221→│                                                                             │
   222→│ ⚠️ 部分实现:                                                                │
   223→│    • 归因解释 - 需要更深的知识库支撑                                        │
   224→│    • "暂时 vs 长期"判断 - 需要大运周期解读                                  │
   225→│                                                                             │
   226→│ ❌ 未实现:                                                                  │
   227→│    • 运势趋势可视化 (时间线图表)                                            │
   228→│    • 心理负担缓解的专属响应模板                                             │
   229→│                                                                             │
   230→├─────────────────────────────────────────────────────────────────────────────┤
   231→│ 核心需求                                                                    │
   232→├─────────────────────────────────────────────────────────────────────────────┤
   233→│                                                                             │
   234→│ 用户本质需求: "这不是我的错" 的客观证据                                      │
   235→│                                                                             │
   236→│ 系统需要提供:                                                               │
   237→│ 1. 当前运势解读 → "你现在走的是 XX 运"                                      │
   238→│ 2. 时间框架 → "这个阶段大约持续到 XX"                                       │
   239→│ 3. 正向引导 → "这是调整期，不是你的问题"                                    │
   240→│                                                                             │
   241→└─────────────────────────────────────────────────────────────────────────────┘
   242→```
   243→
   244→---
   245→
   246→#### 场景 5: 环境主动提醒 (Zodiac) ⭐ 核心差异化
   247→
   248→```
   249→┌─────────────────────────────────────────────────────────────────────────────┐
   250→│ 用户诉求                                                                     │
   251→├─────────────────────────────────────────────────────────────────────────────┤
   252→│ Chloe 想提前知道环境变化（如水逆），好做心理准备。                              │
   253→│                                                                             │
   254→│ 用户期望:                                                                   │
   255→│ • 不需要天天查                                                              │
   256→│ • 系统能主动告诉我                                                          │
   257→│ • 像朋友提醒一样                                                            │
   258→└─────────────────────────────────────────────────────────────────────────────┘
   259→
   260→┌─────────────────────────────────────────────────────────────────────────────┐
   261→│ 系统能力评估                                            评分: ⚠️ 需完善 (45%) │
   262→├─────────────────────────────────────────────────────────────────────────────┤
   263→│                                                                             │
   264→│ ✅ 已实现:                                                                  │
   265→│    • 提醒系统框架 (services/reminder/)                                      │
   266→│      - scheduler.py (事件调度)                                              │
   267→│      - calendar.py (事件日历)                                               │
   268→│      - generator.py (内容生成)                                              │
   269→│      - notification.py (通知分发)                                           │
   270→│    • 7种提醒类型定义 (包括水逆 MERCURY_RETROGRADE)                          │
   271→│    • 提醒模板定义 (vibelife spec v2.1)                                      │
   272→│                                                                             │
   273→│ ⚠️ 部分实现:                                                                │
   274→│    • 提醒触发逻辑未完整                                                     │
   275→│    • 推送通道未接入 (Web Push / 微信)                                       │
   276→│                                                                             │
   277→│ ❌ 未实现:                                                                  │
   278→│    • 星历事件数据源 (水逆日期等)                                            │
   279→│    • 用户偏好设置 UI                                                        │
   280→│    • "像朋友提醒"的个性化内容生成                                           │
   281→│                                                                             │
   282→├─────────────────────────────────────────────────────────────────────────────┤
   283→│ 重要性: ⭐⭐⭐ 这是产品核心差异化                                             │
   284→├─────────────────────────────────────────────────────────────────────────────┤
   285→│                                                                             │
   286→│ "等你开口" vs "主动关心" 是工具和朋友的本质区别                              │
   287→│                                                                             │
   288→│ 此场景直接体现 VibeLife 的核心价值主张:                                      │
   289→│ "不是工具，是关系。不是被动响应，是主动关心。"                               │
   290→│                                                                             │
   291→└─────────────────────────────────────────────────────────────────────────────┘
   292→```
   293→
   294→**此场景为 P0 优先级，需要立即完善:**
   295→1. 接入星历数据源 (水逆、月相等)
   296→2. 完善提醒触发逻辑
   297→3. 接入推送通道 (至少 Web Push)
   298→4. 实现个性化提醒内容生成
   299→
   300→---
   301→
   302→#### 场景 6: 成长确认 (MBTI)
   303→
   304→```
   305→┌─────────────────────────────────────────────────────────────────────────────┐
   306→│ 用户诉求                                                                     │
   307→├─────────────────────────────────────────────────────────────────────────────┤
   308→│ David 刚完成了一个艰难的任务，想确认自己的状态变化。                           │
   309→│                                                                             │
   310→│ 用户期望:                                                                   │
   311→│ • 自己的努力被看见                                                          │
   312→│ • 获得正向反馈                                                              │
   313→└─────────────────────────────────────────────────────────────────────────────┘
   314→
   315→┌─────────────────────────────────────────────────────────────────────────────┐
   316→│ 系统能力评估                                            评分: ⚠️ 需完善 (40%) │
   317→├─────────────────────────────────────────────────────────────────────────────┤
   318→│                                                                             │
   319→│ ✅ 已实现:                                                                  │
   320→│    • GROWTH 洞察类型定义 (insight_generator.py)                             │
   321→│    • 用户画像系统 - 可追踪状态变化                                          │
   322→│    • 洞察卡片框架                                                           │
   323→│                                                                             │
   324→│ ⚠️ 部分实现:                                                                │
   325→│    • GROWTH 触发规则 - 需要检测"行为突破"                                   │
   326→│    • 与历史自述对比 - portrait 有 Facts/State 但对比逻辑弱                  │
   327→│                                                                             │
   328→│ ❌ 未实现:                                                                  │
   329→│    • 主动检测"成长信号"                                                     │
   330→│    • 成长时刻的庆祝 UI                                                      │
   331→│                                                                             │
   332→├─────────────────────────────────────────────────────────────────────────────┤
   333→│ 技术可行性: 此场景可通过完善 GROWTH 触发规则实现                              │
   334→├─────────────────────────────────────────────────────────────────────────────┤
   335→│                                                                             │
   336→│ 实现方案:                                                                   │
   337→│ 1. 在 portrait 更新时，对比 "上次 State" vs "当前 State"                   │
   338→│ 2. 如果发现积极变化，触发 GROWTH 洞察                                       │
   339→│ 3. 用温暖的语言呈现 "你成长了"                                              │
   340→│                                                                             │
   341→└─────────────────────────────────────────────────────────────────────────────┘
   342→```
   343→
   344→---
   345→
   346→### 2.3 如何改变 (3个场景)
   347→
   348→#### 场景 7: 每日微行动 (BaZi) ⭐ 高频场景
   349→
   350→```
   351→┌─────────────────────────────────────────────────────────────────────────────┐
   352→│ 用户诉求                                                                     │
   353→├─────────────────────────────────────────────────────────────────────────────┤
   354→│ Alex 想改善运势，不想听大道理，只想知道今天具体做什么。                         │
   355→│                                                                             │
   356→│ 用户期望:                                                                   │
   357→│ • 简单、可执行、低门槛的建议                                                 │
   358→│ • 最好只有一条                                                              │
   359→│ • 做完就很有成就感                                                          │
   360→└─────────────────────────────────────────────────────────────────────────────┘
   361→
   362→┌─────────────────────────────────────────────────────────────────────────────┐
   363→│ 系统能力评估                                            评分: ❌ 需新建 (10%) │
   364→├─────────────────────────────────────────────────────────────────────────────┤
   365→│                                                                             │
   366→│ ✅ 已实现:                                                                  │
   367→│    • 提醒系统框架 (可复用)                                                  │
   368→│    • 运势计算基础                                                           │
   369→│                                                                             │
   370→│ ❌ 未实现:                                                                  │
   371→│    • 每日建议生成逻辑                                                       │
   372→│    • 微行动库 (五行对应的具体行动)                                          │
   373→│    • 行动完成追踪                                                           │
   374→│    • 成就感反馈 UI                                                          │
   375→│                                                                             │
   376→├─────────────────────────────────────────────────────────────────────────────┤
   377→│ 设计方案                                                                    │
   378→├─────────────────────────────────────────────────────────────────────────────┤
   379→│                                                                             │
   380→│ 核心逻辑:                                                                   │
   381→│ 1. 根据用户五行喜忌 + 当日流日，生成"今日微行动"                             │
   382→│ 2. 每日一条，简单可执行                                                     │
   383→│ 3. 用户可标记"已完成"，触发正向反馈                                         │
   384→│                                                                             │
   385→│ 微行动示例:                                                                 │
   386→│ • 五行缺水: "今天多喝水，或者听一首轻音乐"                                   │
   387→│ • 五行缺木: "今天走一条不一样的路上班"                                       │
   388→│ • 五行缺火: "今天主动和一个人打招呼"                                         │
   389→│                                                                             │
   390→│ 所需组件:                                                                   │
   391→│ 1. daily_action_generator.py - 每日行动生成                                 │
   392→│ 2. action_library.json - 五行微行动库                                       │
   393→│ 3. DailyActionCard.tsx - 前端展示                                           │
   394→│ 4. 行动完成追踪表                                                           │
   395→│                                                                             │
   396→└─────────────────────────────────────────────────────────────────────────────┘
   397→```
   398→
   399→---
   400→
   401→#### 场景 8: 长程转型计划 (BaZi)
   402→
   403→```
   404→┌─────────────────────────────────────────────────────────────────────────────┐
   405→│ 用户诉求                                                                     │
   406→├─────────────────────────────────────────────────────────────────────────────┤
   407→│ Alex 想要转行，需要一个长期的过渡计划。                                       │
   408→│                                                                             │
   409→│ 用户期望:                                                                   │
   410→│ • 把大目标拆解成每一步的计划                                                 │
   411→│ • 能帮我追踪进度                                                            │
   412→└─────────────────────────────────────────────────────────────────────────────┘
   413→
   414→┌─────────────────────────────────────────────────────────────────────────────┐
   415→│ 系统能力评估                                            评分: ❌ 需新建 (5%)  │
   416→├─────────────────────────────────────────────────────────────────────────────┤
   417→│                                                                             │
   418→│ ❌ 完全未实现:                                                              │
   419→│    • 计划管理系统                                                           │
   420→│    • 目标拆解功能                                                           │
   421→│    • 进度追踪                                                               │
   422→│    • 运势节点与计划结合                                                     │
   423→│                                                                             │
   424→├─────────────────────────────────────────────────────────────────────────────┤
   425→│ 复杂度评估: 高 (需要完整的计划管理子系统)                                     │
   426→├─────────────────────────────────────────────────────────────────────────────┤
   427→│                                                                             │
   428→│ 建议: 此场景为 P2 优先级，MVP 阶段可简化为:                                  │
   429→│ • 通过对话提供阶段性建议                                                    │
   430→│ • 不做完整的计划管理系统                                                    │
   431→│                                                                             │
   432→└─────────────────────────────────────────────────────────────────────────────┘
   433→```
   434→
   435→---
   436→
   437→#### 场景 9: 专注伴随 (MBTI)
   438→
   439→```
   440→┌─────────────────────────────────────────────────────────────────────────────┐
   441→│ 用户诉求                                                                     │
   442→├─────────────────────────────────────────────────────────────────────────────┤
   443→│ David 知道自己拖延，需要有人推一把，强制开始执行。                             │
   444→│                                                                             │
   445→│ 用户期望:                                                                   │
   446→│ • "脚手架"或监督机制                                                        │
   447→│ • 帮我跨过"开始"这个最难的门槛                                               │
   448→└─────────────────────────────────────────────────────────────────────────────┘
   449→
   450→┌─────────────────────────────────────────────────────────────────────────────┐
   451→│ 系统能力评估                                            评分: ❌ 需新建 (0%)  │
   452→├─────────────────────────────────────────────────────────────────────────────┤
   453→│                                                                             │
   454→│ ❌ 完全未实现:                                                              │
   455→│    • 番茄钟/专注模式                                                        │
   456→│    • 开始提醒                                                               │
   457→│    • 进度检查点                                                             │
   458→│    • 完成庆祝                                                               │
   459→│                                                                             │
   460→├─────────────────────────────────────────────────────────────────────────────┤
   461→│ 备注: MBTI 为 Phase 2 功能，此场景 MVP 暂不覆盖                               │
   462→└─────────────────────────────────────────────────────────────────────────────┘
   463→```
   464→
   465→---
   466→
   467→### 2.4 咨询问事 (2个场景)
   468→
   469→#### 场景 10: 职业决策 (BaZi)
   470→
   471→```
   472→┌─────────────────────────────────────────────────────────────────────────────┐
   473→│ 用户诉求                                                                     │
   474→├─────────────────────────────────────────────────────────────────────────────┤
   475→│ Alex 面临职业重大决策（如裸辞创业），犹豫不决。                                │
   476→│                                                                             │
   477→│ 用户期望:                                                                   │
   478→│ • 理性的风险评估和建议                                                       │
   479→│ • 不是算命式的"你会发财"或"你会破产"                                         │
   480→└─────────────────────────────────────────────────────────────────────────────┘
   481→
   482→┌─────────────────────────────────────────────────────────────────────────────┐
   483→│ 系统能力评估                                            评分: ✅ 可满足 (75%) │
   484→├─────────────────────────────────────────────────────────────────────────────┤
   485→│                                                                             │
   486→│ ✅ 已实现:                                                                  │
   487→│    • 流年大运分析 (transit.py)                                              │
   488→│    • Persona 定义: "不预测具体事件，强调选择权"                              │
   489→│    • 对话系统支持深度咨询                                                   │
   490→│                                                                             │
   491→│ ⚠️ 需完善:                                                                  │
   492→│    • 职业/事业类知识库                                                       │
   493→│    • 风险评估框架                                                           │
   494→│                                                                             │
   495→├─────────────────────────────────────────────────────────────────────────────┤
   496→│ Persona 指南 (已定义)                                                       │
   497→├─────────────────────────────────────────────────────────────────────────────┤
   498→│                                                                             │
   499→│ boundaries:                                                                 │
   500→│ - 不做具体事件预测（如"你明年会结婚"）                                       │
   501→│ - 不贩卖焦虑                                                                │
   502→│ - 不说绝对的话                                                              │
   503→│ - 强调命理是参考，不是宿命                                                   │
   504→│                                                                             │
   505→│ 示例响应:                                                                   │
   506→│ ❌ "你今年犯太岁，运势很差，要小心"                                          │
   507→│ ✅ "今年是你的'调整年'，适合慢下来思考。有什么特别想完成的目标吗？"           │
   508→│                                                                             │
   509→└─────────────────────────────────────────────────────────────────────────────┘
   510→```
   511→
   512→---
   513→
   514→#### 场景 11: 情绪急救 SOS (Zodiac) ⭐ 高价值场景
   515→
   516→```
   517→┌─────────────────────────────────────────────────────────────────────────────┐
   518→│ 用户诉求                                                                     │
   519→├─────────────────────────────────────────────────────────────────────────────┤
   520→│ Chloe 情绪崩溃，深夜焦虑哭泣，无法理性思考。                                   │
   521→│                                                                             │
   522→│ 用户期望:                                                                   │
   523→│ • 不需要理性分析星盘                                                        │
   524→│ • 只需要陪伴、倾听和安抚                                                    │
   525→│ • 像一个耐心的朋友                                                          │
   526→└─────────────────────────────────────────────────────────────────────────────┘
   527→
   528→┌─────────────────────────────────────────────────────────────────────────────┐
   529→│ 系统能力评估                                            评分: ⚠️ 需完善 (35%) │
   530→├─────────────────────────────────────────────────────────────────────────────┤
   531→│                                                                             │
   532→│ ✅ 已实现:                                                                  │
   533→│    • 情绪引擎框架 (emotion_engine.py)                                       │
   534→│    • Persona 温暖风格定义                                                   │
   535→│                                                                             │
   536→│ ⚠️ 部分实现:                                                                │
   537→│    • 情绪感知 - 需要增强负面情绪识别                                        │
   538→│    • 安抚模式 - 有框架但无专门的 SOS 响应流程                               │
   539→│                                                                             │
   540→│ ❌ 未实现:                                                                  │
   541→│    • SOS 模式自动切换                                                       │
   542→│    • 专属安抚话术库                                                         │
   543→│    • 危机干预指引 (如识别到自伤倾向时的处理)                                │
   544→│                                                                             │
   545→├─────────────────────────────────────────────────────────────────────────────┤
   546→│ 设计方案: 情绪急救 SOS 模式                                                  │
   547→├─────────────────────────────────────────────────────────────────────────────┤
   548→│                                                                             │
   549→│ 触发条件 (emotion_engine 检测):                                             │
   550→│ • 关键词: "崩溃"、"受不了"、"想死"、"太难了"                                 │
   551→│ • 时间: 深夜 (00:00-05:00) + 负面情绪                                       │
   552→│ • 情绪强度 > 0.8                                                            │
   553→│                                                                             │
   554→│ SOS 模式行为:                                                               │
   555→│ 1. 暂停 Skill 分析（不讲星座理论）                                          │
   556→│ 2. 切换到纯陪伴模式                                                         │
   557→│ 3. 使用专属安抚话术                                                         │
   558→│ 4. 必要时提供专业求助热线                                                   │
   559→│                                                                             │
   560→│ 示例响应:                                                                   │
   561→│ "我感觉到你现在很不好受。                                                   │
   562→│  不用说什么，我就在这里。                                                   │
   563→│  深呼吸...慢慢来。                                                          │
   564→│  你不是一个人。"                                                            │
   565→│                                                                             │
   566→└─────────────────────────────────────────────────────────────────────────────┘
   567→```
   568→
   569→---
   570→
   571→### 2.5 合盘 (2个场景)
   572→
   573→#### 场景 12: 合伙人隐私匹配 (BaZi)
   574→
   575→```
   576→┌─────────────────────────────────────────────────────────────────────────────┐
   577→│ 用户诉求                                                                     │
   578→├─────────────────────────────────────────────────────────────────────────────┤
   579→│ Alex 找合伙人，想看合不合，但不能问对方要具体生辰。                            │
   580→│                                                                             │
   581→│ 用户期望:                                                                   │
   582→│ • 保护隐私                                                                  │
   583→│ • 不需要对方知道我算了他在想什么                                             │
   584→│ • 只需要知道怎么配合                                                        │
   585→└─────────────────────────────────────────────────────────────────────────────┘
   586→
   587→┌─────────────────────────────────────────────────────────────────────────────┐
   588→│ 系统能力评估                                            评分: ❌ 需新建 (0%)  │
   589→├─────────────────────────────────────────────────────────────────────────────┤
   590→│                                                                             │
   591→│ ❌ 完全未实现:                                                              │
   592→│    • 单方合盘功能                                                           │
   593→│    • 模糊信息推断 (仅知道年份/属相)                                          │
   594→│    • 配合建议生成                                                           │
   595→│                                                                             │
   596→├─────────────────────────────────────────────────────────────────────────────┤
   597→│ 设计方案: 单方合盘 (隐私保护版)                                              │
   598→├─────────────────────────────────────────────────────────────────────────────┤
   599→│                                                                             │
   600→│ 用户输入:                                                                   │
   601→│ • 对方大概年龄 或 属相                                                      │
   602→│ • 对方的外显特征描述 (可选)                                                 │
   603→│                                                                             │
   604→│ 系统输出:                                                                   │
   605→│ • 基于年份推断对方可能的性格特点                                            │
   606→│ • 与用户命盘的潜在互动模式                                                  │
   607→│ • 具体配合建议 (如何相处、如何沟通)                                         │
   608→│                                                                             │
   609→│ 示例:                                                                       │
   610→│ 用户: "对方是属虎的，大概35岁左右"                                          │
   611→│ 系统: "1990年属虎(庚午年)的人...和你的甲木日主是'正官'关系，                │
   612→│        这意味着...建议你在合作中..."                                        │
   613→│                                                                             │
   614→└─────────────────────────────────────────────────────────────────────────────┘
   615→```
   616→
   617→---
   618→
   619→#### 场景 13: 行动处方 (Zodiac)
   620→
   621→```
   622→┌─────────────────────────────────────────────────────────────────────────────┐
   623→│ 用户诉求                                                                     │
   624→├─────────────────────────────────────────────────────────────────────────────┤
   625→│ Chloe 想搞定暧昧对象，想知道怎么回消息对方才高兴。                             │
   626→│                                                                             │
   627→│ 用户期望:                                                                   │
   628→│ • 具体的、可复制的行动指南                                                   │
   629→│ • 甚至是直接的话术模板                                                      │
   630→└─────────────────────────────────────────────────────────────────────────────┘
   631→
   632→┌─────────────────────────────────────────────────────────────────────────────┐
   633→│ 系统能力评估                                            评分: ❌ 需新建 (10%) │
   634→├─────────────────────────────────────────────────────────────────────────────┤
   635→│                                                                             │
   636→│ ✅ 已实现:                                                                  │
   637→│    • 星座星盘分析基础                                                       │
   638→│    • 对话系统                                                               │
   639→│                                                                             │
   640→│ ❌ 未实现:                                                                  │
   641→│    • 星座配对知识库                                                         │
   642→│    • 话术模板引擎                                                           │
   643→│    • 场景化行动建议                                                         │
   644→│                                                                             │
   645→├─────────────────────────────────────────────────────────────────────────────┤
   646→│ 设计方案: 话术模板引擎                                                       │
   647→├─────────────────────────────────────────────────────────────────────────────┤
   648→│                                                                             │
   649→│ 用户输入:                                                                   │
   650→│ • 对方星座 (或大概生日)                                                     │
   651→│ • 当前情境 (刚认识/暧昧期/争吵后)                                           │
   652→│ • 想达成的目标 (约出来/和好/表白)                                           │
   653→│                                                                             │
   654→│ 系统输出:                                                                   │
   655→│ • 对方星座的沟通偏好分析                                                    │
   656→│ • 可直接使用的话术模板 (2-3个选项)                                          │
   657→│ • 发送时机建议                                                              │
   658→│                                                                             │
   659→│ 示例:                                                                       │
   660→│ 用户: "他是处女座，我们吵架了，我想和好"                                     │
   661→│ 系统: "处女座在吵架后需要冷静期...                                          │
   662→│        建议在 2-3 天后发送:                                                 │
   663→│        Option A: '上次是我说话太冲了，对不起。'                              │
   664→│        Option B: '我反思了一下，你说的有道理...'                             │
   665→│        最佳时机: 下午茶时间 (15:00-17:00)"                                   │
   666→│                                                                             │
   667→└─────────────────────────────────────────────────────────────────────────────┘
   668→```
   669→
   670→---
   671→
   672→## 3. 架构差距优先级排序
   673→
   674→### 3.1 P0 - 阻塞核心体验 (必须在 MVP 前完成)
   675→
   676→```
   677→╔═══════════════════════════════════════════════════════════════════════════════╗
   678→║ P0-1: 知识库内容建设                                                          ║
   679→╠═══════════════════════════════════════════════════════════════════════════════╣
   680→║                                                                               ║
   681→║ 当前状态: 🔴 严重缺失                                                         ║
   682→║ • 八字: 仅1个测试文件 (2KB)                                                   ║
   683→║ • 星座: 完全为空                                                              ║
   684→║                                                                               ║
   685→║ 影响场景: 1, 2, 4, 10 (4个核心场景无法提供专业解读)                            ║
   686→║                                                                               ║
   687→║ 所需工作:                                                                     ║
   688→║ ├── 八字知识库 (~50KB)                                                        ║
   689→║ │   ├── theory/ (天干地支、十神、五行)                                        ║
   690→║ │   ├── patterns/ (格局分析)                                                  ║
   691→║ │   ├── transit/ (大运流年)                                                   ║
   692→║ │   └── analysis/ (性格、事业、感情解读框架)                                  ║
   693→║ │                                                                             ║
   694→║ └── 星座知识库 (~40KB)                                                        ║
   695→║     ├── signs/ (12星座)                                                       ║
   696→║     ├── houses/ (12宫位)                                                      ║
   697→║     ├── planets/ (10行星)                                                     ║
   698→║     └── aspects/ (主要相位)                                                   ║
   699→║                                                                               ║
   700→║ 工作量: 2-3 周                                                                ║
   701→║ 负责路径: knowledge/bazi/, knowledge/zodiac/                                  ║
   702→║                                                                               ║
   703→╚═══════════════════════════════════════════════════════════════════════════════╝
   704→
   705→╔═══════════════════════════════════════════════════════════════════════════════╗
   706→║ P0-2: 主动推送系统完善                                                        ║
   707→╠═══════════════════════════════════════════════════════════════════════════════╣
   708→║                                                                               ║
   709→║ 当前状态: 🟡 框架存在，逻辑未完整                                              ║
   710→║                                                                               ║
   711→║ 影响场景: 5 (核心差异化)                                                      ║
   712→║ 这是 "等你开口" vs "主动关心" 的本质区别                                      ║
   713→║                                                                               ║
   714→║ 所需工作:                                                                     ║
   715→║ 1. 接入星历数据源 (水逆日期、月相等)                                          ║
   716→║ 2. 完善 scheduler.py 触发逻辑                                                 ║
   717→║ 3. 实现 generator.py 个性化内容生成                                           ║
   718→║ 4. 接入推送通道 (Web Push 优先)                                               ║
   719→║ 5. 用户偏好设置 UI                                                            ║
   720→║                                                                               ║
   721→║ 工作量: 1 周                                                                  ║
   722→║ 负责路径: services/reminder/                                                  ║
   723→║                                                                               ║
   724→╚═══════════════════════════════════════════════════════════════════════════════╝
   725→
   726→╔═══════════════════════════════════════════════════════════════════════════════╗
   727→║ P0-3: 情绪急救 SOS 模式                                                       ║
   728→╠═══════════════════════════════════════════════════════════════════════════════╣
   729→║                                                                               ║
   730→║ 当前状态: 🟡 情绪引擎框架存在，SOS 模式未实现                                  ║
   731→║                                                                               ║
   732→║ 影响场景: 11 (高价值场景，用户最脆弱时刻)                                      ║
   733→║                                                                               ║
   734→║ 所需工作:                                                                     ║
   735→║ 1. 增强 emotion_engine.py 负面情绪识别                                        ║
   736→║ 2. 实现 SOS 模式自动切换逻辑                                                  ║
   737→║ 3. 创建安抚话术库                                                             ║
   738→║ 4. 添加危机干预指引                                                           ║
   739→║                                                                               ║
   740→║ 工作量: 3 天                                                                  ║
   741→║ 负责路径: services/vibe_engine/emotion_engine.py                              ║
   742→║                                                                               ║
   743→╚═══════════════════════════════════════════════════════════════════════════════╝
   744→```
   745→
   746→### 3.2 P1 - 影响差异化 (上线后 4 周内完成)
   747→
   748→```
   749→╔═══════════════════════════════════════════════════════════════════════════════╗
   750→║ P1-1: 每日微行动系统                                                          ║
   751→╠═══════════════════════════════════════════════════════════════════════════════╣
   752→║                                                                               ║
   753→║ 影响场景: 7 (高频使用场景)                                                    ║
   754→║                                                                               ║
   755→║ 所需工作:                                                                     ║
   756→║ 1. 创建 daily_action_generator.py                                             ║
   757→║ 2. 创建五行微行动库 (action_library.json)                                     ║
   758→║ 3. 创建 DailyActionCard.tsx 组件                                              ║
   759→║ 4. 行动完成追踪数据表                                                         ║
   760→║                                                                               ║
   761→║ 工作量: 1 周                                                                  ║
   762→║                                                                               ║
   763→╚═══════════════════════════════════════════════════════════════════════════════╝
   764→
   765→╔═══════════════════════════════════════════════════════════════════════════════╗
   766→║ P1-2: 可视化图表组件                                                          ║
   767→╠═══════════════════════════════════════════════════════════════════════════════╣
   768→║                                                                               ║
   769→║ 影响场景: 1, 3 (用户明确期望"能看懂的图表")                                    ║
   770→║                                                                               ║
   771→║ 所需工作:                                                                     ║
   772→║ 1. BaziChart.tsx - 八字命盘可视化                                             ║
   773→║ 2. ZodiacChart.tsx - 星盘可视化                                               ║
   774→║ 3. 推演过场动画 (DeductionBridge.tsx)                                         ║
   775→║                                                                               ║
   776→║ 工作量: 1 周                                                                  ║
   777→║                                                                               ║
   778→╚═══════════════════════════════════════════════════════════════════════════════╝
   779→
   780→╔═══════════════════════════════════════════════════════════════════════════════╗
   781→║ P1-3: GROWTH 洞察触发完善                                                     ║
   782→╠═══════════════════════════════════════════════════════════════════════════════╣
   783→║                                                                               ║
   784→║ 影响场景: 6 (成长确认)                                                        ║
   785→║                                                                               ║
   786→║ 所需工作:                                                                     ║
   787→║ 1. 完善 insight_generator.py GROWTH 触发规则                                  ║
   788→║ 2. 实现 portrait 前后对比逻辑                                                 ║
   789→║ 3. 成长庆祝 UI                                                                ║
   790→║                                                                               ║
   791→║ 工作量: 3 天                                                                  ║
   792→║                                                                               ║
   793→╚═══════════════════════════════════════════════════════════════════════════════╝
   794→```
   795→
   796→### 3.3 P2 - 增强体验 (可迭代完成)
   797→
   798→```
   799→╔═══════════════════════════════════════════════════════════════════════════════╗
   800→║ P2-1: 单方合盘功能                                                            ║
   801→╠═══════════════════════════════════════════════════════════════════════════════╣
   802→║ 影响场景: 12                                                                  ║
   803→║ 工作量: 1 周                                                                  ║
   804→╚═══════════════════════════════════════════════════════════════════════════════╝
   805→
   806→╔═══════════════════════════════════════════════════════════════════════════════╗
   807→║ P2-2: 话术模板引擎                                                            ║
   808→╠═══════════════════════════════════════════════════════════════════════════════╣
   809→║ 影响场景: 13                                                                  ║
   810→║ 工作量: 1 周                                                                  ║
   811→╚═══════════════════════════════════════════════════════════════════════════════╝
   812→
   813→╔═══════════════════════════════════════════════════════════════════════════════╗
   814→║ P2-3: 长程计划追踪系统                                                        ║
   815→╠═══════════════════════════════════════════════════════════════════════════════╣
   816→║ 影响场景: 8                                                                   ║
   817→║ 工作量: 2 周                                                                  ║
   818→║ 建议: MVP 阶段简化为对话式建议                                                ║
   819→╚═══════════════════════════════════════════════════════════════════════════════╝
   820→
   821→╔═══════════════════════════════════════════════════════════════════════════════╗
   822→║ P2-4: MBTI 完整实现                                                           ║
   823→╠═══════════════════════════════════════════════════════════════════════════════╣
   824→║ 影响场景: 3, 6, 9                                                             ║
   825→║ 工作量: 3 周                                                                  ║
   826→║ 建议: 作为 Phase 2 功能                                                       ║
   827→╚═══════════════════════════════════════════════════════════════════════════════╝
   828→```
   829→
   830→---
   831→
   832→## 4. 新功能设计方案
   833→
   834→### 4.1 主动推送系统完善
   835→
   836→```
   837→┌─────────────────────────────────────────────────────────────────────────────┐
   838→│                                                                             │
   839→│   PROACTIVE REMINDER SYSTEM V2                                              │
   840→│                                                                             │
   841→│   ═══════════════════════════════════════════════════════════════════════   │
   842→│                                                                             │
   843→│   架构                                                                      │
   844→│   ─────────────────────────────────────────────────────────────────────     │
   845→│                                                                             │
   846→│   ┌─────────────────────────────────────────────────────────────────────┐   │
   847→│   │                                                                     │   │
   848→│   │   Event Sources (事件源)                                            │   │
   849→│   │   ─────────────────────────────────────────────────────────────     │   │
   850→│   │                                                                     │   │
   851→│   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │   │
   852→│   │   │   BAZI      │  │   ZODIAC    │  │   CALENDAR  │                │   │
   853→│   │   │   Events    │  │   Events    │  │   Events    │                │   │
   854→│   │   │             │  │             │  │             │                │   │
   855→│   │   │ • 月运交接  │  │ • 水逆      │  │ • 生日      │                │   │
   856→│   │   │ • 流年交接  │  │ • 新月满月  │  │ • 纪念日    │                │   │
   857→│   │   │ • 大运交接  │  │ • 周运      │  │             │                │   │
   858→│   │   └─────────────┘  └─────────────┘  └─────────────┘                │   │
   859→│   │                                                                     │   │
   860→│   └───────────────────────────────┬─────────────────────────────────────┘   │
   861→│                                   │                                         │
   862→│                                   ▼                                         │
   863→│   ┌─────────────────────────────────────────────────────────────────────┐   │
   864→│   │                                                                     │   │
   865→│   │   Scheduler (调度器)                                                │   │
   866→│   │   ─────────────────────────────────────────────────────────────     │   │
   867→│   │                                                                     │   │
   868→│   │   Cron Job: 每日 00:00 检查即将到来的事件                           │   │
   869→│   │   触发逻辑:                                                         │   │
   870→│   │   • 月运交接: 提前 1-2 天                                           │   │
   871→│   │   • 水逆: 开始前 2-3 天 / 结束时                                    │   │
   872→│   │   • 新月满月: 当天                                                  │   │
   873→│   │                                                                     │   │
   874→│   └───────────────────────────────┬─────────────────────────────────────┘   │
   875→│                                   │                                         │
   876→│                                   ▼                                         │
   877→│   ┌─────────────────────────────────────────────────────────────────────┐   │
   878→│   │                                                                     │   │
   879→│   │   Generator (内容生成)                                              │   │
   880→│   │   ─────────────────────────────────────────────────────────────     │   │
   881→│   │                                                                     │   │
   882→│   │   LLM 生成个性化内容:                                               │   │
   883→│   │   • 读取用户 portrait                                               │   │
   884→│   │   • 读取用户命盘/星座                                               │   │
   885→│   │   • 生成"像朋友提醒"的内容                                          │   │
   886→│   │                                                                     │   │
   887→│   └───────────────────────────────┬─────────────────────────────────────┘   │
   888→│                                   │                                         │
   889→│                                   ▼                                         │
   890→│   ┌─────────────────────────────────────────────────────────────────────┐   │
   891→│   │                                                                     │   │
   892→│   │   Notification (通知分发)                                           │   │
   893→│   │   ─────────────────────────────────────────────────────────────     │   │
   894→│   │                                                                     │   │
   895→│   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │   │
   896→│   │   │  Web Push   │  │  In-App     │  │  WeChat     │                │   │
   897→│   │   │  (MVP)      │  │  Inbox      │  │  (Phase 2)  │                │   │
   898→│   │   └─────────────┘  └─────────────┘  └─────────────┘                │   │
   899→│   │                                                                     │   │
   900→│   └─────────────────────────────────────────────────────────────────────┘   │
   901→│                                                                             │
   902→└─────────────────────────────────────────────────────────────────────────────┘
   903→```
   904→
   905→**关键文件:**
   906→- `apps/api/services/reminder/scheduler.py` - 完善触发逻辑
   907→- `apps/api/services/reminder/generator.py` - 实现 LLM 生成
   908→- `apps/api/services/reminder/notification.py` - 接入 Web Push
   909→- `apps/api/data/ephemeris.json` - 星历数据 (水逆日期等)
   910→
   911→---
   912→
   913→### 4.2 每日微行动系统
   914→
   915→```
   916→┌─────────────────────────────────────────────────────────────────────────────┐
   917→│                                                                             │
   918→│   DAILY MICRO-ACTION SYSTEM                                                 │
   919→│                                                                             │
   920→│   ═══════════════════════════════════════════════════════════════════════   │
   921→│                                                                             │
   922→│   用户流程                                                                  │
   923→│   ─────────────────────────────────────────────────────────────────────     │
   924→│                                                                             │
   925→│   1. 每日推送 (或用户主动查看)                                              │
   926→│      ┌─────────────────────────────────────────────────────────────────┐    │
   927→│      │  🌟 今日微行动                                                  │    │
   928→│      │  ─────────────────────────────────────────────────────────────  │    │
   929→│      │                                                                 │    │
   930→│      │  今天你的五行偏弱于"水"                                          │    │
   931→│      │                                                                 │    │
   932→│      │  ┌───────────────────────────────────────────────────────────┐  │    │
   933→│      │  │  💧 今日建议                                              │  │    │
   934→│      │  │                                                           │  │    │
   935→│      │  │  "多喝水，或者听一首轻音乐放松一下"                         │  │    │
   936→│      │  │                                                           │  │    │
   937→│      │  │  [ 我做到了 ✓ ]     [ 换一个建议 ]                         │  │    │
   938→│      │  └───────────────────────────────────────────────────────────┘  │    │
   939→│      │                                                                 │    │
   940→│      └─────────────────────────────────────────────────────────────────┘    │
   941→│                                                                             │
   942→│   2. 完成反馈                                                               │
   943→│      ┌─────────────────────────────────────────────────────────────────┐    │
   944→│      │  🎉 太棒了！                                                    │    │
   945→│      │                                                                 │    │
   946→│      │  你今天完成了微行动。                                           │    │
   947→│      │  这个小小的行动，正在帮你平衡能量。                             │    │
   948→│      │                                                                 │    │
   949→│      │  [ 本周已完成 5 次 ]                                            │    │
   950→│      └─────────────────────────────────────────────────────────────────┘    │
   951→│                                                                             │
   952→│   ═══════════════════════════════════════════════════════════════════════   │
   953→│                                                                             │
   954→│   技术实现                                                                  │
   955→│   ─────────────────────────────────────────────────────────────────────     │
   956→│                                                                             │
   957→│   1. daily_action_generator.py                                              │
   958→│      ───────────────────────────────────────                                │
   959→│      • 读取用户八字 (五行喜忌)                                              │
   960→│      • 读取当日流日 (当天五行)                                              │
   961→│      • 从 action_library 选择合适的微行动                                   │
   962→│                                                                             │
   963→│   2. action_library.json                                                    │
   964→│      ───────────────────────────────────────                                │
   965→│      {                                                                      │
   966→│        "water": [                                                           │
   967→│          {"action": "多喝水，或者听一首轻音乐", "difficulty": 1},           │
   968→│          {"action": "今天尝试一条新的路线", "difficulty": 2}                │
   969→│        ],                                                                   │
   970→│        "wood": [                                                            │
   971→│          {"action": "今天走一条不一样的路上班", "difficulty": 1},           │
   972→│          {"action": "给家里的植物浇浇水", "difficulty": 1}                  │
   973→│        ],                                                                   │
   974→│        ...                                                                  │
   975→│      }                                                                      │
   976→│                                                                             │
   977→│   3. 数据表                                                                 │
   978→│      ───────────────────────────────────────                                │
   979→│      daily_actions (                                                        │
   980→│        id, user_id, date, action_text, element,                            │
   981→│        completed_at, created_at                                            │
   982→│      )                                                                      │
   983→│                                                                             │
   984→└─────────────────────────────────────────────────────────────────────────────┘
   985→```
   986→
   987→**关键文件 (新建):**
   988→- `apps/api/services/vibe_engine/daily_action_generator.py`
   989→- `apps/api/data/action_library.json`
   990→- `apps/web/src/components/action/DailyActionCard.tsx`
   991→
   992→---
   993→
   994→### 4.3 情绪急救 SOS 模式
   995→
   996→```
   997→┌─────────────────────────────────────────────────────────────────────────────┐
   998→│                                                                             │
   999→│   EMOTIONAL SOS MODE                                                        │
  1000→│                                                                             │
  1001→│   ═══════════════════════════════════════════════════════════════════════   │
  1002→│                                                                             │
  1003→│   触发条件                                                                  │
  1004→│   ─────────────────────────────────────────────────────────────────────     │
  1005→│                                                                             │
  1006→│   任一条件满足即触发:                                                       │
  1007→│                                                                             │
  1008→│   1. 关键词检测                                                             │
  1009→│      • 危机词: "想死"、"活不下去"、"自杀"、"结束"                            │
  1010→│      • 崩溃词: "崩溃"、"受不了"、"撑不住"、"太难了"                          │
  1011→│      • 求助词: "救我"、"帮帮我"、"怎么办"                                   │
  1012→│                                                                             │
  1013→│   2. 时间 + 情绪组合                                                        │
  1014→│      • 深夜 (00:00-05:00) + 负面情绪强度 > 0.7                              │
  1015→│                                                                             │
  1016→│   3. 情绪强度                                                               │
  1017→│      • 单条消息负面情绪强度 > 0.9                                           │
  1018→│                                                                             │
  1019→│   ═══════════════════════════════════════════════════════════════════════   │
  1020→│                                                                             │
  1021→│   SOS 模式行为                                                              │
  1022→│   ─────────────────────────────────────────────────────────────────────     │
  1023→│                                                                             │
  1024→│   ┌─────────────────────────────────────────────────────────────────────┐   │
  1025→│   │                                                                     │   │
  1026→│   │   1. 暂停 Skill 分析                                                │   │
  1027→│   │      • 不讲星座/八字理论                                            │   │
  1028→│   │      • 不给"运势解释"                                               │   │
  1029→│   │                                                                     │   │
  1030→│   │   2. 切换到纯陪伴模式                                               │   │
  1031→│   │      • 倾听                                                         │   │
  1032→│   │      • 共情                                                         │   │
  1033→│   │      • 不给建议                                                     │   │
  1034→│   │                                                                     │   │
  1035→│   │   3. 使用专属安抚话术                                               │   │
  1036→│   │                                                                     │   │
  1037→│   │   4. 危机干预 (如检测到自伤倾向)                                    │   │
  1038→│   │      • 提供专业求助热线                                             │   │
  1039→│   │      • 全国心理援助热线: 400-161-9995                               │   │
  1040→│   │      • 北京心理危机研究与干预中心: 010-82951332                     │   │
  1041→│   │                                                                     │   │
  1042→│   └─────────────────────────────────────────────────────────────────────┘   │
  1043→│                                                                             │
  1044→│   ═══════════════════════════════════════════════════════════════════════   │
  1045→│                                                                             │
  1046→│   安抚话术示例                                                              │
  1047→│   ─────────────────────────────────────────────────────────────────────     │
  1048→│                                                                             │
  1049→│   Level 1 (轻度情绪低落):                                                   │
  1050→│   "我感觉到你现在不太好受。                                                 │
  1051→│    想聊聊吗？或者只是待一会儿也可以。"                                      │
  1052→│                                                                             │
  1053→│   Level 2 (中度崩溃):                                                       │
  1054→│   "我在这里。                                                               │
  1055→│    深呼吸...慢慢来。                                                        │
  1056→│    你不用说什么，我就在这里陪着你。"                                        │
  1057→│                                                                             │
  1058→│   Level 3 (危机信号):                                                       │
  1059→│   "我听到你说的了，我很担心你。                                             │
  1060→│    现在最重要的是你的安全。                                                 │
  1061→│                                                                             │
  1062→│    如果你愿意，可以拨打这个电话:                                            │
  1063→│    全国心理援助热线: 400-161-9995                                           │
  1064→│                                                                             │
  1065→│    那里有专业的人可以帮助你。                                               │
  1066→│    我会一直在这里。"                                                        │
  1067→│                                                                             │
  1068→└─────────────────────────────────────────────────────────────────────────────┘
  1069→```
  1070→
  1071→**关键文件:**
  1072→- `apps/api/services/vibe_engine/emotion_engine.py` - 增强检测
  1073→- `apps/api/services/agent/sos_mode.py` - 新建 SOS 模式处理
  1074→- `apps/api/data/sos_phrases.json` - 安抚话术库
  1075→
  1076→---
  1077→
  1078→### 4.4 单方合盘功能
  1079→
  1080→```
  1081→┌─────────────────────────────────────────────────────────────────────────────┐
  1082→│                                                                             │
  1083→│   SINGLE-SIDE COMPATIBILITY (单方合盘)                                       │
  1084→│                                                                             │
  1085→│   ═══════════════════════════════════════════════════════════════════════   │
  1086→│                                                                             │
  1087→│   用户流程                                                                  │
  1088→│   ─────────────────────────────────────────────────────────────────────     │
  1089→│                                                                             │
  1090→│   用户: "我想看看和一个合伙人合不合，但不知道他具体生日"                     │
  1091→│                                                                             │
  1092→│   系统: "没问题，我可以帮你分析。                                           │
  1093→│          知道对方的大概年龄或属相吗？"                                      │
  1094→│                                                                             │
  1095→│   用户: "他是属虎的，大概35岁"                                              │
  1096→│                                                                             │
  1097→│   系统:                                                                     │
  1098→│   ┌─────────────────────────────────────────────────────────────────────┐   │
  1099→│   │  🔮 单方合盘分析                                                    │   │
  1100→│   │                                                                     │   │
  1101→│   │  基于对方信息:                                                      │   │
  1102→│   │  • 属虎 + 35岁 → 推测为 1990 年 (庚午年)                            │   │
  1103→│   │                                                                     │   │
  1104→│   │  与你的八字关系:                                                    │   │
  1105→│   │  • 你的日主: 甲木                                                   │   │
  1106→│   │  • 对方年柱: 庚午 → 对你是"正官"                                    │   │
  1107→│   │                                                                     │   │
  1108→│   │  这意味着:                                                          │   │
  1109→│   │  • 对方可能比较正派、有原则                                         │   │
  1110→│   │  • 合作中对方可能会"约束"你                                         │   │
  1111→│   │  • 这种约束可以是积极的（帮你守规矩）                               │   │
  1112→│   │                                                                     │   │
  1113→│   │  配合建议:                                                          │   │
  1114→│   │  1. 让对方主导流程和规则                                            │   │
  1115→│   │  2. 你负责创意和开拓                                                │   │
  1116→│   │  3. 决策时尊重对方的保守意见                                        │   │
  1117→│   │                                                                     │   │
  1118→│   │  ⚠️ 注意: 这是基于有限信息的推断，仅供参考                          │   │
  1119→│   │                                                                     │   │
  1120→│   └─────────────────────────────────────────────────────────────────────┘   │
  1121→│                                                                             │
  1122→│   ═══════════════════════════════════════════════════════════════════════   │
  1123→│                                                                             │
  1124→│   技术实现                                                                  │
  1125→│   ─────────────────────────────────────────────────────────────────────     │
  1126→│                                                                             │
  1127→│   输入解析:                                                                 │
  1128→│   • 属相 → 年份范围                                                        │
  1129→│   • 年龄 → 确定具体年份                                                    │
  1130→│   • 星座 (如果有) → 月份范围                                               │
  1131→│                                                                             │
  1132→│   分析维度:                                                                 │
  1133→│   • 年柱与用户日主的十神关系                                               │
  1134→│   • 五行相生相克                                                           │
  1135→│   • 配合建议生成                                                           │
  1136→│                                                                             │
  1137→│   隐私保护:                                                                 │
  1138→│   • 不存储对方信息                                                         │
  1139→│   • 仅在对话中临时使用                                                     │
  1140→│                                                                             │
  1141→└─────────────────────────────────────────────────────────────────────────────┘
  1142→```
  1143→
  1144→**关键文件 (新建):**
  1145→- `apps/api/tools/bazi/compatibility.py` - 合盘计算
  1146→- `apps/api/services/agent/intents/compatibility.py` - 意图处理
  1147→
  1148→---
  1149→
  1150→### 4.5 话术模板引擎
  1151→
  1152→```
  1153→┌─────────────────────────────────────────────────────────────────────────────┐
  1154→│                                                                             │
  1155→│   SCRIPT TEMPLATE ENGINE (话术模板引擎)                                      │
  1156→│                                                                             │
  1157→│   ═══════════════════════════════════════════════════════════════════════   │
  1158→│                                                                             │
  1159→│   用户流程                                                                  │
  1160→│   ─────────────────────────────────────────────────────────────────────     │
  1161→│                                                                             │
  1162→│   用户: "他是处女座，我们吵架了，我想和好但不知道怎么说"                     │
  1163→│                                                                             │
  1164→│   系统:                                                                     │
  1165→│   ┌─────────────────────────────────────────────────────────────────────┐   │
  1166→│   │  💬 话术指南                                                        │   │
  1167→│   │                                                                     │   │
  1168→│   │  处女座的沟通特点:                                                  │   │
  1169→│   │  • 注重逻辑和细节                                                   │   │
  1170→│   │  • 吵架后需要冷静期                                                 │   │
  1171→│   │  • 欣赏真诚的自我反思                                               │   │
  1172→│   │                                                                     │   │
  1173→│   │  ─────────────────────────────────────────────────────────────────  │   │
  1174→│   │                                                                     │   │
  1175→│   │  建议在 2-3 天后发送 (给对方冷静时间)                               │   │
  1176→│   │  最佳时机: 下午茶时间 (15:00-17:00)                                 │   │
  1177→│   │                                                                     │   │
  1178→│   │  ─────────────────────────────────────────────────────────────────  │   │
  1179→│   │                                                                     │   │
  1180→│   │  话术选项:                                                          │   │
  1181→│   │                                                                     │   │
  1182→│   │  Option A (直接道歉):                                               │   │
  1183→│   │  "上次是我说话太冲了，对不起。我反思了一下，                         │   │
  1184→│   │   你说的那个点确实是我的问题。"                                      │   │
  1185→│   │                                                                     │   │
  1186→│   │  Option B (承认对方观点):                                           │   │
  1187→│   │  "我仔细想了想你那天说的，你是对的。                                 │   │
  1188→│   │   我不应该那样回应。"                                                │   │
  1189→│   │                                                                     │   │
  1190→│   │  Option C (轻松破冰):                                               │   │
  1191→│   │  "想你了。周末有空一起吃饭吗？"                                      │   │
  1192→│   │  (适合冷战时间较长、需要破冰的情况)                                  │   │
  1193→│   │                                                                     │   │
  1194→│   │  [ 复制 A ]  [ 复制 B ]  [ 复制 C ]                                  │   │
  1195→│   │                                                                     │   │
  1196→│   └─────────────────────────────────────────────────────────────────────┘   │
  1197→│                                                                             │
  1198→│   ═══════════════════════════════════════════════════════════════════════   │
  1199→│                                                                             │
  1200→│   知识库需求                                                                │
  1201→│   ─────────────────────────────────────────────────────────────────────     │
  1202→│                                                                             │
  1203→│   1. 12星座沟通偏好                                                         │
  1204→│      • 吵架后的处理方式                                                    │
  1205→│      • 喜欢的表达风格                                                      │
  1206→│      • 禁忌话题                                                            │
  1207→│                                                                             │
  1208→│   2. 场景话术库                                                             │
  1209→│      • 和好类                                                              │
  1210→│      • 表白类                                                              │
  1211→│      • 邀约类                                                              │
  1212→│      • 安慰类                                                              │
  1213→│                                                                             │
  1214→│   3. 时机建议规则                                                           │
  1215→│      • 星座 × 场景 → 最佳发送时间                                          │
  1216→│                                                                             │
  1217→└─────────────────────────────────────────────────────────────────────────────┘
  1218→```
  1219→
  1220→**关键文件 (新建):**
  1221→- `knowledge/zodiac/communication/` - 沟通偏好知识库
  1222→- `apps/api/services/agent/script_generator.py` - 话术生成
  1223→- `apps/web/src/components/script/ScriptCard.tsx` - 话术卡片组件
  1224→
  1225→---
  1226→
  1227→## 5. 实施路线图建议
  1228→
  1229→```
  1230→╔═══════════════════════════════════════════════════════════════════════════════╗
  1231→║                                                                               ║
  1232→║   IMPLEMENTATION ROADMAP                                                      ║
  1233→║                                                                               ║
  1234→╠═══════════════════════════════════════════════════════════════════════════════╣
  1235→║                                                                               ║
  1236→║   Phase 1: 基础夯实 (Week 1-3)                                                ║
  1237→║   ─────────────────────────────────────────────────────────────────────────   ║
  1238→║                                                                               ║
  1239→║   Week 1:                                                                     ║
  1240→║   ├── [P0-1] 八字知识库建设 - theory 部分                                     ║
  1241→║   └── [P0-3] 情绪急救 SOS 模式                                                ║
  1242→║                                                                               ║
  1243→║   Week 2:                                                                     ║
  1244→║   ├── [P0-1] 八字知识库建设 - patterns + transit                              ║
  1245→║   └── [P0-2] 主动推送系统 - 调度器 + 数据源                                   ║
  1246→║                                                                               ║
  1247→║   Week 3:                                                                     ║
  1248→║   ├── [P0-1] 星座知识库建设                                                   ║
  1249→║   └── [P0-2] 主动推送系统 - 通知通道 + UI                                     ║
  1250→║                                                                               ║
  1251→║   里程碑: 端到端流程可运行，八字/星座专业解读可用                             ║
  1252→║                                                                               ║
  1253→╠═══════════════════════════════════════════════════════════════════════════════╣
  1254→║                                                                               ║
  1255→║   Phase 2: 体验提升 (Week 4-6)                                                ║
  1256→║   ─────────────────────────────────────────────────────────────────────────   ║
  1257→║                                                                               ║
  1258→║   Week 4:                                                                     ║
  1259→║   ├── [P1-1] 每日微行动系统                                                   ║
  1260→║   └── [P1-3] GROWTH 洞察触发完善                                              ║
  1261→║                                                                               ║
  1262→║   Week 5-6:                                                                   ║
  1263→║   └── [P1-2] 可视化图表组件 (BaziChart, ZodiacChart, DeductionBridge)         ║
  1264→║                                                                               ║
  1265→║   里程碑: 核心差异化体验完整                                                  ║
  1266→║                                                                               ║
  1267→╠═══════════════════════════════════════════════════════════════════════════════╣
  1268→║                                                                               ║
  1269→║   Phase 3: 功能扩展 (Week 7+)                                                 ║
  1270→║   ─────────────────────────────────────────────────────────────────────────   ║
  1271→║                                                                               ║
  1272→║   ├── [P2-1] 单方合盘功能                                                     ║
  1273→║   ├── [P2-2] 话术模板引擎                                                     ║
  1274→║   └── [P2-4] MBTI 完整实现 (Phase 2 产品)                                     ║
  1275→║                                                                               ║
  1276→╚═══════════════════════════════════════════════════════════════════════════════╝
  1277→```
  1278→
  1279→---
  1280→
  1281→## 6. 附录：关键文件路径
  1282→
  1283→### 6.1 需要修改的现有文件
  1284→
  1285→| 文件路径 | 修改目的 |
  1286→|---------|---------|
  1287→| `apps/api/services/vibe_engine/emotion_engine.py` | 增强情绪检测 + SOS 模式 |
  1288→| `apps/api/services/vibe_engine/insight_generator.py` | 完善 GROWTH 触发规则 |
  1289→| `apps/api/services/reminder/scheduler.py` | 完善触发逻辑 |
  1290→| `apps/api/services/reminder/generator.py` | 实现 LLM 个性化生成 |
  1291→| `apps/api/services/reminder/notification.py` | 接入 Web Push |
  1292→| `apps/api/services/agent/runtime.py` | 集成 SOS 模式 |
  1293→| `apps/api/services/agent/persona.py` | 增加 SOS 模式 persona |
  1294→
  1295→### 6.2 需要新建的文件
  1296→
  1297→| 文件路径 | 功能 |
  1298→|---------|------|
  1299→| `knowledge/bazi/theory/*.md` | 八字理论知识库 |
  1300→| `knowledge/bazi/patterns/*.md` | 格局分析知识库 |
  1301→| `knowledge/bazi/transit/*.md` | 大运流年知识库 |
  1302→| `knowledge/zodiac/signs/*.md` | 12星座知识库 |
  1303→| `knowledge/zodiac/houses/*.md` | 12宫位知识库 |
  1304→| `knowledge/zodiac/communication/*.md` | 沟通偏好知识库 |
  1305→| `apps/api/services/agent/sos_mode.py` | SOS 模式处理 |
  1306→| `apps/api/services/vibe_engine/daily_action_generator.py` | 每日微行动生成 |
  1307→| `apps/api/data/sos_phrases.json` | 安抚话术库 |
  1308→| `apps/api/data/action_library.json` | 微行动库 |
  1309→| `apps/api/data/ephemeris.json` | 星历数据 |
  1310→| `apps/api/tools/bazi/compatibility.py` | 合盘计算 |
  1311→| `apps/api/services/agent/script_generator.py` | 话术生成 |
  1312→| `apps/web/src/components/action/DailyActionCard.tsx` | 每日行动卡片 |
  1313→| `apps/web/src/components/chart/BaziChart.tsx` | 八字可视化 |
  1314→| `apps/web/src/components/chart/ZodiacChart.tsx` | 星盘可视化 |
  1315→| `apps/web/src/components/script/ScriptCard.tsx` | 话术卡片 |
  1316→
  1317→---
  1318→
  1319→## 7. 总结
  1320→
  1321→### 7.1 场景覆盖度汇总
  1322→
  1323→| 类别 | 场景数 | 可满足 | 需完善 | 需新建 |
  1324→|------|-------|-------|-------|-------|
  1325→| 认识自我 | 3 | 0 | 2 | 1 (MBTI) |
  1326→| 理解当下 | 3 | 0 | 3 | 0 |
  1327→| 如何改变 | 3 | 0 | 0 | 3 |
  1328→| 咨询问事 | 2 | 1 | 1 | 0 |
  1329→| 合盘 | 2 | 0 | 0 | 2 |
  1330→| **总计** | **13** | **1** | **6** | **6** |
  1331→
  1332→### 7.2 核心结论
  1333→
  1334→1. **知识库是最大阻塞** - 没有知识库，再好的架构也无法提供专业解读
  1335→
  1336→2. **主动推送是差异化核心** - 这是 "工具" vs "朋友" 的本质区别
  1337→
  1338→3. **情绪急救是高价值场景** - 用户最脆弱时刻的体验决定忠诚度
  1339→
  1340→4. **"如何改变"类场景需要新建系统** - 每日微行动、计划追踪需要独立子系统
  1341→
  1342→5. **MBTI 可作为 Phase 2** - MVP 聚焦八字 + 星座，降低复杂度
  1343→
  1344→---
  1345→
  1346→*报告版本: 1.0*
  1347→*生成时间: 2026-01-07*
  1348→*基于: user case.md, vibelife spec v2.0/v2.1, architecture-gap-analysis.md*
  1349→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
