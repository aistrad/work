     1â†’"""
     2â†’VibeLife API - The Living Companion Backend
     3â†’"""
     4â†’import os
     5â†’from pathlib import Path
     6â†’from contextlib import asynccontextmanager
     7â†’
     8â†’from fastapi import FastAPI
     9â†’from fastapi.middleware.cors import CORSMiddleware
    10â†’
    11â†’from stores.db import init_db, close_db
    12â†’
    13â†’# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    14â†’# Load environment (.env at repo root)
    15â†’# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    16â†’
    17â†’try:
    18â†’    from dotenv import load_dotenv
    19â†’except ImportError:  # pragma: no cover
    20â†’    load_dotenv = None
    21â†’
    22â†’if load_dotenv:
    23â†’    env_path = Path(__file__).resolve().parents[2] / ".env"
    24â†’    if env_path.exists():
    25â†’        load_dotenv(env_path, override=False)
    26â†’
    27â†’# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    28â†’# Lifespan (startup/shutdown)
    29â†’# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    30â†’
    31â†’@asynccontextmanager
    32â†’async def lifespan(app: FastAPI):
    33â†’    """Application lifespan handler"""
    34â†’    # Startup
    35â†’    print("ðŸš€ Starting VibeLife API...")
    36â†’    await init_db()
    37â†’    print("âœ… Database connected")
    38â†’
    39â†’    yield
    40â†’
    41â†’    # Shutdown
    42â†’    print("ðŸ‘‹ Shutting down VibeLife API...")
    43â†’    await close_db()
    44â†’    print("âœ… Database closed")
    45â†’
    46â†’
    47â†’# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    48â†’# App Creation
    49â†’# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    50â†’
    51â†’app = FastAPI(
    52â†’    title="VibeLife API",
    53â†’    description="The Living Companion - AI-powered personal growth platform",
    54â†’    version="1.0.0",
    55â†’    lifespan=lifespan,
    56â†’)
    57â†’
    58â†’# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    59â†’# CORS Middleware
    60â†’# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    61â†’
    62â†’cors_origins = os.getenv("VIBELIFE_CORS_ORIGINS", "http://localhost:3000").split(",")
    63â†’
    64â†’app.add_middleware(
    65â†’    CORSMiddleware,
    66â†’    allow_origins=cors_origins,
    67â†’    allow_credentials=True,
    68â†’    allow_methods=["*"],
    69â†’    allow_headers=["*"],
    70â†’)
    71â†’
    72â†’
    73â†’# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    74â†’# Routes Import
    75â†’# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    76â†’
    77â†’from routes.health import router as health_router
    78â†’from routes.auth import router as auth_router
    79â†’from routes.users import router as users_router
    80â†’from routes.chat import router as chat_router
    81â†’from routes.reminders import router as reminders_router
    82â†’from routes.mirror import router as mirror_router
    83â†’from routes.billing import router as billing_router
    84â†’
    85â†’# Register routers
    86â†’app.include_router(health_router, tags=["Health"])
    87â†’app.include_router(auth_router, prefix="/api/v1", tags=["Authentication"])
    88â†’app.include_router(users_router, prefix="/api/v1", tags=["Users"])
    89â†’app.include_router(chat_router, prefix="/api/v1", tags=["Chat"])
    90â†’app.include_router(reminders_router, prefix="/api/v1", tags=["Reminders"])
    91â†’app.include_router(mirror_router, prefix="/api/v1", tags=["Mirror"])
    92â†’app.include_router(billing_router, prefix="/api/v1", tags=["Billing"])
    93â†’
    94â†’
    95â†’# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    96â†’# Root Endpoint
    97â†’# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    98â†’
    99â†’@app.get("/")
   100â†’async def root():
   101â†’    """Root endpoint - API info"""
   102â†’    return {
   103â†’        "name": "VibeLife API",
   104â†’        "version": "1.0.0",
   105â†’        "description": "The Living Companion - AI-powered personal growth platform",
   106â†’        "docs": "/docs",
   107â†’        "health": "/health",
   108â†’    }
   109â†’
   110â†’
   111â†’# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   112â†’# Run with uvicorn (for development)
   113â†’# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   114â†’
   115â†’if __name__ == "__main__":
   116â†’    import uvicorn
   117â†’
   118â†’    port = int(os.getenv("VIBELIFE_API_PORT", 8000))
   119â†’    host = os.getenv("VIBELIFE_API_HOST", "0.0.0.0")
   120â†’
   121â†’    uvicorn.run(
   122â†’        "main:app",
   123â†’        host=host,
   124â†’        port=port,
   125â†’        reload=os.getenv("VIBELIFE_DEV", "0") == "1",
   126â†’    )
   127â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
