     1→"use client"
     2→
     3→import { useCallback, useEffect } from "react"
     4→import { cn } from "@/lib/utils"
     5→import { useAppStore } from "@/stores/app-store"
     6→import { MessageList } from "./message-list"
     7→import { Omnibar } from "./omnibar"
     8→import { PanelRight, PanelRightClose } from "lucide-react"
     9→
    10→export function ChatZone() {
    11→  const {
    12→    messages,
    13→    isStreaming,
    14→    sendMessage,
    15→    isSidebarOpen,
    16→    setSidebarOpen,
    17→    isMobile,
    18→    fetchPreferences,
    19→  } = useAppStore()
    20→
    21→  // Load preferences on mount
    22→  useEffect(() => {
    23→    fetchPreferences()
    24→  }, [fetchPreferences])
    25→
    26→  // 发送消息 - 使用 store 的 sendMessage (已对接后端 API)
    27→  const handleSend = useCallback(
    28→    async (content: string) => {
    29→      await sendMessage(content)
    30→    },
    31→    [sendMessage]
    32→  )
    33→
    34→  // 处理命令
    35→  const handleCommand = useCallback(
    36→    (fullCommand: string) => {
    37→      console.log("Command:", fullCommand)
    38→
    39→      // 解析命令：格式可能是 "/cmd" 或 "/cmd 参数"
    40→      // fullCommand 已经包含 "/" 前缀
    41→      const trimmed = fullCommand.trim()
    42→
    43→      // 提取命令名和参数
    44→      const parts = trimmed.split(/\s+/)
    45→      const cmdWithSlash = parts[0] || ''  // e.g., "/checkin"
    46→      const cmdName = cmdWithSlash.startsWith('/') ? cmdWithSlash.slice(1) : cmdWithSlash
    47→      const cmdArgs = parts.slice(1).join(' ')
    48→
    49→      // 处理特殊命令（本地处理，不发送到后端）
    50→      switch (cmdName) {
    51→        case 'checkin':
    52→          // TODO: 触发情绪打卡 modal
    53→          console.log('Trigger checkin modal')
    54→          break
    55→        case 'status':
    56→          // TODO: 查看状态
    57→          console.log('Show status')
    58→          break
    59→        case 'tasks':
    60→          // TODO: 查看任务
    61→          console.log('Show tasks')
    62→          break
    63→        default:
    64→          // 将完整命令发送到后端（命令已包含 /）
    65→          // Next.js Agent Runtime 会根据命令选择对应的 skills
    66→          sendMessage(trimmed)
    67→      }
    68→    },
    69→    [sendMessage]
    70→  )
    71→
    72→  // 沉浸模式：Dashboard 关闭时
    73→  const isImmersive = !isSidebarOpen && !isMobile
    74→
    75→  return (
    76→    <div className="flex flex-col h-full">
    77→      {/* Header */}
    78→      <header
    79→        className={cn(
    80→          "flex items-center justify-between",
    81→          "h-14 px-4 border-b border-border",
    82→          "bg-background",
    83→          // 沉浸模式下内容居中
    84→          isImmersive && "max-w-4xl mx-auto w-full"
    85→        )}
    86→      >
    87→        <div className="flex items-center gap-3">
    88→          <h1 className="font-semibold text-foreground">Fortune AI</h1>
    89→        </div>
    90→
    91→        {/* 桌面端: 侧边栏切换按钮 */}
    92→        {!isMobile && (
    93→          <button
    94→            onClick={() => setSidebarOpen(!isSidebarOpen)}
    95→            className={cn(
    96→              "h-11 w-11 inline-flex items-center justify-center rounded-lg",
    97→              "text-muted-foreground hover:text-foreground hover:bg-hover",
    98→              "transition-colors",
    99→              "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-foreground/20",
   100→              "focus-visible:ring-offset-2 focus-visible:ring-offset-background"
   101→            )}
   102→            title={isSidebarOpen ? "进入沉浸模式" : "显示 Dashboard"}
   103→            aria-label={isSidebarOpen ? "进入沉浸模式" : "显示 Dashboard"}
   104→          >
   105→            {isSidebarOpen ? (
   106→              <PanelRightClose className="w-5 h-5" />
   107→            ) : (
   108→              <PanelRight className="w-5 h-5" />
   109→            )}
   110→          </button>
   111→        )}
   112→      </header>
   113→
   114→      {/* 内容区域 - 沉浸模式下居中并限制最大宽度 */}
   115→      <div className={cn(
   116→        "flex-1 flex flex-col min-h-0",
   117→        isImmersive && "max-w-4xl mx-auto w-full"
   118→      )}>
   119→        {/* Message List */}
   120→        <MessageList messages={messages} isStreaming={isStreaming} />
   121→
   122→        {/* Omnibar */}
   123→        <Omnibar
   124→          onSend={handleSend}
   125→          onCommand={handleCommand}
   126→          isStreaming={isStreaming}
   127→        />
   128→      </div>
   129→    </div>
   130→  )
   131→}
   132→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
