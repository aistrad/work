The file /home/aiscend/work/fortune_ai/web-app/src/components/chat/blocks/index.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
   468→    </div>
   469→  )
   470→}
   471→
   472→// 普通文本 Block
   473→function TextBlock({ block }: { block: Block }) {
   474→  return <p className="text-foreground leading-relaxed">{block.content}</p>
   475→}
   476→
   477→// Commitment Block - A2UI 承诺行动卡片
   478→function CommitmentBlockComponent({ block }: { block: CommitmentBlock }) {
   479→  const [status, setStatus] = useState(block.status)
   480→  const [isLoading, setIsLoading] = useState(false)
   481→
   482→  // 状态机配色 - 使用语义化 Token
   483→  const statusStyles = {
   484→    suggested: "border-l-commitment-suggested bg-commitment-suggested/5",
   485→    active: "border-l-commitment-active bg-commitment-active/5",
   486→    done: "border-l-commitment-done bg-commitment-done/5",
   487→    skipped: "border-l-commitment-skipped bg-commitment-skipped/5 opacity-60"
   488→  }
   489→
   490→  const statusLabels = {
   491→    suggested: "待决定",
   492→    active: "进行中",
   493→    done: "已完成",
   494→    skipped: "已跳过"
   495→  }
   496→
   497→  const handleAction = async (action: CommitmentAction) => {
   498→    setIsLoading(true)
   499→    try {
   500→      const res = await fetch("/api/dashboard/task/commit", {
   501→        method: "POST",
   502→        headers: { "Content-Type": "application/json", ...csrfHeaders() },
   503→        credentials: "include",
   504→        body: JSON.stringify({
   505→          task_id: block.taskId,
   506→          action: action
   507→        })
   508→      })
   509→
   510→      if (res.ok) {
   511→        // 更新本地状态
   512→        if (action === "start") setStatus("active")
   513→        if (action === "complete") setStatus("done")
   514→        if (action === "skip") setStatus("skipped")
   515→
   516→        // 触发 Zone B 刷新
   517→        window.dispatchEvent(new CustomEvent("refreshDashboard"))
   518→      }
   519→    } catch (e) {
   520→      console.error("Commitment action failed:", e)
   521→    } finally {
   522→      setIsLoading(false)
   523→    }
   524→  }
   525→
   526→  return (
   527→    <div
   528→      className={cn(
   529→        "p-4 rounded-lg border-l-4 border border-border",
   530→        "transition-all duration-300",
   531→        statusStyles[status]
   532→      )}
   533→      role="article"
   534→      aria-label={`任务: ${block.taskTitle}, 状态: ${statusLabels[status]}`}
   535→    >
   536→      {/* Header */}
   537→      <div className="flex items-start justify-between mb-3">
   538→        <div className="flex items-center gap-2">
   539→          {status === "done" ? (
   540→            <CheckCircle2 className="w-5 h-5 text-commitment-done" aria-hidden="true" />
   541→          ) : status === "active" ? (
   542→            <Circle className="w-5 h-5 text-commitment-active" aria-hidden="true" />
   543→          ) : (
   544→            <Sparkles className="w-5 h-5 text-commitment-suggested" aria-hidden="true" />
   545→          )}
   546→          <h4 className="font-medium text-foreground">{block.taskTitle}</h4>
   547→        </div>
   548→        {block.estimatedDuration && (
   549→          <span className="flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-surface-muted text-text-secondary">
   550→            <Clock className="w-3 h-3" aria-hidden="true" />
   551→            {block.estimatedDuration}
   552→          </span>
   553→        )}
   554→      </div>
   555→
   556→      {/* Content/Evidence */}
   557→      {block.content && (
   558→        <p className="text-sm text-muted-foreground mb-3 leading-relaxed">
   559→          {block.content}
   560→        </p>
   561→      )}
   562→
   563→      {/* Evidence List */}
   564→      {block.evidence && block.evidence.length > 0 && (
   565→        <div className="mb-4 p-3 rounded bg-surface-muted/50">
   566→          <p className="text-xs font-medium text-text-secondary mb-2">基于以下证据:</p>
   567→          <ul className="space-y-1">
   568→            {block.evidence.map((e, i) => (
   569→              <li key={i} className="text-xs text-muted-foreground flex items-start gap-2">
   570→                <Quote className="w-3 h-3 mt-0.5 flex-shrink-0" aria-hidden="true" />
   571→                {e}
   572→              </li>
   573→            ))}
   574→          </ul>
   575→        </div>
   576→      )}
   577→
   578→      {/* Action Buttons */}
   579→      {(status === "suggested" || status === "active") && (
   580→        <div className="flex flex-wrap gap-2">
   581→          {status === "suggested" && (
   582→            <>
   583→              <button
   584→                type="button"
   585→                onClick={() => handleAction("start")}
   586→                disabled={isLoading}
   587→                aria-label={`立即开始 ${block.taskTitle}`}
   588→                className={cn(
   589→                  "flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium",
   590→                  "bg-primary text-primary-foreground hover:bg-primary/90",
   591→                  "transition-colors duration-200",
   592→                  "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-interactive-focus-ring",
   593→                  "disabled:opacity-50 disabled:cursor-not-allowed"
   594→                )}
   595→              >
   596→                <Play className="w-4 h-4" aria-hidden="true" />
   597→                立即开始
   598→              </button>
   599→              <button
   600→                type="button"
   601→                onClick={() => handleAction("schedule")}
   602→                disabled={isLoading}
   603→                aria-label={`稍后安排 ${block.taskTitle}`}
   604→                className={cn(
   605→                  "flex items-center gap-2 px-4 py-2 rounded-lg text-sm",
   606→                  "bg-surface-muted text-foreground hover:bg-hover",
   607→                  "transition-colors duration-200",
   608→                  "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-interactive-focus-ring"
   609→                )}
   610→              >
   611→                <Calendar className="w-4 h-4" aria-hidden="true" />
   612→                稍后安排
   613→              </button>
   614→              <button
   615→                type="button"
   616→                onClick={() => handleAction("skip")}
   617→                disabled={isLoading}
   618→                aria-label={`跳过 ${block.taskTitle}`}
   619→                className={cn(
   620→                  "px-4 py-2 rounded-lg text-sm",
   621→                  "text-muted-foreground hover:text-foreground hover:bg-hover",
   622→                  "transition-colors duration-200",
   623→                  "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-interactive-focus-ring"
   624→                )}
   625→              >
   626→                暂不需要
   627→              </button>
   628→            </>
   629→          )}
   630→          {status === "active" && (
   631→            <button
   632→              type="button"
   633→              onClick={() => handleAction("complete")}
   634→              disabled={isLoading}
   635→              aria-label={`完成 ${block.taskTitle}`}
   636→              className={cn(
   637→                "flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium",
   638→                "bg-commitment-done text-white hover:opacity-90",
   639→                "transition-colors duration-200",
   640→                "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-interactive-focus-ring"
   641→              )}
   642→            >
   643→              <Check className="w-4 h-4" aria-hidden="true" />
   644→              标记完成
   645→            </button>
   646→          )}
   647→        </div>
   648→      )}
   649→
   650→      {/* Status Badge for completed/skipped */}
   651→      {(status === "done" || status === "skipped") && (
   652→        <div className="flex items-center gap-2 text-sm text-muted-foreground">
   653→          {status === "done" ? (
   654→            <>
   655→              <Check className="w-4 h-4 text-commitment-done" aria-hidden="true" />
   656→              <span>已完成</span>
   657→            </>
   658→          ) : (
   659→            <>
   660→              <X className="w-4 h-4" aria-hidden="true" />
   661→              <span>已跳过</span>
   662→            </>
   663→          )}
   664→        </div>
   665→      )}
   666→    </div>
   667→  )
   668→}
   669→
   670→// Prescription Block - 处方/建议卡片
   671→function PrescriptionBlockComponent({ block }: { block: PrescriptionBlock }) {
   672→  const priorityStyles = {
   673→    high: "border-l-destructive",
   674→    medium: "border-l-alert-foreground",
   675→    low: "border-l-muted"
   676→  }
   677→
   678→  return (
   679→    <div
   680→      className="p-4 rounded-lg border border-border bg-surface-elevated"
   681→      role="article"
   682→      aria-label={`建议: ${block.title}`}
   683→    >
   684→      {/* Header */}
   685→      <div className="flex items-center gap-2 mb-4">
   686→        <div className="w-8 h-8 rounded-full bg-mystic flex items-center justify-center">
   687→          <FileText className="w-4 h-4 text-mystic-foreground" aria-hidden="true" />
   688→        </div>
   689→        <div>
   690→          <h4 className="font-medium text-foreground">{block.title}</h4>
   691→          {block.source && (
   692→            <p className="text-xs text-muted-foreground">来源: {block.source}</p>
   693→          )}
   694→        </div>
   695→      </div>
   696→
   697→      {/* Content */}
   698→      {block.content && (
   699→        <p className="text-sm text-muted-foreground mb-4 leading-relaxed">
   700→          {block.content}
   701→        </p>
   702→      )}
   703→
   704→      {/* Items List */}
   705→      <div className="space-y-2 mb-4">
   706→        {block.items.map((item) => (
   707→          <div
   708→            key={item.id}
   709→            className={cn(
   710→              "p-3 rounded-lg bg-surface-muted/50 border-l-4",
   711→              priorityStyles[item.priority || "medium"]
   712→            )}
   713→          >
   714→            <div className="flex items-start justify-between">
   715→              <div className="flex-1">
   716→                <h5 className="font-medium text-foreground text-sm">{item.title}</h5>
   717→                {item.description && (
   718→                  <p className="text-xs text-muted-foreground mt-1">{item.description}</p>
   719→                )}
   720→              </div>
   721→              {item.duration && (
   722→                <span className="text-xs text-muted-foreground flex items-center gap-1">
   723→                  <Clock className="w-3 h-3" aria-hidden="true" />
   724→                  {item.duration}
   725→                </span>
   726→              )}
   727→            </div>
   728→          </div>
   729→        ))}
   730→      </div>
   731→
   732→      {/* Next Step Suggestion */}
   733→      {block.nextStepSuggestion && (
   734→        <div className="p-3 rounded-lg bg-advice/50 border border-advice-foreground/20">
   735→          <div className="flex items-start gap-2">
   736→            <ArrowRight className="w-4 h-4 text-advice-foreground mt-0.5" aria-hidden="true" />
   737→            <p className="text-sm text-foreground">
   738→              <span className="font-medium">下一步建议:</span> {block.nextStepSuggestion}
   739→            </p>
   740→          </div>
   741→        </div>
   742→      )}
   743→    </div>
   744→  )
   745→}
   746→
   747→// Evidence Block - 证据引用块
   748→function EvidenceBlockComponent({ block }: { block: EvidenceBlock }) {
   749→  return (
   750→    <div
   751→      className="p-4 rounded-lg border border-border bg-surface-subtle"
   752→      role="complementary"
   753→      aria-label="证据引用"
   754→    >
   755→      <div className="flex items-center gap-2 mb-3">
   756→        <Quote className="w-4 h-4 text-muted-foreground" aria-hidden="true" />
   757→        <span className="text-sm font-medium text-muted-foreground">参考依据</span>
   758→      </div>
   759→
   760→      <div className="space-y-3">
   761→        {block.references.map((ref) => (
   762→          <div key={ref.id} className="p-3 rounded bg-surface-elevated border border-border">
   763→            <p className="text-sm text-foreground leading-relaxed">{ref.text}</p>
   764→            <div className="flex items-center justify-between mt-2">
   765→              <span className="text-xs text-muted-foreground">{ref.source}</span>
   766→              {ref.confidence !== undefined && (
   767→                <span
   768→                  className={cn(
   769→                    "text-xs px-2 py-0.5 rounded-full",
   770→                    ref.confidence >= 0.8
   771→                      ? "bg-status/20 text-status-foreground"
   772→                      : ref.confidence >= 0.5
   773→                        ? "bg-alert/20 text-alert-foreground"
   774→                        : "bg-muted/20 text-muted-foreground"
   775→                  )}
   776→                >
   777→                  可信度 {Math.round(ref.confidence * 100)}%
   778→                </span>
   779→              )}
   780→            </div>
   781→          </div>
   782→        ))}
   783→      </div>
   784→    </div>
   785→  )
   786→}
   787→