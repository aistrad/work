The file /home/aiscend/work/fortune_ai/api/report_routes.py has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
   201→        """,
   202→        (str(output_url or ""), json.dumps(a2ui, ensure_ascii=False), int(mapping["id"])),
   203→    )
   204→
   205→    return _ok({"job_id": int(job_id), "backend": provider, "status": "completed", "output_url": str(output_url or ""), "a2ui": a2ui, "content": content})
   206→
   207→
   208→# =============================================================================
   209→# 八字深度报告 (GLM Backend)
   210→# =============================================================================
   211→
   212→class BaziDeepReportRequest(BaseModel):
   213→    report_type: str = Field("full", description="Report type: full|summary|career|relationship|health")
   214→    backend: str = Field("glm", description="Backend: glm")
   215→    model: Optional[str] = Field(None, description="Model name, e.g., glm-4.7")
   216→    question: Optional[str] = Field(None, max_length=500, description="User's specific question")
   217→
   218→
   219→@router.post("/bazi/deep/submit")
   220→def submit_bazi_deep_report(req: BaziDeepReportRequest, request: Request):
   221→    """
   222→    提交八字深度报告生成任务 (GLM Backend)
   223→
   224→    与 /bazi/submit 不同，此接口：
   225→    - 使用 GLM 后端同步生成
   226→    - 支持多种报告类型 (full/summary/career/relationship/health)
   227→    - 返回结构化报告，包含关键发现和行动处方
   228→    """
   229→    auth = require_auth(request)
   230→    require_csrf(request, auth)
   231→    user_id = int(auth["user_id"])
   232→
   233→    # 验证报告类型
   234→    report_type_str = (req.report_type or "full").strip().lower()
   235→    try:
   236→        report_type = ReportType(report_type_str)
   237→    except ValueError:
   238→        return _err(400, "invalid_request", f"Invalid report_type: {report_type_str}. Must be one of: full, summary, career, relationship, health")
   239→
   240→    # 验证后端
   241→    backend_str = (req.backend or "glm").strip().lower()
   242→    if backend_str != "glm":
   243→        return _err(400, "invalid_request", "Only 'glm' backend is supported for deep reports")
   244→
   245→    # 构建请求
   246→    report_request = ReportRequest(
   247→        user_id=user_id,
   248→        report_type=report_type,
   249→        backend=ReportBackend.GLM,
   250→        model=req.model,
   251→        extra_context={"question": req.question} if req.question else None,
   252→    )
   253→
   254→    try:
   255→        result = bazi_report_service.submit_report(report_request)
   256→    except Exception as e:
   257→        logger.error(f"bazi deep report generation failed: {e}")
   258→        return _err(500, "generation_error", f"Report generation failed: {str(e)[:100]}")
   259→
   260→    if result.status == "error":
   261→        return _err(500, "generation_error", result.error_message or "Unknown error")
   262→
   263→    logger.info(
   264→        "bazi deep report generated",
   265→        extra={
   266→            "operation": "bazi_deep_report_submit",
   267→            "user_id": user_id,
   268→            "report_id": result.report_id,
   269→            "report_type": report_type_str,
   270→        },
   271→    )
   272→
   273→    return _ok({
   274→        "report_id": result.report_id,
   275→        "backend": "glm",
   276→        "status": result.status,
   277→        "output_summary": result.output_summary,
   278→        "output_markdown": result.output_markdown,
   279→        "output_a2ui": result.output_a2ui,
   280→        "key_findings": result.key_findings,
   281→        "prescriptions": result.prescriptions,
   282→        "created_at": result.created_at.isoformat() if result.created_at else None,
   283→        "completed_at": result.completed_at.isoformat() if result.completed_at else None,
   284→    })
   285→
   286→
   287→@router.get("/bazi/deep/{report_id}")
   288→def get_bazi_deep_report(report_id: int, request: Request):
   289→    """
   290→    获取八字深度报告结果
   291→
   292→    返回报告的完整内容，包括：
   293→    - output_markdown: Markdown 格式报告
   294→    - output_a2ui: A2UI 格式输出
   295→    - key_findings: 关键发现列表
   296→    - prescriptions: 行动处方列表
   297→    """
   298→    auth = require_auth(request)
   299→    user_id = int(auth["user_id"])
   300→
   301→    result = bazi_report_service.get_report(report_id, user_id)
   302→    if not result:
   303→        return _err(404, "not_found", "Report not found")
   304→
   305→    return _ok(result.to_dict())
   306→
   307→
   308→@router.get("/bazi/deep/list")
   309→def list_bazi_deep_reports(request: Request, limit: int = 10):
   310→    """
   311→    列出用户的八字报告历史
   312→
   313→    返回报告列表（简化信息）
   314→    """
   315→    auth = require_auth(request)
   316→    user_id = int(auth["user_id"])
   317→
   318→    limit = max(1, min(50, limit))
   319→    reports = bazi_report_service.list_reports(user_id, limit=limit)
   320→
   321→    return _ok({"reports": reports})
   322→