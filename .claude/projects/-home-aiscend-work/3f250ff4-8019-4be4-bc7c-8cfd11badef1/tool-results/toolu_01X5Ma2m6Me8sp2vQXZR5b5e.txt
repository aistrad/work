     1→MENTIS v3.0 顶层设计文档╔═══════════════════════════════════════════════════════════════════════════════════════════════════╗
     2→║                                                                                                   ║
     3→║    ███╗   ███╗███████╗███╗   ██╗████████╗██╗███████╗    ██╗   ██╗██████╗     ██████╗              ║
     4→║    ████╗ ████║██╔════╝████╗  ██║╚══██╔══╝██║██╔════╝    ██║   ██║╚════██╗   ██╔═████╗             ║
     5→║    ██╔████╔██║█████╗  ██╔██╗ ██║   ██║   ██║███████╗    ██║   ██║ █████╔╝   ██║██╔██║             ║
     6→║    ██║╚██╔╝██║██╔══╝  ██║╚██╗██║   ██║   ██║╚════██║    ╚██╗ ██╔╝ ╚═══██╗   ████╔╝██║             ║
     7→║    ██║ ╚═╝ ██║███████╗██║ ╚████║   ██║   ██║███████║     ╚████╔╝ ██████╔╝██╗╚██████╔╝             ║
     8→║    ╚═╝     ╚═╝╚══════╝╚═╝  ╚═══╝   ╚═╝   ╚═╝╚══════╝      ╚═══╝  ╚═════╝ ╚═╝ ╚═════╝              ║
     9→║                                                                                                   ║
    10→║                            STREAM-CENTRIC AGENTIC ARCHITECTURE                                    ║
    11→║                                                                                                   ║
    12→║                               Decode. Reframe. Evolve.                                            ║
    13→║                         解码命运 · 重塑认知 · 进化人生                                            ║
    14→║                                                                                                   ║
    15→╚═══════════════════════════════════════════════════════════════════════════════════════════════════╝
    16→
    17→Document Version: 3.0 (Stream-Centric Agentic Edition)
    18→Author: Silicon Valley Principal Architect
    19→Last Updated: 2026-01-04目录
    20→Executive Summary
    21→产品架构
    22→系统架构
    23→核心功能
    24→数据采集
    25→前端交互
    26→数据模型
    27→API 设计
    28→核心算法
    29→部署架构
    30→演进路线图
    31→1. Executive Summary1.1 产品定位MENTIS v3.0 是一个 Stream-Centric Agentic Personal OS（流核心智能体个人操作系统），将东方玄学洞察与西方行为科学融合，通过主动式 Agent 架构帮助用户实现认知升级和行为进化。┌─────────────────────────────────────────────────────────────────────────────────┐
    32→│                           MENTIS v3.0 POSITIONING                               │
    33→├─────────────────────────────────────────────────────────────────────────────────┤
    34→│                                                                                 │
    35→│   传统 Chat Bot          →        MENTIS v3.0 Agent                            │
    36→│   ─────────────────────────────────────────────────────────────                │
    37→│                                                                                 │
    38→│   人找服务 (User → AI)    →        服务找人 (AI → User)                        │
    39→│   填表汇报               →        自然流露                                      │
    40→│   Dashboard 是主战场     →        Dashboard 是背景环境                          │
    41→│   阅后即焚               →        阅后沉淀 → 数字孪生                           │
    42→│   被动问答               →        主动干预 + 情境感知                           │
    43→│                                                                                 │
    44→└─────────────────────────────────────────────────────────────────────────────────┘1.2 核心哲学╔═══════════════════════════════════════════════════════════════════════════════╗
    45→║                         CORE PHILOSOPHY                                        ║
    46→╠═══════════════════════════════════════════════════════════════════════════════╣
    47→║                                                                               ║
    48→║   "Life is a Stream, not a Dashboard."                                        ║
    49→║   "生活是一条流，而不是一个仪表盘。"                                           ║
    50→║                                                                               ║
    51→║   Design Goal: Making "Living" the input, and "Evolving" the output.          ║
    52→║   设计目标：让"生活本身"成为输入，让"进化"成为输出。                           ║
    53→║                                                                               ║
    54→╚═══════════════════════════════════════════════════════════════════════════════╝1.3 v2.0 → v3.0 核心升级维度v2.0v3.0核心交互Chat + DashboardStream (一切皆流)Dashboard 定位用户主动操作区被动环境感知层 (Ambient HUD)行为记录手动打卡自然语言自动识别反馈机制延迟/批量毫秒级实时同步Agent 模式被动响应主动干预 (Proactive Intervention)数据来源静态 (生辰)Stream + Passive Tracking + Active Input情绪感知无Dynamic Aura System2. 产品架构2.1 三层交互模型 (Three-Layer Interaction Model)╔═══════════════════════════════════════════════════════════════════════════════╗
    55→║                       THREE-LAYER INTERACTION MODEL                            ║
    56→╠═══════════════════════════════════════════════════════════════════════════════╣
    57→║                                                                               ║
    58→║  ┌─────────────────────────────────────────────────────────────────────────┐ ║
    59→║  │  LAYER 1: THE STREAM (核心交互区)                           90% 时间   │ ║
    60→║  │  ─────────────────────────────────────────────────────────────────────  │ ║
    61→║  │                                                                         │ ║
    62→║  │  • Vibe Diary (碎碎念 / 情绪日记)        ← 最高频入口                  │ ║
    63→║  │  • Action Cards (Agent 主动推送的任务卡)                               │ ║
    64→║  │  • Natural Feedback (自然汇报，非手动打卡)                             │ ║
    65→║  │  • Chat (传统问答，融入流中)                                           │ ║
    66→║  │                                                                         │ ║
    67→║  │  INPUT: 语音 / 图片 / 文字（零摩擦）                                   │ ║
    68→║  │  FEEDBACK: 每次 Input → 立即微反馈（AI Tag / 能量变化 / Aura）         │ ║
    69→║  │                                                                         │ ║
    70→║  └─────────────────────────────────────────────────────────────────────────┘ ║
    71→║                                                                               ║
    72→║  ┌─────────────────────────────────────────────────────────────────────────┐ ║
    73→║  │  LAYER 2: THE HUD (环境感知区 / Ambient HUD)                被动展示   │ ║
    74→║  │  ─────────────────────────────────────────────────────────────────────  │ ║
    75→║  │                                                                         │ ║
    76→║  │  • Dashboard 不再是独立页面，而是悬浮在 Stream 周围的"环境层"          │ ║
    77→║  │  • 平时隐形，或以 Dynamic Aura (动态背景光晕) 形式存在                 │ ║
    78→║  │  • 只有状态剧烈变化 或 用户主动呼出时才显现                            │ ║
    79→║  │                                                                         │ ║
    80→║  │  表现形式: 背景光晕 / 边缘微光 / 数字浮动 / 粒子效果                   │ ║
    81→║  │                                                                         │ ║
    82→║  └─────────────────────────────────────────────────────────────────────────┘ ║
    83→║                                                                               ║
    84→║  ┌─────────────────────────────────────────────────────────────────────────┐ ║
    85→║  │  LAYER 3: THE INTERVENTION (主动干预层)                     Agent 灵魂 │ ║
    86→║  │  ─────────────────────────────────────────────────────────────────────  │ ║
    87→║  │                                                                         │ ║
    88→║  │  • Agent 不等待用户提问，主动在 Stream 中插入 Action Cards             │ ║
    89→║  │  • 基于 Stream 内容 + L1 模块数据 + 时间节点，智能触发                 │ ║
    90→║  │  • 卡片可交互，完成后自动记录                                          │ ║
    91→║  │                                                                         │ ║
    92→║  │  触发条件: 时间节点 / 情绪阈值 / 能量变化 / 行为模式 / 运势窗口        │ ║
    93→║  │                                                                         │ ║
    94→║  └─────────────────────────────────────────────────────────────────────────┘ ║
    95→║                                                                               ║
    96→╚═══════════════════════════════════════════════════════════════════════════════╝2.2 产品功能矩阵┌─────────────────────────────────────────────────────────────────────────────────┐
    97→│                           PRODUCT FEATURE MATRIX                                │
    98→├─────────────────────────────────────────────────────────────────────────────────┤
    99→│                                                                                 │
   100→│                        ┌───────────────────────────────────────┐               │
   101→│                        │          MENTIS v3.0 OS               │               │
   102→│                        │     Stream-Centric Architecture       │               │
   103→│                        └───────────────────────────────────────┘               │
   104→│                                        │                                        │
   105→│        ┌───────────────┬───────────────┼───────────────┬───────────────┐       │
   106→│        │               │               │               │               │       │
   107→│        ▼               ▼               ▼               ▼               ▼       │
   108→│   ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐     │
   109→│   │  STREAM │    │  DECODE │    │ REFRAME │    │  EVOLVE │    │ REFLECT │     │
   110→│   │  INPUT  │    │  MODULE │    │  MODULE │    │  MODULE │    │  MODULE │     │
   111→│   ├─────────┤    ├─────────┤    ├─────────┤    ├─────────┤    ├─────────┤     │
   112→│   │Vibe Diary│   │ BaZi    │    │ CBT     │    │ Habit   │    │ Weekly  │     │
   113→│   │Voice    │    │ ZiWei   │    │ ACT     │    │ If-Then │    │ Mirror  │     │
   114→│   │Photo    │    │ MBTI    │    │ NLP     │    │Momentum │    │ Insight │     │
   115→│   │Text     │    │ Jung    │    │ Reword  │    │ Streak  │    │ Pattern │     │
   116→│   └─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘     │
   117→│                                                                                 │
   118→└─────────────────────────────────────────────────────────────────────────────────┘2.3 用户旅程 (User Journey)╔═══════════════════════════════════════════════════════════════════════════════╗
   119→║                           USER JOURNEY MAP                                     ║
   120→╠═══════════════════════════════════════════════════════════════════════════════╣
   121→║                                                                               ║
   122→║   STAGE 1: LANDING (落地页体验)                                               ║
   123→║   ─────────────────────────────────────────────────────────────────────────   ║
   124→║   输入生辰 → 快速命盘洞察 → "共鸣时刻" → 注册转化                            ║
   125→║                                                                               ║
   126→║   STAGE 2: ONBOARDING (入门校准)                                              ║
   127→║   ─────────────────────────────────────────────────────────────────────────   ║
   128→║   Mirror Test (30秒校准游戏) → 生成初始 Digital Twin → 设置基础偏好           ║
   129→║                                                                               ║
   130→║   STAGE 3: DAILY STREAM (日常使用)                                            ║
   131→║   ─────────────────────────────────────────────────────────────────────────   ║
   132→║                                                                               ║
   133→║   ┌─────────────────────────────────────────────────────────────────────┐    ║
   134→║   │  MORNING                                                            │    ║
   135→║   │  ──────────                                                         │    ║
   136→║   │  Agent 推送: 🌅 今日运势 + 能量预测 + 早间微习惯                     │    ║
   137→║   │  用户输入: "昨晚睡得不太好" → 自动识别 → 调整建议                   │    ║
   138→║   └─────────────────────────────────────────────────────────────────────┘    ║
   139→║                                  │                                            ║
   140→║                                  ▼                                            ║
   141→║   ┌─────────────────────────────────────────────────────────────────────┐    ║
   142→║   │  THROUGHOUT DAY                                                     │    ║
   143→║   │  ─────────────                                                      │    ║
   144→║   │  用户发 Vibe Diary: "开会被老板骂了，心情很差"                       │    ║
   145→║   │  → 情绪识别: Anger -3                                               │    ║
   146→║   │  → Aura 变红                                                        │    ║
   147→║   │  → Agent 插入 Action Card: [3分钟呼吸法]                            │    ║
   148→║   │  → 用户完成 → 能量回升 → Aura 变蓝                                  │    ║
   149→║   └─────────────────────────────────────────────────────────────────────┘    ║
   150→║                                  │                                            ║
   151→║                                  ▼                                            ║
   152→║   ┌─────────────────────────────────────────────────────────────────────┐    ║
   153→║   │  EVENING                                                            │    ║
   154→║   │  ───────                                                            │    ║
   155→║   │  Agent 推送: 📊 今日回顾 + 模式洞察 + 明日建议                       │    ║
   156→║   │  用户输入: "今天还是控制住情绪了" → 自动打卡 +2                      │    ║
   157→║   └─────────────────────────────────────────────────────────────────────┘    ║
   158→║                                                                               ║
   159→║   STAGE 4: WEEKLY REFLECTION (周期复盘)                                       ║
   160→║   ─────────────────────────────────────────────────────────────────────────   ║
   161→║   Weekly Mirror Report → 模式识别 → 下周策略调整 → 解锁深度报告              ║
   162→║                                                                               ║
   163→╚═══════════════════════════════════════════════════════════════════════════════╝3. 系统架构3.1 全局系统架构图╔═══════════════════════════════════════════════════════════════════════════════════════════════════╗
   164→║                                MENTIS v3.0 SYSTEM ARCHITECTURE                                     ║
   165→║                                Stream-Centric Agentic Platform                                     ║
   166→╠═══════════════════════════════════════════════════════════════════════════════════════════════════╣
   167→║                                                                                                   ║
   168→║  ┌─────────────────────────────────────────────────────────────────────────────────────────────┐ ║
   169→║  │                                    🌐 CLIENT LAYER                                          │ ║
   170→║  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │ ║
   171→║  │  │   iOS App       │  │   Android App   │  │   Web App       │  │   WeChat Mini   │        │ ║
   172→║  │  │   (React Native)│  │   (React Native)│  │   (Next.js)     │  │   (Taro)        │        │ ║
   173→║  │  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘        │ ║
   174→║  │           └────────────────────┴────────────────────┴────────────────────┘                  │ ║
   175→║  └───────────────────────────────────────────┬─────────────────────────────────────────────────┘ ║
   176→║                                              │                                                    ║
   177→║                                              │ HTTPS / WebSocket                                  ║
   178→║                                              ▼                                                    ║
   179→║  ┌───────────────────────────────────────────────────────────────────────────────────────────┐   ║
   180→║  │                                   🚪 API GATEWAY                                          │   ║
   181→║  │                          (Vercel Edge / Cloudflare Workers)                               │   ║
   182→║  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │   ║
   183→║  │  │ Rate Limit  │  │   Auth      │  │   Routing   │  │   CORS      │  │   Logging   │     │   ║
   184→║  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │   ║
   185→║  └────────────────────────────────────────┬──────────────────────────────────────────────────┘   ║
   186→║                                           │                                                       ║
   187→║                                           ▼                                                       ║
   188→║  ┌───────────────────────────────────────────────────────────────────────────────────────────┐   ║
   189→║  │                              🧠 AGENT RUNTIME LAYER                                        │   ║
   190→║  │                              (Next.js API Routes + Vercel AI SDK)                          │   ║
   191→║  │                                                                                           │   ║
   192→║  │   ┌─────────────────────────────────────────────────────────────────────────────────────┐│   ║
   193→║  │   │                           STREAM PROCESSOR                                          ││   ║
   194→║  │   │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                ││   ║
   195→║  │   │  │ STT Engine  │→ │ NLP Extract │→ │ Emotion Det │→ │ Action Match│                ││   ║
   196→║  │   │  │ (Whisper)   │  │ (GPT-4)     │  │ (Custom)    │  │ (Embedding) │                ││   ║
   197→║  │   │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘                ││   ║
   198→║  │   └─────────────────────────────────────────────────────────────────────────────────────┘│   ║
   199→║  │                                                                                           │   ║
   200→║  │   ┌─────────────────────────────────────────────────────────────────────────────────────┐│   ║
   201→║  │   │                           ORCHESTRATOR                                              ││   ║
   202→║  │   │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                ││   ║
   203→║  │   │  │Intent Class │  │Module Router│  │Context Build│  │A2UI Format  │                ││   ║
   204→║  │   │  │意图分类器   │  │模块路由器   │  │上下文构建器 │  │输出格式化   │                ││   ║
   205→║  │   │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘                ││   ║
   206→║  │   └─────────────────────────────────────────────────────────────────────────────────────┘│   ║
   207→║  └────────────────────────────────────────┬──────────────────────────────────────────────────┘   ║
   208→║                                           │                                                       ║
   209→║                    ┌──────────────────────┼──────────────────────┐                               ║
   210→║                    │                      │                      │                               ║
   211→║                    ▼                      ▼                      ▼                               ║
   212→║  ┌─────────────────────────┐ ┌─────────────────────────┐ ┌─────────────────────────┐            ║
   213→║  │    🔮 DECODE LAYER      │ │    🧩 REFRAME LAYER     │ │    🎯 EVOLVE LAYER      │            ║
   214→║  │    (Plug & Play)        │ │    (认知重塑)           │ │    (行为进化)           │            ║
   215→║  │  ┌───────────────────┐  │ │  ┌───────────────────┐  │ │  ┌───────────────────┐  │            ║
   216→║  │  │ Module: BaZi      │  │ │  │ Module: CBT       │  │ │  │ Module: Habit     │  │            ║
   217→║  │  │ Module: ZiWei     │  │ │  │ Module: ACT       │  │ │  │ Module: If-Then   │  │            ║
   218→║  │  │ Module: MBTI      │  │ │  │ Module: NLP-Rw    │  │ │  │ Module: Momentum  │  │            ║
   219→║  │  │ Module: Jung      │  │ │  │ Module: Stoic     │  │ │  │ Module: Streak    │  │            ║
   220→║  │  └───────────────────┘  │ │  └───────────────────┘  │ │  └───────────────────┘  │            ║
   221→║  └─────────────────────────┘ └─────────────────────────┘ └─────────────────────────┘            ║
   222→║                                           │                                                       ║
   223→║                                           ▼                                                       ║
   224→║  ┌───────────────────────────────────────────────────────────────────────────────────────────┐   ║
   225→║  │                                   💾 DATA LAYER                                            │   ║
   226→║  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐       │   ║
   227→║  │  │  PostgreSQL     │  │  Redis          │  │  Pinecone       │  │  R2/S3          │       │   ║
   228→║  │  │  (Primary DB)   │  │  (Session/Cache)│  │  (Vector Store) │  │  (Media Store)  │       │   ║
   229→║  │  │  ─────────────  │  │  ─────────────  │  │  ─────────────  │  │  ─────────────  │       │   ║
   230→║  │  │  User Data      │  │  Real-time State│  │  Embeddings     │  │  Voice/Image    │       │   ║
   231→║  │  │  Stream Data    │  │  Emotion Score  │  │  Knowledge Base │  │  Attachments    │       │   ║
   232→║  │  │  Module Data    │  │  Agent Queue    │  │  Behavior Match │  │  Reports        │       │   ║
   233→║  │  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘       │   ║
   234→║  └───────────────────────────────────────────────────────────────────────────────────────────┘   ║
   235→║                                                                                                   ║
   236→╚═══════════════════════════════════════════════════════════════════════════════════════════════════╝3.2 Agent Runtime 详细架构╔═══════════════════════════════════════════════════════════════════════════════╗
   237→║                           AGENT RUNTIME ARCHITECTURE                           ║
   238→║                           (Vercel AI SDK 4.0 + Multi-Step)                     ║
   239→╠═══════════════════════════════════════════════════════════════════════════════╣
   240→║                                                                               ║
   241→║   POST /api/stream                                                            ║
   242→║   ─────────────────────────────────────────────────────────────────────────   ║
   243→║                                                                               ║
   244→║   ┌─────────────────────────────────────────────────────────────────────────┐║
   245→║   │  streamText({                                                           │║
   246→║   │    model: selectModel(userTier),     // GLM-4.5 / Claude / GPT-4       │║
   247→║   │    system: await buildContext(userId), // L0 + L1 + Biography + Current│║
   248→║   │    messages: conversationHistory,                                       │║
   249→║   │    tools: {                                                             │║
   250→║   │      ...getDecodeTools(userId),      // 动态加载已激活的 DECODE 模块   │║
   251→║   │      ...getReframeTools(userId),     // CBT / ACT / NLP 重构工具       │║
   252→║   │      ...getEvolveTools(userId),      // 习惯 / 动量 / 打卡工具         │║
   253→║   │      ...getSystemTools(),            // 系统级工具                      │║
   254→║   │    },                                                                   │║
   255→║   │    maxSteps: 5,                      // Multi-step reasoning           │║
   256→║   │    onStepFinish: handleStepCallback, // 每步回调                       │║
   257→║   │  })                                                                     │║
   258→║   └─────────────────────────────────────────────────────────────────────────┘║
   259→║                                                                               ║
   260→║   ┌─────────────────────────────────────────────────────────────────────────┐║
   261→║   │                        TOOL DEFINITIONS                                 │║
   262→║   ├─────────────────────────────────────────────────────────────────────────┤║
   263→║   │                                                                         │║
   264→║   │  // DECODE TOOLS                                                        │║
   265→║   │  bazi_calculate: (birthTime) => BaZiChart                              │║
   266→║   │  ziwei_calculate: (birthTime) => ZiWeiChart                            │║
   267→║   │  fortune_today: (userId) => DailyFortune                               │║
   268→║   │  mbti_assess: (answers) => MBTIProfile                                 │║
   269→║   │                                                                         │║
   270→║   │  // REFRAME TOOLS                                                       │║
   271→║   │  cbt_identify: (thought) => CognitiveDistortion[]                      │║
   272→║   │  reword_negative: (sentence) => PositiveReframe                        │║
   273→║   │  act_exercise: (situation) => AcceptanceExercise                       │║
   274→║   │                                                                         │║
   275→║   │  // EVOLVE TOOLS                                                        │║
   276→║   │  habit_suggest: (context) => MicroHabit[]                              │║
   277→║   │  checkin_auto: (behavior) => CheckinResult                             │║
   278→║   │  momentum_update: (action) => MomentumDelta                            │║
   279→║   │  ifthen_create: (trigger, action) => IfThenPlan                        │║
   280→║   │                                                                         │║
   281→║   │  // SYSTEM TOOLS                                                        │║
   282→║   │  user_state_update: (delta) => UserState                               │║
   283→║   │  notification_push: (content) => void                                  │║
   284→║   │  insight_generate: (data) => Insight                                   │║
   285→║   │                                                                         │║
   286→║   └─────────────────────────────────────────────────────────────────────────┘║
   287→║                                                                               ║
   288→╚═══════════════════════════════════════════════════════════════════════════════╝3.3 实时同步架构 (Real-time Sync)╔═══════════════════════════════════════════════════════════════════════════════╗
   289→║                        REAL-TIME SYNC ARCHITECTURE                             ║
   290→╠═══════════════════════════════════════════════════════════════════════════════╣
   291→║                                                                               ║
   292→║                         ┌─────────────────┐                                   ║
   293→║                         │   USER INPUT    │                                   ║
   294→║                         │  (Voice/Text)   │                                   ║
   295→║                         └────────┬────────┘                                   ║
   296→║                                  │                                            ║
   297→║                                  ▼                                            ║
   298→║  ┌───────────────────────────────────────────────────────────────────────┐   ║
   299→║  │                        STREAM PROCESSOR                               │   ║
   300→║  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   ║
   301→║  │  │ Whisper STT │→ │ NLP Extract │→ │ Emotion Det │→ │ Action Match│  │   ║
   302→║  │  │ <500ms      │  │ <200ms      │  │ <100ms      │  │ <100ms      │  │   ║
   303→║  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │   ║
   304→║  └───────────────────────────────────────────────────────────────────────┘   ║
   305→║                                  │                                            ║
   306→║                    ┌─────────────┼─────────────┐                             ║
   307→║                    │             │             │                              ║
   308→║                    ▼             ▼             ▼                              ║
   309→║  ┌─────────────────────┐ ┌─────────────────────┐ ┌─────────────────────┐     ║
   310→║  │  UPDATE: Stream DB  │ │  UPDATE: User State │ │  TRIGGER: Agent     │     ║
   311→║  │  (Append new entry) │ │  (Emotion, Energy)  │ │  (If threshold met) │     ║
   312→║  │  PostgreSQL Write   │ │  Redis Update       │ │  Agent Queue Push   │     ║
   313→║  └──────────┬──────────┘ └──────────┬──────────┘ └──────────┬──────────┘     ║
   314→║             │                       │                       │                 ║
   315→║             └───────────────────────┼───────────────────────┘                 ║
   316→║                                     │                                         ║
   317→║                                     ▼                                         ║
   318→║                    ┌────────────────────────────────┐                         ║
   319→║                    │       WEBSOCKET BROADCAST      │                         ║
   320→║                    │  (毫秒级同步到所有客户端)      │                         ║
   321→║                    │  Pusher / Socket.io / Ably     │                         ║
   322→║                    └────────────────────────────────┘                         ║
   323→║                                     │                                         ║
   324→║                    ┌────────────────┼────────────────┐                       ║
   325→║                    │                │                │                        ║
   326→║                    ▼                ▼                ▼                        ║
   327→║             ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                  ║
   328→║             │ Stream Card │ │ Aura Change │ │ Score Update│                  ║
   329→║             │ (New entry) │ │ (Background)│ │ (Top bar)   │                  ║
   330→║             └─────────────┘ └─────────────┘ └─────────────┘                  ║
   331→║                                                                               ║
   332→║  ─────────────────────────────────────────────────────────────────────────   ║
   333→║  关键指标:                                                                    ║
   334→║  • 输入到反馈: < 1000ms (P95)                                                ║
   335→║  • 情绪识别: < 300ms (P95)                                                   ║
   336→║  • UI 更新: < 100ms (P95)                                                    ║
   337→║                                                                               ║
   338→╚═══════════════════════════════════════════════════════════════════════════════╝3.4 模块化插件架构╔═══════════════════════════════════════════════════════════════════════════════╗
   339→║                        MODULAR PLUGIN ARCHITECTURE                             ║
   340→║                        (Standard Module Interface)                             ║
   341→╠═══════════════════════════════════════════════════════════════════════════════╣
   342→║                                                                               ║
   343→║   interface MentisModule {                                                    ║
   344→║     // 元数据                                                                 ║
   345→║     meta: {                                                                   ║
   346→║       id: string;                    // 唯一标识 'module_bazi'              ║
   347→║       name: string;                  // 显示名称 '八字命理'                  ║
   348→║       tier: 'free' | 'pro' | 'premium';  // 订阅等级                        ║
   349→║       category: 'decode' | 'reframe' | 'evolve';  // 所属层                 ║
   350→║     };                                                                        ║
   351→║                                                                               ║
   352→║     // 知识库                                                                 ║
   353→║     knowledge_base: {                                                         ║
   354→║       vector_namespace: string;      // Pinecone namespace                   ║
   355→║       rules: Rule[];                 // 确定性规则                           ║
   356→║     };                                                                        ║
   357→║                                                                               ║
   358→║     // 工具定义                                                               ║
   359→║     tools: ToolDefinition[];         // 可被 Agent 调用的能力                ║
   360→║                                                                               ║
   361→║     // 上下文输出                                                             ║
   362→║     context_output: (userId: string) => Promise<ContextFragment>;            ║
   363→║   }                                                                           ║
   364→║                                                                               ║
   365→║   ─────────────────────────────────────────────────────────────────────────   ║
   366→║                                                                               ║
   367→║   // 示例: BaZi 模块                                                          ║
   368→║   const BaZiModule: MentisModule = {                                          ║
   369→║     meta: {                                                                   ║
   370→║       id: 'module_bazi',                                                      ║
   371→║       name: '八字命理',                                                       ║
   372→║       tier: 'free',                                                           ║
   373→║       category: 'decode',                                                     ║
   374→║     },                                                                        ║
   375→║     knowledge_base: {                                                         ║
   376→║       vector_namespace: 'bazi_knowledge',                                     ║
   377→║       rules: baziCalculationRules,                                            ║
   378→║     },                                                                        ║
   379→║     tools: [                                                                  ║
   380→║       {                                                                       ║
   381→║         name: 'bazi_calculate',                                               ║
   382→║         description: '根据生辰计算八字命盘',                                  ║
   383→║         parameters: { birthTime: 'ISO8601' },                                ║
   384→║         execute: async (params) => calculateBaZi(params.birthTime),          ║
   385→║       },                                                                      ║
   386→║       {                                                                       ║
   387→║         name: 'bazi_fortune_today',                                           ║
   388→║         description: '获取今日运势',                                          ║
   389→║         parameters: { userId: 'string' },                                    ║
   390→║         execute: async (params) => getTodayFortune(params.userId),           ║
   391→║       },                                                                      ║
   392→║     ],                                                                        ║
   393→║     context_output: async (userId) => ({                                      ║
   394→║       type: 'bazi',                                                           ║
   395→║       data: await getBaZiSnapshot(userId),                                    ║
   396→║     }),                                                                       ║
   397→║   };                                                                          ║
   398→║                                                                               ║
   399→╚═══════════════════════════════════════════════════════════════════════════════╝4. 核心功能4.1 Vibe Diary (情绪日记)╔═══════════════════════════════════════════════════════════════════════════════╗
   400→║                           VIBE DIARY SYSTEM                                    ║
   401→║                           (最高频交互入口)                                     ║
   402→╠═══════════════════════════════════════════════════════════════════════════════╣
   403→║                                                                               ║
   404→║   核心理念: 用户不需要"记录"，只需要"表达"，系统负责理解和沉淀                ║
   405→║                                                                               ║
   406→║   ┌─────────────────────────────────────────────────────────────────────────┐║
   407→║   │                         INPUT MODES                                     │║
   408→║   ├─────────────────────────────────────────────────────────────────────────┤║
   409→║   │                                                                         │║
   410→║   │  🎙️ VOICE (最低摩擦)                                                    │║
   411→║   │  ──────────────────────────────────────────────────────────────────    │║
   412→║   │  长按录音 → Whisper STT → NLP 理解 → 结构化存储                        │║
   413→║   │  优势: 开车/做饭/走路时都能用                                          │║
   414→║   │                                                                         │║
   415→║   │  📝 TEXT (精确表达)                                                     │║
   416→║   │  ──────────────────────────────────────────────────────────────────    │║
   417→║   │  自由文本输入 → NLP 理解 → 结构化存储                                  │║
   418→║   │                                                                         │║
   419→║   │  📷 PHOTO (场景捕捉)                                                    │║
   420→║   │  ──────────────────────────────────────────────────────────────────    │║
   421→║   │  拍照 + 可选文字 → Vision API 理解 → 结构化存储                        │║
   422→║   │  场景: 美食/运动/工作环境/心情照片                                     │║
   423→║   │                                                                         │║
   424→║   └─────────────────────────────────────────────────────────────────────────┘║
   425→║                                                                               ║
   426→║   ┌─────────────────────────────────────────────────────────────────────────┐║
   427→║   │                       AUTOMATIC EXTRACTION                              │║
   428→║   ├─────────────────────────────────────────────────────────────────────────┤║
   429→║   │                                                                         │║
   430→║   │  用户输入: "刚才开会真的气死我了，老板简直不可理喻"                     │║
   431→║   │                                                                         │║
   432→║   │  系统提取:                                                              │║
   433→║   │  ├─ 情绪: Anger (愤怒)                                                 │║
   434→║   │  ├─ 强度: 8/10                                                         │║
   435→║   │  ├─ 场景: Work (工作)                                                  │║
   436→║   │  ├─ 对象: Boss (上级)                                                  │║
   437→║   │  ├─ 触发: Meeting (会议)                                               │║
   438→║   │  └─ 能量变化: -3                                                       │║
   439→║   │                                                                         │║
   440→║   │  自动标签: #Work #Anger #Boss                                          │║
   441→║   │  即时反馈: Aura 变红 + 能量条下降动画                                  │║
   442→║   │                                                                         │║
   443→║   └─────────────────────────────────────────────────────────────────────────┘║
   444→║                                                                               ║
   445→╚═══════════════════════════════════════════════════════════════════════════════╝4.2 Action Cards (行动卡片)╔═══════════════════════════════════════════════════════════════════════════════╗
   446→║                           ACTION CARDS SYSTEM                                  ║
   447→║                           (Agent 主动干预载体)                                 ║
   448→╠═══════════════════════════════════════════════════════════════════════════════╣
   449→║                                                                               ║
   450→║   TYPE 1: 建议执行卡 (Suggestion Card)                                        ║
   451→║   ─────────────────────────────────────────────────────────────────────────   ║
   452→║   ┌─────────────────────────────────────────────────────────────────────┐    ║
   453→║   │ 🧘 建议: 3分钟呼吸法                                                │    ║
   454→║   │ "检测到情绪波动，建议做个简短的呼吸练习"                            │    ║
   455→║   │                                                                     │    ║
   456→║   │ [ ▶ 开始 ]  [ ⏭ 稍后 ]  [ ✗ 跳过 ]                                  │    ║
   457→║   │                                                                     │    ║
   458→║   │ ████████████░░░░░░░░ 长按完成                                       │    ║
   459→║   └─────────────────────────────────────────────────────────────────────┘    ║
   460→║   交互: 长按充能 → 进度条填满 → 自动完成 → 动量 +1                           ║
   461→║                                                                               ║
   462→║   TYPE 2: 确认反馈卡 (Confirmation Card)                                      ║
   463→║   ─────────────────────────────────────────────────────────────────────────   ║
   464→║   ┌─────────────────────────────────────────────────────────────────────┐    ║
   465→║   │ ✓ 识别到行为                                                        │    ║
   466→║   │ "你刚才说'静下心来冥想了一会儿'，是完成了冥想任务吗？"              │    ║
   467→║   │                                                                     │    ║
   468→║   │ [ ✓ 是的 ]  [ ✗ 不是 ]  [ 🔔 设置提醒 ]                             │    ║
   469→║   └─────────────────────────────────────────────────────────────────────┘    ║
   470→║   选择"是的": 自动打卡 + 动量 +1 + Aura 变亮                                 ║
   471→║                                                                               ║
   472→║   TYPE 3: 洞察分享卡 (Insight Card)                                           ║
   473→║   ─────────────────────────────────────────────────────────────────────────   ║
   474→║   ┌─────────────────────────────────────────────────────────────────────┐    ║
   475→║   │ 💡 模式发现                                                         │    ║
   476→║   │ "我注意到你连续3个周二下午情绪都会崩溃。"                           │    ║
   477→║   │ "这和周二的会议有关吗？"                                            │    ║
   478→║   │                                                                     │    ║
   479→║   │ [ 🔍 深入分析 ]  [ ✓ 确实如此 ]  [ ✗ 不太相关 ]                     │    ║
   480→║   └─────────────────────────────────────────────────────────────────────┘    ║
   481→║   选择"确实如此": 更新用户画像 + 下周二提前干预                              ║
   482→║                                                                               ║
   483→║   TYPE 4: 里程碑庆祝卡 (Milestone Card)                                       ║
   484→║   ─────────────────────────────────────────────────────────────────────────   ║
   485→║   ┌─────────────────────────────────────────────────────────────────────┐    ║
   486→║   │ 🎉 连续 7 天！                                                      │    ║
   487→║   │ "你已经连续7天完成微习惯了！"                                       │    ║
   488→║   │ "根据研究，21天可以形成习惯。继续加油！"                            │    ║
   489→║   │                                                                     │    ║
   490→║   │ [ 🔓 解锁: 本周深度报告 ]                                           │    ║
   491→║   │ [ 📤 分享成就 ]                                                     │    ║
   492→║   └─────────────────────────────────────────────────────────────────────┘    ║
   493→║                                                                               ║
   494→╚═══════════════════════════════════════════════════════════════════════════════╝4.3 Dynamic Aura System (动态光环系统)╔═══════════════════════════════════════════════════════════════════════════════╗
   495→║                           DYNAMIC AURA SYSTEM                                  ║
   496→║                           (情绪可视化 + 环境感知)                              ║
   497→╠═══════════════════════════════════════════════════════════════════════════════╣
   498→║                                                                               ║
   499→║   ┌─────────────────────────────────────────────────────────────────────────┐║
   500→║   │                         AURA STATES                                     │║
   501→║   ├─────────────────────────────────────────────────────────────────────────┤║
   502→║   │                                                                         │║
   503→║   │  🔵 CALM (平静)       →  蓝色渐变 + 缓慢粒子上升                       │║
   504→║   │     Energy: 60-80                                                       │║
   505→║   │     Background: linear-gradient(135deg, #1a1a2e, #2d3561)              │║
   506→║   │                                                                         │║
   507→║   │  🔴 ALERT (警觉)      →  红色脉冲 + 快速粒子                           │║
   508→║   │     Energy: < 30 OR Anger detected                                      │║
   509→║   │     Background: linear-gradient(135deg, #2e1a1a, #613535)              │║
   510→║   │                                                                         │║
   511→║   │  🟡 HAPPY (愉悦)      →  金色光晕 + 弹跳粒子                           │║
   512→║   │     Energy: > 80 AND Joy detected                                       │║
   513→║   │     Background: linear-gradient(135deg, #2e2a1a, #61553d)              │║
   514→║   │                                                                         │║
   515→║   │  🟣 ANXIOUS (焦虑)    →  紫色波动 + 不规则粒子                         │║
   516→║   │     Energy: < 50 AND Anxiety detected                                   │║
   517→║   │     Background: linear-gradient(135deg, #1a1a2e, #3d2d61)              │║
   518→║   │                                                                         │║
   519→║   │  🟢 FLOW (心流)       →  绿色稳定 + 聚焦光芒                           │║
   520→║   │     Energy: > 70 AND Focus detected                                     │║
   521→║   │     Background: linear-gradient(135deg, #1a2e1a, #2d6135)              │║
   522→║   │                                                                         │║
   523→║   └─────────────────────────────────────────────────────────────────────────┘║
   524→║                                                                               ║
   525→║   ┌─────────────────────────────────────────────────────────────────────────┐║
   526→║   │                         AURA COMPONENTS                                 │║
   527→║   ├─────────────────────────────────────────────────────────────────────────┤║
   528→║   │                                                                         │║
   529→║   │  Layer 1: Base Gradient (基础渐变)                                      │║
   530→║   │  ─────────────────────────────────────────────────────────────────     │║
   531→║   │  position: fixed; inset: 0; transition: 2s ease;                       │║
   532→║   │                                                                         │║
   533→║   │  Layer 2: Glow Orbs (光晕球体)                                          │║
   534→║   │  ─────────────────────────────────────────────────────────────────     │║
   535→║   │  3个绝对定位的模糊圆形，filter: blur(100px);                           │║
   536→║   │  animation: float 8s ease-in-out infinite;                             │║
   537→║   │                                                                         │║
   538→║   │  Layer 3: Particles (粒子效果)                                          │║
   539→║   │  ─────────────────────────────────────────────────────────────────     │║
   540→║   │  15个上升的小圆点，opacity 渐变消失                                    │║
   541→║   │  animation: rise 6s ease-in infinite;                                  │║
   542→║   │                                                                         │║
   543→║   └─────────────────────────────────────────────────────────────────────────┘║
   544→║                                                                               ║
   545→║   ┌─────────────────────────────────────────────────────────────────────────┐║
   546→║   │                         TRANSITION LOGIC                                │║
   547→║   ├─────────────────────────────────────────────────────────────────────────┤║
   548→║   │                                                                         │║
   549→║   │  const getAuraState = (emotion: Emotion, energy: number): AuraState => {│║
   550→║   │    if (emotion === 'anger' || energy < 30) return 'alert';             │║
   551→║   │    if (emotion === 'joy' && energy > 80) return 'happy';               │║
   552→║   │    if (emotion === 'anxiety') return 'anxious';                        │║
   553→║   │    if (emotion === 'focus' && energy > 70) return 'flow';              │║
   554→║   │    return 'calm';                                                       │║
   555→║   │  };                                                                     │║
   556→║   │                                                                         │║
   557→║   │  // 状态变化时触发 2 秒渐变动画                                         │║
   558→║   │  // 用户每次输入后检测是否需要状态转换                                  │║
   559→║   │                                                                         │║
   560→║   └─────────────────────────────────────────────────────────────────────────┘║
   561→║                                                                               ║
   562→╚═══════════════════════════════════════════════════════════════════════════════╝4.4 自然语言行为识别 (NLU Action Recognition)╔═══════════════════════════════════════════════════════════════════════════════╗
   563→║                        NLU ACTION RECOGNITION                                  ║
   564→║                        (自然语言 → 自动打卡)                                   ║
   565→╠═══════════════════════════════════════════════════════════════════════════════╣
   566→║                                                                               ║
   567→║   用户 Vibe Diary 输入          →    系统识别                →    自动动作    ║
   568→║   ─────────────────────────────────────────────────────────────────────────   ║
   569→║                                                                               ║
   570→║   "刚才静下心来冥想了一会儿"    →    冥想行为                →    打卡 +1     ║
   571→║   "喝了杯水"                    →    补水行为                →    打卡 +1     ║
   572→║   "忍住没发火"                  →    情绪控制成功            →    打卡 +2     ║
   573→║   "今天早睡了"                  →    作息改善                →    打卡 +1     ║
   574→║   "出去走了走"                  →    运动行为                →    打卡 +1     ║
   575→║   "写了两页日记"                →    反思行为                →    打卡 +1     ║
   576→║   "没有冲动消费"                →    财务自控                →    打卡 +2     ║
   577→║   "主动道歉了"                  →    关系修复                →    打卡 +3     ║
   578→║                                                                               ║
   579→║   ─────────────────────────────────────────────────────────────────────────   ║
   580→║                                                                               ║
   581→║   实现架构:                                                                    ║
   582→║                                                                               ║
   583→║   ┌─────────────────────────────────────────────────────────────────────────┐║
   584→║   │                                                                         │║
   585→║   │   User Input                                                            │║
   586→║   │      │                                                                  │║
   587→║   │      ▼                                                                  │║
   588→║   │   ┌─────────────────┐                                                   │║
   589→║   │   │ Text Embedding  │  OpenAI text-embedding-3-small                   │║
   590→║   │   │ (用户输入向量化)│                                                   │║
   591→║   │   └────────┬────────┘                                                   │║
   592→║   │            │                                                            │║
   593→║   │            ▼                                                            │║
   594→║   │   ┌─────────────────┐    ┌─────────────────┐                           │║
   595→║   │   │ Vector Search   │ ←─ │ Behavior Library │  预定义行为向量库        │║
   596→║   │   │ (相似度匹配)    │    │ (冥想/运动/...)  │                           │║
   597→║   │   └────────┬────────┘    └─────────────────┘                           │║
   598→║   │            │                                                            │║
   599→║   │            ▼                                                            │║
   600→║   │   ┌─────────────────┐                                                   │║
   601→║   │   │ Pending Tasks   │  如果有待完成任务，优先匹配该任务                │║
   602→║   │   │ (任务上下文)    │                                                   │║
   603→║   │   └────────┬────────┘                                                   │║
   604→║   │            │                                                            │║
   605→║   │            ▼                                                            │║
   606→║   │   ┌─────────────────┐                                                   │║
   607→║   │   │ Confidence Check│  相似度 > 0.85 → 自动确认                        │║
   608→║   │   │ (置信度检查)    │  相似度 0.6-0.85 → 弹出确认卡片                   │║
   609→║   │   └────────┬────────┘  相似度 < 0.6 → 忽略                             │║
   610→║   │            │                                                            │║
   611→║   │            ▼                                                            │║
   612→║   │   ┌─────────────────┐                                                   │║
   613→║   │   │ Auto Checkin    │  更新数据库 + 发送 WebSocket 通知                │║
   614→║   │   │ (自动打卡)      │                                                   │║
   615→║   │   └─────────────────┘                                                   │║
   616→║   │                                                                         │║
   617→║   └─────────────────────────────────────────────────────────────────────────┘║
   618→║                                                                               ║
   619→╚═══════════════════════════════════════════════════════════════════════════════╝5. 数据采集5.1 数据采集架构╔═══════════════════════════════════════════════════════════════════════════════╗
   620→║                        DATA COLLECTION ARCHITECTURE                            ║
   621→╠═══════════════════════════════════════════════════════════════════════════════╣
   622→║                                                                               ║
   623→║   ┌─────────────────────────────────────────────────────────────────────────┐║
   624→║   │                        ACTIVE INPUT (主动输入)                           │║
   625→║   ├─────────────────────────────────────────────────────────────────────────┤║
   626→║   │                                                                         │║
   627→║   │  🎙️ Voice Stream          语音输入 → Whisper STT → 文本                │║
   628→║   │  ⌨️ Text Input            自由文本输入                                  │║
   629→║   │  📷 Photo + Caption       图片 + 可选描述 → Vision API                  │║
   630→║   │  📍 Location Share        位置共享 (可选)                               │║
   631→║   │  🎯 Quick Mood            一键情绪选择 (5个表情)                        │║
   632→║   │                                                                         │║
   633→║   └─────────────────────────────────────────────────────────────────────────┘║
   634→║                                                                               ║
   635→║   ┌─────────────────────────────────────────────────────────────────────────┐║
   636→║   │                        PASSIVE TRACKING (被动追踪)                       │║
   637→║   ├─────────────────────────────────────────────────────────────────────────┤║
   638→║   │                                                                         │║
   639→║   │  ⏰ Time Patterns          App 使用时间、频率                           │║
   640→║   │  📱 Device Sensors         屏幕亮度、步数 (需授权)                      │║
   641→║   │  🌙 Sleep Inference        入睡/起床时间推断                            │║
   642→║   │  📅 Calendar Integration   日历事件 (需授权)                            │║
   643→║   │  🔔 Notification Response  通知响应时间                                 │║
   644→║   │                                                                         │║
   645→║   └─────────────────────────────────────────────────────────────────────────┘║
   646→║                                                                               ║
   647→║   ┌─────────────────────────────────────────────────────────────────────────┐║
   648→║   │                        STATIC DATA (静态数据)                            │║
   649→║   ├─────────────────────────────────────────────────────────────────────────┤║
   650→║   │                                                                         │║
   651→║   │  🎂 Birth Information      生辰八字 (一次性输入)                        │║
   652→║   │  📝 Onboarding Survey      入门问卷 (Mirror Test)                       │║
   653→║   │  ⚙️ Preferences            偏好设置                                     │║
   654→║   │  🔗 Third-party Links      第三方账号关联                               │║
   655→║   │                                                                         │║
   656→║   └─────────────────────────────────────────────────────────────────────────┘║
   657→║                                                                               ║
   658→╚═══════════════════════════════════════════════════════════════════════════════╝5.2 数据 ETL 流水线╔═══════════════════════════════════════════════════════════════════════════════╗
   659→║                           ETL PIPELINE                                         ║
   660→╠═══════════════════════════════════════════════════════════════════════════════╣
   661→║                                                                               ║
   662→║   ┌─────────────────────────────────────────────────────────────────────────┐║
   663→║   │                                                                         │║
   664→║   │   Raw Input                                                             │║
   665→║   │      │                                                                  │║
   666→║   │      ├──────────────────────────────────────────────────────────────   │║
   667→║   │      │                                                                  │║
   668→║   │      │  EXTRACT (提取)                                                  │║
   669→║   │      │  ─────────────────────────────────────────────────────────────  │║
   670→║   │      ▼                                                                  │║
   671→║   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │║
   672→║   │   │   Whisper   │  │  GPT-4 NLP  │  │Vision Model│  │  Embedding  │   │║
   673→║   │   │   (STT)     │  │  (Entity)   │  │  (Image)   │  │  (Vector)   │   │║
   674→║   │   └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘   │║
   675→║   │          └─────────────────┴─────────────────┴─────────────────┘        │║
   676→║   │                                  │                                      │║
   677→║   │      ├──────────────────────────────────────────────────────────────   │║
   678→║   │      │                                                                  │║
   679→║   │      │  TRANSFORM (转换)                                                │║
   680→║   │      │  ─────────────────────────────────────────────────────────────  │║
   681→║   │      ▼                                                                  │║
   682→║   │   ┌───────────────────────────────────────────────────────────────────┐│║
   683→║   │   │  Structured Output Schema                                         ││║
   684→║   │   │                                                                   ││║
   685→║   │   │  {                                                                ││║
   686→║   │   │    "raw_text": "刚才开会真的气死我了",                            ││║
   687→║   │   │    "emotion": {                                                   ││║
   688→║   │   │      "primary": "anger",                                          ││║
   689→║   │   │      "intensity": 8,                                              ││║
   690→║   │   │      "secondary": ["frustration", "helplessness"]                 ││║
   691→║   │   │    },                                                             ││║
   692→║   │   │    "context": {                                                   ││║
   693→║   │   │      "scene": "work",                                             ││║
   694→║   │   │      "trigger": "meeting",                                        ││║
   695→║   │   │      "target": "boss"                                             ││║
   696→║   │   │    },                                                             ││║
   697→║   │   │    "energy_delta": -3,                                            ││║
   698→║   │   │    "behavior_match": null,                                        ││║
   699→║   │   │    "tags": ["#Work", "#Anger", "#Boss"],                          ││║
   700→║   │   │    "embedding": [0.123, -0.456, ...]                              ││║
   701→║   │   │  }                                                                ││║
   702→║   │   │                                                                   ││║
   703→║   │   └───────────────────────────────────────────────────────────────────┘│║
   704→║   │                                  │                                      │║
   705→║   │      ├──────────────────────────────────────────────────────────────   │║
   706→║   │      │                                                                  │║
   707→║   │      │  LOAD (加载)                                                     │║
   708→║   │      │  ─────────────────────────────────────────────────────────────  │║
   709→║   │      ▼                                                                  │║
   710→║   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │║
   711→║   │   │ PostgreSQL  │  │   Redis     │  │  Pinecone   │  │  R2/S3      │   │║
   712→║   │   │ (Stream DB) │  │ (State)     │  │ (Vectors)   │  │ (Media)     │   │║
   713→║   │   └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │║
   714→║   │                                                                         │║
   715→║   └─────────────────────────────────────────────────────────────────────────┘║
   716→║                                                                               ║
   717→╚═══════════════════════════════════════════════════════════════════════════════╝6. 前端交互6.1 响应式布局设计╔═══════════════════════════════════════════════════════════════════════════════╗
   718→║                        RESPONSIVE LAYOUT DESIGN                                ║
   719→╠═══════════════════════════════════════════════════════════════════════════════╣
   720→║                                                                               ║
   721→║   MOBILE (<1024px): Full-Screen Stream                                        ║
   722→║   ─────────────────────────────────────────────────────────────────────────   ║
   723→║                                                                               ║
   724→║   ┌───────────────────────────────────────────────────────────────────────┐  ║
   725→║   │  [Top Status Bar]  🔥 72 动量  |  🌊 Day 7  |  ⚙️                      │  ║
   726→║   ├───────────────────────────────────────────────────────────────────────┤  ║
   727→║   │                                                                       │  ║
   728→║   │  ┌─────────────────────────────────────────────────────────────────┐ │  ║
   729→║   │  │ 🤖 MENTIS (Agent Card)                                          │ │  ║
   730→║   │  │ "早上好！今天水星逆行进入尾声..."                                │ │  ║
   731→║   │  │                                                                 │ │  ║
   732→║   │  │ [ 🧘 3分钟呼吸法 ]  ← 可交互卡片                                │ │  ║
   733→║   │  │ ████████░░░░░░░░ 长按完成                                       │ │  ║
   734→║   │  └─────────────────────────────────────────────────────────────────┘ │  ║
   735→║   │                                                                       │  ║
   736→║   │  ┌─────────────────────────────────────────────────────────────────┐ │  ║
   737→║   │  │ 👤 You (5 min ago)                              [VIBE DIARY]    │ │  ║
   738→║   │  │ "刚才开会真的气死我了，老板简直不可理喻..."                     │ │  ║
   739→║   │  │                                                                 │ │  ║
   740→║   │  │ 🏷️ #Work #Anger  |  🔥 能量 -3                                 │ │  ║
   741→║   │  └─────────────────────────────────────────────────────────────────┘ │  ║
   742→║   │                                                                       │  ║
   743→║   │  ┌─────────────────────────────────────────────────────────────────┐ │  ║
   744→║   │  │ 👤 You (30 min ago)                             [VIBE DIARY]    │ │  ║
   745→║   │  │ "静下心来写了会儿代码，效率还不错"                              │ │  ║
   746→║   │  │                                                                 │ │  ║
   747→║   │  │ 🏷️ #Work #Flow  |  ✨ 能量 +2                                  │ │  ║
   748→║   │  │ └─ 🤖 AI 识别: 这是你本周第3次进入心流状态                     │ │  ║
   749→║   │  └─────────────────────────────────────────────────────────────────┘ │  ║
   750→║   │                                                                       │  ║
   751→║   │                         ... more cards ...                            │  ║
   752→║   │                                                                       │  ║
   753→║   ├───────────────────────────────────────────────────────────────────────┤  ║
   754→║   │  [Magic Input]                                                        │  ║
   755→║   │  ┌─────────────────────────────────────────────────────────────────┐ │  ║
   756→║   │  │  🎙️ (长按说话)   📷   |   有什么想告诉我的...                  │ │  ║
   757→║   │  └─────────────────────────────────────────────────────────────────┘ │  ║
   758→║   └───────────────────────────────────────────────────────────────────────┘  ║
   759→║                                                                               ║
   760→║   DESKTOP (≥1024px): Three-Column Layout                                      ║
   761→║   ─────────────────────────────────────────────────────────────────────────   ║
   762→║                                                                               ║
   763→║   ┌────────────────┬─────────────────────────────┬────────────────────────┐  ║
   764→║   │                │                             │                        │  ║
   765→║   │  CONTEXT       │         STREAM              │      INSIGHT           │  ║
   766→║   │  (左侧栏)      │         (中间主区)          │      (右侧栏)          │  ║
   767→║   │                │                             │                        │  ║
   768→║   │  ┌──────────┐  │                             │  ┌──────────────────┐  │  ║
   769→║   │  │ 🔥 动量   │  │    [Stream Content]        │  │ 💡 今日洞察       │  │  ║
   770→║   │  │ 72/100   │  │                             │  │                  │  │  ║
   771→║   │  │ ████████ │  │                             │  │ "你本周的情绪   │  │  ║
   772→║   │  └──────────┘  │                             │  │  波动主要集中   │  │  ║
   773→║   │                │                             │  │  在工作场景..." │  │  ║
   774→║   │  ┌──────────┐  │                             │  │                  │  │  ║
   775→║   │  │ 📊 本周   │  │                             │  │ [ 深入分析 ]    │  │  ║
   776→║   │  │ 能量趋势  │  │                             │  └──────────────────┘  │  ║
   777→║   │  │   ╭──╮   │  │                             │                        │  ║
   778→║   │  │ ╭─╯  ╰─ │  │                             │  ┌──────────────────┐  │  ║
   779→║   │  └──────────┘  │                             │  │ 🎯 待完成任务    │  │  ║
   780→║   │                │                             │  │                  │  │  ║
   781→║   │  ┌──────────┐  │                             │  │ ☐ 冥想 3分钟    │  │  ║
   782→║   │  │ 🌙 今日   │  │                             │  │ ☐ 补水 8杯     │  │  ║
   783→║   │  │ 运势指数  │  │                             │  │ ✓ 早起         │  │  ║
   784→║   │  │ ⭐⭐⭐⭐☆  │  │                             │  └──────────────────┘  │  ║
   785→║   │  └──────────┘  │                             │                        │  ║
   786→║   │                │                             │                        │  ║
   787→║   └────────────────┴─────────────────────────────┴────────────────────────┘  ║
   788→║                                                                               ║
   789→╚═══════════════════════════════════════════════════════════════════════════════╝6.2 核心组件架构typescript// 前端组件架构 (React/Next.js)
   790→
   791→interface ComponentArchitecture {
   792→  
   793→  // ════════════════════════════════════════════════════════════════════════
   794→  // STREAM 核心组件
   795→  // ════════════════════════════════════════════════════════════════════════
   796→  
   797→  StreamInput: {
   798→    modes: ['voice', 'text', 'photo'];
   799→    features: ['streaming_render', 'auto_tag', 'emotion_detect'];
   800→    position: 'fixed_bottom';

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
