     1→# VibeLife - 资源配置
     2→
     3→> 最后更新: 2026-01-05 | Phase 14 完成
     4→
     5→---
     6→
     7→## 0. 部署架构
     8→
     9→### 正式部署 (Production)
    10→
    11→```
    12→┌─────────────────────────────────────────────────────────────────────────────┐
    13→│                              用户浏览器                                      │
    14→└─────────────────────────────────┬───────────────────────────────────────────┘
    15→                                  │
    16→                      ┌───────────┴───────────┐
    17→                      │     Cloudflare        │
    18→                      │  (DNS + CDN + SSL)    │
    19→                      │  vibelife.app 域名    │
    20→                      └───────────┬───────────┘
    21→                                  │
    22→          ┌───────────────────────┴───────────────────────┐
    23→          │                                               │
    24→          ▼                                               ▼
    25→┌─────────────────────────────┐           ┌─────────────────────────────────┐
    26→│   Vercel / 阿里云香港        │           │      aiscend 服务器              │
    27→│   (前端)                     │           │      (后端 + 数据库)             │
    28→│                             │           │                                 │
    29→│  vibelife.app        ───────┼───────────┼───► api.vibelife.app            │
    30→│  bazi.vibelife.app          │   HTTPS   │     FastAPI + PostgreSQL        │
    31→│  zodiac.vibelife.app        │   API     │     106.37.170.238              │
    32→│  mbti.vibelife.app          │           │                                 │
    33→└─────────────────────────────┘           └─────────────────────────────────┘
    34→```
    35→
    36→| 组件 | 提供商 | 说明 |
    37→|------|--------|------|
    38→| **域名** | Cloudflare | `vibelife.app` 注册和 DNS 管理 |
    39→| **前端** | Vercel 或 阿里云香港 | Next.js SSR/SSG |
    40→| **后端** | aiscend 服务器 | FastAPI + Docker |
    41→| **数据库** | aiscend 服务器 | PostgreSQL + pgvector |
    42→| **CDN** | Cloudflare | 全球加速 + SSL |
    43→
    44→### 域名规划
    45→
    46→| 域名 | 用途 | 部署位置 |
    47→|------|------|----------|
    48→| `vibelife.app` | 主站 Landing | Vercel/阿里云 |
    49→| `api.vibelife.app` | API 服务 | aiscend |
    50→| `bazi.vibelife.app` | 八字站点 | Vercel/阿里云 |
    51→| `zodiac.vibelife.app` | 星座站点 | Vercel/阿里云 |
    52→| `mbti.vibelife.app` | MBTI 站点 | Vercel/阿里云 |
    53→| `id.vibelife.app` | Vibe ID 认证中心 | Vercel/阿里云 |
    54→
    55→---
    56→
    57→## 0.1 临时测试部署
    58→
    59→**服务器**: `106.37.170.238` (aiscend)
    60→
    61→| 服务 | 端口 | 访问地址 |
    62→|------|------|----------|
    63→| **API 后端** | 8000 | `http://106.37.170.238:8000` |
    64→| **主站 (vibelife)** | 8230 | `http://106.37.170.238:8230` |
    65→| **八字站 (bazi)** | 8231 | `http://106.37.170.238:8231` |
    66→| **星座站 (zodiac)** | 8232 | `http://106.37.170.238:8232` |
    67→
    68→**测试启动命令**:
    69→```bash
    70→# 后端 API
    71→cd /home/aiscend/work/vibelife/apps/api
    72→uvicorn main:app --port 8000 --host 0.0.0.0
    73→
    74→# 主站前端
    75→cd /home/aiscend/work/vibelife/apps/web
    76→NEXT_PUBLIC_API_URL=http://106.37.170.238:8000 \
    77→NEXT_PUBLIC_SITE_ID=vibelife \
    78→pnpm dev --port 8230
    79→
    80→# 八字站前端
    81→NEXT_PUBLIC_API_URL=http://106.37.170.238:8000 \
    82→NEXT_PUBLIC_SITE_ID=bazi \
    83→pnpm dev --port 8231
    84→
    85→# 星座站前端
    86→NEXT_PUBLIC_API_URL=http://106.37.170.238:8000 \
    87→NEXT_PUBLIC_SITE_ID=zodiac \
    88→pnpm dev --port 8232
    89→```
    90→
    91→---
    92→
    93→## 1. 数据库
    94→
    95→**PostgreSQL (aiscend 服务器)** ✅ 已验证
    96→
    97→| 配置项 | 值 |
    98→|--------|-----|
    99→| 主机 | `106.37.170.238` |
   100→| 端口 | `8224` |
   101→| 用户 | `postgres` |
   102→| 密码 | `<REDACTED>` |
   103→| 数据库 | `vibelife` |
   104→| 连接字符串 | `postgresql://postgres:<REDACTED>@106.37.170.238:8224/vibelife` |
   105→
   106→**已创建表 (14个)**:
   107→- `vibe_users` - 用户核心表
   108→- `vibe_user_auth` - 认证方式表
   109→- `vibe_data_consents` - 数据共享授权表
   110→- `skill_profiles` - Skill Profile
   111→- `skill_conversations` - 对话记录
   112→- `skill_messages` - 消息记录
   113→- `skill_insights` - 洞察记录
   114→- `subscription_plans` - 订阅计划
   115→- `user_subscriptions` - 用户订阅状态
   116→- `knowledge_chunks` - 知识块 (含 pgvector 3072维)
   117→- `knowledge_qa_pairs` - QA 对
   118→- `fortune_events` - 运势事件日历
   119→- `reminder_settings` - 提醒设置
   120→- `user_notifications` - 用户通知记录
   121→
   122→## 2. 智谱 GLM (对话/图片)
   123→
   124→**API 控制台**: https://bigmodel.cn/usercenter/equity-mgmt/user-rights
   125→
   126→| 配置项 | 值 |
   127→|--------|-----|
   128→| API Key | `<REDACTED>` |
   129→| 对话模型 | `glm-4.7` ✅ (最新旗舰) |
   130→| 图片理解 | `glm-4.6v` ✅ (最新视觉) |
   131→| Base URL | `https://open.bigmodel.cn/api/paas/v4` |
   132→
   133→**API 文档**: https://docs.bigmodel.cn/cn/guide/models/text/glm-4.7
   134→
   135→## 3. Claude (备选)
   136→
   137→| 配置项 | 值 |
   138→|--------|-----|
   139→| API Key | 需配置 `CLAUDE_API_KEY` |
   140→| 模型 | `claude-3-5-sonnet-20241022` |
   141→
   142→## 4. Google Gemini (Embedding)
   143→
   144→**申请地址**: https://aistudio.google.com/app/apikey
   145→
   146→| 配置项 | 值 |
   147→|--------|-----|
   148→| API Key | `<REDACTED>` |
   149→| 模型 | `gemini-embedding-001` |
   150→| **维度** | **3072** |
   151→
   152→## 5. Pinecone (向量存储)
   153→
   154→**控制台**: https://app.pinecone.io/
   155→
   156→| 配置项 | 值 |
   157→|--------|-----|
   158→| API Key | `<REDACTED>` |
   159→| 索引 | `mentis-streams` (可复用) / `vibelife-knowledge` (新建) |
   160→| Host | `mentis-streams-nkchadl.svc.aped-4627-b74a.pinecone.io` |
   161→| **维度** | **3072** (与 Gemini 匹配) |
   162→| Metric | `cosine` |
   163→
   164→## 6. Stripe (支付)
   165→
   166→| 配置项 | 值 |
   167→|--------|-----|
   168→| Secret Key | 需配置 `STRIPE_SECRET_KEY` |
   169→| Publishable Key | 需配置 `STRIPE_PUBLISHABLE_KEY` |
   170→| Webhook Secret | 需配置 `STRIPE_WEBHOOK_SECRET` |
   171→| 控制台 | https://dashboard.stripe.com |
   172→
   173→## 7. 服务分工总览
   174→
   175→| 服务 | 提供商 | 模型/规格 | 状态 |
   176→|------|--------|----------|------|
   177→| 对话生成 | GLM | glm-4.7 | ✅ 已验证 |
   178→| 图片理解 | GLM | glm-4.6v | ✅ 已配置 |
   179→| 向量嵌入 | Gemini | gemini-embedding-001 (3072维) | ✅ 已验证 |
   180→| 向量存储 | Pinecone | mentis-streams (3072维) | ✅ 已验证 |
   181→| 星盘计算 | swisseph | Swiss Ephemeris | ✅ 已配置 |
   182→| 支付 | Stripe | Checkout + Subscription | ⏳ 待配置 |
   183→
   184→## 8. 环境变量
   185→
   186→完整环境变量已配置在 `/home/aiscend/work/vibelife/.env`
   187→
   188→```bash
   189→# ─────────────────────────────────────────────────────────────────
   190→# VIBELIFE 环境变量
   191→# ─────────────────────────────────────────────────────────────────
   192→
   193→# 数据库
   194→VIBELIFE_DB_URL=postgresql://postgres:<REDACTED>@106.37.170.238:8224/vibelife
   195→
   196→# JWT
   197→VIBELIFE_JWT_SECRET=<REDACTED>
   198→
   199→# CORS (测试环境)
   200→VIBELIFE_CORS_ORIGINS=http://106.37.170.238:8230,http://106.37.170.238:8231,http://106.37.170.238:8232,http://localhost:3000
   201→
   202→# 智谱 GLM (对话/图片)
   203→GLM_API_KEY=<REDACTED>
   204→GLM_CHAT_MODEL=glm-4.7
   205→GLM_VISION_MODEL=glm-4.6v
   206→
   207→# Claude (备选)
   208→CLAUDE_API_KEY=your-claude-api-key
   209→
   210→# Google Gemini (Embedding)
   211→GEMINI_API_KEY=<REDACTED>
   212→GEMINI_EMBEDDING_MODEL=gemini-embedding-001
   213→
   214→# Pinecone
   215→PINECONE_API_KEY=<REDACTED>
   216→PINECONE_HOST=mentis-streams-nkchadl.svc.aped-4627-b74a.pinecone.io
   217→
   218→# Stripe
   219→STRIPE_SECRET_KEY=sk_test_xxx
   220→STRIPE_PUBLISHABLE_KEY=pk_test_xxx
   221→STRIPE_WEBHOOK_SECRET=whsec_xxx
   222→
   223→# 默认 LLM 提供商
   224→DEFAULT_LLM_PROVIDER=glm
   225→```
   226→
   227→## 9. 启动命令
   228→
   229→### 测试环境 (单机多端口)
   230→
   231→```bash
   232→# 1. 启动后端 API (端口 8000)
   233→cd /home/aiscend/work/vibelife/apps/api
   234→uvicorn main:app --port 8000 --host 0.0.0.0 --reload
   235→
   236→# 2. 启动主站前端 (端口 8230)
   237→cd /home/aiscend/work/vibelife/apps/web
   238→NEXT_PUBLIC_API_URL=http://106.37.170.238:8000 pnpm dev --port 8230
   239→
   240→# 3. 启动八字站 (端口 8231) - 新终端
   241→NEXT_PUBLIC_API_URL=http://106.37.170.238:8000 \
   242→NEXT_PUBLIC_SITE_ID=bazi pnpm dev --port 8231
   243→
   244→# 4. 启动星座站 (端口 8232) - 新终端
   245→NEXT_PUBLIC_API_URL=http://106.37.170.238:8000 \
   246→NEXT_PUBLIC_SITE_ID=zodiac pnpm dev --port 8232
   247→```
   248→
   249→### 健康检查
   250→
   251→```bash
   252→# API
   253→curl http://106.37.170.238:8000/health
   254→
   255→# 主站
   256→curl http://106.37.170.238:8230
   257→
   258→# 八字站
   259→curl http://106.37.170.238:8231
   260→
   261→# 星座站
   262→curl http://106.37.170.238:8232
   263→```
   264→
   265→## 10. 项目结构
   266→
   267→```
   268→/home/aiscend/work/vibelife/
   269→├── apps/
   270→│   ├── api/                     # FastAPI 后端
   271→│   │   ├── main.py              # 应用入口
   272→│   │   ├── requirements.txt     # Python 依赖
   273→│   │   ├── Dockerfile
   274→│   │   ├── routes/              # API 路由
   275→│   │   ├── services/            # 业务服务
   276→│   │   ├── tools/               # 专业工具
   277→│   │   └── tests/               # 测试
   278→│   │
   279→│   └── web/                     # Next.js 14 前端
   280→│       ├── package.json
   281→│       ├── tailwind.config.ts
   282→│       ├── Dockerfile
   283→│       └── src/
   284→│           ├── app/             # 页面
   285→│           ├── components/      # 组件
   286→│           └── lib/             # 工具库
   287→│
   288→├── deploy/
   289→│   ├── aiscend/                 # 后端部署配置
   290→│   │   ├── docker-compose.yml
   291→│   │   ├── nginx/
   292→│   │   └── scripts/
   293→│   └── aliyun/                  # 前端部署配置
   294→│       ├── README.md
   295→│       └── vercel.json
   296→│
   297→├── k8s/                         # Kubernetes 配置 (备用)
   298→├── docs/                        # 文档
   299→├── migrations/                  # 数据库迁移
   300→├── .github/workflows/           # CI/CD
   301→├── .env                         # 环境变量
   302→└── docker-compose.yml           # 本地开发
   303→```
   304→
   305→## 11. 进度状态
   306→
   307→- [x] Phase 0: 项目初始化 ✅ 2026-01-05
   308→- [x] Phase 1: 数据层完善 ✅
   309→- [x] Phase 2: Vibe ID 统一身份系统 ✅
   310→- [x] Phase 3: 核心引擎层 (Vibe Engine) ✅
   311→- [x] Phase 4: 知识引擎层 ✅
   312→- [x] Phase 5: Skill Agent 层 ✅
   313→- [x] Phase 6: Skill 工具函数系统 ✅
   314→- [x] Phase 7: 体验层 ✅
   315→- [x] Phase 8: 独立站点层 (部分) ✅
   316→- [x] Phase 9: 主动智能系统 ✅
   317→- [x] Phase 10: Skill Mirror 系统 ✅
   318→- [x] Phase 11: 商业化系统 ✅
   319→- [x] Phase 12: 测试框架 ✅
   320→- [x] Phase 13: 文档 ✅
   321→- [x] Phase 14: 部署配置 ✅
   322→
   323→## 12. 下一步
   324→
   325→1. **测试部署**: 在 aiscend 服务器上启动测试环境
   326→2. **域名配置**: Cloudflare 配置 vibelife.app DNS
   327→3. **SSL 证书**: Let's Encrypt 申请证书
   328→4. **正式部署**: 前端部署到 Vercel/阿里云
   329→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
