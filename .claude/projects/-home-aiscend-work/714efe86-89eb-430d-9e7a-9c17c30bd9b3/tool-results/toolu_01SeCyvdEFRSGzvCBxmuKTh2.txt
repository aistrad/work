     1â†’# Fortune AI å‰ç«¯è®¾è®¡æ–¹æ¡ˆ
     2â†’
     3â†’**ç‰ˆæœ¬**ï¼šv4.2ï¼ˆ2026-01-01ï¼ŒVercel AI SDK Editionï¼‰
     4â†’
     5â†’> **å®šä½**: åŸºäº Notion ç¾å­¦çš„ AI æ™ºèƒ½å·¥ä½œç©ºé—´
     6â†’>
     7â†’> **åç«¯æ¶æ„**: Vercel AI SDK Driven / Pluggable Skillsï¼ˆå‚è§ [os_design_v3.md Â§1.4](./os_design_v3.md#14-è¿›åŒ–è®°å¿†æ¶æ„-vercel-ai-sdk-edition---v42)ï¼‰
     8â†’>
     9â†’> **å…¥å£**: http://106.37.170.238:8231/new
    10â†’>
    11â†’> **æœ¬ç‰ˆæ›´æ–°**: é‡‡ç”¨ Vercel AI SDK 6 `useChat()` Hook å®ç°ç«¯åˆ°ç«¯æµå¼æ¸²æŸ“
    12â†’
    13â†’---
    14â†’
    15â†’## 0. ä¿®è®¢è¯´æ˜
    16â†’
    17â†’### 0.0 å‰ç«¯ä¸åç«¯æ¶æ„å±‚äº¤äº’ (v4.2 Vercel AI SDK Edition)
    18â†’
    19â†’v4.2 é‡‡ç”¨ **Vercel AI SDK** ä½œä¸ºç»Ÿä¸€ Agent Runtimeï¼Œå‰ç«¯é€šè¿‡ `useChat()` Hook ä¸ Next.js API Route äº¤äº’ï¼š
    20â†’
    21â†’```
    22â†’â”Œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”
    23â†’â”‚                           Frontend (Next.js + Vercel AI SDK)                   â”‚
    24â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    25â†’â”‚      Zone A (Chat)                â”‚           Zone B (Dashboard)               â”‚
    26â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    27â†’â”‚  â”‚ useChat() Hook              â”‚  â”‚  â”‚ Tabs: Overview/Status/Trends/Tasks  â”‚  â”‚
    28â†’â”‚  â”‚ â”œâ”€ messages (æµå¼æ¸²æŸ“)       â”‚  â”‚  â”‚ æ•°æ®å±•ç¤º â† GET FastAPI               â”‚  â”‚
    29â†’â”‚  â”‚ â”œâ”€ input / setInput         â”‚  â”‚  â”‚ â˜… Tool Result è§¦å‘ Tab è”åŠ¨         â”‚  â”‚
    30â†’â”‚  â”‚ â”œâ”€ handleSubmit             â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    31â†’â”‚  â”‚ â””â”€ toolInvocations (A2UI)   â”‚  â”‚                                           â”‚
    32â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                           â”‚
    33â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                           â”‚
    34â†’â”‚  â”‚ CommandPalette              â”‚  â”‚                                           â”‚
    35â†’â”‚  â”‚ â””â”€ /divine /heal /grow      â”‚  â”‚                                           â”‚
    36â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                           â”‚
    37â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    38â†’                    â”‚ useChat() â†’ POST /api/chat (HTTP Stream)
    39â†’                    â–¼
    40â†’â”Œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”
    41â†’â”‚  Agent Runtime Layer (Next.js API Route)                         NEW in v4.2  â”‚
    42â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    43â†’â”‚  streamText({                                                                  â”‚
    44â†’â”‚    model: selectModel(),      // GLM-4.5 / Gemini / Claude                    â”‚
    45â†’â”‚    system: buildSystemPrompt(context),                                        â”‚
    46â†’â”‚    tools: { calculate_bazi, log_perma, covey_matrix, ... },                   â”‚
    47â†’â”‚    maxSteps: 5,               // Agent Loop å¤šæ­¥æ¨ç†                          â”‚
    48â†’â”‚  }) â†’ toDataStreamResponse()                                                   â”‚
    49â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    50â†’        â”‚ Tool execute: fetch() è°ƒç”¨ Python API
    51â†’        â–¼
    52â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    53â†’â”‚  FastAPI (Python) - Data Service Only                                          â”‚
    54â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    55â†’â”‚  /api/bazi/calculate  â†’ L1 å…«å­—æ’ç›˜                                            â”‚
    56â†’â”‚  /api/perma/log       â†’ L1 PERMA è®°å½•                                          â”‚
    57â†’â”‚  /api/goals/create    â†’ L1 ç›®æ ‡ç®¡ç†                                            â”‚
    58â†’â”‚  /api/user/context    â†’ L0+L1 ä¸Šä¸‹æ–‡èšåˆ                                       â”‚
    59â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    60â†’```
    61â†’
    62â†’**v4.2 æ ¸å¿ƒå˜åŒ–**:
    63â†’
    64â†’| v4.0/v4.1 | v4.2 (Vercel AI SDK) | è¯´æ˜ |
    65â†’|-----------|----------------------|------|
    66â†’| è‡ªå®šä¹‰ SSE `/api/chat/stream` | `useChat()` + `toDataStreamResponse()` | æ ‡å‡†åŒ–æµå¼åè®® |
    67â†’| `lib/api.ts` æ‰‹åŠ¨ fetch | `ai/react` å†…ç½® Hook | ç®€åŒ–å‰ç«¯ä»£ç  |
    68â†’| A2UI JSON å—æ‰‹åŠ¨è§£æ | `toolInvocations` è‡ªåŠ¨è§£æ | Tool Result åŸç”Ÿæ”¯æŒ |
    69â†’| CSRF Token æ‰‹åŠ¨å¤„ç† | Next.js API Route åŒæº | æ— è·¨åŸŸé—®é¢˜ |
    70â†’| Python `glm_client.py` | TypeScript `streamText()` | AI é€»è¾‘è¿ç§»åˆ° TS |
    71â†’
    72â†’### 0.1 è®¾è®¡ vs å®ç°å¯¹æ¯”æ€»è§ˆ
    73â†’
    74â†’| æ¨¡å— | è®¾è®¡çŠ¶æ€ | å®ç°çŠ¶æ€ | å·®è· | å¯¹åº”æ¶æ„å±‚ |
    75â†’|------|----------|----------|------|------------|
    76â†’| åŒæ å¸ƒå±€ | âœ… Zone A + Zone B | âœ… å·²å®ç° | æ—  | - |
    77â†’| é»„é‡‘åˆ†å‰²æ¯”ä¾‹ | âœ… 61.8% : 38.2% | âœ… å·²å®ç° | æ—  | - |
    78â†’| Resizer æ‹–æ‹½ | âœ… å¯è°ƒæ•´å®½åº¦ | âš ï¸ éƒ¨åˆ†å®ç° | åŒå‡»æ¢å¤é»˜è®¤ | - |
    79â†’| Tab ç³»ç»Ÿ | âœ… 6 ä¸ª Tab | âœ… å·²å®ç° | æ—  | L1 Module Data |
    80â†’| A2UI æ¸²æŸ“ | âœ… action_buttons | âš ï¸ éƒ¨åˆ†å®ç° | æŒ‰é’®ç‚¹å‡»å¤„ç† | Context Mgmt |
    81â†’| CSRF å¤„ç† | âœ… X-CSRF-Token | âš ï¸ é—®é¢˜ | å‰ç«¯æœªç»Ÿä¸€ | - |
    82â†’| éª¨æ¶å± | âœ… Shimmer åŠ è½½ | âš ï¸ éƒ¨åˆ†å®ç° | éœ€å®Œå–„ | - |
    83â†’
    84â†’---
    85â†’
    86â†’## 1. æ•´ä½“æ¶æ„ (Mermaid)
    87â†’
    88â†’> **å‘½åè§„èŒƒ**: å‚è§ [GLOSSARY.md](../GLOSSARY.md)
    89â†’> **åç«¯æ¶æ„**: Dynamic Profiling & Evolutionary Loopï¼ˆå‚è§ [os_design_v3.md Â§1.4](../os/os_design_v3.md#14-è¿›åŒ–è®°å¿†æ¶æ„-evolutionary-memory-view---v40)ï¼‰
    90â†’> **å…¥å£**: `/new` (basePath="/new")ï¼Œæ—§å…¥å£ `/main` `/login` `/register` å‡ 307 é‡å®šå‘
    91â†’
    92â†’### 1.1 å‰ç«¯ç»„ä»¶æ¶æ„å›¾
    93â†’
    94â†’> **v4.1 æ–°å¢**: Zone A çš„ ChatInput ç»„ä»¶é›†æˆ Command Paletteï¼Œæ”¯æŒ `/command` å¿«æ·æŒ‡ä»¤
    95â†’
    96â†’```mermaid
    97â†’graph TB
    98â†’    subgraph Browser["ğŸŒ Browser"]
    99â†’        direction TB
   100â†’        URL["URL: /new"]
   101â†’    end
   102â†’
   103â†’    subgraph NextJS["ğŸ“± Next.js (:8231)"]
   104â†’        subgraph AppRouter["App Router"]
   105â†’            RootLayout["layout.tsx<br/>Providers"]
   106â†’            NewLayout["new/layout.tsx<br/>åŒæ å®¹å™¨"]
   107â†’            NewPage["new/page.tsx<br/>ä¸»ç•Œé¢"]
   108â†’            LoginPage["new/login/page.tsx"]
   109â†’            RegisterPage["new/register/page.tsx"]
   110â†’        end
   111â†’
   112â†’        subgraph Components["Components"]
   113â†’            subgraph ZoneA["Zone A (61.8%)"]
   114â†’                ChatPanel["chat-panel.tsx"]
   115â†’                MessageList["message-list.tsx"]
   116â†’                MessageItem["message-item.tsx"]
   117â†’                BlockRenderer["blocks/index.tsx"]
   118â†’                subgraph InputArea["Input Area (v4.1)"]
   119â†’                    ChatInput["chat-input.tsx"]
   120â†’                    CmdTrigger["/ Trigger Detection"]
   121â†’                    CmdMenu["CommandPalette<br/>/divine /heal /grow"]
   122â†’                end
   123â†’            end
   124â†’
   125â†’            subgraph ZoneB["Zone B (38.2%)"]
   126â†’                DashPanel["dashboard-panel.tsx"]
   127â†’                TabBar["Tab åˆ‡æ¢"]
   128â†’                OverviewTab["overview-tab.tsx"]
   129â†’                StatusTab["status-tab.tsx"]
   130â†’                TrendsTab["trends-tab.tsx"]
   131â†’                QuestsTab["quests-tab.tsx"]
   132â†’            end
   133â†’        end
   134â†’
   135â†’        subgraph State["State Management"]
   136â†’            AppStore["Zustand<br/>app-store.ts"]
   137â†’            ApiClient["lib/api.ts<br/>+ csrfHeaders()"]
   138â†’        end
   139â†’    end
   140â†’
   141â†’    subgraph Backend["ğŸ”§ FastAPI (:8230)"]
   142â†’        API["/api/*"]
   143â†’        CmdRouter["Command Router<br/>(Skill Dispatch)"]
   144â†’    end
   145â†’
   146â†’    URL --> RootLayout
   147â†’    RootLayout --> NewLayout
   148â†’    NewLayout --> NewPage
   149â†’    NewLayout --> LoginPage
   150â†’    NewLayout --> RegisterPage
   151â†’
   152â†’    NewPage --> ChatPanel
   153â†’    NewPage --> DashPanel
   154â†’
   155â†’    ChatPanel --> MessageList
   156â†’    MessageList --> MessageItem
   157â†’    MessageItem --> BlockRenderer
   158â†’
   159â†’    ChatInput -->|"è¾“å…¥ /"| CmdTrigger
   160â†’    CmdTrigger -->|"æ˜¾ç¤ºèœå•"| CmdMenu
   161â†’    CmdMenu -->|"é€‰æ‹©æŒ‡ä»¤"| ChatInput
   162â†’
   163â†’    DashPanel --> TabBar
   164â†’    TabBar --> OverviewTab
   165â†’    TabBar --> StatusTab
   166â†’    TabBar --> TrendsTab
   167â†’    TabBar --> QuestsTab
   168â†’
   169â†’    ChatPanel --> AppStore
   170â†’    DashPanel --> AppStore
   171â†’    AppStore --> ApiClient
   172â†’    ApiClient -->|"fetch + X-CSRF-Token"| API
   173â†’    API -->|"/cmd è¯·æ±‚"| CmdRouter
   174â†’
   175â†’    style InputArea fill:#e3f2fd,stroke:#1976d2
   176â†’    style CmdMenu fill:#e3f2fd,stroke:#1976d2
   177â†’    style CmdRouter fill:#e3f2fd,stroke:#1976d2
   178â†’```
   179â†’
   180â†’<details>
   181â†’<summary>ğŸ“‹ ASCII ç‰ˆæœ¬ (ç‚¹å‡»å±•å¼€)</summary>
   182â†’
   183â†’```
   184â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   185â†’â”‚                             Next.js å‰ç«¯ç»„ä»¶æ¶æ„                                       â”‚
   186â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   187â†’
   188â†’                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   189â†’                          â”‚   Browser: /new         â”‚
   190â†’                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   191â†’                                      â”‚
   192â†’                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   193â†’                          â”‚     App Router          â”‚
   194â†’                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   195â†’                          â”‚  â”‚ layout.tsx       â”‚   â”‚
   196â†’                          â”‚  â”‚ (Providers)      â”‚   â”‚
   197â†’                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   198â†’                          â”‚           â”‚             â”‚
   199â†’                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   200â†’                          â”‚  â”‚ new/layout.tsx   â”‚   â”‚
   201â†’                          â”‚  â”‚ (åŒæ å®¹å™¨)       â”‚   â”‚
   202â†’                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   203â†’                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   204â†’                                      â”‚
   205â†’          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   206â†’          â”‚                                                       â”‚
   207â†’          â–¼                                                       â–¼
   208â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   209â†’â”‚   Zone A (61.8% é»„é‡‘åˆ†å‰²)        â”‚       â”‚   Zone B (38.2% é»„é‡‘åˆ†å‰²)            â”‚
   210â†’â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   211â†’â”‚ â”‚ chat-panel.tsx              â”‚ â”‚       â”‚ â”‚ dashboard-panel.tsx             â”‚ â”‚
   212â†’â”‚ â”‚ â”œâ”€ message-list.tsx         â”‚ â”‚       â”‚ â”‚ â”œâ”€ Tab åˆ‡æ¢æ                    â”‚ â”‚
   213â†’â”‚ â”‚ â”‚  â””â”€ message-item.tsx      â”‚ â”‚       â”‚ â”‚ â”‚  â”œâ”€ overview-tab.tsx         â”‚ â”‚
   214â†’â”‚ â”‚ â”‚     â””â”€ blocks/index.tsx   â”‚ â”‚       â”‚ â”‚ â”‚  â”œâ”€ status-tab.tsx           â”‚ â”‚
   215â†’â”‚ â”‚ â”‚        (A2UI æ¸²æŸ“)        â”‚ â”‚       â”‚ â”‚ â”‚  â”œâ”€ trends-tab.tsx           â”‚ â”‚
   216â†’â”‚ â”‚ â””â”€ chat-input.tsx           â”‚ â”‚       â”‚ â”‚ â”‚  â””â”€ quests-tab.tsx           â”‚ â”‚
   217â†’â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
   218â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   219â†’                 â”‚                                           â”‚
   220â†’                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   221â†’                                     â”‚
   222â†’                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   223â†’                          â”‚  State Management   â”‚
   224â†’                          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   225â†’                          â”‚ â”‚ Zustand        â”‚  â”‚
   226â†’                          â”‚ â”‚ app-store.ts   â”‚  â”‚
   227â†’                          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   228â†’                          â”‚         â”‚           â”‚
   229â†’                          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   230â†’                          â”‚ â”‚ lib/api.ts     â”‚  â”‚
   231â†’                          â”‚ â”‚ + csrfHeaders()â”‚  â”‚
   232â†’                          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   233â†’                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   234â†’                                    â”‚
   235â†’                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   236â†’                          â”‚ FastAPI (:8230)     â”‚
   237â†’                          â”‚ /api/*              â”‚
   238â†’                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   239â†’```
   240â†’</details>
   241â†’
   242â†’### 1.2 æŠ€æœ¯æ ˆ (v4.2 Vercel AI SDK Edition)
   243â†’
   244â†’| å±‚çº§ | æŠ€æœ¯ | çŠ¶æ€ | v4.2 å˜åŒ– |
   245â†’|------|------|:----:|-----------|
   246â†’| æ¡†æ¶ | Next.js 14 (App Router) + React 18 + TypeScript | âœ“ | - |
   247â†’| **AI Runtime** | **Vercel AI SDK 6 (`ai` package)** | âš ï¸ å¾…å¼•å…¥ | **NEW** |
   248â†’| **Chat Hook** | **`useChat()` from `ai/react`** | âš ï¸ å¾…é‡æ„ | **NEW** |
   249â†’| **Tool Calling** | **Zod Schema + `tool()` function** | âš ï¸ å¾…å®ç° | **NEW** |
   250â†’| æ ·å¼ | Tailwind CSS + shadcn/ui + Radix UI | âœ“ | - |
   251â†’| çŠ¶æ€ | Zustand (UI state) | âœ“ | - |
   252â†’| æ•°æ®è·å– | `useChat()` (Chat) + TanStack Query (Dashboard) | âš ï¸ å¾…è¿ç§» | `useChat` æ›¿ä»£æ‰‹åŠ¨ fetch |
   253â†’| å›¾è¡¨ | Recharts | âœ“ | - |
   254â†’| åŠ¨æ•ˆ | CSS transitions (Framer Motion å¯é€‰) | âœ“ | - |
   255â†’| è™šæ‹Ÿæ»šåŠ¨ | æœªå®ç° (å»ºè®® react-virtual) | â³ | - |
   256â†’
   257â†’**v4.2 æ–°å¢ä¾èµ–**:
   258â†’
   259â†’```json
   260â†’{
   261â†’  "dependencies": {
   262â†’    "ai": "^4.0.0",
   263â†’    "@ai-sdk/google": "^1.0.0",
   264â†’    "zod": "^3.22.0"
   265â†’  }
   266â†’}
   267â†’```
   268â†’
   269â†’### 1.2 å½“å‰å®ç°æ¶æ„æµç¨‹å›¾
   270â†’
   271â†’```
   272â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   273â†’â”‚                    å½“å‰å®ç°ï¼šNext.js App Router                             â”‚
   274â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   275â†’
   276â†’  web-app/src/
   277â†’  â”œâ”€â”€ app/
   278â†’  â”‚   â”œâ”€â”€ layout.tsx              â† Root Layout (providers)
   279â†’  â”‚   â”œâ”€â”€ page.tsx                â† / é‡å®šå‘åˆ° /new
   280â†’  â”‚   â”œâ”€â”€ new/
   281â†’  â”‚   â”‚   â”œâ”€â”€ layout.tsx          â† âœ… åŒæ å¸ƒå±€å®¹å™¨
   282â†’  â”‚   â”‚   â”œâ”€â”€ page.tsx            â† âœ… ä¸»ç•Œé¢
   283â†’  â”‚   â”‚   â”œâ”€â”€ login/page.tsx      â† âœ… ç™»å½•é¡µ
   284â†’  â”‚   â”‚   â””â”€â”€ register/page.tsx   â† âœ… æ³¨å†Œé¡µ
   285â†’  â”‚   â””â”€â”€ settings/page.tsx       â† âš ï¸ å¾…å®Œå–„
   286â†’  â”‚
   287â†’  â”œâ”€â”€ components/
   288â†’  â”‚   â”œâ”€â”€ chat/
   289â†’  â”‚   â”‚   â”œâ”€â”€ chat-panel.tsx      â† âœ… Zone A èŠå¤©é¢æ¿
   290â†’  â”‚   â”‚   â”œâ”€â”€ message-list.tsx    â† âœ… æ¶ˆæ¯åˆ—è¡¨
   291â†’  â”‚   â”‚   â”œâ”€â”€ message-item.tsx    â† âš ï¸ A2UI æ¸²æŸ“å¾…å®Œå–„
   292â†’  â”‚   â”‚   â””â”€â”€ chat-input.tsx      â† âœ… è¾“å…¥æ¡†
   293â†’  â”‚   â”‚
   294â†’  â”‚   â”œâ”€â”€ dashboard/
   295â†’  â”‚   â”‚   â”œâ”€â”€ dashboard-panel.tsx â† âœ… Zone B é¢æ¿
   296â†’  â”‚   â”‚   â””â”€â”€ tabs/
   297â†’  â”‚   â”‚       â”œâ”€â”€ overview-tab.tsx   â† âœ… æ¦‚è§ˆ
   298â†’  â”‚   â”‚       â”œâ”€â”€ status-tab.tsx     â† âœ… çŠ¶æ€
   299â†’  â”‚   â”‚       â”œâ”€â”€ trends-tab.tsx     â† âœ… è¶‹åŠ¿
   300â†’  â”‚   â”‚       â”œâ”€â”€ tasks-tab.tsx      â† âš ï¸ CSRF é—®é¢˜
   301â†’  â”‚   â”‚       â”œâ”€â”€ relations-tab.tsx  â† âœ… å…³ç³»
   302â†’  â”‚   â”‚       â””â”€â”€ explore-tab.tsx    â† âœ… æ¢ç´¢
   303â†’  â”‚   â”‚
   304â†’  â”‚   â””â”€â”€ ui/                     â† shadcn/ui ç»„ä»¶
   305â†’  â”‚
   306â†’  â””â”€â”€ lib/
   307â†’      â”œâ”€â”€ api.ts                  â† âš ï¸ CSRF å¤„ç†éœ€ä¿®å¤
   308â†’      â””â”€â”€ hooks/                  â† è‡ªå®šä¹‰ Hooks
   309â†’
   310â†’  å®ç°çŠ¶æ€:
   311â†’  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   312â†’  â”‚ âœ… Next.js 14 App Router                                              â”‚
   313â†’  â”‚ âœ… React 18 + TypeScript                                              â”‚
   314â†’  â”‚ âœ… Tailwind CSS + è‡ªå®šä¹‰ä¸»é¢˜                                          â”‚
   315â†’  â”‚ âš ï¸ shadcn/ui éƒ¨åˆ†ä½¿ç”¨                                                 â”‚
   316â†’  â”‚ âš ï¸ è™šæ‹Ÿæ»šåŠ¨æœªå®ç°                                                     â”‚
   317â†’  â”‚ âš ï¸ Framer Motion æœªå¼•å…¥                                               â”‚
   318â†’  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   319â†’```
   320â†’
   321â†’### 1.3 æœ€ä¼˜æ¶æ„æµç¨‹å›¾ï¼ˆç»¼åˆåˆ†æå»ºè®®ï¼‰
   322â†’
   323â†’```
   324â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   325â†’â”‚                    æœ€ä¼˜æ–¹æ¡ˆï¼šå®Œå–„çš„åŒæ ¸å“åº”å¼æ¶æ„                            â”‚
   326â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   327â†’
   328â†’  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   329â†’  â”‚                           /new (ä¸»ç•Œé¢)                                  â”‚
   330â†’  â”‚                                                                         â”‚
   331â†’  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   332â†’  â”‚  â”‚                    é¡¶éƒ¨å¯¼èˆªæ  (å¯é€‰æ˜¾ç¤º)                            â”‚  â”‚
   333â†’  â”‚  â”‚  Fortune AI    [ä¼šè¯åˆ‡æ¢â–¾]    [è®¾ç½®] [ç”¨æˆ·â–¾]                       â”‚  â”‚
   334â†’  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   335â†’  â”‚                                                                         â”‚
   336â†’  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   337â†’  â”‚  â”‚      Zone A (å¯è°ƒ)        â”‚Râ”‚       Zone B (å¯è°ƒ)                  â”‚  â”‚
   338â†’  â”‚  â”‚                           â”‚eâ”‚                                     â”‚  â”‚
   339â†’  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚sâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
   340â†’  â”‚  â”‚  â”‚    å¿«æ·æŒ‰é’®æ         â”‚ â”‚iâ”‚  â”‚  [æ¦‚è§ˆ][çŠ¶æ€][è¶‹åŠ¿][ä»»åŠ¡]...    â”‚ â”‚  â”‚
   341â†’  â”‚  â”‚  â”‚ [çŠ¶æ€] [æ‰“å¡] [ä»»åŠ¡] â”‚ â”‚zâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
   342â†’  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚eâ”‚                                     â”‚  â”‚
   343â†’  â”‚  â”‚                           â”‚râ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
   344â†’  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚                                 â”‚ â”‚  â”‚
   345â†’  â”‚  â”‚  â”‚   æ¶ˆæ¯æµ (è™šæ‹Ÿæ»šåŠ¨)  â”‚ â”‚åŒâ”‚  â”‚       Tab å†…å®¹åŒº               â”‚ â”‚  â”‚
   346â†’  â”‚  â”‚  â”‚                      â”‚ â”‚å‡»â”‚  â”‚                                 â”‚ â”‚  â”‚
   347â†’  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚æ¢â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚  â”‚
   348â†’  â”‚  â”‚  â”‚  â”‚ ç”¨æˆ·æ¶ˆæ¯       â”‚ â”‚ â”‚å¤â”‚  â”‚  â”‚ å¡ç‰‡/å›¾è¡¨/åˆ—è¡¨ç»„ä»¶      â”‚   â”‚ â”‚  â”‚
   349â†’  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚é»˜â”‚  â”‚  â”‚                         â”‚   â”‚ â”‚  â”‚
   350â†’  â”‚  â”‚  â”‚                      â”‚ â”‚è®¤â”‚  â”‚  â”‚ â€¢ éª¨æ¶å±åŠ è½½            â”‚   â”‚ â”‚  â”‚
   351â†’  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚  â”‚  â”‚ â€¢ ä¹è§‚UIæ›´æ–°            â”‚   â”‚ â”‚  â”‚
   352â†’  â”‚  â”‚  â”‚  â”‚ AI å›å¤        â”‚ â”‚ â”‚ â”‚  â”‚  â”‚ â€¢ é”™è¯¯è¾¹ç•Œå¤„ç†          â”‚   â”‚ â”‚  â”‚
   353â†’  â”‚  â”‚  â”‚  â”‚ â”œâ”€ markdown    â”‚ â”‚ â”‚ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚  â”‚
   354â†’  â”‚  â”‚  â”‚  â”‚ â”œâ”€ If-Thenå¤„æ–¹ â”‚ â”‚ â”‚ â”‚  â”‚                                 â”‚ â”‚  â”‚
   355â†’  â”‚  â”‚  â”‚  â”‚ â””â”€ è¡ŒåŠ¨æŒ‰é’® â†â”€â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€ ç‚¹å‡» â†’ API â†’ åˆ·æ–°Tab      â”‚ â”‚  â”‚
   356â†’  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚  â”‚                                 â”‚ â”‚  â”‚
   357â†’  â”‚  â”‚  â”‚                      â”‚ â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
   358â†’  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚                                     â”‚  â”‚
   359â†’  â”‚  â”‚                           â”‚ â”‚                                     â”‚  â”‚
   360â†’  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚                                     â”‚  â”‚
   361â†’  â”‚  â”‚  â”‚     Omnibar          â”‚ â”‚ â”‚                                     â”‚  â”‚
   362â†’  â”‚  â”‚  â”‚ [+] è¾“å…¥æ¶ˆæ¯... [â¤] â”‚ â”‚ â”‚                                     â”‚  â”‚
   363â†’  â”‚  â”‚  â”‚ /help /checkin       â”‚ â”‚ â”‚                                     â”‚  â”‚
   364â†’  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚                                     â”‚  â”‚
   365â†’  â”‚  â”‚                           â”‚ â”‚                                     â”‚  â”‚
   366â†’  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   367â†’  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   368â†’
   369â†’  ç§»åŠ¨ç«¯é€‚é…:
   370â†’  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   371â†’  â”‚ < 768px: åº•éƒ¨ Tab åˆ‡æ¢ (Chat | Dashboard)                             â”‚
   372â†’  â”‚ â€¢ Chat å…¨å±æ¨¡å¼                                                       â”‚
   373â†’  â”‚ â€¢ Dashboard å…¨å±æ¨¡å¼                                                  â”‚
   374â†’  â”‚ â€¢ æ‰‹åŠ¿æ”¯æŒ (å·¦å³æ»‘åŠ¨åˆ‡æ¢)                                              â”‚
   375â†’  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   376â†’
   377â†’  å…³é”®ä¼˜åŒ–:
   378â†’  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   379â†’  â”‚ [P0] CSRF ç»Ÿä¸€å¤„ç†                                                    â”‚
   380â†’  â”‚      - åˆ›å»º api-client.ts å°è£…æ‰€æœ‰è¯·æ±‚                                â”‚
   381â†’  â”‚      - è‡ªåŠ¨ä» cookie è¯»å– fortune_csrf                                â”‚
   382â†’  â”‚      - æ¯æ¬¡ POST/PUT/DELETE è‡ªåŠ¨é™„åŠ  X-CSRF-Token                     â”‚
   383â†’  â”‚                                                                       â”‚
   384â†’  â”‚ [P0] action_buttons å®Œæ•´æ¸²æŸ“                                          â”‚
   385â†’  â”‚      - è§£æ A2UI action ç»“æ„                                          â”‚
   386â†’  â”‚      - å®ç° start_task / schedule_task / open_panel å¤„ç†              â”‚
   387â†’  â”‚      - æˆåŠŸååˆ·æ–°å¯¹åº” Tab                                              â”‚
   388â†’  â”‚                                                                       â”‚
   389â†’  â”‚ [P1] è™šæ‹Ÿæ»šåŠ¨                                                         â”‚
   390â†’  â”‚      - ä½¿ç”¨ @tanstack/react-virtual                                   â”‚
   391â†’  â”‚      - æ¶ˆæ¯åˆ—è¡¨ä¼˜åŒ– (100+ æ¶ˆæ¯æ— å¡é¡¿)                                  â”‚
   392â†’  â”‚                                                                       â”‚
   393â†’  â”‚ [P2] éª¨æ¶å±å®Œå–„                                                       â”‚
   394â†’  â”‚      - æ¯ä¸ª Tab ç‹¬ç«‹éª¨æ¶å±                                             â”‚
   395â†’  â”‚      - Shimmer åŠ¨æ•ˆ                                                   â”‚
   396â†’  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   397â†’```
   398â†’
   399â†’---
   400â†’
   401â†’## 2. æ•°æ®æµ (Mermaid æ—¶åºå›¾)
   402â†’
   403â†’> **å‘½åè§„èŒƒ**: å‚è§ [GLOSSARY.md](../GLOSSARY.md) Â§4 A2UI ç»„ä»¶ç±»å‹
   404â†’
   405â†’### 2.1 Chat å‘é€æ—¶åºå›¾ (è®¾è®¡ç›®æ ‡)
   406â†’
   407â†’```mermaid
   408â†’sequenceDiagram
   409â†’    autonumber
   410â†’    participant User as ç”¨æˆ·
   411â†’    participant ZoneA as Zone A<br/>(ChatPanel)
   412â†’    participant API as FastAPI<br/>(:8230)
   413â†’    participant DB as PostgreSQL
   414â†’    participant ZoneB as Zone B<br/>(Dashboard)
   415â†’
   416â†’    User->>ZoneA: è¾“å…¥æ¶ˆæ¯
   417â†’    ZoneA->>ZoneA: æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
   418â†’    ZoneA->>API: POST /api/chat/send<br/>+ X-CSRF-Token
   419â†’    API->>DB: INSERT conversation_message
   420â†’    API->>API: Context Driven å¤„ç†<br/>(L0â†’L1â†’L2â†’Interaction)
   421â†’    API-->>ZoneA: A2UI å“åº”<br/>{blocks: [...], suggested_tasks: [...]}
   422â†’
   423â†’    ZoneA->>ZoneA: æ¸²æŸ“ markdown_text
   424â†’    ZoneA->>ZoneA: æ¸²æŸ“ action_buttons
   425â†’
   426â†’    Note over ZoneA,ZoneB: suggested_tasks è§¦å‘ Zone B åˆ·æ–°
   427â†’    ZoneA->>ZoneB: store.notify('tasks_updated')
   428â†’    ZoneB->>API: GET /api/dashboard/tasks
   429â†’    API-->>ZoneB: ä»»åŠ¡åˆ—è¡¨ (å« suggested çŠ¶æ€)
   430â†’```
   431â†’
   432â†’<details>
   433â†’<summary>ğŸ“‹ ASCII ç‰ˆæœ¬ (ç‚¹å‡»å±•å¼€)</summary>
   434â†’
   435â†’```
   436â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   437â†’â”‚                         Chat å‘é€æ—¶åºå›¾                                     â”‚
   438â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   439â†’
   440â†’   ç”¨æˆ·         Zone A           API          DB          Zone B
   441â†’    â”‚          (ChatPanel)     (FastAPI)   (PostgreSQL)  (Dashboard)
   442â†’    â”‚              â”‚              â”‚             â”‚             â”‚
   443â†’    â”‚â”€â”€[1]è¾“å…¥â”€â”€â”€â”€â–¶â”‚              â”‚             â”‚             â”‚
   444â†’    â”‚              â”‚              â”‚             â”‚             â”‚
   445â†’    â”‚              â”‚â”€â”€æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯â”‚             â”‚             â”‚
   446â†’    â”‚              â”‚              â”‚             â”‚             â”‚
   447â†’    â”‚              â”‚â”€â”€[2]POST /api/chat/sendâ”€â”€â–¶â”‚             â”‚
   448â†’    â”‚              â”‚   + X-CSRF-Token         â”‚             â”‚
   449â†’    â”‚              â”‚              â”‚             â”‚             â”‚
   450â†’    â”‚              â”‚              â”‚â”€â”€INSERT conversation_msgâ–¶â”‚
   451â†’    â”‚              â”‚              â”‚             â”‚             â”‚
   452â†’    â”‚              â”‚              â”‚â”€â”€Context Drivenâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   453â†’    â”‚              â”‚              â”‚             â”‚             â”‚
   454â†’    â”‚              â”‚â—€â”€â”€[3]A2UI å“åº”â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
   455â†’    â”‚              â”‚   {blocks, suggested_tasks}            â”‚
   456â†’    â”‚              â”‚              â”‚             â”‚             â”‚
   457â†’    â”‚              â”‚â”€â”€[4]æ¸²æŸ“ markdown_text    â”‚             â”‚
   458â†’    â”‚              â”‚â”€â”€[5]æ¸²æŸ“ action_buttons   â”‚             â”‚
   459â†’    â”‚              â”‚              â”‚             â”‚             â”‚
   460â†’    â”‚              â”‚         suggested_tasks è§¦å‘åˆ·æ–°        â”‚
   461â†’    â”‚              â”‚              â”‚             â”‚             â”‚
   462â†’    â”‚              â”‚â”€â”€[6]store.notify('tasks_updated')â”€â”€â”€â”€â”€â”€â–¶â”‚
   463â†’    â”‚              â”‚              â”‚             â”‚             â”‚
   464â†’    â”‚              â”‚              â”‚             â”‚â—€â”€â”€GET /api/dashboard/tasks
   465â†’    â”‚              â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
   466â†’    â”‚              â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€ä»»åŠ¡åˆ—è¡¨â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   467â†’    â”‚              â”‚              â”‚             â”‚             â”‚
   468â†’```
   469â†’</details>
   470â†’
   471â†’### 2.2 action_button ç‚¹å‡»æ—¶åºå›¾ (å…³é”®æµç¨‹)
   472â†’
   473â†’```mermaid
   474â†’sequenceDiagram
   475â†’    autonumber
   476â†’    participant User as ç”¨æˆ·
   477â†’    participant Btn as ActionButton
   478â†’    participant Client as api-client.ts
   479â†’    participant API as FastAPI
   480â†’    participant DB as PostgreSQL
   481â†’    participant Store as Zustand Store
   482â†’    participant ZoneB as Zone B Tab
   483â†’    participant Toast as Toast UI
   484â†’
   485â†’    User->>Btn: ç‚¹å‡» "ç«‹å³æ‰§è¡Œ"
   486â†’    Btn->>Btn: action.type = 'start_task'
   487â†’
   488â†’    Btn->>Client: handleAction(action)
   489â†’    Client->>Client: getCSRFToken()<br/>from cookie
   490â†’    Client->>API: POST /api/dashboard/task/accept<br/>+ X-CSRF-Token
   491â†’
   492â†’    alt æˆåŠŸ (200)
   493â†’        API->>DB: UPDATE commitment SET status='active'
   494â†’        API-->>Client: {ok: true, commitment_id}
   495â†’        Client->>Store: taskStore.invalidate()
   496â†’        Store->>ZoneB: è§¦å‘ re-fetch
   497â†’        ZoneB->>API: GET /api/dashboard/tasks
   498â†’        API-->>ZoneB: æ›´æ–°åçš„ä»»åŠ¡åˆ—è¡¨
   499â†’        Client->>Toast: toast.success("ä»»åŠ¡å·²å¼€å§‹")
   500â†’    else å¤±è´¥ (4xx/5xx)
   501â†’        API-->>Client: {error: "..."}
   502â†’        Client->>Toast: toast.error("æ“ä½œå¤±è´¥")
   503â†’        Client->>Btn: æ¢å¤æŒ‰é’®çŠ¶æ€
   504â†’    end
   505â†’```
   506â†’
   507â†’<details>
   508â†’<summary>ğŸ“‹ ASCII ç‰ˆæœ¬ (ç‚¹å‡»å±•å¼€)</summary>
   509â†’
   510â†’```
   511â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   512â†’â”‚                    action_button ç‚¹å‡»æ—¶åºå›¾                                 â”‚
   513â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   514â†’
   515â†’  ç”¨æˆ·    ActionButton   api-client.ts   FastAPI      DB       Store    Zone B   Toast
   516â†’   â”‚          â”‚              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   517â†’   â”‚â”€â”€ç‚¹å‡»â”€â”€â–¶ â”‚              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   518â†’   â”‚  "ç«‹å³æ‰§è¡Œ"              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   519â†’   â”‚          â”‚              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   520â†’   â”‚          â”‚â”€â”€action.type='start_task'  â”‚          â”‚          â”‚        â”‚        â”‚
   521â†’   â”‚          â”‚              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   522â†’   â”‚          â”‚â”€â”€handleAction(action)â”€â”€â”€â”€â”€â–¶â”‚          â”‚          â”‚        â”‚        â”‚
   523â†’   â”‚          â”‚              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   524â†’   â”‚          â”‚              â”‚â”€â”€getCSRFToken()        â”‚          â”‚        â”‚        â”‚
   525â†’   â”‚          â”‚              â”‚  (from cookie)         â”‚          â”‚        â”‚        â”‚
   526â†’   â”‚          â”‚              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   527â†’   â”‚          â”‚              â”‚â”€â”€POST /api/dashboard/task/acceptâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚        â”‚
   528â†’   â”‚          â”‚              â”‚   + X-CSRF-Token       â”‚          â”‚        â”‚        â”‚
   529â†’   â”‚          â”‚              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   530â†’   â”‚          â”‚              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   531â†’   â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•â•
   532â†’   â”‚          â”‚              â”‚  æˆåŠŸ (200) â”‚          â”‚          â”‚        â”‚        â”‚
   533â†’   â”‚          â”‚              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   534â†’   â”‚          â”‚              â”‚             â”‚â”€â”€UPDATE commitmentâ”€â–¶â”‚        â”‚        â”‚
   535â†’   â”‚          â”‚              â”‚â—€â”€{ok, commitment_id}â”€â”€â”€â”‚          â”‚        â”‚        â”‚
   536â†’   â”‚          â”‚              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   537â†’   â”‚          â”‚              â”‚â”€â”€taskStore.invalidate()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚        â”‚        â”‚
   538â†’   â”‚          â”‚              â”‚             â”‚          â”‚          â”‚â”€â”€re-fetchâ”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   539â†’   â”‚          â”‚              â”‚             â”‚          â”‚â—€â”€GET /api/dashboard/tasksâ”€â”€â”‚
   540â†’   â”‚          â”‚              â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€æ›´æ–°åˆ—è¡¨â”€â”€â”€â”€â”€â”€â–¶â”‚
   541â†’   â”‚          â”‚              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   542â†’   â”‚          â”‚              â”‚â”€â”€toast.success("ä»»åŠ¡å·²å¼€å§‹")â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   543â†’   â”‚          â”‚              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   544â†’   â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•â•
   545â†’   â”‚          â”‚              â”‚  å¤±è´¥ (4xx) â”‚          â”‚          â”‚        â”‚        â”‚
   546â†’   â”‚          â”‚              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   547â†’   â”‚          â”‚              â”‚â—€â”€{error}â”€â”€â”€â”€â”‚          â”‚          â”‚        â”‚        â”‚
   548â†’   â”‚          â”‚              â”‚â”€â”€toast.error("æ“ä½œå¤±è´¥")â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   549â†’   â”‚          â”‚â—€â”€æ¢å¤æŒ‰é’®çŠ¶æ€â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   550â†’   â”‚          â”‚              â”‚             â”‚          â”‚          â”‚        â”‚        â”‚
   551â†’```
   552â†’</details>
   553â†’
   554â†’### 2.3 action.type æ˜ å°„è¡¨
   555â†’
   556â†’| action.type | è°ƒç”¨ç«¯ç‚¹ | æˆåŠŸè¡Œä¸º | å¤±è´¥è¡Œä¸º |
   557â†’|-------------|----------|----------|----------|
   558â†’| `start_task` | `POST /api/dashboard/task/accept` | invalidate tasks â†’ refetch â†’ toast âœ“ | toast.error + æ¢å¤æŒ‰é’® |
   559â†’| `schedule_task` | `POST /api/dashboard/task/accept` | åŒä¸Š | åŒä¸Š |
   560â†’| `open_panel` | æ—  API è°ƒç”¨ | `uiStore.setActiveTab(panel)` | N/A |
   561â†’| `opt_out` | å‰ç«¯è®°å½• | æœ¬åœ°å­˜å‚¨ + å…³é—­æŒ‰é’® | N/A |
   562â†’| `checkin` | å‰ç«¯äº‹ä»¶ | æ‰“å¼€æ‰“å¡ Modal | N/A |
   563â†’
   564â†’### 2.4 å½“å‰å®ç°é—®é¢˜
   565â†’
   566â†’```mermaid
   567â†’sequenceDiagram
   568â†’    autonumber
   569â†’    participant User as ç”¨æˆ·
   570â†’    participant Btn as ActionButton
   571â†’    participant Client as lib/api.ts
   572â†’    participant API as FastAPI
   573â†’
   574â†’    User->>Btn: ç‚¹å‡»æŒ‰é’®
   575â†’    Btn->>Client: POST request
   576â†’
   577â†’    Note right of Client: âš ï¸ é—®é¢˜1: ç¼ºå°‘ X-CSRF-Token
   578â†’    Client->>API: POST /api/dashboard/task/accept
   579â†’    API-->>Client: 403 csrf_invalid
   580â†’
   581â†’    Note right of Btn: âš ï¸ é—®é¢˜2: æ— é”™è¯¯å¤„ç†
   582â†’    Note right of Btn: âš ï¸ é—®é¢˜3: Zone B ä¸åˆ·æ–°
   583â†’```
   584â†’
   585â†’<details>
   586â†’<summary>ğŸ“‹ ASCII ç‰ˆæœ¬ (ç‚¹å‡»å±•å¼€)</summary>
   587â†’
   588â†’```
   589â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   590â†’â”‚                      å½“å‰å®ç°é—®é¢˜ (å¾…ä¿®å¤)                                    â”‚
   591â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   592â†’
   593â†’  ç”¨æˆ·         ActionButton        lib/api.ts         FastAPI
   594â†’   â”‚               â”‚                   â”‚                 â”‚
   595â†’   â”‚â”€â”€ç‚¹å‡»æŒ‰é’®â”€â”€â”€â”€â–¶â”‚                   â”‚                 â”‚
   596â†’   â”‚               â”‚                   â”‚                 â”‚
   597â†’   â”‚               â”‚â”€â”€POST requestâ”€â”€â”€â”€â–¶â”‚                 â”‚
   598â†’   â”‚               â”‚                   â”‚                 â”‚
   599â†’   â”‚               â”‚                   â”‚  âš ï¸ é—®é¢˜1:      â”‚
   600â†’   â”‚               â”‚                   â”‚  ç¼ºå°‘ X-CSRF-Token
   601â†’   â”‚               â”‚                   â”‚                 â”‚
   602â†’   â”‚               â”‚                   â”‚â”€â”€POST /api/dashboard/task/accept
   603â†’   â”‚               â”‚                   â”‚   (æ—  CSRF Header)
   604â†’   â”‚               â”‚                   â”‚                 â”‚
   605â†’   â”‚               â”‚                   â”‚â—€â”€â”€â”€â”€403 csrf_invalid
   606â†’   â”‚               â”‚                   â”‚                 â”‚
   607â†’   â”‚               â”‚                   â”‚  âš ï¸ é—®é¢˜2:      â”‚
   608â†’   â”‚               â”‚  âš ï¸ æ— é”™è¯¯å¤„ç†    â”‚  æ—  toast æç¤º  â”‚
   609â†’   â”‚               â”‚                   â”‚                 â”‚
   610â†’   â”‚               â”‚  âš ï¸ é—®é¢˜3:        â”‚                 â”‚
   611â†’   â”‚               â”‚  Zone B ä¸åˆ·æ–°    â”‚                 â”‚
   612â†’   â”‚               â”‚  (ä»»åŠ¡çŠ¶æ€ä¸æ›´æ–°) â”‚                 â”‚
   613â†’   â”‚               â”‚                   â”‚                 â”‚
   614â†’   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   615â†’
   616â†’  ä¿®å¤æ–¹æ¡ˆ:
   617â†’  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   618â†’  â”‚ 1. lib/api.ts æ·»åŠ  csrfHeaders() ç»Ÿä¸€å¤„ç†                               â”‚
   619â†’  â”‚ 2. æ‰€æœ‰ POST è¯·æ±‚é™„åŠ  X-CSRF-Token header                               â”‚
   620â†’  â”‚ 3. blocks/index.tsx æˆåŠŸåè°ƒç”¨ invalidateQueries('tasks')              â”‚
   621â†’  â”‚ 4. æ·»åŠ  toast æˆåŠŸ/å¤±è´¥æç¤º                                             â”‚
   622â†’  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   623â†’```
   624â†’</details>
   625â†’
   626â†’**é—®é¢˜æ¸…å•**:
   627â†’| é—®é¢˜ | ä½ç½® | å½±å“ | ä¿®å¤ä¼˜å…ˆçº§ |
   628â†’|------|------|------|-----------|
   629â†’| CSRF token æœªé™„åŠ  | `lib/api.ts` | æ‰€æœ‰ POST å¤±è´¥ | P0 |
   630â†’| æ—  store é€šçŸ¥æœºåˆ¶ | å…¨å±€ | Zone B éœ€æ‰‹åŠ¨åˆ·æ–° | P1 |
   631â†’| æ— é”™è¯¯ toast | `blocks/index.tsx` | ç”¨æˆ·æ— åé¦ˆ | P1 |
   632â†’
   633â†’### 2.5 Zustand Store ç»“æ„ (å»ºè®®)
   634â†’
   635â†’```
   636â†’store/
   637â†’â”œâ”€â”€ chat-store.ts      â† æ¶ˆæ¯/ä¼šè¯çŠ¶æ€
   638â†’â”œâ”€â”€ task-store.ts      â† ä»»åŠ¡çŠ¶æ€ + invalidate()
   639â†’â”œâ”€â”€ status-store.ts    â† PERMA/çŠ¶æ€æ•°æ®
   640â†’â””â”€â”€ ui-store.ts        â† activeTab / modals
   641â†’```
   642â†’
   643â†’**å…³é”® API Client å®ç°**:
   644â†’
   645â†’```typescript
   646â†’// lib/api-client.ts
   647â†’export const apiClient = {
   648â†’  getCSRFToken(): string {
   649â†’    return getCookie('fortune_csrf') || '';
   650â†’  },
   651â†’
   652â†’  async post<T>(url: string, data: unknown): Promise<T> {
   653â†’    const res = await fetch(url, {
   654â†’      method: 'POST',
   655â†’      headers: {
   656â†’        'Content-Type': 'application/json',
   657â†’        'X-CSRF-Token': this.getCSRFToken(),  // â† å…³é”®
   658â†’      },
   659â†’      credentials: 'include',
   660â†’      body: JSON.stringify(data),
   661â†’    });
   662â†’    if (!res.ok) throw new ApiError(res.status, await res.json());
   663â†’    return res.json();
   664â†’  }
   665â†’};
   666â†’```
   667â†’
   668â†’### 2.6 Chat æµå¼äº¤äº’æµç¨‹ (v4.2 Vercel AI SDK)
   669â†’
   670â†’> **ç›®æ ‡**: ä½¿ç”¨ `useChat()` Hook å®ç°ç±»ä¼¼ Claude Artifacts çš„æµå¼ Tool Calling ä½“éªŒ
   671â†’> **åç«¯æ¶æ„**: å‚è§ [os_design_v3.md Â§1.5](./os_design_v3.md#15-agent-runtime--skills-vercel-ai-sdk-implementation---v42)
   672â†’
   673â†’#### 2.6.1 Command Palette ç»„ä»¶è®¾è®¡
   674â†’
   675â†’```mermaid
   676â†’graph TB
   677â†’    subgraph ZoneA["Zone A (Chat Panel)"]
   678â†’        MessageList["MessageList"]
   679â†’
   680â†’        subgraph InputArea["Input Area"]
   681â†’            ChatInput["chat-input.tsx"]
   682â†’            CmdTrigger["/ Trigger Detection"]
   683â†’            CmdMenu["Command Palette (Popover)<br/>â€¢ /divine (ç„å­¦æµ‹ç®—)<br/>â€¢ /heal (å¿ƒç†ç–—æ„ˆ)<br/>â€¢ /grow (æˆé•¿æ•™ç»ƒ)<br/>â€¢ /status (çŠ¶æ€æŸ¥çœ‹)<br/>â€¢ /help (å¸®åŠ©)"]
   684â†’        end
   685â†’    end
   686â†’
   687â†’    ChatInput -->|"è¾“å…¥ /"| CmdTrigger
   688â†’    CmdTrigger -->|"æ˜¾ç¤ºèœå•"| CmdMenu
   689â†’    CmdMenu -->|"é€‰æ‹©æŒ‡ä»¤"| ChatInput
   690â†’
   691â†’    style CmdMenu fill:#e3f2fd,stroke:#1976d2
   692â†’```
   693â†’
   694â†’<details>
   695â†’<summary>ğŸ“‹ ASCII ç‰ˆæœ¬ (ç‚¹å‡»å±•å¼€)</summary>
   696â†’
   697â†’```
   698â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   699â†’â”‚  Zone A (Chat Panel)                                             â”‚
   700â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   701â†’â”‚                                                                  â”‚
   702â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   703â†’â”‚  â”‚  Message List                                              â”‚  â”‚
   704â†’â”‚  â”‚  ...                                                       â”‚  â”‚
   705â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   706â†’â”‚                                                                  â”‚
   707â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   708â†’â”‚  â”‚  Input Area                                                â”‚  â”‚
   709â†’â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
   710â†’â”‚  â”‚  â”‚  [+] / è¾“å…¥æ¶ˆæ¯æˆ–æŒ‡ä»¤...                    [â¤]    â”‚  â”‚  â”‚
   711â†’â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
   712â†’â”‚  â”‚                      â†‘                                     â”‚  â”‚
   713â†’â”‚  â”‚                      â”‚ è¾“å…¥ "/" è§¦å‘                       â”‚  â”‚
   714â†’â”‚  â”‚                      â–¼                                     â”‚  â”‚
   715â†’â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
   716â†’â”‚  â”‚  â”‚  Command Palette (æ‚¬æµ®èœå•)                          â”‚  â”‚  â”‚
   717â†’â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚  â”‚
   718â†’â”‚  â”‚  â”‚  â”‚ ğŸ”® /divine  ç„å­¦æµ‹ç®— - å…«å­—/ç´«å¾®/æ˜Ÿåº§       â”‚    â”‚  â”‚  â”‚
   719â†’â”‚  â”‚  â”‚  â”‚ ğŸ’š /heal    å¿ƒç†ç–—æ„ˆ - æƒ…ç»ªæ‰“å¡/CBTé‡æ„     â”‚    â”‚  â”‚  â”‚
   720â†’â”‚  â”‚  â”‚  â”‚ ğŸŒ± /grow    æˆé•¿æ•™ç»ƒ - ç›®æ ‡/ä»»åŠ¡/å¤ç›˜       â”‚    â”‚  â”‚  â”‚
   721â†’â”‚  â”‚  â”‚  â”‚ ğŸ“Š /status  çŠ¶æ€æŸ¥çœ‹ - å½“å‰çŠ¶æ€/è¶‹åŠ¿        â”‚    â”‚  â”‚  â”‚
   722â†’â”‚  â”‚  â”‚  â”‚ â“ /help    å¸®åŠ©åˆ—è¡¨ - æ‰€æœ‰å¯ç”¨æŒ‡ä»¤         â”‚    â”‚  â”‚  â”‚
   723â†’â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚  â”‚
   724â†’â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
   725â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   726â†’â”‚                                                                  â”‚
   727â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   728â†’```
   729â†’</details>
   730â†’
   731â†’#### 2.6.2 Command äº¤äº’æ—¶åºå›¾
   732â†’
   733â†’```mermaid
   734â†’sequenceDiagram
   735â†’    autonumber
   736â†’    participant U as ç”¨æˆ·
   737â†’    participant FE as å‰ç«¯ (CommandPalette)
   738â†’    participant API as FastAPI
   739â†’    participant Router as Command Router
   740â†’    participant Agent as L2 Agent
   741â†’
   742â†’    U->>FE: è¾“å…¥ "/"
   743â†’    FE->>FE: å¼¹å‡º Command Menu<br/>(åˆ—å‡ºå¯ç”¨ Skills)
   744â†’    U->>FE: é€‰æ‹© "/divine" (ç„å­¦æµ‹ç®—)
   745â†’    FE->>U: æç¤ºè¾“å…¥: "/divine [type]"
   746â†’    U->>FE: è¡¥å…¨å¹¶å‘é€: "/divine type=bazi"
   747â†’
   748â†’    FE->>API: POST /api/chat/command<br/>{cmd: "divine", args: {type: "bazi"}}
   749â†’
   750â†’    API->>Router: è§£æ Command
   751â†’    Note over Router: å¼ºåˆ¶è·¯ç”±æ¨¡å¼ (Bypass Intent)
   752â†’
   753â†’    Router->>Agent: Invoke Metaphysics Agent<br/>With Skill: "calculate_bazi"
   754â†’
   755â†’    Agent->>Agent: æ‰§è¡Œ Skill (è¯»å– L1)
   756â†’    Agent-->>API: è¿”å›ç»“æœ (JSON + Analysis)
   757â†’
   758â†’    API-->>FE: A2UI å“åº”<br/>(åŒ…å«ç‰¹å®šçš„ Widget ç»„ä»¶)
   759â†’    FE->>FE: æ¸²æŸ“ç»“æœå¡ç‰‡
   760â†’```
   761â†’
   762â†’<details>
   763â†’<summary>ğŸ“‹ ASCII ç‰ˆæœ¬ (ç‚¹å‡»å±•å¼€)</summary>
   764â†’
   765â†’```
   766â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   767â†’â”‚                         Slash Command äº¤äº’æ—¶åº                                   â”‚
   768â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   769â†’
   770â†’  ç”¨æˆ·        å‰ç«¯ (CommandPalette)       FastAPI       Command Router     L2 Agent
   771â†’   â”‚                â”‚                       â”‚                â”‚               â”‚
   772â†’   â”‚â”€â”€[1]è¾“å…¥ "/"â”€â”€â–¶â”‚                       â”‚                â”‚               â”‚
   773â†’   â”‚                â”‚                       â”‚                â”‚               â”‚
   774â†’   â”‚                â”‚â”€â”€å¼¹å‡º Command Menu    â”‚                â”‚               â”‚
   775â†’   â”‚                â”‚  (åˆ—å‡ºå¯ç”¨ Skills)    â”‚                â”‚               â”‚
   776â†’   â”‚                â”‚                       â”‚                â”‚               â”‚
   777â†’   â”‚â”€â”€[2]é€‰æ‹© /divineâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚               â”‚
   778â†’   â”‚                â”‚                       â”‚                â”‚               â”‚
   779â†’   â”‚â—€â”€â”€æç¤º: "/divine [type]"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚               â”‚
   780â†’   â”‚                â”‚                       â”‚                â”‚               â”‚
   781â†’   â”‚â”€â”€[3]å‘é€: "/divine type=bazi"â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚               â”‚
   782â†’   â”‚                â”‚                       â”‚                â”‚               â”‚
   783â†’   â”‚                â”‚â”€â”€POST /api/chat/commandâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚
   784â†’   â”‚                â”‚   {cmd: "divine", args: {type: "bazi"}}                â”‚
   785â†’   â”‚                â”‚                       â”‚                â”‚               â”‚
   786â†’   â”‚                â”‚                       â”‚â”€â”€è§£æ Commandâ”€â–¶â”‚               â”‚
   787â†’   â”‚                â”‚                       â”‚                â”‚               â”‚
   788â†’   â”‚                â”‚                       â”‚   å¼ºåˆ¶è·¯ç”±æ¨¡å¼ (Bypass Intent) â”‚
   789â†’   â”‚                â”‚                       â”‚                â”‚               â”‚
   790â†’   â”‚                â”‚                       â”‚                â”‚â”€â”€Invoke Agentâ”€â–¶â”‚
   791â†’   â”‚                â”‚                       â”‚                â”‚  Skill: calculate_bazi
   792â†’   â”‚                â”‚                       â”‚                â”‚               â”‚
   793â†’   â”‚                â”‚                       â”‚                â”‚â—€â”€â”€æ‰§è¡Œç»“æœâ”€â”€â”€â”€â”‚
   794â†’   â”‚                â”‚                       â”‚â—€â”€â”€è¿”å› A2UIâ”€â”€â”€â”€â”‚               â”‚
   795â†’   â”‚                â”‚â—€â”€â”€A2UI å“åº”â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚               â”‚
   796â†’   â”‚                â”‚                       â”‚                â”‚               â”‚
   797â†’   â”‚                â”‚â”€â”€æ¸²æŸ“ç»“æœå¡ç‰‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚               â”‚
   798â†’   â”‚â—€â”€â”€æ˜¾ç¤ºç»“æœâ”€â”€â”€â”€â”‚                       â”‚                â”‚               â”‚
   799â†’   â”‚                â”‚                       â”‚                â”‚               â”‚
   800â†’```
   801â†’</details>
   802â†’
   803â†’#### 2.6.3 Command ç±»å‹æ˜ å°„è¡¨
   804â†’
   805â†’| æŒ‡ä»¤ | API ç«¯ç‚¹ | ç›®æ ‡ Agent | è°ƒç”¨ Skill | æˆåŠŸå“åº” |
   806â†’|------|----------|------------|------------|----------|
   807â†’| `/divine` | `POST /api/chat/command` | Metaphysics | `calculate_bazi` | å…«å­—å¡ç‰‡ + è¿åŠ¿åˆ†æ |
   808â†’| `/divine type=ziwei` | åŒä¸Š | Metaphysics | `calculate_ziwei` | ç´«å¾®å‘½ç›˜ |
   809â†’| `/heal` | åŒä¸Š | Psychology | `mood_checkin` | æƒ…ç»ªæ‰“å¡ Modal |
   810â†’| `/heal mode=reframe` | åŒä¸Š | Psychology | `cbt_reframe` | CBT è®¤çŸ¥é‡æ„å¼•å¯¼ |
   811â†’| `/grow` | åŒä¸Š | Growth | `goal_setting` | ç›®æ ‡è®¾å®šå‘å¯¼ |
   812â†’| `/grow action=review` | åŒä¸Š | Growth | `weekly_review` | å‘¨å¤ç›˜å¼•å¯¼ |
   813â†’| `/status` | `GET /api/dashboard/status` | - | - | çŠ¶æ€å¡ç‰‡åˆ·æ–° |
   814â†’| `/help` | å‰ç«¯æœ¬åœ°å¤„ç† | - | - | æ˜¾ç¤ºæŒ‡ä»¤å¸®åŠ© |
   815â†’
   816â†’#### 2.6.4 å‰ç«¯å®ç°å…³é”®ä»£ç  (v4.2 Vercel AI SDK)
   817â†’
   818â†’**Chat ç»„ä»¶ - useChat Hook é›†æˆ**:
   819â†’
   820â†’```typescript
   821â†’// components/chat/chat-panel.tsx
   822â†’'use client';
   823â†’import { useChat } from 'ai/react';
   824â†’import { useState, useCallback } from 'react';
   825â†’import { MessageList } from './message-list';
   826â†’import { ChatInput } from './chat-input';
   827â†’import { CommandPalette, COMMANDS, type CommandOption } from './command-palette';
   828â†’
   829â†’interface ChatPanelProps {
   830â†’  userId: string;
   831â†’}
   832â†’
   833â†’export function ChatPanel({ userId }: ChatPanelProps) {
   834â†’  const [command, setCommand] = useState<string | null>(null);
   835â†’  const [showCommandPalette, setShowCommandPalette] = useState(false);
   836â†’  const [commandFilter, setCommandFilter] = useState('');
   837â†’
   838â†’  // Vercel AI SDK useChat Hook
   839â†’  const {
   840â†’    messages,
   841â†’    input,
   842â†’    setInput,
   843â†’    handleSubmit,
   844â†’    handleInputChange: baseHandleInputChange,
   845â†’    isLoading,
   846â†’    error,
   847â†’  } = useChat({
   848â†’    api: '/api/chat',
   849â†’    body: { userId, command },  // ä¼ é€’ command æ¨¡å¼
   850â†’    onFinish: (message) => {
   851â†’      setCommand(null);  // é‡ç½® command çŠ¶æ€
   852â†’      // æ£€æŸ¥ Tool è°ƒç”¨ç»“æœï¼Œè§¦å‘ Dashboard åˆ·æ–°
   853â†’      if (message.toolInvocations?.length) {
   854â†’        refreshDashboard(message.toolInvocations);
   855â†’      }
   856â†’    },
   857â†’    onError: (err) => {
   858â†’      toast.error(`å‘é€å¤±è´¥: ${err.message}`);
   859â†’    },
   860â†’  });
   861â†’
   862â†’  // æ‰©å±• handleInputChange ä»¥æ”¯æŒ Command Palette
   863â†’  const handleInputChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {
   864â†’    const value = e.target.value;
   865â†’    baseHandleInputChange(e);
   866â†’
   867â†’    if (value.startsWith('/')) {
   868â†’      setShowCommandPalette(true);
   869â†’      setCommandFilter(value.slice(1));
   870â†’    } else {
   871â†’      setShowCommandPalette(false);
   872â†’    }
   873â†’  }, [baseHandleInputChange]);
   874â†’
   875â†’  const handleCommandSelect = useCallback((cmd: CommandOption) => {
   876â†’    setCommand(`/${cmd.command}`);
   877â†’    setInput('');  // æ¸…ç©ºè¾“å…¥ï¼Œå‡†å¤‡æ¥æ”¶åç»­å‚æ•°
   878â†’    setShowCommandPalette(false);
   879â†’  }, [setInput]);
   880â†’
   881â†’  return (
   882â†’    <div className="chat-panel flex flex-col h-full">
   883â†’      {/* æ¶ˆæ¯åˆ—è¡¨ - è‡ªåŠ¨æ»šåŠ¨ */}
   884â†’      <MessageList messages={messages} isLoading={isLoading} />
   885â†’
   886â†’      {/* Command Palette æ‚¬æµ®èœå• */}
   887â†’      <CommandPalette
   888â†’        isOpen={showCommandPalette}
   889â†’        filter={commandFilter}
   890â†’        onSelect={handleCommandSelect}
   891â†’        onClose={() => setShowCommandPalette(false)}
   892â†’      />
   893â†’
   894â†’      {/* è¾“å…¥åŒºåŸŸ */}
   895â†’      <ChatInput
   896â†’        input={input}
   897â†’        command={command}
   898â†’        isLoading={isLoading}
   899â†’        onChange={handleInputChange}
   900â†’        onSubmit={handleSubmit}
   901â†’        onClearCommand={() => setCommand(null)}
   902â†’      />
   903â†’
   904â†’      {/* é”™è¯¯æç¤º */}
   905â†’      {error && <div className="error-toast">{error.message}</div>}
   906â†’    </div>
   907â†’  );
   908â†’}
   909â†’```
   910â†’
   911â†’**æ¶ˆæ¯åˆ—è¡¨ - Tool Invocations æ¸²æŸ“**:
   912â†’
   913â†’```typescript
   914â†’// components/chat/message-list.tsx
   915â†’import type { Message } from 'ai/react';
   916â†’import { MessageItem } from './message-item';
   917â†’import { ToolResultCard } from './tool-result-card';
   918â†’
   919â†’interface MessageListProps {
   920â†’  messages: Message[];
   921â†’  isLoading: boolean;
   922â†’}
   923â†’
   924â†’export function MessageList({ messages, isLoading }: MessageListProps) {
   925â†’  return (
   926â†’    <div className="message-list flex-1 overflow-y-auto p-4 space-y-4">
   927â†’      {messages.map((message) => (
   928â†’        <div key={message.id} className={`message ${message.role}`}>
   929â†’          {/* æ–‡æœ¬å†…å®¹ */}
   930â†’          <MessageItem content={message.content} role={message.role} />
   931â†’
   932â†’          {/* Tool Invocations (A2UI æ¸²æŸ“) */}
   933â†’          {message.toolInvocations?.map((tool) => (
   934â†’            <ToolResultCard key={tool.toolCallId} tool={tool} />
   935â†’          ))}
   936â†’        </div>
   937â†’      ))}
   938â†’
   939â†’      {/* åŠ è½½æŒ‡ç¤ºå™¨ */}
   940â†’      {isLoading && (
   941â†’        <div className="typing-indicator">
   942â†’          <span className="dot" /><span className="dot" /><span className="dot" />
   943â†’        </div>
   944â†’      )}
   945â†’    </div>
   946â†’  );
   947â†’}
   948â†’```
   949â†’
   950â†’**Tool Result å¡ç‰‡æ¸²æŸ“å™¨**:
   951â†’
   952â†’```typescript
   953â†’// components/chat/tool-result-card.tsx
   954â†’import type { ToolInvocation } from 'ai';
   955â†’import { BaziCard } from '@/components/cards/bazi-card';
   956â†’import { PermaCard } from '@/components/cards/perma-card';
   957â†’import { TaskCard } from '@/components/cards/task-card';
   958â†’
   959â†’interface ToolResultCardProps {
   960â†’  tool: ToolInvocation;
   961â†’}
   962â†’
   963â†’export function ToolResultCard({ tool }: ToolResultCardProps) {
   964â†’  // ç­‰å¾… Tool æ‰§è¡Œå®Œæˆ
   965â†’  if (tool.state !== 'result') {
   966â†’    return (
   967â†’      <div className="tool-loading">
   968â†’        æ­£åœ¨æ‰§è¡Œ {tool.toolName}...
   969â†’      </div>
   970â†’    );
   971â†’  }
   972â†’
   973â†’  const result = tool.result;
   974â†’
   975â†’  // æ ¹æ® Tool åç§°é€‰æ‹©æ¸²æŸ“ç»„ä»¶
   976â†’  switch (tool.toolName) {
   977â†’    case 'calculate_bazi':
   978â†’      return <BaziCard data={result} />;
   979â†’    case 'log_perma':
   980â†’      return <PermaCard data={result} />;
   981â†’    case 'covey_matrix':
   982â†’    case 'goal_setting':
   983â†’      return <TaskCard data={result} />;
   984â†’    case 'mood_checkin':
   985â†’      return <CheckinCard data={result} />;
   986â†’    default:
   987â†’      // é»˜è®¤ JSON æ¸²æŸ“
   988â†’      return (
   989â†’        <pre className="tool-result-json">
   990â†’          {JSON.stringify(result, null, 2)}
   991â†’        </pre>
   992â†’      );
   993â†’  }
   994â†’}
   995â†’```
   996â†’
   997â†’**Command Palette ç»„ä»¶**:
   998â†’
   999â†’```typescript
  1000â†’// components/chat/command-palette.tsx
  1001â†’import { Popover, PopoverContent } from '@/components/ui/popover';
  1002â†’
  1003â†’export interface CommandOption {
  1004â†’  command: string;
  1005â†’  label: string;
  1006â†’  description: string;
  1007â†’  icon: string;
  1008â†’}
  1009â†’
  1010â†’export const COMMANDS: CommandOption[] = [
  1011â†’  { command: 'divine', label: 'ç„å­¦æµ‹ç®—', description: 'å…«å­—/ç´«å¾®/æ˜Ÿåº§å‘½ç†åˆ†æ', icon: 'ğŸ”®' },
  1012â†’  { command: 'heal', label: 'å¿ƒç†ç–—æ„ˆ', description: 'æƒ…ç»ªæ‰“å¡/CBTè®¤çŸ¥é‡æ„', icon: 'ğŸ’š' },
  1013â†’  { command: 'grow', label: 'æˆé•¿æ•™ç»ƒ', description: 'ç›®æ ‡è®¾å®š/ä»»åŠ¡ç®¡ç†/å¤ç›˜', icon: 'ğŸŒ±' },
  1014â†’  { command: 'status', label: 'çŠ¶æ€æŸ¥çœ‹', description: 'æŸ¥çœ‹å½“å‰çŠ¶æ€ä¸è¶‹åŠ¿', icon: 'ğŸ“Š' },
  1015â†’  { command: 'help', label: 'å¸®åŠ©', description: 'æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨æŒ‡ä»¤', icon: 'â“' },
  1016â†’];
  1017â†’
  1018â†’interface CommandPaletteProps {
  1019â†’  isOpen: boolean;
  1020â†’  filter: string;
  1021â†’  onSelect: (cmd: CommandOption) => void;
  1022â†’  onClose: () => void;
  1023â†’}
  1024â†’
  1025â†’export function CommandPalette({ isOpen, filter, onSelect, onClose }: CommandPaletteProps) {
  1026â†’  const filtered = COMMANDS.filter(cmd =>
  1027â†’    cmd.command.includes(filter) || cmd.label.includes(filter)
  1028â†’  );
  1029â†’
  1030â†’  return (
  1031â†’    <Popover open={isOpen} onOpenChange={onClose}>
  1032â†’      <PopoverContent className="command-palette w-80 p-2" align="start">
  1033â†’        {filtered.map(cmd => (
  1034â†’          <button
  1035â†’            key={cmd.command}
  1036â†’            onClick={() => onSelect(cmd)}
  1037â†’            className="command-item w-full flex items-center gap-3 p-2 rounded hover:bg-muted"
  1038â†’          >
  1039â†’            <span className="text-xl">{cmd.icon}</span>
  1040â†’            <div className="flex-1 text-left">
  1041â†’              <div className="font-medium">/{cmd.command}</div>
  1042â†’              <div className="text-sm text-muted-foreground">{cmd.description}</div>
  1043â†’            </div>
  1044â†’          </button>
  1045â†’        ))}
  1046â†’      </PopoverContent>
  1047â†’    </Popover>
  1048â†’  );
  1049â†’}
  1050â†’```
  1051â†’
  1052â†’#### 2.6.5 å®ç°çŠ¶æ€ (v4.2)
  1053â†’
  1054â†’| ç»„ä»¶ | è®¾è®¡ | TypeScript | è¯´æ˜ |
  1055â†’|------|:----:|:----------:|------|
  1056â†’| `useChat()` Hook é›†æˆ | âœ… | âš ï¸ | éœ€å¼•å…¥ `ai/react` |
  1057â†’| `app/api/chat/route.ts` | âœ… | âš ï¸ | Agent Runtime API Route |
  1058â†’| `ToolResultCard` æ¸²æŸ“å™¨ | âœ… | âš ï¸ | æ ¹æ® toolName é€‰æ‹©å¡ç‰‡ |
  1059â†’| `CommandPalette` ç»„ä»¶ | âœ… | âš ï¸ | å¾…å®ç°æ‚¬æµ®èœå• |
  1060â†’| `BaziCard` / `PermaCard` | âœ… | âš ï¸ | Tool Result ä¸“å±å¡ç‰‡ |
  1061â†’| `refreshDashboard()` | âœ… | âš ï¸ | Tool å®Œæˆåè§¦å‘ Tab åˆ·æ–° |
  1062â†’
  1063â†’---
  1064â†’
  1065â†’## 3. ç»„ä»¶å®ç°çŠ¶æ€
  1066â†’
  1067â†’### 3.1 Zone A ç»„ä»¶
  1068â†’
  1069â†’| ç»„ä»¶ | è®¾è®¡ | å®ç° | å·®è· |
  1070â†’|------|------|------|------|
  1071â†’| `ChatPanel` | âœ… | âœ… | æ—  |
  1072â†’| `MessageList` | âœ… è™šæ‹Ÿæ»šåŠ¨ | âš ï¸ æ™®é€šæ»šåŠ¨ | éœ€ä¼˜åŒ– |
  1073â†’| `MessageItem` | âœ… A2UI æ¸²æŸ“ | âš ï¸ éƒ¨åˆ† | action_buttons |
  1074â†’| `ChatInput` | âœ… Omnibar + Command | âš ï¸ éƒ¨åˆ† | éœ€æ·»åŠ  / è§¦å‘æ£€æµ‹ |
  1075â†’| `CommandPalette` | âœ… v4.1 æ–°å¢ | âš ï¸ å¾…å®ç° | æ‚¬æµ®èœå•ç»„ä»¶ |
  1076â†’| `TypingIndicator` | âœ… | âœ… | æ—  |
  1077â†’
  1078â†’### 3.2 Zone B ç»„ä»¶
  1079â†’
  1080â†’| ç»„ä»¶ | è®¾è®¡ | å®ç° | å·®è· |
  1081â†’|------|------|------|------|
  1082â†’| `DashboardPanel` | âœ… | âœ… | æ—  |
  1083â†’| `TabNavigation` | âœ… | âœ… | æ—  |
  1084â†’| `OverviewTab` | âœ… | âœ… | æ—  |
  1085â†’| `StatusTab` | âœ… L0/L1 | âœ… | æ—  |
  1086â†’| `TrendsTab` | âœ… å›¾è¡¨ | âœ… | å¯å¢å¼º K çº¿ |
  1087â†’| `TasksTab` | âœ… CRUD | âš ï¸ | CSRF é—®é¢˜ |
  1088â†’| `RelationsTab` | âœ… å¥½å‹/åˆç›˜ | âœ… | æ—  |
  1089â†’| `ExploreTab` | âœ… æŠ¥å‘Š/è®¡åˆ’ | âœ… | æ—  |
  1090â†’
  1091â†’### 3.3 é€šç”¨ç»„ä»¶
  1092â†’
  1093â†’| ç»„ä»¶ | è®¾è®¡ | å®ç° | å·®è· |
  1094â†’|------|------|------|------|
  1095â†’| `Skeleton` | âœ… Shimmer | âš ï¸ åŸºç¡€ | éœ€å¢å¼º |
  1096â†’| `Toast` | âœ… åº•éƒ¨æç¤º | âœ… | æ—  |
  1097â†’| `Modal` | âœ… | âœ… | æ—  |
  1098â†’| `Card` | âœ… æ— è¾¹æ¡† | âœ… | æ—  |
  1099â†’
  1100â†’---
  1101â†’
  1102â†’## 4. æ ·å¼ Token å®ç°çŠ¶æ€
  1103â†’
  1104â†’### 4.1 é¢œè‰²ç³»ç»Ÿ
  1105â†’
  1106â†’| Token | è®¾è®¡å€¼ | å®ç°å€¼ | çŠ¶æ€ |
  1107â†’|-------|--------|--------|------|
  1108â†’| `--background` | `0 0% 100%` / `0 0% 10%` | âœ… | ä¸€è‡´ |
  1109â†’| `--foreground` | `42 8% 20%` / `0 0% 83%` | âœ… | ä¸€è‡´ |
  1110â†’| `--sidebar` | `40 9% 98%` / `0 0% 13%` | âœ… | ä¸€è‡´ |
  1111â†’| `--border` | `40 5% 91%` / `0 0% 22%` | âœ… | ä¸€è‡´ |
  1112â†’| `--mystic` | `292 47% 95%` | âš ï¸ | å¾…æ·»åŠ  |
  1113â†’| `--advice` | `207 89% 94%` | âš ï¸ | å¾…æ·»åŠ  |
  1114â†’
  1115â†’### 4.2 å­—ä½“ç³»ç»Ÿ
  1116â†’
  1117â†’| Token | è®¾è®¡å€¼ | å®ç°å€¼ | çŠ¶æ€ |
  1118â†’|-------|--------|--------|------|
  1119â†’| H1 | 30px / 1.2 / 600 | âœ… | ä¸€è‡´ |
  1120â†’| H2 | 24px / 1.3 / 600 | âœ… | ä¸€è‡´ |
  1121â†’| Body | 16px / 1.6 / 400 | âœ… | ä¸€è‡´ |
  1122â†’| Caption | 14px / 1.5 / 400 | âœ… | ä¸€è‡´ |
  1123â†’
  1124â†’---
  1125â†’
  1126â†’## 5. å¾…ä¼˜åŒ–é¡¹æ±‡æ€»
  1127â†’
  1128â†’### 5.1 P0ï¼ˆå¿…é¡»ä¿®å¤ï¼‰
  1129â†’
  1130â†’```typescript
  1131â†’// é—®é¢˜1: CSRF Token æœªæ­£ç¡®ä¼ é€’
  1132â†’// ä½ç½®: web-app/src/lib/api.ts
  1133â†’
  1134â†’// ä¿®å¤æ–¹æ¡ˆ:
  1135â†’export async function apiPost(url: string, data: any) {
  1136â†’  const csrfToken = getCookie('fortune_csrf');  // â† æ·»åŠ 
  1137â†’  
  1138â†’  const response = await fetch(url, {
  1139â†’    method: 'POST',
  1140â†’    headers: {
  1141â†’      'Content-Type': 'application/json',
  1142â†’      'X-CSRF-Token': csrfToken || '',  // â† æ·»åŠ 
  1143â†’    },
  1144â†’    credentials: 'include',
  1145â†’    body: JSON.stringify(data),
  1146â†’  });
  1147â†’  
  1148â†’  return response.json();
  1149â†’}
  1150â†’```
  1151â†’
  1152â†’```typescript
  1153â†’// é—®é¢˜2: action_buttons æœªæ¸²æŸ“ç‚¹å‡»å¤„ç†
  1154â†’// ä½ç½®: web-app/src/components/chat/message-item.tsx
  1155â†’
  1156â†’// ä¿®å¤æ–¹æ¡ˆ:
  1157â†’function ActionButton({ action, label }: { action: Action; label: string }) {
  1158â†’  const handleClick = async () => {
  1159â†’    switch (action.type) {
  1160â†’      case 'start_task':
  1161â†’        await apiPost('/api/dashboard/task/accept', {
  1162â†’          task_id: action.task_id,
  1163â†’          commitment_type: 'start_task',
  1164â†’        });
  1165â†’        toast.success('ä»»åŠ¡å·²å¼€å§‹');
  1166â†’        // è§¦å‘ä»»åŠ¡åˆ—è¡¨åˆ·æ–°
  1167â†’        break;
  1168â†’        
  1169â†’      case 'open_panel':
  1170â†’        // åˆ‡æ¢åˆ°å¯¹åº” Tab
  1171â†’        setActiveTab(action.panel);
  1172â†’        break;
  1173â†’    }
  1174â†’  };
  1175â†’  
  1176â†’  return <Button onClick={handleClick}>{label}</Button>;
  1177â†’}
  1178â†’```
  1179â†’
  1180â†’### 5.2 P1ï¼ˆåº”å°½å¿«å¤„ç†ï¼‰
  1181â†’
  1182â†’- [ ] æ·»åŠ è™šæ‹Ÿæ»šåŠ¨ (`@tanstack/react-virtual`)
  1183â†’- [ ] å®Œå–„éª¨æ¶å±åŠ è½½çŠ¶æ€
  1184â†’- [ ] æ·»åŠ  Zustand çŠ¶æ€ç®¡ç†
  1185â†’- [ ] å®ç° Zone A â†” Zone B è‡ªåŠ¨è”åŠ¨
  1186â†’
  1187â†’### 5.3 P2ï¼ˆåç»­ä¼˜åŒ–ï¼‰
  1188â†’
  1189â†’- [ ] æ·»åŠ  Framer Motion åŠ¨æ•ˆ
  1190â†’- [ ] å®ç° K çº¿èœ¡çƒ›å›¾ç»„ä»¶
  1191â†’- [ ] æ·»åŠ  PWA æ”¯æŒ
  1192â†’- [ ] ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ
  1193â†’
  1194â†’---
  1195â†’
  1196â†’## 6. æ€»ç»“
  1197â†’
  1198â†’### 6.1 è®¾è®¡ vs å®ç°ä¸€è‡´æ€§
  1199â†’
  1200â†’```
  1201â†’=== å‰ç«¯ç»„ä»¶ ===
  1202â†’æ•´ä½“å¸ƒå±€:      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 85%
  1203â†’ç»„ä»¶å®Œæˆåº¦:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 70%
  1204â†’æ ·å¼ä¸€è‡´æ€§:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%
  1205â†’äº¤äº’å®Œæ•´æ€§:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 60%
  1206â†’
  1207â†’=== åç«¯æ¶æ„å±‚å¯¹æ¥ ===
  1208â†’Interaction Layer:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 70%  â† æ¨¡å‹åˆ‡æ¢ UI å¾…å®ç°
  1209â†’Context Management: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 90%  â† A2UI æ¸²æŸ“åŸºæœ¬å°±ç»ª
  1210â†’L2 Style Agents:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 90%  â† é£æ ¼åˆ‡æ¢å·²å®ç°
  1211â†’L1 Module Data:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%  â† Kçº¿ç»„ä»¶å¾…å®ç°
  1212â†’L0 Base Data:       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% â† ç”¨æˆ·æ•°æ®å±•ç¤ºå®Œæ•´
  1213â†’```
  1214â†’
  1215â†’### 6.2 å…³é”®å·®è·
  1216â†’
  1217â†’| å·®è· | å½±å“ | ä¼˜å…ˆçº§ | å¯¹åº”æ¶æ„å±‚ |
  1218â†’|------|------|--------|------------|
  1219â†’| CSRF å¤„ç† | ä»»åŠ¡åŠŸèƒ½ä¸å¯ç”¨ | P0 | - |
  1220â†’| action_buttons | ç”¨æˆ·æ— æ³•ä¸€é”®è¡ŒåŠ¨ | P0 | Context Mgmt |
  1221â†’| è™šæ‹Ÿæ»šåŠ¨ | é•¿å¯¹è¯æ€§èƒ½é—®é¢˜ | P1 | - |
  1222â†’| çŠ¶æ€è”åŠ¨ | éœ€æ‰‹åŠ¨åˆ·æ–° | P1 | - |
  1223â†’| Kçº¿èœ¡çƒ›å›¾ | è¶‹åŠ¿å¯è§†åŒ–ä¸å®Œæ•´ | P1 | L1 Module Data |
  1224â†’| æ¨¡å‹åˆ‡æ¢ UI | ç”¨æˆ·æ— æ³•é€‰æ‹©æ¨¡å‹ | P2 | Interaction Layer |
  1225â†’
  1226â†’### 6.3 ä¸‹ä¸€æ­¥è¡ŒåŠ¨
  1227â†’
  1228â†’1. **P0**: ä¿®å¤ lib/api.ts çš„ CSRF å¤„ç†
  1229â†’2. **P0**: å®Œå–„ message-item.tsx çš„ action å¤„ç† (Context Mgmt å¯¹æ¥)
  1230â†’3. **P1**: å¼•å…¥ Zustand çŠ¶æ€ç®¡ç†
  1231â†’4. **P1**: æ·»åŠ è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–
  1232â†’5. **P1**: Kçº¿èœ¡çƒ›å›¾ç»„ä»¶ (L1 Module Data å¯è§†åŒ–)
  1233â†’6. **P2**: æ¨¡å‹/é£æ ¼åˆ‡æ¢ UI (Interaction Layer é…ç½®)
  1234â†’
  1235â†’---
  1236â†’
  1237â†’*æ–‡æ¡£ç‰ˆæœ¬: v4.2 (Vercel AI SDK Edition)*
  1238â†’*æ›´æ–°æ—¥æœŸ: 2026-01-01*
  1239â†’*æ ¸å¿ƒæŠ€æœ¯: Vercel AI SDK 6 + useChat() Hook + Tool Calling*
  1240â†’*æµ‹è¯•ç¯å¢ƒ: http://106.37.170.238:8231/new*
  1241â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
