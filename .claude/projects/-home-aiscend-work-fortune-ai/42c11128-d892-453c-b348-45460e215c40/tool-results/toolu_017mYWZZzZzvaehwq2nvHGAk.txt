   480→      console.error('Failed to complete task:', err)
   481→    }
   482→  },
   483→
   484→  // Skip Task
   485→  skipTask: async (taskId, reason = '') => {
   486→    try {
   487→      await api.skipTask(taskId, reason)
   488→      get().fetchTasks()
   489→      get().fetchOverview()
   490→    } catch (err) {
   491→      console.error('Failed to skip task:', err)
   492→    }
   493→  },
   494→
   495→  // Submit Checkin
   496→  submitCheckin: async (mood, intensity, note = '') => {
   497→    const result = await api.submitCheckin(mood, intensity, note)
   498→    set({
   499→      stateScore: {
   500→        score: result.state_score.score,
   501→        breakdown: result.state_score.breakdown,
   502→        recoveryAction: result.state_score.recovery_action,
   503→      },
   504→    })
   505→    return result
   506→  },
   507→
   508→  // Chat: Send Message
   509→  sendMessage: async (content) => {
   510→    const { sessionId, messages } = get()
   511→
   512→    // Add user message
   513→    const userMessage: Message = {
   514→      id: `user-${Date.now()}`,
   515→      role: 'user',
   516→      content,
   517→      timestamp: new Date(),
   518→    }
   519→    const assistantId = `assistant-${Date.now()}`
   520→    const assistantMessage: Message = {
   521→      id: assistantId,
   522→      role: 'assistant',
   523→      content: '',
   524→      timestamp: new Date(),
   525→    }
   526→    set({ messages: [...messages, userMessage, assistantMessage], isStreaming: true })
   527→
   528→    try {
   529→      let streamedText = ''
   530→
   531→      api.streamChatMessage(
   532→        content,
   533→        sessionId || undefined,
   534→        (chunk) => {
   535→          streamedText += chunk
   536→          set((state) => ({
   537→            messages: state.messages.map((m) =>
   538→              m.id === assistantId
   539→                ? { ...m, content: streamedText }
   540→                : m
   541→            ),
   542→          }))
   543→        },
   544→        (final) => {
   545→          set((state) => ({
   546→            messages: state.messages.map((m) =>
   547→              m.id === assistantId
   548→                ? {
   549→                    ...m,
   550→                    content: final.reply || streamedText || '收到了，让我想想...',
   551→                    blocks: a2uiToBlocks(final.ui_components),
   552→                  }
   553→                : m
   554→            ),
   555→            sessionId: final.session_id,
   556→            isStreaming: false,
   557→          }))
   558→        },
   559→        (err) => {
   560→          console.error('Chat stream failed:', err)
   561→          const msg = err instanceof Error ? err.message : String(err || 'unknown_error')
   562→          set((state) => ({
   563→            messages: state.messages.map((m) =>
   564→              m.id === assistantId
   565→                ? { ...m, content: streamedText || `（请求失败：${msg}）` }
   566→                : m
   567→            ),
   568→            isStreaming: false,
   569→          }))
   570→        }
   571→      )
   572→    } catch (err) {
   573→      console.error('Failed to send message:', err)
   574→      set({ isStreaming: false })
   575→    }
   576→  },
   577→
   578→  // Chat: Add Message (for non-streaming)
   579→  addMessage: (message) =>
   580→    set((state) => ({
   581→      messages: [...state.messages, message],
   582→    })),
   583→
   584→  setStreaming: (streaming) => set({ isStreaming: streaming }),
   585→
   586→  clearMessages: () => set({ messages: [], sessionId: null }),
   587→
   588→  // Artifact Actions
   589→  addArtifact: (artifact) =>
   590→    set((state) => ({
   591→      artifacts: [...state.artifacts, artifact],
   592→    })),
   593→
   594→  pinArtifact: (id) =>
   595→    set((state) => {
   596→      const artifact = state.artifacts.find((a) => a.id === id)
   597→      if (!artifact) return state
   598→
   599→      const updated = { ...artifact, pinned: true }
   600→      return {
   601→        artifacts: state.artifacts.map((a) => (a.id === id ? updated : a)),
   602→        pinnedArtifacts: [...state.pinnedArtifacts, updated],
   603→      }
   604→    }),
   605→
   606→  unpinArtifact: (id) =>
   607→    set((state) => ({
   608→      artifacts: state.artifacts.map((a) =>
   609→        a.id === id ? { ...a, pinned: false } : a
   610→      ),
   611→      pinnedArtifacts: state.pinnedArtifacts.filter((a) => a.id !== id),
   612→    })),
   613→}))
   614→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
