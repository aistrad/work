The file /home/aiscend/work/fortune_ai/api/static/auth.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
   609→    } else if (mode === 'login'){
   610→      showSheet('login');
   611→    }
   612→
   613→    // === Mode Tab Switching ===
   614→    modeTabs.forEach((tab) => {
   615→      tab.addEventListener('click', () => {
   616→        const mode = tab.getAttribute('data-mode');
   617→        if (mode === currentMode) return;
   618→        currentMode = mode;
   619→        modeTabs.forEach((t) => {
   620→          const isActive = t.getAttribute('data-mode') === mode;
   621→          t.classList.toggle('active', isActive);
   622→          t.setAttribute('aria-selected', String(isActive));
   623→        });
   624→        // Re-fetch validation points for new mode
   625→        if (lastPreviewOk) {
   626→          fetchValidationPoints();
   627→        }
   628→      });
   629→    });
   630→
   631→    // === Validation Points ===
   632→    async function fetchValidationPoints() {
   633→      const birth = readBirthInfo();
   634→      if (!birth.ok) return;
   635→
   636→      if (validationInflight > 0) return;
   637→      validationInflight++;
   638→
   639→      try {
   640→        const payload = {
   641→          mode: currentMode,
   642→          gender: birth.gender,
   643→          birthday_local: toBirthdayLocal(birth.birthDate, birth.birthTime),
   644→          tz_offset_hours: birth.tz,
   645→          location: birth.location,
   646→        };
   647→        const data = await postJson('/api/auth/validation-points', payload);
   648→        const points = data?.points || [];
   649→        if (points.length > 0) {
   650→          renderValidationPoints(points);
   651→          if (validationCard) {
   652→            validationCard.classList.add('show');
   653→          }
   654→        }
   655→      } catch (err) {
   656→        console.warn('validation-points error:', err);
   657→      } finally {
   658→        validationInflight--;
   659→      }
   660→    }
   661→
   662→    function renderValidationPoints(points) {
   663→      if (!validationPoints) return;
   664→      const html = points.map((text) => `
   665→        <div class="validation-point">
   666→          <div class="validation-point__check">
   667→            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 12l5 5L20 7"/></svg>
   668→          </div>
   669→          <div class="validation-point__text">${escapeHtml(String(text))}</div>
   670→        </div>
   671→      `).join('');
   672→      validationPoints.innerHTML = html;
   673→    }
   674→
   675→    // Extend runPreview to also fetch validation points on success
   676→    const originalRunPreviewOk = () => {
   677→      // After preview succeeds, fetch validation points
   678→      if (lastPreviewOk) {
   679→        fetchValidationPoints();
   680→      }
   681→    };
   682→
   683→    // Patch: hook into setPreviewState to trigger validation points fetch
   684→    const _originalSetPreviewState = setPreviewState;
   685→    setPreviewState = function(state) {
   686→      _originalSetPreviewState(state);
   687→      if (state === 'ready') {
   688→        window.setTimeout(() => fetchValidationPoints(), 200);
   689→      }
   690→    };
   691→
   692→    // === Inline Auth Toggle ===
   693→    function switchInlineAuth(mode) {
   694→      const isRegister = mode === 'register';
   695→      if (toggleRegister) {
   696→        toggleRegister.classList.toggle('active', isRegister);
   697→        toggleRegister.setAttribute('aria-selected', String(isRegister));
   698→      }
   699→      if (toggleLogin) {
   700→        toggleLogin.classList.toggle('active', !isRegister);
   701→        toggleLogin.setAttribute('aria-selected', String(!isRegister));
   702→      }
   703→      if (inlineRegister) inlineRegister.classList.toggle('show', isRegister);
   704→      if (inlineLogin) inlineLogin.classList.toggle('show', !isRegister);
   705→      hideErrIn(errInline);
   706→    }
   707→
   708→    toggleRegister?.addEventListener('click', () => switchInlineAuth('register'));
   709→    toggleLogin?.addEventListener('click', () => switchInlineAuth('login'));
   710→
   711→    // === Inline Register Form Submit ===
   712→    inlineRegisterForm?.addEventListener('submit', async (e) => {
   713→      e.preventDefault();
   714→      hideErrIn(errInline);
   715→
   716→      const birth = readBirthInfo();
   717→      if (!birth.ok) {
   718→        showErrIn(errInline, '请先补全出生信息（性别/日期/时间），生成预览后再保存。');
   719→        dateEl.focus();
   720→        return;
   721→      }
   722→
   723→      const fd = new FormData(inlineRegisterForm);
   724→      const email = String(fd.get('email') || '').trim();
   725→      const password = String(fd.get('password') || '');
   726→      const name = String(fd.get('name') || '').trim();
   727→      if (!name) {
   728→        showErrIn(errInline, '昵称为必填项');
   729→        return;
   730→      }
   731→
   732→      try {
   733→        await postJson('/api/auth/register', {
   734→          email,
   735→          password,
   736→          name,
   737→          gender: birth.gender,
   738→          birthday_local: toBirthdayLocal(birth.birthDate, birth.birthTime),
   739→          tz_offset_hours: birth.tz,
   740→          location: birth.location,
   741→        });
   742→        try { sessionStorage.removeItem('fortune_auth_draft_v1'); } catch {}
   743→        location.href = '/main';
   744→      } catch (err) {
   745→        showErrIn(errInline, String(err?.message || err));
   746→      }
   747→    });
   748→
   749→    // === Inline Login Form Submit ===
   750→    inlineLoginForm?.addEventListener('submit', async (e) => {
   751→      e.preventDefault();
   752→      hideErrIn(errInline);
   753→      const fd = new FormData(inlineLoginForm);
   754→      const email = String(fd.get('email') || '').trim();
   755→      const password = String(fd.get('password') || '');
   756→      try {
   757→        await postJson('/api/auth/login', { email, password });
   758→        location.href = '/main';
   759→      } catch (err) {
   760→        showErrIn(errInline, String(err?.message || err));
   761→      }
   762→    });
   763→
   764→    // === Enable inline register button when preview is ready ===
   765→    function updateInlineRegisterBtn() {
   766→      if (btnInlineRegister) {
   767→        btnInlineRegister.disabled = !lastPreviewOk;
   768→      }
   769→    }
   770→
   771→    // Patch setPreviewState again to update inline register button
   772→    const _setPreviewStateForBtn = setPreviewState;
   773→    setPreviewState = function(state) {
   774→      _setPreviewStateForBtn(state);
   775→      updateInlineRegisterBtn();
   776→    };
   777→
   778→    // kick off preview if possible
   779→    schedulePreview();
   780→  }
   781→
   782→  return { initLogin, initRegister, initAuthExperience };
   783→})();
   784→