    90→    finally:
    91→        try:
    92→            if getattr(conn, "closed", 0):
    93→                p.putconn(conn, close=True)
    94→            else:
    95→                p.putconn(conn)
    96→        except Exception:
    97→            try:
    98→                p.putconn(conn, close=True)
    99→            except Exception:
   100→                pass
   101→
   102→
   103→@contextmanager
   104→def db_cursor(dict_cursor: bool = True):
   105→    with db_conn() as conn:
   106→        cur = conn.cursor(cursor_factory=RealDictCursor if dict_cursor else None)
   107→        try:
   108→            yield cur
   109→            conn.commit()
   110→        except Exception:
   111→            try:
   112→                conn.rollback()
   113→            except Exception:
   114→                pass
   115→            raise
   116→        finally:
   117→            cur.close()
   118→
   119→
   120→def fetch_one(sql: str, params: Sequence[Any] | None = None) -> Optional[Dict[str, Any]]:
   121→    with db_cursor(dict_cursor=True) as cur:
   122→        cur.execute(sql, tuple(params or []))
   123→        row = cur.fetchone()
   124→        return dict(row) if row else None
   125→
   126→
   127→def fetch_all(sql: str, params: Sequence[Any] | None = None) -> List[Dict[str, Any]]:
   128→    with db_cursor(dict_cursor=True) as cur:
   129→        cur.execute(sql, tuple(params or []))
   130→        rows = cur.fetchall() or []
   131→        return [dict(r) for r in rows]
   132→
   133→
   134→def execute(sql: str, params: Sequence[Any] | None = None) -> int:
   135→    with db_cursor(dict_cursor=False) as cur:
   136→        cur.execute(sql, tuple(params or []))
   137→        return int(cur.rowcount or 0)
   138→
   139→
   140→def execute_returning_one(sql: str, params: Sequence[Any] | None = None) -> Optional[Dict[str, Any]]:
   141→    with db_cursor(dict_cursor=True) as cur:
   142→        cur.execute(sql, tuple(params or []))
   143→        row = cur.fetchone()
   144→        return dict(row) if row else None
   145→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
