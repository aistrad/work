     1→import os
     2→import time
     3→import subprocess
     4→from typing import List
     5→
     6→ROOT = os.path.abspath(os.path.join(os.path.dirname(__file__), ".."))
     7→
     8→
     9→def _env() -> dict:
    10→    env = os.environ.copy()
    11→    # Ensure cli_worker can import its package
    12→    env.setdefault("PYTHONPATH", "src")
    13→    if not env.get("DB_URL"):
    14→        # default to sqlite path under CLI_WORKER_ROOT
    15→        root = env.get("CLI_WORKER_ROOT", "/home/aiscend/work/cli_worker")
    16→        env["DB_URL"] = f"sqlite:///{root}/cli_worker.db"
    17→    return env
    18→
    19→
    20→def _run_worker_once(args: List[str]) -> int:
    21→    cmd = ["python3", "-m", "cli_worker.cli", "worker", "start"] + args
    22→    root = os.environ.get("CLI_WORKER_ROOT", "/home/aiscend/work/cli_worker")
    23→    proc = subprocess.Popen(cmd, cwd=root, env=_env())
    24→    return proc.wait()
    25→
    26→
    27→def main():
    28→    tools = os.getenv("CLI_WORKER_TOOLS", "gemini")
    29→    sleep_s = float(os.getenv("CLI_WORKER_SLEEP", "0.5"))
    30→    simulate = os.getenv("CLI_WORKER_SIMULATE", "0") == "1"
    31→    idle_rounds = os.getenv("CLI_WORKER_IDLE_ROUNDS", "0")  # 0 => long-running
    32→    args: List[str] = ["--tools", tools]
    33→    if simulate:
    34→        args.append("--simulate")
    35→    if idle_rounds and idle_rounds != "0":
    36→        args += ["--until-idle", "--idle-rounds", str(idle_rounds)]
    37→    else:
    38→        # stay running by restarting when it exits after an idle loop
    39→        args += ["--until-idle", "--idle-rounds", "1"]
    40→
    41→    while True:
    42→        code = _run_worker_once(args)
    43→        # Backoff on crash
    44→        time.sleep(sleep_s if code == 0 else 2.0)
    45→
    46→
    47→if __name__ == "__main__":
    48→    main()
    49→
    50→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
