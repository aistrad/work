     1â†’# Fortune AI æ ¸å¿ƒåŠŸèƒ½æ¨¡å—è®¾è®¡
     2â†’
     3â†’**ç‰ˆæœ¬**ï¼šv4.2ï¼ˆ2026-01-01ï¼ŒVercel AI SDK Editionï¼‰
     4â†’
     5â†’> **å®šä½**: åŸºäº Vercel AI SDK 6 çš„å¯æ‰§è¡ŒåŠŸèƒ½æ¨¡å—
     6â†’>
     7â†’> **æ ¸å¿ƒæ¶æ„**: å‚è§ [os_design_v3.md Â§1.4](./os_design_v3.md#14-è¿›åŒ–è®°å¿†æ¶æ„-vercel-ai-sdk-edition---v42)
     8â†’>
     9â†’> **å…¥å£**: http://106.37.170.238:8231/new
    10â†’>
    11â†’> **æœ¬ç‰ˆæ›´æ–°**: é‡‡ç”¨ Vercel AI SDK `tool()` é‡æ„ Skills + `useChat()` æµå¼äº¤äº’
    12â†’
    13â†’---
    14â†’
    15â†’## 0. ä¿®è®¢æ€»è§ˆ
    16â†’
    17â†’### 0.0 æ¶æ„å±‚æ¬¡æ˜ å°„ (v4.2 Vercel AI SDK Edition)
    18â†’
    19â†’æœ¬æ–‡æ¡£ä¸­çš„åŠŸèƒ½æ¨¡å—å¯¹åº” Soul OS v4.2 æ¶æ„å±‚æ¬¡ï¼š
    20â†’
    21â†’| æ¶æ„å±‚ | æŠ€æœ¯å®ç° | è¿è¡Œç¯å¢ƒ | æ¨¡å—ç¤ºä¾‹ |
    22â†’|--------|----------|----------|----------|
    23â†’| **Frontend** | `useChat()` Hook | Next.js Client | Chat Panel + CommandPalette |
    24â†’| **Agent Runtime** | `streamText()` + `tool()` | Next.js API Route | `/api/chat/route.ts` |
    25â†’| **Multi-Model Hub** | Vercel AI Gateway | Serverless | GLM-4.5 / Gemini / Claude |
    26â†’| **Skills Registry** | Zod Schema + Execute | TypeScript | `divine-skills.ts`, `heal-skills.ts` |
    27â†’| **Context Manager** | Python API + TS fetch | Hybrid | L0+L1 èšåˆ |
    28â†’| **Data Service** | FastAPI | Python | `/api/bazi/*`, `/api/perma/*` |
    29â†’| **Admin System** | shadcn/ui + Monaco + TanStack | Next.js `/admin` | Cockpit Dashboard + Agent Studio |
    30â†’| **Insight Agent** | Cron Worker | Python | Cold Path æ•°æ®æ²‰æ·€ |
    31â†’
    32â†’**v4.2 æ ¸å¿ƒå˜åŒ–**:
    33â†’
    34â†’| v4.0/v4.1 | v4.2 | è¯´æ˜ |
    35â†’|-----------|------|------|
    36â†’| `glm_client.py` | `streamText()` | AI æ¨ç†è¿ç§»åˆ° TypeScript |
    37â†’| Python Skills | `tool({ parameters, execute })` | Zod Schema ç±»å‹å®‰å…¨ |
    38â†’| è‡ªå®šä¹‰ SSE | `toDataStreamResponse()` | æ ‡å‡†åŒ–æµå¼åè®® |
    39â†’| CSRF æ‰‹åŠ¨å¤„ç† | Next.js API Route åŒæº | æ— è·¨åŸŸé—®é¢˜ |
    40â†’
    41â†’> **v4.2 è¯¦ç»†è®¾è®¡**: å‚è§ [os_design_v3.md Â§1.5](./os_design_v3.md#15-agent-runtime--skills-vercel-ai-sdk-implementation---v42)
    42â†’
    43â†’### 0.0.1 v4.0 åŒè·¯å¾„è®¾è®¡
    44â†’
    45â†’| è·¯å¾„ | ç±»å‹ | èŒè´£ | å»¶è¿Ÿ |
    46â†’|------|------|------|------|
    47â†’| **Hot Path** | åŒæ­¥ | è¯»å– L0/L1 â†’ ç»„è£… Context â†’ ç”Ÿæˆå›å¤ | <2s |
    48â†’| **Cold Path** | å¼‚æ­¥ | Insight Agent åˆ†æå¯¹è¯ â†’ åå†™ L0/L1 | åå° |
    49â†’
    50â†’### 0.1 æ¨¡å—å®ç°çŠ¶æ€çŸ©é˜µ
    51â†’
    52â†’| æ¨¡å— | è®¾è®¡ | åç«¯ | å‰ç«¯ | é˜»å¡é¡¹ | æ¶æ„å±‚ |
    53â†’|------|------|------|------|--------|--------|
    54â†’| **Landing Page** | âœ… Digital Mirror | â³ å¾…å®ç° | â³ å¾…å®ç° | WebGL + API | Frontend |
    55â†’| **Admin System** | âœ… Cockpit è®¾è®¡ | â³ å¾…å®ç° | â³ å¾…å®ç° | Monaco + RBAC | Admin |
    56â†’| Login é¡µé¢ | âœ… Tab + éªŒè¯ç‚¹ | âœ… å·²å®ç° | âœ… å·²å®ç° | - | L0 |
    57â†’| æ·±åº¦æŠ¥å‘Š | âœ… 6ç« ç»“æ„ | âœ… å·²å®ç° | âœ… å·²å®ç° | - | L2 Expert |
    58â†’| å¯¹è¯ç³»ç»Ÿ | âœ… A2UI + If-Then | âœ… å·²å®ç° | âš ï¸ éƒ¨åˆ† | action_buttons | Context Mgmt |
    59â†’| æµ·æŠ¥ç”Ÿæˆ | âœ… Gemini å›¾ç‰‡ | âœ… å·²å®ç° | âš ï¸ å¾…å®Œå–„ | å‰ç«¯è°ƒç”¨ | Interaction |
    60â†’| Kçº¿ç³»ç»Ÿ | âœ… OHLC èœ¡çƒ›å›¾ | âš ï¸ éƒ¨åˆ† | âš ï¸ å¾…å®ç° | API + ç»„ä»¶ | L1 Module |
    61â†’| Settings | âœ… å®Œæ•´è®¾è®¡ | âœ… å·²å®ç° | âš ï¸ å¾…å®Œå–„ | é¡µé¢UI | L0 |
    62â†’| ä»»åŠ¡ç³»ç»Ÿ | âœ… æ‰¿è¯ºé—­ç¯ | âœ… å·²å®ç° | âš ï¸ CSRF | å‰ç«¯ä¿®å¤ | L1 Module |
    63â†’
    64â†’### 0.2 å®æ–½ä¼˜å…ˆçº§ç¡®è®¤
    65â†’
    66â†’> **å‘½åè§„èŒƒ**: å‚è§ [GLOSSARY.md](../GLOSSARY.md)
    67â†’
    68â†’```mermaid
    69â†’graph TB
    70â†’    subgraph P0_Done["P0 å·²å®Œæˆ âœ…"]
    71â†’        direction LR
    72â†’        L[1. Loginé¡µé¢é‡æ„]
    73â†’        R[2. æ·±åº¦å…«å­—æŠ¥å‘Š]
    74â†’    end
    75â†’
    76â†’    subgraph P0_Fix["P0 å¿…é¡»ä¿®å¤ âš ï¸"]
    77â†’        C[3. å‰ç«¯ CSRF é—®é¢˜<br/>é˜»å¡æ‰€æœ‰ POST]
    78â†’    end
    79â†’
    80â†’    subgraph P1["P1 é«˜ä¼˜å…ˆçº§"]
    81â†’        direction LR
    82â†’        A[4. action_buttons]
    83â†’        P[5. æµ·æŠ¥å‰ç«¯]
    84â†’        S[6. Settings UI]
    85â†’    end
    86â†’
    87â†’    subgraph P2["P2 ä¸­ä¼˜å…ˆçº§"]
    88â†’        direction LR
    89â†’        K[7. Kçº¿ API+ç»„ä»¶]
    90â†’        M[8. åˆå¹¶ Tab]
    91â†’    end
    92â†’
    93â†’    P0_Done --> P0_Fix
    94â†’    P0_Fix --> P1
    95â†’    P1 --> P2
    96â†’
    97â†’    style P0_Done fill:#d4edda,stroke:#28a745
    98â†’    style P0_Fix fill:#f8d7da,stroke:#dc3545
    99â†’    style P1 fill:#fff3cd,stroke:#ffc107
   100â†’    style P2 fill:#cce5ff,stroke:#007bff
   101â†’```
   102â†’
   103â†’<details>
   104â†’<summary>ğŸ“‹ ASCII ç‰ˆæœ¬ (ç‚¹å‡»å±•å¼€)</summary>
   105â†’
   106â†’```
   107â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   108â†’â”‚                           å®æ–½ä¼˜å…ˆçº§çŸ©é˜µ                                      â”‚
   109â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   110â†’
   111â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   112â†’    â”‚  P0 å·²å®Œæˆ âœ…                                         â”‚
   113â†’    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   114â†’    â”‚  â”‚ 1. Loginé¡µé¢é‡æ„   â”‚  â”‚ 2. æ·±åº¦å…«å­—æŠ¥å‘Š         â”‚   â”‚
   115â†’    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   116â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   117â†’                                  â”‚
   118â†’                                  â–¼
   119â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   120â†’    â”‚  P0 å¿…é¡»ä¿®å¤ âš ï¸                                       â”‚
   121â†’    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   122â†’    â”‚  â”‚ 3. å‰ç«¯ CSRF é—®é¢˜ (é˜»å¡æ‰€æœ‰ POST è¯·æ±‚)        â”‚   â”‚
   123â†’    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   124â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   125â†’                                  â”‚
   126â†’                                  â–¼
   127â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   128â†’    â”‚  P1 é«˜ä¼˜å…ˆçº§                                          â”‚
   129â†’    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   130â†’    â”‚  â”‚ 4. action_   â”‚  â”‚ 5. æµ·æŠ¥å‰ç«¯    â”‚  â”‚ 6. Settingsâ”‚  â”‚
   131â†’    â”‚  â”‚    buttons   â”‚  â”‚    é›†æˆ       â”‚  â”‚    UI     â”‚  â”‚
   132â†’    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   133â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   134â†’                                  â”‚
   135â†’                                  â–¼
   136â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   137â†’    â”‚  P2 ä¸­ä¼˜å…ˆçº§                                          â”‚
   138â†’    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   139â†’    â”‚  â”‚ 7. Kçº¿ API + ç»„ä»¶    â”‚  â”‚ 8. åˆå¹¶çŠ¶æ€/è¶‹åŠ¿ Tab   â”‚ â”‚
   140â†’    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
   141â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   142â†’```
   143â†’</details>
   144â†’
   145â†’---
   146â†’
   147â†’## 0.5 Landing Page æ¨¡å—ï¼ˆDigital Mirrorï¼‰
   148â†’
   149â†’> **è¯¦ç»†è®¾è®¡**: å‚è§ [frontend_final_v3.md Â§7](./frontend_final_v3.md#7-landing-page-è®¾è®¡æ–¹æ¡ˆ)
   150â†’> **API è®¾è®¡**: å‚è§ [system_design_final_mvp_v3.md Â§7.0.1](./system_design_final_mvp_v3.md#701-landing-page-apiæ— éœ€ç™»å½•)
   151â†’
   152â†’### 0.5.1 è®¾è®¡ç†å¿µ
   153â†’
   154â†’Landing Page (`/`) æ˜¯ç”¨æˆ·çš„**ç¬¬ä¸€æ¥è§¦ç‚¹**ï¼Œä¸æ˜¯ä¼ ç»Ÿæ³¨å†Œé¡µé¢ï¼Œè€Œæ˜¯ä¸€åœº**"å¼€å¯å†…å¿ƒä¹‹æ—…çš„ä»ªå¼"**ã€‚
   155â†’
   156â†’| æ¦‚å¿µ | è¯´æ˜ |
   157â†’|------|------|
   158â†’| **Digital Mirror** | å±å¹•æ˜¯ä¸€é¢æ˜ ç…§ç”¨æˆ·å†…åœ¨ï¼ˆå‘½è¿/æ€§æ ¼/çŠ¶æ€ï¼‰çš„é•œå­ |
   159â†’| **Progressive Disclosure** | æ¸è¿›å¼æ­ç¤º â€” é€šè¿‡å¾®å°äº¤äº’é¡ºç†æˆç« å®Œæˆæ³¨å†Œ |
   160â†’| **Ethereal Intellectual** | Notion ç†æ€§æ’ç‰ˆ + ç¦…å®—ç•™ç™½ + æµä½“å…‰å½±åŠ¨æ•ˆ |
   161â†’
   162â†’### 0.5.2 ç”¨æˆ·æ—…ç¨‹ (4 Stages)
   163â†’
   164â†’```mermaid
   165â†’sequenceDiagram
   166â†’    autonumber
   167â†’    participant U as ç”¨æˆ·
   168â†’    participant FE as å‰ç«¯ /
   169â†’    participant API as FastAPI
   170â†’    participant L0 as L0 å…«å­—è„‘
   171â†’
   172â†’    rect rgb(240, 248, 255)
   173â†’        Note over U,FE: Stage 1: The Hero (åˆè§ Â· å‘¼å¸)
   174â†’        U->>FE: è®¿é—® Landing Page
   175â†’        FE->>FE: æ˜¾ç¤º Soul Orb (WebGL) + Input Capsule
   176â†’        FE->>FE: æ‰“å­—æœºè½®æ’­æç¤º
   177â†’    end
   178â†’
   179â†’    rect rgb(255, 248, 240)
   180â†’        Note over U,API: Stage 2: The Spark (è§¦åŠ¨ Â· å…±é¸£)
   181â†’        U->>FE: è¾“å…¥ç”Ÿæ—¥/æƒ…ç»ª
   182â†’        FE->>API: POST /api/landing/insight
   183â†’        API->>L0: å¿«é€Ÿè®¡ç®—æ—¥ä¸»äº”è¡Œ
   184â†’        L0-->>API: {element, insight}
   185â†’        API-->>FE: Instant Insight + Orb Colors
   186â†’        FE->>FE: Orb å˜è‰² + Insight Card å±•å¼€
   187â†’    end
   188â†’
   189â†’    rect rgb(248, 255, 240)
   190â†’        Note over U,FE: Stage 3: The Immersion (æ·±å…¥ Â· æ¶æ„)
   191â†’        U->>FE: å‘ä¸‹æ»šåŠ¨
   192â†’        FE->>FE: Orb åˆ†è§£ä¸º L0~L3 å››å±‚
   193â†’        FE->>FE: Parallax è§†å·®æ»šåŠ¨å±•ç¤ºæ¶æ„
   194â†’    end
   195â†’
   196â†’    rect rgb(255, 240, 248)
   197â†’        Note over U,FE: Stage 4: The Gateway (é—¨æ‰‰ Â· æ³¨å†Œ)
   198â†’        U->>FE: è¢« Insight å¸å¼• / æ»šåŠ¨åˆ°åº•éƒ¨
   199â†’        FE->>FE: æ˜¾ç¤º Split Layout (Insight + æ³¨å†Œè¡¨å•)
   200â†’        U->>FE: Google/Apple OAuth æˆ– Email æ³¨å†Œ
   201â†’        FE->>API: POST /api/auth/register
   202â†’        API-->>FE: è®¾ç½® Cookies
   203â†’        FE->>FE: Booting Sequence åŠ¨ç”» (2s)
   204â†’        FE->>FE: è·³è½¬ /new
   205â†’    end
   206â†’```
   207â†’
   208â†’<details>
   209â†’<summary>ğŸ“‹ ASCII ç‰ˆæœ¬ (ç‚¹å‡»å±•å¼€)</summary>
   210â†’
   211â†’```
   212â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   213â†’â”‚                     Landing Page ç”¨æˆ·æ—…ç¨‹ (4 Stages)                        â”‚
   214â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   215â†’
   216â†’Stage 1: The Hero (åˆè§ Â· å‘¼å¸)
   217â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   218â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   219â†’â”‚  â”‚                    Soul Orb (WebGL çµé­‚çƒä½“)                      â”‚   â”‚
   220â†’â”‚  â”‚                    éšé¼ æ ‡ç§»åŠ¨äº§ç”Ÿæå…‰å˜åŒ–                          â”‚   â”‚
   221â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   222â†’â”‚                                                                          â”‚
   223â†’â”‚          "Decode Your Destiny. Architect Your Soul."                     â”‚
   224â†’â”‚          An AI companion powered by Metaphysics & Psychology.            â”‚
   225â†’â”‚                                                                          â”‚
   226â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   227â†’â”‚  â”‚   Input Capsule: "Type your date of birth..."  (æ‰“å­—æœºè½®æ’­)      â”‚   â”‚
   228â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   229â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   230â†’                                    â†“ ç”¨æˆ·è¾“å…¥
   231â†’Stage 2: The Spark (è§¦åŠ¨ Â· å…±é¸£)
   232â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   233â†’â”‚  POST /api/landing/insight â†’ å¿«é€Ÿè®¡ç®—æ—¥ä¸»äº”è¡Œ                            â”‚
   234â†’â”‚                                                                          â”‚
   235â†’â”‚  â”Œâ”€ Orb å˜è‰² (äº”è¡Œå¯¹åº”è‰²) â”€â”  â”Œâ”€ Instant Insight Card (Glassmorphism) â”€â”â”‚
   236â†’â”‚  â”‚  æœ¨: #4ade80â†’#22c55e   â”‚  â”‚  ğŸŒ¿ Destiny Insight                    â”‚â”‚
   237â†’â”‚  â”‚  ç«: #f87171â†’#ef4444   â”‚  â”‚  "A strong Wood energy detected.       â”‚â”‚
   238â†’â”‚  â”‚  åœŸ: #fbbf24â†’#f59e0b   â”‚  â”‚   You seek growth, but feel restricted."â”‚â”‚
   239â†’â”‚  â”‚  é‡‘: #f5f5f4â†’#d6d3d1   â”‚  â”‚                                         â”‚â”‚
   240â†’â”‚  â”‚  æ°´: #60a5faâ†’#3b82f6   â”‚  â”‚  [Unlock Full Analysis â†’]              â”‚â”‚
   241â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   242â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   243â†’                                    â†“ å‘ä¸‹æ»šåŠ¨
   244â†’Stage 3: The Immersion (æ·±å…¥ Â· æ¶æ„)
   245â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   246â†’â”‚  çƒä½“åˆ†è§£ä¸ºå››å±‚ + Parallax è§†å·®æ»šåŠ¨                                       â”‚
   247â†’â”‚                                                                          â”‚
   248â†’â”‚  â”Œâ”€ L0 Â· Firmware â”€â”  "Ancient Wisdom grounded in data."                â”‚
   249â†’â”‚  â”Œâ”€ L1 Â· Schema â”€â”€â”€â”  "Psychological frameworks to measure happiness." â”‚
   250â†’â”‚  â”Œâ”€ L2 Â· Agents â”€â”€â”€â”  "Expert agents guiding your every step."         â”‚
   251â†’â”‚  â”Œâ”€ L3 Â· Synthesis â”  "A voice that truly understands you."            â”‚
   252â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   253â†’                                    â†“ è¢« Insight å¸å¼•
   254â†’Stage 4: The Gateway (é—¨æ‰‰ Â· æ³¨å†Œ)
   255â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   256â†’â”‚  â”Œâ”€ Left: Insight å¡ç‰‡ (æƒ…æ„Ÿé”šç‚¹) â”€â”  â”Œâ”€ Right: æ³¨å†Œè¡¨å• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   257â†’â”‚  â”‚  ğŸŒ¿ Destiny Insight             â”‚  â”‚  "Begin Your Journey"         â”‚ â”‚
   258â†’â”‚  â”‚  "A strong Wood energy..."      â”‚  â”‚                               â”‚ â”‚
   259â†’â”‚  â”‚                                 â”‚  â”‚  [Continue with Google]       â”‚ â”‚
   260â†’â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  [Continue with Apple]        â”‚ â”‚
   261â†’â”‚  â”‚  â”‚ Your destiny insights    â”‚ â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€ or â”€â”€â”€â”€â”€â”€â”€â”€          â”‚ â”‚
   262â†’â”‚  â”‚  â”‚ are waiting to be unlockedâ”‚ â”‚  â”‚  Email: [____________]        â”‚ â”‚
   263â†’â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  [Create Account]             â”‚ â”‚
   264â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
   265â†’â”‚                                                                          â”‚
   266â†’â”‚  â”Œâ”€ Booting Sequence (æ³¨å†ŒååŠ¨ç”» 2s) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   267â†’â”‚  â”‚  Loading L0 Data...        (å…«å­—è®¡ç®—ä¸­)                               â”‚â”‚
   268â†’â”‚  â”‚  Calibrating L1 Schema...  (å¿ƒç†æ¨¡å‹æ ¡å‡†ä¸­)                           â”‚â”‚
   269â†’â”‚  â”‚  Waking up Agents...       (å”¤é†’ä¸“å®¶æ™ºèƒ½ä½“)                           â”‚â”‚
   270â†’â”‚  â”‚  System Ready              â†’ è·³è½¬ /new                                â”‚â”‚
   271â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   272â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   273â†’```
   274â†’</details>
   275â†’
   276â†’### 0.5.3 Instant Insight API
   277â†’
   278â†’| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
   279â†’|------|------|------|
   280â†’| `/api/landing/insight` | POST | æ ¹æ®è¾“å…¥ç”Ÿæˆå³æ—¶æ´å¯Ÿ (æ— éœ€ç™»å½•) |
   281â†’
   282â†’**è¯·æ±‚/å“åº”**:
   283â†’
   284â†’```json
   285â†’// Request
   286â†’{ "input_type": "bazi", "value": "1995-08-20" }
   287â†’
   288â†’// Response
   289â†’{
   290â†’  "ok": true,
   291â†’  "data": {
   292â†’    "type": "bazi",
   293â†’    "insight": "A strong Wood energy detected. You seek growth, but feel restricted.",
   294â†’    "insight_cn": "æ£€æµ‹åˆ°å¼ºæœ¨èƒ½é‡ã€‚ä½ æ¸´æœ›ç”Ÿé•¿ï¼Œä½†æ„Ÿåˆ°å—é™ã€‚",
   295â†’    "orb_colors": ["#4ade80", "#22c55e"],
   296â†’    "element": "wood"
   297â†’  }
   298â†’}
   299â†’```
   300â†’
   301â†’### 0.5.4 æŠ€æœ¯ä¾èµ–
   302â†’
   303â†’| ä¾èµ– | ç”¨é€” |
   304â†’|------|------|
   305â†’| `@react-three/fiber` | WebGL Soul Orb æ¸²æŸ“ |
   306â†’| `@react-three/drei` | Three.js è¾…åŠ©å·¥å…· |
   307â†’| `framer-motion` | é¡µé¢åŠ¨ç”»ä¸è¿‡æ¸¡ |
   308â†’| `lenis` (å¯é€‰) | å¹³æ»‘æ»šåŠ¨ |
   309â†’
   310â†’### 0.5.5 ç»„ä»¶ç»“æ„
   311â†’
   312â†’```
   313â†’src/components/landing/
   314â†’â”œâ”€â”€ hero-section.tsx          # Stage 1: Hero
   315â†’â”œâ”€â”€ soul-orb.tsx              # WebGL çµé­‚çƒä½“ (React Three Fiber)
   316â†’â”œâ”€â”€ input-capsule.tsx         # è¾“å…¥èƒ¶å›Š (æ‰“å­—æœºæ•ˆæœ)
   317â†’â”œâ”€â”€ instant-insight-card.tsx  # Stage 2: Insight å¡ç‰‡ (Glassmorphism)
   318â†’â”œâ”€â”€ architecture-section.tsx  # Stage 3: æ¶æ„å±•ç¤º (Parallax)
   319â†’â”œâ”€â”€ gateway-section.tsx       # Stage 4: æ³¨å†Œå…¥å£
   320â†’â””â”€â”€ booting-sequence.tsx      # å¯åŠ¨ä»ªå¼åŠ¨ç”»
   321â†’```
   322â†’
   323â†’### 0.5.6 è§†è§‰è§„èŒƒ
   324â†’
   325â†’**è°ƒè‰²æ¿ (Landing Page Specific)**:
   326â†’
   327â†’```css
   328â†’:root {
   329â†’  /* Background */
   330â†’  --landing-bg: #F9F9F7;  /* Warm Paper */
   331â†’
   332â†’  /* Soul Orb Default */
   333â†’  --orb-from: #FFECD2;    /* Soft Peach */
   334â†’  --orb-to: #E0EAFC;      /* Mist Blue */
   335â†’
   336â†’  /* Glassmorphism */
   337â†’  --glass-bg: rgba(255, 255, 255, 0.6);
   338â†’  --glass-border: rgba(255, 255, 255, 0.4);
   339â†’  --glass-shadow: 0 20px 60px -15px rgba(0, 0, 0, 0.1);
   340â†’}
   341â†’```
   342â†’
   343â†’**äº”è¡Œé…è‰²æ˜ å°„**:
   344â†’
   345â†’| äº”è¡Œ | ä¸»è‰² | æ¸å˜è‰² |
   346â†’|------|------|--------|
   347â†’| æœ¨ (Wood) | `#4ade80` | `["#4ade80", "#22c55e"]` |
   348â†’| ç« (Fire) | `#f87171` | `["#f87171", "#ef4444"]` |
   349â†’| åœŸ (Earth) | `#fbbf24` | `["#fbbf24", "#f59e0b"]` |
   350â†’| é‡‘ (Metal) | `#f5f5f4` | `["#f5f5f4", "#d6d3d1"]` |
   351â†’| æ°´ (Water) | `#60a5fa` | `["#60a5fa", "#3b82f6"]` |
   352â†’
   353â†’---
   354â†’
   355â†’## 1. Login é¡µé¢æµç¨‹å›¾å¯¹æ¯”
   356â†’
   357â†’### 1.1 è®¾è®¡ç™»å½•æµç¨‹ (Mermaid æ—¶åºå›¾)
   358â†’
   359â†’```mermaid
   360â†’sequenceDiagram
   361â†’    autonumber
   362â†’    participant U as ç”¨æˆ·
   363â†’    participant FE as å‰ç«¯<br/>/new/register
   364â†’    participant API as FastAPI
   365â†’    participant L0 as L0 å…«å­—è„‘
   366â†’    participant DB as PostgreSQL
   367â†’
   368â†’    U->>FE: è®¿é—®æ³¨å†Œé¡µ
   369â†’    FE->>FE: æ˜¾ç¤º Tab [å…«å­—|ç´«å¾®|æ˜Ÿåº§]
   370â†’
   371â†’    U->>FE: é€‰æ‹©å…«å­— + è¾“å…¥å‡ºç”Ÿä¿¡æ¯
   372â†’    U->>FE: ç‚¹å‡» [ç”Ÿæˆé¢„è§ˆ]
   373â†’    FE->>API: POST /api/auth/preview
   374â†’    API->>L0: è®¡ç®—å…«å­— facts
   375â†’    L0-->>API: {å››æŸ±, äº”è¡Œ, æ—¥ä¸», èº«å¼º/å¼±}
   376â†’    API-->>FE: é¢„è§ˆæ•°æ®
   377â†’
   378â†’    FE->>FE: æ˜¾ç¤ºå‘½ç›˜å¯è§†åŒ–
   379â†’    FE->>API: POST /api/auth/validation-points
   380â†’    API->>L0: ç”Ÿæˆ 3 ä¸ªéªŒè¯ç‚¹
   381â†’    L0-->>API: ["ä½ æ˜¯ä¸æ˜¯ç»å¸¸...", ...]
   382â†’    API-->>FE: éªŒè¯ç‚¹åˆ—è¡¨
   383â†’
   384â†’    U->>FE: ç¡®è®¤éªŒè¯ç‚¹ "é‚£å°±æ˜¯æˆ‘"
   385â†’    U->>FE: å¡«å†™é‚®ç®±/å¯†ç  + ç‚¹å‡»æ³¨å†Œ
   386â†’    FE->>API: POST /api/auth/register
   387â†’    API->>DB: INSERT fortune_user
   388â†’    API->>DB: INSERT fortune_bazi_snapshot
   389â†’    API-->>FE: è®¾ç½® Cookies
   390â†’    FE->>FE: è·³è½¬ /new
   391â†’```
   392â†’
   393â†’<details>
   394â†’<summary>ğŸ“‹ ASCII ç‰ˆæœ¬ (ç‚¹å‡»å±•å¼€)</summary>
   395â†’
   396â†’```
   397â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   398â†’â”‚                       è®¾è®¡ç™»å½•æµç¨‹ (å®Œæ•´ç‰ˆ)                                   â”‚
   399â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   400â†’
   401â†’  ç”¨æˆ·      å‰ç«¯ /new/register      FastAPI         L0 å…«å­—è„‘      PostgreSQL
   402â†’   â”‚              â”‚                   â”‚                 â”‚              â”‚
   403â†’   â”‚â”€â”€[1]è®¿é—®â”€â”€â”€â”€â–¶â”‚                   â”‚                 â”‚              â”‚
   404â†’   â”‚              â”‚â”€â”€æ˜¾ç¤º Tab â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚              â”‚
   405â†’   â”‚              â”‚  [å…«å­—|ç´«å¾®|æ˜Ÿåº§]  â”‚                 â”‚              â”‚
   406â†’   â”‚              â”‚                   â”‚                 â”‚              â”‚
   407â†’   â”‚â”€â”€[2]é€‰æ‹©å…«å­—+â”‚                   â”‚                 â”‚              â”‚
   408â†’   â”‚  è¾“å…¥å‡ºç”Ÿä¿¡æ¯â”‚                   â”‚                 â”‚              â”‚
   409â†’   â”‚              â”‚                   â”‚                 â”‚              â”‚
   410â†’   â”‚â”€â”€[3]ç‚¹å‡»ç”Ÿæˆé¢„è§ˆâ”€â–¶â”‚              â”‚                 â”‚              â”‚
   411â†’   â”‚              â”‚â”€â”€POST /api/auth/previewâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚
   412â†’   â”‚              â”‚                   â”‚â”€â”€è®¡ç®—å…«å­— factsâ–¶â”‚              â”‚
   413â†’   â”‚              â”‚                   â”‚â—€â”€{å››æŸ±,äº”è¡Œ,æ—¥ä¸»}â”‚              â”‚
   414â†’   â”‚              â”‚â—€â”€â”€é¢„è§ˆæ•°æ®â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚              â”‚
   415â†’   â”‚              â”‚                   â”‚                 â”‚              â”‚
   416â†’   â”‚              â”‚â”€â”€æ˜¾ç¤ºå‘½ç›˜å¯è§†åŒ–â”€â”€â”€â”‚                 â”‚              â”‚
   417â†’   â”‚              â”‚â”€â”€POST /api/auth/validation-pointsâ”€â–¶â”‚              â”‚
   418â†’   â”‚              â”‚                   â”‚â”€â”€ç”Ÿæˆ3ä¸ªéªŒè¯ç‚¹â”€â–¶â”‚              â”‚
   419â†’   â”‚              â”‚â—€â”€â”€["ä½ æ˜¯ä¸æ˜¯ç»å¸¸..."]              â”‚              â”‚
   420â†’   â”‚              â”‚                   â”‚                 â”‚              â”‚
   421â†’   â”‚â”€â”€[4]ç¡®è®¤éªŒè¯ç‚¹"é‚£å°±æ˜¯æˆ‘"         â”‚                 â”‚              â”‚
   422â†’   â”‚              â”‚                   â”‚                 â”‚              â”‚
   423â†’   â”‚â”€â”€[5]å¡«å†™é‚®ç®±/å¯†ç  + æ³¨å†Œâ”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚              â”‚
   424â†’   â”‚              â”‚â”€â”€POST /api/auth/registerâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   425â†’   â”‚              â”‚                   â”‚â”€â”€INSERT fortune_userâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   426â†’   â”‚              â”‚                   â”‚â”€â”€INSERT bazi_snapshotâ”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   427â†’   â”‚              â”‚â—€â”€â”€è®¾ç½® Cookiesâ”€â”€â”€â”€â”‚                 â”‚              â”‚
   428â†’   â”‚              â”‚â”€â”€è·³è½¬ /newâ”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚              â”‚
   429â†’   â”‚              â”‚                   â”‚                 â”‚              â”‚
   430â†’```
   431â†’</details>
   432â†’
   433â†’**è®¾è®¡é¡µé¢å¸ƒå±€**:
   434â†’
   435â†’| åŒºåŸŸ | å†…å®¹ |
   436â†’|------|------|
   437â†’| é¡¶éƒ¨ | Tab [å…«å­—] [ç´«å¾®] [æ˜Ÿåº§] |
   438â†’| å·¦æ  | å‡ºç”Ÿä¿¡æ¯è¡¨å• + éªŒè¯ç‚¹å¡ç‰‡ + æ³¨å†Œè¡¨å• |
   439â†’| å³æ  | å‘½ç›˜å¯è§†åŒ– + é¢„è§ˆæ•°æ® |
   440â†’
   441â†’### 1.2 å½“å‰å®ç°ç™»å½•æµç¨‹
   442â†’
   443â†’```mermaid
   444â†’sequenceDiagram
   445â†’    autonumber
   446â†’    participant U as ç”¨æˆ·
   447â†’    participant FE as å‰ç«¯<br/>/new/register
   448â†’    participant API as FastAPI
   449â†’    participant DB as PostgreSQL
   450â†’
   451â†’    U->>FE: è®¿é—®æ³¨å†Œé¡µ
   452â†’    FE->>FE: æ˜¾ç¤ºç®€åŒ–è¡¨å•<br/>(æ—  Tab)
   453â†’
   454â†’    U->>FE: å¡«å†™å…¨éƒ¨ä¿¡æ¯<br/>(é‚®ç®±+å¯†ç +å‡ºç”Ÿ)
   455â†’    U->>FE: ç‚¹å‡» [æ³¨å†Œ]
   456â†’    FE->>API: POST /api/auth/register
   457â†’    API->>DB: INSERT fortune_user
   458â†’    API-->>FE: è®¾ç½® Cookies
   459â†’    FE->>FE: è·³è½¬ /new
   460â†’
   461â†’    Note right of FE: âš ï¸ ç¼ºå°‘é¢„è§ˆ/éªŒè¯ç‚¹
   462â†’```
   463â†’
   464â†’<details>
   465â†’<summary>ğŸ“‹ ASCII ç‰ˆæœ¬ (ç‚¹å‡»å±•å¼€)</summary>
   466â†’
   467â†’```
   468â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   469â†’â”‚                       å½“å‰å®ç°ç™»å½•æµç¨‹ (ç®€åŒ–ç‰ˆ)                               â”‚
   470â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   471â†’
   472â†’  ç”¨æˆ·      å‰ç«¯ /new/register      FastAPI         PostgreSQL
   473â†’   â”‚              â”‚                   â”‚                 â”‚
   474â†’   â”‚â”€â”€[1]è®¿é—®â”€â”€â”€â”€â–¶â”‚                   â”‚                 â”‚
   475â†’   â”‚              â”‚â”€â”€æ˜¾ç¤ºç®€åŒ–è¡¨å•â”€â”€â”€â”€â”€â”€â”‚                 â”‚
   476â†’   â”‚              â”‚  (æ—  Tab åˆ‡æ¢)     â”‚                 â”‚
   477â†’   â”‚              â”‚                   â”‚                 â”‚
   478â†’   â”‚â”€â”€[2]å¡«å†™å…¨éƒ¨ä¿¡æ¯â”€â–¶â”‚              â”‚                 â”‚
   479â†’   â”‚  (é‚®ç®±+å¯†ç +å‡ºç”Ÿ)â”‚               â”‚                 â”‚
   480â†’   â”‚              â”‚                   â”‚                 â”‚
   481â†’   â”‚â”€â”€[3]ç‚¹å‡»æ³¨å†Œâ”€â”€â–¶â”‚                 â”‚                 â”‚
   482â†’   â”‚              â”‚â”€â”€POST /api/auth/registerâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   483â†’   â”‚              â”‚                   â”‚â”€â”€INSERT userâ”€â”€â–¶â”‚
   484â†’   â”‚              â”‚â—€â”€â”€è®¾ç½® Cookiesâ”€â”€â”€â”€â”‚                 â”‚
   485â†’   â”‚              â”‚â”€â”€è·³è½¬ /newâ”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
   486â†’   â”‚              â”‚                   â”‚                 â”‚
   487â†’   â”‚              â”‚  âš ï¸ ç¼ºå°‘é¢„è§ˆ      â”‚                 â”‚
   488â†’   â”‚              â”‚  âš ï¸ ç¼ºå°‘éªŒè¯ç‚¹    â”‚                 â”‚
   489â†’   â”‚              â”‚                   â”‚                 â”‚
   490â†’```
   491â†’</details>
   492â†’
   493â†’**å®ç°çŠ¶æ€**:
   494â†’
   495â†’| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
   496â†’|------|:----:|------|
   497â†’| åŸºç¡€æ³¨å†Œè¡¨å• | âœ… | é‚®ç®±/å¯†ç /æ˜µç§°/æ€§åˆ« |
   498â†’| å‡ºç”Ÿä¿¡æ¯è¾“å…¥ | âœ… | æ—¥æœŸ/æ—¶é—´/æ—¶åŒº/åœ°ç‚¹ |
   499â†’| Tab åˆ‡æ¢ | âš ï¸ | å…«å­—/ç´«å¾®/æ˜Ÿåº§ æœªå®ç° |
   500â†’| éªŒè¯ç‚¹ç”Ÿæˆ | âš ï¸ | `/api/auth/validation-points` å¾…å®ç° |
   501â†’| å‘½ç›˜é¢„è§ˆ | âš ï¸ | å¯è§†åŒ–ç»„ä»¶æœªå®ç° |
   502â†’
   503â†’### 1.3 æœ€ä¼˜ç™»å½•æµç¨‹ (æ¸è¿›å¼æ³¨å†Œ)
   504â†’
   505â†’```mermaid
   506â†’stateDiagram-v2
   507â†’    [*] --> Step1_Birth: è®¿é—® /new/register
   508â†’
   509â†’    state Step1_Birth {
   510â†’        direction LR
   511â†’        SelectTab: é€‰æ‹© [å…«å­—|ç´«å¾®|æ˜Ÿåº§]
   512â†’        InputBirth: è¾“å…¥å‡ºç”Ÿä¿¡æ¯
   513â†’        Preview: ç‚¹å‡» [ç”Ÿæˆé¢„è§ˆ]
   514â†’        SelectTab --> InputBirth
   515â†’        InputBirth --> Preview
   516â†’    }
   517â†’
   518â†’    Step1_Birth --> Step2_Validate: é¢„è§ˆæˆåŠŸ
   519â†’
   520â†’    state Step2_Validate {
   521â†’        direction LR
   522â†’        ShowChart: æ˜¾ç¤ºå‘½ç›˜å¯è§†åŒ–
   523â†’        ShowPoints: æ˜¾ç¤º 3 ä¸ªéªŒè¯ç‚¹
   524â†’        Confirm: ç”¨æˆ·ç¡®è®¤ "é‚£å°±æ˜¯æˆ‘"
   525â†’        ShowChart --> ShowPoints
   526â†’        ShowPoints --> Confirm
   527â†’    }
   528â†’
   529â†’    Step2_Validate --> Step3_Account: éªŒè¯ç‚¹ç¡®è®¤
   530â†’
   531â†’    state Step3_Account {
   532â†’        direction LR
   533â†’        ShowSuccess: "å…«å­—ç‰¹å¾å·²è¯†åˆ«"
   534â†’        InputAccount: å¡«å†™é‚®ç®±/å¯†ç 
   535â†’        Register: [åˆ›å»ºè´¦å·å¹¶ä¿å­˜]
   536â†’        ShowSuccess --> InputAccount
   537â†’        InputAccount --> Register
   538â†’    }
   539â†’
   540â†’    Step3_Account --> [*]: æ³¨å†ŒæˆåŠŸ â†’ /new
   541â†’```
   542â†’
   543â†’<details>
   544â†’<summary>ğŸ“‹ ASCII ç‰ˆæœ¬ (ç‚¹å‡»å±•å¼€)</summary>
   545â†’
   546â†’```
   547â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   548â†’â”‚                      æœ€ä¼˜ç™»å½•æµç¨‹ (æ¸è¿›å¼æ³¨å†Œ)                                 â”‚
   549â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   550â†’
   551â†’                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   552â†’                              â”‚  å¼€å§‹    â”‚
   553â†’                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   554â†’                                   â”‚ è®¿é—® /new/register
   555â†’                                   â–¼
   556â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   557â†’â”‚ Step 1: å‡ºç”Ÿä¿¡æ¯                                                             â”‚
   558â†’â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
   559â†’â”‚ â”‚ é€‰æ‹© Tab        â”‚â”€â”€â”€â–¶â”‚ è¾“å…¥å‡ºç”Ÿä¿¡æ¯    â”‚â”€â”€â”€â–¶â”‚ ç‚¹å‡» [ç”Ÿæˆé¢„è§ˆ] â”‚           â”‚
   560â†’â”‚ â”‚ [å…«å­—|ç´«å¾®|æ˜Ÿåº§]â”‚    â”‚ æ—¥æœŸ/æ—¶é—´/åœ°ç‚¹  â”‚    â”‚                 â”‚           â”‚
   561â†’â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
   562â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   563â†’                                  â”‚ é¢„è§ˆæˆåŠŸ
   564â†’                                  â–¼
   565â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   566â†’â”‚ Step 2: éªŒè¯ç‚¹ç¡®è®¤                                                           â”‚
   567â†’â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
   568â†’â”‚ â”‚ æ˜¾ç¤ºå‘½ç›˜å¯è§†åŒ–  â”‚â”€â”€â”€â–¶â”‚ æ˜¾ç¤º 3 ä¸ªéªŒè¯ç‚¹ â”‚â”€â”€â”€â–¶â”‚ ç¡®è®¤"é‚£å°±æ˜¯æˆ‘"  â”‚           â”‚
   569â†’â”‚ â”‚ å››æŸ±+äº”è¡Œé›·è¾¾   â”‚    â”‚ "ä½ æ˜¯ä¸æ˜¯..."   â”‚    â”‚                 â”‚           â”‚
   570â†’â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
   571â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   572â†’                                  â”‚ éªŒè¯ç‚¹ç¡®è®¤
   573â†’                                  â–¼
   574â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   575â†’â”‚ Step 3: åˆ›å»ºè´¦å·                                                             â”‚
   576â†’â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
   577â†’â”‚ â”‚ "å…«å­—ç‰¹å¾å·²è¯†åˆ«"â”‚â”€â”€â”€â–¶â”‚ å¡«å†™é‚®ç®±/å¯†ç    â”‚â”€â”€â”€â–¶â”‚ [åˆ›å»ºè´¦å·å¹¶ä¿å­˜]â”‚           â”‚
   578â†’â”‚ â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚           â”‚
   579â†’â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
   580â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   581â†’                                  â”‚ æ³¨å†ŒæˆåŠŸ
   582â†’                                  â–¼
   583â†’                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   584â†’                              â”‚ è·³è½¬ /newâ”‚
   585â†’                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   586â†’```
   587â†’</details>
   588â†’
   589â†’**ä¼˜åŒ–è¦ç‚¹**:
   590â†’
   591â†’| ä¼˜å…ˆçº§ | æ”¹è¿›é¡¹ | è¯´æ˜ |
   592â†’|:------:|--------|------|
   593â†’| P1 | `/api/auth/validation-points` | åŸºäº L0 facts ç”Ÿæˆ 3 ä¸ªéªŒè¯é—®é¢˜ |
   594â†’| P1 | å‘½ç›˜é¢„è§ˆç»„ä»¶ | å››æŸ± + äº”è¡Œé›·è¾¾å›¾ |
   595â†’| P2 | Tab åˆ‡æ¢ | å…«å­—/ç´«å¾®/æ˜Ÿåº§ æ¨¡å¼é€‰æ‹© |
   596â†’| P2 | æ¸è¿›å¼è¡¨å• | åˆ† 3 æ­¥æ”¶é›†ä¿¡æ¯ï¼Œé™ä½æµå¤± |
   597â†’
   598â†’---
   599â†’
   600â†’## 2. å¯¹è¯ç³»ç»Ÿæµç¨‹å›¾å¯¹æ¯”
   601â†’
   602â†’> **A2UI ç±»å‹å®šä¹‰**: å‚è§ [GLOSSARY.md](../GLOSSARY.md) Â§4
   603â†’> **æ¶æ„å±‚æ¬¡**: v4.0 åŒè·¯å¾„è®¾è®¡ (Hot Path + Cold Path)
   604â†’> **v4.1 æ–°å¢**: Skills & Command Protocol æ”¯æŒ `/command` å¿«æ·æŒ‡ä»¤
   605â†’
   606â†’### 2.0 äº¤äº’æ¨¡å¼ (v4.2 Vercel AI SDK)
   607â†’
   608â†’å¯¹è¯ç³»ç»ŸåŸºäº Vercel AI SDK çš„ `useChat()` Hook å®ç°ï¼Œæ”¯æŒä¸¤ç§äº¤äº’æ¨¡å¼ï¼š
   609â†’
   610â†’| æ¨¡å¼ | è§¦å‘æ–¹å¼ | æŠ€æœ¯å®ç° | å…¸å‹åœºæ™¯ |
   611â†’|------|----------|----------|----------|
   612â†’| **Chat Mode** | è‡ªç„¶è¯­è¨€è¾“å…¥ | `streamText()` æš´éœ²æ‰€æœ‰ Toolsï¼ŒLLM è‡ªè¡Œé€‰æ‹© | æ—¥å¸¸å¯¹è¯ã€é—®é¢˜å’¨è¯¢ |
   613â†’| **Command Mode** | `/cmd` æŒ‡ä»¤è¾“å…¥ | `getToolsForMode(command)` ç­›é€‰ Tools + System Prompt æ³¨å…¥ | ç²¾ç¡®åŠŸèƒ½è§¦å‘ |
   614â†’
   615â†’**å¯ç”¨æŒ‡ä»¤ä¸ Tool æ˜ å°„**:
   616â†’
   617â†’| æŒ‡ä»¤ | æè¿° | ç­›é€‰ Tools | Python API |
   618â†’|------|------|------------|------------|
   619â†’| `/divine` | ç„å­¦æµ‹ç®— | `calculate_bazi`, `calculate_ziwei`, `astro_chart` | `/api/bazi/*` |
   620â†’| `/heal` | å¿ƒç†ç–—æ„ˆ | `log_perma`, `cbt_reframe`, `mood_checkin` | `/api/perma/*`, `/api/checkin/*` |
   621â†’| `/grow` | æˆé•¿æ•™ç»ƒ | `goal_setting`, `covey_matrix` | `/api/goals/*`, `/api/tasks/*` |
   622â†’| `/status` | çŠ¶æ€æŸ¥çœ‹ | `log_perma` (query mode) | `/api/dashboard/status` |
   623â†’| `/help` | å¸®åŠ©åˆ—è¡¨ | - (å‰ç«¯æœ¬åœ°å¤„ç†) | - |
   624â†’
   625â†’**v4.2 Tool æ‰§è¡Œæµç¨‹**:
   626â†’
   627â†’```
   628â†’useChat() â†’ POST /api/chat â†’ streamText({tools}) â†’ LLM å†³å®šè°ƒç”¨ Tool
   629â†’                                    â†“
   630â†’                             tool.execute() â†’ fetch(Python API) â†’ è¿”å›ç»“æœ
   631â†’                                    â†“
   632â†’                             toDataStreamResponse() â†’ å‰ç«¯æ¸²æŸ“ ToolResultCard
   633â†’```
   634â†’
   635â†’> **è¯¦ç»†è®¾è®¡**: å‚è§ [os_design_v3.md Â§1.5](./os_design_v3.md#15-agent-runtime--skills-vercel-ai-sdk-implementation---v42)
   636â†’
   637â†’### 2.1 è®¾è®¡å¯¹è¯æµç¨‹ (v4.0 Evolutionary Memory)
   638â†’
   639â†’å¯¹è¯ç³»ç»ŸåŸºäº v4.0 åŒè·¯å¾„æ¶æ„è¿ä½œï¼š
   640â†’
   641â†’```
   642â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   643â†’â”‚                        Hot Path (åŒæ­¥ï¼Œ<2s)                                â”‚
   644â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   645â†’â”‚                                                                           â”‚
   646â†’â”‚  ç”¨æˆ·è¾“å…¥ â†’ Context Manager v4.0 ç»„è£…ä¸Šä¸‹æ–‡                               â”‚
   647â†’â”‚              [L0(Status) + L1(Module) + Vector(History) + Input]          â”‚
   648â†’â”‚                            â†“                                              â”‚
   649â†’â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                       â”‚
   650â†’â”‚                     â†“             â†“                                       â”‚
   651â†’â”‚               L2 Expert      L2 Style                                     â”‚
   652â†’â”‚               (å…«å­—/CBT)     (warm/roast)                                 â”‚
   653â†’â”‚                     â†“             â†“                                       â”‚
   654â†’â”‚                     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
   655â†’â”‚                            â†“                                              â”‚
   656â†’â”‚               Interaction Layer (GLM/Gemini)                              â”‚
   657â†’â”‚                            â†“                                              â”‚
   658â†’â”‚                     A2UI JSON è¾“å‡º                                        â”‚
   659â†’â”‚                                                                           â”‚
   660â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   661â†’                            â”‚
   662â†’                            â”‚ å¼‚æ­¥æŠ•é€’
   663â†’                            â–¼
   664â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   665â†’â”‚                        Cold Path (å¼‚æ­¥ï¼Œåå°)                              â”‚
   666â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   667â†’â”‚                                                                           â”‚
   668â†’â”‚  å¯¹è¯è®°å½• â†’ Insight & Memory Agent åˆ†æ                                   â”‚
   669â†’â”‚              [æå–äº‹å®/åå¥½/æƒ…ç»ª/ä»»åŠ¡å®Œæˆ]                                 â”‚
   670â†’â”‚                            â†“                                              â”‚
   671â†’â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
   672â†’â”‚                    â†“               â†“                                      â”‚
   673â†’â”‚             L1 Module Data    L0 Base Data                                â”‚
   674â†’â”‚             (PERMA/Covey)     (Tags/Status)                               â”‚
   675â†’â”‚               â†‘ Write Back      â†‘ Write Back                              â”‚
   676â†’â”‚                                                                           â”‚
   677â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   678â†’```
   679â†’
   680â†’**æ ¸å¿ƒä»·å€¼**: Soul OS è¶Šç”¨è¶Šæ‡‚ç”¨æˆ·ï¼Œè¶Šç”¨æ•°æ®è¶Šåš
   681â†’
   682â†’### 2.2 å››å±‚æ¶æ„æ—¶åºå›¾ âš ï¸ LEGACY
   683â†’
   684â†’> **âš ï¸ å†å²å‚è€ƒ**: æ­¤èŠ‚ä½¿ç”¨ v2 å››å±‚æœ¯è¯­ï¼Œä¿ç•™ä½œä¸ºå¯¹è¯æ—¶åºçš„å‚è€ƒã€‚
   685â†’> **âœ… v4.0 æ¶æ„** (å‚è§ [os_design_v3.md Â§1.4](os_design_v3.md#14-è¿›åŒ–è®°å¿†æ¶æ„-evolutionary-memory-view---v40)):
   686â†’> - L0æ•°å­¦è„‘ â†’ L0 Base Data (å¯åå†™)
   687â†’> - L1å¿ƒç†è„‘ â†’ L1 Module Data (å¯åå†™)
   688â†’> - L2çŸ¥è¯†è„‘ â†’ L2 Expert Agents
   689â†’> - L3è¯­è¨€è„‘ â†’ Context Manager v4.0 + Interaction Layer
   690â†’> - **æ–°å¢**: Insight Agent (Cold Path æ•°æ®åå†™)
   691â†’
   692â†’```mermaid
   693â†’sequenceDiagram
   694â†’    autonumber
   695â†’    participant U as ç”¨æˆ·
   696â†’    participant FE as Zone A
   697â†’    participant API as FastAPI
   698â†’    participant L0 as L0 æ•°å­¦è„‘
   699â†’    participant L1 as L1 å¿ƒç†è„‘
   700â†’    participant L2 as L2 çŸ¥è¯†è„‘
   701â†’    participant L3 as L3 è¯­è¨€è„‘
   702â†’    participant DB as PostgreSQL
   703â†’
   704â†’    U->>FE: è¾“å…¥æ¶ˆæ¯
   705â†’    FE->>API: POST /api/chat/send
   706â†’
   707â†’    rect rgb(240, 248, 255)
   708â†’        Note over API,L2: Context æ„å»º
   709â†’        API->>L0: è·å–å…«å­— facts
   710â†’        L0-->>API: {æ—¥ä¸», äº”è¡Œ, å½“å‰è¿åŠ¿}
   711â†’        API->>L1: è·å– PERMA + æ´»è·ƒç›®æ ‡
   712â†’        L1-->>API: {state_score, active_goals}
   713â†’        API->>L2: RAG çŸ¥è¯†æ£€ç´¢
   714â†’        L2-->>API: {kb_refs, rule_ids}
   715â†’    end
   716â†’
   717â†’    rect rgb(255, 248, 240)
   718â†’        Note over API,L3: GLM ç”Ÿæˆ
   719â†’        API->>L3: prompt + context
   720â†’        L3-->>API: A2UI JSON
   721â†’    end
   722â†’
   723â†’    API->>DB: INSERT conversation_message
   724â†’    API-->>FE: A2UI å“åº”
   725â†’
   726â†’    FE->>FE: æ¸²æŸ“ markdown_text
   727â†’    FE->>FE: æ¸²æŸ“ If-Then å¤„æ–¹
   728â†’    FE->>FE: æ¸²æŸ“ action_buttons
   729â†’```
   730â†’
   731â†’<details>
   732â†’<summary>ğŸ“‹ ASCII ç‰ˆæœ¬ (ç‚¹å‡»å±•å¼€)</summary>
   733â†’
   734â†’```
   735â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   736â†’â”‚                         å¯¹è¯ç³»ç»Ÿå››å±‚æ¶æ„æµç¨‹                                      â”‚
   737â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   738â†’
   739â†’  ç”¨æˆ·    Zone A     FastAPI      L0æ•°å­¦è„‘    L1å¿ƒç†è„‘    L2çŸ¥è¯†è„‘   L3è¯­è¨€è„‘    DB
   740â†’   â”‚        â”‚           â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   741â†’   â”‚â”€â”€è¾“å…¥â”€â–¶â”‚           â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   742â†’   â”‚        â”‚â”€â”€POST â”€â”€â”€â–¶â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   743â†’   â”‚        â”‚ chat/send â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   744â†’   â”‚        â”‚           â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   745â†’   â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•
   746â†’   â”‚        â”‚           â”‚  Context æ„å»º (L0-L2)  â”‚           â”‚          â”‚        â”‚
   747â†’   â”‚        â”‚           â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   748â†’   â”‚        â”‚           â”‚â”€â”€è·å–factsâ”€â–¶â”‚          â”‚           â”‚          â”‚        â”‚
   749â†’   â”‚        â”‚           â”‚â—€â”€{æ—¥ä¸»,äº”è¡Œ}â”‚          â”‚           â”‚          â”‚        â”‚
   750â†’   â”‚        â”‚           â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   751â†’   â”‚        â”‚           â”‚â”€â”€è·å–PERMAâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚          â”‚          â”‚        â”‚
   752â†’   â”‚        â”‚           â”‚â—€â”€{state_score,goals}â”€â”€â”€â”‚          â”‚          â”‚        â”‚
   753â†’   â”‚        â”‚           â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   754â†’   â”‚        â”‚           â”‚â”€â”€RAGæ£€ç´¢â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚         â”‚        â”‚
   755â†’   â”‚        â”‚           â”‚â—€â”€{kb_refs,rule_ids}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚        â”‚
   756â†’   â”‚        â”‚           â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   757â†’   â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•
   758â†’   â”‚        â”‚           â”‚  GLM ç”Ÿæˆ (L3)         â”‚           â”‚          â”‚        â”‚
   759â†’   â”‚        â”‚           â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   760â†’   â”‚        â”‚           â”‚â”€â”€prompt + contextâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚        â”‚
   761â†’   â”‚        â”‚           â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€A2UI JSON â”€â”€â”€â”€â”‚        â”‚
   762â†’   â”‚        â”‚           â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   763â†’   â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•
   764â†’   â”‚        â”‚           â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   765â†’   â”‚        â”‚           â”‚â”€â”€INSERT conversation_messageâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   766â†’   â”‚        â”‚â—€â”€A2UIå“åº”â”€â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   767â†’   â”‚        â”‚           â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   768â†’   â”‚        â”‚â”€â”€æ¸²æŸ“ markdown_text    â”‚           â”‚           â”‚          â”‚        â”‚
   769â†’   â”‚        â”‚â”€â”€æ¸²æŸ“ If-Then å¤„æ–¹     â”‚           â”‚           â”‚          â”‚        â”‚
   770â†’   â”‚        â”‚â”€â”€æ¸²æŸ“ action_buttons   â”‚           â”‚           â”‚          â”‚        â”‚
   771â†’   â”‚        â”‚           â”‚            â”‚           â”‚           â”‚          â”‚        â”‚
   772â†’```
   773â†’</details>
   774â†’
   775â†’**A2UI è¾“å‡ºç»“æ„ï¼ˆv4.0/v4.1 Legacyï¼‰**:
   776â†’
   777â†’```json
   778â†’{
   779â†’  "blocks": [
   780â†’    {"type": "markdown_text", "data": "### åˆ†æç»“æœ\nä½ çš„æ—¥ä¸»æ˜¯ç”²æœ¨..."},
   781â†’    {"type": "markdown_text", "data": "### è¡ŒåŠ¨å¤„æ–¹\n**å¦‚æœ**ä½ æ„Ÿåˆ°å†³ç­–ç„¦è™‘...\n**é‚£ä¹ˆ**..."},
   782â†’    {"type": "action_buttons", "data": [
   783â†’      {"label": "ç°åœ¨å¼€å§‹", "action": {"type": "start_task", "task_id": "xxx"}},
   784â†’      {"label": "åŠ å…¥è®¡åˆ’", "action": {"type": "schedule_task", "task_id": "xxx"}},
   785â†’      {"label": "æš‚ä¸æ‰§è¡Œ", "action": {"type": "opt_out"}}
   786â†’    ]}
   787â†’  ]
   788â†’}
   789â†’```
   790â†’
   791â†’> **v4.2 è¿ç§»**: A2UI å°†è¿ç§»ä¸º ToolResultCard æ¨¡å¼ï¼Œè¯¦è§ [backend_refactoring_plan_v42.md Â§2.5](./backend_refactoring_plan_v42.md#25-a2ui-è¿ç§»æ–¹æ¡ˆtoolresultcard)
   792â†’
   793â†’**v4.2 ç›®æ ‡ç»“æ„ï¼ˆToolResultCardï¼‰**:
   794â†’
   795â†’```typescript
   796â†’// assistant message
   797â†’{
   798â†’  role: 'assistant',
   799â†’  content: 'æ ¹æ®ä½ çš„å…«å­—ï¼Œä½ çš„æ—¥ä¸»æ˜¯ç”²æœ¨...',  // æ•™ç»ƒè¡¨è¾¾
   800â†’  toolInvocations: [{
   801â†’    toolName: 'calculate_bazi',
   802â†’    state: 'result',
   803â†’    result: {
   804â†’      type: 'a2ui_card',
   805â†’      card_type: 'bazi_chart',
   806â†’      data: { /* ç»“æ„åŒ–æ•°æ® */ },
   807â†’      actions: [
   808â†’        { type: 'accept', label: 'ç°åœ¨å¼€å§‹', endpoint: '/api/dashboard/task/accept' },
   809â†’        { type: 'skip', label: 'æš‚ä¸æ‰§è¡Œ' }
   810â†’      ]
   811â†’    }
   812â†’  }]
   813â†’}
   814â†’```
   815â†’
   816â†’**ActionButton çº¦æŸ**ï¼šaction.type åªèƒ½æ˜ å°„åˆ° SSOT çŠ¶æ€æœºç«¯ç‚¹ï¼š
   817â†’- `accept` â†’ `POST /api/dashboard/task/accept`
   818â†’- `done` â†’ `POST /api/dashboard/task/done`
   819â†’- `skip` â†’ `POST /api/dashboard/task/skip`
   820â†’- `checkin` â†’ `POST /api/dashboard/checkin`
   821â†’- `navigate` â†’ å‰ç«¯è·¯ç”±ï¼ˆæ— å†™æ“ä½œï¼‰
   822â†’
   823â†’### 2.2 å½“å‰å®ç° (é—®é¢˜åˆ†æ)
   824â†’
   825â†’```mermaid
   826â†’sequenceDiagram
   827â†’    autonumber
   828â†’    participant U as ç”¨æˆ·
   829â†’    participant FE as Zone A
   830â†’    participant API as FastAPI
   831â†’
   832â†’    U->>FE: ç‚¹å‡» action_button
   833â†’    FE->>API: POST /api/dashboard/task/accept
   834â†’
   835â†’    Note right of FE: âš ï¸ ç¼ºå°‘ X-CSRF-Token
   836â†’    API-->>FE: 403 csrf_invalid
   837â†’
   838â†’    Note right of FE: âš ï¸ æ— é”™è¯¯ toast
   839â†’    Note right of FE: âš ï¸ Zone B ä¸åˆ·æ–°
   840â†’```
   841â†’
   842â†’<details>
   843â†’<summary>ğŸ“‹ ASCII ç‰ˆæœ¬ (ç‚¹å‡»å±•å¼€)</summary>
   844â†’
   845â†’```
   846â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   847â†’â”‚                    å½“å‰å®ç°é—®é¢˜ (action_button)                              â”‚
   848â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   849â†’
   850â†’  ç”¨æˆ·           Zone A           FastAPI
   851â†’   â”‚               â”‚                 â”‚
   852â†’   â”‚â”€â”€ç‚¹å‡»â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
   853â†’   â”‚  action_buttonâ”‚                 â”‚
   854â†’   â”‚               â”‚                 â”‚
   855â†’   â”‚               â”‚â”€â”€POST /api/dashboard/task/accept
   856â†’   â”‚               â”‚                 â”‚
   857â†’   â”‚               â”‚  âš ï¸ ç¼ºå°‘ X-CSRF-Token
   858â†’   â”‚               â”‚                 â”‚
   859â†’   â”‚               â”‚â—€â”€â”€403 csrf_invalid
   860â†’   â”‚               â”‚                 â”‚
   861â†’   â”‚               â”‚  âš ï¸ æ— é”™è¯¯ toastâ”‚
   862â†’   â”‚               â”‚  âš ï¸ Zone B ä¸åˆ·æ–°
   863â†’   â”‚               â”‚                 â”‚
   864â†’```
   865â†’</details>
   866â†’
   867â†’**é—®é¢˜æ¸…å•**:
   868â†’
   869â†’| é—®é¢˜ | ä½ç½® | å½±å“ | æ ¹å›  |
   870â†’|------|------|------|------|
   871â†’| CSRF æœªä¼ é€’ | `lib/api.ts` | POST å¤±è´¥ | æœªè¯»å– `fortune_csrf` cookie |
   872â†’| æ— é”™è¯¯åé¦ˆ | `blocks/index.tsx` | ç”¨æˆ·å›°æƒ‘ | æ—  try-catch + toast |
   873â†’| Zone B ä¸åˆ·æ–° | å…¨å±€ | éœ€æ‰‹åŠ¨åˆ·æ–° | æ—  store é€šçŸ¥æœºåˆ¶ |
   874â†’
   875â†’### 2.3 æœ€ä¼˜æ–¹æ¡ˆ (action å¤„ç†æ—¶åº)
   876â†’
   877â†’```mermaid
   878â†’sequenceDiagram
   879â†’    autonumber
   880â†’    participant U as ç”¨æˆ·
   881â†’    participant Btn as ActionButton
   882â†’    participant Client as api-client.ts
   883â†’    participant API as FastAPI
   884â†’    participant Store as Zustand
   885â†’    participant ZoneB as Zone B
   886â†’    participant Toast as Toast
   887â†’
   888â†’    U->>Btn: ç‚¹å‡» "ç°åœ¨å¼€å§‹"
   889â†’    Btn->>Btn: setLoading(true)
   890â†’    Btn->>Client: handleAction({type: 'start_task'})
   891â†’    Client->>Client: getCSRFToken()
   892â†’    Client->>API: POST /api/dashboard/task/accept<br/>+ X-CSRF-Token
   893â†’
   894â†’    alt æˆåŠŸ
   895â†’        API-->>Client: {ok: true}
   896â†’        Client->>Store: invalidate('tasks')
   897â†’        Store->>ZoneB: refetch
   898â†’        Client->>Toast: success("ä»»åŠ¡å·²å¼€å§‹")
   899â†’    else å¤±è´¥
   900â†’        API-->>Client: {error}
   901â†’        Client->>Toast: error("æ“ä½œå¤±è´¥")
   902â†’    end
   903â†’
   904â†’    Btn->>Btn: setLoading(false)
   905â†’```
   906â†’
   907â†’**å…³é”®ä»£ç ä¿®å¤**:
   908â†’
   909â†’```typescript
   910â†’// lib/api-client.ts
   911â†’export const apiClient = {
   912â†’  getCSRFToken(): string {
   913â†’    const match = document.cookie.match(/fortune_csrf=([^;]+)/);
   914â†’    return match ? match[1] : '';
   915â†’  },
   916â†’
   917â†’  async post<T>(url: string, data: unknown): Promise<T> {
   918â†’    const res = await fetch(url, {
   919â†’      method: 'POST',
   920â†’      headers: {
   921â†’        'Content-Type': 'application/json',
   922â†’        'X-CSRF-Token': this.getCSRFToken(),  // â† å…³é”®
   923â†’      },
   924â†’      credentials: 'include',
   925â†’      body: JSON.stringify(data),
   926â†’    });
   927â†’    if (!res.ok) throw new ApiError(res.status, await res.json());
   928â†’    return res.json();
   929â†’  }
   930â†’};
   931â†’```
   932â†’
   933â†’---
   934â†’
   935â†’## 3. æµ·æŠ¥ç”Ÿæˆæµç¨‹å›¾å¯¹æ¯”
   936â†’
   937â†’> **å¤–éƒ¨ä»»åŠ¡çŠ¶æ€**: å‚è§ [GLOSSARY.md](../GLOSSARY.md) Â§6
   938â†’
   939â†’### 3.1 è®¾è®¡æµ·æŠ¥æµç¨‹ (Gemini å›¾ç‰‡æ¨¡å‹)
   940â†’
   941â†’```mermaid
   942â†’sequenceDiagram
   943â†’    autonumber
   944â†’    participant U as ç”¨æˆ·
   945â†’    participant FE as å‰ç«¯
   946â†’    participant API as FastAPI
   947â†’    participant GLM as GLM æ–‡æ¡ˆ
   948â†’    participant Gemini as Gemini å›¾ç‰‡
   949â†’    participant DB as PostgreSQL
   950â†’
   951â†’    U->>FE: è§¦å‘æµ·æŠ¥ç”Ÿæˆ<br/>(æŠ¥å‘Šå®Œæˆ/æ‰“å¡å)
   952â†’    FE->>API: POST /api/poster/generate<br/>{poster_type, context}
   953â†’
   954â†’    API->>DB: è¯»å–ç”¨æˆ· Profile
   955â†’    API->>GLM: ç”Ÿæˆåæ§½æ–‡æ¡ˆ
   956â†’    GLM-->>API: "æˆ‘å°±æ˜¯é‚£ä¸ªæƒ³å¤ªå¤šçš„ç”²æœ¨..."
   957â†’
   958â†’    API->>DB: INSERT fortune_poster<br/>(status=processing)
   959â†’    API->>Gemini: gemini_create_job<br/>(å›¾ç‰‡ç”Ÿæˆ)
   960â†’    API-->>FE: {poster_id}
   961â†’
   962â†’    loop è½®è¯¢ (3s é—´éš”)
   963â†’        FE->>API: GET /api/poster/{id}
   964â†’        API-->>FE: {status: 'processing'}
   965â†’    end
   966â†’
   967â†’    Gemini-->>DB: å®Œæˆ â†’ image_url
   968â†’    FE->>API: GET /api/poster/{id}
   969â†’    API-->>FE: {status: 'completed', image_url}
   970â†’    FE->>FE: æ˜¾ç¤ºæµ·æŠ¥ + åˆ†äº«æŒ‰é’®
   971â†’```
   972â†’
   973â†’**æµ·æŠ¥ç±»å‹**:
   974â†’
   975â†’| type | åœºæ™¯ | æ–‡æ¡ˆé£æ ¼ |
   976â†’|------|------|----------|
   977â†’| `personality` | æ·±åº¦æŠ¥å‘Šå | è‡ªå˜²å¼ |
   978â†’| `mood` | æƒ…ç»ªæ‰“å¡å | å¤¸å¼ å¼ |
   979â†’| `fortune` | æŸ¥çœ‹è¿åŠ¿æ—¶ | è°ƒä¾ƒå¼ |
   980â†’| `achievement` | ä»»åŠ¡å®Œæˆå | è‡ªè±ªå¼ |
   981â†’| `help` | çŠ¶æ€ä½è°·æ—¶ | æ±‚åŠ©å¼ |
   982â†’
   983â†’### 3.2 å½“å‰å®ç°çŠ¶æ€
   984â†’
   985â†’| ç»„ä»¶ | åç«¯ | å‰ç«¯ | è¯´æ˜ |
   986â†’|------|:----:|:----:|------|
   987â†’| PosterService | âœ… | - | `services/poster_service.py` |
   988â†’| API ç«¯ç‚¹ | âœ… | - | POST/GET `/api/poster/*` |
   989â†’| fortune_poster è¡¨ | âœ… | - | `20260101_poster_kline.sql` |
   990â†’| ç”Ÿæˆå…¥å£ | - | âš ï¸ | å¾…æ·»åŠ è§¦å‘æŒ‰é’® |
   991â†’| é¢„è§ˆç»„ä»¶ | - | âš ï¸ | å¾…å®ç° |
   992â†’| è½®è¯¢é€»è¾‘ | - | âš ï¸ | å¾…å®ç° |
   993â†’
   994â†’### 3.3 å¤–éƒ¨ä»»åŠ¡çŠ¶æ€æœº
   995â†’
   996â†’```mermaid
   997â†’stateDiagram-v2
   998â†’    [*] --> queued: POST /api/poster/generate
   999â†’
  1000â†’    queued --> processing: Worker é¢†å–
  1001â†’    processing --> completed: å›¾ç‰‡ç”ŸæˆæˆåŠŸ
  1002â†’    processing --> error: ç”Ÿæˆå¤±è´¥
  1003â†’
  1004â†’    completed --> [*]: æ˜¾ç¤ºæµ·æŠ¥
  1005â†’    error --> queued: ç”¨æˆ·é‡è¯•
  1006â†’```
  1007â†’
  1008â†’---
  1009â†’
  1010â†’## 4. Kçº¿ç³»ç»Ÿæµç¨‹å›¾å¯¹æ¯”
  1011â†’
  1012â†’> **æ•°æ®è¡¨**: `fortune_kline_daily` å·²åœ¨ `20260101_poster_kline.sql` åˆ›å»º
  1013â†’
  1014â†’### 4.1 Kçº¿æ•°æ®æµæ¶æ„
  1015â†’
  1016â†’```mermaid
  1017â†’graph TB
  1018â†’    subgraph DataSources["æ•°æ®æº"]
  1019â†’        Checkin["fortune_checkin<br/>(æƒ…ç»ªæ‰“å¡)"]
  1020â†’        Commit["fortune_commitment<br/>(ä»»åŠ¡å®Œæˆ)"]
  1021â†’        Chat["fortune_conversation_message<br/>(å¯¹è¯)"]
  1022â†’    end
  1023â†’
  1024â†’    subgraph Calculate["æ¯æ—¥è®¡ç®—"]
  1025â†’        StateScore["State Score è®¡ç®—"]
  1026â†’        OHLC["OHLC æ±‡æ€»"]
  1027â†’    end
  1028â†’
  1029â†’    subgraph Storage["å­˜å‚¨"]
  1030â†’        KlineTable["fortune_kline_daily<br/>open/high/low/close<br/>volume/drivers"]
  1031â†’    end
  1032â†’
  1033â†’    subgraph Display["å¯è§†åŒ–"]
  1034â†’        KlineChart["Kçº¿èœ¡çƒ›å›¾"]
  1035â†’        Events["äº‹ä»¶æ ‡è®°"]
  1036â†’    end
  1037â†’
  1038â†’    Checkin --> StateScore
  1039â†’    Commit --> StateScore
  1040â†’    Chat --> StateScore
  1041â†’
  1042â†’    StateScore --> OHLC
  1043â†’    OHLC --> KlineTable
  1044â†’    KlineTable --> KlineChart
  1045â†’    KlineTable --> Events
  1046â†’
  1047â†’    style DataSources fill:#e3f2fd
  1048â†’    style Calculate fill:#fff3e0
  1049â†’    style Storage fill:#e8f5e9
  1050â†’    style Display fill:#fce4ec
  1051â†’```
  1052â†’
  1053â†’**OHLC å®šä¹‰**:
  1054â†’
  1055â†’| å­—æ®µ | å«ä¹‰ | è®¡ç®—è§„åˆ™ |
  1056â†’|------|------|----------|
  1057â†’| `open` | å½“æ—¥å¼€ç›˜ | é¦–æ¬¡ State Score (æ—©é—´) |
  1058â†’| `high` | å½“æ—¥æœ€é«˜ | MAX(å½“æ—¥æ‰€æœ‰ State Score) |
  1059â†’| `low` | å½“æ—¥æœ€ä½ | MIN(å½“æ—¥æ‰€æœ‰ State Score) |
  1060â†’| `close` | å½“æ—¥æ”¶ç›˜ | æœ€å State Score (æ™šé—´) |
  1061â†’| `volume` | æ´»åŠ¨é‡ | å½“æ—¥æ‰“å¡ + ä»»åŠ¡å®Œæˆæ•° |
  1062â†’
  1063â†’### 4.2 å½“å‰å®ç°çŠ¶æ€
  1064â†’
  1065â†’| ç»„ä»¶ | çŠ¶æ€ | è¯´æ˜ |
  1066â†’|------|:----:|------|
  1067â†’| fortune_kline_daily è¡¨ | âœ… | `migrations/20260101_poster_kline.sql` |
  1068â†’| GET /api/dashboard/kline | âš ï¸ | å¾…å®ç° |
  1069â†’| GET /api/dashboard/trends | âœ… | è¿”å›çº¿æ€§æ•°æ® |
  1070â†’| trends-tab.tsx | âœ… | çº¿æ€§å›¾è¡¨ |
  1071â†’| Kçº¿èœ¡çƒ›å›¾ç»„ä»¶ | âš ï¸ | å¾…å®ç° |
  1072â†’
  1073â†’### 4.3 Kçº¿ API è®¾è®¡
  1074â†’
  1075â†’```mermaid
  1076â†’sequenceDiagram
  1077â†’    autonumber
  1078â†’    participant FE as å‰ç«¯
  1079â†’    participant API as FastAPI
  1080â†’    participant DB as PostgreSQL
  1081â†’
  1082â†’    FE->>API: GET /api/dashboard/kline<br/>?period=daily&count=30
  1083â†’    API->>DB: SELECT * FROM fortune_kline_daily<br/>WHERE user_id = ? ORDER BY date DESC
  1084â†’    DB-->>API: OHLC æ•°æ®
  1085â†’    API-->>FE: {klines: [{date, open, high, low, close, volume, events}]}
  1086â†’
  1087â†’    FE->>FE: æ¸²æŸ“èœ¡çƒ›å›¾<br/>ç»¿æ¶¨/çº¢è·Œ
  1088â†’    FE->>FE: æ˜¾ç¤ºäº‹ä»¶æ ‡è®°
  1089â†’```
  1090â†’
  1091â†’**å“åº”ç»“æ„**:
  1092â†’
  1093â†’```json
  1094â†’{
  1095â†’  "klines": [
  1096â†’    {
  1097â†’      "date": "2026-01-01",
  1098â†’      "open": 65,
  1099â†’      "high": 78,
  1100â†’      "low": 58,
  1101â†’      "close": 72,
  1102â†’      "volume": 5,
  1103â†’      "change_pct": "+10.8%",
  1104â†’      "events": [
  1105â†’        {"type": "checkin", "label": "æƒ…ç»ªé«˜å³°"},
  1106â†’        {"type": "achievement", "label": "å®Œæˆè®¡åˆ’"}
  1107â†’      ]
  1108â†’    }
  1109â†’  ]
  1110â†’}
  1111â†’```
  1112â†’
  1113â†’---
  1114â†’
  1115â†’## 5. ä»£ç é—®é¢˜æ¸…å•
  1116â†’
  1117â†’### 5.1 P0 é—®é¢˜ï¼ˆå¿…é¡»ä¿®å¤ï¼‰
  1118â†’
  1119â†’| # | é—®é¢˜ | ä½ç½® | å½±å“ | ä¿®å¤æ–¹æ¡ˆ |
  1120â†’|---|------|------|------|----------|
  1121â†’| 1 | CSRF Token æœªä¼ é€’ | `web-app/src/lib/api.ts` | æ‰€æœ‰ POST è¯·æ±‚å¤±è´¥ | ä» cookie è¯»å– fortune_csrf |
  1122â†’| 2 | action_buttons ç‚¹å‡»æ— å“åº” | `web-app/src/components/chat/message-item.tsx` | æ— æ³•æ¥å—ä»»åŠ¡ | å®ç° action handler |
  1123â†’
  1124â†’### 5.2 P1 é—®é¢˜ï¼ˆåº”å°½å¿«å¤„ç†ï¼‰
  1125â†’
  1126â†’| # | é—®é¢˜ | ä½ç½® | å½±å“ | ä¿®å¤æ–¹æ¡ˆ |
  1127â†’|---|------|------|------|----------|
  1128â†’| 3 | Kçº¿ API æœªå®ç° | `api/dashboard_routes.py` | è¶‹åŠ¿å¯è§†åŒ–ä¸å®Œæ•´ | å®ç° kline ç«¯ç‚¹ |
  1129â†’| 4 | éªŒè¯ç‚¹ API æœªå®Œå–„ | `api/auth_routes.py` | Login ä½“éªŒä¸å®Œæ•´ | åŸºäº L0 ç”ŸæˆéªŒè¯ç‚¹ |
  1130â†’| 5 | æµ·æŠ¥å‰ç«¯æœªæ¥å…¥ | `web-app/` | æµ·æŠ¥åŠŸèƒ½ä¸å¯ç”¨ | æ·»åŠ ç”Ÿæˆå…¥å£ + é¢„è§ˆç»„ä»¶ |
  1131â†’| 6 | å¤ç›˜å…¥å£ä¸æ˜æ˜¾ | `web-app/` | ç”¨æˆ·éš¾ä»¥æ‰¾åˆ° | åœ¨ Dashboard æ·»åŠ å…¥å£ |
  1132â†’| 7 | **Skills Registry æœªå®ç°** | `services/skills/` | Command æ¨¡å¼ä¸å¯ç”¨ | åˆ›å»º skills ç›®å½• + æ³¨å†Œè¡¨ |
  1133â†’| 8 | **CommandPalette æœªå®ç°** | `web-app/src/components/chat/` | `/cmd` äº¤äº’ä¸å¯ç”¨ | å®ç°æ‚¬æµ®èœå•ç»„ä»¶ |
  1134â†’
  1135â†’### 5.3 P2 é—®é¢˜ï¼ˆåç»­ä¼˜åŒ–ï¼‰
  1136â†’
  1137â†’| # | é—®é¢˜ | ä½ç½® | å½±å“ | ä¿®å¤æ–¹æ¡ˆ |
  1138â†’|---|------|------|------|----------|
  1139â†’| 9 | æ— è™šæ‹Ÿæ»šåŠ¨ | `web-app/src/components/chat/message-list.tsx` | é•¿å¯¹è¯æ€§èƒ½å·® | ä½¿ç”¨ @tanstack/react-virtual |
  1140â†’| 10 | anti-dependency æ— è±å… | `services/soul_os.py` | æ–°ç”¨æˆ·è¢«æˆªæ–­ | æ·»åŠ  7 å¤©è±å…é€»è¾‘ |
  1141â†’| 11 | æ— å…¨é“¾è·¯è¿½è¸ª | å…¨å±€ | æ’æŸ¥å›°éš¾ | æ·»åŠ  correlation_id |
  1142â†’| 12 | Settings UI ä¸å®Œæ•´ | `web-app/src/app/settings/` | ç”¨æˆ·æ— æ³•ä¿®æ”¹è®¾ç½® | å®Œå–„é¡µé¢ç»„ä»¶ |
  1143â†’| 13 | `/api/chat/command` ç«¯ç‚¹ | `api/chat_routes.py` | Command è·¯ç”±ä¸å¯ç”¨ | å®ç° Command Router |
  1144â†’
  1145â†’---
  1146â†’
  1147â†’## 6. æ€»ç»“
  1148â†’
  1149â†’### 6.1 æ¨¡å—å®Œæˆåº¦ (æŒ‰æ¶æ„å±‚)
  1150â†’
  1151â†’```
  1152â†’=== Interaction Layer ===
  1153â†’æ¨¡å‹é…ç½®:       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 70%  â† GLM ä¸ºä¸»ï¼ŒGemini/Claude å¤‡é€‰
  1154â†’
  1155â†’=== Context Management ===
  1156â†’ä¸Šä¸‹æ–‡ç»„è£…:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 90%  â† å·¥ä½œæ­£å¸¸
  1157â†’
  1158â†’=== L2 Agents ===
  1159â†’Expert Agents:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 60%  â† ä»…å…«å­— Agentï¼Œç´«å¾®/æ˜Ÿåº§å¾…å®ç°
  1160â†’Style Agents:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 90%  â† standard/warm/roast å°±ç»ª
  1161â†’
  1162â†’=== L1 Module Data ===
  1163â†’å…«å­—æ•°æ®:       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
  1164â†’PERMA é‡è¡¨:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 85%
  1165â†’Kçº¿æ•°æ®:        â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 40%  â† API + ç»„ä»¶å¾…å®ç°
  1166â†’
  1167â†’=== L0 Base Data ===
  1168â†’ç”¨æˆ·æ¡£æ¡ˆ:       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
  1169â†’ç™»å½•ç³»ç»Ÿ:       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 70%  â† Tab/éªŒè¯ç‚¹å¾…å®ç°
  1170â†’
  1171â†’=== å‰ç«¯åŠŸèƒ½ ===
  1172â†’å¯¹è¯ç³»ç»Ÿ:       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 70%  â† action_buttons å¾…ä¿®å¤
  1173â†’æµ·æŠ¥ç”Ÿæˆ:       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 60%  â† å‰ç«¯å¾…æ¥å…¥
  1174â†’Settings:       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 60%  â† UI å¾…å®Œå–„
  1175â†’ä»»åŠ¡ç³»ç»Ÿ:       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 70%  â† CSRF å¾…ä¿®å¤
  1176â†’```
  1177â†’
  1178â†’### 6.2 ä¸‹ä¸€æ­¥è¡ŒåŠ¨
  1179â†’
  1180â†’1. **[P0]** ä¿®å¤ CSRF Token å¤„ç† â†’ æ¢å¤ä»»åŠ¡åŠŸèƒ½
  1181â†’2. **[P0]** å®Œå–„ action_buttons ç‚¹å‡»å¤„ç† â†’ æ¢å¤ä¸€é”®è¡ŒåŠ¨
  1182â†’3. **[P1]** å®ç° Kçº¿ API + å‰ç«¯ç»„ä»¶ (L1 Module Data)
  1183â†’4. **[P1]** æµ·æŠ¥åŠŸèƒ½å‰ç«¯æ¥å…¥ (Interaction Layer)
  1184â†’5. **[P1]** å®ç° Skills Registry + CommandPalette (v4.1 Command æ”¯æŒ)
  1185â†’6. **[P2]** æ‰©å±• L2 Expert Agentsï¼ˆç´«å¾®/æ˜Ÿåº§/CBTï¼‰
  1186â†’7. **[P2]** Settings é¡µé¢ UI å®Œå–„
  1187â†’8. **[P2]** å®ç° `/api/chat/command` ç«¯ç‚¹
  1188â†’
  1189â†’---
  1190â†’
  1191â†’*æ–‡æ¡£ç‰ˆæœ¬: v4.2 (Vercel AI SDK Edition)*
  1192â†’*æ›´æ–°æ—¥æœŸ: 2026-01-01*
  1193â†’*æ ¸å¿ƒæŠ€æœ¯: Vercel AI SDK 6 + tool() + useChat()*
  1194â†’*æµ‹è¯•ç¯å¢ƒ: http://106.37.170.238:8231/new*
  1195â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
