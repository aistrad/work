   100→
   101→        书中步骤:
   102→        - 月命数=10, 时命数=3(寅)
   103→        - 先天命数 = 10+3-3 = 10
   104→        - 年干丙 + 先天命数10 → 五音"徵" → 五音命数=2
   105→        - 日柱丁酉(火), 求测时辰天干"丁" → 日命数=5
   106→        - 时柱壬寅纳音"金"...书中说"火" → 时运数=2
   107→        - 日命数+时运数=7 > 6, 丙为阳年, 女命(阳女) → 正刻...书中说初刻
   108→        - 本命数 = (2×5+5+2-6)×30+6 = 11×30+6 = 336
   109→        - 查初刻辟卦表 → 本命数336对应"剥"
   110→        """
   111→        from services.tieban.taihua_engine import engine_taihua
   112→
   113→        result = engine_taihua(
   114→            pillars={"year": "丙寅", "month": "戊戌", "day": "丁酉", "hour": "壬寅"},
   115→            lunar_info={"month": 10, "day": 6},
   116→            gender="female",
   117→        )
   118→
   119→        # 验证中间步骤
   120→        assert result["xiantian_mingshu"] == 10, f"先天命数应为10, 实际: {result['xiantian_mingshu']}"
   121→        assert result["wuyin_mingshu"] == 2, f"五音命数应为2, 实际: {result['wuyin_mingshu']}"
   122→        assert result["ri_mingshu"] == 5, f"日命数应为5, 实际: {result['ri_mingshu']}"
   123→        assert result["shiyun_shu"] == 2, f"时运数应为2, 实际: {result['shiyun_shu']}"
   124→        assert result["ke_type"] == "初刻", f"应为初刻, 实际: {result['ke_type']}"
   125→
   126→        # 验证最终结果
   127→        assert result["benming_shu"] == 336, f"本命数应为336, 实际: {result['benming_shu']}"
   128→        assert result["pi_gua"] == "剥", f"辟卦应为剥, 实际: {result['pi_gua']}"
   129→
   130→
   131→class TestTaihuaSteps:
   132→    """单步计算验证"""
   133→
   134→    def test_xiantian_mingshu_positive(self):
   135→        """先天命数计算 - 正数结果"""
   136→        from services.tieban.taihua_engine import compute_xiantian_mingshu
   137→
   138→        # 月=9, 时支=酉(10) => 9+3-10 = 2
   139→        assert compute_xiantian_mingshu(9, "酉") == 2
   140→
   141→    def test_xiantian_mingshu_negative_wrap(self):
   142→        """先天命数计算 - 负数需加12"""
   143→        from services.tieban.taihua_engine import compute_xiantian_mingshu
   144→
   145→        # 月=5, 时支=申(9) => 5+3-9 = -1, +12 = 11
   146→        assert compute_xiantian_mingshu(5, "申") == 11
   147→
   148→    def test_xiantian_mingshu_zero_wrap(self):
   149→        """先天命数计算 - 0变12"""
   150→        from services.tieban.taihua_engine import compute_xiantian_mingshu
   151→
   152→        # 月=10, 时支=丑(2) => 10+3-2 = 11
   153→        # 月=9, 时支=子(1) => 9+3-1 = 11
   154→        # 月=10, 时支=寅(3) => 10+3-3 = 10
   155→        assert compute_xiantian_mingshu(10, "寅") == 10
   156→
   157→    def test_wuyin_mingshu(self):
   158→        """五音命数计算"""
   159→        from services.tieban.taihua_engine import compute_wuyin_mingshu
   160→
   161→        # 先天命数=2, 年干=辛 → 五音宫 → 五音命数=5
   162→        assert compute_wuyin_mingshu(2, "辛") == 5
   163→
   164→        # 先天命数=11, 年干=甲 → 五音徵 → 五音命数=2
   165→        assert compute_wuyin_mingshu(11, "甲") == 2
   166→
   167→    def test_ri_mingshu(self):
   168→        """日命数计算
   169→
   170→        NOTE: Using standard nayin (甲申=水, not 火 as book claims)
   171→        """
   172→        from services.tieban.taihua_engine import compute_ri_mingshu
   173→
   174→        # 日柱甲申 standard nayin=水, 时干癸 → 水+癸=5
   175→        # (Book says 甲申=火 which is non-standard)
   176→        assert compute_ri_mingshu("甲申", "癸") == 5  # 水+癸=5
   177→
   178→        # 日柱丙申 nayin=火, 时干壬 → 火+壬=4 ✓
   179→        assert compute_ri_mingshu("丙申", "壬") == 4

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
