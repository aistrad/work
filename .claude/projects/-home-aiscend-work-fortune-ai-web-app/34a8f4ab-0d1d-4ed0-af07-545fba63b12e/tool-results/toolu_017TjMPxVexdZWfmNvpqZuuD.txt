     1→/**
     2→ * Grow Skills (成长技能)
     3→ *
     4→ * Tools for goal setting, task management, and personal growth tracking.
     5→ */
     6→import { tool } from 'ai';
     7→import { z } from 'zod/v3';
     8→
     9→const FASTAPI_URL = process.env.FASTAPI_URL || 'http://localhost:8230';
    10→
    11→// Create commitment/goal tool
    12→export const createCommitment = tool({
    13→  description: '创建用户的承诺或目标。当用户表达想要做某事、设定目标、或接受教练建议时使用。',
    14→  inputSchema: z.object({
    15→    title: z.string().describe('承诺/目标标题'),
    16→    description: z.string().optional().describe('详细描述'),
    17→    commitment_type: z.enum(['task', 'habit', 'goal']).describe('类型：任务/习惯/目标'),
    18→    due_date: z.string().optional().describe('截止日期，格式：YYYY-MM-DD'),
    19→    if_then: z.string().optional().describe('如果-那么规则，如：如果早上起床→那么先喝一杯水'),
    20→  }),
    21→  execute: async ({ title, description, commitment_type, due_date, if_then }) => {
    22→    // Generate a temporary ID (in production, this comes from the backend)
    23→    const tempId = `commitment-${Date.now()}`;
    24→
    25→    return {
    26→      type: 'a2ui_card' as const,
    27→      card_type: 'goal_created',
    28→      data: {
    29→        goal_id: tempId,
    30→        title,
    31→        description: description || '',
    32→        commitment_type,
    33→        status: 'active',
    34→        due_date: due_date || null,
    35→        if_then: if_then || null,
    36→        created_at: new Date().toISOString(),
    37→      },
    38→      actions: [
    39→        {
    40→          label: '现在开始',
    41→          action: 'api_call',
    42→          params: { endpoint: '/api/goal/start', goal_id: tempId },
    43→        },
    44→        {
    45→          label: '稍后提醒我',
    46→          action: 'api_call',
    47→          params: { endpoint: '/api/goal/schedule', goal_id: tempId },
    48→        },
    49→      ],
    50→    };
    51→  },
    52→});
    53→
    54→// Complete task tool
    55→export const completeTask = tool({
    56→  description: '标记任务/承诺为已完成。当用户报告完成了某项任务或目标时使用。',
    57→  inputSchema: z.object({
    58→    task_id: z.string().describe('任务ID'),
    59→    reflection: z.string().optional().describe('完成后的反思或感受'),
    60→    difficulty: z.enum(['easy', 'medium', 'hard']).optional().describe('难度评价'),
    61→  }),
    62→  execute: async ({ task_id, reflection, difficulty }) => {
    63→    return {
    64→      type: 'a2ui_card' as const,
    65→      card_type: 'task_completed',
    66→      data: {
    67→        goal_id: task_id,
    68→        title: '任务已完成',
    69→        status: 'completed',
    70→        completed_at: new Date().toISOString(),
    71→        reflection: reflection || '',
    72→        difficulty: difficulty || 'medium',
    73→        // Add XP/reward info
    74→        reward: {
    75→          xp: 10,
    76→          streak_bonus: false,
    77→        },
    78→      },
    79→      actions: [
    80→        {
    81→          label: '查看进度',
    82→          action: 'navigate',
    83→          params: { path: '/dashboard/goals' },
    84→        },
    85→      ],
    86→    };
    87→  },
    88→});
    89→
    90→// List active goals tool
    91→export const listGoals = tool({
    92→  description: '列出用户当前活跃的目标和任务。当用户询问"我有什么任务"、"我的目标是什么"时使用。',
    93→  inputSchema: z.object({
    94→    status: z.enum(['active', 'completed', 'all']).optional().describe('筛选状态'),
    95→    limit: z.number().optional().describe('返回数量限制'),
    96→  }),
    97→  execute: async ({ status, limit }) => {
    98→    // In production, this would fetch from FastAPI
    99→    // For now, return a placeholder response
   100→
   101→    return {
   102→      type: 'a2ui_card' as const,
   103→      card_type: 'goal_list',
   104→      data: {
   105→        status_filter: status || 'active',
   106→        goals: [],
   107→        total_count: 0,
   108→        message: '暂无活跃目标。想要创建一个新目标吗？',
   109→      },
   110→      actions: [
   111→        {
   112→          label: '创建新目标',
   113→          action: 'navigate',
   114→          params: { path: '/goals/new' },
   115→        },
   116→      ],
   117→    };
   118→  },
   119→});
   120→
   121→// Weekly review tool
   122→export const weeklyReview = tool({
   123→  description: '生成用户的周度回顾报告。当用户请求周报或进行周回顾时使用。',
   124→  inputSchema: z.object({
   125→    week_start: z.string().optional().describe('周起始日期，格式：YYYY-MM-DD，默认上周一'),
   126→  }),
   127→  execute: async ({ week_start }) => {
   128→    const startDate = week_start || getLastMonday();
   129→
   130→    return {
   131→      type: 'a2ui_card' as const,
   132→      card_type: 'weekly_review',
   133→      data: {
   134→        week_start: startDate,
   135→        summary: {
   136→          tasks_completed: 0,
   137→          goals_progress: [],
   138→          mood_average: 0,
   139→          perma_scores: null,
   140→        },
   141→        highlights: [],
   142→        challenges: [],
   143→        next_week_focus: [],
   144→        message: '正在生成周度回顾...',
   145→      },
   146→      actions: [
   147→        {
   148→          label: '查看完整报告',
   149→          action: 'navigate',
   150→          params: { path: `/reports/weekly/${startDate}` },
   151→        },
   152→      ],
   153→    };
   154→  },
   155→});
   156→
   157→// Helper function to get last Monday's date
   158→function getLastMonday(): string {
   159→  const today = new Date();
   160→  const dayOfWeek = today.getDay();
   161→  const daysToSubtract = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
   162→  const lastMonday = new Date(today);
   163→  lastMonday.setDate(today.getDate() - daysToSubtract - 7);
   164→  return lastMonday.toISOString().split('T')[0];
   165→}
   166→
   167→// Start task timer tool
   168→export const startTaskTimer = tool({
   169→  description: '开始一个专注计时器。当用户说"开始"、"计时"、或需要专注工作时使用。',
   170→  inputSchema: z.object({
   171→    task_id: z.string().optional().describe('关联的任务ID'),
   172→    duration_minutes: z.number().min(1).max(120).describe('专注时长（分钟）'),
   173→    task_name: z.string().optional().describe('任务名称'),
   174→  }),
   175→  execute: async ({ task_id, duration_minutes, task_name }) => {
   176→    return {
   177→      type: 'a2ui_card' as const,
   178→      card_type: 'timer_started',
   179→      data: {
   180→        timer_id: `timer-${Date.now()}`,
   181→        task_id: task_id || null,
   182→        task_name: task_name || '专注时间',
   183→        duration_minutes,
   184→        started_at: new Date().toISOString(),
   185→        ends_at: new Date(Date.now() + duration_minutes * 60 * 1000).toISOString(),
   186→      },
   187→      actions: [
   188→        {
   189→          label: '暂停',
   190→          action: 'api_call',
   191→          params: { endpoint: '/api/timer/pause' },
   192→        },
   193→        {
   194→          label: '结束',
   195→          action: 'api_call',
   196→          params: { endpoint: '/api/timer/stop' },
   197→        },
   198→      ],
   199→    };
   200→  },
   201→});
   202→
   203→// Export all grow skills
   204→export const growSkills = {
   205→  create_commitment: createCommitment,
   206→  complete_task: completeTask,
   207→  list_goals: listGoals,
   208→  weekly_review: weeklyReview,
   209→  start_task_timer: startTaskTimer,
   210→};
   211→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
