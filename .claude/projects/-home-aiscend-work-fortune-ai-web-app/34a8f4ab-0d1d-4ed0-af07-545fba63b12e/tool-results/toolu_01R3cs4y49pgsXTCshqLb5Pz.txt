     1→/**
     2→ * Heal Skills (疗愈技能)
     3→ *
     4→ * Tools for psychological wellbeing: PERMA tracking, mood check-in, CBT reframing.
     5→ */
     6→import { tool } from 'ai';
     7→import { z } from 'zod/v3';
     8→
     9→const FASTAPI_URL = process.env.FASTAPI_URL || 'http://localhost:8230';
    10→
    11→// Mood check-in tool
    12→export const moodCheckin = tool({
    13→  description: '记录用户当前的情绪状态。当用户分享心情、表达情绪、或需要情绪记录时使用。',
    14→  inputSchema: z.object({
    15→    mood: z.enum(['great', 'good', 'okay', 'down', 'bad']).describe('情绪等级'),
    16→    note: z.string().optional().describe('情绪备注'),
    17→    triggers: z.array(z.string()).optional().describe('情绪触发因素'),
    18→  }),
    19→  execute: async ({ mood, note, triggers }) => {
    20→    const moodScores: Record<string, number> = {
    21→      great: 90,
    22→      good: 75,
    23→      okay: 50,
    24→      down: 30,
    25→      bad: 15,
    26→    };
    27→
    28→    const moodLabels: Record<string, string> = {
    29→      great: '非常好',
    30→      good: '不错',
    31→      okay: '一般',
    32→      down: '低落',
    33→      bad: '很差',
    34→    };
    35→
    36→    // Note: In a real implementation, this would call the FastAPI backend
    37→    // to persist the mood record. For now, we return a card indicating success.
    38→
    39→    return {
    40→      type: 'a2ui_card' as const,
    41→      card_type: 'mood_logged',
    42→      data: {
    43→        timestamp: new Date().toISOString(),
    44→        mood,
    45→        mood_label: moodLabels[mood],
    46→        score: moodScores[mood],
    47→        note: note || '',
    48→        triggers: triggers || [],
    49→      },
    50→      actions: [
    51→        {
    52→          label: '查看情绪趋势',
    53→          action: 'navigate',
    54→          params: { path: '/dashboard/mood' },
    55→        },
    56→      ],
    57→    };
    58→  },
    59→});
    60→
    61→// PERMA dimension logging tool
    62→export const logPerma = tool({
    63→  description: '记录用户的 PERMA 幸福五维度得分。用于定期的幸福感评估。',
    64→  inputSchema: z.object({
    65→    P: z.number().min(1).max(10).describe('积极情绪 (Positive Emotions) 1-10'),
    66→    E: z.number().min(1).max(10).describe('投入感 (Engagement) 1-10'),
    67→    R: z.number().min(1).max(10).describe('人际关系 (Relationships) 1-10'),
    68→    M: z.number().min(1).max(10).describe('意义感 (Meaning) 1-10'),
    69→    A: z.number().min(1).max(10).describe('成就感 (Accomplishment) 1-10'),
    70→    context: z.string().optional().describe('评估背景或备注'),
    71→  }),
    72→  execute: async ({ P, E, R, M, A, context }) => {
    73→    const overall = Math.round((P + E + R + M + A) / 5 * 10);
    74→
    75→    // Note: In production, this would persist to FastAPI backend
    76→
    77→    return {
    78→      type: 'a2ui_card' as const,
    79→      card_type: 'perma_checkin',
    80→      data: {
    81→        timestamp: new Date().toISOString(),
    82→        dimensions: { P, E, R, M, A },
    83→        overall_score: overall,
    84→        context: context || '',
    85→      },
    86→      actions: [
    87→        {
    88→          label: '查看 PERMA 趋势',
    89→          action: 'navigate',
    90→          params: { path: '/dashboard/perma' },
    91→        },
    92→      ],
    93→    };
    94→  },
    95→});
    96→
    97→// CBT reframing tool
    98→export const cbtReframe = tool({
    99→  description: '使用认知行为疗法帮助用户重构负面想法。当用户表达消极想法或自我批评时使用。',
   100→  inputSchema: z.object({
   101→    negative_thought: z.string().describe('用户的负面想法'),
   102→    situation: z.string().optional().describe('引发想法的情境'),
   103→  }),
   104→  execute: async ({ negative_thought, situation }) => {
   105→    // This would typically call an AI model or use predefined CBT patterns
   106→    // For now, return a structured response with CBT framework
   107→
   108→    return {
   109→      type: 'a2ui_card' as const,
   110→      card_type: 'cbt_reframe',
   111→      data: {
   112→        original_thought: negative_thought,
   113→        situation: situation || '未指定',
   114→        cognitive_distortions: [
   115→          '可能存在的认知偏差需要进一步分析',
   116→        ],
   117→        reframed_thoughts: [
   118→          '让我们一起来看看这个想法是否完全准确...',
   119→          '有没有其他可能的解释？',
   120→          '如果朋友遇到同样的情况，你会怎么看？',
   121→        ],
   122→        action_steps: [
   123→          '记录这个想法和你的感受',
   124→          '寻找支持或反驳这个想法的证据',
   125→          '尝试用更平衡的方式重新表述',
   126→        ],
   127→      },
   128→      actions: [
   129→        {
   130→          label: '记录到日记',
   131→          action: 'api_call',
   132→          params: { endpoint: '/api/reflection/save' },
   133→        },
   134→      ],
   135→    };
   136→  },
   137→});
   138→
   139→// Gratitude logging tool
   140→export const logGratitude = tool({
   141→  description: '记录用户的感恩日记。当用户分享感恩的事物或进行感恩练习时使用。',
   142→  inputSchema: z.object({
   143→    items: z.array(z.string()).min(1).max(5).describe('感恩的事项（1-5项）'),
   144→    category: z.enum(['people', 'experiences', 'things', 'self', 'other'])
   145→      .optional()
   146→      .describe('感恩类别'),
   147→  }),
   148→  execute: async ({ items, category }) => {
   149→    return {
   150→      type: 'a2ui_card' as const,
   151→      card_type: 'gratitude_logged',
   152→      data: {
   153→        timestamp: new Date().toISOString(),
   154→        items,
   155→        category: category || 'other',
   156→        count: items.length,
   157→      },
   158→      actions: [
   159→        {
   160→          label: '查看感恩历史',
   161→          action: 'navigate',
   162→          params: { path: '/dashboard/gratitude' },
   163→        },
   164→      ],
   165→    };
   166→  },
   167→});
   168→
   169→// Export all heal skills
   170→export const healSkills = {
   171→  mood_checkin: moodCheckin,
   172→  log_perma: logPerma,
   173→  cbt_reframe: cbtReframe,
   174→  log_gratitude: logGratitude,
   175→};
   176→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
