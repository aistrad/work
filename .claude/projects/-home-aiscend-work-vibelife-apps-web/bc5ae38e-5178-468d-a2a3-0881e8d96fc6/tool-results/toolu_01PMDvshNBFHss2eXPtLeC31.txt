  1600→║                                                                               ║
  1601→║   数据融合算法                                                                ║
  1602→║   ─────────────────────────────────────────────────────────────────────────   ║
  1603→║                                                                               ║
  1604→║   Core 层生成：                                                               ║
  1605→║   1. 计算八字日主 → 得到先天气质类型                                          ║
  1606→║   2. 判断格局 → 得到核心驱动力                                                ║
  1607→║   3. 结合用神 → 得到发展方向                                                  ║
  1608→║   4. LLM 生成自然语言描述                                                     ║
  1609→║                                                                               ║
  1610→║   Inner 层生成：                                                              ║
  1611→║   1. 从 AI 洞察中提取 emotional_patterns                                      ║
  1612→║   2. 从对话中提取用户自述的内心状态                                           ║
  1613→║   3. 综合推断内心真正在意的是什么                                             ║
  1614→║   4. LLM 生成自然语言描述                                                     ║
  1615→║                                                                               ║
  1616→║   Outer 层生成：                                                              ║
  1617→║   1. 分析八字十神结构 → 社会角色倾向                                          ║
  1618→║   2. 从行为模式中提取对外表现                                                 ║
  1619→║   3. 综合推断给人的感觉                                                       ║
  1620→║   4. LLM 生成自然语言描述                                                     ║
  1621→║                                                                               ║
  1622→╚═══════════════════════════════════════════════════════════════════════════════╝
  1623→```
  1624→
  1625→---
  1626→
  1627→# Part 5: 技术架构
  1628→
  1629→## 5.1 系统架构总览
  1630→
  1631→```
  1632→╔═══════════════════════════════════════════════════════════════════════════════╗
  1633→║                                                                               ║
  1634→║                    VIBELIFE SYSTEM ARCHITECTURE                               ║
  1635→║                                                                               ║
  1636→╠═══════════════════════════════════════════════════════════════════════════════╣
  1637→║                                                                               ║
  1638→║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
  1639→║   │                                                                         │ ║
  1640→║   │   L1: PRESENTATION LAYER (Web Only + PWA)                               │ ║
  1641→║   │   ═══════════════════════════════════════════════════════════════════   │ ║
  1642→║   │                                                                         │ ║
  1643→║   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │ ║
  1644→║   │   │   Next.js   │  │   Mobile    │  │    PWA      │                    │ ║
  1645→║   │   │   Web App   │  │   Web View  │  │   Support   │                    │ ║
  1646→║   │   └─────────────┘  └─────────────┘  └─────────────┘                    │ ║
  1647→║   │                                                                         │ ║
  1648→║   │   技术栈：Next.js 14 + Tailwind + framer-motion + Zustand              │ ║
  1649→║   │                                                                         │ ║
  1650→║   └─────────────────────────────────────┬───────────────────────────────────┘ ║
  1651→║                                         │                                     ║
  1652→║                                         ▼                                     ║
  1653→║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
  1654→║   │                                                                         │ ║
  1655→║   │   L2: API LAYER (FastAPI)                                               │ ║
  1656→║   │   ═══════════════════════════════════════════════════════════════════   │ ║
  1657→║   │                                                                         │ ║
  1658→║   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │ ║
  1659→║   │   │    Chat     │  │   Report    │  │ Relationship│  │    User     │   │ ║
  1660→║   │   │    API      │  │    API      │  │     API     │  │    API      │   │ ║
  1661→║   │   │             │  │             │  │             │  │             │   │ ║
  1662→║   │   │ • Stream    │  │ • Generate  │  │ • Create    │  │ • Profile   │   │ ║
  1663→║   │   │ • Context   │  │ • AI Image  │  │ • Invite    │  │ • Pref      │   │ ║
  1664→║   │   └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │ ║
  1665→║   │                                                                         │ ║
  1666→║   └─────────────────────────────────────┬───────────────────────────────────┘ ║
  1667→║                                         │                                     ║
  1668→║                                         ▼                                     ║
  1669→║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
  1670→║   │                                                                         │ ║
  1671→║   │   L3: VIBE ENGINE (核心智能引擎)                                        │ ║
  1672→║   │   ═══════════════════════════════════════════════════════════════════   │ ║
  1673→║   │                                                                         │ ║
  1674→║   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │ ║
  1675→║   │   │   Agent     │  │  Insight    │  │   Emotion   │  │   Portrait  │   │ ║
  1676→║   │   │   Runtime   │  │  Generator  │  │   Engine    │  │   Manager   │   │ ║
  1677→║   │   └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │ ║
  1678→║   │                                                                         │ ║
  1679→║   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │ ║
  1680→║   │   │  Knowledge  │  │    File     │  │    Image    │                    │ ║
  1681→║   │   │  Retrieval  │  │  Extractor  │  │  Generator  │                    │ ║
  1682→║   │   └─────────────┘  └─────────────┘  └─────────────┘                    │ ║
  1683→║   │                                                                         │ ║
  1684→║   └─────────────────────────────────────┬───────────────────────────────────┘ ║
  1685→║                                         │                                     ║
  1686→║                                         ▼                                     ║
  1687→║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
  1688→║   │                                                                         │ ║
  1689→║   │   L4: SKILL & KNOWLEDGE LAYER                                           │ ║
  1690→║   │   ═══════════════════════════════════════════════════════════════════   │ ║
  1691→║   │                                                                         │ ║
  1692→║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
  1693→║   │   │                         SKILLS                                  │   │ ║
  1694→║   │   │                                                                 │   │ ║
  1695→║   │   │   ┌─────────────┐           ┌─────────────┐                     │   │ ║
  1696→║   │   │   │    BaZi     │           │   Zodiac    │                     │   │ ║
  1697→║   │   │   │             │           │             │                     │   │ ║
  1698→║   │   │   │ • Calculator│           │ • Ephemeris │                     │   │ ║
  1699→║   │   │   │ • Transit   │           │ • Chart     │                     │   │ ║
  1700→║   │   │   │ • Analysis  │           │ • Events    │                     │   │ ║
  1701→║   │   │   └─────────────┘           └─────────────┘                     │   │ ║
  1702→║   │   │                                                                 │   │ ║
  1703→║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
  1704→║   │                                                                         │ ║
  1705→║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
  1706→║   │   │                     KNOWLEDGE BASE                              │   │ ║
  1707→║   │   │                                                                 │   │ ║
  1708→║   │   │   ┌─────────────┐           ┌─────────────┐                     │   │ ║
  1709→║   │   │   │  BaZi KB    │           │  Zodiac KB  │                     │   │ ║
  1710→║   │   │   │             │           │             │                     │   │ ║
  1711→║   │   │   │ • Theory    │           │ • Signs     │                     │   │ ║
  1712→║   │   │   │ • Patterns  │           │ • Houses    │                     │   │ ║
  1713→║   │   │   │ • Transit   │           │ • Aspects   │                     │   │ ║
  1714→║   │   │   └─────────────┘           └─────────────┘                     │   │ ║
  1715→║   │   │                                                                 │   │ ║
  1716→║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
  1717→║   │                                                                         │ ║
  1718→║   └─────────────────────────────────────┬───────────────────────────────────┘ ║
  1719→║                                         │                                     ║
  1720→║                                         ▼                                     ║
  1721→║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
  1722→║   │                                                                         │ ║
  1723→║   │   L5: DATA LAYER                                                        │ ║
  1724→║   │   ═══════════════════════════════════════════════════════════════════   │ ║
  1725→║   │                                                                         │ ║
  1726→║   │   ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐          │ ║
  1727→║   │   │PostgreSQL│ │ Pinecone│ │  Redis  │ │   S3    │ │ Supabase│          │ ║
  1728→║   │   │ Primary │ │ Vector  │ │  Cache  │ │  Assets │ │  Auth   │          │ ║
  1729→║   │   └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘          │ ║
  1730→║   │                                                                         │ ║
  1731→║   └─────────────────────────────────────────────────────────────────────────┘ ║
  1732→║                                                                               ║
  1733→╚═══════════════════════════════════════════════════════════════════════════════╝
  1734→```
  1735→
  1736→## 5.2 技术栈选型
  1737→
  1738→```
  1739→┌─────────────────────────────────────────────────────────────────────────────┐
  1740→│                                                                             │
  1741→│   技术栈选型                                                                │
  1742→│                                                                             │
  1743→│   ═══════════════════════════════════════════════════════════════════════   │
  1744→│                                                                             │
  1745→│   前端                                                                      │
  1746→│   ─────────────────────────────────────────────────────────────────────     │
  1747→│   • 框架：Next.js 14 (App Router)                                           │
  1748→│   • 样式：Tailwind CSS                                                      │
  1749→│   • 状态管理：Zustand                                                       │
  1750→│   • 动效：framer-motion                                                     │
  1751→│   • 图表：Recharts / D3.js (人生 K 线)                                      │
  1752→│   • 移动端组件：vaul (Bottom Sheet)                                         │
  1753→│   • AI SDK：Vercel AI SDK 6                                                 │
  1754→│                                                                             │
  1755→│   后端                                                                      │
  1756→│   ─────────────────────────────────────────────────────────────────────     │
  1757→│   • 框架：FastAPI                                                           │
  1758→│   • LLM（多模型支持）：                                                     │
  1759→│     ├── Claude (claude-3-opus / claude-3-sonnet) - 主力                     │
  1760→│     ├── Gemini (gemini-1.5-pro) - 备选                                      │
  1761→│     ├── Zhipu (glm-4) - 中文优化                                            │
  1762→│     └── Deepseek (deepseek-chat) - 成本优化                                 │
  1763→│   • AI SDK：Claude Agent SDK, Gemini SDK                                    │
  1764→│   • Embedding：                                                             │
  1765→│     ├── BAAI/bge-m3 - 多语言                                                │
  1766→│     └── gte-Qwen2-7B-instruct - 中文优化                                    │
  1767→│   • 图像生成：Google Gemini Imagen (Nano Banana)                            │
  1768→│                                                                             │
  1769→│   数据存储                                                                  │
  1770→│   ─────────────────────────────────────────────────────────────────────     │
  1771→│   • 主数据库：PostgreSQL                                                    │
  1772→│   • 向量数据库：pgvector（PostgreSQL 扩展）                                 │
  1773→│   • 缓存：Redis                                                             │
  1774→│   • 文件存储：S3 / Cloudflare R2                                            │
  1775→│   • 认证：Supabase Auth / 自建 JWT                                          │
  1776→│                                                                             │
  1777→│   部署                                                                      │
  1778→│   ─────────────────────────────────────────────────────────────────────     │
  1779→│   • 前端：Vercel                                                            │
  1780→│   • 后端：Railway / Fly.io                                                  │
  1781→│   • 域名：vibelife.app                                                      │
  1782→│                                                                             │
  1783→└─────────────────────────────────────────────────────────────────────────────┘
  1784→```
  1785→
  1786→## 4.3 核心 API 设计
  1787→
  1788→```
  1789→┌─────────────────────────────────────────────────────────────────────────────┐
  1790→│                                                                             │
  1791→│   核心 API 设计                                                             │
  1792→│                                                                             │
  1793→│   ═══════════════════════════════════════════════════════════════════════   │
  1794→│                                                                             │
  1795→│   Chat API                                                                  │
  1796→│   ─────────────────────────────────────────────────────────────────────     │
  1797→│                                                                             │
  1798→│   POST /api/v1/chat/stream                                                  │
  1799→│   • 流式对话接口                                                            │
  1800→│   • 支持 SSE                                                                │
  1801→│   • 自动上下文管理                                                          │
  1802→│                                                                             │
  1803→│   POST /api/v1/chat/upload                                                  │
  1804→│   • 文件上传接口                                                            │
  1805→│   • 支持图片、PDF、文档                                                     │
  1806→│   • 返回抽取的信息                                                          │
  1807→│                                                                             │
  1808→│   ─────────────────────────────────────────────────────────────────────     │
  1809→│                                                                             │
  1810→│   Report API                                                                │
  1811→│   ─────────────────────────────────────────────────────────────────────     │
  1812→│                                                                             │
  1813→│   POST /api/v1/report/generate                                              │
  1814→│   • 生成报告                                                                │
  1815→│   • 参数：skill (bazi/zodiac), level (brief/full)                          │
  1816→│                                                                             │
  1817→│   POST /api/v1/report/image                                                 │
  1818→│   • 生成 AI 图像报告                                                        │
  1819→│   • 调用 Midjourney/SD                                                      │
  1820→│   • 返回图片 URL                                                            │
  1821→│                                                                             │
  1822→│   GET /api/v1/report/{id}                                                   │
  1823→│   • 获取报告详情                                                            │
  1824→│                                                                             │
  1825→│   ─────────────────────────────────────────────────────────────────────     │
  1826→│                                                                             │
  1827→│   Identity API                                                              │
  1828→│   ─────────────────────────────────────────────────────────────────────     │
  1829→│                                                                             │
  1830→│   GET /api/v1/identity/prism                                                │
  1831→│   • 获取 Identity Prism 数据                                                │
  1832→│   • 返回 inner/core/outer 三元数据                                          │
  1833→│                                                                             │
  1834→│   GET /api/v1/identity/kline                                                │
  1835→│   • 获取人生 K 线数据                                                       │
  1836→│   • 返回大运、流年节点                                                      │
  1837→│                                                                             │
  1838→│   ─────────────────────────────────────────────────────────────────────     │
  1839→│                                                                             │
  1840→│   Relationship API                                                          │
  1841→│   ─────────────────────────────────────────────────────────────────────     │
  1842→│                                                                             │
  1843→│   POST /api/v1/relationship/analyze                                         │
  1844→│   • 单人模式关系分析                                                        │
  1845→│   • 输入对方信息（生日/星座/属相）                                          │
  1846→│                                                                             │
  1847→│   POST /api/v1/relationship/invite                                          │
  1848→│   • 生成 Vibe Link 邀请                                                     │
  1849→│   • 返回邀请链接                                                            │
  1850→│                                                                             │
  1851→│   POST /api/v1/relationship/accept                                          │
  1852→│   • 接受邀请                                                                │
  1853→│   • 双方各自获取分析结果                                                    │
  1854→│                                                                             │
  1855→│   ─────────────────────────────────────────────────────────────────────     │
  1856→│                                                                             │
  1857→│   User API                                                                  │
  1858→│   ─────────────────────────────────────────────────────────────────────     │
  1859→│                                                                             │
  1860→│   GET /api/v1/user/profile                                                  │
  1861→│   PUT /api/v1/user/profile                                                  │
  1862→│   GET /api/v1/user/portrait                                                 │
  1863→│   POST /api/v1/user/preference                                              │
  1864→│                                                                             │
  1865→└─────────────────────────────────────────────────────────────────────────────┘
  1866→```
  1867→
  1868→---
  1869→
  1870→# Part 5: 变现与运营
  1871→
  1872→## 6.1 付费墙策略
  1873→
  1874→```
  1875→╔═══════════════════════════════════════════════════════════════════════════════╗
  1876→║                                                                               ║
  1877→║   付费墙策略（两步转化模式）                                                  ║
  1878→║                                                                               ║
  1879→╠═══════════════════════════════════════════════════════════════════════════════╣
  1880→║                                                                               ║
  1881→║   核心定价                                                                    ║
  1882→║   ─────────────────────────────────────────────────────────────────────────   ║
  1883→║                                                                               ║
  1884→║   个人报告套餐：¥19.9                                                         ║
  1885→║   • 完整报告 + 高清海报（捆绑销售）                                           ║
  1886→║   • 一次付费，永久保存                                                        ║
  1887→║   • 🎁 赠送首月订阅权益（不自动续费）                                         ║
  1888→║                                                                               ║
  1889→║   关系分析报告：¥19.9                                                         ║
  1890→║   • 关系诊断 + 高清关系海报                                                   ║
  1891→║   • 🎁 赠送首月订阅权益（不自动续费）                                         ║
  1892→║                                                                               ║
  1893→║   ─────────────────────────────────────────────────────────────────────────   ║
  1894→║                                                                               ║
  1895→║   漏斗设计（简化两层）                                                        ║
  1896→║   ─────────────────────────────────────────────────────────────────────────   ║
  1897→║                                                                               ║
  1898→║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
  1899→║   │                                                                         │ ║
  1900→║   │   Layer 1: 免费体验层（无需登录）                                       │ ║
  1901→║   │   ─────────────────────────────────────────────────────────────────     │ ║
  1902→║   │   • 无限对话                                                            │ ║
  1903→║   │   • AI 强制访谈                                                         │ ║
  1904→║   │   • 简版报告（综合判断卷首语 + 核心洞察 + 预览图）                       │ ║
  1905→║   │   • Daily Greeting                                                      │ ║
  1906→║   │                                                                         │ ║
  1907→║   │   目的：让用户充分体验「被深度理解」的价值                              │ ║
  1908→║   │   转化点：「解锁完整报告 + 专属海报 ¥19.9」                             │ ║
  1909→║   │                                                                         │ ║
  1910→║   │   ─────────────────────────────────────────────────────────────────     │ ║
  1911→║   │                                                                         │ ║
  1912→║   │   Layer 2: 付费层（注册 + 付费 ¥19.9）                                  │ ║
  1913→║   │   ─────────────────────────────────────────────────────────────────     │ ║
  1914→║   │   • 完整报告（精美网页呈现）                                            │ ║
  1915→║   │   • 详细图表（命盘/星盘可视化）                                         │ ║
  1916→║   │   • 高清 AI 生图海报（无水印，可下载）                                  │ ║
  1917→║   │   • 完整 Identity Prism                                                 │ ║
  1918→║   │   • 人生 K 线                                                           │ ║
  1919→║   │   • 对话历史保存                                                        │ ║
  1920→║   │                                                                         │ ║
  1921→║   └─────────────────────────────────────────────────────────────────────────┘ ║
  1922→║                                                                               ║
  1923→║   ─────────────────────────────────────────────────────────────────────────   ║
  1924→║                                                                               ║
  1925→║   订阅层（Phase 1）                                                           ║
  1926→║   ─────────────────────────────────────────────────────────────────────────   ║
  1927→║                                                                               ║
  1928→║   月度订阅：¥19.9/月                                                          ║
  1929→║   年度订阅：¥159/年（省 80 元）                                               ║
  1930→║                                                                               ║
  1931→║   订阅权益：                                                                  ║
  1932→║   • 无限报告生成（实际有 soft quota，防滥用）                                ║
  1933→║   • 无限对话次数（实际有 soft quota，防滥用）                                ║
  1934→║   • 高级功能解锁（Identity Prism、人生 K 线等）                              ║
  1935→║   • 关系分析报告（订阅期内可生成）                                           ║
  1936→║                                                                               ║
  1937→║   首月订阅说明：                                                              ║
  1938→║   • 购买报告套餐自动获得首月订阅                                             ║
  1939→║   • 首月结束后不自动续费                                                     ║
  1940→║   • 到期前 3 天推送续费提醒                                                  ║
  1941→║                                                                               ║
  1942→╚═══════════════════════════════════════════════════════════════════════════════╝
  1943→```
  1944→
  1945→## 5.2 增长策略
  1946→
  1947→```
  1948→┌─────────────────────────────────────────────────────────────────────────────┐
  1949→│                                                                             │
  1950→│   增长策略                                                                  │
  1951→│                                                                             │
  1952→│   ═══════════════════════════════════════════════════════════════════════   │
  1953→│                                                                             │
  1954→│   病毒传播引擎                                                              │
  1955→│   ─────────────────────────────────────────────────────────────────────     │
  1956→│                                                                             │
  1957→│   1. 关系卡片分享                                                           │
  1958→│      • 生成可分享的关系诊断卡                                               │
  1959→│      • 引导对方也来做分析                                                   │
  1960→│      • 形成传播闭环                                                         │
  1961→│                                                                             │
  1962→│   2. AI 生图报告分享                                                        │
  1963→│      • 精美的视觉化报告                                                     │
  1964→│      • 天然适合社交媒体分享                                                 │
  1965→│      • 带 VibeLife 水印                                                     │
  1966→│                                                                             │
  1967→│   3. Identity Prism 分享                                                    │
  1968→│      • 「我的三元人格」卡片                                                 │
  1969→│      • 引发好奇：「我也想知道我的」                                         │
  1970→│                                                                             │
  1971→│   ─────────────────────────────────────────────────────────────────────     │
  1972→│                                                                             │
  1973→│   内容营销                                                                  │
  1974→│   ─────────────────────────────────────────────────────────────────────     │
  1975→│                                                                             │
  1976→│   • 节气/天象相关内容（自然流量）                                           │
  1977→│   • 「你是什么类型的人」测试类内容                                          │
  1978→│   • 关系话题（高分享性）                                                    │
  1979→│                                                                             │
  1980→│   ─────────────────────────────────────────────────────────────────────     │
  1981→│                                                                             │
  1982→│   渠道策略                                                                  │
  1983→│   ─────────────────────────────────────────────────────────────────────     │
  1984→│                                                                             │
  1985→│   • 小红书：AI 生图报告展示                                                 │
  1986→│   • 微博：节气/天象内容                                                     │
  1987→│   • 抖音：关系话题短视频                                                    │
  1988→│   • 知乎：深度命理内容                                                      │
  1989→│                                                                             │
  1990→└─────────────────────────────────────────────────────────────────────────────┘
  1991→```
  1992→
  1993→## 5.3 核心指标体系
  1994→
  1995→```
  1996→╔═══════════════════════════════════════════════════════════════════════════════╗
  1997→║                                                                               ║
  1998→║   核心指标体系                                                                ║
  1999→║                                                                               ║

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
