     1â†’"use client";
     2â†’
     3â†’import { useRef, useEffect, useMemo, useCallback, useState } from "react";
     4â†’import type { UIMessage } from "@ai-sdk/react";
     5â†’import { ChatMessage } from "./ChatMessage";
     6â†’import { ChatInput } from "./ChatInput";
     7â†’import { InsightCard, InsightType } from "@/components/insight/InsightCard";
     8â†’import { VibeGlyph, BreathAura, type SkillType } from "@/components/core";
     9â†’import { DailyGreeting } from "@/components/greeting/DailyGreeting";
    10â†’import { useVibeChat, type SkillId } from "@/hooks/useVibeChat";
    11â†’
    12â†’interface InsightData {
    13â†’  id: string;
    14â†’  insight_type: InsightType;
    15â†’  title: string;
    16â†’  content: string;
    17â†’}
    18â†’
    19â†’/**
    20â†’ * Extract text content from AI SDK Message
    21â†’ * Handles both old (content string) and new (parts array) formats
    22â†’ */
    23â†’function getMessageContent(message: UIMessage): string {
    24â†’  // First try direct content property (ai/react format)
    25â†’  const directContent = (message as unknown as { content?: string }).content;
    26â†’  if (directContent) {
    27â†’    return directContent;
    28â†’  }
    29â†’
    30â†’  // Then try parts array (@ai-sdk/react format)
    31â†’  if (message.parts && message.parts.length > 0) {
    32â†’    return message.parts
    33â†’      .filter((part): part is { type: 'text'; text: string } => part.type === 'text')
    34â†’      .map(part => part.text)
    35â†’      .join('');
    36â†’  }
    37â†’
    38â†’  return '';
    39â†’}
    40â†’
    41â†’export type VoiceMode = "warm" | "sarcastic";
    42â†’
    43â†’export interface ChatContainerProps {
    44â†’  skillId: string;
    45â†’  skill?: SkillType;
    46â†’  conversationId?: string;
    47â†’  voiceMode?: VoiceMode;
    48â†’  onConversationStart?: (id: string) => void;
    49â†’}
    50â†’
    51â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    52â†’// ChatEmptyState - LUMINOUS PAPER Design System
    53â†’// ç©ºçŠ¶æ€ï¼šå±…ä¸­ VibeGlyph + æŠ€èƒ½æ„ŸçŸ¥æ–‡æ¡ˆ + å‘¼å¸å…‰æ™•
    54â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    55â†’
    56â†’const SKILL_EMPTY_STATE: Record<SkillType, { title: string; subtitle: string }> = {
    57â†’  bazi: {
    58â†’    title: "æ¢ç´¢ä½ çš„å‘½ç†",
    59â†’    subtitle: "åˆ†äº«ä½ çš„ç”Ÿè¾°ï¼Œå¼€å¯å…«å­—è§£è¯»ä¹‹æ—…",
    60â†’  },
    61â†’  zodiac: {
    62â†’    title: "å€¾å¬æ˜Ÿè¾°çš„å£°éŸ³",
    63â†’    subtitle: "è®©æ˜Ÿç›˜ä¸ºä½ æ­ç¤ºå®‡å®™çš„å¯†è¯­",
    64â†’  },
    65â†’  mbti: {
    66â†’    title: "å‘ç°çœŸå®çš„è‡ªå·±",
    67â†’    subtitle: "é€šè¿‡å¯¹è¯ï¼Œæ¢ç´¢ä½ çš„äººæ ¼ç‰¹è´¨",
    68â†’  },
    69â†’  attach: {
    70â†’    title: "ç†è§£ä½ çš„ä¾æ‹æ¨¡å¼",
    71â†’    subtitle: "æ¢ç´¢äº²å¯†å…³ç³»ä¸­çš„è‡ªæˆ‘",
    72â†’  },
    73â†’  career: {
    74â†’    title: "è§„åˆ’ä½ çš„èŒä¸šè“å›¾",
    75â†’    subtitle: "è®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢ä½ çš„èŒä¸šå‘å±•æ–¹å‘",
    76â†’  },
    77â†’};
    78â†’
    79â†’// Quick prompts for each skill with icons and categories
    80â†’interface QuickPromptItem {
    81â†’  icon: string;
    82â†’  category: string;
    83â†’  question: string;
    84â†’  gradient: string;
    85â†’}
    86â†’
    87â†’const SKILL_QUICK_PROMPTS: Record<SkillType, QuickPromptItem[]> = {
    88â†’  bazi: [
    89â†’    { icon: "ğŸ‚", category: "ç”Ÿè¾°ä¿¡æ¯", question: "æˆ‘æ˜¯1990å¹´5æœˆ15æ—¥æ—©ä¸Š8ç‚¹å‡ºç”Ÿçš„", gradient: "from-blue-500/10 to-cyan-500/10" },
    90â†’    { icon: "ğŸ“ˆ", category: "è¿åŠ¿åˆ†æ", question: "å¸®æˆ‘åˆ†æä»Šå¹´çš„è¿åŠ¿", gradient: "from-purple-500/10 to-pink-500/10" },
    91â†’    { icon: "ğŸ’¼", category: "äº‹ä¸šå‘å±•", question: "æˆ‘çš„äº‹ä¸šè¿å¦‚ä½•ï¼Ÿ", gradient: "from-orange-500/10 to-red-500/10" },
    92â†’    { icon: "â°", category: "æ—¶æœºé€‰æ‹©", question: "ä»€ä¹ˆæ—¶å€™é€‚åˆåšé‡å¤§å†³å®šï¼Ÿ", gradient: "from-green-500/10 to-teal-500/10" },
    93â†’  ],
    94â†’  zodiac: [
    95â†’    { icon: "â­", category: "è¿åŠ¿æŸ¥è¯¢", question: "æˆ‘æ˜¯åŒå­åº§ï¼Œå¸®æˆ‘çœ‹çœ‹æœ¬å‘¨è¿åŠ¿", gradient: "from-purple-500/10 to-pink-500/10" },
    96â†’    { icon: "ğŸŒ™", category: "æ˜Ÿç›˜è§£è¯»", question: "æˆ‘çš„å¤ªé˜³æ˜Ÿåº§å’Œä¸Šå‡æ˜Ÿåº§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ", gradient: "from-indigo-500/10 to-purple-500/10" },
    97â†’    { icon: "ğŸ’•", category: "å…³ç³»åŒ¹é…", question: "åŒå­åº§å’Œä»€ä¹ˆæ˜Ÿåº§æœ€é…ï¼Ÿ", gradient: "from-rose-500/10 to-pink-500/10" },
    98â†’    { icon: "ğŸŒ€", category: "æ˜Ÿè±¡å½±å“", question: "æ°´é€†å¯¹æˆ‘æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ", gradient: "from-blue-500/10 to-cyan-500/10" },
    99â†’  ],
   100â†’  mbti: [
   101â†’    { icon: "ğŸ”", category: "ç±»å‹æµ‹è¯•", question: "å¸®æˆ‘æµ‹æµ‹æˆ‘çš„MBTIç±»å‹", gradient: "from-blue-500/10 to-cyan-500/10" },
   102â†’    { icon: "ğŸ’¼", category: "èŒä¸šå»ºè®®", question: "INFPé€‚åˆä»€ä¹ˆèŒä¸šï¼Ÿ", gradient: "from-orange-500/10 to-amber-500/10" },
   103â†’    { icon: "ğŸ‘¥", category: "äººé™…å…³ç³»", question: "æˆ‘æ˜¯INTJï¼Œå¦‚ä½•æ”¹å–„äººé™…å…³ç³»ï¼Ÿ", gradient: "from-green-500/10 to-teal-500/10" },
   104â†’    { icon: "âš¡", category: "ç±»å‹å¯¹æ¯”", question: "Eäººå’ŒIäººæœ‰ä»€ä¹ˆæœ¬è´¨åŒºåˆ«ï¼Ÿ", gradient: "from-purple-500/10 to-pink-500/10" },
   105â†’  ],
   106â†’  attach: [
   107â†’    { icon: "ğŸ”", category: "ç±»å‹åˆ†æ", question: "å¸®æˆ‘åˆ†ææˆ‘çš„ä¾æ‹ç±»å‹", gradient: "from-blue-500/10 to-cyan-500/10" },
   108â†’    { icon: "ğŸ’‘", category: "å…³ç³»å»ºè®¾", question: "å›é¿å‹ä¾æ‹å¦‚ä½•å»ºç«‹äº²å¯†å…³ç³»ï¼Ÿ", gradient: "from-rose-500/10 to-pink-500/10" },
   109â†’    { icon: "ğŸ›¡ï¸", category: "å†…å¿ƒæ¢ç´¢", question: "ä¸ºä»€ä¹ˆæˆ‘æ€»æ˜¯å®³æ€•è¢«æŠ›å¼ƒï¼Ÿ", gradient: "from-amber-500/10 to-orange-500/10" },
   110â†’    { icon: "ğŸ’š", category: "è‡ªæˆ‘ç–—æ„ˆ", question: "å¦‚ä½•æ²»æ„ˆç«¥å¹´çš„æƒ…æ„Ÿåˆ›ä¼¤ï¼Ÿ", gradient: "from-green-500/10 to-teal-500/10" },
   111â†’  ],
   112â†’  career: [
   113â†’    { icon: "ğŸ¯", category: "èŒä¸šè§„åˆ’", question: "æˆ‘è¯¥å¦‚ä½•è§„åˆ’èŒä¸šå‘å±•ï¼Ÿ", gradient: "from-blue-500/10 to-cyan-500/10" },
   114â†’    { icon: "ğŸš€", category: "æ–¹å‘é€‰æ‹©", question: "æˆ‘é€‚åˆåˆ›ä¸šè¿˜æ˜¯æ‰“å·¥ï¼Ÿ", gradient: "from-orange-500/10 to-red-500/10" },
   115â†’    { icon: "ğŸ’ª", category: "é¢è¯•æŠ€å·§", question: "å¦‚ä½•åœ¨é¢è¯•ä¸­å±•ç°è‡ªå·±ï¼Ÿ", gradient: "from-green-500/10 to-teal-500/10" },
   116â†’    { icon: "ğŸ”„", category: "èŒä¸šè½¬å‹", question: "è½¬è¡Œéœ€è¦è€ƒè™‘ä»€ä¹ˆï¼Ÿ", gradient: "from-purple-500/10 to-pink-500/10" },
   117â†’  ],
   118â†’};
   119â†’
   120â†’// ç”Ÿæˆå½“æ—¥é—®å€™æ•°æ®
   121â†’function useDailyGreeting(skill: SkillType) {
   122â†’  return useMemo(() => {
   123â†’    const now = new Date();
   124â†’    const hour = now.getHours();
   125â†’    const month = now.getMonth();
   126â†’    const day = now.getDate();
   127â†’    const isoDate = now.toISOString().slice(0, 10);
   128â†’
   129â†’    // ç¡®å®šæ—¶æ®µ
   130â†’    type TimeOfDay = "dawn" | "morning" | "afternoon" | "evening" | "night";
   131â†’    let timeOfDay: TimeOfDay = "morning";
   132â†’    let greeting = "æ–°çš„ä¸€å¤©å¼€å§‹äº†";
   133â†’
   134â†’    if (hour >= 5 && hour < 7) {
   135â†’      timeOfDay = "dawn";
   136â†’      greeting = "æ™¨å…‰ç†¹å¾®";
   137â†’    } else if (hour >= 7 && hour < 12) {
   138â†’      timeOfDay = "morning";
   139â†’      greeting = "æ„¿ä½ èƒ½é‡æ»¡æ»¡";
   140â†’    } else if (hour >= 12 && hour < 18) {
   141â†’      timeOfDay = "afternoon";
   142â†’      greeting = "ä¿æŒä¸“æ³¨";
   143â†’    } else if (hour >= 18 && hour < 21) {
   144â†’      timeOfDay = "evening";
   145â†’      greeting = "è¾›è‹¦ä¸€å¤©äº†";
   146â†’    } else {
   147â†’      timeOfDay = "night";
   148â†’      greeting = "å¤œæ·±äº†ï¼Œæ—©ç‚¹ä¼‘æ¯";
   149â†’    }
   150â†’
   151â†’    // åŸºäºæ—¥æœŸè®¡ç®—èŠ‚æ°”ï¼ˆç®€åŒ–ç®—æ³•ï¼‰
   152â†’    const solarTerms = [
   153â†’      "å°å¯’", "å¤§å¯’", // 1æœˆ
   154â†’      "ç«‹æ˜¥", "é›¨æ°´", // 2æœˆ
   155â†’      "æƒŠè›°", "æ˜¥åˆ†", // 3æœˆ
   156â†’      "æ¸…æ˜", "è°·é›¨", // 4æœˆ
   157â†’      "ç«‹å¤", "å°æ»¡", // 5æœˆ
   158â†’      "èŠ’ç§", "å¤è‡³", // 6æœˆ
   159â†’      "å°æš‘", "å¤§æš‘", // 7æœˆ
   160â†’      "ç«‹ç§‹", "å¤„æš‘", // 8æœˆ
   161â†’      "ç™½éœ²", "ç§‹åˆ†", // 9æœˆ
   162â†’      "å¯’éœ²", "éœœé™", // 10æœˆ
   163â†’      "ç«‹å†¬", "å°é›ª", // 11æœˆ
   164â†’      "å¤§é›ª", "å†¬è‡³", // 12æœˆ
   165â†’    ];
   166â†’    const termIdx = month * 2 + (day >= 15 ? 1 : 0);
   167â†’    const solarTerm = solarTerms[termIdx % 24];
   168â†’
   169â†’    // åŸºäºèŠ‚æ°”çš„å»ºè®®
   170â†’    const seasonTips: Record<string, string> = {
   171â†’      å°å¯’: "å†¬è—æ—¶èŠ‚ï¼Œåˆ©äºå›é¡¾ä¸è§„åˆ’",
   172â†’      å¤§å¯’: "ä¸¥å¯’ä¹‹é™…ï¼Œè“„åŠ›å¾…å‘",
   173â†’      ç«‹æ˜¥: "ä¸‡ç‰©å¤è‹ï¼Œé€‚åˆå¯åŠ¨æ–°è®¡åˆ’",
   174â†’      é›¨æ°´: "æ¶¦ç‰©æ— å£°ï¼Œé™å¿ƒæ»‹å…»",
   175â†’      æƒŠè›°: "æ˜¥é›·æƒŠé†’ï¼Œè¡ŒåŠ¨èµ·æ¥",
   176â†’      æ˜¥åˆ†: "æ˜¼å¤œå¹³åˆ†ï¼Œè°ƒå’Œèº«å¿ƒ",
   177â†’      æ¸…æ˜: "å¤©æ¸…åœ°æ˜ï¼Œæ•´ç†æ€ç»ª",
   178â†’      è°·é›¨: "é›¨ç”Ÿç™¾è°·ï¼Œæ’­ç§å¸Œæœ›",
   179â†’      ç«‹å¤: "å¤æ°”æ¸ç››ï¼Œä¿æŒæ´»åŠ›",
   180â†’      å°æ»¡: "å°æœ‰æ‰€æˆï¼Œç»§ç»­åŠªåŠ›",
   181â†’      èŠ’ç§: "æ’­ç§æ”¶è·ï¼Œå‹¤å‹‰ä¸æ‡ˆ",
   182â†’      å¤è‡³: "é˜³æ°”é¼ç››ï¼Œé€‚åº¦ä¼‘æ¯",
   183â†’      å°æš‘: "æš‘æ°”åˆå‡ï¼Œæ¸…å¿ƒå®ç¥",
   184â†’      å¤§æš‘: "é…·æš‘éš¾è€ï¼Œé™ä»¥å…»å¿ƒ",
   185â†’      ç«‹ç§‹: "ç§‹æ„æ¸èµ·ï¼Œæ”¶è·æ—¶èŠ‚",
   186â†’      å¤„æš‘: "æš‘æ°”æ¸æ¶ˆï¼Œè°ƒæ•´èŠ‚å¥",
   187â†’      ç™½éœ²: "ç§‹å‡‰æ¸æµ“ï¼Œæ”¶æ•›å¿ƒç¥",
   188â†’      ç§‹åˆ†: "ç§‹é«˜æ°”çˆ½ï¼Œå¹³è¡¡å·¥ä½œä¸ç”Ÿæ´»",
   189â†’      å¯’éœ²: "éœ²æ°´æ¸å¯’ï¼Œæ³¨æ„ä¿å…»",
   190â†’      éœœé™: "éœœé™æ°´æ³½ï¼Œæ²‰æ·€ç§¯ç´¯",
   191â†’      ç«‹å†¬: "å†¬å­£æ¥ä¸´ï¼Œå‚¨å¤‡èƒ½é‡",
   192â†’      å°é›ª: "é›ªèŠ±åˆé™ï¼Œå†…çœæ—¶åˆ»",
   193â†’      å¤§é›ª: "ç‘é›ªå…†ä¸°ï¼Œé™å¾…æ¥å¹´",
   194â†’      å†¬è‡³: "ä¸€é˜³åˆç”Ÿï¼Œå¦ææ³°æ¥",
   195â†’    };
   196â†’
   197â†’    // åŸºäºæŠ€èƒ½çš„å…«å­—æç¤º
   198â†’    const baziHints: Record<string, string> = {
   199â†’      å°å¯’: "æ°´æ—ºä¹‹å­£ï¼Œåˆ©äºæ€è€ƒä¸è§„åˆ’",
   200â†’      å¤§å¯’: "æ°´æ°”æœ€ç››ï¼Œé€‚åˆå†…çœæ²‰æ·€",
   201â†’      ç«‹æ˜¥: "æœ¨æ°”åˆç”Ÿï¼Œå®œå¼€å¯æ–°äº‹ä¸š",
   202â†’      æ˜¥åˆ†: "æœ¨æ°”æ—ºç››ï¼Œé€‚åˆæ‹“å±•äººè„‰",
   203â†’      ç«‹å¤: "ç«æ°”æ¸å‡ï¼Œåˆ©äºè¡¨è¾¾å±•ç°",
   204â†’      å¤è‡³: "ç«æ°”æ­£ç››ï¼Œæ³¨æ„å¹³è¡¡",
   205â†’      ç«‹ç§‹: "é‡‘æ°”åˆç”Ÿï¼Œé€‚åˆå†³æ–­å–èˆ",
   206â†’      ç§‹åˆ†: "é‡‘æ°”æ—ºç››ï¼Œåˆ©äºæ”¶è·æˆæœ",
   207â†’      ç«‹å†¬: "æ°´æ°”åˆç”Ÿï¼Œå®œä¼‘å…»ç”Ÿæ¯",
   208â†’      å†¬è‡³: "ä¸€é˜³å¤å§‹ï¼Œåšç§¯è–„å‘",
   209â†’    };
   210â†’
   211â†’    // æ ¼å¼åŒ–æ—¥æœŸ
   212â†’    const dateStr = `${month + 1}æœˆ${day}æ—¥`;
   213â†’
   214â†’    // Deterministic "fortune index" for ritual UX (demo-grade)
   215â†’    const seedStr = `${isoDate}:${skill}:${solarTerm}:${timeOfDay}`;
   216â†’    let hash = 0;
   217â†’    for (let i = 0; i < seedStr.length; i += 1) {
   218â†’      hash = (hash * 31 + seedStr.charCodeAt(i)) % 100000;
   219â†’    }
   220â†’    const fortuneScore = Math.max(32, Math.min(92, 42 + (hash % 51)));
   221â†’    const fortuneHint = skill === "bazi"
   222â†’      ? (baziHints[solarTerm] || "ä»Šå¤©é€‚åˆç¨³ä½èŠ‚å¥ï¼ŒæŠŠåŠ›æ°”ç”¨åœ¨å…³é”®å¤„ã€‚")
   223â†’      : (seasonTips[solarTerm] || "ä»Šå¤©é€‚åˆæŠŠæ³¨æ„åŠ›æ”¶å›åˆ°è‡ªå·±èº«ä¸Šã€‚");
   224â†’
   225â†’    const actionText =
   226â†’      timeOfDay === "dawn" || timeOfDay === "morning"
   227â†’        ? "å†™ä¸‹ä»Šå¤©æœ€é‡è¦çš„ä¸€ä»¶äº‹ï¼Œå¹¶ç”¨ 25 åˆ†é’Ÿå¯åŠ¨å®ƒ"
   228â†’        : timeOfDay === "afternoon"
   229â†’          ? "æŠŠä¸€ä»¶æ‚¬è€Œæœªå†³çš„å°äº‹æ”¶å°¾ï¼Œç»™è‡ªå·±ä¸€ä¸ªç¡®å®šæ„Ÿ"
   230â†’          : timeOfDay === "evening"
   231â†’            ? "ç”¨ 10 åˆ†é’Ÿå¤ç›˜ä»Šå¤©ï¼šåšå¯¹äº†ä»€ä¹ˆã€ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆ"
   232â†’            : "å…³æœºå‰å†™ä¸€å¥æ„Ÿè°¢ï¼Œç»™å¤§è„‘ä¸€ä¸ªæŸ”è½¯çš„ç»“å°¾";
   233â†’
   234â†’    return {
   235â†’      greeting,
   236â†’      solarTerm,
   237â†’      timeOfDay,
   238â†’      date: dateStr,
   239â†’      isoDate,
   240â†’      todayTip: seasonTips[solarTerm] || "ä¸“æ³¨å½“ä¸‹ï¼Œç¨³æ­¥å‰è¡Œ",
   241â†’      baziHint: skill === "bazi" ? (baziHints[solarTerm] || null) : null,
   242â†’      fortuneScore,
   243â†’      fortuneHint,
   244â†’      actionText,
   245â†’    };
   246â†’  }, [skill]);
   247â†’}
   248â†’
   249â†’function ChatEmptyState({ skill, onQuickPrompt }: { skill: SkillType; onQuickPrompt?: (prompt: string) => void }) {
   250â†’  const config = SKILL_EMPTY_STATE[skill] || SKILL_EMPTY_STATE.bazi;
   251â†’  const quickPrompts = SKILL_QUICK_PROMPTS[skill] || SKILL_QUICK_PROMPTS.bazi;
   252â†’  const dailyData = useDailyGreeting(skill);
   253â†’  const actionKey = useMemo(
   254â†’    () => `vibelife-daily-action:${skill}:${dailyData.isoDate}`,
   255â†’    [skill, dailyData.isoDate]
   256â†’  );
   257â†’  const [actionCompleted, setActionCompleted] = useState(false);
   258â†’
   259â†’  useEffect(() => {
   260â†’    if (typeof window === "undefined") return;
   261â†’    try {
   262â†’      setActionCompleted(localStorage.getItem(actionKey) === "1");
   263â†’    } catch {
   264â†’      // ignore
   265â†’    }
   266â†’  }, [actionKey]);
   267â†’
   268â†’  const toggleAction = useCallback(() => {
   269â†’    setActionCompleted((prev) => {
   270â†’      const next = !prev;
   271â†’      try {
   272â†’        localStorage.setItem(actionKey, next ? "1" : "0");
   273â†’      } catch {
   274â†’        // ignore
   275â†’      }
   276â†’      return next;
   277â†’    });
   278â†’  }, [actionKey]);
   279â†’
   280â†’  const shareText = useMemo(() => {
   281â†’    const term = dailyData.solarTerm ? ` Â· ${dailyData.solarTerm}` : "";
   282â†’    return [
   283â†’      `VibeLife${term} Â· ${dailyData.date}`,
   284â†’      dailyData.greeting,
   285â†’      `è¿åŠ¿æŒ‡æ•°ï¼š${dailyData.fortuneScore}/100`,
   286â†’      `ä»Šæ—¥ä¸€æ­¥ï¼š${dailyData.actionText}`,
   287â†’      "#VibeLife",
   288â†’    ].join("\n");
   289â†’  }, [dailyData]);
   290â†’
   291â†’  return (
   292â†’    <div className="flex flex-col items-center justify-center max-w-xl mx-auto px-4 py-6 w-full">
   293â†’      {/* Daily Greeting æ¯æ—¥é—®å€™ */}
   294â†’      <DailyGreeting
   295â†’        greeting={dailyData.greeting}
   296â†’        solarTerm={dailyData.solarTerm}
   297â†’        timeOfDay={dailyData.timeOfDay}
   298â†’        date={dailyData.date}
   299â†’        todayTip={dailyData.todayTip}
   300â†’        baziHint={dailyData.baziHint || undefined}
   301â†’        fortuneScore={dailyData.fortuneScore}
   302â†’        fortuneHint={dailyData.fortuneHint}
   303â†’        actionItem={{ text: dailyData.actionText, completed: actionCompleted }}
   304â†’        onActionToggle={toggleAction}
   305â†’        shareText={shareText}
   306â†’        className="mb-6 w-full"
   307â†’      />
   308â†’
   309â†’      {/* Animated glyph with enhanced aura */}
   310â†’      <div className="relative flex items-center justify-center mb-4">
   311â†’        {/* Outer pulsing ring */}
   312â†’        <div className="absolute w-16 h-16 rounded-full border border-skill-primary/20 animate-pulse-slow" />
   313â†’        <div className="absolute w-24 h-24 rounded-full border border-skill-primary/10 animate-pulse-slower" />
   314â†’
   315â†’        {/* Breath aura */}
   316â†’        <BreathAura
   317â†’          skill={skill}
   318â†’          size="sm"
   319â†’          position="center"
   320â†’          intensity="medium"
   321â†’          className="opacity-40"
   322â†’        />
   323â†’
   324â†’        {/* Central glyph */}
   325â†’        <VibeGlyph
   326â†’          size="sm"
   327â†’          skill={skill}
   328â†’          showAura={true}
   329â†’          animate={true}
   330â†’          className="relative z-10"
   331â†’        />
   332â†’      </div>
   333â†’
   334â†’      {/* Title */}
   335â†’      <h3 className="text-base md:text-lg font-serif font-semibold text-foreground mb-1 text-center">
   336â†’        {config.title}
   337â†’      </h3>
   338â†’
   339â†’      {/* Subtitle */}
   340â†’      <p className="text-sm text-muted-foreground max-w-sm text-center mb-4">
   341â†’        {config.subtitle}
   342â†’      </p>
   343â†’
   344â†’      {/* Quick prompt suggestions */}
   345â†’      <div className="w-full space-y-3">
   346â†’        <p className="text-xs text-muted-foreground/60 text-center">
   347â†’          è¯•è¯•è¿™æ ·é—®
   348â†’        </p>
   349â†’        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
   350â†’          {quickPrompts.slice(0, 4).map((prompt, index) => (
   351â†’            <button
   352â†’              key={index}
   353â†’              onClick={() => onQuickPrompt?.(prompt.question)}
   354â†’              className={`
   355â†’                group relative px-3 py-3 text-left
   356â†’                bg-gradient-to-br ${prompt.gradient}
   357â†’                border border-border/50 hover:border-skill-primary/30
   358â†’                rounded-xl transition-all duration-200
   359â†’                hover:shadow-md hover:-translate-y-0.5
   360â†’              `}
   361â†’            >
   362â†’              <div className="flex items-start gap-2.5">
   363â†’                <span className="text-lg flex-shrink-0">{prompt.icon}</span>
   364â†’                <div className="flex-1 min-w-0">
   365â†’                  <span className="text-[10px] font-medium text-muted-foreground/70 uppercase tracking-wide">
   366â†’                    {prompt.category}
   367â†’                  </span>
   368â†’                  <p className="text-sm text-foreground line-clamp-2 mt-0.5">
   369â†’                    {prompt.question}
   370â†’                  </p>
   371â†’                </div>
   372â†’              </div>
   373â†’            </button>
   374â†’          ))}
   375â†’        </div>
   376â†’      </div>
   377â†’    </div>
   378â†’  );
   379â†’}
   380â†’
   381â†’export function ChatContainer({
   382â†’  skillId,
   383â†’  skill = "bazi",
   384â†’  conversationId,
   385â†’  voiceMode = "warm",
   386â†’  onConversationStart,
   387â†’}: ChatContainerProps) {
   388â†’  const messagesEndRef = useRef<HTMLDivElement>(null);
   389â†’
   390â†’  // Map skillId to SkillType if not provided
   391â†’  const activeSkill: SkillType = skill || (skillId as SkillType) || "bazi";
   392â†’
   393â†’  // Use AI SDK powered chat hook
   394â†’  const {
   395â†’    messages,
   396â†’    isLoading,
   397â†’    sendMessage,
   398â†’    sendQuickPrompt,
   399â†’    error,
   400â†’  } = useVibeChat({
   401â†’    skillId: (skillId || skill) as SkillId,
   402â†’    voiceMode,
   403â†’    conversationId,
   404â†’    onConversationStart,
   405â†’    onError: (err) => console.error("Chat error:", err),
   406â†’  });
   407â†’
   408â†’  const scrollToBottom = useCallback(() => {
   409â†’    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
   410â†’  }, []);
   411â†’
   412â†’  useEffect(() => {
   413â†’    scrollToBottom();
   414â†’  }, [messages, scrollToBottom]);
   415â†’
   416â†’  // Handle send from ChatInput
   417â†’  const handleSend = useCallback(
   418â†’    async (content: string) => {
   419â†’      await sendMessage(content);
   420â†’    },
   421â†’    [sendMessage]
   422â†’  );
   423â†’
   424â†’  // Handle quick prompt from empty state
   425â†’  const handleQuickPrompt = useCallback(
   426â†’    async (content: string) => {
   427â†’      await sendQuickPrompt(content);
   428â†’    },
   429â†’    [sendQuickPrompt]
   430â†’  );
   431â†’
   432â†’  const hasMessages = messages.length > 0;
   433â†’
   434â†’  return (
   435â†’    <div className="flex flex-col h-full" data-skill={activeSkill}>
   436â†’      {/* Messages area - always flex-1 to push input to bottom */}
   437â†’      <div className="flex-1 overflow-y-auto relative min-h-0">
   438â†’        {!hasMessages ? (
   439â†’          /* Empty state - centered within scrollable area */
   440â†’          <div className="flex flex-col items-center justify-end h-full pb-4 px-4">
   441â†’            <ChatEmptyState skill={activeSkill} onQuickPrompt={handleQuickPrompt} />
   442â†’          </div>
   443â†’        ) : (
   444â†’          /* Messages list - PCç«¯å·¦å¯¹é½ï¼Œç§»åŠ¨ç«¯å±…ä¸­ */
   445â†’          <div className="px-4 pt-4 pb-2 max-w-3xl lg:ml-4 lg:mr-auto mx-auto">
   446â†’            {messages.map((message) => (
   447â†’              <div key={message.id}>
   448â†’                <ChatMessage
   449â†’                  role={message.role as "user" | "assistant"}
   450â†’                  content={getMessageContent(message)}
   451â†’                  isStreaming={isLoading && message.role === "assistant" && message === messages[messages.length - 1]}
   452â†’                />
   453â†’              </div>
   454â†’            ))}
   455â†’            {/* Show loading indicator when waiting for first response chunk */}
   456â†’            {isLoading && messages.length > 0 && messages[messages.length - 1].role === "user" && (
   457â†’              <ChatMessage
   458â†’                role="assistant"
   459â†’                content=""
   460â†’                isStreaming
   461â†’              />
   462â†’            )}
   463â†’            {/* Show error message */}
   464â†’            {error && (
   465â†’              <div className="text-red-500 text-sm text-center py-2">
   466â†’                æŠ±æ­‰ï¼Œå‡ºäº†ç‚¹é—®é¢˜ã€‚è¯·ç¨åå†è¯•ã€‚
   467â†’              </div>
   468â†’            )}
   469â†’            <div ref={messagesEndRef} />
   470â†’          </div>
   471â†’        )}
   472â†’      </div>
   473â†’
   474â†’      {/* Input - fixed at bottom */}
   475â†’      <div className="flex-shrink-0">
   476â†’        <ChatInput onSend={handleSend} disabled={isLoading} />
   477â†’      </div>
   478â†’    </div>
   479â†’  );
   480â†’}
   481â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
