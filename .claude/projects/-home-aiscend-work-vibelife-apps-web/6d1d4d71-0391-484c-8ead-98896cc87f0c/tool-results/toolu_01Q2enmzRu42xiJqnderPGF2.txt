     1â†’/**
     2â†’ * Shared Tools - Available to all skills
     3â†’ *
     4â†’ * These tools provide common functionality across all skill types
     5â†’ */
     6â†’
     7â†’import { z } from "zod";
     8â†’import type { ToolDefinition } from "./types";
     9â†’
    10â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    11â†’// Show Report Tool
    12â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    13â†’
    14â†’const ShowReportParams = z.object({
    15â†’  reportId: z.string().optional().describe("Report ID to display"),
    16â†’  reportType: z.enum(["lite", "full"]).optional().default("lite").describe("Report type"),
    17â†’});
    18â†’
    19â†’export const showReportTool: ToolDefinition = {
    20â†’  name: "show_report",
    21â†’  description: "å±•ç¤ºç”¨æˆ·çš„å®Œæ•´æŠ¥å‘Šã€‚å½“ç”¨æˆ·æƒ³æŸ¥çœ‹æŠ¥å‘Šæˆ–éœ€è¦ç”Ÿæˆæ–°æŠ¥å‘Šæ—¶è°ƒç”¨ã€‚",
    22â†’  parameters: ShowReportParams,
    23â†’
    24â†’  async execute(params, context) {
    25â†’    const response = await fetch(`/api/v1/report/${params.reportId || "latest"}`, {
    26â†’      method: "GET",
    27â†’      headers: { "Content-Type": "application/json" },
    28â†’    });
    29â†’
    30â†’    if (!response.ok) {
    31â†’      throw new Error("è·å–æŠ¥å‘Šå¤±è´¥");
    32â†’    }
    33â†’
    34â†’    return response.json();
    35â†’  },
    36â†’
    37â†’  render(result: any) {
    38â†’    return (
    39â†’      <div className="report-card bg-card rounded-xl border p-4 my-2">
    40â†’        <div className="flex items-center justify-between mb-3">
    41â†’          <h3 className="font-semibold">{result.title || "ä¸ªäººæŠ¥å‘Š"}</h3>
    42â†’          <span className="text-xs text-muted-foreground">{result.createdAt}</span>
    43â†’        </div>
    44â†’        {result.prologue && (
    45â†’          <div className="prose prose-sm mb-4">
    46â†’            <p className="text-muted-foreground italic">{result.prologue}</p>
    47â†’          </div>
    48â†’        )}
    49â†’        <button className="w-full px-4 py-2 bg-primary text-primary-foreground rounded-lg text-sm">
    50â†’          æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š
    51â†’        </button>
    52â†’      </div>
    53â†’    );
    54â†’  },
    55â†’
    56â†’  toModelOutput(result: any) {
    57â†’    return `å·²å±•ç¤ºæŠ¥å‘Š: ${result.title}ã€‚åˆ›å»ºæ—¶é—´: ${result.createdAt}ã€‚`;
    58â†’  },
    59â†’};
    60â†’
    61â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    62â†’// Show Relationship Tool
    63â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    64â†’
    65â†’const ShowRelationshipParams = z.object({
    66â†’  relationshipId: z.string().optional().describe("Relationship analysis ID"),
    67â†’  partnerInfo: z.object({
    68â†’    name: z.string().optional(),
    69â†’    birthDate: z.string(),
    70â†’  }).optional().describe("Partner information for new analysis"),
    71â†’});
    72â†’
    73â†’export const showRelationshipTool: ToolDefinition = {
    74â†’  name: "show_relationship",
    75â†’  description: "å±•ç¤ºå…³ç³»åˆ†æç»“æœã€‚å½“ç”¨æˆ·æƒ³åˆ†æä¸ä»–äººçš„å…³ç³»å…¼å®¹æ€§æ—¶è°ƒç”¨ã€‚",
    76â†’  parameters: ShowRelationshipParams,
    77â†’
    78â†’  async execute(params, context) {
    79â†’    if (params.relationshipId) {
    80â†’      const response = await fetch(`/api/v1/relationship/${params.relationshipId}`);
    81â†’      return response.json();
    82â†’    }
    83â†’
    84â†’    // Create new analysis
    85â†’    const response = await fetch("/api/v1/relationship/analyze", {
    86â†’      method: "POST",
    87â†’      headers: { "Content-Type": "application/json" },
    88â†’      body: JSON.stringify({
    89â†’        partnerInfo: params.partnerInfo,
    90â†’        skill: context.skillId,
    91â†’      }),
    92â†’    });
    93â†’
    94â†’    return response.json();
    95â†’  },
    96â†’
    97â†’  render(result: any) {
    98â†’    return (
    99â†’      <div className="relationship-card bg-gradient-to-br from-rose-50 to-pink-50 dark:from-rose-950/30 dark:to-pink-950/30 rounded-xl border border-rose-200 dark:border-rose-800 p-4 my-2">
   100â†’        <h3 className="font-semibold text-rose-900 dark:text-rose-100 mb-3">
   101â†’          å…³ç³»åˆ†æ
   102â†’        </h3>
   103â†’        <div className="text-center py-4">
   104â†’          <div className="text-4xl font-bold text-rose-600 dark:text-rose-400">
   105â†’            {result.score || 85}%
   106â†’          </div>
   107â†’          <div className="text-sm text-muted-foreground mt-1">åŒ¹é…åº¦</div>
   108â†’        </div>
   109â†’        {result.summary && (
   110â†’          <p className="text-sm text-muted-foreground">{result.summary}</p>
   111â†’        )}
   112â†’      </div>
   113â†’    );
   114â†’  },
   115â†’
   116â†’  toModelOutput(result: any) {
   117â†’    return `å·²å±•ç¤ºå…³ç³»åˆ†æã€‚åŒ¹é…åº¦: ${result.score}%ã€‚${result.summary}`;
   118â†’  },
   119â†’};
   120â†’
   121â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   122â†’// Show Insight Tool
   123â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   124â†’
   125â†’const ShowInsightParams = z.object({
   126â†’  insightId: z.string().optional().describe("Specific insight ID"),
   127â†’  category: z.string().optional().describe("Insight category"),
   128â†’});
   129â†’
   130â†’export const showInsightTool: ToolDefinition = {
   131â†’  name: "show_insight",
   132â†’  description: "å±•ç¤ºæ´å¯Ÿå¡ç‰‡ã€‚å½“ç”¨æˆ·éœ€è¦çœ‹åˆ°å…³é”®æ´å¯Ÿæˆ–å»ºè®®æ—¶è°ƒç”¨ã€‚",
   133â†’  parameters: ShowInsightParams,
   134â†’
   135â†’  async execute(params, context) {
   136â†’    const response = await fetch(`/api/v1/users/insights?category=${params.category || ""}`);
   137â†’    return response.json();
   138â†’  },
   139â†’
   140â†’  render(result: any) {
   141â†’    const insights = result.insights || [result];
   142â†’
   143â†’    return (
   144â†’      <div className="insights-container space-y-2 my-2">
   145â†’        {insights.slice(0, 3).map((insight: any, index: number) => (
   146â†’          <div
   147â†’            key={index}
   148â†’            className="insight-card bg-gradient-to-r from-amber-50 to-yellow-50 dark:from-amber-950/30 dark:to-yellow-950/30 rounded-lg border border-amber-200 dark:border-amber-800 p-3"
   149â†’          >
   150â†’            <div className="flex items-start gap-2">
   151â†’              <span className="text-amber-600">ğŸ’¡</span>
   152â†’              <div>
   153â†’                <div className="font-medium text-sm">{insight.title}</div>
   154â†’                <p className="text-xs text-muted-foreground mt-1">{insight.content}</p>
   155â†’              </div>
   156â†’            </div>
   157â†’          </div>
   158â†’        ))}
   159â†’      </div>
   160â†’    );
   161â†’  },
   162â†’
   163â†’  toModelOutput(result: any) {
   164â†’    const count = result.insights?.length || 1;
   165â†’    return `å·²å±•ç¤º ${count} æ¡æ´å¯Ÿã€‚`;
   166â†’  },
   167â†’};
   168â†’
   169â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   170â†’// Request Info Tool (AI Interview)
   171â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   172â†’
   173â†’const RequestInfoParams = z.object({
   174â†’  infoType: z.enum(["birth", "context", "goals", "concerns"]).describe("Type of information to request"),
   175â†’  question: z.string().optional().describe("Custom question to ask"),
   176â†’});
   177â†’
   178â†’export const requestInfoTool: ToolDefinition = {
   179â†’  name: "request_info",
   180â†’  description: "å‘ç”¨æˆ·è¯·æ±‚æ›´å¤šä¿¡æ¯ä»¥æä¾›æ›´å‡†ç¡®çš„åˆ†æã€‚å½“éœ€è¦ç”¨æˆ·è¡¥å……å‡ºç”Ÿä¿¡æ¯ã€å½“å‰å›°å¢ƒæˆ–ç›®æ ‡æ—¶è°ƒç”¨ã€‚",
   181â†’  parameters: RequestInfoParams,
   182â†’
   183â†’  async execute(params) {
   184â†’    // This tool is special - it doesn't fetch data, it prompts the user
   185â†’    return {
   186â†’      infoType: params.infoType,
   187â†’      question: params.question,
   188â†’      fields: getFieldsForInfoType(params.infoType),
   189â†’    };
   190â†’  },
   191â†’
   192â†’  render(result: any) {
   193â†’    return (
   194â†’      <div className="info-request-card bg-blue-50 dark:bg-blue-950/30 rounded-xl border border-blue-200 dark:border-blue-800 p-4 my-2">
   195â†’        <div className="flex items-start gap-3">
   196â†’          <span className="text-2xl">ğŸ“</span>
   197â†’          <div className="flex-1">
   198â†’            <div className="font-medium mb-2">
   199â†’              {result.question || getDefaultQuestion(result.infoType)}
   200â†’            </div>
   201â†’            <div className="space-y-2">
   202â†’              {result.fields.map((field: any, index: number) => (
   203â†’                <div key={index}>
   204â†’                  <label className="text-sm text-muted-foreground block mb-1">
   205â†’                    {field.label}
   206â†’                  </label>
   207â†’                  <input
   208â†’                    type={field.type}
   209â†’                    placeholder={field.placeholder}
   210â†’                    className="w-full px-3 py-2 rounded-lg border bg-background text-sm"
   211â†’                  />
   212â†’                </div>
   213â†’              ))}
   214â†’            </div>
   215â†’            <button className="mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg text-sm">
   216â†’              æäº¤
   217â†’            </button>
   218â†’          </div>
   219â†’        </div>
   220â†’      </div>
   221â†’    );
   222â†’  },
   223â†’
   224â†’  toModelOutput(result: any) {
   225â†’    return `æ­£åœ¨è¯·æ±‚ç”¨æˆ·æä¾›æ›´å¤šä¿¡æ¯: ${result.infoType}`;
   226â†’  },
   227â†’};
   228â†’
   229â†’// Helper functions
   230â†’function getFieldsForInfoType(infoType: string) {
   231â†’  switch (infoType) {
   232â†’    case "birth":
   233â†’      return [
   234â†’        { id: "birthDate", label: "å‡ºç”Ÿæ—¥æœŸ", type: "date", placeholder: "" },
   235â†’        { id: "birthTime", label: "å‡ºç”Ÿæ—¶é—´", type: "time", placeholder: "" },
   236â†’        { id: "birthPlace", label: "å‡ºç”Ÿåœ°ç‚¹", type: "text", placeholder: "åŸå¸‚å" },
   237â†’      ];
   238â†’    case "context":
   239â†’      return [
   240â†’        { id: "situation", label: "å½“å‰æƒ…å†µ", type: "text", placeholder: "æè¿°ä½ ç›®å‰é¢ä¸´çš„æƒ…å†µ" },
   241â†’      ];
   242â†’    case "goals":
   243â†’      return [
   244â†’        { id: "goals", label: "ä½ çš„ç›®æ ‡", type: "text", placeholder: "ä½ æƒ³è¾¾æˆä»€ä¹ˆ" },
   245â†’      ];
   246â†’    case "concerns":
   247â†’      return [
   248â†’        { id: "concerns", label: "ä½ çš„å›°æƒ‘", type: "text", placeholder: "æœ€å›°æ‰°ä½ çš„æ˜¯ä»€ä¹ˆ" },
   249â†’      ];
   250â†’    default:
   251â†’      return [];
   252â†’  }
   253â†’}
   254â†’
   255â†’function getDefaultQuestion(infoType: string) {
   256â†’  switch (infoType) {
   257â†’    case "birth":
   258â†’      return "ä¸ºäº†ç»™ä½ æ›´å‡†ç¡®çš„åˆ†æï¼Œè¯·æä¾›ä½ çš„å‡ºç”Ÿä¿¡æ¯";
   259â†’    case "context":
   260â†’      return "èƒ½å‘Šè¯‰æˆ‘ä½ ç›®å‰çš„æƒ…å†µå—ï¼Ÿ";
   261â†’    case "goals":
   262â†’      return "ä½ å¸Œæœ›è¾¾æˆä»€ä¹ˆç›®æ ‡ï¼Ÿ";
   263â†’    case "concerns":
   264â†’      return "ä»€ä¹ˆæ˜¯ä½ æœ€å…³å¿ƒçš„é—®é¢˜ï¼Ÿ";
   265â†’    default:
   266â†’      return "è¯·æä¾›æ›´å¤šä¿¡æ¯";
   267â†’  }
   268â†’}
   269â†’
   270â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   271â†’// Export all shared tools
   272â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   273â†’
   274â†’export const sharedTools: ToolDefinition[] = [
   275â†’  showReportTool,
   276â†’  showRelationshipTool,
   277â†’  showInsightTool,
   278â†’  requestInfoTool,
   279â†’];
   280â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
