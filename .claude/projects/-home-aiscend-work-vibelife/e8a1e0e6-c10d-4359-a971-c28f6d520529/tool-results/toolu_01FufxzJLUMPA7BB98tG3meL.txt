     1â†’"use client";
     2â†’
     3â†’import Link from "next/link";
     4â†’import { ArrowLeft, FileText, MessageSquare, LayoutDashboard, Settings } from "lucide-react";
     5â†’import { LuminousPaper, VibeGlyph, BreathAura, type SkillType } from "@/components/core";
     6â†’import { IconButton } from "@/components/ui/Button";
     7â†’import { InsightPanel, MobileInsightBar, type InsightPanelProps } from "@/components/insight/InsightPanel";
     8â†’import { cn } from "@/lib/utils";
     9â†’
    10â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    11â†’// ChatLayout - LUMINOUS PAPER Design System
    12â†’// ç»Ÿä¸€èŠå¤©é¡µé¢å¸ƒå±€ï¼š
    13â†’// - PCç«¯ï¼šåŒæ å¸ƒå±€ï¼ˆå·¦ä¾§ Insight Panel + å³ä¾§ Chat Streamï¼‰
    14â†’// - ç§»åŠ¨ç«¯ï¼šå•æ å¸ƒå±€ï¼ˆå¯æŠ˜å é¡¶éƒ¨ Insight Bar + Chat Streamï¼‰
    15â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    16â†’
    17â†’type VoiceMode = "warm" | "sarcastic";
    18â†’
    19â†’interface ChatLayoutProps {
    20â†’  skill: SkillType;
    21â†’  title: string;
    22â†’  backHref: string;
    23â†’  onViewProfile?: () => void;
    24â†’  children: React.ReactNode;
    25â†’  // Insight panel props
    26â†’  profile?: InsightPanelProps["profile"];
    27â†’  insights?: InsightPanelProps["insights"];
    28â†’  onInsightClick?: InsightPanelProps["onInsightClick"];
    29â†’  // Tab navigation (optional)
    30â†’  activeTab?: "chat" | "chart" | "settings";
    31â†’  onTabChange?: (tab: "chat" | "chart" | "settings") => void;
    32â†’  // Voice mode
    33â†’  voiceMode?: VoiceMode;
    34â†’  onVoiceModeToggle?: () => void;
    35â†’}
    36â†’
    37â†’const SKILL_CONFIG: Record<SkillType, { profileLabel: string; chartLabel: string }> = {
    38â†’  bazi: { profileLabel: "æŸ¥çœ‹å‘½ç›˜", chartLabel: "å‘½ç›˜" },
    39â†’  zodiac: { profileLabel: "æŸ¥çœ‹æ˜Ÿç›˜", chartLabel: "æ˜Ÿç›˜" },
    40â†’  mbti: { profileLabel: "æŸ¥çœ‹æ¡£æ¡ˆ", chartLabel: "æ¡£æ¡ˆ" },
    41â†’  attach: { profileLabel: "æŸ¥çœ‹æ¡£æ¡ˆ", chartLabel: "æ¡£æ¡ˆ" },
    42â†’  career: { profileLabel: "æŸ¥çœ‹æ¡£æ¡ˆ", chartLabel: "æ¡£æ¡ˆ" },
    43â†’};
    44â†’
    45â†’export function ChatLayout({
    46â†’  skill,
    47â†’  title,
    48â†’  backHref,
    49â†’  onViewProfile,
    50â†’  children,
    51â†’  profile,
    52â†’  insights,
    53â†’  onInsightClick,
    54â†’  activeTab = "chat",
    55â†’  onTabChange,
    56â†’  voiceMode = "warm",
    57â†’  onVoiceModeToggle,
    58â†’}: ChatLayoutProps) {
    59â†’  const config = SKILL_CONFIG[skill];
    60â†’
    61â†’  return (
    62â†’    <LuminousPaper skill={skill} variant="default" className="h-screen flex flex-col">
    63â†’      {/* Background aura */}
    64â†’      <BreathAura skill={skill} size="xl" position="top" intensity="low" className="opacity-40" />
    65â†’
    66â†’      {/* Glass Header */}
    67â†’      <header className="nav">
    68â†’        <div className="nav-container">
    69â†’          {/* Left: Back + Logo + Title */}
    70â†’          <div className="flex items-center gap-3">
    71â†’            <Link href={backHref} className="nav-link flex items-center gap-1">
    72â†’              <ArrowLeft className="w-4 h-4" />
    73â†’              <span className="hidden sm:inline">è¿”å›</span>
    74â†’            </Link>
    75â†’            <div className="flex items-center gap-2">
    76â†’              <VibeGlyph size="sm" skill={skill} showAura={false} animate={false} />
    77â†’              <span className="font-serif font-semibold text-foreground">{title}</span>
    78â†’            </div>
    79â†’          </div>
    80â†’
    81â†’          {/* Center: Tab Navigation (PC only) */}
    82â†’          {onTabChange && (
    83â†’            <div className="hidden lg:flex items-center gap-1 bg-muted/30 rounded-full p-1">
    84â†’              <button
    85â†’                onClick={() => onTabChange("chat")}
    86â†’                className={cn(
    87â†’                  "px-4 py-1.5 text-sm rounded-full transition-all duration-200",
    88â†’                  activeTab === "chat"
    89â†’                    ? "bg-card text-foreground shadow-sm"
    90â†’                    : "text-muted-foreground hover:text-foreground"
    91â†’                )}
    92â†’              >
    93â†’                <MessageSquare className="w-4 h-4 inline mr-1.5" />
    94â†’                å¯¹è¯
    95â†’              </button>
    96â†’              <button
    97â†’                onClick={() => onTabChange("chart")}
    98â†’                className={cn(
    99â†’                  "px-4 py-1.5 text-sm rounded-full transition-all duration-200",
   100â†’                  activeTab === "chart"
   101â†’                    ? "bg-card text-foreground shadow-sm"
   102â†’                    : "text-muted-foreground hover:text-foreground"
   103â†’                )}
   104â†’              >
   105â†’                <LayoutDashboard className="w-4 h-4 inline mr-1.5" />
   106â†’                {config.chartLabel}
   107â†’              </button>
   108â†’            </div>
   109â†’          )}
   110â†’
   111â†’          {/* Right: Voice Toggle + Profile Button */}
   112â†’          <div className="flex items-center gap-2">
   113â†’            {/* Voice Mode Toggle */}
   114â†’            {onVoiceModeToggle && (
   115â†’              <button
   116â†’                onClick={onVoiceModeToggle}
   117â†’                className={cn(
   118â†’                  "px-3 py-1.5 text-xs font-medium rounded-full transition-all duration-200",
   119â†’                  voiceMode === "warm"
   120â†’                    ? "bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300"
   121â†’                    : "bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300"
   122â†’                )}
   123â†’                title={voiceMode === "warm" ? "åˆ‡æ¢åˆ°åæ§½æ¨¡å¼" : "åˆ‡æ¢åˆ°æ¸©æš–æ¨¡å¼"}
   124â†’              >
   125â†’                {voiceMode === "warm" ? "ğŸŒ æ¸©æš–" : "ğŸ˜ˆ åæ§½"}
   126â†’              </button>
   127â†’            )}
   128â†’            {onViewProfile && (
   129â†’              <IconButton
   130â†’                variant="ghost"
   131â†’                size="sm"
   132â†’                onClick={onViewProfile}
   133â†’                aria-label={config.profileLabel}
   134â†’              >
   135â†’                <FileText className="w-5 h-5" />
   136â†’              </IconButton>
   137â†’            )}
   138â†’          </div>
   139â†’        </div>
   140â†’      </header>
   141â†’
   142â†’      {/* Main Content - Responsive Layout */}
   143â†’      <div className="flex-1 overflow-hidden relative flex">
   144â†’        {/* Left Sidebar - Insight Panel (PC only, >= 1024px) */}
   145â†’        <aside className="hidden lg:block w-80 flex-shrink-0">
   146â†’          <InsightPanel
   147â†’            skill={skill}
   148â†’            profile={profile}
   149â†’            insights={insights}
   150â†’            onViewFullProfile={onViewProfile}
   151â†’            onInsightClick={onInsightClick}
   152â†’          />
   153â†’        </aside>
   154â†’
   155â†’        {/* Right Content - Chat Area */}
   156â†’        <div className="flex-1 flex flex-col min-w-0 overflow-hidden">
   157â†’          {/* Mobile Insight Bar (< 1024px) */}
   158â†’          <div className="lg:hidden">
   159â†’            <MobileInsightBar
   160â†’              skill={skill}
   161â†’              profile={profile}
   162â†’              onViewFullProfile={onViewProfile}
   163â†’            />
   164â†’          </div>
   165â†’
   166â†’          {/* Chat Content */}
   167â†’          <div className="flex-1 overflow-hidden">
   168â†’            {children}
   169â†’          </div>
   170â†’        </div>
   171â†’      </div>
   172â†’    </LuminousPaper>
   173â†’  );
   174â†’}
   175â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
