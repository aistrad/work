     1→"use client";
     2→
     3→import { useState } from "react";
     4→import { motion, AnimatePresence } from "framer-motion";
     5→import { cn } from "@/lib/utils";
     6→import { ChevronDown, ChevronUp, Sparkles, RefreshCw, Clock, Sprout } from "lucide-react";
     7→import { VibeGlyph, type SkillType } from "@/components/core";
     8→import { InsightCard, MiniInsightCard, type InsightType } from "./InsightCard";
     9→
    10→// ═══════════════════════════════════════════════════════════════════════════
    11→// InsightPanel - LUMINOUS PAPER Design System
    12→// 左侧洞察面板：显示用户命盘/星盘摘要 + 洞察卡片列表
    13→// PC端显示为固定侧边栏，移动端显示为可折叠顶部卡片
    14→// ═══════════════════════════════════════════════════════════════════════════
    15→
    16→// Bazi profile summary for demo
    17→interface BaziProfile {
    18→  dayMaster: string;
    19→  pattern: string;
    20→  currentLuck: string;
    21→  pillars: {
    22→    year: { stem: string; branch: string };
    23→    month: { stem: string; branch: string };
    24→    day: { stem: string; branch: string };
    25→    hour?: { stem: string; branch: string };
    26→  };
    27→}
    28→
    29→interface ZodiacProfile {
    30→  sunSign: string;
    31→  moonSign?: string;
    32→  risingSign?: string;
    33→  currentTransit?: string;
    34→}
    35→
    36→interface MbtiProfile {
    37→  type: string;
    38→  dominantFunction?: string;
    39→  secondaryFunction?: string;
    40→}
    41→
    42→// Generic profile type
    43→type ProfileData = BaziProfile | ZodiacProfile | MbtiProfile | null;
    44→
    45→interface InsightItem {
    46→  id: string;
    47→  type: InsightType;
    48→  title: string;
    49→  content: string;
    50→}
    51→
    52→export interface InsightPanelProps {
    53→  skill: SkillType;
    54→  profile?: ProfileData;
    55→  insights?: InsightItem[];
    56→  onViewFullProfile?: () => void;
    57→  onInsightClick?: (insight: InsightItem) => void;
    58→  className?: string;
    59→}
    60→
    61→// Skill-specific profile display
    62→const SKILL_PROFILE_LABELS: Record<SkillType, {
    63→  title: string;
    64→  viewFullLabel: string;
    65→}> = {
    66→  bazi: { title: "你的命盘", viewFullLabel: "查看完整命盘" },
    67→  zodiac: { title: "你的星盘", viewFullLabel: "查看完整星盘" },
    68→  mbti: { title: "你的人格档案", viewFullLabel: "查看完整档案" },
    69→  attach: { title: "你的依恋档案", viewFullLabel: "查看完整档案" },
    70→  career: { title: "你的职业档案", viewFullLabel: "查看完整档案" },
    71→};
    72→
    73→// ═══════════════════════════════════════════════════════════════════════════
    74→// BaziProfileCard - 八字命盘摘要卡片
    75→// ═══════════════════════════════════════════════════════════════════════════
    76→function BaziProfileCard({ profile, onViewFull }: { profile: BaziProfile; onViewFull?: () => void }) {
    77→  return (
    78→    <div className="glass-card rounded-xl p-4 space-y-4">
    79→      {/* Pillars */}
    80→      <div className="grid grid-cols-3 gap-2 text-center">
    81→        <div className="space-y-1">
    82→          <span className="text-xs text-muted-foreground">年柱</span>
    83→          <div className="font-serif text-lg text-foreground">{profile.pillars.year.stem}</div>
    84→          <div className="font-serif text-base text-muted-foreground">{profile.pillars.year.branch}</div>
    85→        </div>
    86→        <div className="space-y-1">
    87→          <span className="text-xs text-muted-foreground">月柱</span>
    88→          <div className="font-serif text-lg text-foreground">{profile.pillars.month.stem}</div>
    89→          <div className="font-serif text-base text-muted-foreground">{profile.pillars.month.branch}</div>
    90→        </div>
    91→        <div className="space-y-1">
    92→          <span className="text-xs text-muted-foreground">日柱</span>
    93→          <div className="font-serif text-lg text-foreground">{profile.pillars.day.stem}</div>
    94→          <div className="font-serif text-base text-muted-foreground">{profile.pillars.day.branch}</div>
    95→        </div>
    96→      </div>
    97→
    98→      {/* Summary info */}
    99→      <div className="space-y-1.5 text-sm">
   100→        <div className="flex justify-between">
   101→          <span className="text-muted-foreground">日主</span>
   102→          <span className="font-medium text-foreground">{profile.dayMaster}</span>
   103→        </div>
   104→        <div className="flex justify-between">
   105→          <span className="text-muted-foreground">格局</span>
   106→          <span className="font-medium text-foreground">{profile.pattern}</span>
   107→        </div>
   108→        <div className="flex justify-between">
   109→          <span className="text-muted-foreground">当前大运</span>
   110→          <span className="font-medium text-foreground">{profile.currentLuck}</span>
   111→        </div>
   112→      </div>
   113→
   114→      {/* View full button */}
   115→      {onViewFull && (
   116→        <button
   117→          onClick={onViewFull}
   118→          className="w-full text-center text-sm text-skill-primary hover:underline py-2"
   119→        >
   120→          查看完整命盘
   121→        </button>
   122→      )}
   123→    </div>
   124→  );
   125→}
   126→
   127→// ═══════════════════════════════════════════════════════════════════════════
   128→// ZodiacProfileCard - 星盘摘要卡片
   129→// ═══════════════════════════════════════════════════════════════════════════
   130→function ZodiacProfileCard({ profile, onViewFull }: { profile: ZodiacProfile; onViewFull?: () => void }) {
   131→  return (
   132→    <div className="glass-card rounded-xl p-4 space-y-4">
   133→      {/* Main signs */}
   134→      <div className="grid grid-cols-3 gap-2 text-center">
   135→        <div className="space-y-1">
   136→          <span className="text-xs text-muted-foreground">太阳</span>
   137→          <div className="font-serif text-lg text-foreground">{profile.sunSign}</div>
   138→        </div>
   139→        {profile.moonSign && (
   140→          <div className="space-y-1">
   141→            <span className="text-xs text-muted-foreground">月亮</span>
   142→            <div className="font-serif text-lg text-foreground">{profile.moonSign}</div>
   143→          </div>
   144→        )}
   145→        {profile.risingSign && (
   146→          <div className="space-y-1">
   147→            <span className="text-xs text-muted-foreground">上升</span>
   148→            <div className="font-serif text-lg text-foreground">{profile.risingSign}</div>
   149→          </div>
   150→        )}
   151→      </div>
   152→
   153→      {/* Current transit */}
   154→      {profile.currentTransit && (
   155→        <div className="text-sm text-center text-muted-foreground">
   156→          当前星象：{profile.currentTransit}
   157→        </div>
   158→      )}
   159→
   160→      {/* View full button */}
   161→      {onViewFull && (
   162→        <button
   163→          onClick={onViewFull}
   164→          className="w-full text-center text-sm text-skill-primary hover:underline py-2"
   165→        >
   166→          查看完整星盘
   167→        </button>
   168→      )}
   169→    </div>
   170→  );
   171→}
   172→
   173→// ═══════════════════════════════════════════════════════════════════════════
   174→// MbtiProfileCard - MBTI 档案摘要卡片
   175→// ═══════════════════════════════════════════════════════════════════════════
   176→function MbtiProfileCard({ profile, onViewFull }: { profile: MbtiProfile; onViewFull?: () => void }) {
   177→  return (
   178→    <div className="glass-card rounded-xl p-4 space-y-4">
   179→      {/* Type display */}
   180→      <div className="text-center">
   181→        <div className="font-serif text-3xl font-bold text-foreground tracking-wider">
   182→          {profile.type}
   183→        </div>
   184→        {profile.dominantFunction && (
   185→          <div className="text-sm text-muted-foreground mt-1">
   186→            主导功能：{profile.dominantFunction}
   187→          </div>
   188→        )}
   189→      </div>
   190→
   191→      {/* View full button */}
   192→      {onViewFull && (
   193→        <button
   194→          onClick={onViewFull}
   195→          className="w-full text-center text-sm text-skill-primary hover:underline py-2"
   196→        >
   197→          查看完整档案
   198→        </button>
   199→      )}
   200→    </div>
   201→  );
   202→}
   203→
   204→// ═══════════════════════════════════════════════════════════════════════════
   205→// ProfileCard - 根据 skill 类型渲染对应的档案卡片
   206→// ═══════════════════════════════════════════════════════════════════════════
   207→function ProfileCard({ skill, profile, onViewFull }: {
   208→  skill: SkillType;
   209→  profile: ProfileData;
   210→  onViewFull?: () => void;
   211→}) {
   212→  if (!profile) return null;
   213→
   214→  switch (skill) {
   215→    case "bazi":
   216→      return <BaziProfileCard profile={profile as BaziProfile} onViewFull={onViewFull} />;
   217→    case "zodiac":
   218→      return <ZodiacProfileCard profile={profile as ZodiacProfile} onViewFull={onViewFull} />;
   219→    case "mbti":
   220→      return <MbtiProfileCard profile={profile as MbtiProfile} onViewFull={onViewFull} />;
   221→    default:
   222→      return null;
   223→  }
   224→}
   225→
   226→// ═══════════════════════════════════════════════════════════════════════════
   227→// InsightPanel - PC 端左侧面板
   228→// ═══════════════════════════════════════════════════════════════════════════
   229→export function InsightPanel({
   230→  skill,
   231→  profile,
   232→  insights = [],
   233→  onViewFullProfile,
   234→  onInsightClick,
   235→  className,
   236→}: InsightPanelProps) {
   237→  const labels = SKILL_PROFILE_LABELS[skill];
   238→
   239→  return (
   240→    <div
   241→      className={cn(
   242→        "h-full overflow-y-auto",
   243→        "bg-card border-r border-border shadow-sm",
   244→        "p-5 space-y-6",
   245→        className
   246→      )}
   247→    >
   248→      {/* Profile Section */}
   249→      <div>
   250→        <h2 className="font-serif text-lg font-semibold text-foreground mb-3">
   251→          {labels.title}
   252→        </h2>
   253→        {profile ? (
   254→          <ProfileCard skill={skill} profile={profile} onViewFull={onViewFullProfile} />
   255→        ) : (
   256→          <div className="glass-card rounded-xl p-4 text-center">
   257→            <VibeGlyph size="md" skill={skill} className="mx-auto mb-3" />
   258→            <p className="text-sm text-muted-foreground">
   259→              开始对话后，这里会显示你的档案摘要
   260→            </p>
   261→          </div>
   262→        )}
   263→      </div>
   264→
   265→      {/* Insights Section */}
   266→      {insights.length > 0 && (
   267→        <div>
   268→          <h2 className="font-serif text-lg font-semibold text-foreground mb-3">
   269→            洞察卡片
   270→          </h2>
   271→          <div className="space-y-3">
   272→            {insights.map((insight) => (
   273→              <MiniInsightCard
   274→                key={insight.id}
   275→                type={insight.type}
   276→                title={insight.title}
   277→                onClick={() => onInsightClick?.(insight)}
   278→              />
   279→            ))}
   280→          </div>
   281→        </div>
   282→      )}
   283→    </div>
   284→  );
   285→}
   286→
   287→// ═══════════════════════════════════════════════════════════════════════════
   288→// MobileInsightBar - 移动端顶部可折叠栏
   289→// ═══════════════════════════════════════════════════════════════════════════
   290→export function MobileInsightBar({
   291→  skill,
   292→  profile,
   293→  onViewFullProfile,
   294→  className,
   295→}: Omit<InsightPanelProps, "insights" | "onInsightClick">) {
   296→  const [isExpanded, setIsExpanded] = useState(false);
   297→  const labels = SKILL_PROFILE_LABELS[skill];
   298→
   299→  // Only show if there's profile data
   300→  if (!profile) return null;
   301→
   302→  // Generate summary text based on skill
   303→  const getSummaryText = () => {
   304→    switch (skill) {
   305→      case "bazi": {
   306→        const p = profile as BaziProfile;
   307→        return `日主: ${p.dayMaster} | 格局: ${p.pattern} | 大运: ${p.currentLuck}`;
   308→      }
   309→      case "zodiac": {
   310→        const p = profile as ZodiacProfile;
   311→        return `太阳: ${p.sunSign}${p.moonSign ? ` | 月亮: ${p.moonSign}` : ""}${p.risingSign ? ` | 上升: ${p.risingSign}` : ""}`;
   312→      }
   313→      case "mbti": {
   314→        const p = profile as MbtiProfile;
   315→        return `类型: ${p.type}${p.dominantFunction ? ` | ${p.dominantFunction}` : ""}`;
   316→      }
   317→      default:
   318→        return "";
   319→    }
   320→  };
   321→
   322→  return (
   323→    <div className={cn("glass-subtle mx-4 mt-2 rounded-lg overflow-hidden", className)}>
   324→      {/* Collapsed bar */}
   325→      <button
   326→        onClick={() => setIsExpanded(!isExpanded)}
   327→        className="w-full flex items-center justify-between p-3 text-left"
   328→      >
   329→        <span className="text-xs text-muted-foreground truncate flex-1">
   330→          {getSummaryText()}
   331→        </span>
   332→        {isExpanded ? (
   333→          <ChevronUp className="w-4 h-4 text-muted-foreground flex-shrink-0 ml-2" />
   334→        ) : (
   335→          <ChevronDown className="w-4 h-4 text-muted-foreground flex-shrink-0 ml-2" />
   336→        )}
   337→      </button>
   338→
   339→      {/* Expanded content */}
   340→      <AnimatePresence>
   341→        {isExpanded && (
   342→          <motion.div
   343→            initial={{ height: 0, opacity: 0 }}
   344→            animate={{ height: "auto", opacity: 1 }}
   345→            exit={{ height: 0, opacity: 0 }}
   346→            transition={{ duration: 0.2 }}
   347→            className="overflow-hidden"
   348→          >
   349→            <div className="px-3 pb-3">
   350→              <ProfileCard skill={skill} profile={profile} onViewFull={onViewFullProfile} />
   351→            </div>
   352→          </motion.div>
   353→        )}
   354→      </AnimatePresence>
   355→    </div>
   356→  );
   357→}
   358→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
