apps/api/services/agent/prompt_builder.py:22:    get_skill_required_data
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-23-)
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-24-from .routing_config import get_phase1_prompt, get_sop_template
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-25-from .context_manager import SessionContext
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-26-
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-27-logger = logging.getLogger(__name__)
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-28-
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-29-
apps/api/services/agent/prompt_builder.py-30-class PromptBuilder:
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-31-    """
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-32-    System Prompt 构建器
--
apps/api/services/agent/prompt_builder.py:198:            skill_ids = get_skill_required_data(skill_id)
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-199-
apps/api/services/agent/prompt_builder.py-200-            for sid in skill_ids:
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-201-                data = skill_data.get(sid, {})
apps/api/services/agent/prompt_builder.py-202-                if data:
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-203-                    # 过滤掉内部字段（以 _ 开头）
apps/api/services/agent/prompt_builder.py-204-                    filtered_data = {k: v for k, v in data.items() if not k.startswith("_")}
apps/api/services/agent/prompt_builder.py-205-                    if filtered_data:
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-206-                        parts.append(f"\n## {sid} 数据\n\n```json\n{json.dumps(filtered_data, ensure_ascii=False, indent=2)}\n```")
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-207-
/home/aiscend/work/vibelife/apps/api/services/agent/prompt_builder.py-208-        return "\n".join(parts) if parts else ""
--
apps/api/services/agent/context_manager.py:395:            from .skill_loader import get_skill_required_data
/home/aiscend/work/vibelife/apps/api/services/agent/context_manager.py-396-            skill_data_store = profile.get("skill_data", {})
apps/api/services/agent/context_manager.py:397:            skill_ids = get_skill_required_data(skill_id)
/home/aiscend/work/vibelife/apps/api/services/agent/context_manager.py-398-
apps/api/services/agent/context_manager.py-399-            if len(skill_ids) == 1:
/home/aiscend/work/vibelife/apps/api/services/agent/context_manager.py-400-                # 单一 skill_data
/home/aiscend/work/vibelife/apps/api/services/agent/context_manager.py-401-                context["skill_data"] = skill_data_store.get(skill_ids[0], {})
apps/api/services/agent/context_manager.py-402-            else:
/home/aiscend/work/vibelife/apps/api/services/agent/context_manager.py-403-                # 跨 skill_data（如 jungastro 需要 bazi + zodiac）
/home/aiscend/work/vibelife/apps/api/services/agent/context_manager.py-404-                context["skill_data"] = {
apps/api/services/agent/context_manager.py-405-                    sid: skill_data_store.get(sid, {})
/home/aiscend/work/vibelife/apps/api/services/agent/context_manager.py-406-                    for sid in skill_ids
/home/aiscend/work/vibelife/apps/api/services/agent/context_manager.py-407-                }
--
apps/api/services/agent/skill_loader.py:873:def get_skill_required_data(skill_id: str) -> List[str]:
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-874-    """获取 Skill 需要的 skill_data 列表（配置驱动）- v2.2
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-875-
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-876-    返回值：
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-877-    - 配置的 skill_data 列表（如 ["bazi", "zodiac"]）
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-878-    - 空列表时返回 [skill_id]（默认只需自身数据）
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-879-
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-880-    示例：
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-881-    - bazi → ["bazi"]（默认，只需自身）
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-882-    - jungastro → ["bazi", "zodiac"]（配置了 requires_skill_data）
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-883-    - vibe_id → ["bazi", "zodiac"]（配置了 requires_skill_data）