     1→/**
     2→ * Account Deletion Section
     3→ * GDPR-compliant account deletion with 30-day grace period
     4→ */
     5→"use client";
     6→
     7→import { useState, useEffect } from "react";
     8→import { Button } from "@/components/ui/Button";
     9→import {
    10→  requestAccountDeletion,
    11→  cancelAccountDeletion,
    12→  getAccountDeletionStatus,
    13→  type DeletionStatusResponse,
    14→} from "@/lib/api";
    15→
    16→export function AccountDeletionSection() {
    17→  const [status, setStatus] = useState<DeletionStatusResponse | null>(null);
    18→  const [isLoading, setIsLoading] = useState(true);
    19→  const [error, setError] = useState<string | null>(null);
    20→  const [showConfirmation, setShowConfirmation] = useState(false);
    21→
    22→  // Load current deletion status
    23→  useEffect(() => {
    24→    loadStatus();
    25→  }, []);
    26→
    27→  const loadStatus = async () => {
    28→    try {
    29→      setIsLoading(true);
    30→      const result = await getAccountDeletionStatus();
    31→      setStatus(result);
    32→    } catch (err) {
    33→      setError(err instanceof Error ? err.message : "Failed to load status");
    34→    } finally {
    35→      setIsLoading(false);
    36→    }
    37→  };
    38→
    39→  const handleRequestDeletion = async () => {
    40→    try {
    41→      setIsLoading(true);
    42→      setError(null);
    43→      const result = await requestAccountDeletion();
    44→      setStatus(result);
    45→      setShowConfirmation(false);
    46→    } catch (err) {
    47→      setError(err instanceof Error ? err.message : "Request failed");
    48→    } finally {
    49→      setIsLoading(false);
    50→    }
    51→  };
    52→
    53→  const handleCancelDeletion = async () => {
    54→    try {
    55→      setIsLoading(true);
    56→      setError(null);
    57→      const result = await cancelAccountDeletion();
    58→      setStatus(result);
    59→    } catch (err) {
    60→      setError(err instanceof Error ? err.message : "Cancellation failed");
    61→    } finally {
    62→      setIsLoading(false);
    63→    }
    64→  };
    65→
    66→  if (isLoading && !status) {
    67→    return (
    68→      <div className="p-6 bg-bg-secondary rounded-xl">
    69→        <div className="animate-pulse">
    70→          <div className="h-6 bg-bg-tertiary rounded w-1/3 mb-4"></div>
    71→          <div className="h-4 bg-bg-tertiary rounded w-2/3"></div>
    72→        </div>
    73→      </div>
    74→    );
    75→  }
    76→
    77→  const isPendingDeletion = status?.status === "pending_deletion";
    78→
    79→  return (
    80→    <div className="p-6 bg-bg-secondary rounded-xl">
    81→      <h3 className="text-lg font-semibold text-text-primary mb-2">
    82→        账户管理
    83→      </h3>
    84→
    85→      {/* Error Display */}
    86→      {error && (
    87→        <div className="mb-4 p-3 rounded-lg bg-error/10 border border-error/20">
    88→          <p className="text-error text-sm">{error}</p>
    89→        </div>
    90→      )}
    91→
    92→      {/* Pending Deletion State */}
    93→      {isPendingDeletion && status && (
    94→        <div className="mb-4 p-4 rounded-lg bg-warning/10 border border-warning/20">
    95→          <div className="flex items-start gap-3">
    96→            <WarningIcon className="w-5 h-5 text-warning flex-shrink-0 mt-0.5" />
    97→            <div>
    98→              <p className="text-text-primary font-medium">账户删除已申请</p>
    99→              <p className="text-sm text-text-secondary mt-1">
   100→                你的账户将于{" "}
   101→                <span className="font-medium text-text-primary">
   102→                  {status.deletion_scheduled_at
   103→                    ? new Date(status.deletion_scheduled_at).toLocaleDateString("zh-CN")
   104→                    : "30天后"}
   105→                </span>{" "}
   106→                被永久删除。
   107→              </p>
   108→              <p className="text-sm text-text-tertiary mt-2">
   109→                在此之前，你可以随时取消删除申请并恢复账户。
   110→              </p>
   111→            </div>
   112→          </div>
   113→          <Button
   114→            variant="secondary"
   115→            className="mt-4"
   116→            onClick={handleCancelDeletion}
   117→            isLoading={isLoading}
   118→          >
   119→            取消删除申请
   120→          </Button>
   121→        </div>
   122→      )}
   123→
   124→      {/* Normal State */}
   125→      {!isPendingDeletion && (
   126→        <>
   127→          <p className="text-text-secondary text-sm mb-4">
   128→            删除账户将永久移除你的所有数据，包括个人资料、对话记录和订阅信息。
   129→            此操作有 30 天的冷静期，期间你可以取消删除。
   130→          </p>
   131→
   132→          {!showConfirmation ? (
   133→            <Button
   134→              variant="secondary"
   135→              className="text-error hover:text-error hover:bg-error/10"
   136→              onClick={() => setShowConfirmation(true)}
   137→            >
   138→              删除账户
   139→            </Button>
   140→          ) : (
   141→            <div className="p-4 rounded-lg bg-error/5 border border-error/20">
   142→              <p className="text-text-primary font-medium mb-2">
   143→                确定要删除账户吗？
   144→              </p>
   145→              <p className="text-sm text-text-secondary mb-4">
   146→                账户将进入 30 天冷静期，之后所有数据将被永久删除。
   147→              </p>
   148→              <div className="flex gap-3">
   149→                <Button
   150→                  variant="secondary"
   151→                  onClick={() => setShowConfirmation(false)}
   152→                >
   153→                  取消
   154→                </Button>
   155→                <Button
   156→                  variant="primary"
   157→                  className="bg-error hover:bg-error/90"
   158→                  onClick={handleRequestDeletion}
   159→                  isLoading={isLoading}
   160→                >
   161→                  确认删除
   162→                </Button>
   163→              </div>
   164→            </div>
   165→          )}
   166→        </>
   167→      )}
   168→
   169→      {/* Info */}
   170→      <div className="mt-6 pt-4 border-t border-border-default">
   171→        <p className="text-xs text-text-tertiary">
   172→          如需导出数据，请在删除账户前使用「导出数据」功能。
   173→          如有任何问题，请联系{" "}
   174→          <a href="mailto:support@vibelife.app" className="text-accent-primary hover:underline">
   175→            support@vibelife.app
   176→          </a>
   177→        </p>
   178→      </div>
   179→    </div>
   180→  );
   181→}
   182→
   183→function WarningIcon({ className }: { className?: string }) {
   184→  return (
   185→    <svg
   186→      className={className}
   187→      viewBox="0 0 24 24"
   188→      fill="none"
   189→      stroke="currentColor"
   190→      strokeWidth="2"
   191→    >
   192→      <path d="M12 9v3m0 3h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" />
   193→    </svg>
   194→  );
   195→}
   196→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
