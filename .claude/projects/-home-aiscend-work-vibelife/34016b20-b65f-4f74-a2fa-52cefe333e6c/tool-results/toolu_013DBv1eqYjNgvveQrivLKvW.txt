     1→"use client";
     2→
     3→import { useState, KeyboardEvent, useRef, useEffect } from "react";
     4→import { cn } from "@/lib/utils";
     5→import { Send, Mic, Paperclip } from "lucide-react";
     6→
     7→// ═══════════════════════════════════════════════════════════════════════════
     8→// ChatInput - LUMINOUS PAPER Design System
     9→// Omnibar 玻璃胶囊样式：frosted glass 输入框
    10→// ═══════════════════════════════════════════════════════════════════════════
    11→
    12→export interface ChatInputProps {
    13→  onSend: (message: string) => void;
    14→  onFileSelect?: (file: File) => void;
    15→  disabled?: boolean;
    16→  placeholder?: string;
    17→  showMediaButtons?: boolean;
    18→  className?: string;
    19→}
    20→
    21→export function ChatInput({
    22→  onSend,
    23→  onFileSelect,
    24→  disabled,
    25→  placeholder = "有什么想问的...",
    26→  showMediaButtons = true,
    27→  className,
    28→}: ChatInputProps) {
    29→  const [message, setMessage] = useState("");
    30→  const textareaRef = useRef<HTMLTextAreaElement>(null);
    31→  const fileInputRef = useRef<HTMLInputElement>(null);
    32→
    33→  // Auto-resize textarea
    34→  useEffect(() => {
    35→    const textarea = textareaRef.current;
    36→    if (textarea) {
    37→      textarea.style.height = "auto";
    38→      textarea.style.height = `${Math.min(textarea.scrollHeight, 120)}px`;
    39→    }
    40→  }, [message]);
    41→
    42→  const handleSend = () => {
    43→    if (message.trim() && !disabled) {
    44→      onSend(message.trim());
    45→      setMessage("");
    46→      // Reset height
    47→      if (textareaRef.current) {
    48→        textareaRef.current.style.height = "auto";
    49→      }
    50→    }
    51→  };
    52→
    53→  const handleKeyDown = (e: KeyboardEvent<HTMLTextAreaElement>) => {
    54→    if (e.key === "Enter" && !e.shiftKey) {
    55→      e.preventDefault();
    56→      handleSend();
    57→    }
    58→  };
    59→
    60→  const canSend = message.trim().length > 0 && !disabled;
    61→
    62→  const handleFileClick = () => {
    63→    fileInputRef.current?.click();
    64→  };
    65→
    66→  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    67→    const file = e.target.files?.[0];
    68→    if (file && onFileSelect) {
    69→      onFileSelect(file);
    70→    }
    71→    // Reset input
    72→    if (fileInputRef.current) {
    73→      fileInputRef.current.value = "";
    74→    }
    75→  };
    76→
    77→  return (
    78→    <div className={cn("p-4 md:px-6 pb-6", className)}>
    79→      {/* Hidden file input */}
    80→      <input
    81→        ref={fileInputRef}
    82→        type="file"
    83→        accept="image/*,.pdf,.txt,.docx"
    84→        onChange={handleFileChange}
    85→        className="hidden"
    86→        disabled={disabled}
    87→      />
    88→
    89→      {/* Gradient fade above input */}
    90→      <div className="h-8 bg-gradient-to-t from-background to-transparent -mt-8 mb-4 pointer-events-none" />
    91→
    92→      <div className="max-w-3xl mx-auto">
    93→        <div className="omnibar shadow-lg shadow-black/5">
    94→          {/* Media buttons (optional) */}
    95→          {showMediaButtons && (
    96→            <>
    97→              <button
    98→                type="button"
    99→                onClick={handleFileClick}
   100→                className="omnibar-btn"
   101→                aria-label="上传文件"
   102→                disabled={disabled}
   103→              >
   104→                <Paperclip className="w-5 h-5" />
   105→              </button>
   106→              <button
   107→                type="button"
   108→                className="omnibar-btn"
   109→                aria-label="语音输入"
   110→                disabled={disabled}
   111→              >
   112→                <Mic className="w-5 h-5" />
   113→              </button>
   114→            </>
   115→          )}
   116→
   117→          {/* Input */}
   118→          <textarea
   119→            ref={textareaRef}
   120→            value={message}
   121→            onChange={(e) => setMessage(e.target.value)}
   122→            onKeyDown={handleKeyDown}
   123→            placeholder={placeholder}
   124→            disabled={disabled}
   125→            rows={1}
   126→            className="omnibar-input"
   127→            style={{ minHeight: "24px", maxHeight: "120px" }}
   128→          />
   129→
   130→          {/* Send button with animation */}
   131→          <button
   132→            type="button"
   133→            onClick={handleSend}
   134→            disabled={!canSend}
   135→            className={cn(
   136→              "omnibar-send transition-all duration-300",
   137→              canSend
   138→                ? "scale-100 opacity-100"
   139→                : "scale-90 opacity-50 cursor-not-allowed"
   140→            )}
   141→            aria-label="发送消息"
   142→          >
   143→            <Send className="w-5 h-5" />
   144→          </button>
   145→        </div>
   146→
   147→        {/* Hint text */}
   148→        <p className="text-center text-xs text-muted-foreground/60 mt-3">
   149→          按 Enter 发送，Shift+Enter 换行
   150→        </p>
   151→      </div>
   152→    </div>
   153→  );
   154→}
   155→
   156→// ═══════════════════════════════════════════════════════════════════════════
   157→// QuickReplies - Suggested quick reply buttons
   158→// ═══════════════════════════════════════════════════════════════════════════
   159→
   160→interface QuickRepliesProps {
   161→  replies: string[];
   162→  onSelect: (reply: string) => void;
   163→  className?: string;
   164→}
   165→
   166→export function QuickReplies({ replies, onSelect, className }: QuickRepliesProps) {
   167→  if (replies.length === 0) return null;
   168→
   169→  return (
   170→    <div className={cn("flex flex-wrap gap-2 px-4 pb-2", className)}>
   171→      {replies.map((reply, index) => (
   172→        <button
   173→          key={index}
   174→          onClick={() => onSelect(reply)}
   175→          className={cn(
   176→            "px-3 py-1.5 text-sm rounded-full",
   177→            "bg-muted/50 text-muted-foreground",
   178→            "border border-border/50",
   179→            "hover:bg-muted hover:text-foreground",
   180→            "transition-colors duration-200"
   181→          )}
   182→        >
   183→          {reply}
   184→        </button>
   185→      ))}
   186→    </div>
   187→  );
   188→}
   189→
   190→// ═══════════════════════════════════════════════════════════════════════════
   191→// FloatingOmnibar - Floating version for landing pages
   192→// ═══════════════════════════════════════════════════════════════════════════
   193→
   194→interface FloatingOmnibarProps {
   195→  onSend: (message: string) => void;
   196→  placeholder?: string;
   197→  className?: string;
   198→}
   199→
   200→export function FloatingOmnibar({
   201→  onSend,
   202→  placeholder = "输入你的出生日期开始...",
   203→  className,
   204→}: FloatingOmnibarProps) {
   205→  const [value, setValue] = useState("");
   206→
   207→  const handleSubmit = () => {
   208→    if (value.trim()) {
   209→      onSend(value.trim());
   210→      setValue("");
   211→    }
   212→  };
   213→
   214→  return (
   215→    <div className={cn("glass-card p-6 max-w-lg mx-auto", className)}>
   216→      <div className="omnibar">
   217→        <input
   218→          type="text"
   219→          value={value}
   220→          onChange={(e) => setValue(e.target.value)}
   221→          onKeyDown={(e) => e.key === "Enter" && handleSubmit()}
   222→          placeholder={placeholder}
   223→          className="omnibar-input"
   224→        />
   225→        <button
   226→          onClick={handleSubmit}
   227→          disabled={!value.trim()}
   228→          className={cn(
   229→            "omnibar-send",
   230→            !value.trim() && "opacity-50 cursor-not-allowed"
   231→          )}
   232→        >
   233→          <Send className="w-5 h-5" />
   234→        </button>
   235→      </div>
   236→    </div>
   237→  );
   238→}
   239→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
