   147→class UnifiedProfileRepository:
   148→    """统一 Profile 数据访问层"""
   149→
   150→    # ═══════════════════════════════════════════════════════════════════════════
   151→    # 读取操作
   152→    # ═══════════════════════════════════════════════════════════════════════════
   153→
   154→    @staticmethod
   155→    async def get_profile(user_id: UUID) -> Optional[Dict[str, Any]]:
   156→        """获取完整 Profile"""
   157→        row = await fetchrow(
   158→            "SELECT profile FROM unified_profiles WHERE user_id = $1",
   159→            user_id
   160→        )
   161→        if not row:
   162→            return None
   163→
   164→        profile = row["profile"]
   165→        if isinstance(profile, str):
   166→            profile = json.loads(profile)
   167→        return profile
   168→
   169→    @staticmethod
   170→    async def get_birth_info(user_id: UUID) -> Dict[str, Any]:
   171→        """获取出生信息"""
   172→        profile = await UnifiedProfileRepository.get_profile(user_id)
   173→        return profile.get("birth_info", {}) if profile else {}
   174→
   175→    @staticmethod
   176→    async def get_skill_data(user_id: UUID, skill: str) -> Dict[str, Any]:
   177→        """获取 Skill 数据"""
   178→        profile = await UnifiedProfileRepository.get_profile(user_id)
   179→        if profile:
   180→            return profile.get("skill_data", {}).get(skill, {})
   181→        return {}
   182→
   183→    @staticmethod
   184→    async def get_all_skill_data(user_id: UUID) -> Dict[str, Any]:
   185→        """获取所有 Skill 数据"""
   186→        profile = await UnifiedProfileRepository.get_profile(user_id)
   187→        if profile:
   188→            return profile.get("skill_data", {})
   189→        return {}
   190→
   191→    @staticmethod
   192→    async def get_preferences(user_id: UUID) -> Dict[str, Any]:
   193→        """获取用户偏好"""
   194→        profile = await UnifiedProfileRepository.get_profile(user_id)
   195→        if profile:
   196→            return profile.get("preferences", {"voice_mode": "warm", "language": "zh-CN"})
   197→        return {"voice_mode": "warm", "language": "zh-CN"}
   198→
   199→    @staticmethod
   200→    async def get_life_context(user_id: UUID) -> Dict[str, Any]:
   201→        """获取生活上下文"""
   202→        profile = await UnifiedProfileRepository.get_profile(user_id)
   203→        if profile:
   204→            return profile.get("life_context", {})
   205→        return {}
   206→
   207→    @staticmethod
   208→    async def get_account(user_id: UUID) -> Dict[str, Any]:
   209→        """
   210→        获取账户信息 (从 vibe_users 同步)
   211→
   212→        Returns:
   213→            {
   214→                "vibe_id": "VB-A1B2C3D4",
   215→                "display_name": "用户昵称",
   216→                "tier": "free",
   217→                "status": "active"
   218→            }
   219→        """
   220→        profile = await UnifiedProfileRepository.get_profile(user_id)
   221→        if profile:
   222→            return profile.get("account", {})
   223→        return {}
   224→
   225→    @staticmethod
   226→    async def get_state(user_id: UUID) -> Dict[str, Any]:
   227→        """
   228→        获取用户状态
   229→
   230→        Returns:
   231→            {
   232→                "focus": ["career", "health"],
   233→                "updated_at": "2026-01-19T10:00:00Z"
   234→            }
   235→        """
   236→        profile = await UnifiedProfileRepository.get_profile(user_id)
   237→        if profile:
   238→            return profile.get("state", {"focus": [], "updated_at": None})
   239→        return {"focus": [], "updated_at": None}
   240→
   241→    @staticmethod
   242→    async def get_focus(user_id: UUID) -> List[str]:
   243→        """获取用户当前关注的话题"""
   244→        state = await UnifiedProfileRepository.get_state(user_id)
   245→        return state.get("focus", [])
   246→
   247→    @staticmethod
   248→    async def get_tier(user_id: UUID) -> str:
   249→        """获取用户等级 (free, basic, pro, enterprise)"""
   250→        account = await UnifiedProfileRepository.get_account(user_id)
   251→        return account.get("tier", "free")
   252→
   253→    @staticmethod
   254→    async def get_account_full(user_id: UUID) -> Dict[str, Any]:
   255→        """
   256→        获取完整账户信息（替代 UserRepository.get_by_id）
   257→
   258→        Returns:
   259→            完整的账户+偏好信息，包括：
   260→            {
   261→                "vibe_id": "VB-xxx",
   262→                "display_name": "用户昵称",
   263→                "avatar_url": "https://...",
   264→                "tier": "free",
   265→                "status": "active",
   266→                "timezone": "Asia/Shanghai",
   267→                "language": "zh-CN",
   268→                "deletion_requested_at": null,
   269→                "deletion_scheduled_at": null
   270→            }
   271→        """
   272→        profile = await UnifiedProfileRepository.get_profile(user_id)
   273→        if not profile:
   274→            return {}
   275→
   276→        account = profile.get("account", {})
   277→        prefs = profile.get("preferences", {})
   278→
   279→        return {
   280→            "vibe_id": account.get("vibe_id"),
   281→            "display_name": account.get("display_name"),
   282→            "avatar_url": account.get("avatar_url"),
   283→            "tier": account.get("tier", "free"),
   284→            "status": account.get("status", "active"),
   285→            "timezone": prefs.get("timezone", "Asia/Shanghai"),
   286→            "language": prefs.get("language", "zh-CN"),
   287→            "deletion_requested_at": account.get("deletion_requested_at"),
   288→            "deletion_scheduled_at": account.get("deletion_scheduled_at"),
   289→        }
   290→
   291→    # ═══════════════════════════════════════════════════════════════════════════
   292→    # 写入操作
   293→    # ═══════════════════════════════════════════════════════════════════════════
   294→
   295→    @staticmethod
   296→    async def create_profile(user_id: UUID, initial_profile: Dict[str, Any] = None) -> Dict[str, Any]:

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
