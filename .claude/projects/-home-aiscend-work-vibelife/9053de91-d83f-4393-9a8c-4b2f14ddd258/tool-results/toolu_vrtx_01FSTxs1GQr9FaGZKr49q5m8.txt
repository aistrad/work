  1400→    ) -> List[str]:
  1401→        """列出生活上下文的所有路径"""
  1402→        profile = await UnifiedProfileRepository.get_profile(user_id)
  1403→        if not profile:
  1404→            return []
  1405→
  1406→        life_context = profile.get("life_context", {})
  1407→        paths = life_context.get("_paths", {})
  1408→
  1409→        result = []
  1410→        for path in paths.keys():
  1411→            if path_prefix and not path.startswith(path_prefix):
  1412→                continue
  1413→            result.append(path)
  1414→
  1415→        result.sort()
  1416→        return result
  1417→
  1418→    # ═══════════════════════════════════════════════════════════════════════════
  1419→    # 缓存管理
  1420→    # ═══════════════════════════════════════════════════════════════════════════
  1421→
  1422→    @staticmethod
  1423→    async def _invalidate_cache(user_id: UUID, skill: str = None) -> None:
  1424→        """
  1425→        失效缓存
  1426→
  1427→        Args:
  1428→            user_id: 用户 ID
  1429→            skill: 如果指定，只失效该 skill 的缓存；否则失效所有缓存
  1430→        """
  1431→        try:
  1432→            from stores.profile_cache import get_profile_cache
  1433→            cache = get_profile_cache()
  1434→
  1435→            if skill:
  1436→                # 只失效特定 skill 的缓存
  1437→                await cache.invalidate_by_key(f"{user_id}:{skill}")
  1438→                # 也失效 all 缓存
  1439→                await cache.invalidate_by_key(f"{user_id}:all")
  1440→            else:
  1441→                # 失效该用户所有缓存
  1442→                await cache.invalidate_by_prefix(str(user_id))
  1443→
  1444→            logger.debug(f"缓存已失效: user_id={user_id}, skill={skill}")
  1445→        except Exception as e:
  1446→            logger.warning(f"缓存失效失败: {e}")
  1447→
  1448→
  1449→# ═══════════════════════════════════════════════════════════════════════════
  1450→# Cold Layer - Insights & Timeline (v8)
  1451→# ═══════════════════════════════════════════════════════════════════════════
  1452→
  1453→@dataclass
  1454→class ProfileInsight:
  1455→    """AI 生成的洞察"""
  1456→    id: UUID
  1457→    user_id: UUID
  1458→    insight_type: str  # discovery | pattern | timing | growth
  1459→    skill_id: Optional[str]
  1460→    content: str
  1461→    metadata: Dict[str, Any]
  1462→    created_at: datetime
  1463→
  1464→
  1465→@dataclass
  1466→class TimelineEvent:
  1467→    """时间线事件"""
  1468→    id: UUID
  1469→    user_id: UUID
  1470→    event_type: str  # dayun_change | goal_completed | milestone | life_event
  1471→    event_date: date
  1472→    title: str
  1473→    data: Dict[str, Any]
  1474→    skill_id: Optional[str]
  1475→    created_at: datetime
  1476→
  1477→
  1478→class ColdLayerRepository:
  1479→    """Cold Layer 数据仓库 - 存储长期洞察和时间线事件"""
  1480→
  1481→    @staticmethod
  1482→    async def add_insight(
  1483→        user_id: UUID,
  1484→        insight_type: str,
  1485→        content: str,
  1486→        skill_id: Optional[str] = None,
  1487→        metadata: Optional[Dict[str, Any]] = None
  1488→    ) -> ProfileInsight:
  1489→        """添加 AI 洞察"""
  1490→        from uuid import uuid4
  1491→        insight_id = uuid4()
  1492→
  1493→        await execute(
  1494→            """INSERT INTO vibe_profile_insights (id, user_id, insight_type, skill_id, content, metadata)
  1495→               VALUES ($1, $2, $3, $4, $5, $6::jsonb)""",
  1496→            insight_id, user_id, insight_type, skill_id, content,
  1497→            json.dumps(metadata or {}, ensure_ascii=False)
  1498→        )
  1499→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
