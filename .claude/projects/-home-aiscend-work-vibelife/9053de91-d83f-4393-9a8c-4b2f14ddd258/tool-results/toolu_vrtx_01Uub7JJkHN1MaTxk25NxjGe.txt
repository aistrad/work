     1→version: "2.0"
     2→skill_id: core
     3→description: 全局工具 - 所有 Skill 共享 (V7 重构版)
     4→
     5→# ═══════════════════════════════════════════════════════════════════════════
     6→# 搜索型工具
     7→# ═══════════════════════════════════════════════════════════════════════════
     8→search:
     9→  - name: search_db
    10→    description: |
    11→      从数据库检索知识或案例。
    12→      - table='knowledge_chunks': 检索专业知识
    13→      - table='cases': 检索参考案例
    14→      LLM 根据 SOP 自己判断何时需要检索。
    15→    parameters:
    16→      - name: table
    17→        type: string
    18→        required: true
    19→        description: 要查询的表
    20→        enum:
    21→          - knowledge_chunks
    22→          - cases
    23→      - name: query
    24→        type: string
    25→        required: true
    26→        description: 检索查询词
    27→      - name: filters
    28→        type: object
    29→        required: false
    30→        description: 可选过滤条件，如 skill_id, scenario_id, tags 等
    31→      - name: top_k
    32→        type: integer
    33→        required: false
    34→        description: 返回结果数量
    35→        default: 5
    36→
    37→# ═══════════════════════════════════════════════════════════════════════════
    38→# 收集型工具
    39→# ═══════════════════════════════════════════════════════════════════════════
    40→collect:
    41→  - name: ask_user_question
    42→    description: |
    43→      主动向用户提问以获取更多信息。
    44→      何时调用：
    45→      - 用户意图不明确，需要澄清
    46→      - 需要用户做出选择
    47→      - 缺少必要信息无法继续
    48→      提问原则：
    49→      - 问题要具体、明确
    50→      - 提供选项时不超过4个
    51→      - 避免连续追问
    52→    card_type: question_card
    53→    parameters:
    54→      - name: question
    55→        type: string
    56→        required: true
    57→        description: 要问用户的问题
    58→      - name: options
    59→        type: array
    60→        required: false
    61→        description: 可选的选项列表（最多4个）
    62→
    63→  - name: request_info
    64→    description: |
    65→      向用户请求信息。当需要收集出生信息或其他必要信息时调用。
    66→    card_type: collect_form
    67→    parameters:
    68→      - name: info_type
    69→        type: string
    70→        required: true
    71→        description: 信息类型
    72→        enum:
    73→          - birth
    74→          - context
    75→          - goals
    76→          - concerns
    77→      - name: question
    78→        type: string
    79→        required: false
    80→        description: 自定义问题
    81→
    82→# ═══════════════════════════════════════════════════════════════════════════
    83→# Skill 数据工具 (V8 新增 - 统一 Skill Data 架构)
    84→# ═══════════════════════════════════════════════════════════════════════════
    85→action:
    86→  - name: save_skill_data
    87→    description: |
    88→      保存当前 Skill 的数据到 VibeProfile.skill_data.{skill_id}。
    89→
    90→      这是一个通用工具，所有 Skill 都可以使用。
    91→      数据会自动与现有数据深度合并。
    92→
    93→      调用时机：
    94→      - 完成一个协议/流程后（如 Dan Koe 快速重置）
    95→      - 用户提供了重要信息需要记住
    96→      - 状态发生变化需要持久化
    97→
    98→      数据结构建议：
    99→      - 业务数据：north_star, identity, weekly 等
   100→      - 运行时状态：_state.current_protocol, _state.streak 等
   101→      - 元数据 _meta 会自动管理（version, updated_at）
   102→
   103→      示例调用：
   104→      save_skill_data({
   105→        "data": {
   106→          "north_star": {
   107→            "vision": "成为独立创业者",
   108→            "anti_vision": "继续打工"
   109→          },
   110→          "identity": {
   111→            "old": "我是那种会拖延的人",
   112→            "new": "我是那种说到做到的人"
   113→          },
   114→          "_state": {
   115→            "last_interaction": "2026-01-20"
   116→          }
   117→        }
   118→      })
   119→    parameters:
   120→      - name: data
   121→        type: object
   122→        required: true
   123→        description: |
   124→          要保存的数据，会与现有数据深度合并。
   125→          传入 null 值可删除对应字段。
   126→      - name: replace
   127→        type: boolean
   128→        required: false
   129→        description: |
   130→          是否完全替换（而非合并）。
   131→          默认 false，即深度合并现有数据。
   132→        default: false
   133→
   134→# ═══════════════════════════════════════════════════════════════════════════
   135→# 用户数据工具 (Core 零业务语义)
   136→# ═══════════════════════════════════════════════════════════════════════════
   137→
   138→  - name: read_user_data
   139→    description: |
   140→      读取用户存储的数据。
   141→      何时调用：
   142→      - 用户询问自己的目标、计划、任务时
   143→      - 需要获取用户之前保存的信息时
   144→      - 查看打卡记录或进度时
   145→    parameters:
   146→      - name: path
   147→        type: string
   148→        required: true
   149→        description: |
   150→          数据路径，如：
   151→          - goals/2026/year - 年度目标
   152→          - goals/2026/q1 - 季度目标
   153→          - plans/daily/2026-01-18 - 每日计划
   154→          - checkins/2026-01-18 - 打卡记录
   155→
   156→  - name: write_user_data
   157→    description: |
   158→      写入或更新用户数据。
   159→      何时调用：
   160→      - 用户设定新目标时
   161→      - 用户修改计划时
   162→      - 记录打卡或反思时
   163→      - 保存用户的任何结构化信息时
   164→    parameters:
   165→      - name: path
   166→        type: string
   167→        required: true
   168→        description: 数据路径
   169→      - name: content
   170→        type: object
   171→        required: true
   172→        description: |
   173→          JSON 数据内容。建议包含：
   174→          - title: 标题
   175→          - status: 状态 (active/completed/archived)
   176→          - items: 子项列表（如适用）
   177→          - notes: 用户备注
   178→      - name: expected_version
   179→        type: integer
   180→        required: false
   181→        description: |
   182→          乐观锁版本号（可选）。
   183→          如果指定，只有当前版本匹配时才会更新，否则返回 conflict 错误。
   184→          用于防止并发写入冲突。
   185→
   186→  - name: query_user_data
   187→    description: |
   188→      查询用户数据。支持按路径前缀、内容过滤。
   189→      何时调用：
   190→      - 列出用户所有目标
   191→      - 查找特定时间段的计划
   192→      - 搜索包含特定关键词的记录
   193→    parameters:
   194→      - name: path_prefix
   195→        type: string
   196→        required: false
   197→        description: |
   198→          路径前缀过滤，如 "goals/2026"、"plans/daily"。
   199→          这是主要的查询方式，路径规范由 scenarios/ 定义。
   200→      - name: filters
   201→        type: object
   202→        required: false
   203→        description: 'JSONB 过滤条件，如 {"status": "active"}'
   204→      - name: sort_by
   205→        type: string
   206→        required: false
   207→        description: 排序字段，如 "updated_at"、"created_at"
   208→      - name: limit
   209→        type: integer
   210→        required: false
   211→        description: 返回数量限制
   212→        default: 20
   213→
   214→  - name: delete_user_data
   215→    description: |
   216→      删除用户数据。
   217→      何时调用：
   218→      - 用户明确要求删除某个目标或计划时
   219→      注意：删除前应确认用户意图
   220→    parameters:
   221→      - name: path
   222→        type: string
   223→        required: true
   224→        description: 要删除的数据路径
   225→
   226→# ═══════════════════════════════════════════════════════════════════════════
   227→# 触发器工具 (V7 新增)
   228→# ═══════════════════════════════════════════════════════════════════════════
   229→  - name: create_trigger
   230→    description: |
   231→      创建用户触发器（提醒、条件触发、定时任务）。
   232→      何时调用：
   233→      - 用户要求每日提醒打卡时 (trigger_type: reminder)
   234→      - 设置目标截止日期提醒时 (trigger_type: reminder)
   235→      - 当某个数据满足条件时触发 (trigger_type: condition)
   236→      - 定时执行任务 (trigger_type: schedule)
   237→    parameters:
   238→      - name: trigger_type
   239→        type: string
   240→        required: true
   241→        description: 触发类型
   242→        enum:
   243→          - reminder
   244→          - condition
   245→          - schedule
   246→      - name: title
   247→        type: string
   248→        required: true
   249→        description: 触发器标题
   250→      - name: schedule
   251→        type: string
   252→        required: false
   253→        description: |
   254→          调度表达式（reminder/schedule 类型必填）：
   255→          - daily: "08:00" (每天8点)
   256→          - weekly: "1,3,5 09:00" (周一三五9点)
   257→          - once: "2026-01-20T10:00:00" (一次性)
   258→          - cron: "0 8 * * *" (cron 表达式)
   259→      - name: schedule_type
   260→        type: string
   261→        required: false
   262→        description: 调度类型
   263→        default: daily
   264→        enum:
   265→          - once
   266→          - daily
   267→          - weekly
   268→          - cron
   269→      - name: condition
   270→        type: object
   271→        required: false
   272→        description: |
   273→          条件规则（condition 类型必填）：
   274→          {field: "status", operator: "eq", value: "completed"}
   275→          支持的 operator: eq, ne, gt, gte, lt, lte, contains, exists, not_exists
   276→      - name: action
   277→        type: object
   278→        required: false
   279→        description: |
   280→          触发动作：
   281→          {type: "notify", payload: {title: "...", body: "..."}}
   282→          {type: "message", payload: {content: "..."}}
   283→      - name: source_path
   284→        type: string
   285→        required: false
   286→        description: 监控的数据路径（condition 类型）
   287→      - name: trigger_subtype
   288→        type: string
   289→        required: false
   290→        description: 子类型
   291→        default: custom
   292→        enum:
   293→          - goal_checkin
   294→          - daily_plan
   295→          - milestone
   296→          - custom
   297→
   298→  - name: list_triggers
   299→    description: |
   300→      列出用户的触发器。
   301→      何时调用：
   302→      - 用户询问"我有哪些提醒"时
   303→      - 需要展示用户的触发器设置时
   304→    parameters:
   305→      - name: trigger_type
   306→        type: string
   307→        required: false
   308→        description: 按触发类型过滤
   309→        enum:
   310→          - reminder
   311→          - condition
   312→          - schedule
   313→      - name: status
   314→        type: string
   315→        required: false
   316→        description: 按状态过滤
   317→        default: active
   318→        enum:
   319→          - active
   320→          - paused
   321→          - completed
   322→          - cancelled
   323→
   324→  - name: cancel_trigger
   325→    description: |
   326→      取消用户的触发器。
   327→      何时调用：
   328→      - 用户要求取消某个提醒时
   329→      - 目标完成后自动取消关联触发器时
   330→    parameters:
   331→      - name: trigger_id
   332→        type: string
   333→        required: true
   334→        description: 要取消的触发器 ID
   335→
   336→# ═══════════════════════════════════════════════════════════════════════════
   337→# 展示型工具 (V7 统一为 show_card)
   338→# ═══════════════════════════════════════════════════════════════════════════
   339→display:
   340→  - name: show_all_skills
   341→    description: |
   342→      展示所有可用 Skill 的 IntroCard 列表。
   343→
   344→      何时调用：
   345→      - 用户问题超出当前 Skill 能力范围时
   346→      - 用户询问"你能做什么"、"有什么功能"时
   347→      - 需要引导用户选择合适的 Skill 时
   348→
   349→      注意：
   350→      - 这是边界控制的核心工具
   351→      - 当无法处理用户请求时，优先调用此工具而不是简单拒绝
   352→      - 展示后让用户自己选择，不要替用户做决定
   353→    card_type: skill_list
   354→    parameters:
   355→      - name: category
   356→        type: string
   357→        required: false
   358→        description: 按分类过滤 Skill
   359→        enum:
   360→          - core
   361→          - default
   362→          - professional
   363→      - name: message
   364→        type: string
   365→        required: false
   366→        description: 展示给用户的引导语，如"这个问题超出了我的专长，以下是我能帮你的领域"
   367→
   368→  - name: show_card
   369→    description: |
   370→      统一卡片展示工具。支持 11 种通用视图类型和自定义卡片。
   371→
   372→      通用视图类型：
   373→      - list: 列表展示
   374→      - tree: 树形结构（目标层级）
   375→      - table: 表格数据
   376→      - timeline: 时间线
   377→      - form: 交互表单
   378→      - select: 选择器
   379→      - chart: 图表 (line, bar, pie, radar)
   380→      - progress: 进度条
   381→      - counter: 计数器
   382→      - modal: 模态框
   383→      - toast: 轻提示
   384→      - custom: 自定义组件（需指定 component_id）
   385→
   386→      何时调用：
   387→      - 展示目标树时 (card_type: tree)
   388→      - 展示今日计划时 (card_type: list)
   389→      - 展示打卡表单时 (card_type: form)
   390→      - 展示进度时 (card_type: progress)
   391→      - 展示 Skill 专属卡片时 (card_type: custom, component_id: bazi_chart)
   392→    parameters:
   393→      - name: card_type
   394→        type: string
   395→        required: true
   396→        description: 卡片类型
   397→        enum:
   398→          - list
   399→          - tree
   400→          - table
   401→          - timeline
   402→          - form
   403→          - select
   404→          - chart
   405→          - progress
   406→          - counter
   407→          - modal
   408→          - toast
   409→          - custom
   410→      - name: data_source
   411→        type: object
   412→        required: false
   413→        description: |
   414→          数据源配置：
   415→          - {type: "inline", data: [...]} - 内联数据
   416→          - {type: "path", path: "goals/2026"} - 从 user_data_store 读取
   417→          - {type: "api", endpoint: "/api/..."} - 前端调用 API
   418→      - name: options
   419→        type: object
   420→        required: false
   421→        description: |
   422→          视图选项，根据 card_type 不同：
   423→          - list: {emptyText, showIndex}
   424→          - tree: {expandLevel, showProgress}
   425→          - table: {columns, sortable, pagination}
   426→          - form: {fields, submitLabel, submitAction}
   427→          - chart: {chartType, xAxis, yAxis}
   428→          - progress: {max, label, showPercentage}
   429→          - custom: {componentId} - 必填，指定自定义组件
   430→
   431→  - name: recommend_skill
   432→    description: |
   433→      推荐 Skill 给用户。当判断用户可能对某个未订阅的 Skill 感兴趣时调用。
   434→
   435→      何时调用：
   436→      - 用户提到与某个 Skill 相关的话题，但当前未使用该 Skill
   437→      - 用户表达了某种需求，某个 Skill 可以更好地满足
   438→      - 对话中自然出现推荐时机
   439→
   440→      注意：
   441→      - 不要频繁推荐，每次对话最多推荐一次
   442→      - 推荐要自然，不要强行推销
   443→      - 如果用户已订阅该 Skill，工具会自动跳过
   444→    card_type: skill_recommendation
   445→    parameters:
   446→      - name: skill_id
   447→        type: string
   448→        required: true
   449→        description: 推荐的 Skill ID
   450→        enum:
   451→          - bazi
   452→          - zodiac
   453→          - tarot
   454→          - jungastro
   455→          - career
   456→          - mindfulness
   457→          - vibe_id
   458→      - name: reason
   459→        type: string
   460→        required: true
   461→        description: 推荐原因，基于对话内容生成，要自然、有说服力
   462→      - name: confidence
   463→        type: string
   464→        required: false
   465→        description: 推荐置信度
   466→        default: medium
   467→        enum:
   468→          - high
   469→          - medium
   470→          - low
   471→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
