  1600→        if event_type:
  1601→            conditions.append(f"event_type = ${param_idx}")
  1602→            params.append(event_type)
  1603→            param_idx += 1
  1604→
  1605→        if start_date:
  1606→            conditions.append(f"event_date >= ${param_idx}")
  1607→            params.append(start_date)
  1608→            param_idx += 1
  1609→
  1610→        if end_date:
  1611→            conditions.append(f"event_date <= ${param_idx}")
  1612→            params.append(end_date)
  1613→            param_idx += 1
  1614→
  1615→        params.append(limit)
  1616→
  1617→        rows = await fetch(
  1618→            f"""SELECT id, user_id, event_type, event_date, title, data, skill_id, created_at
  1619→               FROM vibe_profile_timeline
  1620→               WHERE {' AND '.join(conditions)}
  1621→               ORDER BY event_date DESC
  1622→               LIMIT ${param_idx}""",
  1623→            *params
  1624→        )
  1625→
  1626→        return [
  1627→            TimelineEvent(
  1628→                id=row["id"],
  1629→                user_id=row["user_id"],
  1630→                event_type=row["event_type"],
  1631→                event_date=row["event_date"],
  1632→                title=row["title"],
  1633→                data=row["data"] if isinstance(row["data"], dict) else json.loads(row["data"] or "{}"),
  1634→                skill_id=row["skill_id"],
  1635→                created_at=row["created_at"]
  1636→            )
  1637→            for row in rows
  1638→        ]
  1639→
  1640→
  1641→# ═══════════════════════════════════════════════════════════════════════════
  1642→# 便捷函数 (兼容旧代码)
  1643→# ═══════════════════════════════════════════════════════════════════════════
  1644→
  1645→async def get_unified_profile(user_id: UUID) -> Optional[Dict[str, Any]]:
  1646→    """获取统一 Profile (便捷函数)"""
  1647→    return await UnifiedProfileRepository.get_profile(user_id)
  1648→
  1649→
  1650→async def get_unified_profile_with_skill(user_id: UUID, skill: str = None) -> Dict[str, Any]:
  1651→    """
  1652→    获取 Profile 和 Skill 数据 (兼容 profile_cache 接口)
  1653→
  1654→    Returns:
  1655→        {
  1656→            "profile": {...},
  1657→            "skill_data": {...}
  1658→        }
  1659→    """
  1660→    profile = await UnifiedProfileRepository.get_profile(user_id)
  1661→
  1662→    if profile:
  1663→        skill_data = profile.get("skill_data", {})
  1664→        return {
  1665→            "profile": profile,
  1666→            "skill_data": skill_data
  1667→        }
  1668→
  1669→    return {"profile": {}, "skill_data": {}}
  1670→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
