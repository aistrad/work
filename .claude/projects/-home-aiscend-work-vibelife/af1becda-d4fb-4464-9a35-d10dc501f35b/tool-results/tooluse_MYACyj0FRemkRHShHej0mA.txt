     1→"use client";
     2→
     3→/**
     4→ * ChartPanel - Chart Tab 的右侧 Panel 内容
     5→ * 显示: Identity Prism + 人生 K 线 + Now/Next 趋势 + 报告入口
     6→ *
     7→ * 注: Bazi/Zodiac/MBTI 各自设计不同的内容
     8→ */
     9→
    10→import { useState } from "react";
    11→import { cn } from "@/lib/utils";
    12→import { type SkillType } from "@/components/core";
    13→import { IdentityPrism, type PrismContent } from "@/components/identity/IdentityPrism";
    14→import { LifeKLine, type FortuneDataPoint } from "@/components/trend/LifeKLine";
    15→import {
    16→  FileText,
    17→  TrendingUp,
    18→  Calendar,
    19→  Sparkles,
    20→  ChevronRight,
    21→  Download,
    22→} from "lucide-react";
    23→
    24→// ═══════════════════════════════════════════════════════════════════════════
    25→// Types
    26→// ═══════════════════════════════════════════════════════════════════════════
    27→
    28→interface ChartPanelProps {
    29→  skill: SkillType;
    30→  /** Now/Next 数据 */
    31→  nowNextData?: {
    32→    currentPhase: string;
    33→    currentTheme: string;
    34→    nextMilestone: string;
    35→    nextDate: string;
    36→  };
    37→  /** K线简要数据 */
    38→  klinePreview?: {
    39→    currentScore: number;
    40→    trend: "up" | "down" | "stable";
    41→    period: string;
    42→  };
    43→  /** 完整 K 线数据 */
    44→  klineData?: FortuneDataPoint[];
    45→  /** Identity Prism 数据 */
    46→  prismContent?: PrismContent;
    47→  /** 是否有完整报告 */
    48→  hasReport?: boolean;
    49→  /** 是否展开 K 线 */
    50→  showFullKLine?: boolean;
    51→  onViewKLine?: () => void;
    52→  onGenerateReport?: () => void;
    53→  onDownloadReport?: () => void;
    54→  className?: string;
    55→}
    56→
    57→// ═══════════════════════════════════════════════════════════════════════════
    58→// Skill-specific Content
    59→// ═══════════════════════════════════════════════════════════════════════════
    60→
    61→const SKILL_CHART_CONFIG: Record<SkillType, {
    62→  klineLabel: string;
    63→  reportLabel: string;
    64→  identityLabel: string;
    65→}> = {
    66→  bazi: {
    67→    klineLabel: "人生 K 线",
    68→    reportLabel: "八字完整报告",
    69→    identityLabel: "命盘身份视角",
    70→  },
    71→  zodiac: {
    72→    klineLabel: "星象周期",
    73→    reportLabel: "星盘完整报告",
    74→    identityLabel: "星盘身份视角",
    75→  },
    76→  mbti: {
    77→    klineLabel: "成长轨迹",
    78→    reportLabel: "人格完整报告",
    79→    identityLabel: "人格身份视角",
    80→  },
    81→  attach: {
    82→    klineLabel: "关系轨迹",
    83→    reportLabel: "依恋模式报告",
    84→    identityLabel: "依恋身份视角",
    85→  },
    86→  career: {
    87→    klineLabel: "职业轨迹",
    88→    reportLabel: "职业发展报告",
    89→    identityLabel: "职业身份视角",
    90→  },
    91→};
    92→
    93→// ═══════════════════════════════════════════════════════════════════════════
    94→// Sub-components
    95→// ═══════════════════════════════════════════════════════════════════════════
    96→
    97→function NowNextCard({ data }: { data: ChartPanelProps["nowNextData"] }) {
    98→  if (!data) {
    99→    return (
   100→      <div className="glass-card rounded-xl p-4 text-center text-muted-foreground text-sm">
   101→        完成更多对话后，这里会显示你的当前阶段和下一步建议
   102→      </div>
   103→    );
   104→  }
   105→
   106→  return (
   107→    <div className="glass-card rounded-xl p-4 space-y-4">
   108→      {/* Now */}
   109→      <div>
   110→        <div className="flex items-center gap-2 mb-2">
   111→          <div className="w-2 h-2 rounded-full bg-emerald-500" />
   112→          <span className="text-xs font-medium text-muted-foreground uppercase tracking-wide">
   113→            Now · 当前阶段
   114→          </span>
   115→        </div>
   116→        <div className="font-serif text-lg font-semibold text-foreground">
   117→          {data.currentPhase}
   118→        </div>
   119→        <p className="text-sm text-muted-foreground mt-1">
   120→          {data.currentTheme}
   121→        </p>
   122→      </div>
   123→
   124→      <div className="h-px bg-border" />
   125→
   126→      {/* Next */}
   127→      <div>
   128→        <div className="flex items-center gap-2 mb-2">
   129→          <div className="w-2 h-2 rounded-full bg-amber-500" />
   130→          <span className="text-xs font-medium text-muted-foreground uppercase tracking-wide">
   131→            Next · 下一节点
   132→          </span>
   133→        </div>
   134→        <div className="font-serif text-lg font-semibold text-foreground">
   135→          {data.nextMilestone}
   136→        </div>
   137→        <p className="text-sm text-muted-foreground mt-1">
   138→          预计 {data.nextDate}
   139→        </p>
   140→      </div>
   141→    </div>
   142→  );
   143→}
   144→
   145→function KLinePreviewCard({
   146→  data,
   147→  label,
   148→  onClick,
   149→}: {
   150→  data?: ChartPanelProps["klinePreview"];
   151→  label: string;
   152→  onClick?: () => void;
   153→}) {
   154→  const getTrendIcon = () => {
   155→    if (!data) return null;
   156→    switch (data.trend) {
   157→      case "up":
   158→        return <TrendingUp className="w-4 h-4 text-emerald-500" />;
   159→      case "down":
   160→        return <TrendingUp className="w-4 h-4 text-red-500 rotate-180" />;
   161→      default:
   162→        return <div className="w-4 h-0.5 bg-muted-foreground" />;
   163→    }
   164→  };
   165→
   166→  return (
   167→    <button
   168→      onClick={onClick}
   169→      className="w-full glass-card rounded-xl p-4 text-left hover:shadow-md transition-all group"
   170→    >
   171→      <div className="flex items-center justify-between mb-3">
   172→        <div className="flex items-center gap-2">
   173→          <Calendar className="w-4 h-4 text-skill-primary" />
   174→          <span className="text-sm font-medium text-foreground">{label}</span>
   175→        </div>
   176→        <ChevronRight className="w-4 h-4 text-muted-foreground group-hover:translate-x-1 transition-transform" />
   177→      </div>
   178→
   179→      {data ? (
   180→        <div className="flex items-center justify-between">
   181→          <div>
   182→            <div className="text-2xl font-serif font-bold text-foreground">
   183→              {data.currentScore}
   184→            </div>
   185→            <div className="text-xs text-muted-foreground">{data.period}</div>
   186→          </div>
   187→          <div className="flex items-center gap-1">
   188→            {getTrendIcon()}
   189→            <span className={cn(
   190→              "text-sm font-medium",
   191→              data.trend === "up" && "text-emerald-500",
   192→              data.trend === "down" && "text-red-500",
   193→              data.trend === "stable" && "text-muted-foreground"
   194→            )}>
   195→              {data.trend === "up" ? "上升" : data.trend === "down" ? "下降" : "平稳"}
   196→            </span>
   197→          </div>
   198→        </div>
   199→      ) : (
   200→        <p className="text-sm text-muted-foreground">
   201→          查看你的运势走势图
   202→        </p>
   203→      )}
   204→    </button>
   205→  );
   206→}
   207→
   208→function ReportCard({
   209→  label,
   210→  hasReport,
   211→  onGenerate,
   212→  onDownload,
   213→}: {
   214→  label: string;
   215→  hasReport?: boolean;
   216→  onGenerate?: () => void;
   217→  onDownload?: () => void;
   218→}) {
   219→  return (
   220→    <div className="glass-card rounded-xl p-4">
   221→      <div className="flex items-center gap-2 mb-3">
   222→        <FileText className="w-4 h-4 text-skill-primary" />
   223→        <span className="text-sm font-medium text-foreground">{label}</span>
   224→      </div>
   225→
   226→      {hasReport ? (
   227→        <div className="space-y-2">
   228→          <p className="text-sm text-muted-foreground">
   229→            你的专属报告已生成
   230→          </p>
   231→          <div className="flex gap-2">
   232→            <button
   233→              onClick={onDownload}
   234→              className="flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-skill-primary text-white rounded-lg text-sm font-medium hover:opacity-90 transition-opacity"
   235→            >
   236→              <Download className="w-4 h-4" />
   237→              下载报告
   238→            </button>
   239→          </div>
   240→        </div>
   241→      ) : (
   242→        <div className="space-y-2">
   243→          <p className="text-sm text-muted-foreground">
   244→            生成一份专属于你的深度分析报告
   245→          </p>
   246→          <button
   247→            onClick={onGenerate}
   248→            className="w-full flex items-center justify-center gap-2 px-3 py-2 bg-skill-primary text-white rounded-lg text-sm font-medium hover:opacity-90 transition-opacity"
   249→          >
   250→            <Sparkles className="w-4 h-4" />
   251→            生成报告
   252→          </button>
   253→        </div>
   254→      )}
   255→    </div>
   256→  );
   257→}
   258→
   259→// ═══════════════════════════════════════════════════════════════════════════
   260→// ChartPanel Component
   261→// ═══════════════════════════════════════════════════════════════════════════
   262→
   263→export function ChartPanel({
   264→  skill,
   265→  nowNextData,
   266→  klinePreview,
   267→  klineData,
   268→  prismContent,
   269→  hasReport,
   270→  showFullKLine = false,
   271→  onViewKLine,
   272→  onGenerateReport,
   273→  onDownloadReport,
   274→  className,
   275→}: ChartPanelProps) {
   276→  const config = SKILL_CHART_CONFIG[skill];
   277→
   278→  return (
   279→    <div className={cn("h-full overflow-y-auto p-5 space-y-6", className)}>
   280→      {/* Identity Prism Section */}
   281→      {prismContent && (
   282→        <section>
   283→          <IdentityPrism content={prismContent} />
   284→        </section>
   285→      )}
   286→
   287→      {/* Now/Next Section */}
   288→      <section>
   289→        <h2 className="font-serif text-lg font-semibold text-foreground mb-3">
   290→          当前与下一步
   291→        </h2>
   292→        <NowNextCard data={nowNextData} />
   293→      </section>
   294→
   295→      {/* K-Line Section */}
   296→      <section>
   297→        <h2 className="font-serif text-lg font-semibold text-foreground mb-3">
   298→          {config.klineLabel}
   299→        </h2>
   300→        {klineData && klineData.length > 0 ? (
   301→          /* Full K-Line Chart */
   302→          <LifeKLine
   303→            data={klineData}
   304→            dimension="year"
   305→            height={280}
   306→            onPointClick={(point) => console.log("Clicked:", point)}
   307→          />
   308→        ) : (
   309→          /* Preview Card */
   310→          <KLinePreviewCard
   311→            data={klinePreview}
   312→            label={config.klineLabel}
   313→            onClick={onViewKLine}
   314→          />
   315→        )}
   316→      </section>
   317→
   318→      {/* Report Section */}
   319→      <section>
   320→        <h2 className="font-serif text-lg font-semibold text-foreground mb-3">
   321→          深度报告
   322→        </h2>
   323→        <ReportCard
   324→          label={config.reportLabel}
   325→          hasReport={hasReport}
   326→          onGenerate={onGenerateReport}
   327→          onDownload={onDownloadReport}
   328→        />
   329→      </section>
   330→    </div>
   331→  );
   332→}
   333→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
