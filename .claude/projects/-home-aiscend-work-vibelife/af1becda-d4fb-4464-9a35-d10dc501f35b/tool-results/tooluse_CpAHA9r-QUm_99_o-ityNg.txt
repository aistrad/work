     1→"use client";
     2→
     3→/**
     4→ * Relationship Page - 关系模拟器独立页面
     5→ * 分析用户与他人的关系契合度
     6→ */
     7→
     8→import { useState, useCallback } from "react";
     9→import { useRouter } from "next/navigation";
    10→import { motion } from "framer-motion";
    11→import { ArrowLeft, Heart, Users, Briefcase, Home, Sparkles } from "lucide-react";
    12→import { useSkill } from "@/providers";
    13→import { LuminousPaper, BreathAura, VibeGlyph } from "@/components/core";
    14→import RelationshipSimulator from "@/components/relationship/RelationshipSimulator";
    15→import RelationshipCard from "@/components/relationship/RelationshipCard";
    16→
    17→// ═══════════════════════════════════════════════════════════════════════════
    18→// Types
    19→// ═══════════════════════════════════════════════════════════════════════════
    20→
    21→interface RelationshipAnalysis {
    22→  id: string;
    23→  headline: string;
    24→  communication_style: string;
    25→  summary: string;
    26→  scores?: Array<{
    27→    dimension: string;
    28→    score: number;
    29→    description: string;
    30→    is_strength: boolean;
    31→  }>;
    32→  overall_score?: number;
    33→  prescriptions: Array<{
    34→    category: string;
    35→    template: string;
    36→    context: string;
    37→  }>;
    38→  warnings: string[];
    39→}
    40→
    41→// ═══════════════════════════════════════════════════════════════════════════
    42→// Relationship Page Component
    43→// ═══════════════════════════════════════════════════════════════════════════
    44→
    45→export default function RelationshipPage() {
    46→  const router = useRouter();
    47→  const { skill } = useSkill();
    48→
    49→  const [showSimulator, setShowSimulator] = useState(false);
    50→  const [analysis, setAnalysis] = useState<RelationshipAnalysis | null>(null);
    51→  const [showResult, setShowResult] = useState(false);
    52→
    53→  // Demo user profile
    54→  const userProfile = {
    55→    skill: skill,
    56→    dayMaster: skill === "bazi" ? "甲木" : undefined,
    57→    sunSign: skill === "zodiac" ? "双子座" : undefined,
    58→  };
    59→
    60→  const handleAnalysisComplete = useCallback((result: RelationshipAnalysis) => {
    61→    setAnalysis(result);
    62→    setShowResult(true);
    63→    setShowSimulator(false);
    64→  }, []);
    65→
    66→  const handleBack = () => {
    67→    if (showResult) {
    68→      setShowResult(false);
    69→      setAnalysis(null);
    70→    } else if (showSimulator) {
    71→      setShowSimulator(false);
    72→    } else {
    73→      router.push("/chat");
    74→    }
    75→  };
    76→
    77→  const handleNewAnalysis = () => {
    78→    setShowResult(false);
    79→    setAnalysis(null);
    80→    setShowSimulator(true);
    81→  };
    82→
    83→  const handleShare = async () => {
    84→    if (navigator.share && analysis) {
    85→      try {
    86→        await navigator.share({
    87→          title: "我的关系分析",
    88→          text: analysis.headline,
    89→          url: window.location.href,
    90→        });
    91→      } catch {
    92→        // User cancelled
    93→      }
    94→    }
    95→  };
    96→
    97→  return (
    98→    <LuminousPaper skill={skill} variant="default" className="min-h-screen">
    99→      {/* Background */}
   100→      <BreathAura
   101→        skill={skill}
   102→        size="xl"
   103→        position="center"
   104→        intensity="low"
   105→        className="opacity-20"
   106→      />
   107→
   108→      <div className="relative z-10 min-h-screen flex flex-col">
   109→        {/* Header */}
   110→        <header className="py-4 px-6 flex items-center gap-4 border-b border-border">
   111→          <button
   112→            onClick={handleBack}
   113→            className="p-2 rounded-lg hover:bg-foreground/5 transition-colors"
   114→          >
   115→            <ArrowLeft className="w-5 h-5 text-foreground" />
   116→          </button>
   117→          <div className="flex items-center gap-2">
   118→            <VibeGlyph size="sm" skill={skill} showAura={false} />
   119→            <span className="font-serif font-semibold text-foreground">关系模拟器</span>
   120→          </div>
   121→        </header>
   122→
   123→        {/* Main Content */}
   124→        <main className="flex-1 px-6 py-8">
   125→          <div className="max-w-lg mx-auto">
   126→            {showResult && analysis ? (
   127→              // 结果展示
   128→              <motion.div
   129→                initial={{ opacity: 0, y: 20 }}
   130→                animate={{ opacity: 1, y: 0 }}
   131→                className="space-y-6"
   132→              >
   133→                {/* Result Header */}
   134→                <div className="text-center">
   135→                  <motion.div
   136→                    initial={{ scale: 0 }}
   137→                    animate={{ scale: 1 }}
   138→                    transition={{ type: "spring", delay: 0.2 }}
   139→                    className="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-pink-400 to-rose-500 flex items-center justify-center"
   140→                  >
   141→                    <Heart className="w-10 h-10 text-white" />
   142→                  </motion.div>
   143→                  <h1 className="font-serif text-2xl font-bold text-foreground mb-2">
   144→                    {analysis.headline}
   145→                  </h1>
   146→                  <p className="text-muted-foreground">
   147→                    {analysis.communication_style}
   148→                  </p>
   149→                </div>
   150→
   151→                {/* Overall Score */}
   152→                {analysis.overall_score !== undefined && (
   153→                  <div className="bg-card rounded-xl p-6 text-center">
   154→                    <p className="text-sm text-muted-foreground mb-2">契合度</p>
   155→                    <div className="relative w-32 h-32 mx-auto">
   156→                      <svg className="w-full h-full transform -rotate-90">
   157→                        <circle
   158→                          cx="64"
   159→                          cy="64"
   160→                          r="56"
   161→                          fill="none"
   162→                          stroke="currentColor"
   163→                          strokeWidth="8"
   164→                          className="text-muted"
   165→                        />
   166→                        <motion.circle
   167→                          cx="64"
   168→                          cy="64"
   169→                          r="56"
   170→                          fill="none"
   171→                          stroke="currentColor"
   172→                          strokeWidth="8"
   173→                          strokeLinecap="round"
   174→                          className="text-skill-primary"
   175→                          strokeDasharray={`${2 * Math.PI * 56}`}
   176→                          initial={{ strokeDashoffset: 2 * Math.PI * 56 }}
   177→                          animate={{
   178→                            strokeDashoffset: 2 * Math.PI * 56 * (1 - analysis.overall_score / 100),
   179→                          }}
   180→                          transition={{ duration: 1, delay: 0.5 }}
   181→                        />
   182→                      </svg>
   183→                      <div className="absolute inset-0 flex items-center justify-center">
   184→                        <span className="text-3xl font-bold text-foreground">
   185→                          {analysis.overall_score}
   186→                        </span>
   187→                      </div>
   188→                    </div>
   189→                  </div>
   190→                )}
   191→
   192→                {/* Summary */}
   193→                <div className="bg-card rounded-xl p-6">
   194→                  <p className="text-foreground leading-relaxed">
   195→                    {analysis.summary}
   196→                  </p>
   197→                </div>
   198→
   199→                {/* Dimension Scores */}
   200→                {analysis.scores && analysis.scores.length > 0 && (
   201→                  <div className="bg-card rounded-xl p-6 space-y-4">
   202→                    <h3 className="font-medium text-foreground">维度分析</h3>
   203→                    {analysis.scores.map((score, index) => (
   204→                      <div key={index}>
   205→                        <div className="flex items-center justify-between mb-1">
   206→                          <span className="text-sm text-foreground">{score.dimension}</span>
   207→                          <span className="text-sm font-medium text-skill-primary">
   208→                            {score.score}%
   209→                          </span>
   210→                        </div>
   211→                        <div className="h-2 bg-muted rounded-full overflow-hidden">
   212→                          <motion.div
   213→                            className={`h-full ${score.is_strength ? "bg-green-500" : "bg-skill-primary"}`}
   214→                            initial={{ width: 0 }}
   215→                            animate={{ width: `${score.score}%` }}
   216→                            transition={{ duration: 0.5, delay: 0.3 + index * 0.1 }}
   217→                          />
   218→                        </div>
   219→                        <p className="text-xs text-muted-foreground mt-1">
   220→                          {score.description}
   221→                        </p>
   222→                      </div>
   223→                    ))}
   224→                  </div>
   225→                )}
   226→
   227→                {/* Prescriptions */}
   228→                {analysis.prescriptions.length > 0 && (
   229→                  <div className="bg-card rounded-xl p-6 space-y-4">
   230→                    <h3 className="font-medium text-foreground flex items-center gap-2">
   231→                      <Sparkles className="w-4 h-4 text-skill-primary" />
   232→                      沟通建议
   233→                    </h3>
   234→                    {analysis.prescriptions.map((p, i) => (
   235→                      <div
   236→                        key={i}
   237→                        className="p-4 bg-background rounded-lg border border-border"
   238→                      >
   239→                        <p className="text-foreground font-medium mb-1">
   240→                          &ldquo;{p.template}&rdquo;
   241→                        </p>
   242→                        <p className="text-sm text-muted-foreground">{p.context}</p>
   243→                      </div>
   244→                    ))}
   245→                  </div>
   246→                )}
   247→
   248→                {/* Warnings */}
   249→                {analysis.warnings.length > 0 && (
   250→                  <div className="bg-amber-50 dark:bg-amber-900/20 rounded-xl p-6">
   251→                    <h3 className="font-medium text-amber-800 dark:text-amber-200 mb-3">
   252→                      ⚠️ 注意事项
   253→                    </h3>
   254→                    <ul className="space-y-2">
   255→                      {analysis.warnings.map((w, i) => (
   256→                        <li key={i} className="text-sm text-amber-700 dark:text-amber-300">
   257→                          {w}
   258→                        </li>
   259→                      ))}
   260→                    </ul>
   261→                  </div>
   262→                )}
   263→
   264→                {/* Actions */}
   265→                <div className="flex gap-3">
   266→                  <button
   267→                    onClick={handleNewAnalysis}
   268→                    className="flex-1 py-3 border border-border text-foreground rounded-xl hover:bg-foreground/5 transition-colors"
   269→                  >
   270→                    重新分析
   271→                  </button>
   272→                  <button
   273→                    onClick={handleShare}
   274→                    className="flex-1 py-3 bg-skill-primary text-white rounded-xl hover:bg-skill-primary/90 transition-colors"
   275→                  >
   276→                    分享结果
   277→                  </button>
   278→                </div>
   279→              </motion.div>
   280→            ) : showSimulator ? (
   281→              // 模拟器组件
   282→              <RelationshipSimulator
   283→                userProfile={userProfile}
   284→                userId="current-user"
   285→                onAnalysisComplete={handleAnalysisComplete}
   286→                className="shadow-lg"
   287→              />
   288→            ) : (
   289→              // 入口页面
   290→              <motion.div
   291→                initial={{ opacity: 0, y: 20 }}
   292→                animate={{ opacity: 1, y: 0 }}
   293→                className="text-center"
   294→              >
   295→                {/* Hero */}
   296→                <div className="relative inline-block mb-8">
   297→                  <BreathAura
   298→                    skill={skill}
   299→                    size="lg"
   300→                    position="center"
   301→                    intensity="high"
   302→                    className="opacity-50"
   303→                  />
   304→                  <div className="w-24 h-24 rounded-full bg-gradient-to-br from-pink-400 to-rose-500 flex items-center justify-center">
   305→                    <Heart className="w-12 h-12 text-white" />
   306→                  </div>
   307→                </div>
   308→
   309→                <h1 className="font-serif text-3xl font-bold text-foreground mb-4">
   310→                  关系模拟器
   311→                </h1>
   312→                <p className="text-muted-foreground mb-8 leading-relaxed">
   313→                  探索你与 TA 的关系契合度
   314→                  <br />
   315→                  获取专属的沟通建议
   316→                </p>
   317→
   318→                {/* Relationship Types */}
   319→                <div className="grid grid-cols-2 gap-4 mb-8">
   320→                  <button
   321→                    onClick={() => setShowSimulator(true)}
   322→                    className="p-6 bg-card rounded-xl border border-border hover:border-skill-primary hover:shadow-md transition-all group"
   323→                  >
   324→                    <Heart className="w-8 h-8 mx-auto mb-3 text-pink-500 group-hover:scale-110 transition-transform" />
   325→                    <span className="font-medium text-foreground">恋爱/伴侣</span>
   326→                  </button>
   327→                  <button
   328→                    onClick={() => setShowSimulator(true)}
   329→                    className="p-6 bg-card rounded-xl border border-border hover:border-skill-primary hover:shadow-md transition-all group"
   330→                  >
   331→                    <Home className="w-8 h-8 mx-auto mb-3 text-amber-500 group-hover:scale-110 transition-transform" />
   332→                    <span className="font-medium text-foreground">家人</span>
   333→                  </button>
   334→                  <button
   335→                    onClick={() => setShowSimulator(true)}
   336→                    className="p-6 bg-card rounded-xl border border-border hover:border-skill-primary hover:shadow-md transition-all group"
   337→                  >
   338→                    <Users className="w-8 h-8 mx-auto mb-3 text-blue-500 group-hover:scale-110 transition-transform" />
   339→                    <span className="font-medium text-foreground">朋友</span>
   340→                  </button>
   341→                  <button
   342→                    onClick={() => setShowSimulator(true)}
   343→                    className="p-6 bg-card rounded-xl border border-border hover:border-skill-primary hover:shadow-md transition-all group"
   344→                  >
   345→                    <Briefcase className="w-8 h-8 mx-auto mb-3 text-green-500 group-hover:scale-110 transition-transform" />
   346→                    <span className="font-medium text-foreground">同事</span>
   347→                  </button>
   348→                </div>
   349→
   350→                {/* Features */}
   351→                <div className="bg-card rounded-xl p-6 text-left mb-8">
   352→                  <h3 className="font-medium text-foreground mb-4">分析内容包括：</h3>
   353→                  <ul className="space-y-3 text-muted-foreground">
   354→                    <li className="flex items-start gap-3">
   355→                      <span className="text-skill-primary">•</span>
   356→                      <span>整体契合度评分</span>
   357→                    </li>
   358→                    <li className="flex items-start gap-3">
   359→                      <span className="text-skill-primary">•</span>
   360→                      <span>多维度关系分析</span>
   361→                    </li>
   362→                    <li className="flex items-start gap-3">
   363→                      <span className="text-skill-primary">•</span>
   364→                      <span>个性化沟通建议</span>
   365→                    </li>
   366→                    <li className="flex items-start gap-3">
   367→                      <span className="text-skill-primary">•</span>
   368→                      <span>潜在问题预警</span>
   369→                    </li>
   370→                  </ul>
   371→                </div>
   372→
   373→                {/* CTA */}
   374→                <button
   375→                  onClick={() => setShowSimulator(true)}
   376→                  className="w-full py-4 bg-skill-primary text-white rounded-xl font-medium text-lg shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-0.5"
   377→                >
   378→                  开始分析
   379→                </button>
   380→              </motion.div>
   381→            )}
   382→          </div>
   383→        </main>
   384→      </div>
   385→    </LuminousPaper>
   386→  );
   387→}
   388→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
