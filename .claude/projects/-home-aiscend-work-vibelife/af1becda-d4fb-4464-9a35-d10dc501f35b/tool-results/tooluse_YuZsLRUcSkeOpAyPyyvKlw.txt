     1â†’"use client";
     2â†’
     3â†’/**
     4â†’ * Report Page - æŠ¥å‘Šåˆ—è¡¨/ç”Ÿæˆé¡µé¢
     5â†’ * æ˜¾ç¤ºç”¨æˆ·çš„æŠ¥å‘Šåˆ—è¡¨ï¼Œæˆ–è§¦å‘æ–°æŠ¥å‘Šç”Ÿæˆ
     6â†’ */
     7â†’
     8â†’import { useState, useEffect } from "react";
     9â†’import { useRouter, useSearchParams } from "next/navigation";
    10â†’import { motion } from "framer-motion";
    11â†’import { ArrowLeft, FileText, Plus, Sparkles, Clock, ChevronRight } from "lucide-react";
    12â†’import { useSkill } from "@/providers";
    13â†’import { LuminousPaper, BreathAura, VibeGlyph } from "@/components/core";
    14â†’
    15â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    16â†’// Types
    17â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    18â†’
    19â†’interface ReportSummary {
    20â†’  id: string;
    21â†’  skill: "bazi" | "zodiac";
    22â†’  report_type: "lite" | "full";
    23â†’  status: "pending" | "generating" | "completed" | "failed";
    24â†’  created_at: string;
    25â†’  title?: string;
    26â†’}
    27â†’
    28â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    29â†’// Report Page Component
    30â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    31â†’
    32â†’export default function ReportPage() {
    33â†’  const router = useRouter();
    34â†’  const searchParams = useSearchParams();
    35â†’  const { skill } = useSkill();
    36â†’
    37â†’  const [reports, setReports] = useState<ReportSummary[]>([]);
    38â†’  const [isLoading, setIsLoading] = useState(true);
    39â†’  const [isGenerating, setIsGenerating] = useState(false);
    40â†’  const [error, setError] = useState<string | null>(null);
    41â†’
    42â†’  // æ£€æŸ¥æ˜¯å¦ä»è®¿è°ˆé¡µé¢è·³è½¬è¿‡æ¥
    43â†’  const fromInterview = searchParams.get("fromInterview") === "true";
    44â†’
    45â†’  // åŠ è½½æŠ¥å‘Šåˆ—è¡¨
    46â†’  useEffect(() => {
    47â†’    loadReports();
    48â†’  }, []);
    49â†’
    50â†’  // å¦‚æœä»è®¿è°ˆé¡µé¢æ¥ï¼Œè‡ªåŠ¨å¼€å§‹ç”Ÿæˆ
    51â†’  useEffect(() => {
    52â†’    if (fromInterview && !isGenerating) {
    53â†’      handleGenerateReport();
    54â†’    }
    55â†’  }, [fromInterview]);
    56â†’
    57â†’  const loadReports = async () => {
    58â†’    setIsLoading(true);
    59â†’    try {
    60â†’      const response = await fetch("/api/v1/report/list");
    61â†’      if (response.ok) {
    62â†’        const data = await response.json();
    63â†’        setReports(data.reports || []);
    64â†’      } else {
    65â†’        // Demo data for development
    66â†’        setReports([
    67â†’          {
    68â†’            id: "demo-1",
    69â†’            skill: "bazi",
    70â†’            report_type: "lite",
    71â†’            status: "completed",
    72â†’            created_at: new Date().toISOString(),
    73â†’            title: "å…«å­—å‘½ç†åˆ†ææŠ¥å‘Š",
    74â†’          },
    75â†’        ]);
    76â†’      }
    77â†’    } catch {
    78â†’      // Demo data fallback
    79â†’      setReports([]);
    80â†’    } finally {
    81â†’      setIsLoading(false);
    82â†’    }
    83â†’  };
    84â†’
    85â†’  const handleGenerateReport = async () => {
    86â†’    setIsGenerating(true);
    87â†’    setError(null);
    88â†’
    89â†’    try {
    90â†’      const response = await fetch("/api/v1/report/generate", {
    91â†’        method: "POST",
    92â†’        headers: { "Content-Type": "application/json" },
    93â†’        body: JSON.stringify({
    94â†’          skill: skill === "bazi" || skill === "zodiac" ? skill : "bazi",
    95â†’          report_type: "lite",
    96â†’        }),
    97â†’      });
    98â†’
    99â†’      if (response.ok) {
   100â†’        const data = await response.json();
   101â†’        // è·³è½¬åˆ°æŠ¥å‘Šè¯¦æƒ…é¡µ
   102â†’        router.push(`/report/${data.report_id}`);
   103â†’      } else {
   104â†’        const data = await response.json();
   105â†’        setError(data.error || "ç”ŸæˆæŠ¥å‘Šå¤±è´¥");
   106â†’        setIsGenerating(false);
   107â†’      }
   108â†’    } catch {
   109â†’      // Demo: æ¨¡æ‹Ÿç”ŸæˆæˆåŠŸ
   110â†’      setTimeout(() => {
   111â†’        router.push("/report/demo-new");
   112â†’      }, 2000);
   113â†’    }
   114â†’  };
   115â†’
   116â†’  const handleBack = () => {
   117â†’    router.push("/chat");
   118â†’  };
   119â†’
   120â†’  const handleViewReport = (reportId: string) => {
   121â†’    router.push(`/report/${reportId}`);
   122â†’  };
   123â†’
   124â†’  const handleStartInterview = () => {
   125â†’    router.push("/interview?returnTo=/report");
   126â†’  };
   127â†’
   128â†’  // ç”Ÿæˆä¸­çŠ¶æ€
   129â†’  if (isGenerating) {
   130â†’    return (
   131â†’      <LuminousPaper skill={skill} variant="default" className="min-h-screen">
   132â†’        <BreathAura
   133â†’          skill={skill}
   134â†’          size="xl"
   135â†’          position="center"
   136â†’          intensity="high"
   137â†’          className="opacity-40"
   138â†’        />
   139â†’
   140â†’        <div className="relative z-10 min-h-screen flex items-center justify-center">
   141â†’          <motion.div
   142â†’            initial={{ opacity: 0, scale: 0.95 }}
   143â†’            animate={{ opacity: 1, scale: 1 }}
   144â†’            className="text-center px-6"
   145â†’          >
   146â†’            {/* Loading Animation */}
   147â†’            <div className="relative w-24 h-24 mx-auto mb-8">
   148â†’              <motion.div
   149â†’                className="absolute inset-0 rounded-full border-4 border-skill-primary/20"
   150â†’                animate={{ rotate: 360 }}
   151â†’                transition={{ duration: 2, repeat: Infinity, ease: "linear" }}
   152â†’              />
   153â†’              <motion.div
   154â†’                className="absolute inset-2 rounded-full border-4 border-t-skill-primary border-r-transparent border-b-transparent border-l-transparent"
   155â†’                animate={{ rotate: -360 }}
   156â†’                transition={{ duration: 1.5, repeat: Infinity, ease: "linear" }}
   157â†’              />
   158â†’              <div className="absolute inset-0 flex items-center justify-center">
   159â†’                <Sparkles className="w-8 h-8 text-skill-primary" />
   160â†’              </div>
   161â†’            </div>
   162â†’
   163â†’            <h2 className="font-serif text-2xl font-bold text-foreground mb-4">
   164â†’              æ­£åœ¨ç”Ÿæˆä½ çš„ä¸“å±æŠ¥å‘Š
   165â†’            </h2>
   166â†’            <p className="text-muted-foreground mb-2">
   167â†’              AI æ­£åœ¨åˆ†æä½ çš„ä¿¡æ¯...
   168â†’            </p>
   169â†’            <p className="text-sm text-muted-foreground/70">
   170â†’              è¿™å¯èƒ½éœ€è¦ 30-60 ç§’
   171â†’            </p>
   172â†’          </motion.div>
   173â†’        </div>
   174â†’      </LuminousPaper>
   175â†’    );
   176â†’  }
   177â†’
   178â†’  return (
   179â†’    <LuminousPaper skill={skill} variant="default" className="min-h-screen">
   180â†’      <BreathAura
   181â†’        skill={skill}
   182â†’        size="xl"
   183â†’        position="top"
   184â†’        intensity="low"
   185â†’        className="opacity-20"
   186â†’      />
   187â†’
   188â†’      <div className="relative z-10 min-h-screen flex flex-col">
   189â†’        {/* Header */}
   190â†’        <header className="py-4 px-6 flex items-center justify-between border-b border-border">
   191â†’          <div className="flex items-center gap-4">
   192â†’            <button
   193â†’              onClick={handleBack}
   194â†’              className="p-2 rounded-lg hover:bg-foreground/5 transition-colors"
   195â†’            >
   196â†’              <ArrowLeft className="w-5 h-5 text-foreground" />
   197â†’            </button>
   198â†’            <div className="flex items-center gap-2">
   199â†’              <VibeGlyph size="sm" skill={skill} showAura={false} />
   200â†’              <span className="font-serif font-semibold text-foreground">æˆ‘çš„æŠ¥å‘Š</span>
   201â†’            </div>
   202â†’          </div>
   203â†’
   204â†’          <button
   205â†’            onClick={handleStartInterview}
   206â†’            className="flex items-center gap-2 px-4 py-2 bg-skill-primary text-white rounded-lg text-sm font-medium hover:bg-skill-primary/90 transition-colors"
   207â†’          >
   208â†’            <Plus className="w-4 h-4" />
   209â†’            ç”Ÿæˆæ–°æŠ¥å‘Š
   210â†’          </button>
   211â†’        </header>
   212â†’
   213â†’        {/* Main Content */}
   214â†’        <main className="flex-1 px-6 py-8">
   215â†’          <div className="max-w-2xl mx-auto">
   216â†’            {error && (
   217â†’              <motion.div
   218â†’                initial={{ opacity: 0, y: -10 }}
   219â†’                animate={{ opacity: 1, y: 0 }}
   220â†’                className="mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl text-red-700 dark:text-red-300"
   221â†’              >
   222â†’                {error}
   223â†’              </motion.div>
   224â†’            )}
   225â†’
   226â†’            {isLoading ? (
   227â†’              // Loading skeleton
   228â†’              <div className="space-y-4">
   229â†’                {[1, 2].map((i) => (
   230â†’                  <div
   231â†’                    key={i}
   232â†’                    className="bg-card rounded-xl p-6 animate-pulse"
   233â†’                  >
   234â†’                    <div className="h-5 bg-muted rounded w-1/3 mb-3" />
   235â†’                    <div className="h-4 bg-muted rounded w-1/2" />
   236â†’                  </div>
   237â†’                ))}
   238â†’              </div>
   239â†’            ) : reports.length === 0 ? (
   240â†’              // Empty state
   241â†’              <motion.div
   242â†’                initial={{ opacity: 0, y: 20 }}
   243â†’                animate={{ opacity: 1, y: 0 }}
   244â†’                className="text-center py-16"
   245â†’              >
   246â†’                <div className="w-20 h-20 mx-auto mb-6 rounded-full bg-muted flex items-center justify-center">
   247â†’                  <FileText className="w-10 h-10 text-muted-foreground" />
   248â†’                </div>
   249â†’                <h2 className="font-serif text-xl font-semibold text-foreground mb-2">
   250â†’                  è¿˜æ²¡æœ‰æŠ¥å‘Š
   251â†’                </h2>
   252â†’                <p className="text-muted-foreground mb-8">
   253â†’                  ç”Ÿæˆä½ çš„ç¬¬ä¸€ä»½æ·±åº¦åˆ†ææŠ¥å‘Š
   254â†’                </p>
   255â†’                <button
   256â†’                  onClick={handleStartInterview}
   257â†’                  className="inline-flex items-center gap-2 px-6 py-3 bg-skill-primary text-white rounded-xl font-medium hover:bg-skill-primary/90 transition-colors"
   258â†’                >
   259â†’                  <Sparkles className="w-5 h-5" />
   260â†’                  å¼€å§‹ç”Ÿæˆ
   261â†’                </button>
   262â†’              </motion.div>
   263â†’            ) : (
   264â†’              // Report list
   265â†’              <div className="space-y-4">
   266â†’                {reports.map((report, index) => (
   267â†’                  <motion.button
   268â†’                    key={report.id}
   269â†’                    initial={{ opacity: 0, y: 20 }}
   270â†’                    animate={{ opacity: 1, y: 0 }}
   271â†’                    transition={{ delay: index * 0.1 }}
   272â†’                    onClick={() => handleViewReport(report.id)}
   273â†’                    className="w-full bg-card rounded-xl p-6 text-left hover:shadow-md transition-shadow group"
   274â†’                  >
   275â†’                    <div className="flex items-start justify-between">
   276â†’                      <div className="flex-1">
   277â†’                        <div className="flex items-center gap-2 mb-2">
   278â†’                          <span className="text-lg">
   279â†’                            {report.skill === "bazi" ? "ğŸ‹" : "âœ¨"}
   280â†’                          </span>
   281â†’                          <h3 className="font-semibold text-foreground">
   282â†’                            {report.title || (report.skill === "bazi" ? "å…«å­—åˆ†ææŠ¥å‘Š" : "æ˜Ÿåº§åˆ†ææŠ¥å‘Š")}
   283â†’                          </h3>
   284â†’                          {report.report_type === "lite" && (
   285â†’                            <span className="px-2 py-0.5 bg-muted text-muted-foreground text-xs rounded">
   286â†’                              åŸºç¡€ç‰ˆ
   287â†’                            </span>
   288â†’                          )}
   289â†’                          {report.report_type === "full" && (
   290â†’                            <span className="px-2 py-0.5 bg-skill-primary/10 text-skill-primary text-xs rounded">
   291â†’                              å®Œæ•´ç‰ˆ
   292â†’                            </span>
   293â†’                          )}
   294â†’                        </div>
   295â†’
   296â†’                        <div className="flex items-center gap-4 text-sm text-muted-foreground">
   297â†’                          <span className="flex items-center gap-1">
   298â†’                            <Clock className="w-4 h-4" />
   299â†’                            {new Date(report.created_at).toLocaleDateString("zh-CN")}
   300â†’                          </span>
   301â†’                          {report.status === "generating" && (
   302â†’                            <span className="text-amber-600 dark:text-amber-400">
   303â†’                              ç”Ÿæˆä¸­...
   304â†’                            </span>
   305â†’                          )}
   306â†’                          {report.status === "failed" && (
   307â†’                            <span className="text-red-600 dark:text-red-400">
   308â†’                              ç”Ÿæˆå¤±è´¥
   309â†’                            </span>
   310â†’                          )}
   311â†’                        </div>
   312â†’                      </div>
   313â†’
   314â†’                      <ChevronRight className="w-5 h-5 text-muted-foreground group-hover:text-foreground transition-colors" />
   315â†’                    </div>
   316â†’                  </motion.button>
   317â†’                ))}
   318â†’              </div>
   319â†’            )}
   320â†’          </div>
   321â†’        </main>
   322â†’      </div>
   323â†’    </LuminousPaper>
   324â†’  );
   325â†’}
   326â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
