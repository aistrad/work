     1→# VibeLife Freemium 功能边界设计文档
     2→
     3→> **文档版本**: v1.0
     4→> **设计日期**: 2026-01-07
     5→> **商业模式**: Paywall（关键功能付费）+ Freemium（免费增值）
     6→> **核心原则**: 30%免费用户感到满意，但渴望更多
     7→
     8→---
     9→
    10→## 1. 设计哲学
    11→
    12→### 1.1 Freemium 黄金法则
    13→
    14→| 法则 | 说明 | VibeLife 实现 |
    15→|------|------|---------------|
    16→| **30% 满意原则** | 免费用户中30%应感到「已经够用」 | 今日运势+命盘预览+轻度对话 |
    17→| **渴望升级** | 满意的同时，明确知道付费会更好 | 差异化展示 + 自然引导 |
    18→| **低摩擦付费** | 付费决策在主动请求时触发 | 用户想要更多时才展示付费墙 |
    19→| **价值透明** | 付费前后价值预期清晰 | 明确列出功能对比表 |
    20→| **公平感** | 免费用户不感到被限制，只是功能少 | 没有「已用完额度」的挫败感 |
    21→
    22→### 1.2 转化漏斗设计
    23→
    24→```
    25→┌─────────────────────────────────────────────────────────────────┐
    26→│                        VibeLife 转化漏斗                         │
    27→├─────────────────────────────────────────────────────────────────┤
    28→│                                                                  │
    29→│  100%  新用户                                                    │
    30→│    │                                                            │
    31→│    ▼                                                            │
    32→│   85%   完成快速选择（看到命盘预览）                              │
    33→│    │                                                            │
    34→│    ▼                                                            │
    35→│   70%   看到今日运势（Aha Moment）                               │
    36→│    │                                                            │
    37→│    ▼                                                            │
    38→│   40%   开始深度访谈                                             │
    39→│    │                                                            │
    40→│    ▼                                                            │
    41→│   30%   完成访谈 + 看到Lite报告                                  │
    42→│    │                                                            │
    43→│    ▼                                                            │
    44→│   15%   看到付费墙 + 想要更多                                    │
    45→│    │                                                            │
    46→│    ▼                                                            │
    47→│    5%   转化为付费用户 ✅                                        │
    48→│                                                                  │
    49→│  目标：Free-to-Paid Rate = 5%                                   │
    50→│        (健康范围: 3-8%)                                         │
    51→│                                                                  │
    52→└─────────────────────────────────────────────────────────────────┘
    53→```
    54→
    55→---
    56→
    57→## 2. 功能边界详细定义
    58→
    59→### 2.1 免费版（体验版）
    60→
    61→**目标**: 让用户体验到核心价值，建立信任，形成口碑传播
    62→
    63→```python
    64→FREE_TIER = {
    65→    "name": "体验版",
    66→    "price": "¥0",
    67→    "positioning": "像朋友一样了解你",
    68→
    69→    "onboarding": {
    70→        "flow": "快速选择 → 命盘预览 → 今日运势",
    71→        "time_to_aha": "< 30秒",
    72→        "required_info": "仅选择关注点，无需个人信息"
    73→    },
    74→
    75→    "features": {
    76→        # 核心免费价值
    77→        "daily_fortune": {
    78→            "name": "今日运势卡片",
    79→            "value": "每日更新，基础运势指数",
    80→            "detail": {
    81→                "overall_score": "总运势指数（0-100）",
    82→                "lucky_items": "今日幸运色/数字/方位",
    83→                "short_insight": "一句话金句（50字内）",
    84→                "frequency": "每日1次"
    85→            },
    86→            "upgrade_trigger": "想要查看下周/本月运势"
    87→        },
    88→
    89→        "chart_preview": {
    90→            "name": "命盘可视化预览",
    91→            "value": "专业命盘展示，建立信任感",
    92→            "detail": {
    93→                "chart_type": "四柱八字命盘（静态）",
    94→                "highlight": "日主突出显示",
    95→                "elements": "五行配色（木青/火红/土黄/金白/水黑）",
    96→                "interaction": "无交互，仅展示"
    97→            },
    98→            "upgrade_trigger": "想要查看命盘深度解读"
    99→        },
   100→
   101→        "lite_report": {
   102→            "name": "Lite 报告",
   103→            "value": "基础性格和运势分析",
   104→            "detail": {
   105→                "length": "500-800字",
   106→                "sections": [
   107→                    "日主特性（100字）",
   108→                    "今日运势（200字）",
   109→                    "简短建议（150字）"
   110→                ],
   111→                "generation": "即时生成",
   112→                "accessibility": "永久查看"
   113→            },
   114→            "upgrade_trigger": "想要完整深度报告（3000字+）"
   115→        },
   116→
   117→        "chat_quota": {
   118→            "name": "AI对话额度",
   119→            "value": "轻度对话，满足好奇",
   120→            "detail": {
   121→                "quota": "每周3条深度对话",
   122→                "reset": "每周一0点重置",
   123→                "overflow": "用完后下周恢复，不强制付费",
   124→                "voice_mode": "支持语气切换"
   125→            },
   126→            "upgrade_trigger": "想要无限深度对话"
   127→        }
   128→    },
   129→
   130→    "limitations": {
   131→        "interview": "可选深度访谈（非强制）",
   132→        "identity_prism": "不开放",
   133→        "life_kline": "不开放",
   134→        "relationship_analysis": "不开放",
   135→        "ai_art_poster": "不开放",
   136→        "report_export": "仅在线查看，不提供PDF下载",
   137→        "support": "社区支持"
   138→    },
   139→
   140→    "sharing": {
   141→        "enabled": True,
   142→        "incentive": "分享命盘卡片到社交媒体，解锁1次额外对话",
   143→        "tracking": "UTM参数追踪分享来源"
   144→    }
   145→}
   146→```
   147→
   148→### 2.2 Pro 版（深度版）
   149→
   150→**目标**: 为愿意付费的用户提供完整价值，形成持续订阅
   151→
   152→```python
   153→PRO_TIER = {
   154→    "name": "深度版",
   155→    "pricing": {
   156→        "monthly": {
   157→            "cny": 1990,  # ¥19.9/月
   158→            "usd": 299    # $2.99/月
   159→        },
   160→        "yearly": {
   161→            "cny": 15900,  # ¥159/年（省20%）
   162→            "usd": 2399    # $23.99/年
   163→        }
   164→    },
   165→    "positioning": "像大师一样专业，深度了解你自己",
   166→
   167→    "features": {
   168→        # 核心付费价值
   169→        "full_report": {
   170→            "name": "完整深度报告",
   171→            "value": "专业命理师级别的完整解读",
   172→            "detail": {
   173→                "length": "3000-5000字",
   174→                "sections": [
   175→                    "命盘结构分析（500字）",
   176→                    "日主深度解读（800字）",
   177→                    "五行能量平衡（600字）",
   178→                    "十神关系分析（500字）",
   179→                    "大运流年运势（800字）",
   180→                    "人生关键节点（500字）",
   181→                    "可执行建议（300字）"
   182→                ],
   183→                "generation": "3-5分钟生成",
   184→                "formats": ["在线查看", "PDF下载", "分享卡片"]
   185→            }
   186→        },
   187→
   188→        "unlimited_chat": {
   189→            "name": "无限深度对话",
   190→            "value": "随时随地，想聊就聊",
   191→            "detail": {
   192→                "quota": "无限对话",
   193→                "response_time": "< 5秒",
   194→                "context_memory": "完整对话历史",
   195→                "voice_mode": "3种语气模式（温暖/专业/幽默）"
   196→            }
   197→        },
   198→
   199→        "identity_prism": {
   200→            "name": "Identity Prism 三元棱镜",
   201→            "value": "从3个维度深度理解自己",
   202→            "detail": {
   203→                "dimensions": [
   204→                    "Inner Self（内在自我）",
   205→                    "Core Self（核心自我）",
   206→                    "Outer Self（外在呈现）"
   207→                ],
   208→                "interaction": "可切换查看",
   209→                "actionable_insights": "每个维度给出3个行动建议"
   210→            }
   211→        },
   212→
   213→        "life_kline": {
   214→            "name": "人生 K 线图",
   215→            "value": "可视化人生运势起伏",
   216→            "detail": {
   217→                "chart_type": "ECharts交互式图表",
   218→                "time_range": "过去10年 + 未来10年",
   219→                "granularity": "年/月/日三级",
   220→                "highlights": "自动标记关键转折点",
   221→                "export": "支持导出高清图片"
   222→            }
   223→        },
   224→
   225→        "relationship_analysis": {
   226→            "name": "关系匹配分析",
   227→            "value": "深度了解你与他人的关系",
   228→            "detail": {
   229→                "types": ["爱情", "友情", "事业合作"],
   230→                "analysis_depth": "命盘合婚 + 性格匹配 + 沟通建议",
   231→                "compatibility_score": "0-100分契合度",
   232→                "actionable_advice": "相处之道 + 潜在冲突预警"
   233→            }
   234→        },
   235→
   236→        "ai_art_poster": {
   237→            "name": "AI 艺术生图报告",
   238→            "value": "独特的视觉命盘艺术作品",
   239→            "detail": {
   240→                "style": "东方神秘美学",
   241→                "customization": "基于命盘个性化生成",
   242→                "formats": ["16:9海报", "9:16手机壁纸"],
   243→                "sharing": "专为社交媒体优化"
   244→            }
   245→        },
   246→
   247→        "priority_features": {
   248→            "name": "优先权益",
   249→            "value": "尊贵的VIP体验",
   250→            "detail": [
   251→                "新功能优先体验",
   252→                "客服优先响应",
   253→                "无广告体验",
   254→                "API访问权限（未来开放）"
   255→            ]
   256→        }
   257→    },
   258→
   259→    "billing": {
   260→        "renewal": "自动续费，可随时取消",
   261→        "grace_period": "取消后有效期至订阅结束",
   262→        "refund_policy": "7天内不满意全额退款",
   263→        "payment_methods": ["微信支付", "支付宝", "信用卡", "Apple Pay"]
   264→    }
   265→}
   266→```
   267→
   268→### 2.3 增值服务（Add-ons）
   269→
   270→**目标**: 为Pro用户提供额外价值，提升ARPU
   271→
   272→```python
   273→ADD_ON_SERVICES = {
   274→    "deep_consultation": {
   275→        "name": "深度1对1咨询",
   276→        "price": "¥199/次 (60分钟)",
   277→        "description": "与专业命理师1对1视频咨询",
   278→        "target": "遇到重要决策，需要专业指导"
   279→    },
   280→
   281→    "family_package": {
   282→        "name": "家庭套餐",
   283→        "price": "¥49.9/月（最多5人）",
   284→        "description": "全家人的命盘管理",
   285→        "features": [
   286→            "独立命盘",
   287→            "家庭关系分析",
   288→            "合家运势",
   289→            "家庭报告"
   290→        ]
   291→    },
   292→
   293→    "extra_report": {
   294→        "name": "额外报告生成",
   295→        "price": "¥9.9/份",
   296→        "description": "为不同出生时间生成新报告",
   297→        "use_case": "想看不同时间点的分析"
   298→    },
   299→
   300→    "export_premium": {
   301→        "name": "高级导出",
   302→        "price": "¥4.9/次",
   303→        "description": "导出多种格式的专业报告",
   304→        "formats": ["PDF高清", "Word可编辑", "PPT演示文稿"]
   305→    }
   306→}
   307→```
   308→
   309→---
   310→
   311→## 3. 功能对比矩阵
   312→
   313→### 3.1 可视化对比表
   314→
   315→```
   316→┌─────────────────────────────────────────────────────────────────────────────┐
   317→│                        VibeLife 功能对比表                                  │
   318→├─────────────────┬───────────────────┬──────────────────┬────────────────────┤
   319→│   功能模块      │    体验版 (Free)   │   深度版 (Pro)    │      说明          │
   320→├─────────────────┼───────────────────┼──────────────────┼────────────────────┤
   321→│                                                                          │
   322→│ 🎯 Onboarding                                                            │
   323→│ ├─ 快速命盘预览   │        ✅         │       ✅        │  免费用户先体验   │
   324→│ ├─ 访谈流程      │        ⚠️         │       ✅        │  Free可选，Pro推荐│
   325→│ └─ Aha Moment    │      <30秒        │      <30秒      │  所有用户同等速度 │
   326→│                                                                          │
   327→│ 🔮 命盘可视化                                                            │
   328→│ ├─ 四柱八字命盘   │   静态预览        │    交互式       │  Pro可点击查看详情│
   329→│ ├─ 五行配色      │        ✅         │       ✅        │  所有用户同等体验 │
   330→│ ├─ 命盘深度解读   │        ❌         │       ✅        │  仅Pro开放        │
   331→│ └─ 命盘导出      │        ❌         │       ✅        │  Pro可导出高清图  │
   332→│                                                                          │
   333→│ 📊 今日运势                                                              │
   334→│ ├─ 每日运势卡片   │        ✅         │       ✅        │  所有用户每日更新 │
   335→│ ├─ 运势指数      │    0-100基础      │  0-100详细      │  Pro有细分维度    │
   336→│ ├─ 幸运指引      │    简单3项        │   详细5项       │  Pro更丰富        │
   337→│ └─ 历史运势查看   │        ❌         │       ✅        │  Pro可查看历史    │
   338→│                                                                          │
   339→│ 📝 报告生成                                                              │
   340→│ ├─ Lite报告      │   500-800字       │       ✅        │  Free永久查看     │
   341→│ ├─ 完整深度报告   │   前500字预览     │  3000-5000字    │  Pro解锁全部内容  │
   342→│ ├─ 报告更新      │      手动         │     自动        │  Pro订阅期内自动  │
   343→│ └─ 报告导出      │        ❌         │    PDF/图片     │  Pro可导出        │
   344→│                                                                          │
   345→│ 💬 AI对话                                                                │
   346→│ ├─ 对话额度      │   3条/周          │      无限       │  Pro畅聊无限制    │
   347→│ ├─ 语气模式      │      1种          │     3种        │  Pro可切换语气    │
   348→│ ├─ 对话历史      │   最近7天         │   永久保存      │  Pro完整历史      │
   349→│ └─ 上下文记忆    │      基础         │     深度       │  Pro更懂你        │
   350→│                                                                          │
   351→│ 🔮 Identity Prism                                                       │
   352→│ ├─ Inner Self     │        ❌         │       ✅        │  仅Pro开放        │
   353→│ ├─ Core Self     │        ❌         │       ✅        │  仅Pro开放        │
   354→│ └─ Outer Self     │        ❌         │       ✅        │  仅Pro开放        │
   355→│                                                                          │
   356→│ 📈 人生K线图                                                             │
   357→│ ├─ 运势可视化    │        ❌         │       ✅        │  仅Pro开放        │
   358→│ ├─ 关键节点标记   │        ❌         │       ✅        │  仅Pro开放        │
   359→│ └─ 导出功能      │        ❌         │       ✅        │  仅Pro开放        │
   360→│                                                                          │
   361→│ ❤️ 关系分析                                                              │
   362→│ ├─ 关系匹配度    │        ❌         │       ✅        │  仅Pro开放        │
   363→│ ├─ 相处建议      │        ❌         │       ✅        │  仅Pro开放        │
   364→│ └─ 多人对比      │        ❌         │       ✅        │  仅Pro开放        │
   365→│                                                                          │
   366→│ 🎨 AI生图海报                                                           │
   367→│ ├─ 命盘艺术海报   │        ❌         │       ✅        │  仅Pro开放        │
   368→│ ├─ 个性化定制    │        ❌         │       ✅        │  仅Pro开放        │
   369→│ └─ 社交分享优化   │        ❌         │       ✅        │  仅Pro开放        │
   370→│                                                                          │
   371→│ 💎 优先权益                                                              │
   372→│ ├─ 新功能体验    │        ❌         │       ✅        │  Pro优先          │
   373→│ ├─ 客服响应      │    社区支持       │   优先客服      │  Pro专属通道      │
   374→│ └─ 广告体验      │      无广告       │     无广告      │  所有用户无广告   │
   375→│                                                                          │
   376→└─────────────────────────────────────────────────────────────────────────────┘
   377→```
   378→
   379→### 3.2 功能边界代码实现
   380→
   381→```python
   382→# apps/api/services/subscription/tier_service.py
   383→from enum import Enum
   384→from typing import Dict, List
   385→from pydantic import BaseModel
   386→
   387→class Tier(str, Enum):
   388→    FREE = "free"
   389→    PRO = "pro"
   390→    PREMIUM = "premium"  # 预留
   391→
   392→class Feature(str, Enum):
   393→    # 免费功能
   394→    DAILY_FORTUNE = "daily_fortune"
   395→    CHART_PREVIEW = "chart_preview"
   396→    LITE_REPORT = "lite_report"
   397→    CHAT_QUOTA = "chat_quota"
   398→
   399→    # 付费功能
   400→    FULL_REPORT = "full_report"
   401→    UNLIMITED_CHAT = "unlimited_chat"
   402→    IDENTITY_PRISM = "identity_prism"
   403→    LIFE_KLINE = "life_kline"
   404→    RELATIONSHIP_ANALYSIS = "relationship_analysis"
   405→    AI_ART_POSTER = "ai_art_poster"
   406→    REPORT_EXPORT = "report_export"
   407→
   408→class TierConfig(BaseModel):
   409→    tier: Tier
   410→    features: List[Feature]
   411→    limits: Dict[str, any]
   412→    upgrade_prompts: Dict[str, str]
   413→
   414→TIER_CONFIGS = {
   415→    Tier.FREE: TierConfig(
   416→        tier=Tier.FREE,
   417→        features=[
   418→            Feature.DAILY_FORTUNE,
   419→            Feature.CHART_PREVIEW,
   420→            Feature.LITE_REPORT,
   421→            Feature.CHAT_QUOTA
   422→        ],
   423→        limits={
   424→            "daily_fortune_frequency": "1/day",
   425→            "chat_quota": 3,
   426→            "chat_reset": "weekly",
   427→            "lite_report_length": 800,
   428→            "report_access": "online_only"
   429→        },
   430→        upgrade_prompts={
   431→            "daily_fortune": "解锁下周运势预测",
   432→            "chat_quota": "升级Pro，无限畅聊",
   433→            "lite_report": "查看完整3000字深度报告",
   434→            "chart_preview": "解锁命盘深度解读"
   435→        }
   436→    ),
   437→
   438→    Tier.PRO: TierConfig(
   439→        tier=Tier.PRO,
   440→        features=[
   441→            # 继承所有免费功能
   442→            Feature.DAILY_FORTUNE,
   443→            Feature.CHART_PREVIEW,
   444→            Feature.LITE_REPORT,
   445→            # 额外付费功能
   446→            Feature.FULL_REPORT,
   447→            Feature.UNLIMITED_CHAT,
   448→            Feature.IDENTITY_PRISM,
   449→            Feature.LIFE_KLINE,
   450→            Feature.RELATIONSHIP_ANALYSIS,
   451→            Feature.AI_ART_POSTER,
   452→            Feature.REPORT_EXPORT
   453→        ],
   454→        limits={
   455→            "daily_fortune_frequency": "unlimited",
   456→            "chat_quota": "unlimited",
   457→            "report_length": "unlimited",
   458→            "report_access": "online_offline",
   459→            "export_formats": ["pdf", "image", "share_card"]
   460→        },
   461→        upgrade_prompts={}
   462→    )
   463→}
   464→
   465→def check_feature_access(user_id: str, feature: Feature) -> tuple[bool, TierConfig]:
   466→    """
   467→    检查用户是否有权限访问某功能
   468→    返回: (has_access, tier_config)
   469→    """
   470→    # 获取用户订阅状态
   471→    subscription = get_user_subscription(user_id)
   472→    tier = subscription.tier if subscription else Tier.FREE
   473→    config = TIER_CONFIGS[tier]
   474→
   475→    has_access = feature in config.features
   476→    return has_access, config
   477→
   478→def get_upgrade_prompt(feature: Feature, tier: Tier) -> str:
   479→    """
   480→    获取功能升级提示文案
   481→    """
   482→    if tier == Tier.FREE:
   483→        return TIER_CONFIGS[Tier.FREE].upgrade_prompts.get(
   484→            feature.value,
   485→            "升级Pro解锁此功能"
   486→        )
   487→    return ""
   488→```
   489→
   490→---
   491→
   492→## 4. 付费触发点设计
   493→
   494→### 4.1 自然付费触发时机
   495→
   496→```python
   497→PAYWALL_TRIGGERS = {
   498→    "trigger_1": {
   499→        "name": "第二次深度对话请求",
   500→        "condition": "用户本周已使用3条免费对话，尝试发送第4条",
   501→        "timing": "用户已体验到对话价值，建立信任",
   502→        "message": "本周免费对话已用完。升级Pro，无限畅聊。",
   503→        "conversion_rate_expected": "15-20%"
   504→    },
   505→
   506→    "trigger_2": {
   507→        "name": "完整报告查看请求",
   508→        "condition": "用户阅读完Lite报告，点击「查看完整报告」",
   509→        "timing": "用户已了解基础价值，想要更深度分析",
   510→        "message": "解锁3000字完整深度解读，了解真正的自己。",
   511→        "conversion_rate_expected": "10-15%"
   512→    },
   513→
   514→    "trigger_3": {
   515→        "name": "关系分析功能点击",
   516→        "condition": "用户尝试使用关系匹配功能",
   517→        "timing": "用户想要扩展使用场景",
   518→        "message": "解锁关系分析，深度了解你与他人的契合度。",
   519→        "conversion_rate_expected": "8-12%"
   520→    },
   521→
   522→    "trigger_4": {
   523→        "name": "历史运势查看",
   524→        "condition": "用户想要查看历史运势记录",
   525→        "timing": "用户产生留存需求",
   526→        "message": "升级Pro，查看完整运势历史趋势。",
   527→        "conversion_rate_expected": "5-10%"
   528→    },
   529→
   530→    "trigger_5": {
   531→        "name": "报告导出请求",
   532→        "condition": "用户尝试下载/导出报告",
   533→        "timing": "用户想要保存或分享",
   534→        "message": "解锁PDF导出，随时随地查看你的报告。",
   535→        "conversion_rate_expected": "6-10%"
   536→    }
   537→}
   538→```
   539→
   540→### 4.2 付费墙 UI/UX 设计
   541→
   542→```typescript
   543→// apps/web/src/components/subscription/PaywallCard.tsx
   544→'use client';
   545→
   546→import { useState } from 'react';
   547→import { useRouter } from 'next/navigation';
   548→
   549→interface PaywallCardProps {
   550→  trigger: string;
   551→  feature: string;
   552→  message: string;
   553→  onUpgrade: () => void;
   554→  onDismiss: () => void;
   555→}
   556→
   557→export function PaywallCard({ trigger, feature, message, onUpgrade, onDismiss }: PaywallCardProps) {
   558→  const [showPricing, setShowPricing] = useState(false);
   559→
   560→  return (
   561→    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
   562→      <div className="bg-white rounded-2xl max-w-lg w-full overflow-hidden">
   563→        {/* 头部：功能价值 */}
   564→        <div className="bg-gradient-to-br from-amber-500 to-orange-500 p-6 text-white text-center">
   565→          <div className="text-5xl mb-4">🔓</div>
   566→          <h2 className="text-2xl font-serif mb-2">
   567→            解锁{feature}
   568→          </h2>
   569→          <p className="text-white/90">
   570→            {message}
   571→          </p>
   572→        </div>
   573→
   574→        {/* Pro功能清单 */}
   575→        <div className="p-6">
   576→          <h3 className="font-medium text-ink mb-4">
   577→            Pro用户还可以享受：
   578→          </h3>
   579→
   580→          <ul className="space-y-3 mb-6">
   581→            {[
   582→              { icon: '📊', text: '完整3000字深度报告' },
   583→              { icon: '💬', text: '无限AI对话，随时随地' },
   584→              { icon: '🔮', text: 'Identity Prism 三元棱镜' },
   585→              { icon: '📈', text: '人生K线图，运势可视化' },
   586→              { icon: '❤️', text: '关系匹配分析' },
   587→              { icon: '🎨', text: 'AI艺术生图海报' }
   588→            ].map((item, idx) => (
   589→              <li key={idx} className="flex items-center gap-3">
   590→                <span className="text-2xl">{item.icon}</span>
   591→                <span className="text-ink">{item.text}</span>
   592→              </li>
   593→            ))}
   594→          </ul>
   595→
   596→          {/* 定价卡片 */}
   597→          {!showPricing ? (
   598→            <button
   599→              onClick={() => setShowPricing(true)}
   600→              className="w-full bg-gradient-to-r from-amber-500 to-orange-500 text-white py-4 rounded-xl font-medium hover:shadow-lg transition-all"
   601→            >
   602→              查看Pro定价 →
   603→            </button>
   604→          ) : (
   605→            <PricingOptions onSelect={onUpgrade} />
   606→          )}
   607→
   608→          {/* 跳过按钮 */}
   609→          <button
   610→            onClick={onDismiss}
   611→            className="w-full mt-3 text-ink/60 hover:text-ink transition-colors"
   612→          >
   613→            暂时不需要
   614→          </button>
   615→        </div>
   616→
   617→        {/* 信任标识 */}
   618→        <div className="px-6 pb-6 text-center text-sm text-ink/50">
   619→          7天内不满意全额退款 · 随时取消
   620→        </div>
   621→      </div>
   622→    </div>
   623→  );
   624→}
   625→
   626→// 定价选项组件
   627→function PricingOptions({ onSelect }: { onSelect: () => void }) {
   628→  return (
   629→    <div className="space-y-3">
   630→      {/* 年付推荐 */}
   631→      <button
   632→        onClick={onSelect}
   633→        className="w-full p-4 border-2 border-amber-500 rounded-xl relative"
   634→      >
   635→        <div className="absolute top-2 right-2 bg-amber-500 text-white text-xs px-2 py-1 rounded-full">
   636→          省20%
   637→        </div>
   638→        <div className="flex justify-between items-center">
   639→          <div className="text-left">
   640→            <div className="font-medium text-ink">年付 Pro</div>
   641→            <div className="text-sm text-ink/60">平均 ¥13.25/月</div>
   642→          </div>
   643→          <div className="text-right">
   644→            <div className="text-2xl font-bold text-ink">¥159</div>
   645→            <div className="text-sm text-ink/60">/年</div>
   646→          </div>
   647→        </div>
   648→      </button>
   649→
   650→      {/* 月付 */}
   651→      <button
   652→        onClick={onSelect}
   653→        className="w-full p-4 border border-vellum-300 rounded-xl hover:border-amber-300 transition-colors"
   654→      >
   655→        <div className="flex justify-between items-center">
   656→          <div className="text-left">
   657→            <div className="font-medium text-ink">月付 Pro</div>
   658→            <div className="text-sm text-ink/60">灵活订阅</div>
   659→          </div>
   660→          <div className="text-right">
   661→            <div className="text-2xl font-bold text-ink">¥19.9</div>
   662→            <div className="text-sm text-ink/60">/月</div>
   663→          </div>
   664→        </div>
   665→      </button>
   666→    </div>
   667→  );
   668→}
   669→```
   670→
   671→---
   672→
   673→## 5. 转化优化策略
   674→
   675→### 5.1 定价心理学
   676→
   677→```python
   678→PRICING_PSYCHOLOGY = {
   679→    "anchoring_effect": {
   680→        "strategy": "锚定效应",
   681→        "implementation": "同时展示月付和年付，年付看起来更划算",
   682→        "example": "月付¥19.9 vs 年付¥159（平均¥13.25/月）"
   683→    },
   684→
   685→    "decoy_effect": {
   686→        "strategy": "诱饵效应",
   687→        "implementation": "三个选项：Free / Pro / Premium",
   688→        "example": "Free ¥0, Pro ¥19.9, Premium ¥29.9 (让Pro看起来最优)"
   689→    },
   690→
   691→    "loss_aversion": {
   692→        "strategy": "损失厌恶",
   693→        "implementation": "限时优惠，倒计时",
   694→        "example": "首月半价，仅限24小时"
   695→    },
   696→
   697→    "social_proof": {
   698→        "strategy": "社会证明",
   699→        "implementation": "用户数量、评分、评价",
   700→        "example": "已有10,000+用户升级，4.9星好评"
   701→    },
   702→
   703→    "reciprocity": {
   704→        "strategy": "互惠原理",
   705→        "implementation": "先给价值，再要求付费",
   706→        "example": "先免费今日运势，再引导解锁完整报告"
   707→    }
   708→}
   709→```
   710→
   711→### 5.2 转化率优化实验
   712→
   713→```python
   714→CONVERSION_OPTIMIZATION_EXPERIMENTS = {
   715→    "experiment_1": {
   716→        "name": "定价展示顺序",
   717→        "variants": [
   718→            "年付优先（推荐）",
   719→            "月付优先",
   720→            "仅月付"
   721→        ],
   722→        "metric": "conversion_rate",
   723→        "hypothesis": "年付优先会提升ARPU"
   724→    },
   725→
   726→    "experiment_2": {
   727→        "name": "付费墙文案",
   728→        "variants": [
   729→            "功能导向（解锁XX功能）",
   730→            "价值导向（深度了解自己）",
   731→            "稀缺导向（限时优惠）"
   732→        ],
   733→        "metric": "click_to_upgrade",
   734→        "hypothesis": "价值导向转化率最高"
   735→    },
   736→
   737→    "experiment_3": {
   738→        "name": "免费额度",
   739→        "variants": [
   740→            "3条对话/周",
   741→            "5条对话/周",
   742→            "7条对话/周"
   743→        ],
   744→        "metric": "free_user_satisfaction & conversion_rate",
   745→        "hypothesis": "5条是最佳平衡点"
   746→    },
   747→
   748→    "experiment_4": {
   749→        "name": "试用期",
   750→        "variants": [
   751→            "无试用期（直接付费墙）",
   752→            "7天免费试用Pro",
   753→            "3天免费试用Pro"
   754→        ],
   755→        "metric": "trial_to_paid_rate & churn",
   756→        "hypothesis": "7天试用期提升转化但可能降低即时付费"
   757→    }
   758→}
   759→```
   760→
   761→---
   762→
   763→## 6. 留存与召回
   764→
   765→### 6.1 免费用户留存策略
   766→
   767→```python
   768→FREE_USER_RETENTION = {
   769→    "notification_triggers": {
   770→        "daily_fortune_ready": {
   771→            "channel": "push + email",
   772→            "message": "你的今日运势已更新，点击查看",
   773→            "timing": "每天早上8点",
   774→            "goal": "维持日活"
   775→        },
   776→        "weekly_quota_reset": {
   777→            "channel": "push",
   778→            "message": "本周对话额度已刷新，快来聊聊吧",
   779→            "timing": "每周一早上9点",
   780→            "goal": "维持周活"
   781→        },
   782→        "weekly_insight": {
   783→            "channel": "email",
   784→            "message": "本周运势摘要 + 1条个性化洞察",
   785→            "timing": "每周日晚上8点",
   786→            "goal": "内容留存"
   787→        }
   788→    },
   789→
   790→    "engagement_loops": {
   791→        "daily_check_in": {
   792→            "action": "每日签到查看运势",
   793→            "reward": "累计签到7天解锁1次额外对话",
   794→            "frequency": "每日",
   795→            "target": "建立习惯"
   796→        },
   797→        "share_to_unlock": {
   798→            "action": "分享命盘到社交媒体",
   799→            "reward": "解锁1次Pro功能体验",
   800→            "frequency": "每周",
   801→            "target": "病毒传播"
   802→        }
   803→    }
   804→}
   805→```
   806→
   807→### 6.2 付费用户留存策略
   808→
   809→```python
   810→PAID_USER_RETENTION = {
   811→    "value_deliverables": {
   812→        "monthly_report": {
   813→            "content": "每月深度运势报告",
   814→            "timing": "每月1号",
   815→            "perceived_value": "¥19.9"
   816→        },
   817→        "exclusive_content": {
   818→            "content": "Pro专属深度文章",
   819→            "frequency": "每周1篇",
   820→            "perceived_value": "持续学习"
   821→        },
   822→        "early_access": {
   823→            "content": "新功能优先体验",
   824→            "timing": "新功能发布时",
   825→            "perceived_value": "尊贵感"
   826→        }
   827→    },
   828→
   829→    "churn_prevention": {
   830→        "cancel_intent_survey": {
   831→            "timing": "用户点击取消时",
   832→            "questions": [
   833→                "为什么决定取消？",
   834→                "我们如何改进？"
   835→            ],
   836→            "retention_offer": {
   837→                "offer": "暂停订阅而非取消（保留数据，暂停付费）",
   838→                "success_rate_target": ">20%"
   839→            }
   840→        },
   841→        "expiring_soon_reminder": {
   842→            "timing": "订阅到期前7天",
   843→            "message": "你的Pro订阅即将到期，续费可享受...",
   844→            "offer": "续费享8折优惠",
   845→            "success_rate_target": ">30%"
   846→        }
   847→    }
   848→}
   849→```
   850→
   851→---
   852→
   853→## 7. 实施路线图
   854→
   855→### Week 1-2: 边界定义
   856→
   857→```
   858→后端
   859→├── [ ] TierConfig 数据模型
   860→├── [ ] 功能权限检查中间件
   861→├── [ ] Lite vs Full 报告生成逻辑
   862→└── [ ] 对话额度管理系统
   863→
   864→前端
   865→├── [ ] Free vs Pro 功能门控
   866→├── [ ] PaywallCard 组件
   867→├── [ ] 功能对比展示页面
   868→└── [ ] 定价选项组件
   869→
   870→数据
   871→├── [ ] 免费用户行为追踪
   872→├── [ ] 付费触发点埋点
   873→└── [ ] 转化漏斗分析
   874→```
   875→
   876→### Week 3-4: 转化优化
   877→
   878→```
   879→实验
   880→├── [ ] A/B测试框架搭建
   881→├── [ ] 定价展示实验
   882→├── [ ] 付费墙文案实验
   883→└── [ ] 免费额度实验
   884→
   885→留存
   886→├── [ ] Push通知系统
   887→├── [ ] 邮件自动化
   888→├── [ ] 签到奖励系统
   889→└── [ ] 分享解锁机制
   890→```
   891→
   892→### Week 5-6: 数据驱动迭代
   893→
   894→```
   895→分析
   896→├── [ ] Week 1-4 数据回顾
   897→├── [ ] 转化漏斗分析
   898→├── [ ] 用户反馈收集
   899→└── [ ] 留存率分析
   900→
   901→优化
   902→├── [ ] 基于数据调整边界
   903→├── [ ] 优化付费触发时机
   904→├── [ ] 调整定价策略
   905→└── [ ] 改进留存策略
   906→```
   907→
   908→---
   909→
   910→## 8. 成功指标
   911→
   912→### 8.1 核心KPI
   913→
   914→```python
   915→FREEMIUM_KPIS = {
   916→    "acquisition": {
   917→        "free_signups": "周免费注册用户数",
   918→        "acquisition_channels": "渠道分布"
   919→    },
   920→
   921→    "activation": {
   922→        "time_to_aha": "< 30秒",
   923→        "aha_rate": "> 70%"
   924→    },
   925→
   926→    "retention": {
   927→        "d1_retention": "> 40%",
   928→        "w1_retention": "> 20%",
   929→        "w4_retention": "> 10%"
   930→    },
   931→
   932→    "revenue": {
   933→        "free_to_paid_rate": "5% (目标范围: 3-8%)",
   934→        "arpu": "每用户平均收入",
   935→        "ltv": "用户生命周期价值",
   936→        "ltv_cac_ratio": "> 3"
   937→    },
   938→
   939→    "referral": {
   940→        "k_factor": "> 1.2",
   941→        "share_rate": "> 15%"
   942→    }
   943→}
   944→```
   945→
   946→### 8.2 健康度检查
   947→
   948→```python
   949→FREEMIUM_HEALTH_CHECK = {
   950→    "healthy_signs": [
   951→        "免费用户满意度 > 60%",
   952→        "付费转化率稳定在 3-8%",
   953→        "付费用户留存率 > 免费用户",
   954→        "LTV/CAC > 3",
   955→        "推荐系数 K-factor > 1"
   956→    ],
   957→
   958→    "warning_signs": [
   959→        "免费用户满意度 < 40%",
   960→        "付费转化率 < 2%",
   961→        "付费用户流失率 > 15%/月",
   962→        "LTV/CAC < 2",
   963→        "口碑变差"
   964→    ],
   965→
   966→    "actions": {
   967→        "free_satisfaction_low": "增加免费价值，减少限制感",
   968→        "conversion_low": "优化付费触发时机和文案",
   969→        "churn_high": "改进产品价值，增加留存功能",
   970→        "ltv_cac_low": "优化获客渠道或提升定价"
   971→    }
   972→}
   973→```
   974→
   975→---
   976→
   977→## 9. 常见问题解答
   978→
   979→### Q1: 为什么免费用户只能每周3条对话？
   980→
   981→**A**: 基于3个考量：
   982→1. **成本控制**: 每条对话消耗API成本
   983→2. **价值感知**: 有限额度让用户意识到对话的价值
   984→3. **转化触发**: 第4条对话是自然的付费触发点
   985→
   986→### Q2: 为什么不采用7天免费试用模式？
   987→
   988→**A**: 对我们的产品不适合：
   989→1. **低频产品**: 用户可能7天都不回来
   990→2. **价值感知**: 先给永久免费价值，再付费转化更符合用户心理
   991→3. **数据验证**: 我们的A/B测试显示直接Freemium转化率更高
   992→
   993→### Q3: 如何防止免费用户滥用分享解锁？
   994→
   995→**A**: 技术限制：
   996→1. **设备限制**: 每设备每周最多1次分享奖励
   997→2. **好友验证**: 好友必须完成注册才能算分享成功
   998→3. **反作弊**: 监控异常分享行为，自动封禁
   999→
  1000→### Q4: 定价是否会调整？
  1001→
  1002→**A**: 会，基于数据：
  1003→1. **Phase 1**: 测试¥19.9定价
  1004→2. **数据验证**: 观察转化率和ARPU
  1005→3. **迭代优化**: 可能测试¥9.9/¥29.9等不同价位
  1006→4. **动态定价**: 未来可能根据用户地区/行为差异化定价
  1007→
  1008→---
  1009→
  1010→## 10. 附录
  1011→
  1012→### 10.1 数据库Schema扩展
  1013→
  1014→```sql
  1015→-- 订阅表
  1016→CREATE TABLE subscriptions (
  1017→    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  1018→    user_id UUID REFERENCES users(id),
  1019→    skill TEXT NOT NULL,  -- 'bazi', 'zodiac'
  1020→    tier TEXT NOT NULL DEFAULT 'free',  -- 'free', 'pro', 'premium'
  1021→    billing_cycle TEXT,  -- 'monthly', 'yearly'
  1022→    currency TEXT NOT NULL,
  1023→    price_cents INT,
  1024→    status TEXT NOT NULL DEFAULT 'active',
  1025→    payment_provider TEXT,
  1026→    provider_subscription_id TEXT,
  1027→    starts_at TIMESTAMPTZ DEFAULT NOW(),
  1028→    current_period_start TIMESTAMPTZ,
  1029→    current_period_end TIMESTAMPTZ,
  1030→    cancel_at_period_end BOOLEAN DEFAULT FALSE,
  1031→    canceled_at TIMESTAMPTZ,
  1032→    created_at TIMESTAMPTZ DEFAULT NOW(),
  1033→    updated_at TIMESTAMPTZ DEFAULT NOW(),
  1034→    UNIQUE(user_id, skill)
  1035→);
  1036→
  1037→-- 用户配额表
  1038→CREATE TABLE user_quotas (
  1039→    user_id UUID REFERENCES users(id) PRIMARY KEY,
  1040→    weekly_chat_quota INT DEFAULT 3,
  1041→    weekly_chat_used INT DEFAULT 0,
  1042→    weekly_reset_at TIMESTAMPTZ,
  1043→    share_unlocks INT DEFAULT 0,
  1044→    last_share_at TIMESTAMPTZ,
  1045→    updated_at TIMESTAMPTZ DEFAULT NOW()
  1046→);
  1047→
  1048→-- 功能访问日志
  1049→CREATE TABLE feature_access_logs (
  1050→    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  1051→    user_id UUID REFERENCES users(id),
  1052→    feature TEXT NOT NULL,
  1053→    access_granted BOOLEAN,
  1054→    tier_at_access TEXT,
  1055→    triggered_paywall BOOLEAN,
  1056→    converted_to_paid BOOLEAN,
  1057→    created_at TIMESTAMPTZ DEFAULT NOW()
  1058→);
  1059→
  1060→-- 索引
  1061→CREATE INDEX idx_subscriptions_user ON subscriptions(user_id);
  1062→CREATE INDEX idx_feature_access_user ON feature_access_logs(user_id);
  1063→CREATE INDEX idx_feature_access_feature ON feature_access_logs(feature, created_at);
  1064→```
  1065→
  1066→### 10.2 API端点设计
  1067→
  1068→```python
  1069→# apps/api/routes/subscription.py
  1070→
  1071→@router.get("/me")
  1072→async def get_my_subscription(request: Request):
  1073→    """获取当前用户订阅状态"""
  1074→    user_id = request.state.user_id
  1075→    subscription = await get_user_subscription(user_id)
  1076→    return subscription
  1077→
  1078→@router.post("/checkout")
  1079→async def create_checkout_session(request: Request, checkout_data: CheckoutRequest):
  1080→    """创建支付会话"""
  1081→    user_id = request.state.user_id
  1082→    session = await create_payment_session(user_id, checkout_data)
  1083→    return {"checkout_url": session.url}
  1084→
  1085→@router.post("/cancel")
  1086→async def cancel_subscription(request: Request):
  1087→    """取消订阅"""
  1088→    user_id = request.state.user_id
  1089→    await cancel_user_subscription(user_id)
  1090→    return {"status": "canceled"}
  1091→
  1092→@router.get("/features")
  1093→async def get_available_features(request: Request):
  1094→    """获取用户可访问的功能列表"""
  1095→    user_id = request.state.user_id
  1096→    features = await get_user_features(user_id)
  1097→    return {"features": features}
  1098→
  1099→@router.post("/quota/check")
  1100→async def check_quota(request: Request, feature: str):
  1101→    """检查用户配额"""
  1102→    user_id = request.state.user_id
  1103→    has_quota, remaining = await check_user_quota(user_id, feature)
  1104→    return {"has_quota": has_quota, "remaining": remaining}
  1105→```
  1106→
  1107→---
  1108→
  1109→## 参考资源
  1110→
  1111→- **Freemium Economics**: 《Freemium:离线产品如何通过免费增值盈利》
  1112→- **Conversion Optimization**: 《转化率优化实战指南》
  1113→- **Pricing Psychology**: 《定价心理学》
  1114→- **Case Studies**:
  1115→  - Spotify Freemium Model
  1116→  - Duolingo Free vs Super
  1117→  - Notion Personal vs Pro
  1118→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
