     1â†’"use client";
     2â†’
     3â†’/**
     4â†’ * AppShell - ä¸‰æ å¸ƒå±€å®¹å™¨ v8.0
     5â†’ * Based on: vibelife spec v8.0 - LifeCoach Dashboard
     6â†’ *
     7â†’ * V8 å˜æ›´:
     8â†’ * - å¯¼èˆªå…¥å£ä» 4 ä¸ªæ”¹ä¸º 3 ä¸ª: Dashboard / Chat / Me
     9â†’ * - é»˜è®¤é¦–é¡µä» Chat æ”¹ä¸º Dashboard
    10â†’ * - å³ä¾§è¾¹æ æ ¹æ®ä¸»èˆå°æ™ºèƒ½åˆ‡æ¢å†…å®¹
    11â†’ *
    12â†’ * å“åº”å¼æ–­ç‚¹ï¼ˆä¸ tailwind.config.ts ä¿æŒä¸€è‡´ï¼‰ï¼š
    13â†’ * - PC â‰¥1024px (lg): ä¸‰æ å¸ƒå±€
    14â†’ * - Tablet+Mobile <1024px: å•æ  + TabBar
    15â†’ *
    16â†’ * PCç«¯å¸ƒå±€ (â‰¥1024px):
    17â†’ * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    18â†’ * â”‚ NavBar â”‚         ä¸»å†…å®¹åŒºåŸŸ             â”‚   Insight Panel        â”‚
    19â†’ * â”‚ (64px) â”‚       (flex-1, å·¦å¯¹é½)         â”‚    (320-600px å¯è°ƒ)    â”‚
    20â†’ * â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    21â†’ *
    22â†’ * Tablet+ç§»åŠ¨ç«¯å¸ƒå±€ (<1024px):
    23â†’ * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    24â†’ * â”‚  Header                                  â”‚
    25â†’ * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    26â†’ * â”‚  å†…å®¹åŒºåŸŸ (æ ¹æ®Tabå®Œå…¨åˆ‡æ¢)              â”‚
    27â†’ * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    28â†’ * â”‚  ğŸ  Dashboard â”‚ ğŸ’¬ Chat â”‚ ğŸ‘¤ Me          â”‚
    29â†’ * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    30â†’ */
    31â†’
    32â†’import { useState, useEffect, useCallback, createContext, useContext, ReactNode } from "react";
    33â†’import { useSearchParams } from "next/navigation";
    34â†’import { apiClient } from "@/lib/api";
    35â†’import { cn } from "@/lib/utils";
    36â†’import { type SkillType } from "@/components/core";
    37â†’import { NavBar } from "./NavBar";
    38â†’import { MobileTabBar } from "./MobileTabBar";
    39â†’import { MobileHeader } from "./MobileHeader";
    40â†’import { ResizablePanel } from "./ResizablePanel";
    41â†’
    42â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    43â†’// Types
    44â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    45â†’
    46â†’// V9.1: 4 entry points - Chat / Journey / Discover / Me
    47â†’export type TabType = "chat" | "journey" | "discover" | "me";
    48â†’
    49â†’interface AppShellContextValue {
    50â†’  skill: SkillType;
    51â†’  activeTab: TabType;
    52â†’  setActiveTab: (tab: TabType) => void;
    53â†’  voiceMode: "warm" | "sarcastic" | "wise";
    54â†’  setVoiceMode: (mode: "warm" | "sarcastic" | "wise") => void;
    55â†’}
    56â†’
    57â†’const AppShellContext = createContext<AppShellContextValue | null>(null);
    58â†’
    59â†’export function useAppShell() {
    60â†’  const context = useContext(AppShellContext);
    61â†’  if (!context) {
    62â†’    throw new Error("useAppShell must be used within AppShell");
    63â†’  }
    64â†’  return context;
    65â†’}
    66â†’
    67â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    68â†’// AppShell Component
    69â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    70â†’
    71â†’interface AppShellProps {
    72â†’  skill: SkillType;
    73â†’  children: ReactNode;
    74â†’  /** Journey å†…å®¹ */
    75â†’  journeyContent?: ReactNode;
    76â†’  /** Discover å†…å®¹ - V9.1 æ–°å¢ */
    77â†’  discoverContent?: ReactNode;
    78â†’  /** Me é¡µé¢å†…å®¹ */
    79â†’  meContent?: ReactNode;
    80â†’  /** åˆå§‹æ¿€æ´»çš„ Tab - V9 é»˜è®¤ä¸º chat */
    81â†’  defaultTab?: TabType;
    82â†’}
    83â†’
    84â†’export function AppShell({
    85â†’  skill,
    86â†’  children,
    87â†’  journeyContent,
    88â†’  discoverContent,
    89â†’  meContent,
    90â†’  defaultTab = "chat",
    91â†’}: AppShellProps) {
    92â†’  const searchParams = useSearchParams();
    93â†’
    94â†’  // ä» URL å‚æ•°è¯»å– tabï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ defaultTab
    95â†’  const urlTab = searchParams?.get("tab") as TabType | null;
    96â†’  const initialTab = (urlTab && ["chat", "journey", "discover", "me"].includes(urlTab))
    97â†’    ? urlTab
    98â†’    : defaultTab;
    99â†’
   100â†’  const [activeTab, setActiveTab] = useState<TabType>(initialTab);
   101â†’  const [voiceMode, setVoiceModeState] = useState<"warm" | "sarcastic" | "wise">("warm");
   102â†’
   103â†’  // ç›‘å¬ URL å‚æ•°å˜åŒ–ï¼ŒåŒæ­¥ activeTab
   104â†’  useEffect(() => {
   105â†’    if (urlTab && ["chat", "journey", "discover", "me"].includes(urlTab)) {
   106â†’      setActiveTab(urlTab);
   107â†’    }
   108â†’  }, [urlTab]);
   109â†’
   110â†’  // Load voice_mode from backend on mount (only if authenticated)
   111â†’  useEffect(() => {
   112â†’    const loadPreferences = async () => {
   113â†’      try {
   114â†’        // Check if user is authenticated before making the request
   115â†’        const token = document.cookie.split(';').find(c => c.trim().startsWith('auth-token='));
   116â†’        if (!token) {
   117â†’          return; // Skip if not authenticated
   118â†’        }
   119â†’
   120â†’        const response = await apiClient.get<{ voice_mode: string; language: string }>("/preferences");
   121â†’        if (response.data?.voice_mode) {
   122â†’          setVoiceModeState(response.data.voice_mode as "warm" | "sarcastic" | "wise");
   123â†’        }
   124â†’      } catch (error) {
   125â†’        // Silently fail for 401 errors, log others
   126â†’        if (error && typeof error === 'object' && 'response' in error) {
   127â†’          const resp = error.response as { status?: number };
   128â†’          if (resp.status !== 401) {
   129â†’            console.error("Failed to load preferences:", error);
   130â†’          }
   131â†’        }
   132â†’      }
   133â†’    };
   134â†’    loadPreferences();
   135â†’  }, []);
   136â†’
   137â†’  // Save voice_mode to backend when changed
   138â†’  const setVoiceMode = useCallback(async (mode: "warm" | "sarcastic" | "wise") => {
   139â†’    setVoiceModeState(mode);
   140â†’    try {
   141â†’      await apiClient.put("/preferences", { voice_mode: mode });
   142â†’    } catch (error) {
   143â†’      console.error("Failed to save voice_mode:", error);
   144â†’    }
   145â†’  }, []);
   146â†’
   147â†’  const contextValue: AppShellContextValue = {
   148â†’    skill,
   149â†’    activeTab,
   150â†’    setActiveTab,
   151â†’    voiceMode,
   152â†’    setVoiceMode,
   153â†’  };
   154â†’
   155â†’  return (
   156â†’    <AppShellContext.Provider value={contextValue}>
   157â†’      <div className="h-screen flex flex-col bg-background">
   158â†’        {/* Mobile Header - ä»…ç§»åŠ¨ç«¯æ˜¾ç¤º */}
   159â†’        <div className="lg:hidden">
   160â†’          <MobileHeader skill={skill} />
   161â†’        </div>
   162â†’
   163â†’        {/* Main Content Area */}
   164â†’        <div className="flex-1 flex overflow-hidden">
   165â†’          {/* Left NavBar - ä»… PC ç«¯æ˜¾ç¤º */}
   166â†’          <div className="hidden lg:block">
   167â†’            <NavBar
   168â†’              skill={skill}
   169â†’              activeTab={activeTab}
   170â†’              onTabChange={setActiveTab}
   171â†’            />
   172â†’          </div>
   173â†’
   174â†’          {/* Center - ä¸»å†…å®¹åŒºåŸŸ (å…¨å®½) */}
   175â†’          <main className="flex-1 min-h-0 flex flex-col">
   176â†’            {/* PCç«¯: æ ¹æ® Tab åˆ‡æ¢å†…å®¹ */}
   177â†’            <div className="hidden lg:flex lg:flex-col h-full min-h-0">
   178â†’              <PCContent
   179â†’                activeTab={activeTab}
   180â†’                chatContent={children}
   181â†’                journeyContent={journeyContent}
   182â†’                discoverContent={discoverContent}
   183â†’                meContent={meContent}
   184â†’              />
   185â†’            </div>
   186â†’
   187â†’            {/* ç§»åŠ¨ç«¯: æ ¹æ® Tab åˆ‡æ¢å†…å®¹ */}
   188â†’            <div className="lg:hidden h-full min-h-0 flex flex-col">
   189â†’              <MobileContent
   190â†’                activeTab={activeTab}
   191â†’                chatContent={children}
   192â†’                journeyContent={journeyContent}
   193â†’                discoverContent={discoverContent}
   194â†’                meContent={meContent}
   195â†’              />
   196â†’            </div>
   197â†’          </main>
   198â†’        </div>
   199â†’
   200â†’        {/* Mobile TabBar - ä»…ç§»åŠ¨ç«¯æ˜¾ç¤º */}
   201â†’        <div className="lg:hidden">
   202â†’          <MobileTabBar activeTab={activeTab} onTabChange={setActiveTab} />
   203â†’        </div>
   204â†’      </div>
   205â†’    </AppShellContext.Provider>
   206â†’  );
   207â†’}
   208â†’
   209â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   210â†’// PCContent - PCç«¯å†…å®¹åˆ‡æ¢
   211â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   212â†’
   213â†’interface ContentProps {
   214â†’  activeTab: TabType;
   215â†’  chatContent: ReactNode;
   216â†’  journeyContent?: ReactNode;
   217â†’  discoverContent?: ReactNode;
   218â†’  meContent?: ReactNode;
   219â†’}
   220â†’
   221â†’function PCContent({ activeTab, chatContent, journeyContent, discoverContent, meContent }: ContentProps) {
   222â†’  switch (activeTab) {
   223â†’    case "chat":
   224â†’      return <div className="h-full min-h-0 flex flex-col">{chatContent}</div>;
   225â†’    case "journey":
   226â†’      return (
   227â†’        <div className="h-full min-h-0 flex flex-col overflow-y-auto">
   228â†’          {journeyContent || (
   229â†’            <div className="flex items-center justify-center h-full text-muted-foreground">
   230â†’              æˆ‘çš„æ—…ç¨‹
   231â†’            </div>
   232â†’          )}
   233â†’        </div>
   234â†’      );
   235â†’    case "discover":
   236â†’      return (
   237â†’        <div className="h-full min-h-0 flex flex-col overflow-y-auto">
   238â†’          {discoverContent || (
   239â†’            <div className="flex items-center justify-center h-full text-muted-foreground">
   240â†’              æ¢ç´¢ Skills
   241â†’            </div>
   242â†’          )}
   243â†’        </div>
   244â†’      );
   245â†’    case "me":
   246â†’      return (
   247â†’        <div className="h-full overflow-y-auto">
   248â†’          {meContent || (
   249â†’            <div className="flex items-center justify-center h-full text-muted-foreground">
   250â†’              ä¸ªäººè®¾ç½®
   251â†’            </div>
   252â†’          )}
   253â†’        </div>
   254â†’      );
   255â†’    default:
   256â†’      return null;
   257â†’  }
   258â†’}
   259â†’
   260â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   261â†’// MobileContent - ç§»åŠ¨ç«¯å†…å®¹åˆ‡æ¢
   262â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   263â†’
   264â†’function MobileContent({ activeTab, chatContent, journeyContent, discoverContent, meContent }: ContentProps) {
   265â†’  switch (activeTab) {
   266â†’    case "chat":
   267â†’      return <div className="h-full min-h-0 flex flex-col">{chatContent}</div>;
   268â†’    case "journey":
   269â†’      return (
   270â†’        <div className="h-full min-h-0 flex flex-col overflow-y-auto">
   271â†’          {journeyContent || (
   272â†’            <div className="flex items-center justify-center h-full text-muted-foreground">
   273â†’              æˆ‘çš„æ—…ç¨‹
   274â†’            </div>
   275â†’          )}
   276â†’        </div>
   277â†’      );
   278â†’    case "discover":
   279â†’      return (
   280â†’        <div className="h-full min-h-0 flex flex-col overflow-y-auto">
   281â†’          {discoverContent || (
   282â†’            <div className="flex items-center justify-center h-full text-muted-foreground">
   283â†’              æ¢ç´¢ Skills
   284â†’            </div>
   285â†’          )}
   286â†’        </div>
   287â†’      );
   288â†’    case "me":
   289â†’      return (
   290â†’        <div className="h-full overflow-y-auto">
   291â†’          {meContent || (
   292â†’            <div className="flex items-center justify-center h-full text-muted-foreground">
   293â†’              ä¸ªäººè®¾ç½®
   294â†’            </div>
   295â†’          )}
   296â†’        </div>
   297â†’      );
   298â†’    default:
   299â†’      return null;
   300â†’  }
   301â†’}
   302â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
