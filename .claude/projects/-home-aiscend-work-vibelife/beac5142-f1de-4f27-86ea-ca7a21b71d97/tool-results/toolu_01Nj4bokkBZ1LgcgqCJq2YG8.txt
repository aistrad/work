     1â†’'use client'
     2â†’
     3â†’/**
     4â†’ * PCLayout - v7.1 PCç«¯ä¸‰æ å¸ƒå±€å®¹å™¨
     5â†’ *
     6â†’ * å¸ƒå±€ç»“æ„ (â‰¥1024px):
     7â†’ * â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     8â†’ * â”‚      â”‚           é¡¶éƒ¨æ                â”‚          â”‚
     9â†’ * â”‚ å·¦ä¾§ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    10â†’ * â”‚ å¯¼èˆª â”‚           ä¸»å†…å®¹åŒº             â”‚  å³ä¾§æ   â”‚
    11â†’ * â”‚240px â”‚           flex: 1              â”‚  320px   â”‚
    12â†’ * â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    13â†’ * â”‚      â”‚           åº•éƒ¨å‘½ä»¤æ                       â”‚
    14â†’ * â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    15â†’ *
    16â†’ * v7.1 ä¼˜åŒ–:
    17â†’ * - ä½¿ç”¨ CSS transition æ›¿ä»£ Framer Motion (Vercel rule: rerender-animation-library)
    18â†’ * - æ— è¾¹æ¡†è®¾è®¡ + å¤šå±‚é˜´å½±
    19â†’ * - memo åŒ…è£… (Vercel rule: rerender-memo)
    20â†’ */
    21â†’
    22â†’import { useState, useEffect, useCallback, ReactNode, memo } from 'react'
    23â†’import { useRouter, usePathname } from 'next/navigation'
    24â†’import { cn } from '@/lib/utils'
    25â†’
    26â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    27â†’// Navigation Config - v7 æ¶æ„ï¼šæ‰€æœ‰æŠ€èƒ½é€šè¿‡ /chat è®¿é—®
    28â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    29â†’
    30â†’const NAV_ITEMS = [
    31â†’  { id: 'home', path: '/', icon: 'ğŸ ', label: 'é¦–é¡µ' },
    32â†’  { id: 'chat', path: '/chat', icon: 'ğŸ’¬', label: 'å¯¹è¯' },
    33â†’  { id: 'discover', path: '/chat?tab=discover', icon: 'âœ¨', label: 'æ¢ç´¢' },
    34â†’  { id: 'identity', path: '/identity', icon: 'ğŸ’', label: 'èº«ä»½ç”»åƒ' },
    35â†’]
    36â†’
    37â†’const BOTTOM_NAV_ITEMS = [
    38â†’  { id: 'settings', path: '/settings', icon: 'âš™ï¸', label: 'è®¾ç½®' },
    39â†’  { id: 'membership', path: '/membership', icon: 'âœ¨', label: 'å‡çº§Premium', premium: true },
    40â†’]
    41â†’
    42â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    43â†’// Storage helpers
    44â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    45â†’
    46â†’function getStorageValue(key: string): string | null {
    47â†’  if (typeof window === 'undefined') return null
    48â†’  try {
    49â†’    return localStorage.getItem(key)
    50â†’  } catch {
    51â†’    return null
    52â†’  }
    53â†’}
    54â†’
    55â†’function setStorageValue(key: string, value: string): void {
    56â†’  if (typeof window === 'undefined') return
    57â†’  try {
    58â†’    localStorage.setItem(key, value)
    59â†’  } catch {
    60â†’    // ignore
    61â†’  }
    62â†’}
    63â†’
    64â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    65â†’// PCLayout Component
    66â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    67â†’
    68â†’interface PCLayoutProps {
    69â†’  children: ReactNode
    70â†’  aside?: ReactNode
    71â†’  breadcrumb?: { label: string; href?: string }[]
    72â†’  showCommandBar?: boolean
    73â†’}
    74â†’
    75â†’export const PCLayout = memo(function PCLayout({
    76â†’  children,
    77â†’  aside,
    78â†’  breadcrumb,
    79â†’  showCommandBar = true,
    80â†’}: PCLayoutProps) {
    81â†’  const router = useRouter()
    82â†’  const pathname = usePathname()
    83â†’  const [collapsed, setCollapsed] = useState(false)
    84â†’  const [commandInput, setCommandInput] = useState('')
    85â†’
    86â†’  // ä» localStorage æ¢å¤ä¾§è¾¹æ çŠ¶æ€
    87â†’  useEffect(() => {
    88â†’    const saved = getStorageValue('pc-sidebar-collapsed')
    89â†’    if (saved) setCollapsed(saved === 'true')
    90â†’  }, [])
    91â†’
    92â†’  const toggleSidebar = useCallback(() => {
    93â†’    setCollapsed(prev => {
    94â†’      const newState = !prev
    95â†’      setStorageValue('pc-sidebar-collapsed', String(newState))
    96â†’      return newState
    97â†’    })
    98â†’  }, [])
    99â†’
   100â†’  const handleCommand = useCallback(() => {
   101â†’    if (commandInput.startsWith('/')) {
   102â†’      const cmd = commandInput.slice(1).toLowerCase()
   103â†’      if (['bazi', 'zodiac', 'tarot', 'career'].includes(cmd)) {
   104â†’        router.push(`/chat?skill=${cmd}`)
   105â†’      } else if (cmd === 'chat') {
   106â†’        router.push('/chat')
   107â†’      } else if (cmd === 'upgrade') {
   108â†’        router.push('/membership')
   109â†’      }
   110â†’    } else if (commandInput.trim()) {
   111â†’      router.push(`/chat?q=${encodeURIComponent(commandInput)}`)
   112â†’    }
   113â†’    setCommandInput('')
   114â†’  }, [commandInput, router])
   115â†’
   116â†’  const handleNavClick = useCallback((path: string) => {
   117â†’    router.push(path)
   118â†’  }, [router])
   119â†’
   120â†’  // è®¡ç®—å¸ƒå±€å°ºå¯¸
   121â†’  const sidebarWidth = collapsed ? 72 : 240
   122â†’
   123â†’  return (
   124â†’    <div className="hidden lg:block min-h-screen bg-bg-primary">
   125â†’      {/* å·¦ä¾§å¯¼èˆªæ  - v7.1 æ— è¾¹æ¡†è®¾è®¡ */}
   126â†’      <aside
   127â†’        className={cn(
   128â†’          "fixed left-0 top-0 bottom-0 z-30",
   129â†’          "bg-bg-card shadow-card",
   130â†’          "flex flex-col",
   131â†’          "transition-[width] duration-slow ease-out-expo"
   132â†’        )}
   133â†’        style={{ width: sidebarWidth }}
   134â†’      >
   135â†’        {/* Logo */}
   136â†’        <div className="h-16 px-4 flex items-center gap-3 border-b border-subtle/30">
   137â†’          <span className="text-2xl flex-shrink-0">ğŸŒŸ</span>
   138â†’          <div
   139â†’            className={cn(
   140â†’              "overflow-hidden whitespace-nowrap",
   141â†’              "transition-all duration-slow ease-out-expo",
   142â†’              collapsed ? "w-0 opacity-0" : "w-auto opacity-100"
   143â†’            )}
   144â†’          >
   145â†’            <h1 className="font-serif text-lg text-text-primary font-semibold">VibeLife</h1>
   146â†’            <p className="text-xs text-text-secondary">æ¢ç´¢å†…å¿ƒä¸–ç•Œ</p>
   147â†’          </div>
   148â†’        </div>
   149â†’
   150â†’        {/* ä¸»å¯¼èˆª */}
   151â†’        <nav className="flex-1 px-3 py-4 space-y-1 overflow-y-auto">
   152â†’          {NAV_ITEMS.map((item) => {
   153â†’            const isActive = pathname === item.path
   154â†’            return (
   155â†’              <button
   156â†’                key={item.id}
   157â†’                onClick={() => handleNavClick(item.path)}
   158â†’                className={cn(
   159â†’                  "w-full flex items-center gap-3 px-3 py-2.5 rounded-lg",
   160â†’                  "text-left transition-all duration-fast ease-out-expo",
   161â†’                  isActive
   162â†’                    ? "bg-accent-primary/10 text-text-primary font-medium"
   163â†’                    : "text-text-secondary hover:bg-bg-secondary hover:text-text-primary"
   164â†’                )}
   165â†’                title={collapsed ? item.label : undefined}
   166â†’              >
   167â†’                <span className="text-lg flex-shrink-0">{item.icon}</span>
   168â†’                <span
   169â†’                  className={cn(
   170â†’                    "overflow-hidden whitespace-nowrap",
   171â†’                    "transition-all duration-slow ease-out-expo",
   172â†’                    collapsed ? "w-0 opacity-0" : "w-auto opacity-100"
   173â†’                  )}
   174â†’                >
   175â†’                  {item.label}
   176â†’                </span>
   177â†’              </button>
   178â†’            )
   179â†’          })}
   180â†’        </nav>
   181â†’
   182â†’        {/* åº•éƒ¨å¯¼èˆª */}
   183â†’        <div className="px-3 py-4 border-t border-subtle/30 space-y-1">
   184â†’          {BOTTOM_NAV_ITEMS.map((item) => {
   185â†’            const isActive = pathname === item.path
   186â†’            return (
   187â†’              <button
   188â†’                key={item.id}
   189â†’                onClick={() => handleNavClick(item.path)}
   190â†’                className={cn(
   191â†’                  "w-full flex items-center gap-3 px-3 py-2.5 rounded-lg",
   192â†’                  "text-left transition-all duration-fast ease-out-expo",
   193â†’                  isActive
   194â†’                    ? "bg-accent-primary/10 text-text-primary font-medium"
   195â†’                    : "text-text-secondary hover:bg-bg-secondary hover:text-text-primary",
   196â†’                  item.premium && "text-gold-600"
   197â†’                )}
   198â†’                title={collapsed ? item.label : undefined}
   199â†’              >
   200â†’                <span className="text-lg flex-shrink-0">{item.icon}</span>
   201â†’                <span
   202â†’                  className={cn(
   203â†’                    "overflow-hidden whitespace-nowrap",
   204â†’                    "transition-all duration-slow ease-out-expo",
   205â†’                    collapsed ? "w-0 opacity-0" : "w-auto opacity-100",
   206â†’                    item.premium && "font-medium"
   207â†’                  )}
   208â†’                >
   209â†’                  {item.label}
   210â†’                </span>
   211â†’              </button>
   212â†’            )
   213â†’          })}
   214â†’
   215â†’          {/* æ”¶èµ·/å±•å¼€æŒ‰é’® */}
   216â†’          <button
   217â†’            onClick={toggleSidebar}
   218â†’            className={cn(
   219â†’              "w-full flex items-center justify-center",
   220â†’              "p-2.5 mt-2 rounded-lg",
   221â†’              "text-text-tertiary hover:text-text-primary hover:bg-bg-secondary",
   222â†’              "transition-colors duration-fast"
   223â†’            )}
   224â†’          >
   225â†’            <span className="text-lg">{collapsed ? 'â–¶' : 'â—€'}</span>
   226â†’          </button>
   227â†’        </div>
   228â†’      </aside>
   229â†’
   230â†’      {/* é¡¶éƒ¨æ  - v7.1 æ¯›ç»ç’ƒæ•ˆæœ */}
   231â†’      <header
   232â†’        className={cn(
   233â†’          "fixed top-0 right-0 z-20",
   234â†’          "h-14 px-5 flex items-center justify-between",
   235â†’          "bg-bg-primary/80 backdrop-blur-md",
   236â†’          "border-b border-subtle/30",
   237â†’          "transition-[left] duration-slow ease-out-expo"
   238â†’        )}
   239â†’        style={{ left: sidebarWidth }}
   240â†’      >
   241â†’        {/* Breadcrumb */}
   242â†’        <div className="flex items-center gap-2 text-sm">
   243â†’          {breadcrumb?.map((item, i) => (
   244â†’            <span key={i} className="flex items-center gap-2">
   245â†’              {i > 0 && <span className="text-text-disabled">â€º</span>}
   246â†’              {item.href ? (
   247â†’                <button
   248â†’                  onClick={() => router.push(item.href!)}
   249â†’                  className="text-text-secondary hover:text-text-primary transition-colors"
   250â†’                >
   251â†’                  {item.label}
   252â†’                </button>
   253â†’              ) : (
   254â†’                <span className="text-text-primary font-medium">{item.label}</span>
   255â†’              )}
   256â†’            </span>
   257â†’          ))}
   258â†’        </div>
   259â†’
   260â†’        {/* Actions */}
   261â†’        <div className="flex items-center gap-2">
   262â†’          <button className="p-2 rounded-lg text-text-secondary hover:text-text-primary hover:bg-bg-secondary transition-colors">
   263â†’            ğŸ”
   264â†’          </button>
   265â†’          <button className="p-2 rounded-lg text-text-secondary hover:text-text-primary hover:bg-bg-secondary transition-colors relative">
   266â†’            ğŸ””
   267â†’            <span className="absolute -top-0.5 -right-0.5 w-4 h-4 bg-error text-white text-[10px] rounded-full flex items-center justify-center">
   268â†’              3
   269â†’            </span>
   270â†’          </button>
   271â†’          <button className="p-2 rounded-lg text-text-secondary hover:text-text-primary hover:bg-bg-secondary transition-colors">
   272â†’            ğŸ‘¤
   273â†’          </button>
   274â†’        </div>
   275â†’      </header>
   276â†’
   277â†’      {/* ä¸»å†…å®¹åŒº */}
   278â†’      <main
   279â†’        className={cn(
   280â†’          "pt-14 min-h-screen",
   281â†’          "transition-[margin-left,margin-bottom] duration-slow ease-out-expo",
   282â†’          showCommandBar && "pb-16"
   283â†’        )}
   284â†’        style={{ marginLeft: sidebarWidth }}
   285â†’      >
   286â†’        <div className="flex h-[calc(100vh-56px-64px)]">
   287â†’          {/* ä¸»å†…å®¹ */}
   288â†’          <div className="flex-1 overflow-y-auto p-6">
   289â†’            {children}
   290â†’          </div>
   291â†’
   292â†’          {/* å³ä¾§æ  */}
   293â†’          {aside && (
   294â†’            <aside className="w-80 xl:w-96 border-l border-subtle/30 bg-bg-card/50 overflow-y-auto p-4">
   295â†’              {aside}
   296â†’            </aside>
   297â†’          )}
   298â†’        </div>
   299â†’      </main>
   300â†’
   301â†’      {/* åº•éƒ¨å‘½ä»¤æ  - v7.1 æ ·å¼ */}
   302â†’      {showCommandBar && (
   303â†’        <div
   304â†’          className={cn(
   305â†’            "fixed bottom-0 right-0 z-20",
   306â†’            "h-16 px-5 flex items-center justify-center",
   307â†’            "bg-bg-primary border-t border-subtle/30",
   308â†’            "transition-[left] duration-slow ease-out-expo"
   309â†’          )}
   310â†’          style={{ left: sidebarWidth }}
   311â†’        >
   312â†’          <div className="w-full max-w-2xl">
   313â†’            <div className="flex items-center gap-3 bg-bg-card shadow-card rounded-2xl px-4 py-2">
   314â†’              <input
   315â†’                type="text"
   316â†’                value={commandInput}
   317â†’                onChange={(e) => setCommandInput(e.target.value)}
   318â†’                onKeyDown={(e) => e.key === 'Enter' && handleCommand()}
   319â†’                placeholder="Type '/' for commands, or start chatting..."
   320â†’                className="flex-1 bg-transparent text-text-primary placeholder:text-text-disabled focus:outline-none"
   321â†’              />
   322â†’              <button
   323â†’                onClick={handleCommand}
   324â†’                className={cn(
   325â†’                  "w-9 h-9 rounded-full flex items-center justify-center",
   326â†’                  "bg-accent-primary text-text-inverse",
   327â†’                  "hover:bg-accent-hover transition-colors duration-fast",
   328â†’                  "active:scale-95"
   329â†’                )}
   330â†’              >
   331â†’                â–¶
   332â†’              </button>
   333â†’            </div>
   334â†’          </div>
   335â†’        </div>
   336â†’      )}
   337â†’    </div>
   338â†’  )
   339â†’})
   340â†’
   341â†’export default PCLayout
   342â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
