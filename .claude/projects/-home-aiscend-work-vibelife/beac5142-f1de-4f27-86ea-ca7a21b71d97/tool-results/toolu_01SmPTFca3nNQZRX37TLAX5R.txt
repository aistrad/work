     1â†’'use client'
     2â†’
     3â†’/**
     4â†’ * Settings Page - v5.1 æ€§èƒ½ä¼˜åŒ–ç‰ˆ
     5â†’ * è®¾è®¡æ–‡æ¡£: payment-design-pc.md ç¬¬åç« 
     6â†’ *
     7â†’ * v5.1 ä¼˜åŒ–:
     8â†’ * - ç§»é™¤ framer-motionï¼Œä½¿ç”¨ CSS åŠ¨ç”» (Vercel rule: bundle-dynamic-imports)
     9â†’ * - ä½¿ç”¨ç¼“å­˜çš„ localStorage è¯»å– (Vercel rule: js-cache-storage)
    10â†’ * - ä½¿ç”¨å‡½æ•°å¼ setState (Vercel rule: rerender-functional-setstate)
    11â†’ *
    12â†’ * PCç«¯å¸ƒå±€: å·¦ä¾§è®¾ç½®èœå• + å³ä¾§è®¾ç½®å†…å®¹
    13â†’ * ç§»åŠ¨ç«¯å¸ƒå±€: å•æ è®¾ç½®åˆ—è¡¨
    14â†’ */
    15â†’
    16â†’import { useState, useEffect, useCallback, memo, useMemo } from 'react'
    17â†’import { useRouter } from 'next/navigation'
    18â†’import { PCLayout } from '@/components/layout/PCLayout'
    19â†’import { BirthDateInputs } from '@/components/ui/Input'
    20â†’import { getLocalStorageJSON, getAccessToken, setLocalStorageJSON } from '@/utils/storage'
    21â†’import { AccountDeletionSection } from '@/components/settings/AccountDeletionSection'
    22â†’import { SkillCard } from '@/components/skill'
    23â†’import { useSkillSubscription, useSkills } from '@/hooks/useSkillSubscription'
    24â†’
    25â†’// Use Next.js API routes for server communication to avoid exposing backend URL
    26â†’const API_BASE = '/api'
    27â†’
    28â†’const SETTINGS_MENU = [
    29â†’  { id: 'profile', icon: 'ğŸ‘¤', label: 'ä¸ªäººèµ„æ–™' },
    30â†’  { id: 'skills', icon: 'ğŸ¯', label: 'Skill ç®¡ç†' },
    31â†’  { id: 'notifications', icon: 'ğŸ””', label: 'é€šçŸ¥è®¾ç½®' },
    32â†’  { id: 'privacy', icon: 'ğŸ”', label: 'éšç§ä¸å®‰å…¨' },
    33â†’  { id: 'membership', icon: 'ğŸ’', label: 'ä¼šå‘˜ç®¡ç†' },
    34â†’  { id: 'memory', icon: 'ğŸ§ ', label: 'è®°å¿†ç®¡ç†' },
    35â†’  { id: 'preferences', icon: 'âš™ï¸', label: 'åå¥½è®¾ç½®' },
    36â†’  { id: 'account', icon: 'âš ï¸', label: 'è´¦æˆ·ç®¡ç†' },
    37â†’  { id: 'help', icon: 'â“', label: 'å¸®åŠ©ä¸åé¦ˆ' },
    38â†’  { id: 'about', icon: 'ğŸ“„', label: 'å…³äº' },
    39â†’]
    40â†’
    41â†’interface UserProfile {
    42â†’  nickname: string
    43â†’  email: string
    44â†’  avatar: string
    45â†’  birthDate: string
    46â†’  birthTime: string
    47â†’  timezone: string
    48â†’}
    49â†’
    50â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    51â†’// Skill ç®¡ç†åŒºå—
    52â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    53â†’
    54â†’function SkillSettingsSection({ router }: { router: ReturnType<typeof useRouter> }) {
    55â†’  const { skills } = useSkills()
    56â†’  const { subscriptions, togglePush, unsubscribe, userStatuses } = useSkillSubscription()
    57â†’
    58â†’  // åˆ†ç»„
    59â†’  const { subscribed, available } = useMemo(() => {
    60â†’    const subscribedIds = new Set(
    61â†’      subscriptions.filter(s => s.status === 'subscribed').map(s => s.skill_id)
    62â†’    )
    63â†’    return {
    64â†’      subscribed: skills.filter(s => subscribedIds.has(s.id)),
    65â†’      available: skills.filter(s => !subscribedIds.has(s.id) && s.category !== 'core'),
    66â†’    }
    67â†’  }, [skills, subscriptions])
    68â†’
    69â†’  const handleTogglePush = async (skillId: string, enabled: boolean) => {
    70â†’    try {
    71â†’      await togglePush(skillId, enabled)
    72â†’    } catch (err) {
    73â†’      console.error('Toggle push failed:', err)
    74â†’    }
    75â†’  }
    76â†’
    77â†’  const handleUnsubscribe = async (skillId: string) => {
    78â†’    try {
    79â†’      await unsubscribe(skillId)
    80â†’    } catch (err) {
    81â†’      console.error('Unsubscribe failed:', err)
    82â†’    }
    83â†’  }
    84â†’
    85â†’  return (
    86â†’    <div className="space-y-6">
    87â†’      <div className="flex items-center justify-between">
    88â†’        <h2 className="font-serif text-xl text-text-primary">Skill ç®¡ç†</h2>
    89â†’        <button
    90â†’          onClick={() => router.push('/skills')}
    91â†’          className="text-sm text-accent hover:underline"
    92â†’        >
    93â†’          æ¢ç´¢æ›´å¤š â†’
    94â†’        </button>
    95â†’      </div>
    96â†’
    97â†’      {/* å·²è®¢é˜… */}
    98â†’      <div>
    99â†’        <h3 className="text-sm font-medium text-text-secondary mb-3">
   100â†’          å·²è®¢é˜… ({subscribed.length})

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
