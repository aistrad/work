     1â†’'use client'
     2â†’
     3â†’/**
     4â†’ * Settings Page - v5.1 æ€§èƒ½ä¼˜åŒ–ç‰ˆ
     5â†’ * è®¾è®¡æ–‡æ¡£: payment-design-pc.md ç¬¬åç« 
     6â†’ *
     7â†’ * v5.1 ä¼˜åŒ–:
     8â†’ * - ç§»é™¤ framer-motionï¼Œä½¿ç”¨ CSS åŠ¨ç”» (Vercel rule: bundle-dynamic-imports)
     9â†’ * - ä½¿ç”¨ç¼“å­˜çš„ localStorage è¯»å– (Vercel rule: js-cache-storage)
    10â†’ * - ä½¿ç”¨å‡½æ•°å¼ setState (Vercel rule: rerender-functional-setstate)
    11â†’ *
    12â†’ * PCç«¯å¸ƒå±€: å·¦ä¾§è®¾ç½®èœå• + å³ä¾§è®¾ç½®å†…å®¹
    13â†’ * ç§»åŠ¨ç«¯å¸ƒå±€: å•æ è®¾ç½®åˆ—è¡¨
    14â†’ */
    15â†’
    16â†’import { useState, useEffect, useCallback, memo, useMemo } from 'react'
    17â†’import { useRouter } from 'next/navigation'
    18â†’import { PCLayout } from '@/components/layout/PCLayout'
    19â†’import { BirthDateInputs } from '@/components/ui/Input'
    20â†’import { getLocalStorageJSON, getAccessToken, setLocalStorageJSON } from '@/utils/storage'
    21â†’import { AccountDeletionSection } from '@/components/settings/AccountDeletionSection'
    22â†’import { SkillCard } from '@/components/skill'
    23â†’import { useSkillSubscription, useSkills } from '@/hooks/useSkillSubscription'
    24â†’
    25â†’// Use Next.js API routes for server communication to avoid exposing backend URL
    26â†’const API_BASE = '/api'
    27â†’
    28â†’const SETTINGS_MENU = [
    29â†’  { id: 'profile', icon: 'ğŸ‘¤', label: 'ä¸ªäººèµ„æ–™' },
    30â†’  { id: 'skills', icon: 'ğŸ¯', label: 'Skill ç®¡ç†' },
    31â†’  { id: 'notifications', icon: 'ğŸ””', label: 'é€šçŸ¥è®¾ç½®' },
    32â†’  { id: 'privacy', icon: 'ğŸ”', label: 'éšç§ä¸å®‰å…¨' },
    33â†’  { id: 'membership', icon: 'ğŸ’', label: 'ä¼šå‘˜ç®¡ç†' },
    34â†’  { id: 'memory', icon: 'ğŸ§ ', label: 'è®°å¿†ç®¡ç†' },
    35â†’  { id: 'preferences', icon: 'âš™ï¸', label: 'åå¥½è®¾ç½®' },
    36â†’  { id: 'account', icon: 'âš ï¸', label: 'è´¦æˆ·ç®¡ç†' },
    37â†’  { id: 'help', icon: 'â“', label: 'å¸®åŠ©ä¸åé¦ˆ' },
    38â†’  { id: 'about', icon: 'ğŸ“„', label: 'å…³äº' },
    39â†’]
    40â†’
    41â†’interface UserProfile {
    42â†’  nickname: string
    43â†’  email: string
    44â†’  avatar: string
    45â†’  birthDate: string
    46â†’  birthTime: string
    47â†’  timezone: string
    48â†’}
    49â†’
    50â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    51â†’// Skill ç®¡ç†åŒºå—
    52â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    53â†’
    54â†’function SkillSettingsSection({ router }: { router: ReturnType<typeof useRouter> }) {
    55â†’  const { skills } = useSkills()
    56â†’  const { subscriptions, togglePush, unsubscribe, userStatuses } = useSkillSubscription()
    57â†’
    58â†’  // åˆ†ç»„
    59â†’  const { subscribed, available } = useMemo(() => {
    60â†’    const subscribedIds = new Set(
    61â†’      subscriptions.filter(s => s.status === 'subscribed').map(s => s.skill_id)
    62â†’    )
    63â†’    return {
    64â†’      subscribed: skills.filter(s => subscribedIds.has(s.id)),
    65â†’      available: skills.filter(s => !subscribedIds.has(s.id) && s.category !== 'core'),
    66â†’    }
    67â†’  }, [skills, subscriptions])
    68â†’
    69â†’  const handleTogglePush = async (skillId: string, enabled: boolean) => {
    70â†’    try {
    71â†’      await togglePush(skillId, enabled)
    72â†’    } catch (err) {
    73â†’      console.error('Toggle push failed:', err)
    74â†’    }
    75â†’  }
    76â†’
    77â†’  const handleUnsubscribe = async (skillId: string) => {
    78â†’    try {
    79â†’      await unsubscribe(skillId)
    80â†’    } catch (err) {
    81â†’      console.error('Unsubscribe failed:', err)
    82â†’    }
    83â†’  }
    84â†’
    85â†’  return (
    86â†’    <div className="space-y-6">
    87â†’      <div className="flex items-center justify-between">
    88â†’        <h2 className="font-serif text-xl text-text-primary">Skill ç®¡ç†</h2>
    89â†’        <button
    90â†’          onClick={() => router.push('/skills')}
    91â†’          className="text-sm text-accent hover:underline"
    92â†’        >
    93â†’          æ¢ç´¢æ›´å¤š â†’
    94â†’        </button>
    95â†’      </div>
    96â†’
    97â†’      {/* å·²è®¢é˜… */}
    98â†’      <div>
    99â†’        <h3 className="text-sm font-medium text-text-secondary mb-3">
   100â†’          å·²è®¢é˜… ({subscribed.length})
   101â†’        </h3>
   102â†’        <div className="space-y-2">
   103â†’          {subscribed.map((skill) => {
   104â†’            const sub = subscriptions.find(s => s.skill_id === skill.id)
   105â†’            const isCore = skill.category === 'core'
   106â†’            return (
   107â†’              <div key={skill.id} className="flex items-center gap-3 p-3 rounded-lg bg-[var(--bg-card-alt)]">
   108â†’                <div
   109â†’                  className="w-10 h-10 rounded-xl flex items-center justify-center text-xl"
   110â†’                  style={{ backgroundColor: `${skill.color}20` }}
   111â†’                >
   112â†’                  {skill.icon}
   113â†’                </div>
   114â†’                <div className="flex-1 min-w-0">
   115â†’                  <div className="flex items-center gap-2">
   116â†’                    <span className="font-medium text-text-primary">{skill.name}</span>
   117â†’                    {isCore && (
   118â†’                      <span className="px-1.5 py-0.5 text-xs rounded bg-accent/10 text-accent">
   119â†’                        å§‹ç»ˆæ¿€æ´»
   120â†’                      </span>
   121â†’                    )}
   122â†’                  </div>
   123â†’                  <p className="text-xs text-text-secondary truncate">
   124â†’                    {skill.features?.slice(0, 2).map(f => f.name).join(' Â· ')}
   125â†’                  </p>
   126â†’                </div>
   127â†’                {!isCore && (
   128â†’                  <div className="flex items-center gap-3">
   129â†’                    <div className="flex items-center gap-2">
   130â†’                      <span className="text-xs text-text-tertiary">æ¨é€</span>
   131â†’                      <label className="relative inline-flex items-center cursor-pointer">
   132â†’                        <input
   133â†’                          type="checkbox"
   134â†’                          checked={sub?.push_enabled ?? false}
   135â†’                          onChange={(e) => handleTogglePush(skill.id, e.target.checked)}
   136â†’                          className="sr-only peer"
   137â†’                        />
   138â†’                        <div className="w-9 h-5 bg-[var(--bg-secondary)] peer-focus:ring-2 peer-focus:ring-accent/50 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-accent" />
   139â†’                      </label>
   140â†’                    </div>
   141â†’                    <button
   142â†’                      onClick={() => handleUnsubscribe(skill.id)}
   143â†’                      className="text-xs text-error hover:underline"
   144â†’                    >
   145â†’                      å–æ¶ˆ
   146â†’                    </button>
   147â†’                  </div>
   148â†’                )}
   149â†’              </div>
   150â†’            )
   151â†’          })}
   152â†’        </div>
   153â†’      </div>
   154â†’
   155â†’      {/* å¯è®¢é˜… */}
   156â†’      {available.length > 0 && (
   157â†’        <div>
   158â†’          <h3 className="text-sm font-medium text-text-secondary mb-3">
   159â†’            å¯è®¢é˜… ({available.length})
   160â†’          </h3>
   161â†’          <div className="space-y-2">
   162â†’            {available.slice(0, 3).map((skill) => (
   163â†’              <div
   164â†’                key={skill.id}
   165â†’                onClick={() => router.push(`/skills/${skill.id}`)}
   166â†’                className="flex items-center gap-3 p-3 rounded-lg bg-[var(--bg-card-alt)] cursor-pointer hover:bg-[var(--bg-secondary)] transition-colors"
   167â†’              >
   168â†’                <div
   169â†’                  className="w-10 h-10 rounded-xl flex items-center justify-center text-xl"
   170â†’                  style={{ backgroundColor: `${skill.color}20` }}
   171â†’                >
   172â†’                  {skill.icon}
   173â†’                </div>
   174â†’                <div className="flex-1 min-w-0">
   175â†’                  <span className="font-medium text-text-primary">{skill.name}</span>
   176â†’                  <p className="text-xs text-text-secondary truncate">
   177â†’                    {skill.showcase?.tagline || skill.description}
   178â†’                  </p>
   179â†’                </div>
   180â†’                <button className="px-3 py-1 text-xs rounded-full bg-accent text-white">
   181â†’                  è®¢é˜…
   182â†’                </button>
   183â†’              </div>
   184â†’            ))}
   185â†’          </div>
   186â†’        </div>
   187â†’      )}
   188â†’    </div>
   189â†’  )
   190â†’}
   191â†’
   192â†’export default function SettingsPage() {
   193â†’  const router = useRouter()
   194â†’  const [activeSection, setActiveSection] = useState('profile')
   195â†’  const [loading, setLoading] = useState(false)
   196â†’  const [voiceMode, setVoiceModeState] = useState<"warm" | "sarcastic" | "wise">("warm")
   197â†’  const [profile, setProfile] = useState<UserProfile>(() => ({
   198â†’    nickname: 'ç”¨æˆ·',
   199â†’    email: 'user@example.com',
   200â†’    avatar: 'ğŸ‘¤',
   201â†’    // Do not prefill with fake defaults; leave empty until loaded
   202â†’    birthDate: '',
   203â†’    birthTime: '',
   204â†’    timezone: 'Asia/Shanghai',
   205â†’  }))
   206â†’  // Local Y/M/D states for better date UX (year select solves typing issue)
   207â†’  const [birthYear, setBirthYear] = useState('')
   208â†’  const [birthMonth, setBirthMonth] = useState('')
   209â†’  const [birthDay, setBirthDay] = useState('')
   210â†’
   211â†’  useEffect(() => {
   212â†’    // Prefer authoritative profile from API; fall back to cached localStorage
   213â†’    const user = getLocalStorageJSON<Record<string, string> | null>('user', null)
   214â†’    if (user) {
   215â†’      setProfile(prev => ({
   216â†’        ...prev,
   217â†’        nickname: user.nickname || user.display_name || 'ç”¨æˆ·',
   218â†’        email: user.email || '',
   219â†’        avatar: user.avatar || 'ğŸ‘¤',
   220â†’        timezone: user.timezone || 'Asia/Shanghai',
   221â†’      }))
   222â†’    }
   223â†’
   224â†’    const token = getAccessToken()
   225â†’    if (!token) return
   226â†’
   227â†’    // Fetch current profile to populate birth date/time accurately
   228â†’    fetch(`${API_BASE}/profile`, {
   229â†’      headers: { 'Authorization': `Bearer ${token}` }
   230â†’    })
   231â†’      .then(async (res) => {
   232â†’        if (!res.ok) return null
   233â†’        return res.json()
   234â†’      })
   235â†’      .then((data) => {
   236â†’        if (!data) return
   237â†’        // Parse ISO like "YYYY-MM-DDTHH:MM:SS" without TZ shift
   238â†’        const iso: string | undefined = data.birth_datetime
   239â†’        let birthDate = ''
   240â†’        let birthTime = ''
   241â†’        if (iso && typeof iso === 'string') {
   242â†’          const [d, t] = iso.split('T')
   243â†’          birthDate = d || ''
   244â†’          if (t) birthTime = t.slice(0, 5) // HH:MM
   245â†’        }
   246â†’
   247â†’        setProfile(prev => ({
   248â†’          ...prev,
   249â†’          nickname: data.display_name ?? prev.nickname,
   250â†’          avatar: data.avatar_url ? 'ğŸ‘¤' : prev.avatar,
   251â†’          birthDate,
   252â†’          birthTime,
   253â†’          timezone: data.timezone || prev.timezone,
   254â†’        }))
   255â†’      })
   256â†’      .catch(() => {})
   257â†’
   258â†’    // Load voice mode preference
   259â†’    fetch(`${API_BASE}/preferences`, {
   260â†’      headers: { 'Authorization': `Bearer ${token}` }
   261â†’    })
   262â†’      .then(res => res.ok ? res.json() : null)
   263â†’      .then(data => {
   264â†’        if (data?.voice_mode) {
   265â†’          setVoiceModeState(data.voice_mode as "warm" | "sarcastic" | "wise")
   266â†’        }
   267â†’      })
   268â†’      .catch(() => {})
   269â†’  }, [])
   270â†’
   271â†’  // Save voice mode to API
   272â†’  const setVoiceMode = useCallback(async (mode: "warm" | "sarcastic" | "wise") => {
   273â†’    setVoiceModeState(mode)
   274â†’    const token = getAccessToken()
   275â†’    if (!token) return
   276â†’    try {
   277â†’      await fetch(`${API_BASE}/preferences`, {
   278â†’        method: 'PUT',
   279â†’        headers: {
   280â†’          'Authorization': `Bearer ${token}`,
   281â†’          'Content-Type': 'application/json'
   282â†’        },
   283â†’        body: JSON.stringify({ voice_mode: mode })
   284â†’      })
   285â†’    } catch (error) {
   286â†’      console.error('Failed to save voice mode:', error)
   287â†’    }
   288â†’  }, [])
   289â†’
   290â†’  // Keep local Y/M/D in sync when profile.birthDate changes (e.g., loaded from API)
   291â†’  useEffect(() => {
   292â†’    const [y, m, d] = (profile.birthDate || '').split('-')
   293â†’    setBirthYear(y || '')
   294â†’    setBirthMonth(m || '')
   295â†’    setBirthDay(d || '')
   296â†’  }, [profile.birthDate])
   297â†’
   298â†’  // Use useCallback for stable reference (Vercel rule: rerender-functional-setstate)
   299â†’  const handleProfileChange = useCallback((field: keyof UserProfile, value: string) => {
   300â†’    setProfile(prev => ({ ...prev, [field]: value }))
   301â†’  }, [])
   302â†’
   303â†’  const handleSaveProfile = useCallback(async () => {
   304â†’    setLoading(true)
   305â†’    try {
   306â†’      const user = getLocalStorageJSON<Record<string, string> | null>('user', null)
   307â†’      const token = getAccessToken()
   308â†’
   309â†’      if (user?.user_id && token) {
   310â†’        const body: any = {
   311â†’          display_name: profile.nickname,
   312â†’          timezone: profile.timezone,
   313â†’        }
   314â†’        // When both date and time present -> set; otherwise explicitly clear on server
   315â†’        if (profile.birthDate && profile.birthTime) {
   316â†’          body.birth_datetime = `${profile.birthDate}T${profile.birthTime}:00`
   317â†’        } else {
   318â†’          body.birth_datetime = null
   319â†’        }
   320â†’
   321â†’        const res = await fetch(`${API_BASE}/profile`, {
   322â†’          method: 'PUT',
   323â†’          headers: {
   324â†’            'Content-Type': 'application/json',
   325â†’            'Authorization': `Bearer ${token}`
   326â†’          },
   327â†’          body: JSON.stringify(body),
   328â†’        })
   329â†’
   330â†’        if (res.ok) {
   331â†’          // Update local cache with normalized values
   332â†’          setLocalStorageJSON('user', {
   333â†’            ...user,
   334â†’            nickname: profile.nickname,
   335â†’            display_name: profile.nickname,
   336â†’            birth_date: profile.birthDate || undefined,
   337â†’            birth_time: profile.birthTime || undefined,
   338â†’            timezone: profile.timezone,
   339â†’          })
   340â†’        }
   341â†’      }
   342â†’    } catch (err) {
   343â†’      console.error('Failed to save profile:', err)
   344â†’    } finally {
   345â†’      setLoading(false)
   346â†’    }
   347â†’  }, [profile])
   348â†’
   349â†’  // è®¾ç½®å†…å®¹åŒºåŸŸ
   350â†’  const SettingsContent = () => {
   351â†’    switch (activeSection) {
   352â†’      case 'profile':
   353â†’        return (
   354â†’          <div className="space-y-6">
   355â†’            <h2 className="font-serif text-xl text-text-primary">ä¸ªäººèµ„æ–™</h2>
   356â†’            <div className="space-y-4">
   357â†’              <div>
   358â†’                <label className="block text-sm text-text-secondary mb-2">å¤´åƒ</label>
   359â†’                <div className="flex items-center gap-4">
   360â†’                  <div className="w-16 h-16 rounded-full bg-[var(--bg-secondary)] flex items-center justify-center text-3xl">
   361â†’                    {profile.avatar}
   362â†’                  </div>
   363â†’                  <button className="btn btn-secondary">æ›´æ¢å¤´åƒ</button>
   364â†’                </div>
   365â†’              </div>
   366â†’              <div>
   367â†’                <label className="block text-sm text-text-secondary mb-2">æ˜µç§°</label>
   368â†’                <input
   369â†’                  type="text"
   370â†’                  value={profile.nickname}
   371â†’                  onChange={(e) => handleProfileChange('nickname', e.target.value)}
   372â†’                  className="input"
   373â†’                />
   374â†’              </div>
   375â†’              <div>
   376â†’                <label className="block text-sm text-text-secondary mb-2">é‚®ç®±</label>
   377â†’                <input
   378â†’                  type="email"
   379â†’                  value={profile.email}
   380â†’                  disabled
   381â†’                  className="input bg-[var(--bg-secondary)]"
   382â†’                />
   383â†’              </div>
   384â†’              <div>
   385â†’                <label className="block text-sm text-text-secondary mb-2">å‡ºç”Ÿæ—¥æœŸ</label>
   386â†’                <BirthDateInputs
   387â†’                  year={birthYear}
   388â†’                  month={birthMonth}
   389â†’                  day={birthDay}
   390â†’                  onYearChange={(v) => {
   391â†’                    setBirthYear(v)
   392â†’                    const dateStr = v && birthMonth && birthDay ? `${v}-${birthMonth}-${birthDay}` : ''
   393â†’                    handleProfileChange('birthDate', dateStr)
   394â†’                  }}
   395â†’                  onMonthChange={(v) => {
   396â†’                    setBirthMonth(v)
   397â†’                    const dateStr = birthYear && v && birthDay ? `${birthYear}-${v}-${birthDay}` : ''
   398â†’                    handleProfileChange('birthDate', dateStr)
   399â†’                  }}
   400â†’                  onDayChange={(v) => {
   401â†’                    setBirthDay(v)
   402â†’                    const dateStr = birthYear && birthMonth && v ? `${birthYear}-${birthMonth}-${v}` : ''
   403â†’                    handleProfileChange('birthDate', dateStr)
   404â†’                  }}
   405â†’                  showHour={false}
   406â†’                />
   407â†’              </div>
   408â†’              <div>
   409â†’                <label className="block text-sm text-text-secondary mb-2">å‡ºç”Ÿæ—¶é—´</label>
   410â†’                <div className="flex items-center gap-3">
   411â†’                  <input
   412â†’                    type="time"
   413â†’                    step={60}
   414â†’                    value={profile.birthTime}
   415â†’                    onChange={(e) => handleProfileChange('birthTime', e.target.value)}
   416â†’                    className="input"
   417â†’                    placeholder="--:--"
   418â†’                  />
   419â†’                  <label className="inline-flex items-center gap-2 text-sm text-text-secondary">
   420â†’                    <input
   421â†’                      type="checkbox"
   422â†’                      checked={!profile.birthTime}
   423â†’                      onChange={(e) => handleProfileChange('birthTime', e.target.checked ? '' : '12:00')}
   424â†’                    />
   425â†’                    ä¸ç¡®å®š
   426â†’                  </label>
   427â†’                </div>
   428â†’              </div>
   429â†’              <div>
   430â†’                <label className="block text-sm text-text-secondary mb-2">æ—¶åŒº</label>
   431â†’                <select
   432â†’                  value={profile.timezone}
   433â†’                  onChange={(e) => handleProfileChange('timezone', e.target.value)}
   434â†’                  className="input"
   435â†’                >
   436â†’                  <option value="Asia/Shanghai">Asia/Shanghai (UTC+8)</option>
   437â†’                  <option value="Asia/Hong_Kong">Asia/Hong_Kong (UTC+8)</option>
   438â†’                  <option value="Asia/Tokyo">Asia/Tokyo (UTC+9)</option>
   439â†’                  <option value="America/New_York">America/New_York (UTC-5)</option>
   440â†’                  <option value="America/Los_Angeles">America/Los_Angeles (UTC-8)</option>
   441â†’                  <option value="Europe/London">Europe/London (UTC+0)</option>
   442â†’                </select>
   443â†’              </div>
   444â†’              <button onClick={handleSaveProfile} disabled={loading} className="btn btn-primary">
   445â†’                {loading ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜æ›´æ”¹'}
   446â†’              </button>
   447â†’            </div>
   448â†’          </div>
   449â†’        )
   450â†’      case 'skills':
   451â†’        return <SkillSettingsSection router={router} />
   452â†’      case 'notifications':
   453â†’        return (
   454â†’          <div className="space-y-6">
   455â†’            <h2 className="font-serif text-xl text-text-primary">é€šçŸ¥è®¾ç½®</h2>
   456â†’            <div className="space-y-4">
   457â†’              {[
   458â†’                { id: 'daily', label: 'æ¯æ—¥è¿åŠ¿æé†’', desc: 'æ¯å¤©æ—©ä¸Šæ¨é€ä»Šæ—¥è¿åŠ¿' },
   459â†’                { id: 'astro', label: 'æ˜Ÿè±¡äº‹ä»¶æé†’', desc: 'é‡è¦æ˜Ÿè±¡äº‹ä»¶ï¼ˆæ°´é€†ã€æ»¡æœˆç­‰ï¼‰' },
   460â†’                { id: 'memory', label: 'è®°å¿†æ›´æ–°æé†’', desc: 'å½“ VibeLife æœ‰æ–°çš„æ´å¯Ÿæ—¶' },
   461â†’                { id: 'promo', label: 'ä¼˜æƒ æ´»åŠ¨é€šçŸ¥', desc: 'ä¼šå‘˜ä¼˜æƒ å’Œæ´»åŠ¨ä¿¡æ¯' },
   462â†’              ].map((item) => (
   463â†’                <div key={item.id} className="flex items-center justify-between p-4 bg-[var(--bg-card-alt)] rounded-lg">
   464â†’                  <div>
   465â†’                    <p className="text-text-primary font-medium">{item.label}</p>
   466â†’                    <p className="text-sm text-text-secondary">{item.desc}</p>
   467â†’                  </div>
   468â†’                  <label className="relative inline-flex items-center cursor-pointer">
   469â†’                    <input type="checkbox" defaultChecked className="sr-only peer" />
   470â†’                    <div className="w-11 h-6 bg-[var(--bg-secondary)] peer-focus:ring-2 peer-focus:ring-amber rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"></div>
   471â†’                  </label>
   472â†’                </div>
   473â†’              ))}
   474â†’            </div>
   475â†’          </div>
   476â†’        )
   477â†’      case 'membership':
   478â†’        return (
   479â†’          <div className="space-y-6">
   480â†’            <h2 className="font-serif text-xl text-text-primary">ä¼šå‘˜ç®¡ç†</h2>
   481â†’            <div className="card p-6">
   482â†’              <div className="flex items-center justify-between mb-4">
   483â†’                <div>
   484â†’                  <p className="text-text-primary font-medium">å½“å‰çŠ¶æ€</p>
   485â†’                  <p className="text-sm text-text-secondary">å…è´¹ç”¨æˆ·</p>
   486â†’                </div>
   487â†’                <span className="px-3 py-1 bg-[var(--bg-secondary)] rounded-full text-sm text-text-secondary">Free</span>
   488â†’              </div>
   489â†’              <button onClick={() => router.push('/membership')} className="btn btn-premium w-full">
   490â†’                âœ¨ å‡çº§ Premium
   491â†’              </button>
   492â†’            </div>
   493â†’            <div className="space-y-3">
   494â†’              <p className="text-sm text-text-secondary">Premium ä¼šå‘˜æƒç›Šï¼š</p>
   495â†’              <ul className="space-y-2 text-sm text-text-secondary">
   496â†’                <li className="flex items-center gap-2"><span className="text-success">âœ“</span> å®Œæ•´æ¯æ—¥è¿åŠ¿</li>
   497â†’                <li className="flex items-center gap-2"><span className="text-success">âœ“</span> 30æ¬¡/å¤© AIå¯¹è¯</li>
   498â†’                <li className="flex items-center gap-2"><span className="text-success">âœ“</span> å®Œæ•´å¤§è¿/æµå¹´åˆ†æ</li>
   499â†’                <li className="flex items-center gap-2"><span className="text-success">âœ“</span> Identity Prism æ·±åº¦è§£è¯»</li>
   500â†’              </ul>
   501â†’            </div>
   502â†’          </div>
   503â†’        )
   504â†’      case 'memory':
   505â†’        return (
   506â†’          <div className="space-y-6">
   507â†’            <h2 className="font-serif text-xl text-text-primary">è®°å¿†ç®¡ç†</h2>
   508â†’            <p className="text-sm text-text-secondary">VibeLife ä¼šè®°ä½ä½ åˆ†äº«çš„ä¿¡æ¯ï¼Œä»¥æä¾›æ›´ä¸ªæ€§åŒ–çš„ä½“éªŒã€‚</p>
   509â†’            <div className="space-y-3">
   510â†’              {[
   511â†’                { content: 'ä½ æœ€è¿‘å·¥ä½œå‹åŠ›è¾ƒå¤§', date: '2å¤©å‰' },
   512â†’                { content: 'å…³æ³¨èŒä¸šå‘å±•æ–¹å‘', date: '1å‘¨å‰' },
   513â†’                { content: 'å¯¹æ„Ÿæƒ…é—®é¢˜æœ‰å›°æ‰°', date: '2å‘¨å‰' },
   514â†’              ].map((memory, i) => (
   515â†’                <div key={i} className="flex items-center justify-between p-4 bg-[var(--bg-callout)] rounded-lg">
   516â†’                  <div>
   517â†’                    <p className="text-text-primary">{memory.content}</p>
   518â†’                    <p className="text-xs text-text-secondary mt-1">{memory.date}</p>
   519â†’                  </div>
   520â†’                  <button className="text-sm text-error">åˆ é™¤</button>
   521â†’                </div>
   522â†’              ))}
   523â†’            </div>
   524â†’            <button className="text-sm text-error">æ¸…é™¤æ‰€æœ‰è®°å¿†</button>
   525â†’          </div>
   526â†’        )
   527â†’      case 'account':
   528â†’        return (
   529â†’          <div className="space-y-6">
   530â†’            <h2 className="font-serif text-xl text-text-primary">è´¦æˆ·ç®¡ç†</h2>
   531â†’            <AccountDeletionSection />
   532â†’          </div>
   533â†’        )
   534â†’      case 'preferences':
   535â†’        return (
   536â†’          <div className="space-y-6">
   537â†’            <h2 className="font-serif text-xl text-text-primary">åå¥½è®¾ç½®</h2>
   538â†’            <div className="space-y-4">
   539â†’              {/* è¯­æ°”æ¨¡å¼ */}
   540â†’              <div className="p-4 bg-[var(--bg-card-alt)] rounded-lg">
   541â†’                <div className="mb-3">
   542â†’                  <h3 className="text-text-primary font-medium mb-1">è¯­æ°”æ¨¡å¼</h3>
   543â†’                  <p className="text-sm text-text-secondary">é€‰æ‹© AI çš„å¯¹è¯é£æ ¼</p>
   544â†’                </div>
   545â†’                <div className="flex gap-3">
   546â†’                  <button
   547â†’                    onClick={() => setVoiceMode('warm')}
   548â†’                    className={`flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all ${
   549â†’                      voiceMode === 'warm'
   550â†’                        ? 'bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300 shadow-sm'
   551â†’                        : 'bg-[var(--bg-secondary)] text-text-secondary hover:bg-[var(--bg-tertiary)]'
   552â†’                    }`}
   553â†’                  >
   554â†’                    <div className="text-2xl mb-1">ğŸŒ</div>
   555â†’                    <div>æ¸©æš–æ”¯æŒ</div>
   556â†’                  </button>
   557â†’                  <button
   558â†’                    onClick={() => setVoiceMode('sarcastic')}
   559â†’                    className={`flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all ${
   560â†’                      voiceMode === 'sarcastic'
   561â†’                        ? 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 shadow-sm'
   562â†’                        : 'bg-[var(--bg-secondary)] text-text-secondary hover:bg-[var(--bg-tertiary)]'
   563â†’                    }`}
   564â†’                  >
   565â†’                    <div className="text-2xl mb-1">ğŸ˜ˆ</div>
   566â†’                    <div>ç›´æ¥æŒ‘æˆ˜</div>
   567â†’                  </button>
   568â†’                  <button
   569â†’                    onClick={() => setVoiceMode('wise')}
   570â†’                    className={`flex-1 px-4 py-3 rounded-lg text-sm font-medium transition-all ${
   571â†’                      voiceMode === 'wise'
   572â†’                        ? 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 shadow-sm'
   573â†’                        : 'bg-[var(--bg-secondary)] text-text-secondary hover:bg-[var(--bg-tertiary)]'
   574â†’                    }`}
   575â†’                  >
   576â†’                    <div className="text-2xl mb-1">ğŸ§™</div>
   577â†’                    <div>ç¿æ™ºå¯¼å¸ˆ</div>
   578â†’                  </button>
   579â†’                </div>
   580â†’                <div className="mt-3 p-3 bg-[var(--bg-callout)] rounded text-xs text-text-secondary">
   581â†’                  {voiceMode === 'warm' && 'ğŸ’­ åƒä¸€ä¸ªç†è§£ä½ çš„è€æœ‹å‹ï¼Œæ¸©æš–ä½†ä¸å¤±æ´å¯Ÿ'}
   582â†’                  {voiceMode === 'sarcastic' && 'ğŸ’­ ç”¨å¹½é»˜å’ŒçŠ€åˆ©çš„æ–¹å¼æˆ³ç ´ä½ çš„è‡ªæ¬ºæ¬ºäººï¼Œæ¨åŠ¨ä½ é¢å¯¹çœŸç›¸'}
   583â†’                  {voiceMode === 'wise' && 'ğŸ’­ åƒä¸€ä½ç»å†ä¸°å¯Œçš„é•¿è¾ˆï¼Œç”¨æ·±åº¦å’Œç†æ€§å¼•å¯¼æ€è€ƒ'}
   584â†’                </div>
   585â†’              </div>
   586â†’            </div>
   587â†’          </div>
   588â†’        )
   589â†’      case 'about':
   590â†’        return (
   591â†’          <div className="space-y-6">
   592â†’            <h2 className="font-serif text-xl text-text-primary">å…³äº VibeLife</h2>
   593â†’            <div className="text-center py-8">
   594â†’              <span className="text-5xl mb-4 block">ğŸŒŸ</span>
   595â†’              <h3 className="font-serif text-2xl text-text-primary mb-2">VibeLife</h3>
   596â†’              <p className="text-text-secondary mb-4">æ¢ç´¢å†…å¿ƒä¸–ç•Œ</p>
   597â†’              <p className="text-sm text-text-secondary">ç‰ˆæœ¬ 5.0.0</p>
   598â†’            </div>
   599â†’            <div className="space-y-2 text-sm text-text-secondary">
   600â†’              <button className="w-full p-3 text-left hover:bg-[var(--bg-secondary)] rounded-lg">ç”¨æˆ·åè®®</button>
   601â†’              <button className="w-full p-3 text-left hover:bg-[var(--bg-secondary)] rounded-lg">éšç§æ”¿ç­–</button>
   602â†’              <button className="w-full p-3 text-left hover:bg-[var(--bg-secondary)] rounded-lg">è”ç³»æˆ‘ä»¬</button>
   603â†’            </div>
   604â†’          </div>
   605â†’        )
   606â†’      default:
   607â†’        return (
   608â†’          <div className="text-center py-8 text-text-secondary">
   609â†’            <p>è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...</p>
   610â†’          </div>
   611â†’        )
   612â†’    }
   613â†’  }
   614â†’
   615â†’  // PCç«¯å³ä¾§è¾¹æ  - è®¾ç½®èœå•
   616â†’  const AsideContent = () => (
   617â†’    <div className="space-y-2">
   618â†’      {SETTINGS_MENU.map((item) => (
   619â†’        <button
   620â†’          key={item.id}
   621â†’          onClick={() => setActiveSection(item.id)}
   622â†’          className={`w-full flex items-center gap-3 p-3 rounded-lg text-left transition-colors ${
   623â†’            activeSection === item.id
   624â†’              ? 'bg-accent/10 text-accent'
   625â†’              : 'text-text-secondary hover:bg-[var(--bg-secondary)]'
   626â†’          }`}
   627â†’        >
   628â†’          <span className="text-lg">{item.icon}</span>
   629â†’          <span className="text-sm">{item.label}</span>
   630â†’        </button>
   631â†’      ))}
   632â†’      <div className="pt-4 mt-4 border-t border-[var(--border-light)]">
   633â†’        <button className="w-full flex items-center gap-3 p-3 rounded-lg text-left text-error hover:bg-error/5 transition-colors">
   634â†’          <span className="text-lg">ğŸšª</span>
   635â†’          <span className="text-sm">é€€å‡ºç™»å½•</span>
   636â†’        </button>
   637â†’      </div>
   638â†’    </div>
   639â†’  )
   640â†’
   641â†’  // PCç«¯ä¸»å†…å®¹
   642â†’  const PCContent = () => (
   643â†’    <div className="card p-6">
   644â†’      <SettingsContent />
   645â†’    </div>
   646â†’  )
   647â†’
   648â†’  // ç§»åŠ¨ç«¯å†…å®¹
   649â†’  const MobileContent = () => (
   650â†’    <div className="min-h-screen bg-bg-primary lg:hidden">
   651â†’      <nav className="nav">
   652â†’        <div className="nav-container">
   653â†’          <button onClick={() => router.back()} className="text-text-secondary">â† è¿”å›</button>
   654â†’          <h1 className="font-serif text-card-title text-text-primary">è®¾ç½®</h1>
   655â†’          <div className="w-8" />
   656â†’        </div>
   657â†’      </nav>
   658â†’
   659â†’      <main className="max-w-lg mx-auto px-4 py-6">
   660â†’        <div className="space-y-2">
   661â†’          {SETTINGS_MENU.map((item, index) => (
   662â†’            <button
   663â†’              key={item.id}
   664â†’              onClick={() => {
   665â†’                if (item.id === 'membership') {
   666â†’                  router.push('/membership')
   667â†’                } else {
   668â†’                  setActiveSection(item.id)
   669â†’                }
   670â†’              }}
   671â†’              className="w-full card p-4 flex items-center gap-3 animate-slide-in-up stagger-item"
   672â†’              style={{ animationDelay: `${index * 50}ms` }}
   673â†’            >
   674â†’              <span className="text-xl">{item.icon}</span>
   675â†’              <span className="text-text-primary">{item.label}</span>
   676â†’              <span className="ml-auto text-text-secondary">â€º</span>
   677â†’            </button>
   678â†’          ))}
   679â†’        </div>
   680â†’
   681â†’        <div className="mt-8">
   682â†’          <button className="w-full p-4 text-center text-error">é€€å‡ºç™»å½•</button>
   683â†’        </div>
   684â†’
   685â†’        <div className="mt-8 text-center text-sm text-text-secondary">
   686â†’          <p>VibeLife v5.0.0</p>
   687â†’        </div>
   688â†’      </main>
   689â†’    </div>
   690â†’  )
   691â†’
   692â†’  return (
   693â†’    <>
   694â†’      {/* PCç«¯: ä½¿ç”¨ PCLayout ä¸‰æ å¸ƒå±€ */}
   695â†’      <div className="hidden lg:block">
   696â†’        <PCLayout
   697â†’          breadcrumb={[
   698â†’            { label: 'é¦–é¡µ', href: '/' },
   699â†’            { label: 'è®¾ç½®' }
   700â†’          ]}
   701â†’          aside={<AsideContent />}
   702â†’          showCommandBar={false}
   703â†’        >
   704â†’          <PCContent />
   705â†’        </PCLayout>
   706â†’      </div>
   707â†’
   708â†’      {/* ç§»åŠ¨ç«¯: ç®€å•å•æ å¸ƒå±€ */}
   709â†’      <MobileContent />
   710â†’    </>
   711â†’  )
   712â†’}
   713â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
