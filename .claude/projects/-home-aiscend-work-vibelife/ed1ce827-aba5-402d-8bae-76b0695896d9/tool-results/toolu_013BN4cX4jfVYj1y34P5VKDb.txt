     1→/**
     2→ * BaziFortuneCard - 大运流年卡片
     3→ *
     4→ * 从 show-fortune.tsx 提取的纯渲染组件
     5→ * 通过 CardRegistry 注册，由 card_type: "bazi_fortune" 触发
     6→ */
     7→
     8→"use client";
     9→
    10→import { cn } from "@/lib/utils";
    11→import { registerCard } from "@/skills/CardRegistry";
    12→
    13→// ═══════════════════════════════════════════════════════════════════════════
    14→// Types
    15→// ═══════════════════════════════════════════════════════════════════════════
    16→
    17→interface MajorCycle {
    18→  start_year: number;
    19→  end_year: number;
    20→  element?: string;
    21→  polarity?: string;
    22→  phase?: string;
    23→  theme: string;
    24→  description?: string;
    25→  fortune_score: number;
    26→}
    27→
    28→interface AnnualFortune {
    29→  year: number;
    30→  element?: string;
    31→  polarity?: string;
    32→  influence?: string;
    33→  fortune_score: number;
    34→  theme: string;
    35→  highlights?: string[];
    36→  cautions?: string[];
    37→}
    38→
    39→interface BaziFortuneData {
    40→  user_id?: string;
    41→  userId?: string;
    42→  year?: number;
    43→  cycles?: MajorCycle[];
    44→  annual?: AnnualFortune | null;
    45→}
    46→
    47→interface BaziFortuneCardProps {
    48→  data: BaziFortuneData;
    49→  cardProps?: Record<string, unknown>;
    50→}
    51→
    52→// ═══════════════════════════════════════════════════════════════════════════
    53→// Helpers
    54→// ═══════════════════════════════════════════════════════════════════════════
    55→
    56→function scoreBadge(score: number) {
    57→  if (score >= 85) return { label: "偏强", className: "bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-200" };
    58→  if (score >= 70) return { label: "稳健", className: "bg-sky-100 text-sky-800 dark:bg-sky-900/30 dark:text-sky-200" };
    59→  if (score >= 55) return { label: "平稳", className: "bg-slate-100 text-slate-800 dark:bg-slate-800 dark:text-slate-200" };
    60→  if (score >= 40) return { label: "偏紧", className: "bg-accent-100 text-accent-800 dark:bg-accent-900/30 dark:text-accent-200" };
    61→  return { label: "多变", className: "bg-rose-100 text-rose-800 dark:bg-rose-900/30 dark:text-rose-200" };
    62→}
    63→
    64→// ═══════════════════════════════════════════════════════════════════════════
    65→// Component
    66→// ═══════════════════════════════════════════════════════════════════════════
    67→
    68→function BaziFortuneCard({ data }: BaziFortuneCardProps) {
    69→  const currentYear = data.year || new Date().getFullYear();
    70→  const cycles = data.cycles || [];
    71→  const annual = data.annual;
    72→
    73→  const currentCycle =
    74→    cycles.find((c) => currentYear >= c.start_year && currentYear <= c.end_year) || cycles[0];
    75→  const cycleScore = currentCycle?.fortune_score ?? 60;
    76→  const cycleBadge = scoreBadge(cycleScore);
    77→  const annualScore = annual?.fortune_score ?? 60;
    78→  const annualBadge = scoreBadge(annualScore);
    79→
    80→  return (
    81→    <div className="fortune-card bg-gradient-to-br from-purple-50 to-indigo-50 dark:from-purple-950/30 dark:to-indigo-950/30 rounded-xl border border-purple-200 dark:border-purple-800 p-4 my-2">
    82→      <div className="flex items-center justify-between gap-3 mb-4">
    83→        <h3 className="text-lg font-semibold text-purple-900 dark:text-purple-100">
    84→          大运与流年
    85→        </h3>
    86→        <span className={cn("px-2 py-1 rounded text-xs font-medium", annualBadge.className)}>
    87→          {currentYear} · {annualBadge.label} {annualScore}/100
    88→        </span>
    89→      </div>
    90→
    91→      {currentCycle && (
    92→        <div className="bg-white/60 dark:bg-black/30 rounded-lg p-3 mb-3">
    93→          <div className="flex items-center justify-between gap-3 mb-1">
    94→            <span className="text-sm font-medium">当前大运</span>
    95→            <span className={cn("px-2 py-0.5 rounded text-xs font-medium", cycleBadge.className)}>
    96→              {cycleBadge.label} {cycleScore}/100
    97→            </span>
    98→          </div>
    99→          <p className="text-sm text-foreground">
   100→            {currentCycle.start_year}-{currentCycle.end_year} · {currentCycle.theme}
   101→          </p>
   102→          {currentCycle.description && (
   103→            <p className="text-xs text-muted-foreground mt-1">
   104→              {currentCycle.description}
   105→            </p>
   106→          )}
   107→        </div>
   108→      )}
   109→
   110→      <div className="mb-3">
   111→        <div className="text-sm font-medium text-purple-700 dark:text-purple-300 mb-2">
   112→          大运周期
   113→        </div>
   114→        <div className="flex overflow-x-auto gap-2 pb-2">
   115→          {cycles.slice(0, 10).map((cycle) => {
   116→            const isCurrent = currentYear >= cycle.start_year && currentYear <= cycle.end_year;
   117→            const badge = scoreBadge(cycle.fortune_score);
   118→            return (
   119→              <div
   120→                key={`${cycle.start_year}-${cycle.end_year}`}
   121→                className={cn(
   122→                  "flex-shrink-0 px-3 py-2 rounded-lg text-center min-w-[84px] border",
   123→                  isCurrent
   124→                    ? "bg-purple-100/70 dark:bg-purple-900/30 border-purple-300 dark:border-purple-700"
   125→                    : "bg-white/60 dark:bg-black/20 border-border/40"
   126→                )}
   127→              >
   128→                <div className="text-[10px] text-muted-foreground">
   129→                  {cycle.start_year}–{cycle.end_year}
   130→                </div>
   131→                <div className="text-xs font-medium mt-0.5">{cycle.theme}</div>
   132→                <div className={cn("inline-flex mt-1 px-1.5 py-0.5 rounded text-[10px] font-medium", badge.className)}>
   133→                  {cycle.fortune_score}
   134→                </div>
   135→              </div>
   136→            );
   137→          })}
   138→        </div>
   139→      </div>
   140→
   141→      {annual && (
   142→        <div className="bg-gradient-to-r from-purple-100 to-indigo-100 dark:from-purple-900/30 dark:to-indigo-900/30 rounded-lg p-3">
   143→          <div className="flex items-center justify-between gap-3 mb-2">
   144→            <div className="text-sm font-medium">流年主题</div>
   145→            <span className={cn("px-2 py-0.5 rounded text-xs font-medium", annualBadge.className)}>
   146→              {annualBadge.label}
   147→            </span>
   148→          </div>
   149→          <p className="text-sm text-foreground">{annual.theme}</p>
   150→          {(annual.highlights?.length || annual.cautions?.length) ? (
   151→            <div className="grid grid-cols-2 gap-3 mt-3 text-xs">
   152→              <div className="bg-white/60 dark:bg-black/20 rounded p-2">
   153→                <div className="font-medium mb-1">机会</div>
   154→                <ul className="space-y-0.5 text-muted-foreground">
   155→                  {(annual.highlights || []).slice(0, 3).map((item) => (
   156→                    <li key={item}>• {item}</li>
   157→                  ))}
   158→                </ul>
   159→              </div>
   160→              <div className="bg-white/60 dark:bg-black/20 rounded p-2">
   161→                <div className="font-medium mb-1">提醒</div>
   162→                <ul className="space-y-0.5 text-muted-foreground">
   163→                  {(annual.cautions || []).slice(0, 3).map((item) => (
   164→                    <li key={item}>• {item}</li>
   165→                  ))}
   166→                </ul>
   167→              </div>
   168→            </div>
   169→          ) : null}
   170→        </div>
   171→      )}
   172→    </div>
   173→  );
   174→}
   175→
   176→// ═══════════════════════════════════════════════════════════════════════════
   177→// Register to CardRegistry
   178→// ═══════════════════════════════════════════════════════════════════════════
   179→
   180→registerCard("bazi_fortune", BaziFortuneCard);
   181→
   182→export default BaziFortuneCard;
   183→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
