     1→/**
     2→ * SkillIntroCard - Skill 介绍导航卡片
     3→ *
     4→ * 作为用户了解和使用 Skill 的中央入口，支持三种变体：
     5→ * - full: 完整版，包含所有 sections
     6→ * - compact: 精简版，适合对话中展示
     7→ * - mini: 迷你版，只有标题和 CTA
     8→ */
     9→
    10→'use client';
    11→
    12→import React, { useMemo } from 'react';
    13→import Header from './Header';
    14→import FeatureList from './FeatureList';
    15→import QuickStart from './QuickStart';
    16→import PricingSection from './PricingSection';
    17→import SettingsSection from './SettingsSection';
    18→import { useSkillIntro, useSubscribe, useUpdateSettings, useMarkFirstUse } from './hooks/useSkillIntro';
    19→import type {
    20→  SkillIntroCardProps,
    21→  SectionType,
    22→  IntroCardAction,
    23→  SkillFeature,
    24→} from './types';
    25→
    26→// 变体对应的默认 sections
    27→const VARIANT_SECTIONS: Record<string, SectionType[]> = {
    28→  full: ['header', 'features', 'quickstart', 'pricing', 'settings'],
    29→  compact: ['header', 'features', 'quickstart'],
    30→  mini: ['header'],
    31→};
    32→
    33→const SkillIntroCard: React.FC<SkillIntroCardProps> = ({
    34→  skillId,
    35→  variant = 'compact',
    36→  sections: customSections,
    37→  dismissible = false,
    38→  onAction,
    39→  className = '',
    40→  initialData,
    41→  reason,
    42→}) => {
    43→  // 数据获取
    44→  const { data, isLoading, error } = useSkillIntro(skillId);
    45→  const introData = initialData || data;
    46→
    47→  // Mutations
    48→  const { subscribe: doSubscribe } = useSubscribe(skillId);
    49→  const { update: doUpdateSettings } = useUpdateSettings(skillId);
    50→  const { mark: doMarkFirstUse } = useMarkFirstUse(skillId);
    51→
    52→  // 确定要显示的 sections
    53→  const activeSections = useMemo(() => {
    54→    if (customSections) return customSections;
    55→    if (introData?.skill.intro_card?.default_sections) {
    56→      return introData.skill.intro_card.default_sections;
    57→    }
    58→    return VARIANT_SECTIONS[variant] || VARIANT_SECTIONS.compact;
    59→  }, [customSections, introData, variant]);
    60→
    61→  // 处理 Action
    62→  const handleAction = (action: IntroCardAction) => {
    63→    onAction?.(action);
    64→  };
    65→
    66→  // 处理 Feature 点击
    67→  const handleFeatureClick = (feature: SkillFeature) => {
    68→    handleAction({ type: 'expand_feature', featureId: feature.name });
    69→  };
    70→
    71→  // 处理 "试试看" 点击
    72→  const handleTryClick = (feature: SkillFeature) => {
    73→    if (feature.demo_prompt) {
    74→      handleAction({ type: 'send_prompt', prompt: feature.demo_prompt });
    75→    }
    76→  };
    77→
    78→  // 处理 QuickStart prompt 点击
    79→  const handlePromptClick = (prompt: string) => {
    80→    handleAction({ type: 'send_prompt', prompt });
    81→  };
    82→
    83→  // 处理订阅
    84→  const handleSubscribe = async () => {
    85→    try {
    86→      await doSubscribe(true);
    87→      handleAction({ type: 'subscribe', skillId });
    88→    } catch (err) {
    89→      console.error('Subscribe failed:', err);
    90→    }
    91→  };
    92→
    93→  // 处理管理订阅
    94→  const handleManage = () => {
    95→    // TODO: 导航到订阅管理页面
    96→    handleAction({ type: 'navigate', target: 'scenario', id: 'subscription-manage' });
    97→  };
    98→
    99→  // 处理设置变更
   100→  const handleSettingChange = async (key: string, value: unknown) => {
   101→    try {
   102→      await doUpdateSettings({ [key]: value });
   103→      handleAction({ type: 'toggle_setting', key, value });
   104→    } catch (err) {
   105→      console.error('Update setting failed:', err);
   106→    }
   107→  };
   108→
   109→  // 处理关闭
   110→  const handleDismiss = () => {
   111→    // 标记首次使用
   112→    if (introData?.is_first_use) {
   113→      doMarkFirstUse();
   114→    }
   115→    handleAction({ type: 'dismiss' });
   116→  };
   117→
   118→  // Loading 状态
   119→  if (isLoading && !introData) {
   120→    return (
   121→      <div className={`rounded-xl bg-white border border-gray-200 overflow-hidden animate-pulse ${className}`}>
   122→        <div className="p-6">
   123→          <div className="flex items-center gap-3">
   124→            <div className="w-10 h-10 bg-gray-200 rounded-lg" />
   125→            <div className="flex-1">
   126→              <div className="h-5 bg-gray-200 rounded w-1/3 mb-2" />
   127→              <div className="h-4 bg-gray-200 rounded w-2/3" />
   128→            </div>
   129→          </div>
   130→        </div>
   131→        <div className="px-6 pb-6">
   132→          <div className="grid grid-cols-3 gap-3">
   133→            {[1, 2, 3].map((i) => (
   134→              <div key={i} className="h-20 bg-gray-100 rounded-lg" />
   135→            ))}
   136→          </div>
   137→        </div>
   138→      </div>
   139→    );
   140→  }
   141→
   142→  // Error 状态
   143→  if (error || !introData) {
   144→    return (
   145→      <div className={`rounded-xl bg-white border border-red-200 p-6 ${className}`}>
   146→        <p className="text-red-600 text-sm">加载失败，请稍后重试</p>
   147→      </div>
   148→    );
   149→  }
   150→
   151→  const { skill, subscription, settings } = introData;
   152→
   153→  // Mini 变体
   154→  if (variant === 'mini') {
   155→    return (
   156→      <div className={`rounded-xl bg-white border border-gray-200 overflow-hidden ${className}`}>
   157→        <div className="flex items-center justify-between p-3">
   158→          <div className="flex items-center gap-2">
   159→            <span className="text-xl">{skill.icon}</span>
   160→            <span className="font-medium text-gray-800">{skill.name}</span>
   161→            <span className="text-gray-500 text-sm">· {skill.showcase.tagline}</span>
   162→          </div>
   163→          <button
   164→            onClick={() => handleAction({ type: 'navigate', target: 'scenario', id: 'intro' })}
   165→            className="px-3 py-1 text-sm font-medium text-white rounded-lg transition-colors"
   166→            style={{ backgroundColor: skill.color }}
   167→          >
   168→            开始使用 →
   169→          </button>
   170→        </div>
   171→      </div>
   172→    );
   173→  }
   174→
   175→  return (
   176→    <div className={`rounded-xl bg-white border border-gray-200 overflow-hidden shadow-sm ${className}`}>
   177→      {/* 展示原因 */}
   178→      {reason && (
   179→        <div className="px-4 sm:px-6 py-2 bg-blue-50 border-b border-blue-100">
   180→          <p className="text-sm text-blue-700">{reason}</p>
   181→        </div>
   182→      )}
   183→
   184→      {/* 关闭按钮 */}
   185→      {dismissible && (
   186→        <button
   187→          onClick={handleDismiss}
   188→          className="absolute top-3 right-3 p-1 rounded-full hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition-colors"
   189→        >
   190→          <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   191→            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
   192→          </svg>
   193→        </button>
   194→      )}
   195→
   196→      {/* Header */}
   197→      {activeSections.includes('header') && (
   198→        <Header skill={skill} subscription={subscription} variant={variant} />
   199→      )}
   200→
   201→      {/* Features */}
   202→      {activeSections.includes('features') && skill.features.length > 0 && (
   203→        <FeatureList
   204→          features={skill.features}
   205→          variant={variant}
   206→          onFeatureClick={handleFeatureClick}
   207→          onTryClick={handleTryClick}
   208→        />
   209→      )}
   210→
   211→      {/* QuickStart */}
   212→      {activeSections.includes('quickstart') && skill.showcase.demo_prompts.length > 0 && (
   213→        <QuickStart
   214→          prompts={skill.showcase.demo_prompts}
   215→          onPromptClick={handlePromptClick}
   216→        />
   217→      )}
   218→
   219→      {/* Pricing */}
   220→      {activeSections.includes('pricing') && (
   221→        <PricingSection
   222→          pricing={skill.pricing}
   223→          subscription={subscription}
   224→          skillId={skillId}
   225→          ctaText={skill.intro_card?.cta_text}
   226→          onSubscribe={handleSubscribe}
   227→          onManage={handleManage}
   228→        />
   229→      )}
   230→
   231→      {/* Settings */}
   232→      {activeSections.includes('settings') && skill.settings && (
   233→        <SettingsSection
   234→          settings={skill.settings}
   235→          userSettings={settings}
   236→          subscription={subscription}
   237→          onSettingChange={handleSettingChange}
   238→        />
   239→      )}
   240→    </div>
   241→  );
   242→};
   243→
   244→export default SkillIntroCard;
   245→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
