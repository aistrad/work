     1→/**
     2→ * CollectFormCard - 信息收集表单卡片
     3→ * 支持结构化表单 + 自然语言输入双模式
     4→ */
     5→
     6→import React, { useState } from 'react';
     7→
     8→interface SelectOption {
     9→  value: string;
    10→  label: string;
    11→}
    12→
    13→interface FormField {
    14→  id?: string;        // 后端使用 id
    15→  name?: string;      // 兼容旧格式
    16→  type: 'date' | 'time' | 'location' | 'text' | 'select' | 'textarea';
    17→  label: string;
    18→  required?: boolean;
    19→  options?: (string | SelectOption)[];  // 支持字符串或对象格式
    20→  placeholder?: string;
    21→}
    22→
    23→interface CollectFormCardProps {
    24→  formFields: FormField[];
    25→  allowTextInput?: boolean;
    26→  textInputPlaceholder?: string;
    27→  onSubmit: (data: Record<string, any>) => void;
    28→  onSkip?: () => void;
    29→}
    30→
    31→const CollectFormCard: React.FC<CollectFormCardProps> = ({
    32→  formFields,
    33→  allowTextInput = true,
    34→  textInputPlaceholder = '请描述你的问题...',
    35→  onSubmit,
    36→  onSkip,
    37→}) => {
    38→  const [formData, setFormData] = useState<Record<string, any>>({});
    39→  const [textInput, setTextInput] = useState('');
    40→
    41→  const handleFieldChange = (name: string, value: any) => {
    42→    setFormData((prev) => ({ ...prev, [name]: value }));
    43→  };
    44→
    45→  const handleSubmit = (e: React.FormEvent) => {
    46→    e.preventDefault();
    47→    onSubmit({
    48→      ...formData,
    49→      ...(textInput && { question: textInput }),
    50→    });
    51→  };
    52→
    53→  const renderField = (field: FormField) => {
    54→    // 支持 id 或 name 作为字段标识
    55→    const fieldKey = field.id || field.name || '';
    56→    const baseClass =
    57→      'w-full px-3 py-2.5 border border-orange-200 dark:border-orange-800 bg-white dark:bg-black/20 rounded-xl focus:ring-2 focus:ring-[var(--accent-primary)] focus:border-transparent text-text-primary text-sm';
    58→
    59→    switch (field.type) {
    60→      case 'date':
    61→        return (
    62→          <input
    63→            type="date"
    64→            className={baseClass}
    65→            value={formData[fieldKey] || ''}
    66→            onChange={(e) => handleFieldChange(fieldKey, e.target.value)}
    67→            required={field.required}
    68→          />
    69→        );
    70→      case 'time':
    71→        return (
    72→          <input
    73→            type="time"
    74→            className={baseClass}
    75→            value={formData[fieldKey] || ''}
    76→            onChange={(e) => handleFieldChange(fieldKey, e.target.value)}
    77→            required={field.required}
    78→          />
    79→        );
    80→      case 'select':
    81→        return (
    82→          <select
    83→            className={baseClass}
    84→            value={formData[fieldKey] || ''}
    85→            onChange={(e) => handleFieldChange(fieldKey, e.target.value)}
    86→            required={field.required}
    87→          >
    88→            <option value="">请选择</option>
    89→            {field.options?.map((opt) => {
    90→              // 支持字符串或 {value, label} 对象格式
    91→              const optValue = typeof opt === 'string' ? opt : opt.value;
    92→              const optLabel = typeof opt === 'string' ? opt : opt.label;
    93→              return (
    94→                <option key={optValue} value={optValue}>
    95→                  {optLabel}
    96→                </option>
    97→              );
    98→            })}
    99→          </select>
   100→        );
   101→      case 'textarea':
   102→        return (
   103→          <textarea
   104→            className={`${baseClass} resize-none`}
   105→            rows={3}
   106→            placeholder={field.placeholder}
   107→            value={formData[fieldKey] || ''}
   108→            onChange={(e) => handleFieldChange(fieldKey, e.target.value)}
   109→            required={field.required}
   110→          />
   111→        );
   112→      default:
   113→        return (
   114→          <input
   115→            type="text"
   116→            className={baseClass}
   117→            placeholder={field.placeholder}
   118→            value={formData[fieldKey] || ''}
   119→            onChange={(e) => handleFieldChange(fieldKey, e.target.value)}
   120→            required={field.required}
   121→          />
   122→        );
   123→    }
   124→  };
   125→
   126→  return (
   127→    <div className="rounded-2xl border border-orange-100 dark:border-orange-900/50 bg-gradient-to-br from-orange-50/80 to-amber-50/60 dark:from-orange-950/20 dark:to-amber-950/20 p-5 w-full shadow-[var(--shadow-card)]">
   128→      <form onSubmit={handleSubmit} className="space-y-4">
   129→        {formFields.map((field) => {
   130→          const fieldKey = field.id || field.name || field.label;
   131→          return (
   132→            <div key={fieldKey}>
   133→              <label className="block text-sm font-medium text-text-primary mb-1.5">
   134→                {field.label}
   135→                {field.required && <span className="text-[var(--accent-primary)] ml-1">*</span>}
   136→              </label>
   137→              {renderField(field)}
   138→            </div>
   139→          );
   140→        })}
   141→
   142→        {allowTextInput && (
   143→          <div>
   144→            <label className="block text-sm font-medium text-text-primary mb-1.5">
   145→              补充说明（可选）
   146→            </label>
   147→            <textarea
   148→              className="w-full px-3 py-2.5 border border-orange-200 dark:border-orange-800 bg-white dark:bg-black/20 rounded-xl focus:ring-2 focus:ring-[var(--accent-primary)] focus:border-transparent resize-none text-text-primary text-sm"
   149→              rows={3}
   150→              placeholder={textInputPlaceholder}
   151→              value={textInput}
   152→              onChange={(e) => setTextInput(e.target.value)}
   153→            />
   154→          </div>
   155→        )}
   156→
   157→        <div className="flex gap-3 pt-4">
   158→          <button
   159→            type="submit"
   160→            className="flex-1 bg-[var(--accent-primary)] hover:bg-[var(--accent-hover)] text-white py-3 px-6 rounded-xl transition-all font-medium text-base shadow-lg shadow-orange-500/20 hover:shadow-orange-500/30"
   161→          >
   162→            开始分析
   163→          </button>
   164→          {onSkip && (
   165→            <button
   166→              type="button"
   167→              onClick={onSkip}
   168→              className="px-4 py-2 text-text-secondary hover:text-[var(--accent-primary)] transition-colors"
   169→            >
   170→              跳过
   171→            </button>
   172→          )}
   173→        </div>
   174→      </form>
   175→    </div>
   176→  );
   177→};
   178→
   179→export default CollectFormCard;
   180→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
