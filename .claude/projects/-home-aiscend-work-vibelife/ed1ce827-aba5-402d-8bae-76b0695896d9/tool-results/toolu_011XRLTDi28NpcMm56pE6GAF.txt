     1â†’"use client";
     2â†’
     3â†’/**
     4â†’ * AssessmentFormCard - å¿ƒç†è¯„ä¼°è¡¨å•å¡ç‰‡
     5â†’ *
     6â†’ * è®¾è®¡ç†å¿µï¼š
     7â†’ * - Glass morphism + æŸ”å’Œæ¸å˜ï¼Œå‡å°‘è¯„ä¼°ç„¦è™‘æ„Ÿ
     8â†’ * - æ¸…æ™°çš„è¿›åº¦æŒ‡ç¤ºï¼Œè®©ç”¨æˆ·æœ‰æŒæ§æ„Ÿ
     9â†’ * - æ¸©æš–çš„è§†è§‰è¯­è¨€ï¼Œä¸“ä¸šè€Œä¸å†·æ¼ 
    10â†’ * - æµç•…çš„åŠ¨ç”»è¿‡æ¸¡ï¼Œæå‡ä½“éªŒ
    11â†’ */
    12â†’
    13â†’import { useState } from "react";
    14â†’import { motion, AnimatePresence } from "framer-motion";
    15â†’import { registerCard } from "@/skills/CardRegistry";
    16â†’import { cn } from "@/lib/utils";
    17â†’import { ChevronLeft, ChevronRight, Send, CheckCircle2 } from "lucide-react";
    18â†’import {
    19â†’  cardVariants,
    20â†’  containerVariants,
    21â†’  itemVariants,
    22â†’  psychThemes,
    23â†’} from "../styles";
    24â†’
    25â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    26â†’// Types
    27â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    28â†’
    29â†’interface AssessmentItem {
    30â†’  id: number;
    31â†’  text: string;
    32â†’  critical?: boolean;
    33â†’  subscale?: string;
    34â†’}
    35â†’
    36â†’interface AssessmentFormData {
    37â†’  assessmentType: string;
    38â†’  name: string;
    39â†’  description: string;
    40â†’  recallPeriod: string;
    41â†’  items: AssessmentItem[];
    42â†’  responseScale: Record<string, string>;
    43â†’}
    44â†’
    45â†’interface AssessmentFormCardProps {
    46â†’  data: AssessmentFormData;
    47â†’  onSubmit?: (answer: string) => void;
    48â†’}
    49â†’
    50â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    51â†’// è¯„ä¼°ç±»å‹å›¾æ ‡æ˜ å°„
    52â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    53â†’
    54â†’const assessmentIcons: Record<string, string> = {
    55â†’  phq2: "ğŸ©º",
    56â†’  gad2: "ğŸ«€",
    57â†’  phq9: "ğŸ“‹",
    58â†’  gad7: "ğŸ“Š",
    59â†’  dass21: "ğŸ“ˆ",
    60â†’};
    61â†’
    62â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    63â†’// Main Component
    64â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    65â†’
    66â†’function AssessmentFormCard({ data, onSubmit }: AssessmentFormCardProps) {
    67â†’  const [responses, setResponses] = useState<Record<number, number>>({});
    68â†’  const [currentPage, setCurrentPage] = useState(0);
    69â†’
    70â†’  const itemsPerPage = 5;
    71â†’  const totalPages = Math.ceil(data.items.length / itemsPerPage);
    72â†’  const currentItems = data.items.slice(
    73â†’    currentPage * itemsPerPage,
    74â†’    (currentPage + 1) * itemsPerPage
    75â†’  );
    76â†’
    77â†’  const theme = psychThemes.default;
    78â†’  const icon = assessmentIcons[data.assessmentType] || "ğŸ“";
    79â†’  const completedCount = Object.keys(responses).length;
    80â†’  const progressPercentage = (completedCount / data.items.length) * 100;
    81â†’
    82â†’  const handleResponse = (itemId: number, value: number) => {
    83â†’    setResponses((prev) => ({ ...prev, [itemId]: value }));
    84â†’  };
    85â†’
    86â†’  const isPageComplete = () => {
    87â†’    return currentItems.every((item) => responses[item.id] !== undefined);
    88â†’  };
    89â†’
    90â†’  const isAllComplete = () => {
    91â†’    return data.items.every((item) => responses[item.id] !== undefined);
    92â†’  };
    93â†’
    94â†’  const handleNext = () => {
    95â†’    if (currentPage < totalPages - 1) {
    96â†’      setCurrentPage((prev) => prev + 1);
    97â†’    }
    98â†’  };
    99â†’
   100â†’  const handlePrev = () => {
   101â†’    if (currentPage > 0) {
   102â†’      setCurrentPage((prev) => prev - 1);
   103â†’    }
   104â†’  };
   105â†’
   106â†’  const handleSubmit = () => {
   107â†’    if (!isAllComplete() || !onSubmit) return;
   108â†’
   109â†’    const orderedResponses = data.items.map((item) => responses[item.id]);
   110â†’    onSubmit(
   111â†’      JSON.stringify({
   112â†’        action: "calculate_assessment",
   113â†’        assessment_type: data.assessmentType,
   114â†’        responses: orderedResponses,
   115â†’      })
   116â†’    );
   117â†’  };
   118â†’
   119â†’  const scaleOptions = Object.entries(data.responseScale).map(
   120â†’    ([value, label]) => ({
   121â†’      value: parseInt(value),
   122â†’      label,
   123â†’    })
   124â†’  );
   125â†’
   126â†’  return (
   127â†’    <motion.div
   128â†’      variants={cardVariants}
   129â†’      initial="hidden"
   130â†’      animate="visible"
   131â†’      className={cn(
   132â†’        "relative overflow-hidden rounded-2xl max-w-2xl mx-auto",
   133â†’        "bg-gradient-to-br",
   134â†’        theme.gradient,
   135â†’        theme.gradientDark,
   136â†’        theme.border,
   137â†’        "shadow-[0_4px_24px_-4px_rgba(0,0,0,0.08)]"
   138â†’      )}
   139â†’    >
   140â†’      {/* è£…é¥°æ€§èƒŒæ™¯å…ƒç´  */}
   141â†’      <div className="absolute top-0 right-0 w-40 h-40 bg-gradient-to-bl from-violet-200/30 to-transparent rounded-full blur-3xl -translate-y-1/2 translate-x-1/4" />
   142â†’      <div className="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-tr from-indigo-200/20 to-transparent rounded-full blur-2xl translate-y-1/2 -translate-x-1/4" />
   143â†’
   144â†’      {/* å¤´éƒ¨ */}
   145â†’      <div
   146â†’        className={cn(
   147â†’          "relative p-5 text-white",
   148â†’          "bg-gradient-to-r",
   149â†’          theme.header
   150â†’        )}
   151â†’      >
   152â†’        {/* å¤´éƒ¨è£…é¥° */}
   153â†’        <div className="absolute inset-0 bg-[radial-gradient(circle_at_top_right,rgba(255,255,255,0.15),transparent_50%)]" />
   154â†’
   155â†’        <div className="relative flex items-start gap-4">
   156â†’          {/* å›¾æ ‡ */}
   157â†’          <div className="flex-shrink-0 w-12 h-12 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center text-2xl">
   158â†’            {icon}
   159â†’          </div>
   160â†’
   161â†’          <div className="flex-1 min-w-0">
   162â†’            <h3 className="text-lg font-semibold mb-1">{data.name}</h3>
   163â†’            <p className="text-sm text-white/80 line-clamp-2">
   164â†’              {data.description}
   165â†’            </p>
   166â†’            <div className="flex items-center gap-2 mt-2">
   167â†’              <span className="px-2 py-0.5 bg-white/20 backdrop-blur-sm rounded-full text-xs">
   168â†’                {data.recallPeriod}
   169â†’              </span>
   170â†’              <span className="text-xs text-white/70">
   171â†’                å…± {data.items.length} é¢˜
   172â†’              </span>
   173â†’            </div>
   174â†’          </div>
   175â†’        </div>
   176â†’      </div>
   177â†’
   178â†’      {/* è¿›åº¦æ¡åŒºåŸŸ */}
   179â†’      <div className="relative px-5 py-3 bg-white/50 dark:bg-gray-900/50 backdrop-blur-sm border-b border-white/50 dark:border-gray-800/50">
   180â†’        <div className="flex items-center justify-between text-sm mb-2">
   181â†’          <div className="flex items-center gap-2">
   182â†’            <CheckCircle2 className="w-4 h-4 text-violet-500" />
   183â†’            <span className="text-gray-700 dark:text-gray-300">
   184â†’              å·²å®Œæˆ {completedCount} / {data.items.length} é¢˜
   185â†’            </span>
   186â†’          </div>
   187â†’          <span className="text-gray-500 dark:text-gray-400 text-xs">
   188â†’            ç¬¬ {currentPage + 1} / {totalPages} é¡µ
   189â†’          </span>
   190â†’        </div>
   191â†’
   192â†’        {/* è¿›åº¦æ¡ */}
   193â†’        <div className="h-2 bg-gray-200/70 dark:bg-gray-700/50 rounded-full overflow-hidden">
   194â†’          <motion.div
   195â†’            initial={{ width: 0 }}
   196â†’            animate={{ width: `${progressPercentage}%` }}
   197â†’            transition={{ duration: 0.4, ease: "easeOut" }}
   198â†’            className={cn(
   199â†’              "h-full rounded-full",
   200â†’              "bg-gradient-to-r",
   201â†’              theme.header
   202â†’            )}
   203â†’          />
   204â†’        </div>
   205â†’      </div>
   206â†’
   207â†’      {/* é¢˜ç›®åŒºåŸŸ */}
   208â†’      <motion.div
   209â†’        variants={containerVariants}
   210â†’        initial="hidden"
   211â†’        animate="visible"
   212â†’        key={currentPage}
   213â†’        className="relative p-5 space-y-4"
   214â†’      >
   215â†’        <AnimatePresence mode="wait">
   216â†’          {currentItems.map((item, index) => (
   217â†’            <motion.div
   218â†’              key={item.id}
   219â†’              variants={itemVariants}
   220â†’              className={cn(
   221â†’                "p-4 rounded-xl",
   222â†’                "bg-white/60 dark:bg-gray-800/40 backdrop-blur-sm",
   223â†’                "border",
   224â†’                item.critical
   225â†’                  ? "border-red-200/70 dark:border-red-800/50 bg-red-50/40 dark:bg-red-900/10"
   226â†’                  : "border-white/50 dark:border-gray-700/50"
   227â†’              )}
   228â†’            >
   229â†’              <div className="flex items-start gap-3 mb-3">
   230â†’                <span
   231â†’                  className={cn(
   232â†’                    "flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium",
   233â†’                    responses[item.id] !== undefined
   234â†’                      ? "bg-violet-500 text-white"
   235â†’                      : "bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400"
   236â†’                  )}
   237â†’                >
   238â†’                  {currentPage * itemsPerPage + index + 1}
   239â†’                </span>
   240â†’                <p className="text-sm font-medium text-gray-800 dark:text-gray-200 leading-relaxed">
   241â†’                  {item.text}
   242â†’                  {item.critical && (
   243â†’                    <span className="ml-1 text-red-500">*</span>
   244â†’                  )}
   245â†’                </p>
   246â†’              </div>
   247â†’
   248â†’              {/* é€‰é¡¹æŒ‰é’® */}
   249â†’              <div className="flex flex-wrap gap-2 pl-9">
   250â†’                {scaleOptions.map((option) => (
   251â†’                  <motion.button
   252â†’                    key={option.value}
   253â†’                    whileHover={{ scale: 1.02 }}
   254â†’                    whileTap={{ scale: 0.98 }}
   255â†’                    onClick={() => handleResponse(item.id, option.value)}
   256â†’                    className={cn(
   257â†’                      "px-3 py-2 text-sm rounded-lg transition-all duration-200",
   258â†’                      "border",
   259â†’                      responses[item.id] === option.value
   260â†’                        ? cn(
   261â†’                            "bg-gradient-to-r text-white border-transparent shadow-md",
   262â†’                            theme.header
   263â†’                          )
   264â†’                        : "bg-white/70 dark:bg-gray-800/70 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-violet-300 dark:hover:border-violet-600 hover:bg-violet-50 dark:hover:bg-violet-900/20"
   265â†’                    )}
   266â†’                  >
   267â†’                    {option.label}
   268â†’                  </motion.button>
   269â†’                ))}
   270â†’              </div>
   271â†’            </motion.div>
   272â†’          ))}
   273â†’        </AnimatePresence>
   274â†’      </motion.div>
   275â†’
   276â†’      {/* åº•éƒ¨å¯¼èˆª */}
   277â†’      <div className="relative p-4 bg-white/50 dark:bg-gray-900/50 backdrop-blur-sm border-t border-white/50 dark:border-gray-800/50 flex items-center justify-between">
   278â†’        <motion.button
   279â†’          whileHover={{ scale: 1.02 }}
   280â†’          whileTap={{ scale: 0.98 }}
   281â†’          onClick={handlePrev}
   282â†’          disabled={currentPage === 0}
   283â†’          className={cn(
   284â†’            "flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium transition-all",
   285â†’            currentPage === 0
   286â†’              ? "text-gray-400 cursor-not-allowed"
   287â†’              : "text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"
   288â†’          )}
   289â†’        >
   290â†’          <ChevronLeft className="w-4 h-4" />
   291â†’          ä¸Šä¸€é¡µ
   292â†’        </motion.button>
   293â†’
   294â†’        {currentPage === totalPages - 1 ? (
   295â†’          <motion.button
   296â†’            whileHover={{ scale: 1.02 }}
   297â†’            whileTap={{ scale: 0.98 }}
   298â†’            onClick={handleSubmit}
   299â†’            disabled={!isAllComplete()}
   300â†’            className={cn(
   301â†’              "flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-medium text-white transition-all",
   302â†’              isAllComplete()
   303â†’                ? cn("bg-gradient-to-r shadow-lg", theme.header)
   304â†’                : "bg-gray-300 dark:bg-gray-700 cursor-not-allowed"
   305â†’            )}
   306â†’          >
   307â†’            <Send className="w-4 h-4" />
   308â†’            æäº¤è¯„ä¼°
   309â†’          </motion.button>
   310â†’        ) : (
   311â†’          <motion.button
   312â†’            whileHover={{ scale: 1.02 }}
   313â†’            whileTap={{ scale: 0.98 }}
   314â†’            onClick={handleNext}
   315â†’            disabled={!isPageComplete()}
   316â†’            className={cn(
   317â†’              "flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium transition-all",
   318â†’              isPageComplete()
   319â†’                ? "bg-violet-500 text-white hover:bg-violet-600"
   320â†’                : "bg-gray-200 dark:bg-gray-700 text-gray-400 cursor-not-allowed"
   321â†’            )}
   322â†’          >
   323â†’            ä¸‹ä¸€é¡µ
   324â†’            <ChevronRight className="w-4 h-4" />
   325â†’          </motion.button>
   326â†’        )}
   327â†’      </div>
   328â†’    </motion.div>
   329â†’  );
   330â†’}
   331â†’
   332â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   333â†’// Skeleton
   334â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   335â†’
   336â†’export function AssessmentFormCardSkeleton() {
   337â†’  return (
   338â†’    <div
   339â†’      className={cn(
   340â†’        "relative overflow-hidden rounded-2xl max-w-2xl mx-auto animate-pulse",
   341â†’        "bg-gradient-to-br from-violet-50 via-purple-50/80 to-indigo-50/60",
   342â†’        "dark:from-violet-950/30 dark:via-purple-950/20 dark:to-indigo-950/20"
   343â†’      )}
   344â†’    >
   345â†’      {/* Header skeleton */}
   346â†’      <div className="p-5 bg-gradient-to-r from-violet-500/50 to-indigo-600/50">
   347â†’        <div className="flex items-start gap-4">
   348â†’          <div className="w-12 h-12 rounded-xl bg-white/30" />
   349â†’          <div className="flex-1 space-y-2">
   350â†’            <div className="h-5 bg-white/30 rounded w-3/4" />
   351â†’            <div className="h-4 bg-white/20 rounded w-full" />
   352â†’          </div>
   353â†’        </div>
   354â†’      </div>
   355â†’
   356â†’      {/* Progress skeleton */}
   357â†’      <div className="px-5 py-3 bg-white/30">
   358â†’        <div className="h-4 bg-gray-200 rounded w-1/3 mb-2" />
   359â†’        <div className="h-2 bg-gray-200 rounded-full" />
   360â†’      </div>
   361â†’
   362â†’      {/* Items skeleton */}
   363â†’      <div className="p-5 space-y-4">
   364â†’        {[1, 2, 3].map((i) => (
   365â†’          <div key={i} className="p-4 rounded-xl bg-white/40">
   366â†’            <div className="h-4 bg-gray-200 rounded w-full mb-3" />
   367â†’            <div className="flex gap-2 pl-9">
   368â†’              {[1, 2, 3, 4].map((j) => (
   369â†’                <div key={j} className="h-9 w-16 bg-gray-200 rounded-lg" />
   370â†’              ))}
   371â†’            </div>
   372â†’          </div>
   373â†’        ))}
   374â†’      </div>
   375â†’    </div>
   376â†’  );
   377â†’}
   378â†’
   379â†’// æ³¨å†Œå¡ç‰‡
   380â†’registerCard("assessment_form", AssessmentFormCard);
   381â†’
   382â†’export default AssessmentFormCard;
   383â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
