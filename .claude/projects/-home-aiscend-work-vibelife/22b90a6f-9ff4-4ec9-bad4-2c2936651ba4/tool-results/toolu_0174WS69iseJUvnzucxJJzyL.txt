The file /home/aiscend/.claude/plans/swift-herding-peacock.md has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
   183→```
   184→
   185→---
   186→
   187→## 三、实施方案
   188→
   189→### 3.1 增量处理机制：extraction_log.json
   190→
   191→**不再依赖数据库追踪**，改用文件系统日志：
   192→
   193→```json
   194→// /data/vibelife/knowledge/{skill}/extracted/extraction_log.json
   195→{
   196→  "skill_id": "bazi",
   197→  "prompt_version": 2,
   198→  "last_run": "2026-01-14T10:30:00Z",
   199→  "files": {
   200→    "manual/第六章_十神的深层心理与事件对应.md": {
   201→      "status": "extracted",
   202→      "md5": "abc123...",
   203→      "extracted_at": "2026-01-14T10:30:00Z",
   204→      "cases_count": 5,
   205→      "scenarios_count": 2
   206→    },
   207→    "《东方代码启示录》概念篇+八字教学基础版本.converted.md": {
   208→      "status": "pending",
   209→      "md5": "def456...",
   210→      "sections": [
   211→        {"name": "第一章", "status": "extracted"},
   212→        {"name": "第二章", "status": "pending"}
   213→      ]
   214→    }
   215→  }
   216→}
   217→```
   218→
   219→**增量逻辑**：
   220→1. 检查文件 MD5 是否变化 → 变化则需重新抽取
   221→2. 检查 prompt_version 是否更新 → 更新则全部重新抽取
   222→3. 只处理 status = "pending" 的文件/章节
   223→
   224→### 3.2 数据库 Schema 变更
   225→
   226→**cases 表新增字段**（追溯来源）：
   227→
   228→```sql
   229→-- 来源追溯（从 MD 文件）
   230→ALTER TABLE cases ADD COLUMN IF NOT EXISTS
   231→    source_file VARCHAR(255);      -- 源文件路径
   232→ALTER TABLE cases ADD COLUMN IF NOT EXISTS
   233→    source_section VARCHAR(255);   -- 源章节名称
   234→ALTER TABLE cases ADD COLUMN IF NOT EXISTS
   235→    quality_score FLOAT DEFAULT 0; -- 质量评分 0-1
   236→
   237→-- 索引
   238→CREATE INDEX IF NOT EXISTS idx_cases_source_file
   239→    ON cases(skill_id, source_file);
   240→CREATE INDEX IF NOT EXISTS idx_cases_status
   241→    ON cases(skill_id, status);
   242→```
   243→
   244→**scenario_index 表更新**（不再需要 scenario_candidates 表）：
   245→
   246→```sql
   247→-- Scenario 直接从文件加载，scenario_index 只存索引
   248→-- 无需数据库修改，但需要更新加载逻辑
   249→```
   250→
   251→### 3.2 统一抽取 Prompt 设计
   252→
   253→**新建文件**: `.claude/skills/vibelife-skill/templates/prompts/UNIFIED_EXTRACTION_PROMPT.md`