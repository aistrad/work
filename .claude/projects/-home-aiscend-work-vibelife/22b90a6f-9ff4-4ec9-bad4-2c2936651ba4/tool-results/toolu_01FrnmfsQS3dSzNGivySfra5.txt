The file /home/aiscend/work/vibelife/apps/api/scripts/build_knowledge.py has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
   188→        generator = ScenarioGenerator()
   189→        scenarios = await generator.generate_from_chunks(chunks, self.skill_id)
   190→        saved = await generator.save_candidates(scenarios)
   191→
   192→        logger.info(f"Stage 4b complete: {len(scenarios)} scenarios generated, {saved} saved")
   193→        return saved
   194→
   195→    async def run_stage_4(self, force_reextract: bool = False):
   196→        """
   197→        Stage 4: Unified Extraction from MD Files (recommended)
   198→
   199→        This is the new unified extraction that:
   200→        - Reads directly from /data/vibelife/knowledge/{skill}/converted/*.md
   201→        - Extracts both Cases and Scenarios in a single LLM call
   202→        - Supports incremental processing via MD5 hash tracking
   203→        - Outputs:
   204→          - Cases → cases table (status='pending')
   205→          - Scenarios → extracted/scenarios/*.md (candidates for review)
   206→
   207→        Args:
   208→            force_reextract: If True, reprocess all files regardless of MD5 status
   209→        """
   210→        logger.info("=" * 60)
   211→        logger.info("Stage 4: Unified Extraction (from MD files)")
   212→        logger.info("=" * 60)
   213→
   214→        from workers.unified_extractor import UnifiedExtractor
   215→
   216→        extractor = UnifiedExtractor(self.skill_id)
   217→        results = await extractor.process_pending_files(force_reextract=force_reextract)
   218→
   219→        logger.info(
   220→            f"Stage 4 complete: {results['cases_count']} cases, "
   221→            f"{results['scenarios_count']} scenarios from "
   222→            f"{results['files_processed']} files "
   223→            f"({results['files_skipped']} skipped)"
   224→        )
   225→        return results
   226→
   227→    async def run_stage_5(self, interactive: bool = True):
   228→        """Stage 5: Review & publish scenarios"""
   229→        logger.info("=" * 60)
   230→        logger.info("Stage 5: Scenario Review & Publish")
   231→        logger.info("=" * 60)