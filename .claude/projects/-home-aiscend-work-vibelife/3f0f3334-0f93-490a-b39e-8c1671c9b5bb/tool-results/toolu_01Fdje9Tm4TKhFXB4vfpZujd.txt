The file /home/aiscend/work/vibelife/apps/api/services/agent/core.py has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
   335→        system_prompt = await self._build_system_prompt(message, context)
   336→
   337→        messages = [LLMMessage(role="system", content=system_prompt)]
   338→
   339→        if context.history:
   340→            for msg in context.history[-10:]:
   341→                messages.append(LLMMessage(
   342→                    role=msg.get("role", "user"),
   343→                    content=msg.get("content", ""),
   344→                    tool_call_id=msg.get("tool_call_id"),
   345→                    tool_calls=msg.get("tool_calls")
   346→                ))
   347→
   348→        messages.append(LLMMessage(role="user", content=message))
   349→        return messages
   350→