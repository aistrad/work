The file /home/aiscend/work/vibelife/docs/archive/v8/ARCHITECTURE.md has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
   221→---
   222→
   223→## 5. 主动模块
   224→
   225→### 5.1 Proactive Engine
   226→
   227→主动触达用户，增强粘性和业务转化。通过 **VibeProfile** 统一管理用户订阅、推送偏好和提醒设置。
   228→
   229→**架构**：
   230→```
   231→每日 04:00 凌晨扫描
   232→    │
   233→    ▼
   234→┌─────────────────────────────────────────────────────────────┐
   235→│  ProactiveWorker.daily_scan()                                │
   236→│                                                              │
   237→│  1. 从 VibeProfile 获取所有 push_enabled 用户                │
   238→│     WHERE profile->'preferences'->'push_settings'->          │
   239→│           'push_enabled' = true                              │
   240→│                                                              │
   241→│  2. 为每个用户生成今日内容:                                  │
   242→│     • 检查 subscribed_skills，生成运势推送                   │
   243→│     • 检查 life_context.reminders，生成提醒推送              │
   244→│     • 检查 life_context.goals，生成目标进度推送              │
   245→│                                                              │
   246→│  3. 存入 notifications 表，标记 deliver_hour                 │
   247→│                                                              │
   248→└─────────────────────────────────────────────────────────────┘
   249→    │
   250→    ▼
   251→每小时投递 (00, 01, 02, ...)
   252→    │
   253→    ▼
   254→┌─────────────────────────────────────────────────────────────┐
   255→│  NotificationWorker.deliver()                                │
   256→│                                                              │
   257→│  SELECT * FROM notifications                                 │
   258→│  WHERE deliver_hour = current_hour AND delivered = false     │
   259→│                                                              │
   260→│  投递到用户设备                                              │
   261→└─────────────────────────────────────────────────────────────┘
   262→```
   263→
   264→**触发器类型**：
   265→| 类型 | 说明 | 数据来源 | 示例 |
   266→|------|------|---------|------|
   267→| time_based | 定时触发 | reminders.yaml | 每日运势 |
   268→| event_based | 事件触发 | VibeProfile.identity | 生日、节气 |
   269→| threshold_based | 阈值触发 | VibeProfile.state | 运势低于 40 分 |
   270→| emotion_based | 情绪触发 | VibeProfile.state | 检测到焦虑 |
   271→| skill_completion | 完成触发 | conversations | 深度对话后推荐 |
   272→| reminder_based | 用户提醒 | VibeProfile.life_context.reminders | 目标打卡、喝水 |
   273→
   274→**配置示例**（reminders.yaml）：
   275→```yaml
   276→skill_id: bazi
   277→enabled: true
   278→
   279→reminders:
   280→  - id: daily_fortune
   281→    name: 每日运势
   282→    trigger:
   283→      type: time_based
   284→      schedule: "0 4 * * *"
   285→    content:
   286→      generator: rules/daily-fortune.md
   287→      suggested_prompt: "想了解今天的运势详情？"
   288→      quick_actions:
   289→        - label: "今日宜忌"
   290→          prompt: "今天适合做什么？"
   291→```
   292→
   293→**用户提醒流程**（基于 VibeProfile）：
   294→```python
   295→# 每日扫描时检查用户的 reminders
   296→profile = await VibeProfileRepository.get_profile(user_id)
   297→reminders = profile.get("life_context", {}).get("reminders", [])
   298→
   299→for reminder in reminders:
   300→    if reminder["status"] != "active":
   301→        continue
   302→
   303→    # 检查今天是否应该触发
   304→    if should_trigger_today(reminder):
   305→        # 生成通知，在 trigger_hour 投递
   306→        await create_notification(
   307→            user_id=user_id,
   308→            type="reminder",
   309→            content=reminder["title"],
   310→            deliver_hour=reminder["trigger_hour"]
   311→        )
   312→```
   313→
   314→### 5.2 Skill Management
   315→
   316→让用户发现、订阅、管理 Skill 的完整系统。