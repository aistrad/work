   475→        "skill_id": skill_id,
   476→        "skill_name": metadata.get("name", skill_id),
   477→        "description": metadata.get("description", ""),
   478→        "services": services
   479→    }
   480→
   481→
   482→# ═══════════════════════════════════════════════════════════════════════════
   483→# 加载函数
   484→# ═══════════════════════════════════════════════════════════════════════════
   485→
   486→@lru_cache(maxsize=32)
   487→def load_skill(skill_id: str) -> Optional[SkillConfig]:
   488→    """加载 Skill 核心配置"""
   489→    skill_path = SKILLS_DIR / skill_id / "SKILL.md"
   490→    if not skill_path.exists():
   491→        return None
   492→
   493→    text = skill_path.read_text(encoding='utf-8')
   494→    data = parse_skill_md(text)
   495→
   496→    return SkillConfig(
   497→        id=data.get("id", skill_id),
   498→        name=data.get("name", skill_id),
   499→        description=data.get("description", ""),
   500→        expert_persona=data.get("expert_persona", ""),
   501→        scenarios=data.get("scenarios", {}),
   502→        ethics=data.get("ethics", {}),
   503→        tools=data.get("tools", []),
   504→        default_scenario=data.get("default_scenario", "basic_reading"),
   505→        triggers=data.get("triggers", []),
   506→        global_tools=data.get("global_tools", []),
   507→        # v7.1: SOP 配置驱动
   508→        requires_birth_info=data.get("requires_birth_info", False),
   509→        requires_compute=data.get("requires_compute", False),
   510→        compute_type=data.get("compute_type", None),
   511→        compute_tool=data.get("compute_tool", None),
   512→        collect_tool=data.get("collect_tool", None),
   513→        external_tools=data.get("external_tools", []),  # v7.3
   514→    )
   515→
   516→
   517→@lru_cache(maxsize=64)
   518→def load_scenario(skill_id: str, scenario_id: str) -> Optional[ScenarioConfig]:
   519→    """加载场景配置"""
   520→    scenario_path = SKILLS_DIR / skill_id / "scenarios" / f"{scenario_id}.md"
   521→    if not scenario_path.exists():
   522→        return None
   523→
   524→    text = scenario_path.read_text(encoding='utf-8')
   525→    data = parse_scenario_md(text)
   526→
   527→    return ScenarioConfig(
   528→        id=data.get("id", scenario_id),
   529→        name=data.get("name", scenario_id),
   530→        level=data.get("level", "entry"),
   531→        billing=data.get("billing", "free"),
   532→        description=data.get("description", ""),
   533→        triggers=data.get("triggers", {}),
   534→        prerequisites=data.get("prerequisites", []),
   535→        sop=data.get("sop", []),
   536→        knowledge_config=data.get("knowledge_config", {}),
   537→        output_config=data.get("output_config", {}),
   538→        tools=data.get("tools", [])
   539→    )
   540→
   541→
   542→@lru_cache(maxsize=128)
   543→def load_rule(skill_id: str, rule_id: str) -> Optional[RuleConfig]:
   544→    """加载规则配置 - v7 新增"""
   545→    rule_path = SKILLS_DIR / skill_id / "rules" / f"{rule_id}.md"
   546→    if not rule_path.exists():
   547→        return None
   548→
   549→    text = rule_path.read_text(encoding='utf-8')
   550→    data = parse_rule_md(text)
   551→
   552→    return RuleConfig(
   553→        id=data.get("id", rule_id),
   554→        name=data.get("name", rule_id),
   555→        impact=data.get("impact", "MEDIUM"),
   556→        impact_description=data.get("impact_description", ""),
   557→        tags=data.get("tags", []),
   558→        content=data.get("content", ""),
   559→        analysis_steps=data.get("analysis_steps", []),
   560→        output_requirements=data.get("output_requirements", ""),
   561→        common_questions=data.get("common_questions", ""),
   562→    )
   563→
   564→
   565→def get_skill_rules(skill_id: str) -> List[str]:
   566→    """获取 Skill 的所有规则 ID - v7 新增"""
   567→    rules_dir = SKILLS_DIR / skill_id / "rules"
   568→    if not rules_dir.exists():
   569→        return []
   570→    return [p.stem for p in rules_dir.glob("*.md") if not p.stem.startswith("_")]
   571→
   572→
   573→def has_rules(skill_id: str) -> bool:
   574→    """检查 Skill 是否使用 rules 架构 - v7 新增"""

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
