     1â†’# Skill Management API Reference
     2â†’
     3â†’> API ç«¯ç‚¹å®Œæ•´æ–‡æ¡£
     4â†’
     5â†’---
     6â†’
     7â†’## 1. ç«¯ç‚¹æ€»è§ˆ
     8â†’
     9â†’| æ–¹æ³• | ç«¯ç‚¹ | æè¿° | è®¤è¯ |
    10â†’|------|------|------|------|
    11â†’| GET | `/api/v1/skills` | è·å–æ‰€æœ‰ Skill åˆ—è¡¨ | å¯é€‰ |
    12â†’| GET | `/api/v1/skills/{skill_id}` | è·å–å•ä¸ª Skill è¯¦æƒ… | å¯é€‰ |
    13â†’| GET | `/api/v1/skills/subscriptions` | è·å–ç”¨æˆ·è®¢é˜…åˆ—è¡¨ | å¿…é¡» |
    14â†’| POST | `/api/v1/skills/{skill_id}/subscribe` | è®¢é˜… Skill | å¿…é¡» |
    15â†’| POST | `/api/v1/skills/{skill_id}/unsubscribe` | å–æ¶ˆè®¢é˜… Skill | å¿…é¡» |
    16â†’| POST | `/api/v1/skills/{skill_id}/push` | åˆ‡æ¢æ¨é€å¼€å…³ | å¿…é¡» |
    17â†’| GET | `/api/v1/skills/recommendations` | è·å–æ¨è Skill | å¿…é¡» |
    18â†’| GET | `/api/v1/skills/featured` | è·å–ç²¾é€‰ Skill | å¯é€‰ |
    19â†’
    20â†’---
    21â†’
    22â†’## 2. è·å–æ‰€æœ‰ Skill
    23â†’
    24â†’### GET /api/v1/skills
    25â†’
    26â†’è·å–æ‰€æœ‰å¯ç”¨ Skill åˆ—è¡¨ï¼ŒåŒ…å«å…ƒæ•°æ®å’Œç”¨æˆ·è®¢é˜…çŠ¶æ€ï¼ˆå¦‚å·²ç™»å½•ï¼‰ã€‚
    27â†’
    28â†’#### è¯·æ±‚
    29â†’
    30â†’```http
    31â†’GET /api/v1/skills HTTP/1.1
    32â†’Host: api.vibelife.app
    33â†’Authorization: Bearer {token}  # å¯é€‰
    34â†’```
    35â†’
    36â†’#### æŸ¥è¯¢å‚æ•°
    37â†’
    38â†’| å‚æ•° | ç±»å‹ | å¿…é¡» | æè¿° |
    39â†’|------|------|------|------|
    40â†’| `category` | string | å¦ | æŒ‰åˆ†ç±»ç­›é€‰: `core`, `default`, `professional` |
    41â†’| `subscribed` | boolean | å¦ | åªè¿”å›å·²è®¢é˜…çš„ Skill |
    42â†’
    43â†’#### å“åº”
    44â†’
    45â†’```json
    46â†’{
    47â†’  "skills": [
    48â†’    {
    49â†’      "id": "bazi",
    50â†’      "name": "å…«å­—å‘½ç†",
    51â†’      "description": "èæ±‡ã€Šæ»´å¤©é«“ã€‹ã€Šç©·é€šå®é‰´ã€‹ã€Šå­å¹³çœŸè¯ ã€‹ç­‰ç»å…¸çš„å…«å­—å‘½ç†å¤§å¸ˆ",
    52â†’      "icon": "ğŸ”®",
    53â†’      "color": "#D4A574",
    54â†’      "category": "professional",
    55â†’      "pricing": {
    56â†’        "type": "premium",
    57â†’        "trial_messages": 3
    58â†’      },
    59â†’      "features": [
    60â†’        {
    61â†’          "name": "å‘½ç›˜è§£è¯»",
    62â†’          "description": "å››æŸ±å…«å­—å®Œæ•´åˆ†æ",
    63â†’          "icon": "ğŸ“œ",
    64â†’          "tier": "free"
    65â†’        },
    66â†’        {
    67â†’          "name": "å¤§è¿æµå¹´",
    68â†’          "description": "åå¹´å¤§è¿å‘¨æœŸåˆ†æ",
    69â†’          "icon": "ğŸ“Š",
    70â†’          "tier": "basic"
    71â†’        }
    72â†’      ],
    73â†’      "showcase": {
    74â†’        "tagline": "æ´å¯Ÿå‘½è¿ç„æœºï¼ŒæŠŠæ¡äººç”Ÿæ–¹å‘",
    75â†’        "highlights": ["èæ±‡å››å¤§ç»å…¸", "ä¸ªæ€§åŒ–è§£è¯»", "è¿åŠ¿è¶‹åŠ¿åˆ†æ"],
    76â†’        "demo_prompts": ["å¸®æˆ‘çœ‹çœ‹å‘½ç›˜", "æˆ‘ä»Šå¹´è¿åŠ¿å¦‚ä½•"]
    77â†’      },
    78â†’      "triggers": ["å…«å­—", "å‘½ç†", "ç”Ÿè¾°", "æµ‹ç®—"],
    79â†’      "user_status": {
    80â†’        "subscribed": true,
    81â†’        "push_enabled": true,
    82â†’        "trial_messages_used": 0,
    83â†’        "trial_messages_remaining": 3
    84â†’      }
    85â†’    },
    86â†’    {
    87â†’      "id": "mindfulness",
    88â†’      "name": "æ­£å¿µå¯¼å¸ˆ",
    89â†’      "description": "3åˆ†é’Ÿå†…è®©ä½ å¹³é™ä¸‹æ¥",
    90â†’      "icon": "ğŸ§˜",
    91â†’      "color": "#10B981",
    92â†’      "category": "default",
    93â†’      "pricing": {
    94â†’        "type": "free"
    95â†’      },
    96â†’      "features": [
    97â†’        {
    98â†’          "name": "å‘¼å¸ç»ƒä¹ ",
    99â†’          "description": "åŸºç¡€å‘¼å¸é”šå®š",
   100â†’          "tier": "free"
   101â†’        }
   102â†’      ],
   103â†’      "showcase": {
   104â†’        "tagline": "3åˆ†é’Ÿå†…è®©ä½ å¹³é™ä¸‹æ¥",
   105â†’        "highlights": ["Headspace äº§å“ç²¾é«“", "æƒ…ç»ªæ€¥æ•‘å·¥å…·"]
   106â†’      },
   107â†’      "triggers": ["æ­£å¿µ", "å†¥æƒ³", "å‘¼å¸", "æ”¾æ¾"],
   108â†’      "user_status": {
   109â†’        "subscribed": true,
   110â†’        "push_enabled": true,
   111â†’        "trial_messages_used": 0,
   112â†’        "trial_messages_remaining": null
   113â†’      }
   114â†’    }
   115â†’  ],
   116â†’  "categories": {
   117â†’    "core": {
   118â†’      "name": "æ ¸å¿ƒèƒ½åŠ›",
   119â†’      "description": "å§‹ç»ˆæ¿€æ´»çš„åŸºç¡€èƒ½åŠ›",
   120â†’      "count": 1
   121â†’    },
   122â†’    "default": {
   123â†’      "name": "åŸºç¡€åŠŸèƒ½",
   124â†’      "description": "é»˜è®¤æ¿€æ´»ï¼Œå…è´¹ä½¿ç”¨",
   125â†’      "count": 2
   126â†’    },
   127â†’    "professional": {
   128â†’      "name": "ä¸“ä¸šæŠ€èƒ½",
   129â†’      "description": "éœ€è¦è®¢é˜…çš„é«˜çº§åŠŸèƒ½",
   130â†’      "count": 5
   131â†’    }
   132â†’  },
   133â†’  "total": 8
   134â†’}
   135â†’```
   136â†’
   137â†’#### é”™è¯¯å“åº”
   138â†’
   139â†’| çŠ¶æ€ç  | æè¿° |
   140â†’|--------|------|
   141â†’| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |
   142â†’
   143â†’---
   144â†’
   145â†’## 3. è·å–å•ä¸ª Skill è¯¦æƒ…
   146â†’
   147â†’### GET /api/v1/skills/{skill_id}
   148â†’
   149â†’è·å–æŒ‡å®š Skill çš„å®Œæ•´è¯¦æƒ…ã€‚
   150â†’
   151â†’#### è¯·æ±‚
   152â†’
   153â†’```http
   154â†’GET /api/v1/skills/bazi HTTP/1.1
   155â†’Host: api.vibelife.app
   156â†’Authorization: Bearer {token}  # å¯é€‰
   157â†’```
   158â†’
   159â†’#### è·¯å¾„å‚æ•°
   160â†’
   161â†’| å‚æ•° | ç±»å‹ | æè¿° |
   162â†’|------|------|------|
   163â†’| `skill_id` | string | Skill ID |
   164â†’
   165â†’#### å“åº”
   166â†’
   167â†’```json
   168â†’{
   169â†’  "skill": {
   170â†’    "id": "bazi",
   171â†’    "name": "å…«å­—å‘½ç†",
   172â†’    "version": "3.0.0",
   173â†’    "description": "èæ±‡ã€Šæ»´å¤©é«“ã€‹ã€Šç©·é€šå®é‰´ã€‹ã€Šå­å¹³çœŸè¯ ã€‹ç­‰ç»å…¸çš„å…«å­—å‘½ç†å¤§å¸ˆ",
   174â†’    "icon": "ğŸ”®",
   175â†’    "color": "#D4A574",
   176â†’    "category": "professional",
   177â†’    "pricing": {
   178â†’      "type": "premium",
   179â†’      "trial_messages": 3
   180â†’    },
   181â†’    "requires_birth_info": true,
   182â†’    "requires_compute": true,
   183â†’    "features": [
   184â†’      {
   185â†’        "name": "å‘½ç›˜è§£è¯»",
   186â†’        "description": "å››æŸ±å…«å­—å®Œæ•´åˆ†æ",
   187â†’        "icon": "ğŸ“œ",
   188â†’        "tier": "free"
   189â†’      },
   190â†’      {
   191â†’        "name": "å¤§è¿æµå¹´",
   192â†’        "description": "åå¹´å¤§è¿å‘¨æœŸåˆ†æ",
   193â†’        "icon": "ğŸ“Š",
   194â†’        "tier": "basic"
   195â†’      },
   196â†’      {
   197â†’        "name": "æ¯æ—¥è¿åŠ¿",
   198â†’        "description": "åŸºäºæµæ—¥çš„æ¯æ—¥æŒ‡å¼•",
   199â†’        "icon": "ğŸŒŸ",
   200â†’        "tier": "premium"
   201â†’      }
   202â†’    ],
   203â†’    "showcase": {
   204â†’      "tagline": "æ´å¯Ÿå‘½è¿ç„æœºï¼ŒæŠŠæ¡äººç”Ÿæ–¹å‘",
   205â†’      "highlights": ["èæ±‡å››å¤§ç»å…¸", "ä¸ªæ€§åŒ–è§£è¯»", "è¿åŠ¿è¶‹åŠ¿åˆ†æ"],
   206â†’      "preview_image": "/skills/bazi/preview.png",
   207â†’      "demo_prompts": ["å¸®æˆ‘çœ‹çœ‹å‘½ç›˜", "æˆ‘ä»Šå¹´è¿åŠ¿å¦‚ä½•", "ä»€ä¹ˆæ—¶å€™é€‚åˆè·³æ§½"],
   208â†’      "testimonials": [
   209â†’        {
   210â†’          "content": "åˆ†æå¾ˆå‡†ç¡®ï¼Œå¯¹æˆ‘çš„èŒä¸šé€‰æ‹©å¾ˆæœ‰å¸®åŠ©",
   211â†’          "author": "ç”¨æˆ·A"
   212â†’        }
   213â†’      ]
   214â†’    },
   215â†’    "triggers": ["å…«å­—", "å‘½ç†", "ç”Ÿè¾°", "æµ‹ç®—", "ç®—å‘½", "å‘½ç›˜"],
   216â†’    "services": [
   217â†’      {
   218â†’        "name": "chart",
   219â†’        "description": "è®¡ç®—å…«å­—å‘½ç›˜"
   220â†’      },
   221â†’      {
   222â†’        "name": "fortune",
   223â†’        "description": "è¿åŠ¿åˆ†æ"
   224â†’      },
   225â†’      {
   226â†’        "name": "daily",
   227â†’        "description": "æ¯æ—¥è¿åŠ¿"
   228â†’      }
   229â†’    ]
   230â†’  },
   231â†’  "user_status": {
   232â†’    "subscribed": true,
   233â†’    "push_enabled": true,
   234â†’    "subscribed_at": "2026-01-15T10:30:00Z",
   235â†’    "trial_messages_used": 0,
   236â†’    "trial_messages_remaining": 3,
   237â†’    "last_used_at": "2026-01-19T08:00:00Z"
   238â†’  }
   239â†’}
   240â†’```
   241â†’
   242â†’#### é”™è¯¯å“åº”
   243â†’
   244â†’| çŠ¶æ€ç  | æè¿° |
   245â†’|--------|------|
   246â†’| 404 | Skill ä¸å­˜åœ¨ |
   247â†’
   248â†’---
   249â†’
   250â†’## 4. è·å–ç”¨æˆ·è®¢é˜…åˆ—è¡¨
   251â†’
   252â†’### GET /api/v1/skills/subscriptions
   253â†’
   254â†’è·å–å½“å‰ç”¨æˆ·çš„æ‰€æœ‰ Skill è®¢é˜…çŠ¶æ€ã€‚
   255â†’
   256â†’#### è¯·æ±‚
   257â†’
   258â†’```http
   259â†’GET /api/v1/skills/subscriptions HTTP/1.1
   260â†’Host: api.vibelife.app
   261â†’Authorization: Bearer {token}
   262â†’```
   263â†’
   264â†’#### å“åº”
   265â†’
   266â†’```json
   267â†’{
   268â†’  "subscriptions": [
   269â†’    {
   270â†’      "skill_id": "core",
   271â†’      "status": "subscribed",
   272â†’      "push_enabled": true,
   273â†’      "subscribed_at": null,
   274â†’      "can_unsubscribe": false,
   275â†’      "trial_messages_used": 0
   276â†’    },
   277â†’    {
   278â†’      "skill_id": "bazi",
   279â†’      "status": "subscribed",
   280â†’      "push_enabled": true,
   281â†’      "subscribed_at": "2026-01-15T10:30:00Z",
   282â†’      "can_unsubscribe": true,
   283â†’      "trial_messages_used": 2
   284â†’    },
   285â†’    {
   286â†’      "skill_id": "mindfulness",
   287â†’      "status": "subscribed",
   288â†’      "push_enabled": false,
   289â†’      "subscribed_at": "2026-01-01T00:00:00Z",
   290â†’      "can_unsubscribe": true,
   291â†’      "trial_messages_used": 0
   292â†’    },
   293â†’    {
   294â†’      "skill_id": "zodiac",
   295â†’      "status": "not_subscribed",
   296â†’      "push_enabled": false,
   297â†’      "subscribed_at": null,
   298â†’      "can_unsubscribe": true,
   299â†’      "trial_messages_used": 1
   300â†’    }
   301â†’  ],
   302â†’  "summary": {
   303â†’    "total_subscribed": 3,
   304â†’    "total_available": 5,
   305â†’    "push_enabled_count": 2
   306â†’  }
   307â†’}
   308â†’```
   309â†’
   310â†’#### é”™è¯¯å“åº”
   311â†’
   312â†’| çŠ¶æ€ç  | æè¿° |
   313â†’|--------|------|
   314â†’| 401 | æœªè®¤è¯ |
   315â†’
   316â†’---
   317â†’
   318â†’## 5. è®¢é˜… Skill
   319â†’
   320â†’### POST /api/v1/skills/{skill_id}/subscribe
   321â†’
   322â†’è®¢é˜…æŒ‡å®š Skillã€‚
   323â†’
   324â†’#### è¯·æ±‚
   325â†’
   326â†’```http
   327â†’POST /api/v1/skills/bazi/subscribe HTTP/1.1
   328â†’Host: api.vibelife.app
   329â†’Authorization: Bearer {token}
   330â†’Content-Type: application/json
   331â†’
   332â†’{
   333â†’  "push_enabled": true
   334â†’}
   335â†’```
   336â†’
   337â†’#### è·¯å¾„å‚æ•°
   338â†’
   339â†’| å‚æ•° | ç±»å‹ | æè¿° |
   340â†’|------|------|------|
   341â†’| `skill_id` | string | Skill ID |
   342â†’
   343â†’#### è¯·æ±‚ä½“
   344â†’
   345â†’| å­—æ®µ | ç±»å‹ | å¿…é¡» | æè¿° |
   346â†’|------|------|------|------|
   347â†’| `push_enabled` | boolean | å¦ | æ˜¯å¦å¼€å¯æ¨é€ï¼Œé»˜è®¤ true |
   348â†’
   349â†’#### å“åº”
   350â†’
   351â†’```json
   352â†’{
   353â†’  "success": true,
   354â†’  "subscription": {
   355â†’    "skill_id": "bazi",
   356â†’    "status": "subscribed",
   357â†’    "push_enabled": true,
   358â†’    "subscribed_at": "2026-01-19T10:30:00Z",
   359â†’    "trial_messages_remaining": 3
   360â†’  },
   361â†’  "message": "å·²æˆåŠŸè®¢é˜…ã€Œå…«å­—å‘½ç†ã€"
   362â†’}
   363â†’```
   364â†’
   365â†’#### é”™è¯¯å“åº”
   366â†’
   367â†’| çŠ¶æ€ç  | æè¿° |
   368â†’|--------|------|
   369â†’| 400 | å·²ç»è®¢é˜…è¯¥ Skill |
   370â†’| 401 | æœªè®¤è¯ |
   371â†’| 402 | éœ€è¦ Premium è®¢é˜… |
   372â†’| 404 | Skill ä¸å­˜åœ¨ |
   373â†’
   374â†’---
   375â†’
   376â†’## 6. å–æ¶ˆè®¢é˜… Skill
   377â†’
   378â†’### POST /api/v1/skills/{skill_id}/unsubscribe
   379â†’
   380â†’å–æ¶ˆè®¢é˜…æŒ‡å®š Skillã€‚
   381â†’
   382â†’#### è¯·æ±‚
   383â†’
   384â†’```http
   385â†’POST /api/v1/skills/bazi/unsubscribe HTTP/1.1
   386â†’Host: api.vibelife.app
   387â†’Authorization: Bearer {token}
   388â†’```
   389â†’
   390â†’#### è·¯å¾„å‚æ•°
   391â†’
   392â†’| å‚æ•° | ç±»å‹ | æè¿° |
   393â†’|------|------|------|
   394â†’| `skill_id` | string | Skill ID |
   395â†’
   396â†’#### å“åº”
   397â†’
   398â†’```json
   399â†’{
   400â†’  "success": true,
   401â†’  "subscription": {
   402â†’    "skill_id": "bazi",
   403â†’    "status": "unsubscribed",
   404â†’    "push_enabled": false,
   405â†’    "unsubscribed_at": "2026-01-19T10:30:00Z"
   406â†’  },
   407â†’  "message": "å·²å–æ¶ˆè®¢é˜…ã€Œå…«å­—å‘½ç†ã€"
   408â†’}
   409â†’```
   410â†’
   411â†’#### é”™è¯¯å“åº”
   412â†’
   413â†’| çŠ¶æ€ç  | æè¿° |
   414â†’|--------|------|
   415â†’| 400 | æœªè®¢é˜…è¯¥ Skill |
   416â†’| 400 | Core Skill ä¸å¯å–æ¶ˆè®¢é˜… |
   417â†’| 401 | æœªè®¤è¯ |
   418â†’| 404 | Skill ä¸å­˜åœ¨ |
   419â†’
   420â†’---
   421â†’
   422â†’## 7. åˆ‡æ¢æ¨é€å¼€å…³
   423â†’
   424â†’### POST /api/v1/skills/{skill_id}/push
   425â†’
   426â†’åˆ‡æ¢æŒ‡å®š Skill çš„æ¨é€å¼€å…³ã€‚
   427â†’
   428â†’#### è¯·æ±‚
   429â†’
   430â†’```http
   431â†’POST /api/v1/skills/bazi/push HTTP/1.1
   432â†’Host: api.vibelife.app
   433â†’Authorization: Bearer {token}
   434â†’Content-Type: application/json
   435â†’
   436â†’{
   437â†’  "enabled": false
   438â†’}
   439â†’```
   440â†’
   441â†’#### è·¯å¾„å‚æ•°
   442â†’
   443â†’| å‚æ•° | ç±»å‹ | æè¿° |
   444â†’|------|------|------|
   445â†’| `skill_id` | string | Skill ID |
   446â†’
   447â†’#### è¯·æ±‚ä½“
   448â†’
   449â†’| å­—æ®µ | ç±»å‹ | å¿…é¡» | æè¿° |
   450â†’|------|------|------|------|
   451â†’| `enabled` | boolean | æ˜¯ | æ˜¯å¦å¼€å¯æ¨é€ |
   452â†’
   453â†’#### å“åº”
   454â†’
   455â†’```json
   456â†’{
   457â†’  "success": true,
   458â†’  "subscription": {
   459â†’    "skill_id": "bazi",
   460â†’    "push_enabled": false
   461â†’  },
   462â†’  "message": "å·²å…³é—­ã€Œå…«å­—å‘½ç†ã€çš„æ¨é€é€šçŸ¥"
   463â†’}
   464â†’```
   465â†’
   466â†’#### é”™è¯¯å“åº”
   467â†’
   468â†’| çŠ¶æ€ç  | æè¿° |
   469â†’|--------|------|
   470â†’| 400 | æœªè®¢é˜…è¯¥ Skill |
   471â†’| 401 | æœªè®¤è¯ |
   472â†’| 404 | Skill ä¸å­˜åœ¨ |
   473â†’
   474â†’---
   475â†’
   476â†’## 8. è·å–æ¨è Skill
   477â†’
   478â†’### GET /api/v1/skills/recommendations
   479â†’
   480â†’åŸºäºç”¨æˆ·æ¡£æ¡ˆå’Œå¯¹è¯å†å²æ¨è Skillã€‚
   481â†’
   482â†’#### è¯·æ±‚
   483â†’
   484â†’```http
   485â†’GET /api/v1/skills/recommendations?limit=3&context=relationship HTTP/1.1
   486â†’Host: api.vibelife.app
   487â†’Authorization: Bearer {token}
   488â†’```
   489â†’
   490â†’#### æŸ¥è¯¢å‚æ•°
   491â†’
   492â†’| å‚æ•° | ç±»å‹ | å¿…é¡» | æè¿° |
   493â†’|------|------|------|------|
   494â†’| `limit` | integer | å¦ | è¿”å›æ•°é‡ï¼Œé»˜è®¤ 3ï¼Œæœ€å¤§ 10 |
   495â†’| `context` | string | å¦ | å½“å‰å¯¹è¯ä¸Šä¸‹æ–‡ï¼ˆå…³é”®è¯ï¼‰ |
   496â†’
   497â†’#### å“åº”
   498â†’
   499â†’```json
   500â†’{
   501â†’  "recommendations": [
   502â†’    {
   503â†’      "skill_id": "zodiac",
   504â†’      "skill": {
   505â†’        "id": "zodiac",
   506â†’        "name": "è¥¿æ–¹å æ˜Ÿ",
   507â†’        "icon": "â­",
   508â†’        "color": "#8B5CF6",
   509â†’        "tagline": "æ˜Ÿç›˜è§£è¯»ï¼Œæ­ç¤ºå†…åœ¨æ„å›¾"
   510â†’      },
   511â†’      "reason": "based_on_conversation",
   512â†’      "context": "ä½ æåˆ°äº†äººé™…å…³ç³»çš„å›°æ‰°ã€‚æ˜Ÿåº§åˆç›˜åˆ†æå¯ä»¥å¸®ä½ ç†è§£ä½ ä»¬ä¹‹é—´çš„åŠ¨åŠ›æ¨¡å¼ã€‚",
   513â†’      "score": 0.85,
   514â†’      "trial_messages_remaining": 3
   515â†’    },
   516â†’    {
   517â†’      "skill_id": "mindfulness",
   518â†’      "skill": {
   519â†’        "id": "mindfulness",
   520â†’        "name": "æ­£å¿µå¯¼å¸ˆ",
   521â†’        "icon": "ğŸ§˜",
   522â†’        "color": "#10B981",
   523â†’        "tagline": "3åˆ†é’Ÿå†…è®©ä½ å¹³é™ä¸‹æ¥"
   524â†’      },
   525â†’      "reason": "based_on_emotion",
   526â†’      "context": "æ„ŸçŸ¥åˆ°ä½ å¯èƒ½æœ‰äº›ç„¦è™‘ï¼Œæ­£å¿µç»ƒä¹ å¯ä»¥å¸®åŠ©æ”¾æ¾ã€‚",
   527â†’      "score": 0.72,
   528â†’      "trial_messages_remaining": null
   529â†’    }
   530â†’  ],
   531â†’  "generated_at": "2026-01-19T10:30:00Z"
   532â†’}
   533â†’```
   534â†’
   535â†’#### æ¨èåŸå› 
   536â†’
   537â†’| reason | æè¿° |
   538â†’|--------|------|
   539â†’| `based_on_conversation` | åŸºäºå¯¹è¯å†…å®¹å…³é”®è¯åŒ¹é… |
   540â†’| `based_on_emotion` | åŸºäºæƒ…ç»ªæ£€æµ‹ |
   541â†’| `based_on_profile` | åŸºäºç”¨æˆ·æ¡£æ¡ˆ |
   542â†’| `based_on_usage` | åŸºäºä½¿ç”¨å†å² |
   543â†’| `featured` | å¹³å°ç²¾é€‰æ¨è |
   544â†’
   545â†’#### é”™è¯¯å“åº”
   546â†’
   547â†’| çŠ¶æ€ç  | æè¿° |
   548â†’|--------|------|
   549â†’| 401 | æœªè®¤è¯ |
   550â†’
   551â†’---
   552â†’
   553â†’## 9. è·å–ç²¾é€‰ Skill
   554â†’
   555â†’### GET /api/v1/skills/featured
   556â†’
   557â†’è·å–å¹³å°ç²¾é€‰ Skill åˆ—è¡¨ï¼ˆç”¨äºé¦–é¡µè½®æ’­ç­‰ï¼‰ã€‚
   558â†’
   559â†’#### è¯·æ±‚
   560â†’
   561â†’```http
   562â†’GET /api/v1/skills/featured HTTP/1.1
   563â†’Host: api.vibelife.app
   564â†’```
   565â†’
   566â†’#### å“åº”
   567â†’
   568â†’```json
   569â†’{
   570â†’  "featured": [
   571â†’    {
   572â†’      "skill_id": "bazi",
   573â†’      "skill": {
   574â†’        "id": "bazi",
   575â†’        "name": "å…«å­—å‘½ç†",
   576â†’        "icon": "ğŸ”®",
   577â†’        "color": "#D4A574",
   578â†’        "tagline": "æ´å¯Ÿå‘½è¿ç„æœºï¼ŒæŠŠæ¡äººç”Ÿæ–¹å‘",
   579â†’        "preview_image": "/skills/bazi/featured.png"
   580â†’      },
   581â†’      "position": 1,
   582â†’      "campaign": null
   583â†’    },
   584â†’    {
   585â†’      "skill_id": "tarot",
   586â†’      "skill": {
   587â†’        "id": "tarot",
   588â†’        "name": "å¡”ç½—å åœ",
   589â†’        "icon": "ğŸ´",
   590â†’        "color": "#EC4899",
   591â†’        "tagline": "ç…§è§å†…å¿ƒï¼Œè·å–æŒ‡å¼•"
   592â†’      },
   593â†’      "position": 2,
   594â†’      "campaign": {
   595â†’        "title": "æ–°å¹´é™æ—¶ä½“éªŒ",
   596â†’        "badge": "é™æ—¶å…è´¹"
   597â†’      }
   598â†’    }
   599â†’  ]
   600â†’}
   601â†’```
   602â†’
   603â†’---
   604â†’
   605â†’## 10. åç«¯å®ç°å‚è€ƒ
   606â†’
   607â†’### 10.1 è·¯ç”±æ–‡ä»¶
   608â†’
   609â†’```python
   610â†’# routes/skills.py
   611â†’
   612â†’from fastapi import APIRouter, Depends, HTTPException, Query
   613â†’from typing import Optional, List
   614â†’from pydantic import BaseModel
   615â†’
   616â†’from services.agent.skill_loader import SkillLoader
   617â†’from stores.skill_subscription_repo import SkillSubscriptionRepo
   618â†’from services.skill_recommendation import SkillRecommendationService
   619â†’from middleware.auth import get_current_user, get_optional_user
   620â†’
   621â†’router = APIRouter(prefix="/api/v1/skills", tags=["skills"])
   622â†’
   623â†’
   624â†’class SubscribeRequest(BaseModel):
   625â†’    push_enabled: bool = True
   626â†’
   627â†’
   628â†’class PushToggleRequest(BaseModel):
   629â†’    enabled: bool
   630â†’
   631â†’
   632â†’@router.get("")
   633â†’async def list_skills(
   634â†’    category: Optional[str] = None,
   635â†’    subscribed: Optional[bool] = None,
   636â†’    user=Depends(get_optional_user),
   637â†’):
   638â†’    """è·å–æ‰€æœ‰ Skill åˆ—è¡¨"""
   639â†’    skills = SkillLoader.get_all_skills()
   640â†’
   641â†’    # ç­›é€‰
   642â†’    if category:
   643â†’        skills = [s for s in skills if s["category"] == category]
   644â†’
   645â†’    # è·å–ç”¨æˆ·è®¢é˜…çŠ¶æ€
   646â†’    user_statuses = {}
   647â†’    if user:
   648â†’        subscriptions = await SkillSubscriptionRepo.get_user_subscriptions(user.id)
   649â†’        user_statuses = {s.skill_id: s for s in subscriptions}
   650â†’
   651â†’        if subscribed:
   652â†’            skills = [s for s in skills if user_statuses.get(s["id"], {}).get("status") == "subscribed"]
   653â†’
   654â†’    # é™„åŠ ç”¨æˆ·çŠ¶æ€
   655â†’    for skill in skills:
   656â†’        sub = user_statuses.get(skill["id"])
   657â†’        skill["user_status"] = {
   658â†’            "subscribed": sub.status == "subscribed" if sub else False,
   659â†’            "push_enabled": sub.push_enabled if sub else False,
   660â†’            "trial_messages_used": sub.trial_messages_used if sub else 0,
   661â†’            "trial_messages_remaining": (
   662â†’                skill["pricing"].get("trial_messages", 0) - (sub.trial_messages_used if sub else 0)
   663â†’            ) if skill["pricing"]["type"] != "free" else None,
   664â†’        }
   665â†’
   666â†’    # åˆ†ç±»ç»Ÿè®¡
   667â†’    categories = {
   668â†’        "core": {"name": "æ ¸å¿ƒèƒ½åŠ›", "count": len([s for s in skills if s["category"] == "core"])},
   669â†’        "default": {"name": "åŸºç¡€åŠŸèƒ½", "count": len([s for s in skills if s["category"] == "default"])},
   670â†’        "professional": {"name": "ä¸“ä¸šæŠ€èƒ½", "count": len([s for s in skills if s["category"] == "professional"])},
   671â†’    }
   672â†’
   673â†’    return {"skills": skills, "categories": categories, "total": len(skills)}
   674â†’
   675â†’
   676â†’@router.get("/subscriptions")
   677â†’async def get_subscriptions(user=Depends(get_current_user)):
   678â†’    """è·å–ç”¨æˆ·è®¢é˜…åˆ—è¡¨"""
   679â†’    subscriptions = await SkillSubscriptionRepo.get_user_subscriptions(user.id)
   680â†’
   681â†’    # è·å– Skill å…ƒæ•°æ®
   682â†’    all_skills = SkillLoader.get_all_skills()
   683â†’    skill_map = {s["id"]: s for s in all_skills}
   684â†’
   685â†’    result = []
   686â†’    for skill in all_skills:
   687â†’        sub = next((s for s in subscriptions if s.skill_id == skill["id"]), None)
   688â†’        result.append({
   689â†’            "skill_id": skill["id"],
   690â†’            "status": sub.status if sub else "not_subscribed",
   691â†’            "push_enabled": sub.push_enabled if sub else False,
   692â†’            "subscribed_at": sub.subscribed_at if sub else None,
   693â†’            "can_unsubscribe": skill["category"] != "core",
   694â†’            "trial_messages_used": sub.trial_messages_used if sub else 0,
   695â†’        })
   696â†’
   697â†’    return {
   698â†’        "subscriptions": result,
   699â†’        "summary": {
   700â†’            "total_subscribed": len([s for s in result if s["status"] == "subscribed"]),
   701â†’            "total_available": len(all_skills),
   702â†’            "push_enabled_count": len([s for s in result if s["push_enabled"]]),
   703â†’        }
   704â†’    }
   705â†’
   706â†’
   707â†’@router.post("/{skill_id}/subscribe")
   708â†’async def subscribe_skill(
   709â†’    skill_id: str,
   710â†’    request: SubscribeRequest,
   711â†’    user=Depends(get_current_user),
   712â†’):
   713â†’    """è®¢é˜… Skill"""
   714â†’    skill = SkillLoader.get_skill(skill_id)
   715â†’    if not skill:
   716â†’        raise HTTPException(status_code=404, detail="Skill not found")
   717â†’
   718â†’    # æ£€æŸ¥æ˜¯å¦å·²è®¢é˜…
   719â†’    existing = await SkillSubscriptionRepo.get(user.id, skill_id)
   720â†’    if existing and existing.status == "subscribed":
   721â†’        raise HTTPException(status_code=400, detail="Already subscribed")
   722â†’
   723â†’    # æ£€æŸ¥æ˜¯å¦éœ€è¦ Premium
   724â†’    if skill["pricing"]["type"] == "premium" and not user.is_premium:
   725â†’        # æ£€æŸ¥è¯•ç”¨æ¬¡æ•°
   726â†’        trial_used = existing.trial_messages_used if existing else 0
   727â†’        trial_limit = skill["pricing"].get("trial_messages", 0)
   728â†’        if trial_used >= trial_limit:
   729â†’            raise HTTPException(status_code=402, detail="Premium subscription required")
   730â†’
   731â†’    # åˆ›å»º/æ›´æ–°è®¢é˜…
   732â†’    subscription = await SkillSubscriptionRepo.subscribe(
   733â†’        user_id=user.id,
   734â†’        skill_id=skill_id,
   735â†’        push_enabled=request.push_enabled,
   736â†’    )
   737â†’
   738â†’    return {
   739â†’        "success": True,
   740â†’        "subscription": subscription,
   741â†’        "message": f"å·²æˆåŠŸè®¢é˜…ã€Œ{skill['name']}ã€",
   742â†’    }
   743â†’
   744â†’
   745â†’@router.post("/{skill_id}/unsubscribe")
   746â†’async def unsubscribe_skill(skill_id: str, user=Depends(get_current_user)):
   747â†’    """å–æ¶ˆè®¢é˜… Skill"""
   748â†’    skill = SkillLoader.get_skill(skill_id)
   749â†’    if not skill:
   750â†’        raise HTTPException(status_code=404, detail="Skill not found")
   751â†’
   752â†’    # Core Skill ä¸å¯å–æ¶ˆ
   753â†’    if skill["category"] == "core":
   754â†’        raise HTTPException(status_code=400, detail="Core skill cannot be unsubscribed")
   755â†’
   756â†’    # æ£€æŸ¥æ˜¯å¦å·²è®¢é˜…
   757â†’    existing = await SkillSubscriptionRepo.get(user.id, skill_id)
   758â†’    if not existing or existing.status != "subscribed":
   759â†’        raise HTTPException(status_code=400, detail="Not subscribed")
   760â†’
   761â†’    # æ›´æ–°è®¢é˜…
   762â†’    subscription = await SkillSubscriptionRepo.unsubscribe(user.id, skill_id)
   763â†’
   764â†’    return {
   765â†’        "success": True,
   766â†’        "subscription": subscription,
   767â†’        "message": f"å·²å–æ¶ˆè®¢é˜…ã€Œ{skill['name']}ã€",
   768â†’    }
   769â†’
   770â†’
   771â†’@router.post("/{skill_id}/push")
   772â†’async def toggle_push(
   773â†’    skill_id: str,
   774â†’    request: PushToggleRequest,
   775â†’    user=Depends(get_current_user),
   776â†’):
   777â†’    """åˆ‡æ¢æ¨é€å¼€å…³"""
   778â†’    skill = SkillLoader.get_skill(skill_id)
   779â†’    if not skill:
   780â†’        raise HTTPException(status_code=404, detail="Skill not found")
   781â†’
   782â†’    # æ£€æŸ¥æ˜¯å¦å·²è®¢é˜…
   783â†’    existing = await SkillSubscriptionRepo.get(user.id, skill_id)
   784â†’    if not existing or existing.status != "subscribed":
   785â†’        raise HTTPException(status_code=400, detail="Not subscribed")
   786â†’
   787â†’    # æ›´æ–°æ¨é€çŠ¶æ€
   788â†’    subscription = await SkillSubscriptionRepo.update_push(
   789â†’        user_id=user.id,
   790â†’        skill_id=skill_id,
   791â†’        enabled=request.enabled,
   792â†’    )
   793â†’
   794â†’    action = "å¼€å¯" if request.enabled else "å…³é—­"
   795â†’    return {
   796â†’        "success": True,
   797â†’        "subscription": subscription,
   798â†’        "message": f"å·²{action}ã€Œ{skill['name']}ã€çš„æ¨é€é€šçŸ¥",
   799â†’    }
   800â†’
   801â†’
   802â†’@router.get("/recommendations")
   803â†’async def get_recommendations(
   804â†’    limit: int = Query(default=3, le=10),
   805â†’    context: Optional[str] = None,
   806â†’    user=Depends(get_current_user),
   807â†’):
   808â†’    """è·å–æ¨è Skill"""
   809â†’    recommendations = await SkillRecommendationService.get_recommendations(
   810â†’        user_id=user.id,
   811â†’        limit=limit,
   812â†’        context=context,
   813â†’    )
   814â†’
   815â†’    return {
   816â†’        "recommendations": recommendations,
   817â†’        "generated_at": datetime.utcnow().isoformat(),
   818â†’    }
   819â†’
   820â†’
   821â†’@router.get("/featured")
   822â†’async def get_featured():
   823â†’    """è·å–ç²¾é€‰ Skill"""
   824â†’    # å¯ä»¥ä»æ•°æ®åº“æˆ–é…ç½®è¯»å–
   825â†’    featured = [
   826â†’        {"skill_id": "bazi", "position": 1, "campaign": None},
   827â†’        {"skill_id": "zodiac", "position": 2, "campaign": None},
   828â†’        {"skill_id": "tarot", "position": 3, "campaign": {"title": "æ–°å¹´é™æ—¶ä½“éªŒ", "badge": "é™æ—¶å…è´¹"}},
   829â†’    ]
   830â†’
   831â†’    # é™„åŠ  Skill ä¿¡æ¯
   832â†’    for item in featured:
   833â†’        skill = SkillLoader.get_skill(item["skill_id"])
   834â†’        if skill:
   835â†’            item["skill"] = {
   836â†’                "id": skill["id"],
   837â†’                "name": skill["name"],
   838â†’                "icon": skill.get("icon", "ğŸ’¡"),
   839â†’                "color": skill.get("color", "#6B7280"),
   840â†’                "tagline": skill.get("showcase", {}).get("tagline", ""),
   841â†’                "preview_image": skill.get("showcase", {}).get("preview_image"),
   842â†’            }
   843â†’
   844â†’    return {"featured": featured}
   845â†’```
   846â†’
   847â†’### 10.2 æ•°æ®åº“æ“ä½œ
   848â†’
   849â†’```python
   850â†’# stores/skill_subscription_repo.py
   851â†’
   852â†’from dataclasses import dataclass
   853â†’from datetime import datetime
   854â†’from typing import Optional, List
   855â†’from uuid import UUID
   856â†’
   857â†’from stores.db import get_connection
   858â†’
   859â†’
   860â†’@dataclass
   861â†’class SkillSubscription:
   862â†’    skill_id: str
   863â†’    status: str
   864â†’    push_enabled: bool
   865â†’    subscribed_at: Optional[datetime]
   866â†’    unsubscribed_at: Optional[datetime]
   867â†’    trial_messages_used: int
   868â†’
   869â†’
   870â†’class SkillSubscriptionRepo:
   871â†’
   872â†’    @staticmethod
   873â†’    async def get(user_id: UUID, skill_id: str) -> Optional[SkillSubscription]:
   874â†’        """è·å–å•ä¸ªè®¢é˜…"""
   875â†’        query = """
   876â†’            SELECT skill_id, status, push_enabled, subscribed_at, unsubscribed_at, trial_messages_used
   877â†’            FROM user_skill_subscriptions
   878â†’            WHERE user_id = $1 AND skill_id = $2
   879â†’        """
   880â†’        async with get_connection() as conn:
   881â†’            row = await conn.fetchrow(query, user_id, skill_id)
   882â†’            if row:
   883â†’                return SkillSubscription(**dict(row))
   884â†’        return None
   885â†’
   886â†’    @staticmethod
   887â†’    async def get_user_subscriptions(user_id: UUID) -> List[SkillSubscription]:
   888â†’        """è·å–ç”¨æˆ·æ‰€æœ‰è®¢é˜…"""
   889â†’        query = """
   890â†’            SELECT skill_id, status, push_enabled, subscribed_at, unsubscribed_at, trial_messages_used
   891â†’            FROM user_skill_subscriptions
   892â†’            WHERE user_id = $1
   893â†’        """
   894â†’        async with get_connection() as conn:
   895â†’            rows = await conn.fetch(query, user_id)
   896â†’            return [SkillSubscription(**dict(row)) for row in rows]
   897â†’
   898â†’    @staticmethod
   899â†’    async def subscribe(user_id: UUID, skill_id: str, push_enabled: bool = True) -> SkillSubscription:
   900â†’        """è®¢é˜… Skill"""
   901â†’        query = """
   902â†’            INSERT INTO user_skill_subscriptions (user_id, skill_id, status, push_enabled, subscribed_at)
   903â†’            VALUES ($1, $2, 'subscribed', $3, now())
   904â†’            ON CONFLICT (user_id, skill_id)
   905â†’            DO UPDATE SET status = 'subscribed', push_enabled = $3, subscribed_at = now(), updated_at = now()
   906â†’            RETURNING skill_id, status, push_enabled, subscribed_at, unsubscribed_at, trial_messages_used
   907â†’        """
   908â†’        async with get_connection() as conn:
   909â†’            row = await conn.fetchrow(query, user_id, skill_id, push_enabled)
   910â†’            return SkillSubscription(**dict(row))
   911â†’
   912â†’    @staticmethod
   913â†’    async def unsubscribe(user_id: UUID, skill_id: str) -> SkillSubscription:
   914â†’        """å–æ¶ˆè®¢é˜… Skill"""
   915â†’        query = """
   916â†’            UPDATE user_skill_subscriptions
   917â†’            SET status = 'unsubscribed', push_enabled = false, unsubscribed_at = now(), updated_at = now()
   918â†’            WHERE user_id = $1 AND skill_id = $2
   919â†’            RETURNING skill_id, status, push_enabled, subscribed_at, unsubscribed_at, trial_messages_used
   920â†’        """
   921â†’        async with get_connection() as conn:
   922â†’            row = await conn.fetchrow(query, user_id, skill_id)
   923â†’            return SkillSubscription(**dict(row))
   924â†’
   925â†’    @staticmethod
   926â†’    async def update_push(user_id: UUID, skill_id: str, enabled: bool) -> SkillSubscription:
   927â†’        """æ›´æ–°æ¨é€çŠ¶æ€"""
   928â†’        query = """
   929â†’            UPDATE user_skill_subscriptions
   930â†’            SET push_enabled = $3, updated_at = now()
   931â†’            WHERE user_id = $1 AND skill_id = $2
   932â†’            RETURNING skill_id, status, push_enabled, subscribed_at, unsubscribed_at, trial_messages_used
   933â†’        """
   934â†’        async with get_connection() as conn:
   935â†’            row = await conn.fetchrow(query, user_id, skill_id, enabled)
   936â†’            return SkillSubscription(**dict(row))
   937â†’
   938â†’    @staticmethod
   939â†’    async def increment_trial_usage(user_id: UUID, skill_id: str) -> int:
   940â†’        """å¢åŠ è¯•ç”¨æ¬¡æ•°"""
   941â†’        query = """
   942â†’            INSERT INTO user_skill_subscriptions (user_id, skill_id, trial_messages_used)
   943â†’            VALUES ($1, $2, 1)
   944â†’            ON CONFLICT (user_id, skill_id)
   945â†’            DO UPDATE SET trial_messages_used = user_skill_subscriptions.trial_messages_used + 1, updated_at = now()
   946â†’            RETURNING trial_messages_used
   947â†’        """
   948â†’        async with get_connection() as conn:
   949â†’            row = await conn.fetchrow(query, user_id, skill_id)
   950â†’            return row["trial_messages_used"]
   951â†’
   952â†’    @staticmethod
   953â†’    async def is_push_enabled(user_id: UUID, skill_id: str) -> bool:
   954â†’        """æ£€æŸ¥æ¨é€æ˜¯å¦å¼€å¯ï¼ˆç”¨äº ProactiveEngineï¼‰"""
   955â†’        query = """
   956â†’            SELECT push_enabled
   957â†’            FROM user_skill_subscriptions
   958â†’            WHERE user_id = $1 AND skill_id = $2 AND status = 'subscribed'
   959â†’        """
   960â†’        async with get_connection() as conn:
   961â†’            row = await conn.fetchrow(query, user_id, skill_id)
   962â†’            return row["push_enabled"] if row else False
   963â†’```
   964â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
