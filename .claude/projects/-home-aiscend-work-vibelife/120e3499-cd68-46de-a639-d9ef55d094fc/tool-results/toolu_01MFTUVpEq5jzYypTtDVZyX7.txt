     1→# VibeLife V7 Architecture Specification
     2→
     3→> Version: 7.0 | 2026-01-15
     4→> 基于 V6.8 重构，统一 API 架构
     5→
     6→---
     7→
     8→## 1. 系统概述
     9→
    10→VibeLife 是一个 AI 驱动的命理咨询平台，支持八字、星座、塔罗、职业咨询等多种技能。
    11→
    12→### 1.1 核心特性
    13→
    14→- **CoreAgent**: 基于 Anthropic Agent 设计原则的对话引擎
    15→- **Skill System**: 配置驱动的技能系统，支持自动发现
    16→- **Tool Calling**: 统一的工具注册和执行机制
    17→- **Knowledge Base**: 基于 RAG 的知识检索系统
    18→
    19→### 1.2 设计原则
    20→
    21→| 原则 | 说明 |
    22→|------|------|
    23→| **Simplicity** | 保持简单，避免过度工程 |
    24→| **Config-Driven** | Skill 层配置驱动，平台层代码驱动 |
    25→| **Single Source of Truth** | 工具定义、模型配置等只有一个数据源 |
    26→| **DDD** | 领域驱动设计，每个 Skill 独立管理自己的服务 |
    27→
    28→---
    29→
    30→## 2. 系统架构
    31→
    32→### 2.1 整体架构
    33→
    34→```
    35→┌─────────────────────────────────────────────────────────────────────┐
    36→│                         VibeLife V7 Architecture                     │
    37→├─────────────────────────────────────────────────────────────────────┤
    38→│                                                                      │
    39→│  ┌──────────────┐     ┌──────────────┐     ┌──────────────┐         │
    40→│  │   Browser    │────▶│   Next.js    │────▶│  Python API  │         │
    41→│  │  (AI SDK 6)  │     │   (Proxy)    │     │  (FastAPI)   │         │
    42→│  └──────────────┘     └──────────────┘     └──────────────┘         │
    43→│                                                   │                  │
    44→│                              ┌────────────────────┼────────────────┐ │
    45→│                              │                    ▼                │ │
    46→│                              │  ┌─────────────────────────────┐    │ │
    47→│                              │  │         API Routes          │    │ │
    48→│                              │  │  (7 routers, 49 endpoints)  │    │ │
    49→│                              │  └─────────────────────────────┘    │ │
    50→│                              │         │              │            │ │
    51→│                              │    ┌────┴────┐   ┌────┴────┐       │ │
    52→│                              │    ▼         ▼   ▼         ▼       │ │
    53→│                              │ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐   │ │
    54→│                              │ │Chat │ │Skill│ │Acct │ │Comm │   │ │
    55→│                              │ │ V5  │ │Gate │ │ ount│ │erce │   │ │
    56→│                              │ └──┬──┘ └──┬──┘ └─────┘ └─────┘   │ │
    57→│                              │    │       │                       │ │
    58→│                              │    ▼       ▼                       │ │
    59→│                              │ ┌─────────────────────────────┐    │ │
    60→│                              │ │        CoreAgent            │    │ │
    61→│                              │ │  (Agentic Loop + Tools)     │    │ │
    62→│                              │ └─────────────────────────────┘    │ │
    63→│                              │              │                     │ │
    64→│                              │    ┌─────────┼─────────┐          │ │
    65→│                              │    ▼         ▼         ▼          │ │
    66→│                              │ ┌─────┐ ┌─────────┐ ┌─────────┐   │ │
    67→│                              │ │Tool │ │  Skill  │ │Knowledge│   │ │
    68→│                              │ │Reg. │ │ Service │ │   RAG   │   │ │
    69→│                              │ └─────┘ │Registry │ └─────────┘   │ │
    70→│                              │         └─────────┘               │ │
    71→│                              │              │                     │ │
    72→│                              │    ┌─────────┼─────────┐          │ │
    73→│                              │    ▼         ▼         ▼          │ │
    74→│                              │ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐  │ │
    75→│                              │ │Bazi │ │Zodiac│ │Tarot│ │Career│  │ │
    76→│                              │ │Skill│ │Skill │ │Skill│ │Skill │  │ │
    77→│                              │ └─────┘ └─────┘ └─────┘ └─────┘  │ │
    78→│                              └───────────────────────────────────┘ │
    79→│                                                                      │
    80→│  ┌──────────────────────────────────────────────────────────────┐   │
    81→│  │                        Data Layer                             │   │
    82→│  │  PostgreSQL (unified_profiles, messages, knowledge_chunks)    │   │
    83→│  └──────────────────────────────────────────────────────────────┘   │
    84→└────────────────────────────���────────────────────────────────────────┘
    85→```
    86→
    87→### 2.2 API 路由架构 (V7 重构)
    88→
    89→```
    90→routes/ (7 个核心路由文件)
    91→├── health.py           # 健康检查 (3 routes)
    92→├── chat_v5.py          # CoreAgent 对话入口 (2 routes)
    93→├── tools.py            # 工具 Schema API (3 routes)
    94→├── skills.py           # Skill Gateway - 配置驱动 (4 routes)
    95→├── account.py          # 用户域 - 代码驱动 (17 routes)
    96→├── commerce.py         # 支付域 - 代码驱动 (14 routes)
    97→└── notifications.py    # 通知域 (4 routes)
    98→```
    99→
   100→### 2.3 API 端点映射
   101→
   102→| 域 | 端点前缀 | 说明 |
   103→|----|----------|------|
   104→| **Chat** | `/api/v1/chat/v5/*` | CoreAgent 对话 |
   105→| **Skills** | `/api/v1/skills/{skill}/{action}` | 统一 Skill Gateway |
   106→| **Account** | `/api/v1/account/*` | 认证、用户、访客、身份 |
   107→| **Commerce** | `/api/v1/commerce/*` | 支付、订阅、权益 |
   108→| **Tools** | `/api/v1/tools/*` | 工具 Schema |
   109→| **Notifications** | `/api/v1/notifications/*` | ��知管理 |
   110→
   111→---
   112→
   113→## 3. 核心组件
   114→
   115→### 3.1 SkillServiceRegistry (配置驱动)
   116→
   117→统一的 Skill 服务注册表，支持自动发现。
   118→
   119→**文件**: `services/agent/skill_service_registry.py`
   120→
   121→```python
   122→# 使用 @skill_service 装饰器注册服务
   123→@skill_service("bazi", "chart", description="计算八字命盘")
   124→async def get_bazi_chart(args: Dict, context: ServiceContext) -> Dict:
   125→    return {"chart": ...}
   126→
   127→# 执行服务
   128→result = await SkillServiceRegistry.execute("bazi", "chart", args, context)
   129→```
   130→
   131→**自动发现机制**:
   132→- 扫描 `skills/{skill_id}/services/api.py`
   133→- 自动注册带 `@skill_service` 装饰器的函数
   134→- 无需修改 main.py 即可添加新 Skill
   135→
   136→**当前注册的服务** (18 个):
   137→
   138→| Skill | Services |
   139→|-------|----------|
   140→| bazi | chart, fortune, daily, kline, cycles |
   141→| zodiac | chart, transit, daily, events, synastry |
   142→| tarot | draw, spread, card, spreads |
   143→| career | analysis, profile, match, assessments |
   144→
   145→### 3.2 ToolRegistry (工具注册)
   146→
   147→统一的工具注册表，支持自动发现。
   148→
   149→**文件**: `services/agent/tool_registry.py`
   150→
   151→```python
   152→# 使用 @tool_handler 装饰器注册工具
   153→@tool_handler("show_bazi_chart")
   154→async def execute_show_bazi_chart(args: Dict, context: ToolContext) -> Dict:
   155→    return {"cardType": "bazi_chart", ...}
   156→```
   157→
   158→**工具定义**: `skills/{skill}/tools/tools.yaml`
   159→**工具执行器**: `skills/{skill}/tools/handlers.py`
   160→
   161→### 3.3 CoreAgent (对话引擎)
   162→
   163→基于 Anthropic Agent 设计原则的对话引擎。
   164→
   165→**文件**: `services/agent/core.py`
   166→
   167→**核心流程**:
   168→```
   169→用户消息 → CoreAgent.stream()
   170→    ↓
   171→1. 构建 System Prompt (注入 Skill + Profile)
   172→2. LLM 调用 (支持 Tool Calling)
   173→3. 工具执行 (ToolRegistry.execute)
   174→4. 流式输出 (AI SDK 6 Data Stream Protocol)
   175→```
   176→
   177→### 3.4 Knowledge RAG
   178→
   179→基于向量检索的知识库系统。
   180→
   181→**文件**: `services/knowledge/repository.py`
   182→
   183→**Embedding**: BAAI/bge-m3 (本地部署)
   184→
   185→```python
   186→# 检索知识
   187→chunks = await KnowledgeRepository.search(
   188→    query="甲木日主性格",
   189→    skill_id="bazi",
   190→    top_k=5
   191→)
   192→```
   193→
   194→---
   195→
   196→## 4. 目录结构
   197→
   198→```
   199→apps/api/
   200→├── main.py                           # FastAPI 入口
   201→├── config/
   202→│   └── models.yaml                   # LLM 模型配置 (唯一数据源)
   203→├── routes/                           # API 路由 (7 个文件)
   204→│   ├── health.py
   205→│   ├── chat_v5.py
   206→│   ├── tools.py
   207→│   ├── skills.py                     # Skill Gateway
   208→│   ├── account.py                    # 用户域
   209→│   ├── commerce.py                   # 支付域
   210→│   └── notifications.py
   211→├── services/
   212→│   ├── agent/
   213→│   │   ├── core.py                   # CoreAgent
   214→│   │   ├── tool_registry.py          # ToolRegistry
   215→│   │   ├── skill_service_registry.py # SkillServiceRegistry (V7 新增)
   216→│   │   ├── skill_loader.py           # Skill 加载器
   217→│   │   └── global_handlers.py        # 全局工具处理器
   218→│   ├── knowledge/
   219→│   │   ├── repository.py             # 知识库
   220→│   │   └── embedding.py              # Embedding 服务
   221→│   ├── billing/
   222→│   │   ├── stripe_service.py         # Stripe 集成
   223→│   │   └── subscription.py           # 订阅管理
   224→│   ├── identity/
   225→│   │   ├── auth.py                   # 认证服务
   226→│   │   └── guest_session.py          # 访客会话
   227→│   └── entitlement/
   228→│       └── __init__.py               # 权益服务
   229→├── skills/                           # Skill 定义 (DDD 架构)
   230→│   ├── core/
   231→│   │   ├── SKILL.md                  # Core Skill 定义
   232→│   │   ├── tools/
   233→│   │   │   ├── tools.yaml
   234→│   │   │   └── handlers.py
   235→│   │   └── reminders.yaml
   236→│   ├── bazi/
   237→│   │   ├── SKILL.md                  # Bazi Skill 定义
   238→│   │   ├── services/                 # 领域服务 (V6.7 DDD)
   239→│   │   │   ├── __init__.py
   240→│   │   │   ├── api.py                # API 服务 (V7 新增)
   241→│   │   │   ├── calculator.py
   242→│   │   │   └── computer.py
   243→│   │   ├── tools/
   244→│   │   │   ├── tools.yaml
   245→│   │   │   └── handlers.py
   246→│   │   └── scenarios/
   247→│   ├── zodiac/
   248→│   │   ├── SKILL.md
   249→│   │   ├── services/
   250→│   │   │   ├── __init__.py
   251→│   │   │   ├── api.py                # API 服务 (V7 新增)
   252→│   │   │   ├── calculator.py
   253→│   │   │   ├── computer.py
   254→│   │   │   └── events.py
   255→│   │   ├── tools/
   256→│   │   └── scenarios/
   257→│   ├── tarot/
   258→│   │   ├── SKILL.md
   259→│   │   ├── services/
   260→│   │   │   └── api.py                # API 服务 (V7 新增)
   261→│   │   └── tools/
   262→│   └── career/
   263→│       ├── SKILL.md
   264→│       ├── services/
   265→│       │   └── api.py                # API 服务 (V7 新增)
   266→│       └── tools/
   267→├── stores/                           # 数据访问层
   268→│   ├── db.py                         # 数据库连接
   269→│   ├── unified_profile_repo.py       # 用户档案
   270→│   └── payment_repo.py               # 支付记录
   271→└── workers/                          # 后台任务
   272→    ├── ingestion.py                  # 知识入库
   273→    └── profile_extractor.py          # Profile 抽取
   274→```
   275→
   276→---
   277→
   278→## 5. 配置说明
   279→
   280→### 5.1 环境变量
   281→
   282→```bash
   283→# 数据库
   284→DATABASE_URL=postgresql://postgres:password@127.0.0.1:8224/vibelife
   285→
   286→# LLM API Keys
   287→DEEPSEEK_API_KEY=sk-xxx
   288→GLM_API_KEY=xxx
   289→ANTHROPIC_API_KEY=sk-ant-xxx
   290→
   291→# Stripe
   292→STRIPE_SECRET_KEY=sk_xxx
   293→STRIPE_WEBHOOK_SECRET=whsec_xxx
   294→
   295→# 应用配置
   296→VIBELIFE_API_PORT=8000
   297→VIBELIFE_CORS_ORIGINS=http://localhost:3000
   298→VIBELIFE_WORKER_ENABLED=1
   299→```
   300→
   301→### 5.2 LLM 模型配置
   302→
   303→**唯一配置源**: `config/models.yaml`
   304→
   305→```yaml
   306→providers:
   307→  deepseek:
   308→    base_url: https://api.deepseek.com/anthropic
   309→    api_key_env: DEEPSEEK_API_KEY
   310→    is_anthropic_compatible: true
   311→  glm:
   312→    base_url: https://open.bigmodel.cn/api/anthropic/v1
   313→    api_key_env: GLM_API_KEY
   314→    is_anthropic_compatible: true
   315→
   316→routing:
   317→  chat:
   318→    free: deepseek-chat
   319→    paid: deepseek-chat
   320→    fallback: [glm-4.7]
   321→```
   322→
   323→### 5.3 数据库配置
   324→
   325→```
   326→PostgreSQL 16
   327→- 主机: 127.0.0.1
   328→- 端口: 8224
   329→- 数据库: vibelife
   330→- 连接串: postgresql://postgres:Ak4_9lScd-69WX@127.0.0.1:8224/vibelife
   331→```
   332→
   333→---
   334→
   335→## 6. 开发指南
   336→
   337→### 6.1 添加新 Skill
   338→
   339→1. **创建目录结构**:
   340→```bash
   341→mkdir -p skills/newskill/{services,tools,scenarios}
   342→```
   343→
   344→2. **创建 SKILL.md**:
   345→```markdown
   346→# NewSkill
   347→
   348→## 角色定义
   349→你是一个专业的 XXX 顾问...
   350→
   351→## 工具列表
   352→- show_xxx_result: 展示结果
   353→```
   354→
   355→3. **创建 API 服务** (`skills/newskill/services/api.py`):
   356→```python
   357→from services.agent.skill_service_registry import skill_service, ServiceContext
   358→
   359→@skill_service("newskill", "action", description="执行操作")
   360→async def newskill_action(args: Dict, context: ServiceContext) -> Dict:
   361→    return {"status": "success", "data": ...}
   362→```
   363→
   364→4. **创建工具** (`skills/newskill/tools/`):
   365→```yaml
   366→# tools.yaml
   367→- name: show_xxx_result
   368→  description: 展示 XXX 结果
   369→  parameters:
   370→    type: object
   371→    properties:
   372→      data:
   373→        type: object
   374→```
   375→
   376→```python
   377→# handlers.py
   378→@tool_handler("show_xxx_result")
   379→async def execute_show_xxx_result(args: Dict, context: ToolContext) -> Dict:
   380→    return {"cardType": "xxx_result", **args}
   381→```
   382→
   383→5. **重启服务** - 自动发现新 Skill
   384→
   385→### 6.2 添加新 API 端点
   386→
   387→**Skill 相关**: 使用 `@skill_service` 装饰器，自动注册到 Skill Gateway
   388→
   389→**平台相关**: 直接在 `routes/account.py` 或 `routes/commerce.py` 添加
   390→
   391→### 6.3 测试
   392→
   393→```bash
   394→# 启动测试环境
   395→./scripts/start-test.sh
   396→
   397→# 测试 API
   398→curl http://127.0.0.1:8100/api/v1/skills/bazi/chart \
   399→  -X POST \
   400→  -H "Content-Type: application/json" \
   401→  -d '{"args": {"birth_date": "1990-01-01"}}'
   402→
   403→# 测试 Skill 服务
   404→python -c "
   405→from services.agent.skill_service_registry import SkillServiceRegistry
   406→SkillServiceRegistry.initialize()
   407→print(SkillServiceRegistry.list_services())
   408→"
   409→```
   410→
   411→---
   412→
   413→## 7. 运维指南
   414→
   415→### 7.1 部署环境
   416→
   417→| 环境 | API 端口 | Web 端口 | 说明 |
   418→|------|----------|----------|------|
   419→| 测试 (aiscend) | 8100 | 8232 | 开发测试 |
   420→| 生产 (vibelife) | 8000 | 3000 | 正式环境 |
   421→
   422→### 7.2 启动服务
   423→
   424→```bash
   425→# 测试环境
   426→cd /home/aiscend/work/vibelife/apps/api
   427→./start_api.sh
   428→
   429→# 生产环境
   430→cd /home/vibelife/vibelife/apps/api
   431→./start_api.sh
   432→```
   433→
   434→### 7.3 定时任务
   435→
   436→```cron
   437→# Profile 抽取 (每日凌晨3点)
   438→0 3 * * * cd /home/vibelife/vibelife/apps/api && python workers/profile_extractor.py
   439→
   440→# 知识库更新 (每周一凌晨4点)
   441→0 4 * * 1 cd /home/vibelife/vibelife/apps/api && python scripts/build_knowledge.py
   442→```
   443→
   444→### 7.4 监控检查
   445→
   446→```bash
   447→# 健康检查
   448→curl http://127.0.0.1:8000/health
   449→
   450→# 查看日志
   451→tail -f /tmp/vibelife/logs/api_requests.log
   452→
   453→# 检查服务状态
   454→python -c "
   455→from main import app
   456→print(f'Routes: {len(app.routes)}')
   457→from services.agent.skill_service_registry import SkillServiceRegistry
   458→SkillServiceRegistry.initialize()
   459→print(f'Skills: {SkillServiceRegistry.list_skills()}')
   460→print(f'Services: {len(SkillServiceRegistry.list_services())}')
   461→"
   462→```
   463→
   464→---
   465→
   466→## 8. API 参考
   467→
   468→### 8.1 Skill Gateway
   469→
   470→**列出所有 Skill**:
   471→```
   472→GET /api/v1/skills
   473→Response: {"skills": ["bazi", "zodiac", "tarot", "career"]}
   474→```
   475→
   476→**列出 Skill 服务**:
   477→```
   478→GET /api/v1/skills/{skill_id}/services
   479→Response: {"skill_id": "bazi", "services": [...]}
   480→```
   481→
   482→**执行 Skill 服务**:
   483→```
   484→POST /api/v1/skills/{skill_id}/{action}
   485→Body: {"args": {...}}
   486→Response: {"status": "success", ...}
   487→```
   488→
   489→### 8.2 Account API
   490→
   491→| 端点 | 方法 | 说明 |
   492→|------|------|------|
   493→| `/account/auth/register` | POST | 注册 |
   494→| `/account/auth/login` | POST | 登录 |
   495→| `/account/auth/refresh` | POST | 刷新 Token |
   496→| `/account/auth/logout` | POST | 登出 |
   497→| `/account/auth/me` | GET | 当前用户 |
   498→| `/account/auth/oauth/google` | POST | Google 登录 |
   499→| `/account/auth/oauth/apple` | POST | Apple 登录 |
   500→| `/account/profile` | GET/PUT | 用户资料 |
   501→| `/account/guest/session` | POST/GET | 访客会话 |
   502→| `/account/identity/prism` | GET | 身份棱镜 |
   503→
   504→### 8.3 Commerce API
   505→
   506→| 端点 | 方法 | 说明 |
   507→|------|------|------|
   508→| `/commerce/payment/config` | GET | Stripe 配置 |
   509→| `/commerce/payment/pricing` | GET | 定价信息 |
   510→| `/commerce/payment/create-checkout` | POST | 创建支付 |
   511→| `/commerce/payment/verify` | POST | 验证支付 |
   512→| `/commerce/payment/webhook` | POST | Stripe Webhook |
   513→| `/commerce/billing/plans` | GET | 订阅计划 |
   514→| `/commerce/billing/subscription/me` | GET | 我的订阅 |
   515→| `/commerce/entitlement` | GET | 权益信息 |
   516→| `/commerce/entitlement/can-chat` | GET | 检查对话权限 |
   517→
   518→### 8.4 Chat API
   519→
   520→```
   521→POST /api/v1/chat/v5/stream
   522→Headers: Authorization: Bearer {token}
   523→Body: {
   524→  "messages": [{"role": "user", "content": "..."}],
   525→  "skill": "bazi",
   526→  "voice_mode": "warm"
   527→}
   528→Response: SSE (AI SDK 6 Data Stream Protocol)
   529→```
   530→
   531→---
   532→
   533→## 9. 变更日志
   534→
   535→### V7.1 (2026-01-18)
   536→
   537→**LLM 自动路由**:
   538→- 前端统一入口不再传递 `skillId`，由 LLM 根据用户消息自动选择 Skill
   539→- CoreAgent 通过 `use_skill` 工具让 LLM 决定使用哪个 Skill
   540→- 每个 Skill 在 SKILL.md 中定义触发词，用于构建 `use_skill` 工具描述
   541→
   542→**ShowCard Fallback 机制**:
   543→- 实现"专用优先，通用兜底"的卡片渲染策略
   544→- 新增 `fallbackType` 属性，支持显式指定降级类型
   545→- 智能推断逻辑：根据 data/items/nodes/events/fields 等属性自动选择通用视图
   546→- 通用视图类型：list, tree, table, timeline, form, select, chart, progress, counter, modal, toast, custom
   547→
   548→**前端改动**:
   549→- `useVibeChat.ts`: skillId 改为可选参数，不传时让 LLM 自动路由
   550→- `ChatContainer.tsx`: 新增 displaySkill 用于 UI 展示，区分路由和展示
   551→- `chat/page.tsx`: 主聊天页面使用自动路由模式
   552→- `ShowCard.tsx`: 实现 fallback 机制，优先使用注册的专用组件，不存在时降级到通用视图
   553→
   554→**架构优化**:
   555→- 减少前端开发成本：新 Skill 无需开发专用卡片即可使用通用视图
   556→- 渐进式增强：可随时为特定 cardType 添加专用组件覆盖通用视图
   557→
   558→---
   559→
   560→### V7.0 (2026-01-15)
   561→
   562→**重大变更**:
   563→- 创建 `SkillServiceRegistry` 实现 Skill 服务自动发现
   564→- 创建统一 Skill Gateway (`/api/v1/skills/{skill_id}/{action}`)
   565→- 合并 auth + users + identity + guest → `account.py`
   566→- 合并 payment + billing + entitlement → `commerce.py`
   567→- 删除 16 个旧路由文件，路由文件从 25 个精简到 9 个
   568→
   569→**新增文件**:
   570→- `services/agent/skill_service_registry.py`
   571→- `routes/skills.py`
   572→- `routes/account.py`
   573→- `routes/commerce.py`
   574→- `skills/*/services/api.py` (4 个 Skill)
   575→
   576→**删除文件**:
   577→- `routes/auth.py`
   578→- `routes/users.py`
   579→- `routes/identity.py`
   580→- `routes/guest.py`
   581→- `routes/payment.py`
   582→- `routes/billing.py`
   583→- `routes/entitlement.py`
   584→- `routes/bazi.py`
   585→- `routes/zodiac.py`
   586→（已删除）
   587→- `routes/onboarding.py`
   588→- `routes/relationship.py`
   589→- `routes/report.py`
   590→- `routes/memories.py`
   591→- `routes/chat.py`
   592→- `routes/context.py`
   593→
   594→---
   595→
   596→## 10. 附录
   597→
   598→### 10.1 AI SDK 6 Data Stream Protocol
   599→
   600→后端 SSE 输出格式:
   601→```
   602→0:"text chunk"           # 文本块
   603→9:{"toolCallId":"..."}   # 工具调用开始
   604→a:{"toolCallId":"..."}   # 工具调用结果
   605→e:{"finishReason":"..."}  # 完成
   606→d:{"finishReason":"..."}  # 结束
   607→```
   608→
   609→### 10.2 Anthropic 兼容 API
   610→
   611→| Provider | Base URL | 模型 |
   612→|----------|----------|------|
   613→| DeepSeek | `https://api.deepseek.com/anthropic` | deepseek-chat |
   614→| GLM | `https://open.bigmodel.cn/api/anthropic/v1` | glm-4.7 |
   615→
   616→### 10.3 数据库表结构
   617→
   618→**核心表**:
   619→- `users`: 用户基本信息
   620→- `unified_profiles`: 用户档案 (profile + skill_data)
   621→- `messages`: 对话消息
   622→- `conversations`: 对话会话
   623→- `knowledge_chunks`: 知识块
   624→- `subscriptions`: 订阅记录
   625→- `payments`: 支付记录
   626→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
