The file /home/aiscend/work/vibelife/apps/api/routes/skills.py has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
   134→# ═══════════════════════════════════════════════════════════════════════════
   135→# Endpoints
   136→# ═══════════════════════════════════════════════════════════════════════════
   137→
   138→@router.get("")
   139→async def list_skills(
   140→    category: Optional[str] = Query(None, description="按分类筛选: core, default, professional"),
   141→    subscribed: Optional[bool] = Query(None, description="只返回已订阅的 Skill"),
   142→    current_user: Optional[CurrentUser] = Depends(get_optional_user),
   143→):
   144→    """
   145→    获取所有 Skill 列表（带元数据和订阅状态）
   146→
   147→    Args:
   148→        category: 按分类筛选 (core/default/professional)
   149→        subscribed: 只返回已订阅的 Skill
   150→
   151→    Returns:
   152→        skills: Skill 列表，包含元数据和用户订阅状态
   153→        categories: 分类统计
   154→        total: 总数
   155→    """
   156→    # 获取所有 Skill 元数据
   157→    if category:
   158→        all_metadata = get_skills_by_category(category)
   159→    else:
   160→        all_metadata = get_all_skill_metadata()
   161→
   162→    # 获取用户订阅状态
   163→    user_statuses = {}
   164→    if current_user:
   165→        subscriptions = await SkillSubscriptionRepository.get_user_subscriptions(current_user.user_id)
   166→        user_statuses = {s.skill_id: s for s in subscriptions}
   167→
   168→    # 构建响应
   169→    skills = []
   170→    for metadata in all_metadata:
   171→        skill_dict = metadata.to_dict()
   172→        sub = user_statuses.get(metadata.id)
   173→
   174→        # 计算试用剩余次数
   175→        trial_limit = metadata.pricing.trial_messages if metadata.pricing.type != "free" else None
   176→        trial_used = sub.trial_messages_used if sub else 0
   177→
   178→        skill_dict["user_status"] = {
   179→            "subscribed": sub.status == "subscribed" if sub else False,
   180→            "push_enabled": sub.push_enabled if sub else False,
   181→            "trial_messages_used": trial_used,
   182→            "trial_messages_remaining": (trial_limit - trial_used) if trial_limit else None,
   183→        }
   184→
   185→        # 筛选已订阅
   186→        if subscribed is not None:
   187→            is_subscribed = skill_dict["user_status"]["subscribed"]
   188→            if subscribed and not is_subscribed:
   189→                continue
   190→            if not subscribed and is_subscribed:
   191→                continue
   192→
   193→        skills.append(skill_dict)
   194→
   195→    # 分类统计
   196→    all_skills = get_all_skill_metadata()
   197→    categories = {
   198→        "core": {
   199→            "name": "核心能力",
   200→            "description": "始终激活的基础能力",
   201→            "count": len([s for s in all_skills if s.category == "core"])
   202→        },
   203→        "default": {
   204→            "name": "基础功能",
   205→            "description": "默认激活，免费使用",
   206→            "count": len([s for s in all_skills if s.category == "default"])
   207→        },
   208→        "professional": {
   209→            "name": "专业技能",
   210→            "description": "需要订阅的高级功能",
   211→            "count": len([s for s in all_skills if s.category == "professional"])
   212→        },
   213→    }
   214→
   215→    return {"skills": skills, "categories": categories, "total": len(skills)}
   216→
   217→
   218→@router.get("/{skill_id}/services")
   219→async def list_skill_services(skill_id: str):