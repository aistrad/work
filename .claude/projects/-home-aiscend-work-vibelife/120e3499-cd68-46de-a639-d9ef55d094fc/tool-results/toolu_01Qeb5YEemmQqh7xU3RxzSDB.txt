     1â†’# Skill Management UI Components
     2â†’
     3â†’> å‰ç«¯ç»„ä»¶è®¾è®¡è§„æ ¼
     4â†’
     5â†’---
     6â†’
     7â†’## 1. ç»„ä»¶æ€»è§ˆ
     8â†’
     9â†’```
    10â†’components/skill/
    11â†’â”œâ”€â”€ SkillCard.tsx              # Skill å¡ç‰‡ (å¤šå˜ä½“)
    12â†’â”œâ”€â”€ SkillList.tsx              # Skill åˆ—è¡¨
    13â†’â”œâ”€â”€ SkillMarketPage.tsx        # Skill å¸‚åœºé¡µé¢
    14â†’â”œâ”€â”€ SkillDetailPage.tsx        # Skill è¯¦æƒ…é¡µ
    15â†’â”œâ”€â”€ SkillRecommendation.tsx    # å¯¹è¯å†…æ¨èå¡ç‰‡
    16â†’â”œâ”€â”€ SkillSubscriptionToggle.tsx # è®¢é˜…å¼€å…³
    17â†’â”œâ”€â”€ SkillPushToggle.tsx        # æ¨é€å¼€å…³
    18â†’â”œâ”€â”€ SkillSettingsSection.tsx   # è®¾ç½®é¡µ Skill ç®¡ç†åŒºå—
    19â†’â”œâ”€â”€ SkillHomeWidget.tsx        # é¦–é¡µæ¨èå¡ç‰‡
    20â†’â””â”€â”€ index.ts
    21â†’```
    22â†’
    23â†’---
    24â†’
    25â†’## 2. SkillCard ç»„ä»¶
    26â†’
    27â†’### 2.1 Props å®šä¹‰
    28â†’
    29â†’```typescript
    30â†’// types/skill.ts
    31â†’
    32â†’export interface SkillMetadata {
    33â†’  id: string;
    34â†’  name: string;
    35â†’  description: string;
    36â†’  icon: string;
    37â†’  color: string;
    38â†’  category: 'core' | 'default' | 'professional';
    39â†’  pricing: {
    40â†’    type: 'free' | 'premium' | 'credits';
    41â†’    trial_messages?: number;
    42â†’  };
    43â†’  features: Array<{
    44â†’    name: string;
    45â†’    description?: string;
    46â†’    icon?: string;
    47â†’    tier?: 'free' | 'basic' | 'premium';
    48â†’  }>;
    49â†’  showcase: {
    50â†’    tagline: string;
    51â†’    highlights: string[];
    52â†’    preview_image?: string;
    53â†’    demo_prompts?: string[];
    54â†’  };
    55â†’  triggers: string[];
    56â†’}
    57â†’
    58â†’export interface SkillUserStatus {
    59â†’  subscribed: boolean;
    60â†’  push_enabled: boolean;
    61â†’  trial_messages_used: number;
    62â†’  trial_messages_remaining: number;
    63â†’}
    64â†’
    65â†’export interface SkillCardProps {
    66â†’  skill: SkillMetadata;
    67â†’  variant: 'compact' | 'card' | 'detail' | 'inline';
    68â†’  userStatus?: SkillUserStatus;
    69â†’  showActions?: boolean;
    70â†’  className?: string;
    71â†’
    72â†’  // äº‹ä»¶å›è°ƒ
    73â†’  onSubscribe?: () => void;
    74â†’  onUnsubscribe?: () => void;
    75â†’  onTogglePush?: (enabled: boolean) => void;
    76â†’  onTry?: () => void;
    77â†’  onLearnMore?: () => void;
    78â†’  onClick?: () => void;
    79â†’}
    80â†’```
    81â†’
    82â†’### 2.2 Compact å˜ä½“
    83â†’
    84â†’ç”¨äºåˆ—è¡¨é¡¹ã€å¿«é€Ÿé€‰æ‹©åœºæ™¯ã€‚
    85â†’
    86â†’```tsx
    87â†’// é«˜åº¦å›ºå®š 64pxï¼Œæ°´å¹³å¸ƒå±€
    88â†’
    89â†’<div className="flex items-center gap-3 p-3 rounded-lg bg-bg-card hover:bg-bg-card-hover transition-colors">
    90â†’  {/* Icon */}
    91â†’  <div
    92â†’    className="w-10 h-10 rounded-xl flex items-center justify-center text-xl"
    93â†’    style={{ backgroundColor: `${skill.color}20` }}
    94â†’  >
    95â†’    {skill.icon}
    96â†’  </div>
    97â†’
    98â†’  {/* Content */}
    99â†’  <div className="flex-1 min-w-0">
   100â†’    <h4 className="text-sm font-medium text-text-primary truncate">
   101â†’      {skill.name}
   102â†’    </h4>
   103â†’    <p className="text-xs text-text-secondary truncate">
   104â†’      {skill.description}
   105â†’    </p>
   106â†’  </div>
   107â†’
   108â†’  {/* Status / Action */}
   109â†’  {userStatus?.subscribed ? (
   110â†’    <span className="px-2 py-0.5 text-xs rounded-full bg-success/10 text-success">
   111â†’      å·²è®¢é˜…
   112â†’    </span>
   113â†’  ) : (
   114â†’    <button className="px-3 py-1 text-xs rounded-full bg-accent text-white">
   115â†’      è®¢é˜…
   116â†’    </button>
   117â†’  )}
   118â†’</div>
   119â†’```
   120â†’
   121â†’### 2.3 Card å˜ä½“
   122â†’
   123â†’ç”¨äºå¸‚åœºå±•ç¤ºã€ç½‘æ ¼å¸ƒå±€ã€‚
   124â†’
   125â†’```tsx
   126â†’// å®½åº¦è‡ªé€‚åº”ï¼Œé«˜åº¦ auto
   127â†’
   128â†’<div className="rounded-xl bg-bg-card border border-border-light overflow-hidden hover:shadow-lg transition-shadow">
   129â†’  {/* Header */}
   130â†’  <div
   131â†’    className="p-4 pb-3"
   132â†’    style={{ background: `linear-gradient(135deg, ${skill.color}10, ${skill.color}05)` }}
   133â†’  >
   134â†’    <div className="flex items-start justify-between">
   135â†’      <div className="flex items-center gap-3">
   136â†’        <div
   137â†’          className="w-12 h-12 rounded-xl flex items-center justify-center text-2xl"
   138â†’          style={{ backgroundColor: `${skill.color}20` }}
   139â†’        >
   140â†’          {skill.icon}
   141â†’        </div>
   142â†’        <div>
   143â†’          <h3 className="font-semibold text-text-primary">{skill.name}</h3>
   144â†’          <p className="text-xs text-text-secondary">{skill.showcase.tagline}</p>
   145â†’        </div>
   146â†’      </div>
   147â†’      <StatusBadge status={userStatus} category={skill.category} />
   148â†’    </div>
   149â†’  </div>
   150â†’
   151â†’  {/* Features */}
   152â†’  <div className="px-4 py-3 border-t border-border-light">
   153â†’    <div className="flex flex-wrap gap-2">
   154â†’      {skill.features.slice(0, 3).map((feature) => (
   155â†’        <span
   156â†’          key={feature.name}
   157â†’          className="px-2 py-0.5 text-xs rounded-full bg-bg-secondary text-text-secondary"
   158â†’        >
   159â†’          {feature.icon} {feature.name}
   160â†’        </span>
   161â†’      ))}
   162â†’    </div>
   163â†’  </div>
   164â†’
   165â†’  {/* Actions */}
   166â†’  <div className="px-4 py-3 border-t border-border-light flex items-center justify-between">
   167â†’    {userStatus?.subscribed ? (
   168â†’      <>
   169â†’        <PushToggle enabled={userStatus.push_enabled} onToggle={onTogglePush} />
   170â†’        <button
   171â†’          onClick={onLearnMore}
   172â†’          className="text-sm text-accent hover:underline"
   173â†’        >
   174â†’          æŸ¥çœ‹è¯¦æƒ…
   175â†’        </button>
   176â†’      </>
   177â†’    ) : (
   178â†’      <>
   179â†’        <TrialBadge remaining={skill.pricing.trial_messages} />
   180â†’        <button
   181â†’          onClick={onTry}
   182â†’          className="px-4 py-1.5 text-sm rounded-lg bg-accent text-white hover:bg-accent-hover"
   183â†’        >
   184â†’          ç«‹å³è¯•ç”¨
   185â†’        </button>
   186â†’      </>
   187â†’    )}
   188â†’  </div>
   189â†’</div>
   190â†’```
   191â†’
   192â†’### 2.4 Detail å˜ä½“
   193â†’
   194â†’ç”¨äºè¯¦æƒ…é¡µ Hero åŒºåŸŸã€‚
   195â†’
   196â†’```tsx
   197â†’// å…¨å®½ï¼Œé«˜åº¦ 200-300px
   198â†’
   199â†’<div className="relative overflow-hidden rounded-2xl">
   200â†’  {/* Background */}
   201â†’  <div
   202â†’    className="absolute inset-0"
   203â†’    style={{
   204â†’      background: `linear-gradient(135deg, ${skill.color}30, ${skill.color}10)`,
   205â†’    }}
   206â†’  />
   207â†’
   208â†’  {/* Content */}
   209â†’  <div className="relative p-6 md:p-8">
   210â†’    <div className="flex flex-col md:flex-row md:items-center gap-6">
   211â†’      {/* Icon */}
   212â†’      <div
   213â†’        className="w-20 h-20 rounded-2xl flex items-center justify-center text-4xl shrink-0"
   214â†’        style={{ backgroundColor: `${skill.color}20` }}
   215â†’      >
   216â†’        {skill.icon}
   217â†’      </div>
   218â†’
   219â†’      {/* Info */}
   220â†’      <div className="flex-1">
   221â†’        <div className="flex items-center gap-2 mb-2">
   222â†’          <h1 className="text-2xl font-bold text-text-primary">{skill.name}</h1>
   223â†’          <CategoryBadge category={skill.category} />
   224â†’        </div>
   225â†’        <p className="text-text-secondary mb-4">{skill.description}</p>
   226â†’
   227â†’        {/* Highlights */}
   228â†’        <div className="flex flex-wrap gap-2">
   229â†’          {skill.showcase.highlights.map((highlight) => (
   230â†’            <span
   231â†’              key={highlight}
   232â†’              className="px-3 py-1 text-sm rounded-full bg-white/50 text-text-primary"
   233â†’            >
   234â†’              {highlight}
   235â†’            </span>
   236â†’          ))}
   237â†’        </div>
   238â†’      </div>
   239â†’
   240â†’      {/* Action */}
   241â†’      <div className="shrink-0">
   242â†’        {userStatus?.subscribed ? (
   243â†’          <SubscribedActions
   244â†’            userStatus={userStatus}
   245â†’            onTogglePush={onTogglePush}
   246â†’            onUnsubscribe={onUnsubscribe}
   247â†’          />
   248â†’        ) : (
   249â†’          <SubscribeActions
   250â†’            pricing={skill.pricing}
   251â†’            onSubscribe={onSubscribe}
   252â†’            onTry={onTry}
   253â†’          />
   254â†’        )}
   255â†’      </div>
   256â†’    </div>
   257â†’  </div>
   258â†’</div>
   259â†’```
   260â†’
   261â†’### 2.5 Inline å˜ä½“
   262â†’
   263â†’ç”¨äºå¯¹è¯ä¸­å†…åµŒæ¨èã€‚
   264â†’
   265â†’```tsx
   266â†’// å®½åº¦ 100%ï¼ŒåµŒå…¥å¯¹è¯æµ
   267â†’
   268â†’<div className="my-3 p-4 rounded-xl bg-bg-callout border border-border-light">
   269â†’  <div className="flex items-start gap-3">
   270â†’    {/* Icon */}
   271â†’    <div
   272â†’      className="w-10 h-10 rounded-xl flex items-center justify-center text-xl shrink-0"
   273â†’      style={{ backgroundColor: `${skill.color}20` }}
   274â†’    >
   275â†’      {skill.icon}
   276â†’    </div>
   277â†’
   278â†’    {/* Content */}
   279â†’    <div className="flex-1 min-w-0">
   280â†’      <div className="flex items-center gap-2 mb-1">
   281â†’        <span className="text-xs text-accent font-medium">å‘ç°ç›¸å…³èƒ½åŠ›</span>
   282â†’      </div>
   283â†’      <h4 className="font-medium text-text-primary">{skill.name}</h4>
   284â†’      <p className="text-sm text-text-secondary mt-1">{context}</p>
   285â†’
   286â†’      {/* Actions */}
   287â†’      <div className="flex items-center gap-2 mt-3">
   288â†’        <button
   289â†’          onClick={onTry}
   290â†’          className="px-3 py-1.5 text-sm rounded-lg bg-accent text-white"
   291â†’        >
   292â†’          ç«‹å³è¯•ç”¨
   293â†’        </button>
   294â†’        <button
   295â†’          onClick={onLearnMore}
   296â†’          className="px-3 py-1.5 text-sm rounded-lg border border-border text-text-secondary hover:bg-bg-secondary"
   297â†’        >
   298â†’          äº†è§£æ›´å¤š
   299â†’        </button>
   300â†’      </div>
   301â†’    </div>
   302â†’
   303â†’    {/* Dismiss */}
   304â†’    <button
   305â†’      onClick={onDismiss}
   306â†’      className="text-text-tertiary hover:text-text-secondary"
   307â†’    >
   308â†’      <XIcon className="w-4 h-4" />
   309â†’    </button>
   310â†’  </div>
   311â†’</div>
   312â†’```
   313â†’
   314â†’---
   315â†’
   316â†’## 3. SkillList ç»„ä»¶
   317â†’
   318â†’```typescript
   319â†’interface SkillListProps {
   320â†’  skills: SkillMetadata[];
   321â†’  userStatuses: Record<string, SkillUserStatus>;
   322â†’  layout: 'list' | 'grid';
   323â†’  groupBy?: 'category' | 'none';
   324â†’  showFilters?: boolean;
   325â†’  onSkillClick: (skillId: string) => void;
   326â†’  onSubscribe: (skillId: string) => void;
   327â†’  onUnsubscribe: (skillId: string) => void;
   328â†’  onTogglePush: (skillId: string, enabled: boolean) => void;
   329â†’}
   330â†’```
   331â†’
   332â†’```tsx
   333â†’export function SkillList({
   334â†’  skills,
   335â†’  userStatuses,
   336â†’  layout = 'grid',
   337â†’  groupBy = 'category',
   338â†’  showFilters = true,
   339â†’  ...handlers
   340â†’}: SkillListProps) {
   341â†’  const [filter, setFilter] = useState<string>('all');
   342â†’
   343â†’  // åˆ†ç»„é€»è¾‘
   344â†’  const grouped = useMemo(() => {
   345â†’    if (groupBy === 'none') {
   346â†’      return { all: skills };
   347â†’    }
   348â†’    return groupBy === 'category'
   349â†’      ? groupByCategory(skills)
   350â†’      : { all: skills };
   351â†’  }, [skills, groupBy]);
   352â†’
   353â†’  return (
   354â†’    <div className="space-y-6">
   355â†’      {/* Filters */}
   356â†’      {showFilters && (
   357â†’        <div className="flex gap-2 overflow-x-auto pb-2">
   358â†’          {['all', 'professional', 'default', 'subscribed'].map((f) => (
   359â†’            <button
   360â†’              key={f}
   361â†’              onClick={() => setFilter(f)}
   362â†’              className={cn(
   363â†’                'px-4 py-1.5 text-sm rounded-full whitespace-nowrap transition-colors',
   364â†’                filter === f
   365â†’                  ? 'bg-accent text-white'
   366â†’                  : 'bg-bg-secondary text-text-secondary hover:bg-bg-tertiary'
   367â†’              )}
   368â†’            >
   369â†’              {FILTER_LABELS[f]}
   370â†’            </button>
   371â†’          ))}
   372â†’        </div>
   373â†’      )}
   374â†’
   375â†’      {/* Groups */}
   376â†’      {Object.entries(grouped).map(([group, groupSkills]) => (
   377â†’        <div key={group}>
   378â†’          {groupBy !== 'none' && (
   379â†’            <h2 className="text-lg font-semibold text-text-primary mb-3">
   380â†’              {CATEGORY_LABELS[group]}
   381â†’            </h2>
   382â†’          )}
   383â†’
   384â†’          <div
   385â†’            className={cn(
   386â†’              layout === 'grid'
   387â†’                ? 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4'
   388â†’                : 'space-y-2'
   389â†’            )}
   390â†’          >
   391â†’            {groupSkills
   392â†’              .filter((s) => filterMatch(s, filter, userStatuses[s.id]))
   393â†’              .map((skill) => (
   394â†’                <SkillCard
   395â†’                  key={skill.id}
   396â†’                  skill={skill}
   397â†’                  variant={layout === 'grid' ? 'card' : 'compact'}
   398â†’                  userStatus={userStatuses[skill.id]}
   399â†’                  onClick={() => handlers.onSkillClick(skill.id)}
   400â†’                  onSubscribe={() => handlers.onSubscribe(skill.id)}
   401â†’                  onUnsubscribe={() => handlers.onUnsubscribe(skill.id)}
   402â†’                  onTogglePush={(enabled) => handlers.onTogglePush(skill.id, enabled)}
   403â†’                />
   404â†’              ))}
   405â†’          </div>
   406â†’        </div>
   407â†’      ))}
   408â†’    </div>
   409â†’  );
   410â†’}
   411â†’```
   412â†’
   413â†’---
   414â†’
   415â†’## 4. SkillRecommendation ç»„ä»¶
   416â†’
   417â†’å¯¹è¯ä¸­çš„æ™ºèƒ½æ¨èå¡ç‰‡ã€‚
   418â†’
   419â†’```typescript
   420â†’interface SkillRecommendationProps {
   421â†’  recommendation: {
   422â†’    skill_id: string;
   423â†’    reason: 'based_on_conversation' | 'based_on_emotion' | 'based_on_profile';
   424â†’    context: string;
   425â†’    score: number;
   426â†’  };
   427â†’  skill: SkillMetadata;
   428â†’  onTry: () => void;
   429â†’  onLearnMore: () => void;
   430â†’  onDismiss: () => void;
   431â†’  onNeverShow: () => void;
   432â†’}
   433â†’```
   434â†’
   435â†’```tsx
   436â†’export function SkillRecommendation({
   437â†’  recommendation,
   438â†’  skill,
   439â†’  onTry,
   440â†’  onLearnMore,
   441â†’  onDismiss,
   442â†’  onNeverShow,
   443â†’}: SkillRecommendationProps) {
   444â†’  return (
   445â†’    <div className="my-4 animate-slide-in-up">
   446â†’      {/* ä½¿ç”¨ inline å˜ä½“çš„ SkillCard */}
   447â†’      <SkillCard
   448â†’        skill={skill}
   449â†’        variant="inline"
   450â†’        context={recommendation.context}
   451â†’        onTry={onTry}
   452â†’        onLearnMore={onLearnMore}
   453â†’      />
   454â†’
   455â†’      {/* åº•éƒ¨æ“ä½œ */}
   456â†’      <div className="flex items-center justify-end gap-4 mt-2 px-4">
   457â†’        <button
   458â†’          onClick={onNeverShow}
   459â†’          className="text-xs text-text-tertiary hover:text-text-secondary"
   460â†’        >
   461â†’          ä¸å†æ¨èæ­¤ Skill
   462â†’        </button>
   463â†’        <button
   464â†’          onClick={onDismiss}
   465â†’          className="text-xs text-text-tertiary hover:text-text-secondary"
   466â†’        >
   467â†’          æš‚æ—¶éšè—
   468â†’        </button>
   469â†’      </div>
   470â†’    </div>
   471â†’  );
   472â†’}
   473â†’```
   474â†’
   475â†’---
   476â†’
   477â†’## 5. SkillSettingsSection ç»„ä»¶
   478â†’
   479â†’è®¾ç½®é¡µé¢ä¸­çš„ Skill ç®¡ç†åŒºå—ã€‚
   480â†’
   481â†’```tsx
   482â†’export function SkillSettingsSection() {
   483â†’  const { subscriptions, togglePush, unsubscribe } = useSkillSubscription();
   484â†’  const router = useRouter();
   485â†’
   486â†’  // åˆ†ç»„ï¼šå·²è®¢é˜… vs å¯è®¢é˜…
   487â†’  const { subscribed, available } = useMemo(() => {
   488â†’    return {
   489â†’      subscribed: subscriptions.filter((s) => s.status === 'subscribed'),
   490â†’      available: subscriptions.filter((s) => s.status !== 'subscribed'),
   491â†’    };
   492â†’  }, [subscriptions]);
   493â†’
   494â†’  return (
   495â†’    <div className="space-y-6">
   496â†’      <div className="flex items-center justify-between">
   497â†’        <h2 className="text-xl font-semibold text-text-primary">Skill ç®¡ç†</h2>
   498â†’        <button
   499â†’          onClick={() => router.push('/skills')}
   500â†’          className="text-sm text-accent hover:underline"
   501â†’        >
   502â†’          æ¢ç´¢æ›´å¤š â†’
   503â†’        </button>
   504â†’      </div>
   505â†’
   506â†’      {/* å·²è®¢é˜… */}
   507â†’      <div>
   508â†’        <h3 className="text-sm font-medium text-text-secondary mb-3">
   509â†’          å·²è®¢é˜… ({subscribed.length})
   510â†’        </h3>
   511â†’        <div className="space-y-2">
   512â†’          {subscribed.map((sub) => (
   513â†’            <SkillSettingsItem
   514â†’              key={sub.skill_id}
   515â†’              subscription={sub}
   516â†’              onTogglePush={(enabled) => togglePush(sub.skill_id, enabled)}
   517â†’              onUnsubscribe={() => unsubscribe(sub.skill_id)}
   518â†’            />
   519â†’          ))}
   520â†’        </div>
   521â†’      </div>
   522â†’
   523â†’      {/* å¯è®¢é˜… */}
   524â†’      {available.length > 0 && (
   525â†’        <div>
   526â†’          <h3 className="text-sm font-medium text-text-secondary mb-3">
   527â†’            å¯è®¢é˜… ({available.length})
   528â†’          </h3>
   529â†’          <div className="space-y-2">
   530â†’            {available.slice(0, 3).map((sub) => (
   531â†’              <SkillSettingsItem
   532â†’                key={sub.skill_id}
   533â†’                subscription={sub}
   534â†’                variant="available"
   535â†’              />
   536â†’            ))}
   537â†’          </div>
   538â†’        </div>
   539â†’      )}
   540â†’    </div>
   541â†’  );
   542â†’}
   543â†’
   544â†’function SkillSettingsItem({
   545â†’  subscription,
   546â†’  variant = 'subscribed',
   547â†’  onTogglePush,
   548â†’  onUnsubscribe,
   549â†’}: {
   550â†’  subscription: SkillSubscription;
   551â†’  variant?: 'subscribed' | 'available';
   552â†’  onTogglePush?: (enabled: boolean) => void;
   553â†’  onUnsubscribe?: () => void;
   554â†’}) {
   555â†’  const skill = useSkillMetadata(subscription.skill_id);
   556â†’  if (!skill) return null;
   557â†’
   558â†’  const isCore = skill.category === 'core';
   559â†’
   560â†’  return (
   561â†’    <div className="flex items-center gap-3 p-3 rounded-lg bg-bg-card">
   562â†’      {/* Icon */}
   563â†’      <div
   564â†’        className="w-10 h-10 rounded-xl flex items-center justify-center text-xl"
   565â†’        style={{ backgroundColor: `${skill.color}20` }}
   566â†’      >
   567â†’        {skill.icon}
   568â†’      </div>
   569â†’
   570â†’      {/* Info */}
   571â†’      <div className="flex-1 min-w-0">
   572â†’        <div className="flex items-center gap-2">
   573â†’          <span className="font-medium text-text-primary">{skill.name}</span>
   574â†’          {isCore && (
   575â†’            <span className="px-1.5 py-0.5 text-xs rounded bg-accent/10 text-accent">
   576â†’              å§‹ç»ˆæ¿€æ´»
   577â†’            </span>
   578â†’          )}
   579â†’        </div>
   580â†’        <p className="text-xs text-text-secondary truncate">
   581â†’          {skill.features.slice(0, 2).map((f) => f.name).join(' Â· ')}
   582â†’        </p>
   583â†’      </div>
   584â†’
   585â†’      {/* Actions */}
   586â†’      {variant === 'subscribed' ? (
   587â†’        <div className="flex items-center gap-3">
   588â†’          {!isCore && (
   589â†’            <>
   590â†’              <div className="flex items-center gap-2">
   591â†’                <span className="text-xs text-text-tertiary">æ¨é€</span>
   592â†’                <Toggle
   593â†’                  checked={subscription.push_enabled}
   594â†’                  onChange={onTogglePush}
   595â†’                  size="sm"
   596â†’                />
   597â†’              </div>
   598â†’              <button
   599â†’                onClick={onUnsubscribe}
   600â†’                className="text-xs text-error hover:underline"
   601â†’              >
   602â†’                å–æ¶ˆè®¢é˜…
   603â†’              </button>
   604â†’            </>
   605â†’          )}
   606â†’        </div>
   607â†’      ) : (
   608â†’        <button className="px-3 py-1 text-xs rounded-full bg-accent text-white">
   609â†’          è®¢é˜…
   610â†’        </button>
   611â†’      )}
   612â†’    </div>
   613â†’  );
   614â†’}
   615â†’```
   616â†’
   617â†’---
   618â†’
   619â†’## 6. SkillHomeWidget ç»„ä»¶
   620â†’
   621â†’é¦–é¡µä¾§è¾¹æ æ¨èå¡ç‰‡ã€‚
   622â†’
   623â†’```tsx
   624â†’export function SkillHomeWidget() {
   625â†’  const { recommendations, isLoading } = useSkillRecommendations();
   626â†’  const router = useRouter();
   627â†’
   628â†’  if (isLoading) {
   629â†’    return <SkillHomeWidgetSkeleton />;
   630â†’  }
   631â†’
   632â†’  if (!recommendations || recommendations.length === 0) {
   633â†’    return null;
   634â†’  }
   635â†’
   636â†’  const topRecommendation = recommendations[0];
   637â†’  const skill = useSkillMetadata(topRecommendation.skill_id);
   638â†’
   639â†’  if (!skill) return null;
   640â†’
   641â†’  return (
   642â†’    <Card variant="default" padding="md" className="mb-4">
   643â†’      <div className="flex items-center gap-2 mb-3">
   644â†’        <span className="text-sm">ğŸ’¡</span>
   645â†’        <h3 className="text-sm font-semibold text-text-primary">ä¸ºä½ æ¨è</h3>
   646â†’      </div>
   647â†’
   648â†’      <div
   649â†’        className="p-3 rounded-xl cursor-pointer hover:bg-bg-secondary transition-colors"
   650â†’        style={{ background: `linear-gradient(135deg, ${skill.color}10, transparent)` }}
   651â†’        onClick={() => router.push(`/skills/${skill.id}`)}
   652â†’      >
   653â†’        <div className="flex items-center gap-3 mb-2">
   654â†’          <div
   655â†’            className="w-10 h-10 rounded-xl flex items-center justify-center text-xl"
   656â†’            style={{ backgroundColor: `${skill.color}20` }}
   657â†’          >
   658â†’            {skill.icon}
   659â†’          </div>
   660â†’          <div>
   661â†’            <h4 className="font-medium text-text-primary">{skill.name}</h4>
   662â†’            <p className="text-xs text-text-secondary">{skill.showcase.tagline}</p>
   663â†’          </div>
   664â†’        </div>
   665â†’
   666â†’        <p className="text-sm text-text-secondary mb-3">
   667â†’          {topRecommendation.context}
   668â†’        </p>
   669â†’
   670â†’        <div className="flex items-center justify-between">
   671â†’          <span className="text-xs text-text-tertiary">
   672â†’            {skill.pricing.trial_messages} æ¡å…è´¹ä½“éªŒ
   673â†’          </span>
   674â†’          <span className="text-xs text-accent font-medium">
   675â†’            ç«‹å³ä½“éªŒ â†’
   676â†’          </span>
   677â†’        </div>
   678â†’      </div>
   679â†’
   680â†’      <button
   681â†’        onClick={() => router.push('/skills')}
   682â†’        className="w-full mt-3 text-xs text-text-secondary hover:text-accent text-center"
   683â†’      >
   684â†’        æŸ¥çœ‹å…¨éƒ¨ Skill â†’
   685â†’      </button>
   686â†’    </Card>
   687â†’  );
   688â†’}
   689â†’```
   690â†’
   691â†’---
   692â†’
   693â†’## 7. Hooks
   694â†’
   695â†’### 7.1 useSkillSubscription
   696â†’
   697â†’```typescript
   698â†’// hooks/useSkillSubscription.ts
   699â†’
   700â†’export function useSkillSubscription() {
   701â†’  const { user } = useAuth();
   702â†’  const queryClient = useQueryClient();
   703â†’
   704â†’  // è·å–è®¢é˜…åˆ—è¡¨
   705â†’  const { data: subscriptions = [], isLoading } = useQuery({
   706â†’    queryKey: ['skill-subscriptions', user?.id],
   707â†’    queryFn: () => api.get('/skills/subscriptions').then((r) => r.data.subscriptions),
   708â†’    enabled: !!user,
   709â†’  });
   710â†’
   711â†’  // è®¢é˜…
   712â†’  const subscribeMutation = useMutation({
   713â†’    mutationFn: (skillId: string) => api.post(`/skills/${skillId}/subscribe`),
   714â†’    onSuccess: () => queryClient.invalidateQueries(['skill-subscriptions']),
   715â†’  });
   716â†’
   717â†’  // å–æ¶ˆè®¢é˜…
   718â†’  const unsubscribeMutation = useMutation({
   719â†’    mutationFn: (skillId: string) => api.post(`/skills/${skillId}/unsubscribe`),
   720â†’    onSuccess: () => queryClient.invalidateQueries(['skill-subscriptions']),
   721â†’  });
   722â†’
   723â†’  // åˆ‡æ¢æ¨é€
   724â†’  const togglePushMutation = useMutation({
   725â†’    mutationFn: ({ skillId, enabled }: { skillId: string; enabled: boolean }) =>
   726â†’      api.post(`/skills/${skillId}/push`, { enabled }),
   727â†’    onSuccess: () => queryClient.invalidateQueries(['skill-subscriptions']),
   728â†’  });
   729â†’
   730â†’  return {
   731â†’    subscriptions,
   732â†’    isLoading,
   733â†’    subscribe: (skillId: string) => subscribeMutation.mutateAsync(skillId),
   734â†’    unsubscribe: (skillId: string) => unsubscribeMutation.mutateAsync(skillId),
   735â†’    togglePush: (skillId: string, enabled: boolean) =>
   736â†’      togglePushMutation.mutateAsync({ skillId, enabled }),
   737â†’    isSubscribed: (skillId: string) =>
   738â†’      subscriptions.some((s) => s.skill_id === skillId && s.status === 'subscribed'),
   739â†’    isPushEnabled: (skillId: string) =>
   740â†’      subscriptions.find((s) => s.skill_id === skillId)?.push_enabled ?? false,
   741â†’  };
   742â†’}
   743â†’```
   744â†’
   745â†’### 7.2 useSkillRecommendations
   746â†’
   747â†’```typescript
   748â†’// hooks/useSkillRecommendations.ts
   749â†’
   750â†’export function useSkillRecommendations(options?: {
   751â†’  limit?: number;
   752â†’  context?: string;
   753â†’}) {
   754â†’  const { user } = useAuth();
   755â†’
   756â†’  const { data, isLoading, refetch } = useQuery({
   757â†’    queryKey: ['skill-recommendations', user?.id, options?.context],
   758â†’    queryFn: () =>
   759â†’      api
   760â†’        .get('/skills/recommendations', {
   761â†’          params: { limit: options?.limit, context: options?.context },
   762â†’        })
   763â†’        .then((r) => r.data.recommendations),
   764â†’    enabled: !!user,
   765â†’    staleTime: 5 * 60 * 1000, // 5 åˆ†é’Ÿç¼“å­˜
   766â†’  });
   767â†’
   768â†’  return {
   769â†’    recommendations: data,
   770â†’    isLoading,
   771â†’    refresh: refetch,
   772â†’  };
   773â†’}
   774â†’```
   775â†’
   776â†’---
   777â†’
   778â†’## 8. é¡µé¢ç»„ä»¶
   779â†’
   780â†’### 8.1 Skill å¸‚åœºé¡µé¢
   781â†’
   782â†’```tsx
   783â†’// app/skills/page.tsx
   784â†’
   785â†’export default function SkillMarketPage() {
   786â†’  const { data: skills, isLoading } = useSkills();
   787â†’  const { subscriptions } = useSkillSubscription();
   788â†’  const router = useRouter();
   789â†’
   790â†’  const userStatuses = useMemo(() => {
   791â†’    return subscriptions.reduce((acc, sub) => {
   792â†’      acc[sub.skill_id] = {
   793â†’        subscribed: sub.status === 'subscribed',
   794â†’        push_enabled: sub.push_enabled,
   795â†’        trial_messages_used: sub.trial_messages_used,
   796â†’        trial_messages_remaining:
   797â†’          (skills?.find((s) => s.id === sub.skill_id)?.pricing.trial_messages ?? 0) -
   798â†’          sub.trial_messages_used,
   799â†’      };
   800â†’      return acc;
   801â†’    }, {} as Record<string, SkillUserStatus>);
   802â†’  }, [subscriptions, skills]);
   803â†’
   804â†’  return (
   805â†’    <PageLayout
   806â†’      title="æ¢ç´¢ Skill"
   807â†’      breadcrumb={[{ label: 'é¦–é¡µ', href: '/' }, { label: 'æ¢ç´¢ Skill' }]}
   808â†’    >
   809â†’      {/* Featured Section */}
   810â†’      <section className="mb-8">
   811â†’        <h2 className="text-lg font-semibold text-text-primary mb-4">ç²¾é€‰æ¨è</h2>
   812â†’        <FeaturedSkillCarousel skills={skills?.filter((s) => s.featured)} />
   813â†’      </section>
   814â†’
   815â†’      {/* All Skills */}
   816â†’      <section>
   817â†’        <SkillList
   818â†’          skills={skills ?? []}
   819â†’          userStatuses={userStatuses}
   820â†’          layout="grid"
   821â†’          groupBy="category"
   822â†’          showFilters
   823â†’          onSkillClick={(id) => router.push(`/skills/${id}`)}
   824â†’          onSubscribe={handleSubscribe}
   825â†’          onUnsubscribe={handleUnsubscribe}
   826â†’          onTogglePush={handleTogglePush}
   827â†’        />
   828â†’      </section>
   829â†’    </PageLayout>
   830â†’  );
   831â†’}
   832â†’```
   833â†’
   834â†’---
   835â†’
   836â†’## 9. åŠ¨ç”»ä¸äº¤äº’
   837â†’
   838â†’### 9.1 CSS åŠ¨ç”»
   839â†’
   840â†’```css
   841â†’/* globals.css */
   842â†’
   843â†’/* å¡ç‰‡å‡ºç°åŠ¨ç”» */
   844â†’@keyframes slide-in-up {
   845â†’  from {
   846â†’    opacity: 0;
   847â†’    transform: translateY(10px);
   848â†’  }
   849â†’  to {
   850â†’    opacity: 1;
   851â†’    transform: translateY(0);
   852â†’  }
   853â†’}
   854â†’
   855â†’.animate-slide-in-up {
   856â†’  animation: slide-in-up 0.3s ease-out;
   857â†’}
   858â†’
   859â†’/* æ¨èå¡ç‰‡è„‰åŠ¨æ•ˆæœ */
   860â†’@keyframes pulse-glow {
   861â†’  0%, 100% {
   862â†’    box-shadow: 0 0 0 0 var(--skill-color, #6366f1)20;
   863â†’  }
   864â†’  50% {
   865â†’    box-shadow: 0 0 0 8px var(--skill-color, #6366f1)00;
   866â†’  }
   867â†’}
   868â†’
   869â†’.animate-pulse-glow {
   870â†’  animation: pulse-glow 2s ease-in-out infinite;
   871â†’}
   872â†’
   873â†’/* å¼€å…³åˆ‡æ¢ */
   874â†’.toggle-switch {
   875â†’  transition: background-color 0.2s ease;
   876â†’}
   877â†’
   878â†’.toggle-switch-thumb {
   879â†’  transition: transform 0.2s ease;
   880â†’}
   881â†’```
   882â†’
   883â†’### 9.2 äº¤äº’åé¦ˆ
   884â†’
   885â†’```typescript
   886â†’// è®¢é˜…æˆåŠŸ Toast
   887â†’toast.success(`å·²è®¢é˜…ã€Œ${skill.name}ã€`, {
   888â†’  description: 'å¼€å§‹æ¢ç´¢æ–°èƒ½åŠ›å§ï¼',
   889â†’  action: {
   890â†’    label: 'ç«‹å³ä½“éªŒ',
   891â†’    onClick: () => router.push('/chat'),
   892â†’  },
   893â†’});
   894â†’
   895â†’// å–æ¶ˆè®¢é˜…ç¡®è®¤
   896â†’const confirmed = await confirm({
   897â†’  title: `ç¡®å®šå–æ¶ˆè®¢é˜…ã€Œ${skill.name}ã€ï¼Ÿ`,
   898â†’  description: 'å–æ¶ˆåå°†æ— æ³•ç»§ç»­ä½¿ç”¨è¯¥ Skill çš„åŠŸèƒ½å’Œæ¨é€ã€‚',
   899â†’  confirmText: 'å–æ¶ˆè®¢é˜…',
   900â†’  cancelText: 'ä¿ç•™è®¢é˜…',
   901â†’  variant: 'warning',
   902â†’});
   903â†’```
   904â†’
   905â†’---
   906â†’
   907â†’## 10. å“åº”å¼è®¾è®¡
   908â†’
   909â†’| æ–­ç‚¹ | Skill å¸‚åœº | å¡ç‰‡å˜ä½“ | åˆ—å¸ƒå±€ |
   910â†’|------|-----------|---------|--------|
   911â†’| < 640px | å•åˆ— | compact | 1 |
   912â†’| 640-1024px | åŒåˆ— | card | 2 |
   913â†’| > 1024px | ä¸‰åˆ— | card | 3 |
   914â†’
   915â†’```tsx
   916â†’// å“åº”å¼ç½‘æ ¼
   917â†’<div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
   918â†’  {skills.map((skill) => (
   919â†’    <SkillCard key={skill.id} skill={skill} variant="card" />
   920â†’  ))}
   921â†’</div>
   922â†’
   923â†’// ç§»åŠ¨ç«¯ä½¿ç”¨ compact å˜ä½“
   924â†’<div className="sm:hidden space-y-2">
   925â†’  {skills.map((skill) => (
   926â†’    <SkillCard key={skill.id} skill={skill} variant="compact" />
   927â†’  ))}
   928â†’</div>
   929â†’```
   930â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
