     1→# VibeID 设计文档 v5.0
     2→
     3→> **版本**: 5.0
     4→> **更新日期**: 2026-01-16
     5→> **核心定位**: 成长陪伴型人格操作系统
     6→> **本次升级**: 中等深度八字算法 + 五点星盘模型 + 八字主导融合 + 可解释性模块
     7→
     8→---
     9→
    10→## 一、设计哲学
    11→
    12→### 1.1 核心理念
    13→
    14→VibeID 是一个融合东方命理智慧与西方心理学洞察的人格操作系统，旨在成为用户的**成长陪伴者**。
    15→
    16→**三个核心信念**：
    17→
    18→1. **人格是多维的**：每个人都是多个原型能量的独特组合，而非单一标签
    19→2. **阴影是宝藏**：被我们否认的部分往往藏着成长的金钥匙
    20→3. **成长是过程**：自我认知不是一次性"算出来"的，而是在陪伴中逐渐"发现"的
    21→
    22→### 1.2 心理学基础
    23→
    24→#### 荣格分析心理学
    25→
    26→**集体无意识与原型的本质**
    27→
    28→荣格提出的「集体无意识」(Collective Unconscious) 是VibeID系统的哲学基石。与弗洛伊德的个人无意识不同，集体无意识是人类共同继承的心理遗产——一种超越个人经验、植根于人类进化历程的深层心理结构。
    29→
    30→```
    31→┌─────────────────────────────────────────────────────────────────┐
    32→│                                                                 │
    33→│                    荣格心理结构模型                             │
    34→│                                                                 │
    35→├─────────────────────────────────────────────────────────────────┤
    36→│                                                                 │
    37→│                      ┌─────────────┐                           │
    38→│                      │   自我 Ego   │  ← 意识层：日常觉知       │
    39→│                      └──────┬──────┘                           │
    40→│                             │                                   │
    41→│           ╔═════════════════╧═════════════════╗                │
    42→│           ║         人格面具 Persona          ║ ← 社会角色      │
    43→│           ╚═════════════════╤═════════════════╝                │
    44→│                             │                                   │
    45→│  ┌──────────────────────────┼──────────────────────────────┐   │
    46→│  │                          │                              │   │
    47→│  │    ┌─────────┐    ┌─────┴─────┐    ┌─────────┐        │   │
    48→│  │    │  阴影   │    │  阿尼玛/  │    │  自性   │        │   │
    49→│  │    │ Shadow  │    │ 阿尼姆斯  │    │  Self   │        │   │
    50→│  │    └─────────┘    └───────────┘    └─────────┘        │   │
    51→│  │                                                        │   │
    52→│  │                  【个人无意识】                         │   │
    53→│  └──────────────────────────┬─────────────────────────────┘   │
    54→│                             │                                   │
    55→│  ╔══════════════════════════╧══════════════════════════════╗   │
    56→│  ║                                                          ║   │
    57→│  ║                    【集体无意识】                        ║   │
    58→│  ║                                                          ║   │
    59→│  ║   ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐          ║   │
    60→│  ║   │ 英雄   │ │ 智者   │ │ 母亲   │ │ 创造者 │ ...     ║   │
    61→│  ║   │ 原型   │ │ 原型   │ │ 原型   │ │ 原型   │          ║   │
    62→│  ║   └────────┘ └────────┘ └────────┘ └────────┘          ║   │
    63→│  ║                                                          ║   │
    64→│  ║            人类共同的心理遗产 · 跨文化普遍存在           ║   │
    65→│  ║                                                          ║   │
    66→│  ╚══════════════════════════════════════════════════════════╝   │
    67→│                                                                 │
    68→└─────────────────────────────────────────────────────────────────┘
    69→```
    70→
    71→**原型的四大本质特征**
    72→
    73→荣格的原型不是具体的形象，而是一种**心理潜能的模式**——它们像是心灵的"磁场"，吸引和组织着我们的经验、情感和行为。
    74→
    75→1. **先验性 (A Priori)**
    76→   - 原型先于个人经验存在，是"心灵的本能"
    77→   - 就像鸟儿不需要学习就知道如何筑巢
    78→   - **应用意义**：这解释了为什么八字命理中的"先天八字"能映射人格——出生时刻的宇宙能量配置激活了特定的原型潜能
    79→
    80→2. **普遍性 (Universality)**
    81→   - 所有人类文化中都能找到相同的原型主题：英雄之旅、智慧老人、伟大母亲...
    82→   - **应用意义**：这解释了为什么东方八字、西方星座能够在同一个原型框架下统一——因为它们描述的是同一套人类心理的普遍结构
    83→
    84→3. **两极性 (Bipolarity)**
    85→   - 每个原型都包含光明面和阴暗面：英雄 ←→ 暴君 | 照顾者 ←→ 殉道者 | 智者 ←→ 脱离
    86→   - **应用意义**：这为系统提供了"成长空间"的理论基础——原型不是静态标签，而是发展维度
    87→
    88→4. **动力性 (Dynamism)**
    89→   - 原型不是静止的，它们有能量、有意图、会"呼唤"我们
    90→   - 当原型被激活，会产生强烈的情感体验和行为驱力
    91→   - **应用意义**：这为"Vibe能量"和"行运系统"提供了理论基础——不同时间不同原型能量的起伏，创造了命运的节奏
    92→
    93→**12原型的深层结构**
    94→
    95→荣格的12原型并非随意分类，而是基于人类两大核心心理动力的组合：
    96→
    97→```
    98→        核心驱力1: 自我实现
    99→        "我是谁？我的独特性是什么？"
   100→                    ↑
   101→                    │
   102→             【独立/自我】
   103→                    │
   104→    ┌───────────────┼───────────────┐
   105→    │               │               │
   106→【稳定】←───────────┼───────────→【变革】
   107→    │               │               │
   108→    │        【归属/连接】          │
   109→    │               │               │
   110→    └───────────────┼───────────────┘
   111→                    │
   112→                    ↓
   113→        核心驱力2: 归属联结
   114→        "我属于哪里？我与谁连接？"
   115→```
   116→
   117→**四象限 × 三层次 = 12原型**：
   118→
   119→| 象限 | 核心追求 | 层次1 | 层次2 | 层次3 |
   120→|------|----------|-------|-------|-------|
   121→| 独立+稳定 | 自我实现与内在秩序 | Innocent (纯粹自我认同) | Sage (理解自我与世界) | Explorer (发现真实自我) |
   122→| 独立+变革 | 自我实现与外在突破 | Hero (证明自我价值) | Outlaw (打破限制框架) | Magician (转化自我与现实) |
   123→| 归属+稳定 | 连接与和谐保持 | Regular (归属于群体) | Caregiver (照顾他人建立连接) | Ruler (建立秩序保护群体) |
   124→| 归属+变革 | 连接与积极改变 | Lover (与他人深度连接) | Jester (通过欢乐建立连接) | Creator (创造新事物贡献群体) |
   125→
   126→#### 阿德勒个体心理学
   127→
   128→- **自卑与超越**：每个人都有自卑感，这是成长的动力而非病态
   129→- **社会兴趣**：真正的幸福来自于与他人、与社会的连接
   130→- **生活风格**：每个人独特的存在方式和应对模式
   131→
   132→#### 应用原则
   133→
   134→- 我们借鉴这些心理学框架的洞察力，而非机械套用
   135→- 所有分析都是"倾向性推测"而非"确定性断言"
   136→- 强调赋能和成长，而非贴标签和定性
   137→
   138→### 1.3 东西方融合的哲学（v5.0 升级）
   139→
   140→**东方智慧**（八字命理）—— **主导地位 (70%)**：
   141→- 提供"先天能量格局"的视角
   142→- 强调时间（出生时刻）对人格的影响
   143→- 关注五行能量的平衡与流转
   144→- **v5.0新增**：考虑日主强弱、用神喜忌，决定Core原型
   145→
   146→**西方洞察**（占星学）—— **补充地位 (30%)**：
   147→- 提供"天体能量影响"的视角
   148→- **v5.0升级**：五点模型（太阳、月亮、上升、金星、火星）
   149→- 太阳：核心自我（35%）
   150→- 月亮：情感需求（25%）
   151→- 上升：社会面具（20%）
   152→- 金星：爱情风格（10%）
   153→- 火星：行动风格（10%）
   154→
   155→**融合原则（v5.0 升级）**：
   156→- **八字主导**：八字决定Core原型，星座调整表达细节
   157→- **一致性奖励**：当两套体系指向同一原型时，置信度大幅提升（+15%）
   158→- **冲突处理**：当两套体系指向对立原型时，以八字为准，星座作为"表达层调节"
   159→
   160→---
   161→
   162→## 二、四维人格模型
   163→
   164→### 2.1 模型概述
   165→
   166→```
   167→┌─────────────────────────────────────────────────────────────────┐
   168→│                                                                 │
   169→│                      VibeID 四维人格模型 v5.0                   │
   170→│                                                                 │
   171→├─────────────────────────────────────────────────────────────────┤
   172→│                                                                 │
   173→│   ┌─────────┐                                                   │
   174→│   │  Core   │ ← 灵魂本质：你最深层的驱动力                      │
   175→│   │  原型   │   来源：八字(格局+用神) 70% + 太阳星座 30%        │
   176→│   └────┬────┘                                                   │
   177→│        │                                                        │
   178→│   ┌────┴────┐                                                   │
   179→│   │  Inner  │ ← 内在世界：你如何处理情绪和需求                  │
   180→│   │  原型   │   来源：月亮星座 + 金星星座                       │
   181→│   └────┬────┘                                                   │
   182→│        │                                                        │
   183→│   ┌────┴────┐                                                   │
   184→│   │  Outer  │ ← 外在呈现：你展示给世界的形象                    │
   185→│   │  原型   │   来源：上升星座 + 火星星座                       │
   186→│   └────┬────┘                                                   │
   187→│        │                                                        │
   188→│   ┌────┴────┐                                                   │
   189→│   │ Shadow  │ ← 阴影倾向：你可能否认或回避的能量                │
   190→│   │  原型   │   来源：渐进式发现                                │
   191→│   └─────────┘                                                   │
   192→│                                                                 │
   193→└─────────────────────────────────────────────────────────────────┘
   194→```
   195→
   196→### 2.2 十二原型体系
   197→
   198→#### 原型命名（正式名 + 昵称 + Slogan）
   199→
   200→| 原型 | 正式名 | 昵称 | Slogan | 核心驱动 | 核心恐惧 |
   201→|------|--------|------|--------|----------|----------|
   202→| Innocent | 天真者 | 小确幸本幸 | "世界很好，我也很好" | 追求幸福与安全 | 害怕受到惩罚或伤害 |
   203→| Explorer | 探险家 | 说走就走型人格 | "人间值得，去看看" | 追求自由与发现 | 害怕空虚或被困住 |
   204→| Sage | 智者 | 人间清醒代表 | "想明白了才能活明白" | 追求真理与理解 | 害怕无知或被欺骗 |
   205→| Hero | 英雄 | 搞事业的命 | "要么出众，要么出局" | 追求掌控与证明 | 害怕软弱或无能 |
   206→| Outlaw | 叛逆者 | 人间清醒叛逆版 | "规则？我自己定" | 追求变革与解放 | 害怕无力或被控制 |
   207→| Magician | 魔术师 | 现实扭曲力场 | "想到就能做到" | 追求转化与实现 | 害怕意外的负面后果 |
   208→| Regular | 凡人 | 人间真实 | "做自己就很好" | 追求归属与连接 | 害怕被排斥或孤立 |
   209→| Lover | 爱人 | 为爱发电体质 | "爱我所爱，无问西东" | 追求亲密与体验 | 害怕孤独或不被爱 |
   210→| Jester | 愚者 | 氛围感担当 | "人生苦短，先甜一会" | 追求快乐与当下 | 害怕无聊或被忽视 |
   211→| Caregiver | 照顾者 | 人形安全感 | "有我在，别怕" | 追求帮助与保护 | 害怕自私或被需要 |
   212→| Creator | 创造者 | 审美在线本人 | "表达是我的呼吸" | 追求创新与表达 | 害怕平庸或无意义 |
   213→| Ruler | 统治者 | 大局观选手 | "一切尽在掌控" | 追求掌控与秩序 | 害怕混乱或失控 |
   214→
   215→#### 原型完整内容定义
   216→
   217→每个原型包含完整的内容体系，用于产品呈现和社交分享：
   218→
   219→**#1 Innocent 天真者 / 小确幸本幸**
   220→- **核心描述**：你是人群中的一道光，自带「岁月静好」滤镜。不是天真，而是选择相信世界本该美好。你的存在让周围的人也变得柔软。
   221→- **超能力**：感染力、治愈力、保持初心
   222→- **成长点**：建立边界感、接受不完美、面对阴暗面
   223→- **成长方向**：在保持纯真的同时发展智慧，学会辨别而非盲目信任
   224→- **最配原型**：Caregiver（人形安全感）
   225→- **需注意原型**：Outlaw（人间清醒叛逆版）
   226→- **稀有度**：8%
   227→
   228→**#2 Explorer 探险家 / 说走就走型人格**
   229→- **核心描述**：你的灵魂是一只不愿被笼养的鸟。安稳对你来说是一种慢性窒息，只有未知才能点燃你的生命力。你活着不是为了抵达，而是为了路上。
   230→- **超能力**：适应力、好奇心、打破舒适区
   231→- **成长点**：深度关系、长期承诺、专注坚持
   232→- **成长方向**：学会深耕，在自由探索中也能建立持久的连接
   233→- **最配原型**：Caregiver（人形安全感）
   234→- **需注意原型**：Ruler（大局观选手）
   235→- **稀有度**：10%
   236→
   237→**#3 Sage 智者 / 人间清醒代表**
   238→- **核心描述**：你的大脑是一台永不停歇的分析机器。对你来说，「不明白」比「不舒服」更难忍受。你追求的不是答案，而是理解本身。
   239→- **超能力**：洞察力、分析力、独立思考
   240→- **成长点**：行动力、情感表达、接受不确定
   241→- **成长方向**：将智慧转化为行动，不仅追求理解，更要实践和分享
   242→- **最配原型**：Explorer（说走就走型人格）
   243→- **需注意原型**：Jester（氛围感担当）
   244→- **稀有度**：7%
   245→
   246→**#4 Hero 英雄 / 搞事业的命**
   247→- **核心描述**：你骨子里有一团不服输的火。挑战越大，你越兴奋。别人眼中的困难，在你看来是证明自己的舞台。
   248→- **超能力**：勇气、决心、执行力
   249→- **成长点**：接受帮助、允许失败、关注过程
   250→- **成长方向**：学会接纳脆弱，在保持勇气的同时培养同理心
   251→- **最配原型**：Sage（人间清醒代表）
   252→- **需注意原型**：Innocent（小确幸本幸）
   253→- **稀有度**：9%
   254→
   255→**#5 Outlaw 叛逆者 / 人间清醒叛逆版**
   256→- **核心描述**：规则在你眼里只是「别人的共识」。你不是为了叛逆而叛逆，而是因为你看到了更好的可能性。打破，是为了重建。
   257→- **超能力**：突破力、真实感、革新精神
   258→- **成长点**：建设性表达、团队协作、选择战场
   259→- **成长方向**：将叛逆转化为建设性的变革，找到值得为之战斗的事业
   260→- **最配原型**：Magician（现实扭曲力场）
   261→- **需注意原型**：Ruler（大局观选手）
   262→- **稀有度**：6%
   263→
   264→**#6 Magician 魔术师 / 现实扭曲力场**
   265→- **核心描述**：你相信「不可能」只是暂时的。在你的世界里，想象力就是生产力。你不是在做梦，你是在创造现实。
   266→- **超能力**：转化力、直觉力、创造奇迹
   267→- **成长点**：脚踏实地、耐心等待、接受局限
   268→- **成长方向**：将洞察用于帮助他人，而非仅仅掌控局势
   269→- **最配原型**：Outlaw（人间清醒叛逆版）
   270→- **需注意原型**：Regular（人间真实）
   271→- **稀有度**：5%
   272→
   273→**#7 Regular 凡人 / 人间真实**
   274→- **核心描述**：你是人群中最真实的存在。不装、不作、不卷。你的力量来自于「做好自己」的笃定，而不是「成为别人」的焦虑。
   275→- **超能力**：共情力、可靠感、脚踏实地
   276→- **成长点**：表达独特性、追求卓越、突破舒适区
   277→- **成长方向**：在归属中保持独特性，勇敢表达自己的观点
   278→- **最配原型**：Caregiver（人形安全感）
   279→- **需注意原型**：Magician（现实扭曲力场）
   280→- **稀有度**：12%
   281→
   282→**#8 Lover 爱人 / 为爱发电体质**
   283→- **核心描述**：你的心是一个永不枯竭的能量源。一旦爱上什么，就会全身心投入。对你来说，没有热爱的生活不值得过。
   284→- **超能力**：热情、感染力、全情投入
   285→- **成长点**：保持边界、理性判断、自我关爱
   286→- **成长方向**：在关系中保持独立性，避免失去自我
   287→- **最配原型**：Creator（审美在线本人）
   288→- **需注意原型**：Sage（人间清醒代表）
   289→- **稀有度**：11%
   290→
   291→**#9 Jester 愚者 / 氛围感担当**
   292→- **核心描述**：你是人群中的快乐源泉。不是因为你没有烦恼，而是因为你选择用轻盈的方式面对沉重。你的存在让世界变得不那么严肃。
   293→- **超能力**：幽默感、活在当下、化解尴尬
   294→- **成长点**：深度思考、长期规划、面对严肃
   295→- **成长方向**：在欢乐中找到深度，让幽默服务于真正重要的事
   296→- **最配原型**：Explorer（说走就走型人格）
   297→- **需注意原型**：Sage（人间清醒代表）
   298→- **稀有度**：8%
   299→
   300→**#10 Caregiver 照顾者 / 人形安全感**
   301→- **核心描述**：你是别人生命中的「安全港」。看到在乎的人过得不好，比自己难受还难受。你的爱是行动，不是言语。
   302→- **超能力**：滋养力、保护欲、无条件支持
   303→- **成长点**：自我关爱、设立边界、允许他人成长
   304→- **成长方向**：学会照顾自己，建立健康的边界，避免过度付出
   305→- **最配原型**：Innocent（小确幸本幸）
   306→- **需注意原型**：Explorer（说走就走型人格）
   307→- **稀有度**：10%
   308→
   309→**#11 Creator 创造者 / 审美在线本人**
   310→- **核心描述**：你的眼睛自带「美学滤镜」。看到丑的东西会难受，必须按自己的审美来才舒服。表达不是选择，是本能。
   311→- **超能力**：创造力、审美力、独特表达
   312→- **成长点**：完成比完美重要、接受平凡、团队协作
   313→- **成长方向**：完成作品而非追求完美，让创意真正落地
   314→- **最配原型**：Lover（为爱发电体质）
   315→- **需注意原型**：Regular（人间真实）
   316→- **稀有度**：7%
   317→
   318→**#12 Ruler 统治者 / 大局观选手**
   319→- **核心描述**：你天生有一种「主持大局」的气场。看到混乱的局面，就忍不住想站出来。你追求的不是权力，而是秩序。
   320→- **超能力**：领导力、掌控力、战略思维
   321→- **成长点**：放手信任、接受失控、倾听他人
   322→- **成长方向**：学会授权和信任，在掌控中保持灵活
   323→- **最配原型**：Hero（搞事业的命）
   324→- **需注意原型**：Outlaw（人间清醒叛逆版）
   325→- **稀有度**：7%
   326→
   327→#### 原型的光明面与阴暗面
   328→
   329→每个原型都有其光明面（健康表达）和阴暗面（过度或扭曲表达）：
   330→
   331→```
   332→┌─────────────┬────────────────────────┬────────────────────────┐
   333→│    原型     │        光明面          │        阴暗面          │
   334→├─────────────┼────────────────────────┼────────────────────────┤
   335→│ Innocent    │ 乐观、信任、纯粹       │ 天真、否认、依赖       │
   336→│ Explorer    │ 独立、勇敢、好奇       │ 逃避、不安定、孤僻     │
   337→│ Sage        │ 智慧、客观、洞察       │ 冷漠、傲慢、脱离现实   │
   338→│ Hero        │ 勇气、决心、担当       │ 傲慢、冷酷、过度竞争   │
   339→│ Outlaw      │ 革新、勇于打破、真实   │ 破坏、自毁、犯罪倾向   │
   340→│ Magician    │ 转化、疗愈、创造奇迹   │ 操控、欺骗、妄想       │
   341→│ Regular     │ 务实、可靠、共情       │ 失去自我、随波逐流     │
   342→│ Lover       │ 热情、亲密、感恩       │ 沉溺、嫉妒、失去边界   │
   343→│ Jester      │ 快乐、幽默、活在当下   │ 肤浅、逃避、不负责任   │
   344→│ Caregiver   │ 慷慨、滋养、保护       │ 牺牲自我、控制、怨恨   │
   345→│ Creator     │ 创新、表达、想象力     │ 完美主义、自我沉溺     │
   346→│ Ruler       │ 领导力、秩序、责任     │ 专制、控制欲、傲慢     │
   347→└─────────────┴────────────────────────┴────────────────────────┘
   348→```
   349→
   350→### 2.3 Core 原型：灵魂本质（v5.0 重大升级）
   351→
   352→**定义**：你最核心的人格驱动力，是你在最真实状态下的存在方式。
   353→
   354→**计算来源（v5.0 升级）**：
   355→- **八字（主要权重 70%）**：格局 + 用神组合映射
   356→- **太阳星座（次要权重 30%）**：太阳星座映射
   357→- **一致性奖励**：当两者指向同一原型时，置信度+15%
   358→- **冲突处理**：当两者指向不同原型时，以八字为准，星座作为"次要能量"
   359→
   360→#### 日主强弱判断（v5.0 新增）
   361→
   362→日主强弱是原型计算的基础参数，影响原型的表达方式。
   363→
   364→```python
   365→class DayMasterStrength(Enum):
   366→    """日主强弱等级"""
   367→    EXTREMELY_STRONG = "极旺"  # 得令得地得势，需要泄耗
   368→    STRONG = "偏旺"            # 有根有气，喜泄耗
   369→    BALANCED = "中和"          # 身旺弱平衡，喜顺势
   370→    WEAK = "偏弱"              # 无根少气，喜生扶
   371→    EXTREMELY_WEAK = "极弱"    # 从格条件，需特殊处理
   372→
   373→def calculate_day_master_strength(bazi: BaziChart) -> tuple[DayMasterStrength, float]:
   374→    """
   375→    计算日主强弱
   376→
   377→    Returns:
   378→        (强弱等级, 强度分数 -1.0 到 1.0)
   379→    """
   380→    score = 0.0
   381→
   382→    # 1. 得令判断 (月支对日主的影响) - 权重40%
   383→    seasonal_factor = get_seasonal_strength(bazi.day_master, bazi.month_branch)
   384→    score += seasonal_factor * 0.4
   385→
   386→    # 2. 得地判断 (四支对日主的根气) - 权重30%
   387→    root_factor = calculate_root_strength(bazi.day_master, bazi.branches)
   388→    score += root_factor * 0.3
   389→
   390→    # 3. 得势判断 (天干透出的帮扶) - 权重20%
   391→    support_factor = calculate_stem_support(bazi.day_master, bazi.stems)
   392→    score += support_factor * 0.2
   393→
   394→    # 4. 合冲修正 (干支合化、地支冲合) - 权重10%
   395→    combination_factor = calculate_combination_effect(bazi)
   396→    score += combination_factor * 0.1
   397→
   398→    # 转换为等级
   399→    if score >= 0.6:
   400→        return (DayMasterStrength.EXTREMELY_STRONG, score)
   401→    elif score >= 0.2:
   402→        return (DayMasterStrength.STRONG, score)
   403→    elif score >= -0.2:
   404→        return (DayMasterStrength.BALANCED, score)
   405→    elif score >= -0.6:
   406→        return (DayMasterStrength.WEAK, score)
   407→    else:
   408→        return (DayMasterStrength.EXTREMELY_WEAK, score)
   409→```
   410→
   411→#### 用神喜忌判断（v5.0 新增）
   412→
   413→用神决定了命局的需求方向，直接影响原型的核心驱动力。
   414→
   415→```python
   416→class UsefulGod(Enum):
   417→    """用神类型"""
   418→    WEALTH = "财"        # 追求资源、物质
   419→    POWER = "官杀"       # 追求权力、地位
   420→    RESOURCE = "印"      # 追求知识、支持
   421→    OUTPUT = "食伤"      # 追求表达、创造
   422→    PEER = "比劫"        # 追求合作、竞争
   423→
   424→def determine_useful_god(bazi: BaziChart, strength: DayMasterStrength) -> UsefulGod:
   425→    """
   426→    根据日主强弱确定用神
   427→
   428→    基本原则：
   429→    - 身旺：喜财官食伤（泄耗之神）
   430→    - 身弱：喜印比（生扶之神）
   431→    - 特殊格局：顺势取用
   432→    """
   433→    if strength in [DayMasterStrength.STRONG, DayMasterStrength.EXTREMELY_STRONG]:
   434→        # 身旺喜泄耗
   435→        if has_strong_element(bazi, "food_god"):
   436→            return UsefulGod.OUTPUT  # 食伤泄秀
   437→        elif has_strong_element(bazi, "wealth"):
   438→            return UsefulGod.WEALTH  # 财星耗身
   439→        else:
   440→            return UsefulGod.POWER  # 官杀制身
   441→    elif strength in [DayMasterStrength.WEAK, DayMasterStrength.EXTREMELY_WEAK]:
   442→        # 身弱喜生扶
   443→        if has_strong_element(bazi, "resource"):
   444→            return UsefulGod.RESOURCE  # 印星生身
   445→        else:
   446→            return UsefulGod.PEER  # 比劫帮身
   447→    else:
   448→        # 中和取平衡
   449→        return determine_balanced_god(bazi)
   450→```
   451→
   452→#### 八字格局+用神→原型映射（v5.0 核心升级）
   453→
   454→升级后的映射考虑格局和用神的组合，共10格局×5用神=50种组合：
   455→
   456→| 格局 | 用神为财 | 用神为官杀 | 用神为印 | 用神为食伤 | 用神为比劫 |
   457→|------|----------|------------|----------|------------|------------|
   458→| 正官格 | Ruler+Caregiver | Ruler+Hero | Sage+Ruler | Creator+Ruler | Regular+Ruler |
   459→| 七杀格 | Hero+Explorer | Outlaw+Hero | Hero+Sage | Outlaw+Creator | Hero+Regular |
   460→| 正印格 | Caregiver+Sage | Sage+Ruler | Sage+Innocent | Creator+Sage | Caregiver+Regular |
   461→| 偏印格 | Magician+Explorer | Magician+Sage | Sage+Magician | Creator+Outlaw | Outlaw+Magician |
   462→| 食神格 | Creator+Lover | Magician+Creator | Sage+Creator | Creator+Jester | Jester+Creator |
   463→| 伤官格 | Creator+Outlaw | Outlaw+Hero | Magician+Creator | Creator+Outlaw | Outlaw+Explorer |
   464→| 正财格 | Regular+Lover | Ruler+Regular | Sage+Caregiver | Creator+Regular | Regular+Caregiver |
   465→| 偏财格 | Explorer+Jester | Explorer+Ruler | Magician+Explorer | Jester+Creator | Jester+Lover |
   466→| 比肩格 | Explorer+Hero | Hero+Outlaw | Sage+Explorer | Creator+Explorer | Regular+Hero |
   467→| 劫财格 | Outlaw+Explorer | Hero+Outlaw | Magician+Outlaw | Jester+Outlaw | Outlaw+Hero |
   468→
   469→**映射示例代码**：
   470→
   471→```python
   472→BAZI_ARCHETYPE_MAPPING = {
   473→    "正官格": {
   474→        UsefulGod.WEALTH: {
   475→            "primary": "Ruler",      # 统治者：通过资源管理实现秩序
   476→            "secondary": "Caregiver", # 照顾者：对他人负责
   477→            "driver": "责任驱动型成就者"
   478→        },
   479→        UsefulGod.RESOURCE: {
   480→            "primary": "Sage",       # 智者：通过知识获得权威
   481→            "secondary": "Ruler",
   482→            "driver": "知识驱动型领导者"
   483→        },
   484→        # ... 其他用神组合
   485→    },
   486→    # ... 其他格局
   487→}
   488→```
   489→
   490→#### 日主强弱对原型表达的修正
   491→
   492→```python
   493→def apply_strength_modifier(archetype_scores, strength_score):
   494→    """
   495→    日主强弱修正原型表达
   496→
   497→    身旺：增强外向型原型（Hero, Ruler, Outlaw, Explorer, Creator, Jester）
   498→    身弱：增强内向型原型（Sage, Caregiver, Innocent, Lover, Regular, Magician）
   499→    """
   500→    EXTROVERT_ARCHETYPES = {
   501→        "Hero", "Ruler", "Outlaw", "Explorer", "Creator", "Jester"
   502→    }
   503→    INTROVERT_ARCHETYPES = {
   504→        "Sage", "Caregiver", "Innocent", "Lover", "Regular", "Magician"
   505→    }
   506→
   507→    if strength_score > 0:  # 身旺
   508→        modifier = 1 + strength_score * 0.2  # 最多+20%
   509→        for archetype in EXTROVERT_ARCHETYPES:
   510→            archetype_scores[archetype] *= modifier
   511→    else:  # 身弱
   512→        modifier = 1 + abs(strength_score) * 0.2
   513→        for archetype in INTROVERT_ARCHETYPES:
   514→            archetype_scores[archetype] *= modifier
   515→
   516→    return archetype_scores
   517→```
   518→
   519→#### 太阳星座→原型映射
   520→
   521→| 太阳星座 | 主要原型 | 次要原型 |
   522→|----------|----------|----------|
   523→| 白羊座 | Hero | Explorer |
   524→| 金牛座 | Lover | Regular |
   525→| 双子座 | Jester | Magician |
   526→| 巨蟹座 | Caregiver | Innocent |
   527→| 狮子座 | Ruler | Creator |
   528→| 处女座 | Sage | Caregiver |
   529→| 天秤座 | Lover | Ruler |
   530→| 天蝎座 | Magician | Outlaw |
   531→| 射手座 | Explorer | Sage |
   532→| 摩羯座 | Ruler | Hero |
   533→| 水瓶座 | Outlaw | Sage |
   534→| 双鱼座 | Innocent | Magician |
   535→
   536→### 2.4 Inner 原型：内在世界（v5.0 升级）
   537→
   538→**定义**：你如何处理内在情绪、需求和私密体验。这是只有亲近的人才能看到的你。
   539→
   540→**计算来源（v5.0 升级）**：
   541→- **月亮星座（主要 75%）**：情感需求
   542→- **金星星座（辅助 25%）**：爱情风格，补充情感表达
   543→
   544→#### 月亮星座→原型映射
   545→
   546→| 月亮星座 | Inner原型 | 情感特质 |
   547→|----------|-----------|----------|
   548→| 白羊座 | Hero | 直接、冲动的情感表达 |
   549→| 金牛座 | Lover | 稳定、感官的情感需求 |
   550→| 双子座 | Jester | 多变、交流的情感模式 |
   551→| 巨蟹座 | Caregiver | 滋养、保护的情感本能 |
   552→| 狮子座 | Creator | 热情、戏剧化的情感 |
   553→| 处女座 | Caregiver | 细致、服务的情感表达 |
   554→| 天秤座 | Lover | 和谐、审美的情感需求 |
   555→| 天蝎座 | Magician | 深沉、转化的情感体验 |
   556→| 射手座 | Explorer | 自由、乐观的情感态度 |
   557→| 摩羯座 | Ruler | 克制、务实的情感处理 |
   558→| 水瓶座 | Outlaw | 超脱、人道的情感观 |
   559→| 双鱼座 | Innocent | 共情、梦幻的情感世界 |
   560→
   561→#### 金星星座→爱情风格映射（v5.0 新增）
   562→
   563→| 金星星座 | 原型 | 爱情风格 |
   564→|----------|------|----------|
   565→| 白羊座 | Hero | 主动追求、热情直接 |
   566→| 金牛座 | Lover | 忠诚专一、感官享受 |
   567→| 双子座 | Jester | 多变有趣、智性交流 |
   568→| 巨蟹座 | Caregiver | 温柔呵护、家庭导向 |
   569→| 狮子座 | Creator | 浪漫奢华、戏剧化表达 |
   570→| 处女座 | Caregiver | 细心体贴、实际付出 |
   571→| 天秤座 | Lover | 优雅浪漫、追求美感 |
   572→| 天蝎座 | Magician | 深情专一、占有欲强 |
   573→| 射手座 | Explorer | 自由开放、冒险精神 |
   574→| 摩羯座 | Ruler | 务实稳重、长期承诺 |
   575→| 水瓶座 | Outlaw | 独立自由、打破常规 |
   576→| 双鱼座 | Innocent | 浪漫梦幻、无条件付出 |
   577→
   578→### 2.5 Outer 原型：外在呈现（v5.0 升级）
   579→
   580→**定义**：你展示给世界的形象，你希望别人如何看待你。这是你的"社会面具"。
   581→
   582→**计算来源（v5.0 升级）**：
   583→- **上升星座（主要 70%）**：社会面具
   584→- **火星星座（辅助 30%）**：行动风格，影响外在行为表现
   585→
   586→#### 上升星座→原型映射
   587→
   588→| 上升星座 | Outer原型 | 社交风格 |
   589→|----------|-----------|----------|
   590→| 白羊座 | Hero | 主动、直接、有冲劲 |
   591→| 金牛座 | Regular | 稳重、可靠、务实 |
   592→| 双子座 | Jester | 灵活、健谈、好奇 |
   593→| 巨蟹座 | Caregiver | 温和、体贴、保护性 |
   594→| 狮子座 | Ruler | 自信、大方、有魅力 |
   595→| 处女座 | Sage | 细致、谨慎、有条理 |
   596→| 天秤座 | Lover | 优雅、和善、注重美感 |
   597→| 天蝎座 | Magician | 神秘、深邃、有穿透力 |
   598→| 射手座 | Explorer | 开朗、乐观、有冒险精神 |
   599→| 摩羯座 | Ruler | 严肃、专业、有目标感 |
   600→| 水瓶座 | Outlaw | 独特、前卫、有距离感 |
   601→| 双鱼座 | Innocent | 柔和、梦幻、有同理心 |
   602→
   603→#### 火星星座→行动风格映射（v5.0 新增）
   604→
   605→| 火星星座 | 原型 | 行动风格 |
   606→|----------|------|----------|
   607→| 白羊座 | Hero | 果断冲动、竞争好胜 |
   608→| 金牛座 | Regular | 稳健持久、务实坚定 |
   609→| 双子座 | Magician | 灵活多变、策略性强 |
   610→| 巨蟹座 | Caregiver | 情绪驱动、保护本能 |
   611→| 狮子座 | Ruler | 自信领导、追求卓越 |
   612→| 处女座 | Sage | 精确分析、完美主义 |
   613→| 天秤座 | Lover | 协调平衡、避免冲突 |
   614→| 天蝎座 | Magician | 坚定执着、隐秘策略 |
   615→| 射手座 | Explorer | 冒险乐观、自由奔放 |
   616→| 摩羯座 | Hero | 坚韧不拔、目标导向 |
   617→| 水瓶座 | Outlaw | 独特创新、打破规则 |
   618→| 双鱼座 | Innocent | 直觉引导、随流而动 |
   619→
   620→### 2.6 Shadow 原型：阴影倾向
   621→
   622→**定义**：你可能否认、压抑或回避的人格能量。整合阴影是成长的关键任务。
   623→
   624→**重要说明**：
   625→- 阴影不是"坏的"，而是"被否认的"
   626→- 阴影中往往藏着我们未开发的潜能（"金子"）
   627→- 阴影是个人化的，需要在成长陪伴中逐渐发现
   628→
   629→#### 渐进式阴影发现机制
   630→
   631→**第一层：初始推测**
   632→
   633→基于Core原型，提供阴影的初始倾向性推测：
   634→
   635→| Core原型 | 初始阴影倾向 | 核心张力 |
   636→|----------|--------------|----------|
   637→| Innocent | Hero | 信任 vs 掌控 |
   638→| Hero | Innocent | 征服 vs 信任 |
   639→| Sage | Jester | 深刻 vs 轻盈 |
   640→| Jester | Sage | 轻盈 vs 深刻 |
   641→| Caregiver | Explorer | 扎根 vs 流动 |
   642→| Explorer | Caregiver | 自由 vs 责任 |
   643→| Creator | Regular | 独特 vs 归属 |
   644→| Regular | Creator | 归属 vs 独特 |
   645→| Lover | Magician | 融合 vs 超越 |
   646→| Magician | Lover | 超越 vs 融合 |
   647→| Ruler | Outlaw | 秩序 vs 自由 |
   648→| Outlaw | Ruler | 自由 vs 秩序 |
   649→
   650→**第二层：数据验证**
   651→
   652→计算用户12原型的完整得分，识别最低分原型进行交叉验证。
   653→
   654→**第三层：用户确认（可选深度探索）**
   655→
   656→通过问答引导用户探索和确认自己的阴影倾向。
   657→
   658→**第四层：长期反馈调整**
   659→
   660→基于用户在"深度日"的行为和反馈，动态调整阴影画像。
   661→
   662→---
   663→
   664→## 三、计算体系（v5.0 重大升级）
   665→
   666→### 3.1 输入数据要求
   667→
   668→#### 必需输入
   669→
   670→| 字段 | 格式 | 用途 | 默认值 |
   671→|------|------|------|--------|
   672→| 出生年 | YYYY | 八字年柱、星座计算 | 无 |
   673→| 出生月 | MM | 八字月柱、星座计算 | 无 |
   674→| 出生日 | DD | 八字日柱、星座计算 | 无 |
   675→
   676→#### 可选输入（推荐提供）
   677→
   678→| 字段 | 格式 | 用途 | 默认值 |
   679→|------|------|------|--------|
   680→| 出生时 | HH:MM | 八字时柱、精确星盘 | 12:00 |
   681→| 出生地点 | 城市名 | 精确上升星座计算 | 北京（中国用户） |
   682→
   683→### 3.2 基础计算流程（v5.0 升级）
   684→
   685→```
   686→┌─────────────────────────────────────────────────────────────────┐
   687→│                       VibeID 计算流程 v5.0                      │
   688→└─────────────────────────────────────────────────────────────────┘
   689→
   690→      ┌──────────────┐
   691→      │   用户输入   │
   692→      │ (生辰信息)   │
   693→      └──────┬───────┘
   694→             │
   695→             ▼
   696→┌────────────────────────────────────────────────────────────────┐
   697→│                         并行计算                                │
   698→├────────────────────────────┬───────────────────────────────────┤
   699→│                            │                                   │
   700→│   ┌────────────────────┐   │   ┌────────────────────┐         │
   701→│   │    八字计算        │   │   │    五点星盘计算    │         │
   702→│   ├────────────────────┤   │   ├────────────────────┤         │
   703→│   │ • 四柱推算         │   │   │ • 太阳星座 (35%)   │         │
   704→│   │ • 日主强弱计算     │   │   │ • 月亮星座 (25%)   │         │
   705→│   │ • 用神喜忌判断     │   │   │ • 上升星座 (20%)   │         │
   706→│   │ • 格局判断         │   │   │ • 金星星座 (10%)   │         │
   707→│   │ • 五行分析         │   │   │ • 火星星座 (10%)   │         │
   708→│   └────────┬───────────┘   │   └────────┬───────────┘         │
   709→│            │               │            │                      │
   710→│            ▼               │            ▼                      │
   711→│   ┌────────────────────┐   │   ┌────────────────────┐         │
   712→│   │  八字原型映射      │   │   │  星座原型映射      │         │
   713→│   │  格局+用神组合     │   │   │  五点综合计算      │         │
   714→│   │  (权重 70%)        │   │   │  (权重 30%)        │         │
   715→│   └────────┬───────────┘   │   └────────┬───────────┘         │
   716→│            │               │            │                      │
   717→└────────────┼───────────────┴────────────┼──────────────────────┘
   718→             │                            │
   719→             └────────────┬───────────────┘
   720→                          ▼
   721→             ┌──────────────────────┐
   722→             │    八字主导融合      │
   723→             │                      │
   724→             │ • 一致性检查         │
   725→             │ • 一致性奖励 (+15%)  │
   726→             │ • 冲突处理           │
   727→             │ • 置信度计算         │
   728→             └──────────┬───────────┘
   729→                        │
   730→                        ▼
   731→             ┌──────────────────────┐
   732→             │    可解释性生成      │
   733→             │                      │
   734→             │ • 八字洞察           │
   735→             │ • 星座洞察           │
   736→             │ • 融合洞察           │
   737→             │ • 成长方向           │
   738→             └──────────┬───────────┘
   739→                        │
   740→                        ▼
   741→             ┌──────────────────────┐
   742→             │    VibeID 生成       │
   743→             └──────────────────────┘
   744→```
   745→
   746→### 3.3 八字原型计算（v5.0 核心算法）
   747→
   748→```python
   749→def calculate_bazi_archetype(bazi_data):
   750→    """
   751→    八字原型计算 - v5.0 中等深度算法
   752→    """
   753→    # Step 1: 计算日主强弱
   754→    strength, strength_score = calculate_day_master_strength(bazi_data)
   755→
   756→    # Step 2: 确定用神
   757→    useful_god = determine_useful_god(bazi_data, strength)
   758→
   759→    # Step 3: 获取格局
   760→    pattern = bazi_data.pattern
   761→
   762→    # Step 4: 格局+用神组合映射
   763→    archetype_mapping = BAZI_ARCHETYPE_MAPPING[pattern][useful_god]
   764→    primary_archetype = archetype_mapping["primary"]
   765→    secondary_archetype = archetype_mapping["secondary"]
   766→    driver = archetype_mapping["driver"]
   767→
   768→    # Step 5: 初始化得分
   769→    bazi_scores = {archetype: 0.0 for archetype in ALL_ARCHETYPES}
   770→    bazi_scores[primary_archetype] = 1.0
   771→    bazi_scores[secondary_archetype] = 0.5
   772→
   773→    # Step 6: 应用日主强弱修正
   774→    bazi_scores = apply_strength_modifier(bazi_scores, strength_score)
   775→
   776→    # Step 7: 生成解释
   777→    explanation = f"你的八字是{pattern}，用神为{useful_god.value}，这决定了你的人生底色是{primary_archetype}型的{driver}。"
   778→
   779→    return {
   780→        "scores": bazi_scores,
   781→        "primary": primary_archetype,
   782→        "secondary": secondary_archetype,
   783→        "pattern": pattern,
   784→        "useful_god": useful_god.value,
   785→        "day_master_strength": strength.value,
   786→        "driver": driver,
   787→        "explanation": explanation
   788→    }
   789→```
   790→
   791→### 3.4 五点星盘原型计算（v5.0 新增）
   792→
   793→```python
   794→def calculate_zodiac_archetype(natal_chart):
   795→    """
   796→    五点星盘原型计算 - v5.0 算法
   797→    """
   798→    archetype_scores = {archetype: 0.0 for archetype in ALL_ARCHETYPES}
   799→    explanations = []
   800→
   801→    # 太阳星座 (35%权重)
   802→    sun_mapping = SUN_SIGN_MAPPING[natal_chart.sun_sign]
   803→    archetype_scores[sun_mapping["primary"]] += 0.35 * 1.0
   804→    archetype_scores[sun_mapping["secondary"]] += 0.35 * 0.5
   805→    explanations.append(f"太阳{natal_chart.sun_sign}赋予你{sun_mapping['primary']}的核心特质")
   806→
   807→    # 月亮星座 (25%权重)
   808→    moon_mapping = MOON_SIGN_MAPPING[natal_chart.moon_sign]
   809→    archetype_scores[moon_mapping["primary"]] += 0.25 * 1.0
   810→    explanations.append(f"月亮{natal_chart.moon_sign}让你的情感表达呈现{moon_mapping['style']}")
   811→
   812→    # 上升星座 (20%权重)
   813→    asc_mapping = ASCENDANT_MAPPING[natal_chart.ascendant]
   814→    archetype_scores[asc_mapping["primary"]] += 0.20 * 1.0
   815→    explanations.append(f"上升{natal_chart.ascendant}让你给人{asc_mapping['impression']}的印象")
   816→
   817→    # 金星星座 (10%权重)
   818→    venus_mapping = VENUS_SIGN_MAPPING[natal_chart.venus_sign]
   819→    archetype_scores[venus_mapping["primary"]] += 0.10 * 1.0
   820→    explanations.append(f"金星{natal_chart.venus_sign}让你的爱情风格是{venus_mapping['love_style']}")
   821→
   822→    # 火星星座 (10%权重)
   823→    mars_mapping = MARS_SIGN_MAPPING[natal_chart.mars_sign]
   824→    archetype_scores[mars_mapping["primary"]] += 0.10 * 1.0
   825→    explanations.append(f"火星{natal_chart.mars_sign}让你的行动风格是{mars_mapping['action_style']}")
   826→
   827→    # 确定主原型
   828→    primary = max(archetype_scores, key=archetype_scores.get)
   829→
   830→    return {
   831→        "scores": archetype_scores,
   832→        "primary": primary,
   833→        "explanations": explanations,
   834→        "sun_sign": natal_chart.sun_sign,
   835→        "moon_sign": natal_chart.moon_sign,
   836→        "ascendant": natal_chart.ascendant,
   837→        "venus_sign": natal_chart.venus_sign,
   838→        "mars_sign": natal_chart.mars_sign
   839→    }
   840→```
   841→
   842→### 3.5 八字主导融合算法（v5.0 核心升级）
   843→
   844→```python
   845→class FusionStrategy:
   846→    """八字主导的东西方融合策略"""
   847→
   848→    # 基础权重：八字70%，星座30%
   849→    BASE_BAZI_WEIGHT = 0.70
   850→    BASE_ZODIAC_WEIGHT = 0.30
   851→
   852→    # 一致性奖励：当两套系统指向同一原型时
   853→    CONSISTENCY_BONUS = 0.15
   854→
   855→    # 冲突处理：当两套系统指向对立原型时
   856→    CONFLICT_PENALTY = 0.10
   857→
   858→def calculate_fused_archetype(bazi_result, zodiac_result):
   859→    """
   860→    融合计算最终原型
   861→
   862→    策略：
   863→    1. 八字决定Core原型（主原型）
   864→    2. 星座调整表达层次（Inner/Outer）
   865→    3. 一致性增强置信度
   866→    4. 冲突时八字优先
   867→    """
   868→
   869→    # Step 1: 获取八字主原型
   870→    bazi_primary = bazi_result["primary"]
   871→
   872→    # Step 2: 获取星座主原型
   873→    zodiac_primary = zodiac_result["primary"]
   874→
   875→    # Step 3: 一致性检查
   876→    consistency_type = check_consistency(bazi_primary, zodiac_primary)
   877→
   878→    # Step 4: 融合计算
   879→    fused_scores = {}
   880→    for archetype in ALL_ARCHETYPES:
   881→        base_score = (
   882→            bazi_result["scores"].get(archetype, 0) * FusionStrategy.BASE_BAZI_WEIGHT +
   883→            zodiac_result["scores"].get(archetype, 0) * FusionStrategy.BASE_ZODIAC_WEIGHT
   884→        )
   885→
   886→        # 一致性奖励
   887→        if archetype == bazi_primary and archetype == zodiac_primary:
   888→            base_score += FusionStrategy.CONSISTENCY_BONUS
   889→
   890→        fused_scores[archetype] = base_score
   891→
   892→    # Step 5: 确定最终原型
   893→    primary_archetype = max(fused_scores, key=fused_scores.get)
   894→
   895→    # Step 6: 确定副原型（排除主原型后的最高分）
   896→    secondary_scores = {k: v for k, v in fused_scores.items() if k != primary_archetype}
   897→    secondary_archetype = max(secondary_scores, key=secondary_scores.get)
   898→
   899→    # Step 7: 计算置信度
   900→    confidence = calculate_confidence(
   901→        fused_scores[primary_archetype],
   902→        fused_scores[secondary_archetype],
   903→        consistency_type
   904→    )
   905→
   906→    # Step 8: 生成解释
   907→    explanation = generate_explanation(
   908→        primary_archetype, secondary_archetype,
   909→        bazi_primary, zodiac_primary,
   910→        consistency_type,
   911→        bazi_result["explanation"],
   912→        zodiac_result["explanations"]
   913→    )
   914→
   915→    return {
   916→        "primary_archetype": primary_archetype,
   917→        "secondary_archetype": secondary_archetype,
   918→        "all_scores": fused_scores,
   919→        "confidence": confidence,
   920→        "consistency_type": consistency_type,
   921→        "explanation": explanation,
   922→        "bazi_contribution": bazi_result,
   923→        "zodiac_contribution": zodiac_result
   924→    }
   925→
   926→def check_consistency(bazi_archetype, zodiac_archetype):
   927→    """检查八字和星座原型的一致性"""
   928→
   929→    if bazi_archetype == zodiac_archetype:
   930→        return "perfect_match"  # 完美一致
   931→
   932→    # 定义原型对立关系
   933→    OPPOSING_PAIRS = [
   934→        ("Ruler", "Outlaw"),
   935→        ("Hero", "Innocent"),
   936→        ("Sage", "Jester"),
   937→        ("Caregiver", "Explorer"),
   938→    ]
   939→
   940→    for pair in OPPOSING_PAIRS:
   941→        if {bazi_archetype, zodiac_archetype} == set(pair):
   942→            return "conflict"  # 对立冲突
   943→
   944→    # 定义原型相近关系
   945→    SIMILAR_GROUPS = [
   946→        {"Ruler", "Hero", "Magician"},
   947→        {"Sage", "Caregiver", "Regular"},
   948→        {"Creator", "Explorer", "Outlaw"},
   949→        {"Lover", "Innocent", "Jester"},
   950→    ]
   951→
   952→    for group in SIMILAR_GROUPS:
   953→        if bazi_archetype in group and zodiac_archetype in group:
   954→            return "similar"  # 相近
   955→
   956→    return "neutral"  # 中性
   957→```
   958→
   959→### 3.6 可解释性模块（v5.0 新增）
   960→
   961→```python
   962→def generate_explanation(primary, secondary, bazi_primary, zodiac_primary,
   963→                         consistency, bazi_explanation, zodiac_explanations):
   964→    """
   965→    生成用户可理解的原型解释
   966→    """
   967→
   968→    explanation = {
   969→        "summary": "",
   970→        "bazi_insight": "",
   971→        "zodiac_insight": "",
   972→        "integration_insight": "",
   973→        "growth_direction": ""
   974→    }
   975→
   976→    # 主原型总结
   977→    explanation["summary"] = f"你的核心原型是【{ARCHETYPE_CHINESE_NAMES[primary]}】，副原型是【{ARCHETYPE_CHINESE_NAMES[secondary]}】"
   978→
   979→    # 八字洞察
   980→    explanation["bazi_insight"] = bazi_explanation
   981→
   982→    # 星座洞察
   983→    explanation["zodiac_insight"] = f"从星盘角度看，{'; '.join(zodiac_explanations[:3])}。"
   984→
   985→    # 融合洞察
   986→    if consistency == "perfect_match":
   987→        explanation["integration_insight"] = (
   988→            f"东方命理与西方占星高度一致地指向{ARCHETYPE_CHINESE_NAMES[primary]}原型，"
   989→            f"说明这是你非常稳定的核心特质。"
   990→        )
   991→    elif consistency == "conflict":
   992→        explanation["integration_insight"] = (
   993→            f"有趣的是，八字指向{ARCHETYPE_CHINESE_NAMES[bazi_primary]}，"
   994→            f"而星盘指向{ARCHETYPE_CHINESE_NAMES[zodiac_primary]}，"
   995→            f"这种张力可能让你内心有时感到矛盾。"
   996→            f"最终我们以八字为主，确定你的主原型是{ARCHETYPE_CHINESE_NAMES[primary]}。"
   997→        )
   998→    else:
   999→        explanation["integration_insight"] = (
  1000→            f"八字的{ARCHETYPE_CHINESE_NAMES[bazi_primary]}特质与星盘的{ARCHETYPE_CHINESE_NAMES[zodiac_primary]}特质"
  1001→            f"相互补充，让你的人格更加丰富多元。"
  1002→        )
  1003→
  1004→    # 成长方向
  1005→    explanation["growth_direction"] = GROWTH_DIRECTIONS[primary]
  1006→
  1007→    return explanation
  1008→
  1009→# 成长方向映射
  1010→GROWTH_DIRECTIONS = {
  1011→    "Hero": "你的成长方向是学会接纳脆弱，在保持勇气的同时培养同理心。",
  1012→    "Sage": "你的成长方向是将智慧转化为行动，不仅追求理解，更要实践和分享。",
  1013→    "Caregiver": "你的成长方向是学会照顾自己，建立健康的边界，避免过度付出。",
  1014→    "Creator": "你的成长方向是完成作品而非追求完美，让创意真正落地。",
  1015→    "Ruler": "你的成长方向是学会授权和信任，在掌控中保持灵活。",
  1016→    "Outlaw": "你的成长方向是将叛逆转化为建设性的变革，找到值得为之战斗的事业。",
  1017→    "Magician": "你的成长方向是将洞察用于帮助他人，而非仅仅掌控局势。",
  1018→    "Lover": "你的成长方向是在关系中保持独立性，避免失去自我。",
  1019→    "Jester": "你的成长方向是在欢乐中找到深度，让幽默服务于真正重要的事。",
  1020→    "Regular": "你的成长方向是在归属中保持独特性，勇敢表达自己的观点。",
  1021→    "Innocent": "你的成长方向是在保持纯真的同时发展智慧，学会辨别而非盲目信任。",
  1022→    "Explorer": "你的成长方向是学会深耕，在自由探索中也能建立持久的连接。"
  1023→}
  1024→```
  1025→
  1026→### 3.7 十二原型得分计算（v5.0 更新）
  1027→
  1028→每个原型的得分（0-100）由以下因素综合计算：
  1029→
  1030→```python
  1031→def calculate_archetype_score(archetype, bazi_data, astro_data, fused_scores):
  1032→    """
  1033→    计算单个原型的最终得分 (0-100)
  1034→    """
  1035→    # 基准分 50
  1036→    score = 50
  1037→
  1038→    # 融合得分贡献 (±30分)
  1039→    fusion_contribution = fused_scores.get(archetype, 0)
  1040→    score += fusion_contribution * 30
  1041→
  1042→    # 五行相关性修正 (±10分)
  1043→    element_affinity = get_element_affinity(archetype, bazi_data.dominant_elements)
  1044→    score += element_affinity * 10
  1045→
  1046→    # 归一化到0-100
  1047→    return max(0, min(100, score))
  1048→```
  1049→
  1050→### 3.8 每日行运计算
  1051→
  1052→（保持原有设计，略）
  1053→
  1054→### 3.9 问答确认系统
  1055→
  1056→（保持原有设计，略）
  1057→
  1058→---
  1059→
  1060→## 四、动态系统：Vibe OS
  1061→
  1062→（保持原有设计，略）
  1063→
  1064→---
  1065→
  1066→## 五、数据结构（v5.0 升级）
  1067→
  1068→### 5.1 用户画像 (VibeID Profile)
  1069→
  1070→```typescript
  1071→interface VibeIDProfile {
  1072→  // 基础信息
  1073→  id: string;
  1074→  created_at: timestamp;
  1075→  updated_at: timestamp;
  1076→
  1077→  // 出生信息
  1078→  birth_data: {
  1079→    year: number;
  1080→    month: number;
  1081→    day: number;
  1082→    hour: number;        // 默认12
  1083→    minute: number;      // 默认0
  1084→    location: {
  1085→      city: string;      // 默认"北京"
  1086→      timezone: string;
  1087→      latitude: number;
  1088→      longitude: number;
  1089→    };
  1090→  };
  1091→
  1092→  // 八字数据（v5.0 扩展）
  1093→  bazi: {
  1094→    four_pillars: {
  1095→      year: { gan: string; zhi: string; };
  1096→      month: { gan: string; zhi: string; };
  1097→      day: { gan: string; zhi: string; };
  1098→      hour: { gan: string; zhi: string; };
  1099→    };
  1100→    day_master: string;
  1101→    day_master_strength: '极旺' | '偏旺' | '中和' | '偏弱' | '极弱';  // v5.0新增
  1102→    day_master_strength_score: number;  // v5.0新增 (-1.0 ~ 1.0)
  1103→    dominant_element: string;
  1104→    pattern: string;        // 格局
  1105→    useful_god: '财' | '官杀' | '印' | '食伤' | '比劫';  // v5.0新增
  1106→    archetype_driver: string;  // v5.0新增 e.g. "责任驱动型成就者"
  1107→  };
  1108→
  1109→  // 星盘数据（v5.0 扩展为五点模型）
  1110→  natal_chart: {
  1111→    sun_sign: string;
  1112→    moon_sign: string;
  1113→    rising_sign: string;
  1114→    venus_sign: string;    // v5.0新增
  1115→    mars_sign: string;     // v5.0新增
  1116→    planets: {
  1117→      [planet: string]: {
  1118→        sign: string;
  1119→        house: number;
  1120→        degree: number;
  1121→      };
  1122→    };
  1123→  };
  1124→
  1125→  // 四维原型（v5.0 更新）
  1126→  archetypes: {
  1127→    core: {
  1128→      primary: ArchetypeType;
  1129→      secondary: ArchetypeType | null;
  1130→      confidence: 'high' | 'medium' | 'low';
  1131→      source: {
  1132→        bazi_contribution: ArchetypeType;
  1133→        bazi_pattern: string;          // v5.0新增
  1134→        bazi_useful_god: string;       // v5.0新增
  1135→        zodiac_contribution: ArchetypeType;
  1136→        consistency_type: 'perfect_match' | 'similar' | 'neutral' | 'conflict';  // v5.0新增
  1137→      };
  1138→    };
  1139→    inner: {
  1140→      archetype: ArchetypeType;
  1141→      emotional_traits: string[];
  1142→      love_style: string;    // v5.0新增 (from Venus)
  1143→    };
  1144→    outer: {
  1145→      archetype: ArchetypeType;
  1146→      social_style: string[];
  1147→      action_style: string;  // v5.0新增 (from Mars)
  1148→    };
  1149→    shadow: {
  1150→      primary_tendency: ArchetypeType;
  1151→      alternative_tendencies: ArchetypeType[];
  1152→      confidence: 'high' | 'medium' | 'low';
  1153→      user_confirmed: boolean;
  1154→      confirmation_date: timestamp | null;
  1155→    };
  1156→  };
  1157→
  1158→  // 12原型得分
  1159→  archetype_scores: {
  1160→    [archetype: string]: number;  // 0-100
  1161→  };
  1162→
  1163→  // 可解释性模块（v5.0 新增）
  1164→  explanation: {
  1165→    summary: string;
  1166→    bazi_insight: string;
  1167→    zodiac_insight: string;
  1168→    integration_insight: string;
  1169→    growth_direction: string;
  1170→  };
  1171→
  1172→  // 成长数据
  1173→  growth_data: {
  1174→    deep_days_count: number;
  1175→    last_deep_day: timestamp | null;
  1176→    courage_invitations_accepted: number;
  1177→    shadow_explorations: ShadowExplorationRecord[];
  1178→  };
  1179→
  1180→  // 计算元数据（v5.0 新增）
  1181→  calculation_metadata: {
  1182→    version: string;  // "v5.0"
  1183→    calculated_at: timestamp;
  1184→    algorithm_params: {
  1185→      bazi_weight: number;      // 0.70
  1186→      zodiac_weight: number;    // 0.30
  1187→      consistency_bonus: number; // 0.15
  1188→    };
  1189→  };
  1190→}
  1191→```
  1192→
  1193→### 5.2 简化展示结构（v5.0 新增）
  1194→
  1195→```typescript
  1196→interface VibeIDDisplay {
  1197→  // 简化展示（前端使用）
  1198→  primary_archetype: string;  // 主原型名称
  1199→  primary_emoji: string;      // 主原型emoji
  1200→  primary_tagline: string;    // 一句话描述
  1201→
  1202→  secondary_archetype: string;
  1203→
  1204→  summary: string;            // 综合描述
  1205→  growth_tip: string;         // 成长提示
  1206→
  1207→  // 归因简述（用户可展开查看）
  1208→  bazi_brief: string;         // "正官格 · 用神为财"
  1209→  zodiac_brief: string;       // "太阳狮子 · 月亮巨蟹 · 上升天蝎"
  1210→}
  1211→
  1212→// 原型emoji映射
  1213→const ARCHETYPE_EMOJI = {
  1214→  "Innocent": "🌸",
  1215→  "Sage": "📚",
  1216→  "Explorer": "🧭",
  1217→  "Outlaw": "⚡",
  1218→  "Magician": "🔮",
  1219→  "Hero": "⚔️",
  1220→  "Lover": "💕",
  1221→  "Jester": "🎭",
  1222→  "Regular": "🏠",
  1223→  "Caregiver": "🤗",
  1224→  "Ruler": "👑",
  1225→  "Creator": "🎨"
  1226→};
  1227→```
  1228→
  1229→### 5.3 每日 Vibe 数据
  1230→
  1231→（保持原有设计，略）
  1232→
  1233→---
  1234→
  1235→## 六、产品呈现
  1236→
  1237→### 6.1 VibeID 卡片（v5.0 更新）
  1238→
  1239→**首次生成展示**：
  1240→
  1241→```
  1242→┌─────────────────────────────────────────────────────────────────┐
  1243→│                                                                 │
  1244→│                         VibeID                                  │
  1245→│                                                                 │
  1246→│                    ╭──────────────╮                             │
  1247→│                    │              │                             │
  1248→│                    │   🎨         │                             │
  1249→│                    │              │                             │
  1250→│                    ╰──────────────╯                             │
  1251→│                                                                 │
  1252→│                    Core: 创造者 / 审美在线本人                  │
  1253→│                    "表达是我的呼吸"                             │
  1254→│                                                                 │
  1255→│   ─────────────────────────────────────────────────────────    │
  1256→│                                                                 │
  1257→│   Inner: 🔮 魔术师        Outer: 🤗 照顾者                      │
  1258→│   情感风格: 深沉转化       社交风格: 温和保护                   │
  1259→│                                                                 │
  1260→│   ─────────────────────────────────────────────────────────    │
  1261→│                                                                 │
  1262→│   Shadow倾向: 🏠 凡人                                           │
  1263→│   核心张力: 独特 vs 归属                                        │
  1264→│                                                                 │
  1265→│   ─────────────────────────────────────────────────────────    │
  1266→│                                                                 │
  1267→│   📍 底层密码                                                   │
  1268→│   八字: 伤官格 · 用神为财 · 身偏旺                              │
  1269→│   星盘: 太阳狮子 · 月亮双鱼 · 上升天蝎                          │
  1270→│                                                                 │
  1271→│   ─────────────────────────────────────────────────────────    │
  1272→│                                                                 │
  1273→│   ✨ 成长方向                                                   │
  1274→│   "你的成长方向是完成作品而非追求完美，让创意真正落地。"        │
  1275→│                                                                 │
  1276→│                     [ 探索我的VibeID ]                          │
  1277→│                                                                 │
  1278→└─────────────────────────────────────────────────────────────────┘
  1279→```
  1280→
  1281→（其余产品呈现部分保持原有设计，略）
  1282→
  1283→---
  1284→
  1285→## 七、架构扩展预留
  1286→
  1287→（保持原有设计，略）
  1288→
  1289→---
  1290→
  1291→## 八、用户体验流程
  1292→
  1293→（保持原有设计，略）
  1294→
  1295→---
  1296→
  1297→## 九、附录
  1298→
  1299→### 9.1 术语表（v5.0 更新）
  1300→
  1301→| 术语 | 定义 |
  1302→|------|------|
  1303→| VibeID | 用户的完整人格画像，包含四维原型和动态数据 |
  1304→| Vibe值 | 每日能量共振指数，0-100 |
  1305→| Core原型 | 灵魂本质，最深层的人格驱动力（八字主导） |
  1306→| Inner原型 | 内在世界，处理情绪和需求的方式（月亮+金星） |
  1307→| Outer原型 | 外在呈现，展示给世界的形象（上升+火星） |
  1308→| Shadow原型 | 阴影倾向，被否认或压抑的能量 |
  1309→| 日主强弱 | 八字日干的强弱程度，影响原型表达方式 |
  1310→| 用神 | 八字命局的需求方向，决定核心驱动力 |
  1311→| 五点模型 | 太阳、月亮、上升、金星、火星五个星盘关键点 |
  1312→| 一致性奖励 | 当八字和星座指向同一原型时的置信度加成 |
  1313→| 深度日 | 阴影能量被激活的日子，是成长机会 |
  1314→| 勇气邀请 | 每日的成长行动建议，非强制 |
  1315→
  1316→### 9.2 原型一致性矩阵
  1317→
  1318→```
  1319→           Hero  Ruler  Sage  Care  Creat Outl  Magi  Lover Jest  Regu  Inno  Expl
  1320→Hero        -     +      0     0     0     +     +     0     0     0     -     +
  1321→Ruler       +     -      +     +     0     -     +     0     0     +     0     0
  1322→Sage        0     +      -     +     +     0     +     0     -     +     0     0
  1323→Caregiver   0     +      +     -     0     0     0     +     0     +     +     -
  1324→Creator     0     0      +     0     -     +     +     +     +     0     0     +
  1325→Outlaw      +     -      0     0     +     -     +     0     +     -     0     +
  1326→Magician    +     +      +     0     +     +     -     0     0     0     0     0
  1327→Lover       0     0      0     +     +     0     0     -     +     +     +     0
  1328→Jester      0     0      -     0     +     +     0     +     -     +     +     +
  1329→Regular     0     +      +     +     0     -     0     +     +     -     +     0
  1330→Innocent    -     0      0     +     0     0     0     +     +     +     -     0
  1331→Explorer    +     0      0     -     +     +     0     0     +     0     0     -
  1332→
  1333→+ = 相近 (similar)
  1334→- = 对立 (conflict)
  1335→0 = 中性 (neutral)
  1336→```
  1337→
  1338→### 9.3 版本历史
  1339→
  1340→| 版本 | 日期 | 主要变更 |
  1341→|------|------|----------|
  1342→| v3.0 | - | 初版四维模型设计 |
  1343→| v3.5 | - | 加入荣格阴影与阿德勒自卑感理论 |
  1344→| v4.0 | 2026-01-16 | 心理学应用优化、渐进式阴影发现、深度日重新定位、成长陪伴机制完善 |
  1345→| v4.1 | 2026-01-16 | 融合v1/v2精华：双命名系统、问答确认系统、用户体验流程、荣格理论深化、层间一致性分析、个体化成长路径、五行修正 |
  1346→| **v5.0** | **2026-01-16** | **核心算法升级：中等深度八字计算（日主强弱+用神喜忌）、五点星盘模型（太阳/月亮/上升/金星/火星）、八字主导融合（70%/30%）、一致性奖励机制、可解释性模块、成长方向建议** |
  1347→
  1348→### 9.4 参考文献
  1349→
  1350→1. Jung, C.G. (1959). *The Archetypes and the Collective Unconscious*
  1351→2. Adler, A. (1927). *Understanding Human Nature*
  1352→3. Pearson, C.S. (1991). *Awakening the Heroes Within*
  1353→4. 岸见一郎 (2013). *被讨厌的勇气*
  1354→
  1355→---
  1356→
  1357→*文档结束 - VibeID 设计文档 v5.0*
  1358→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
