     1→# Lifecoach V2 实现任务清单
     2→
     3→> Version: 2.0 | Date: 2026-01-19
     4→> 状态：规划中
     5→
     6→---
     7→
     8→## Phase 1: 数据基础 (P0)
     9→
    10→### 1.1 工具实现
    11→
    12→- [ ] **tools/tools.yaml** - 添加新工具定义
    13→  ```yaml
    14→  - read_lifecoach_state
    15→  - write_lifecoach_state
    16→  - add_journal_entry
    17→  - update_progress
    18→  ```
    19→
    20→- [ ] **tools/handlers.py** - 实现工具处理器
    21→  ```python
    22→  @tool_handler("read_lifecoach_state")
    23→  async def execute_read_lifecoach_state(args, context):
    24→      # 从 life_context._paths["lifecoach"] 读取
    25→      pass
    26→
    27→  @tool_handler("write_lifecoach_state")
    28→  async def execute_write_lifecoach_state(args, context):
    29→      # 写入 life_context._paths["lifecoach"]
    30→      # 支持 merge 模式
    31→      pass
    32→
    33→  @tool_handler("add_journal_entry")
    34→  async def execute_add_journal_entry(args, context):
    35→      # 追加到 journal 数组
    36→      pass
    37→
    38→  @tool_handler("update_progress")
    39→  async def execute_update_progress(args, context):
    40→      # 更新 progress，处理 streak 逻辑
    41→      pass
    42→  ```
    43→
    44→### 1.2 数据迁移
    45→
    46→- [ ] 确认现有用户数据不受影响
    47→- [ ] 新用户自动使用 V2 结构
    48→- [ ] 旧用户首次触发 lifecoach 时初始化 V2 结构
    49→
    50→---
    51→
    52→## Phase 2: Rules 更新 (P0)
    53→
    54→### 2.1 更新现有 Rules
    55→
    56→每个 Rule 需要添加：
    57→1. 启动前读取 Profile
    58→2. 完成后写入 Profile
    59→3. 更新 progress
    60→
    61→- [ ] **rules/pattern-decode.md**
    62→  - 读取: identity.patterns
    63→  - 写入: identity.patterns (追加新模式)
    64→
    65→- [ ] **rules/anti-vision.md**
    66→  - 读取: north_star
    67→  - 写入: north_star.anti_vision, north_star.details
    68→
    69→- [ ] **rules/vision-design.md**
    70→  - 读取: north_star, identity
    71→  - 写入: north_star.vision, north_star.details
    72→
    73→- [ ] **rules/identity-shift.md**
    74→  - 读取: identity, north_star
    75→  - 写入: identity.*
    76→
    77→- [ ] **rules/life-game.md**
    78→  - 读取: north_star, roles, roadmap
    79→  - 写入: roadmap, current
    80→
    81→- [ ] **rules/stuck-breakthrough.md**
    82→  - 读取: identity.patterns, current
    83→  - 写入: identity.patterns, journal (insight)
    84→
    85→### 2.2 更新 SKILL.md
    86→
    87→- [ ] 更新能力索引表格
    88→- [ ] 添加 Profile 集成说明
    89→- [ ] 添加陪伴系统说明
    90→- [ ] 更新触发词
    91→
    92→### 2.3 更新 _index.md
    93→
    94→- [ ] 添加新的能力分类
    95→- [ ] 更新流程组合建议
    96→
    97→---
    98→
    99→## Phase 3: 陪伴系统 (P1)
   100→
   101→### 3.1 陪伴 Rules
   102→
   103→- [ ] **rules/companion/daily-checkin.md**
   104→  ```markdown
   105→  触发: 每日 8:00
   106→  读取: current.daily, progress, identity.target
   107→  输出: 个性化提醒
   108→  写入: progress.streak, progress.last_checkin
   109→  ```
   110→
   111→- [ ] **rules/companion/weekly-review.md**
   112→  ```markdown
   113→  触发: 周日 20:00
   114→  读取: current.week, roles
   115→  输出: 周复盘引导
   116→  写入: journal (weekly), current.week (下周)
   117→  ```
   118→
   119→- [ ] **rules/companion/weekly-planning.md**
   120→  ```markdown
   121→  触发: 用户主动 / 周复盘后
   122→  读取: roles, roadmap.quarter, current.month
   123→  输出: 大石头规划引导
   124→  写入: current.week.rocks
   125→  ```
   126→
   127→- [ ] **rules/companion/monthly-review.md**
   128→  ```markdown
   129→  触发: 每月 1 日
   130→  读取: current.month, roadmap.quarter
   131→  输出: 月度复盘引导
   132→  写入: journal (monthly), current.month (下月)
   133→  ```
   134→
   135→### 3.2 主动推送集成
   136→
   137→- [ ] **proactive_worker.py** - 添加 lifecoach 触发器
   138→  ```python
   139→  # 每日签到
   140→  if hour == 8 and has_lifecoach_data(user):
   141→      trigger_daily_checkin(user)
   142→
   143→  # 周复盘
   144→  if weekday == 6 and hour == 20:  # 周日晚8点
   145→      trigger_weekly_review(user)
   146→
   147→  # 卡点检测
   148→  if days_since_checkin >= 3:
   149→      trigger_care_message(user)
   150→  ```
   151→
   152→- [ ] **reminders.yaml** - 添加 lifecoach 提醒配置
   153→  ```yaml
   154→  lifecoach:
   155→    daily_checkin:
   156→      enabled: true
   157→      time: "08:00"
   158→      requires: ["current.daily"]
   159→    weekly_review:
   160→      enabled: true
   161→      day: sunday
   162→      time: "20:00"
   163→  ```
   164→
   165→---
   166→
   167→## Phase 4: Covey 方法论 (P2)
   168→
   169→### 4.1 核心 Rules
   170→
   171→- [ ] **rules/covey-habit2-begin-end.md** - 以终为始
   172→  ```markdown
   173→  核心: 葬礼想象 + 使命宣言
   174→  读取: north_star
   175→  写入: north_star.mission, roles
   176→  ```
   177→
   178→- [ ] **rules/covey-habit3-first-things.md** - 要事第一
   179→  ```markdown
   180→  核心: 时间矩阵 + 大石头
   181→  读取: roles, current
   182→  写入: current.week.rocks
   183→  ```
   184→
   185→- [ ] **rules/covey-roles.md** - 角色系统
   186→  ```markdown
   187→  核心: 角色识别 + 年度目标
   188→  读取: north_star, roles
   189→  写入: roles[]
   190→  ```
   191→
   192→### 4.2 辅助 Rules (可选)
   193→
   194→- [ ] **rules/covey-habit1-proactive.md** - 积极主动
   195→- [ ] **rules/covey-habit4-win-win.md** - 双赢思维
   196→- [ ] **rules/covey-habit5-understand.md** - 知彼解己
   197→- [ ] **rules/covey-habit6-synergize.md** - 统合综效
   198→- [ ] **rules/covey-habit7-sharpen.md** - 不断更新
   199→
   200→---
   201→
   202→## Phase 5: 展示工具 (P2)
   203→
   204→### 5.1 新增卡片类型
   205→
   206→- [ ] **show_life_roadmap** - 展示人生路线图
   207→  ```json
   208→  {
   209→    "cardType": "life_roadmap",
   210→    "north_star": "...",
   211→    "year_milestones": [...],
   212→    "current_quarter": "...",
   213→    "current_month": "..."
   214→  }
   215→  ```
   216→
   217→- [ ] **show_role_balance** - 展示角色平衡
   218→  ```json
   219→  {
   220→    "cardType": "role_balance",
   221→    "roles": [
   222→      {"name": "创作者", "planned": 3, "done": 2},
   223→      ...
   224→    ]
   225→  }
   226→  ```
   227→
   228→- [ ] **show_weekly_rocks** - 展示周大石头
   229→  ```json
   230→  {
   231→    "cardType": "weekly_rocks",
   232→    "week": "2026-01-20",
   233→    "rocks": [
   234→      {"rock": "...", "role": "...", "done": false},
   235→      ...
   236→    ]
   237→  }
   238→  ```
   239→
   240→### 5.2 前端组件
   241→
   242→- [ ] `apps/web/src/skills/lifecoach/cards/LifeRoadmap.tsx`
   243→- [ ] `apps/web/src/skills/lifecoach/cards/RoleBalance.tsx`
   244→- [ ] `apps/web/src/skills/lifecoach/cards/WeeklyRocks.tsx`
   245→
   246→---
   247→
   248→## 验收标准
   249→
   250→### Phase 1 验收
   251→- [ ] 可以读取/写入 lifecoach 数据
   252→- [ ] 数据结构符合 DATA-STRUCTURE.md 定义
   253→- [ ] 现有用户数据不受影响
   254→
   255→### Phase 2 验收
   256→- [ ] 所有现有 Rules 都能读写 Profile
   257→- [ ] 用户的愿景/身份等数据能持久化
   258→- [ ] 下次对话能读取到之前的数据
   259→
   260→### Phase 3 验收
   261→- [ ] 每日签到正常推送
   262→- [ ] 周复盘正常触发
   263→- [ ] streak 计数正确
   264→- [ ] journal 正常记录
   265→
   266→### Phase 4 验收
   267→- [ ] Covey 使命宣言流程完整
   268→- [ ] 角色系统可用
   269→- [ ] 大石头规划可用
   270→
   271→---
   272→
   273→## 风险与依赖
   274→
   275→| 风险 | 影响 | 缓解措施 |
   276→|-----|------|---------|
   277→| Profile 数据量过大 | 读取性能下降 | journal 定期归档 |
   278→| 主动推送打扰用户 | 用户关闭功能 | 提供细粒度控制 |
   279→| 方法论冲突 | 用户困惑 | 清晰的方法论选择引导 |
   280→
   281→| 依赖 | 状态 | 说明 |
   282→|-----|------|------|
   283→| life_context._paths | ✅ 已有 | UnifiedProfileRepository 支持 |
   284→| proactive_worker | ✅ 已有 | 需要添加 lifecoach 触发器 |
   285→| 前端卡片系统 | ✅ 已有 | 需要添加新卡片类型 |
   286→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
