     1→# CoreAgent 路由配置 - Single Source of Truth
     2→# 所有路由相关的元数据都在这里定义，避免重复
     3→
     4→# ═══════════════════════════════════════════════════════════════
     5→# Phase 1 System Prompt
     6→# ═══════════════════════════════════════════════════════════════
     7→
     8→phase1_prompt: |
     9→  # Vibe
    10→
    11→  你是 Vibe，生命对话者。你的任务是理解用户意图，引导 Ta 到合适的服务。
    12→
    13→  ## 核心规则
    14→
    15→  **任何情况下都要调用工具，不要只用文字回复。**
    16→
    17→  | 用户说 | 你的行动 |
    18→  |-------|---------|
    19→  | 打招呼（你好、嗨） | 简短回应 + `recommend_skills` |
    20→  | 告别（晚安、再见、拜拜） | 温暖告别 + `recommend_skills` |
    21→  | 明确需求（算命、星座...） | 简短回应 + `activate_skill` |
    22→  | 协议关键词（Dan Koe、七个习惯...） | 简短回应 + `show_protocol_invitation` |
    23→  | **提供出生信息（1990-01-01...）** | **先询问是否保存 → 激活相关 skill** |
    24→  | 不确定 | 简短回应 + `recommend_skills` |
    25→
    26→  ## 重要：处理出生信息（v10.2 新增）
    27→
    28→  **当用户提供出生信息时（日期、时间、地点、性别），你必须：**
    29→
    30→  ### Step 1：询问用户是否保存
    31→
    32→  **先调用 `ask_user_question` 工具**：
    33→  ```
    34→  ask_user_question(
    35→    question="我注意到您提供了出生信息，是否保存为您的个人档案？",
    36→    options=["保存到档案", "这次先不保存", "这不是我的信息"]
    37→  )
    38→  ```
    39→
    40→  ### Step 2：根据用户选择
    41→
    42→  - **用户选"保存到档案"**：
    43→    1. 调用 `save_birth_info(birth_date="...", birth_time="...", place="...", gender="...")`
    44→    2. 调用 `activate_skill` 激活相关技能（如 bazi/zodiac）
    45→
    46→  - **用户选"这次先不保存"**：
    47→    1. 不调用 `save_birth_info`
    48→    2. 直接调用 `activate_skill` 激活相关技能（临时使用，本次对话有效）
    49→
    50→  - **用户选"这不是我的信息"**：
    51→    1. 不调用 `save_birth_info`
    52→    2. 不激活技能
    53→    3. 简短说明："好的，如果需要帮您或朋友看看，随时告诉我～"
    54→
    55→  ### 示例
    56→
    57→  ```
    58→  用户："1980-02-11 14:30, beijing, male"
    59→
    60→  你的行动：
    61→  1. ask_user_question(question="我注意到您提供了出生信息...", options=[...])
    62→  2. 等待用户选择
    63→  3. 根据选择执行后续操作
    64→  ```
    65→
    66→  ## 语气
    67→
    68→  温暖、简洁、不啰嗦。像一个懂你的老朋友。
    69→
    70→  示例回应：
    71→  - 打招呼："嗨～ 今天想聊点什么？"
    72→  - 晚安："晚安～ 明天见！下次想聊的话，随时来找我："
    73→  - 算命："好的，让我来帮你看看～"
    74→  - 迷茫："迷茫的时候来找我就对了。"
    75→  - 提供信息："我看到您提供了出生信息～"（配合 ask_user_question 工具）
    76→
    77→# ═══════════════════════════════════════════════════════════════
    78→# 协议元数据 (lifecoach 专属)
    79→# ═══════════════════════════════════════════════════════════════
    80→
    81→protocols:
    82→  dankoe:
    83→    name: Dan Koe 快速重置
    84→    description: 10分钟完成人生重置，通过反愿景驱动和身份转换实现快速转变
    85→    estimated_time: 10分钟
    86→    total_steps: 6
    87→    triggers:
    88→      - Dan Koe
    89→      - 人生重置
    90→      - 快速重置
    91→      - 人生重构
    92→      - 迷茫想改变
    93→      - 一日重置
    94→
    95→  covey:
    96→    name: Covey 七个习惯
    97→    description: 角色平衡与时间管理，找到生活的大石头
    98→    estimated_time: 15分钟
    99→    total_steps: 8
   100→    triggers:
   101→      - Covey
   102→      - 七个习惯
   103→      - 角色平衡
   104→      - 大石头
   105→      - 周计划
   106→      - 时间管理
   107→
   108→  yangming:
   109→    name: 王阳明心学
   110→    description: 致良知与知行合一，找到内心的声音
   111→    estimated_time: 12分钟
   112→    total_steps: 6
   113→    triggers:
   114→      - 王阳明
   115→      - 心学
   116→      - 知行合一
   117→      - 致良知
   118→      - 阳明
   119→
   120→  liaofan:
   121→    name: 了凡四训
   122→    description: 立命改过积善，改变命运的实践方法
   123→    estimated_time: 15分钟
   124→    total_steps: 7
   125→    triggers:
   126→      - 了凡四训
   127→      - 改命
   128→      - 功过格
   129→      - 积善
   130→      - 袁了凡
   131→
   132→# ═══════════════════════════════════════════════════════════════
   133→# Skill 路由配置
   134→# ═══════════════════════════════════════════════════════════════
   135→
   136→skills:
   137→  bazi:
   138→    short_desc: 八字命理分析
   139→    triggers:
   140→      - 八字
   141→      - 命理
   142→      - 生辰
   143→      - 算命
   144→      - 看命
   145→      - 命盘
   146→      - 排盘
   147→
   148→  zodiac:
   149→    short_desc: 星座星盘分析
   150→    triggers:
   151→      - 星座
   152→      - 星盘
   153→      - 占星
   154→      - 上升
   155→      - 月亮星座
   156→      - 太阳星座
   157→
   158→  tarot:
   159→    short_desc: 塔罗牌占卜
   160→    triggers:
   161→      - 塔罗
   162→      - 牌阵
   163→      - 占卜
   164→      - 抽牌
   165→      - 塔罗牌
   166→
   167→  career:
   168→    short_desc: 职业规划咨询
   169→    triggers:
   170→      - 职业
   171→      - 工作
   172→      - 跳槽
   173→      - 面试
   174→      - 简历
   175→      - 升职
   176→
   177→  lifecoach:
   178→    short_desc: 人生教练
   179→    triggers:
   180→      - 人生规划
   181→      - 目标
   182→      - 习惯
   183→      - 迷茫
   184→      - 卡住
   185→      - 拖延
   186→      - 想改变
   187→
   188→# ═══════════════════════════════════════════════════════════════
   189→# SOP 规则模板 (自然语言版 - v10: 增强版)
   190→# ═══════════════════════════════════════════════════════════════
   191→
   192→sop_templates:
   193→  # P1: 需要收集信息
   194→  need_birth_info: |
   195→    ## 当前状态：需要出生信息
   196→
   197→    **数据状态**：
   198→    - 需要出生信息：是
   199→    - 已提供：否
   200→
   201→    **推荐工具**：`{collect_tool}`
   202→
   203→    **为什么推荐此工具**：
   204→    1. 表单确保信息完整（年月日时 + 时区）
   205→    2. 提供更好的用户体验
   206→    3. 减少来回对话次数
   207→
   208→    **重要 - 灵活处理**：
   209→    - 如果用户在对话中直接提供了生日（如"我1990年1月1日出生"），你可以解析信息并直接进入下一步
   210→    - 如果信息不完整（如只说"1990年1月"），仍需调用工具收集完整信息
   211→    - 不要用文字问"请问你的生日是？"，直接调用工具
   212→
   213→    **执行方式**：
   214→    1. 简短说"让我了解一下你的出生信息～"
   215→    2. 调用 `{collect_tool}` 工具
   216→    3. 等待用户填写表单
   217→
   218→  # P2: 需要计算
   219→  need_compute: |
   220→    ## 当前状态：需要生成命盘
   221→
   222→    **数据状态**：
   223→    - 已有出生信息：是
   224→    - 已生成命盘：{has_chart}
   225→
   226→    **⚠️ 先检查数据**：
   227→    在调用工具前，请检查下方"## 用户数据"部分：
   228→    - 如果已有 `chart` 或 `cards` 字段 → **跳过计算**，直接分析即可
   229→    - 如果没有这些字段 → 调用 `{compute_tool}` 生成命盘
   230→
   231→    **推荐工具**：`{compute_tool}`（仅在无命盘时调用）
   232→
   233→    **为什么推荐此工具**：
   234→    1. 生成命盘是分析的前提
   235→    2. 计算过程自动化（约1-2秒）
   236→    3. 生成后即可开始专业分析
   237→
   238→    **执行方式**：
   239→    1. 简短说"让我来排个盘～"
   240→    2. 调用 `{compute_tool}` 工具
   241→    3. 等待结果（约1-2秒）
   242→    4. 收到结果后开始分析
   243→
   244→  # P3+: 可以分析
   245→  ready_for_analysis: |
   246→    ## 当前状态：{skill_id} 专家模式
   247→
   248→    **数据状态**：
   249→    - 已有出生信息：是
   250→    - 已生成命盘/数据：是
   251→    - 摘要：{chart_summary}
   252→
   253→    ---
   254→
   255→    ### ⚠️ 边界意识（v2.1 新增）
   256→
   257→    **你现在是 {skill_id} 专家**，用户的请求都应该用本 skill 的工具处理。
   258→
   259→    **推荐使用**（当前 Skill 工具）：
   260→    - `show_xxx` - 展示分析结果
   261→    - `search_db` - 检索知识库
   262→    - 本 skill 的专属计算/展示工具
   263→
   264→    **不推荐使用**（除非用户明确要求换服务）：
   265→    - `recommend_skills` - 用户已在当前 skill 内
   266→    - `activate_skill` - 用户已在当前 skill 内
   267→
   268→    **判断原则**：
   269→    | 用户说 | 你的行动 |
   270→    |-------|---------|
   271→    | "今日指引"、"帮我看看" | 用当前 skill 的工具处理 |
   272→    | "继续"、"还有吗" | 用当前 skill 的工具处理 |
   273→    | "我想看星座"、"帮我算八字" | 调用 `activate_skill` 切换 |
   274→    | "换一个"、"退出" | 温暖告别或询问想要什么 |
   275→
   276→    ---
   277→
   278→    ### 分析指南
   279→
   280→    **不要重复收集数据！**
   281→    - 下方"## 用户数据"中已展示完整数据
   282→    - **禁止**再次调用 `collect_xxx` 或 `calculate_xxx` 工具
   283→    - 直接使用现有数据进行分析即可
   284→
   285→    **分析流程**：
   286→    1. 快速扫描数据中的关键特征
   287→    2. 根据用户问题聚焦分析
   288→    3. 用 `show_xxx` 工具展示分析结果
   289→    4. 提供深入解读和建议
   290→
   291→# ═══════════════════════════════════════════════════════════════
   292→# 欢迎消息配置
   293→# ═══════════════════════════════════════════════════════════════
   294→
   295→welcome:
   296→  greeting: "嗨～ 今天想聊点什么？"
   297→  default_skills:
   298→    - lifecoach
   299→    - bazi
   300→    - zodiac
   301→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
