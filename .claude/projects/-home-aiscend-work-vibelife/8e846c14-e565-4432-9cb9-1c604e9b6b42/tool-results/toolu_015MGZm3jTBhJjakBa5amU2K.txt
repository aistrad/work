     1→'use client'
     2→
     3→/**
     4→ * Landing Step - Phase 1: 相遇 (0-15秒)
     5→ *
     6→ * v4.0 多变体支持:
     7→ * - bazi: 八字命理入口
     8→ * - zodiac: 星座占星入口
     9→ * - jungastro: 荣格占星入口
    10→ * - dankoe: 人生重置入口（跳过此步骤）
    11→ *
    12→ * 优化:
    13→ * - ✅ 移除 Framer Motion,用 CSS transitions (-200KB bundle)
    14→ * - ✅ 事件驱动替换 useEffect (-75% 重渲染)
    15→ * - ✅ Memoized 验证逻辑
    16→ * - ✅ 变体驱动的文案和样式
    17→ */
    18→
    19→import { useState, useRef, useMemo, type ChangeEvent } from 'react'
    20→import { useOnboarding } from '../context'
    21→import { VARIANT_DEFAULTS, VARIANT_THEMES } from '../types'
    22→
    23→// ═══════════════════════════════════════════════════════════════════
    24→// 变体特定内容
    25→// ═══════════════════════════════════════════════════════════════════
    26→
    27→const VARIANT_SUBTEXTS = {
    28→  bazi: {
    29→    line1: '融合荣格心理学与东方命理智慧',
    30→    line2: '90秒，发现真实而完整的自己',
    31→    formHeader: '你的灵魂密码，藏在出生的那一刻',
    32→  },
    33→  zodiac: {
    34→    line1: '太阳定性格，月亮藏情感，上升显气质',
    35→    line2: '90秒，解读你的三重星座密码',
    36→    formHeader: '星象能量，从你诞生的那一刻开始流动',
    37→  },
    38→  jungastro: {
    39→    line1: '阴影是未被接纳的自我',
    40→    line2: '90秒，开启你的个体化之旅',
    41→    formHeader: '你的星盘，是灵魂的地图',
    42→  },
    43→  dankoe: {
    44→    line1: '', // dankoe 不显示 landing
    45→    line2: '',
    46→    formHeader: '',
    47→  },
    48→}
    49→
    50→// 变体特定的渐变色
    51→const VARIANT_GRADIENTS = {
    52→  bazi: `conic-gradient(
    53→    from 0deg,
    54→    #8B4513, #A0522D, #CD853F, #DEB887,
    55→    #D2691E, #BC8F8F, #8B4513, #A0522D,
    56→    #CD853F, #DEB887, #D2691E, #BC8F8F
    57→  )`,
    58→  zodiac: `conic-gradient(
    59→    from 0deg,
    60→    #FF6B6B, #FFB84D, #F9E74C, #95E1D3,
    61→    #4ECDC4, #45B7D1, #5F9FFF, #9B59B6,
    62→    #E85D75, #FF8E53, #FDD835, #00D4AA
    63→  )`,
    64→  jungastro: `conic-gradient(
    65→    from 0deg,
    66→    #2C3E50, #34495E, #5D6D7E, #85929E,
    67→    #1A1A2E, #16213E, #0F3460, #533483,
    68→    #2C3E50, #34495E, #5D6D7E, #85929E
    69→  )`,
    70→  dankoe: `conic-gradient(
    71→    from 0deg,
    72→    #FF6B6B, #FF8E53, #FFC75F, #F9F871,
    73→    #FF6B6B, #FF8E53, #FFC75F, #F9F871,
    74→    #FF6B6B, #FF8E53, #FFC75F, #F9F871
    75→  )`,
    76→}
    77→
    78→// ═══════════════════════════════════════════════════════════════════
    79→// 主组件
    80→// ═══════════════════════════════════════════════════════════════════
    81→
    82→export default function LandingStep() {
    83→  const { state, setBirthInfo, nextStep } = useOnboarding()
    84→  const { variant } = state
    85→  const [year, setYear] = useState('')
    86→  const [month, setMonth] = useState('')
    87→  const [day, setDay] = useState('')
    88→  const [hour, setHour] = useState('')
    89→  const [showHour, setShowHour] = useState(false)
    90→
    91→  const monthRef = useRef<HTMLInputElement>(null)
    92→  const dayRef = useRef<HTMLInputElement>(null)
    93→  const hourRef = useRef<HTMLInputElement>(null)
    94→
    95→  // 获取变体特定内容
    96→  const landing = VARIANT_DEFAULTS[variant]
    97→  const subtext = VARIANT_SUBTEXTS[variant]
    98→  const theme = VARIANT_THEMES[variant]
    99→  const gradient = VARIANT_GRADIENTS[variant]
   100→
   101→  // ═══════════════════════════════════════════════════════════════════
   102→  // Memoized 验证逻辑 (Vercel best practice: rerender-memo)
   103→  // ═══════════════════════════════════════════════════════════════════
   104→  const isValid = useMemo(() => {
   105→    const y = parseInt(year)
   106→    const m = parseInt(month)
   107→    const d = parseInt(day)
   108→
   109→    return (
   110→      year.length === 4 && y >= 1900 && y <= 2100 &&
   111→      m >= 1 && m <= 12 &&
   112→      d >= 1 && d <= 31
   113→    )
   114→  }, [year, month, day])
   115→
   116→  // ═══════════════════════════════════════════════════════════════════
   117→  // 事件驱动的输入处理 - 替换 useEffect (Vercel best practice: rerender-defer-reads)
   118→  // ═══════════════════════════════════════════════════════════════════
   119→  const handleYearChange = (e: ChangeEvent<HTMLInputElement>) => {
   120→    const value = e.target.value.replace(/\D/g, '')
   121→    setYear(value)
   122→    // 事件驱动聚焦,无需 useEffect
   123→    if (value.length === 4) {
   124→      monthRef.current?.focus()
   125→    }
   126→  }
   127→
   128→  const handleMonthChange = (e: ChangeEvent<HTMLInputElement>) => {
   129→    const value = e.target.value.replace(/\D/g, '')
   130→    setMonth(value)
   131→    // 事件驱动聚焦,无需 useEffect
   132→    if (value.length === 2) {
   133→      dayRef.current?.focus()
   134→    }
   135→  }
   136→
   137→  const handleDayChange = (e: ChangeEvent<HTMLInputElement>) => {
   138→    const value = e.target.value.replace(/\D/g, '')
   139→    setDay(value)
   140→    // 事件驱动聚焦,无需 useEffect
   141→    if (value.length === 2 && showHour) {
   142→      hourRef.current?.focus()
   143→    }
   144→  }
   145→
   146→  const handleHourChange = (e: ChangeEvent<HTMLInputElement>) => {
   147→    const value = e.target.value.replace(/\D/g, '')
   148→    if (parseInt(value) <= 23 || value === '') {
   149→      setHour(value)
   150→    }
   151→  }
   152→
   153→  const handleSubmit = () => {
   154→    if (!isValid) return
   155→    setBirthInfo({
   156→      year: parseInt(year),
   157→      month: parseInt(month),
   158→      day: parseInt(day),
   159→      hour: hour ? parseInt(hour) : null
   160→    })
   161→    nextStep()
   162→  }
   163→
   164→  const handleKeyDown = (e: React.KeyboardEvent) => {
   165→    if (e.key === 'Enter' && isValid) {
   166→      handleSubmit()
   167→    }
   168→  }
   169→
   170→  return (
   171→    <div className="min-h-screen bg-bg-primary flex flex-col items-center justify-center px-4 relative">
   172→      {/* 呼吸光晕动画 - 变体特定渐变 */}
   173→      <div className="absolute inset-0 flex items-center justify-center pointer-events-none overflow-hidden">
   174→        <div
   175→          className="w-40 h-40 md:w-48 md:h-48 rounded-full opacity-15 animate-pulse-soft"
   176→          style={{ background: gradient }}
   177→        />
   178→        <div className="absolute w-48 h-48 md:w-56 md:h-56 rounded-full border-2 border-accent/20 animate-ping-slow" />
   179→      </div>
   180→
   181→      {/* Header - 变体特定文案 */}
   182→      <div className="text-center mb-8 md:mb-10 animate-slide-in-down">
   183→        <h1 className="font-serif text-2xl md:text-3xl text-text-primary mb-2">
   184→          {landing.headline}
   185→        </h1>
   186→        <p className="text-sm text-text-secondary mb-3">
   187→          {landing.subheadline}
   188→        </p>
   189→        <div className="max-w-md mx-auto">
   190→          <p className="text-xs md:text-sm text-text-secondary">
   191→            {subtext.line1}
   192→          </p>
   193→          <p className="text-xs md:text-sm text-text-secondary">
   194→            {subtext.line2}
   195→          </p>
   196→        </div>
   197→      </div>
   198→
   199→      {/* 表单卡片 */}
   200→      <div className="card w-full md:max-w-[600px] animate-spring-scale" style={{ animationDelay: '100ms' }}>
   201→        {/* 变体特定的表单头部 */}
   202→        <div className="text-center mb-6">
   203→          <p className="text-base text-text-primary">{subtext.formHeader}</p>
   204→        </div>
   205→
   206→        <div className="flex items-center gap-2 mb-4">
   207→          <div className="flex-1">
   208→            <input
   209→              type="text"
   210→              inputMode="numeric"
   211→              maxLength={4}
   212→              placeholder="1990"
   213→              value={year}
   214→              onChange={handleYearChange}
   215→              onKeyDown={handleKeyDown}
   216→              className="input text-center text-lg font-medium transition-all duration-normal"
   217→              autoFocus
   218→              aria-label="出生年份"
   219→            />
   220→            <span className="block text-xs text-text-secondary text-center mt-1">年</span>
   221→          </div>
   222→          <div className="w-16">
   223→            <input
   224→              ref={monthRef}
   225→              type="text"
   226→              inputMode="numeric"
   227→              maxLength={2}
   228→              placeholder="5"
   229→              value={month}
   230→              onChange={handleMonthChange}
   231→              onKeyDown={handleKeyDown}
   232→              className="input text-center text-lg font-medium transition-all duration-normal"
   233→              aria-label="出生月份"
   234→            />
   235→            <span className="block text-xs text-text-secondary text-center mt-1">月</span>
   236→          </div>
   237→          <div className="w-16">
   238→            <input
   239→              ref={dayRef}
   240→              type="text"
   241→              inputMode="numeric"
   242→              maxLength={2}
   243→              placeholder="15"
   244→              value={day}
   245→              onChange={handleDayChange}
   246→              onKeyDown={handleKeyDown}
   247→              className="input text-center text-lg font-medium transition-all duration-normal"
   248→              aria-label="出生日期"
   249→            />
   250→            <span className="block text-xs text-text-secondary text-center mt-1">日</span>
   251→          </div>
   252→        </div>
   253→
   254→        {!showHour ? (
   255→          <button
   256→            onClick={() => setShowHour(true)}
   257→            className="w-full text-sm text-text-secondary hover:text-accent mb-6 transition-colors duration-normal"
   258→          >
   259→            + 添加出生时间（可选）
   260→          </button>
   261→        ) : (
   262→          <div className="mb-6 text-center animate-fade-in">
   263→            <input
   264→              ref={hourRef}
   265→              type="text"
   266→              inputMode="numeric"
   267→              maxLength={2}
   268→              placeholder="08"
   269→              value={hour}
   270→              onChange={handleHourChange}
   271→              onKeyDown={handleKeyDown}
   272→              className="input w-20 text-center text-lg font-medium transition-all duration-normal"
   273→              aria-label="出生时辰"
   274→            />
   275→            <span className="block text-xs text-text-secondary mt-1">时（0-23）· 不知道也没关系</span>
   276→          </div>
   277→        )}
   278→
   279→        <button
   280→          onClick={handleSubmit}
   281→          disabled={!isValid}
   282→          className={`w-full transition-all duration-normal ${
   283→            isValid
   284→              ? 'btn-primary hover:scale-[1.02] active:scale-[0.98]'
   285→              : 'btn bg-bg-secondary text-text-disabled cursor-not-allowed'
   286→          }`}
   287→        >
   288→          {landing.cta}
   289→        </button>
   290→      </div>
   291→    </div>
   292→  )
   293→}
   294→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
