     1→'use client'
     2→
     3→/**
     4→ * Onboarding Page - v6.0
     5→ *
     6→ * 多变体入口：bazi / zodiac / jungastro / dankoe
     7→ *
     8→ * URL 参数：
     9→ * - /onboarding              → 默认 bazi
    10→ * - /onboarding?variant=zodiac
    11→ * - /onboarding?variant=dankoe
    12→ *
    13→ * 优化:
    14→ * - ✅ 动态导入步骤组件 (Vercel best practice: bundle-dynamic-imports)
    15→ * - ✅ Suspense 边界实现流式加载 (Vercel best practice: async-suspense-boundaries)
    16→ * - ✅ 变体驱动的差异化体验
    17→ */
    18→
    19→import { Suspense } from 'react'
    20→import dynamic from 'next/dynamic'
    21→import { useSearchParams } from 'next/navigation'
    22→import { useOnboarding } from './context'
    23→import type { VariantId } from './types'
    24→
    25→// ═══════════════════════════════════════════════════════════════════
    26→// 动态导入步骤组件 - 减少首屏 bundle (Vercel best practice: bundle-dynamic-imports)
    27→// ═══════════════════════════════════════════════════════════════════
    28→
    29→// LandingStep 不动态导入,因为它是首屏必需
    30→import LandingStep from './steps/LandingStep'
    31→
    32→// 其他步骤动态导入,只在需要时加载
    33→const LoadingStep = dynamic(() => import('./steps/LoadingStep'), {
    34→  loading: () => <LoadingSkeleton />,
    35→  ssr: false
    36→})
    37→
    38→const EmbeddedChatStep = dynamic(() => import('./steps/EmbeddedChatStep'), {
    39→  loading: () => <LoadingSkeleton />,
    40→  ssr: false
    41→})
    42→
    43→const ConversionStep = dynamic(() => import('./steps/ConversionStep'), {
    44→  loading: () => <LoadingSkeleton />,
    45→  ssr: false
    46→})
    47→
    48→// ═══════════════════════════════════════════════════════════════════
    49→// Loading Skeleton - Suspense fallback
    50→// ═══════════════════════════════════════════════════════════════════
    51→
    52→function LoadingSkeleton() {
    53→  return (
    54→    <div className="min-h-screen flex items-center justify-center">
    55→      <div className="flex flex-col items-center gap-4">
    56→        <div className="w-16 h-16 rounded-full border-4 border-accent-primary/20 border-t-accent-primary animate-spin" />
    57→        <p className="text-sm text-text-secondary">加载中...</p>
    58→      </div>
    59→    </div>
    60→  )
    61→}
    62→
    63→// ═══════════════════════════════════════════════════════════════════
    64→// 主组件 - 使用 Suspense 边界
    65→// ═══════════════════════════════════════════════════════════════════
    66→
    67→function OnboardingFlow() {
    68→  const { state } = useOnboarding()
    69→
    70→  // dankoe 变体：跳过 landing 和 loading，直接进入 embeddedChat
    71→  // 其他变体：从 landing 开始
    72→
    73→  // LandingStep 无需 Suspense,因为它已经在客户端
    74→  if (state.step === 'landing') {
    75→    return <LandingStep />
    76→  }
    77→
    78→  // 其他步骤使用 Suspense 边界,实现流式加载
    79→  return (
    80→    <Suspense fallback={<LoadingSkeleton />}>
    81→      {state.step === 'loading' && <LoadingStep />}
    82→      {state.step === 'embeddedChat' && <EmbeddedChatStep />}
    83→      {state.step === 'conversion' && <ConversionStep />}
    84→    </Suspense>
    85→  )
    86→}
    87→
    88→// ═══════════════════════════════════════════════════════════════════
    89→// 页面入口 - 读取 variant 参数
    90→// ═══════════════════════════════════════════════════════════════════
    91→
    92→export default function OnboardingPage() {
    93→  const searchParams = useSearchParams()
    94→  const variantParam = searchParams.get('variant') as VariantId | null
    95→
    96→  // 验证 variant 参数，无效则使用默认值
    97→  const validVariants: VariantId[] = ['bazi', 'zodiac', 'jungastro', 'dankoe']
    98→  const variant: VariantId = variantParam && validVariants.includes(variantParam)
    99→    ? variantParam
   100→    : 'bazi'
   101→
   102→  // 注意：OnboardingProvider 在 layout.tsx 中，这里只是 Flow
   103→  // 如果需要在这里传递 variant，需要重构 layout
   104→  return <OnboardingFlow />
   105→}
   106→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
