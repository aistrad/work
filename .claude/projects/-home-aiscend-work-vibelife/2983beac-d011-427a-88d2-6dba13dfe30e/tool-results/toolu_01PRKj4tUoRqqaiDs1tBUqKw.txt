/home/aiscend/work/vibelife/apps/api/skills/bazi/reminders.yaml-60-
/home/aiscend/work/vibelife/apps/api/skills/bazi/reminders.yaml-61-  # ═══════════════════════════════════════════════════════════════════════════
apps/api/skills/bazi/reminders.yaml:62:  # 流年运势
/home/aiscend/work/vibelife/apps/api/skills/bazi/reminders.yaml-63-  # ═══════════════════════════════════════════════════════════════════════════
apps/api/skills/bazi/reminders.yaml-64-  - id: liunian
apps/api/skills/bazi/reminders.yaml:65:    name: 流年运势
apps/api/skills/bazi/reminders.yaml-66-    trigger:
apps/api/skills/bazi/reminders.yaml-67-      type: event_based
apps/api/skills/bazi/reminders.yaml:68:      event: new_year
apps/api/skills/bazi/reminders.yaml-69-      advance_days: [7, 0]  # 新年前7天、新年当天
apps/api/skills/bazi/reminders.yaml-70-    content:
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-259-@tool_handler("show_bazi_fortune")
apps/api/skills/bazi/tools/handlers.py-260-async def execute_show_bazi_fortune(args: Dict[str, Any], context: ToolContext) -> Dict[str, Any]:
apps/api/skills/bazi/tools/handlers.py:261:    """展示大运流年分析 - V7 委托模式"""
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-262-    from services.agent.tool_registry import ToolRegistry
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-263-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-277-        )
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-278-
apps/api/skills/bazi/tools/handlers.py:279:    year = args.get("year") or datetime.now().year
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-280-
apps/api/skills/bazi/tools/handlers.py-281-    try:
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-288-        # 使用 BaziComputer 计算
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-289-        kline_data = await computer.generate_kline_data(full_profile)
apps/api/skills/bazi/tools/handlers.py:290:        annual = await computer.calculate_annual_fortune(full_profile, year)
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-291-
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-292-        # 构建卡片数据
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-293-        card_data = {
apps/api/skills/bazi/tools/handlers.py-294-            "userId": context.user_id,
apps/api/skills/bazi/tools/handlers.py:295:            "year": year,
apps/api/skills/bazi/tools/handlers.py-296-            "cycles": kline_data.get("phases", []),
apps/api/skills/bazi/tools/handlers.py:297:            "annual": annual,
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-298-        }
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-299-
apps/api/skills/bazi/tools/handlers.py:300:        logger.info(f"Showing bazi fortune via show_card for user {context.user_id}, year={year}")
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-301-
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-302-        # 委托给 show_card
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-323-
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-324-    # 统一参数名（支持 camelCase 和 snake_case）
apps/api/skills/bazi/tools/handlers.py:325:    start_year = args.get("start_year") or args.get("startYear")
apps/api/skills/bazi/tools/handlers.py:326:    end_year = args.get("end_year") or args.get("endYear")
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-327-
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-328-    profile = context.profile or {}
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-340-
apps/api/skills/bazi/tools/handlers.py-341-    try:
apps/api/skills/bazi/tools/handlers.py:342:        year_range = None
apps/api/skills/bazi/tools/handlers.py:343:        if start_year and end_year:
apps/api/skills/bazi/tools/handlers.py:344:            year_range = (int(start_year), int(end_year))
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-345-
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-346-        # 构建完整 profile
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-352-        kline_data = await computer.generate_kline_data(
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-353-            profile=full_profile,
apps/api/skills/bazi/tools/handlers.py:354:            year_range=year_range,
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-355-        )
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/handlers.py-356-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/SKILL.md-42-| 感情分析 | relationship | 婚姻、桃花、另一半 | HIGH |
/home/aiscend/work/vibelife/apps/api/skills/bazi/SKILL.md-43-| 财运分析 | wealth | 财运、投资、能发财吗 | MEDIUM |
apps/api/skills/bazi/SKILL.md:44:| 运势分析 | fortune | 大运、流年、今年运势 | MEDIUM |
/home/aiscend/work/vibelife/apps/api/skills/bazi/SKILL.md-45-| 合婚配对 | compatibility | 合不合、八字配对 | LOW |
/home/aiscend/work/vibelife/apps/api/skills/bazi/SKILL.md-46-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/SKILL.md-54-|---------|---------|------|
/home/aiscend/work/vibelife/apps/api/skills/bazi/SKILL.md-55-| 看命盘、排盘 | `show_bazi_chart` | 展示四柱、十神、五行 |
apps/api/skills/bazi/SKILL.md:56:| 大运、流年 | `show_bazi_fortune` | 展示大运流年分析 |
/home/aiscend/work/vibelife/apps/api/skills/bazi/SKILL.md-57-| 运势趋势 | `show_bazi_kline` | 展示运势 K 线图 |
/home/aiscend/work/vibelife/apps/api/skills/bazi/SKILL.md-58-| 缺少出生信息 | `collect_bazi_info` | 收集生辰表单 |
--
apps/api/skills/bazi/tools/tools.yaml-58-    description: |
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/tools.yaml-59-      根据出生信息计算八字命盘。
apps/api/skills/bazi/tools/tools.yaml:60:      包括四柱、日主、五行分布、十神关系、大运流年。
apps/api/skills/bazi/tools/tools.yaml-61-    implementation: tools.bazi.calculate_bazi_chart
apps/api/skills/bazi/tools/tools.yaml-62-    card_type: bazi_chart
--
apps/api/skills/bazi/tools/tools.yaml-129-  - name: show_bazi_fortune
apps/api/skills/bazi/tools/tools.yaml-130-    description: |
apps/api/skills/bazi/tools/tools.yaml:131:      展示用户的大运流年分析，包括：
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/tools.yaml-132-      - 当前所处的十年大运周期
apps/api/skills/bazi/tools/tools.yaml:133:      - 指定年份的流年运势分析
apps/api/skills/bazi/tools/tools.yaml:134:      - 大运与流年的组合影响
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/tools.yaml-135-      - 关键建议和注意事项
apps/api/skills/bazi/tools/tools.yaml-136-    card_type: bazi_fortune
apps/api/skills/bazi/tools/tools.yaml-137-    when_to_call: |
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/tools.yaml-138-      - 用户问"大运"、"十年运"、"走什么运"
apps/api/skills/bazi/tools/tools.yaml:139:      - 用户问"今年运势"、"明年运势"、"流年"
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/tools.yaml-140-      - 用户问特定年份运势（如"2027年运势"）
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/tools.yaml-141-      - 用户想了解运势周期
apps/api/skills/bazi/tools/tools.yaml-142-    parameters:
apps/api/skills/bazi/tools/tools.yaml:143:      - name: year
apps/api/skills/bazi/tools/tools.yaml-144-        type: integer
apps/api/skills/bazi/tools/tools.yaml-145-        required: false
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/tools/tools.yaml-161-      - 用户问"人生运势走向"
apps/api/skills/bazi/tools/tools.yaml-162-    parameters:
apps/api/skills/bazi/tools/tools.yaml:163:      - name: start_year
apps/api/skills/bazi/tools/tools.yaml-164-        type: integer
apps/api/skills/bazi/tools/tools.yaml-165-        required: false
apps/api/skills/bazi/tools/tools.yaml-166-        description: 起始年份
apps/api/skills/bazi/tools/tools.yaml:167:      - name: end_year
apps/api/skills/bazi/tools/tools.yaml-168-        type: integer
apps/api/skills/bazi/tools/tools.yaml-169-        required: false
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/scenarios_filter_config.yaml-26-    - 日主
/home/aiscend/work/vibelife/apps/api/skills/bazi/scenarios_filter_config.yaml-27-    - 大运
apps/api/skills/bazi/scenarios_filter_config.yaml:28:    - 流年
/home/aiscend/work/vibelife/apps/api/skills/bazi/scenarios_filter_config.yaml-29-    - 四柱
/home/aiscend/work/vibelife/apps/api/skills/bazi/scenarios_filter_config.yaml-30-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/daily-fortune.md-63-- 用神是否得力 (30%)
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/daily-fortune.md-64-- 是否有冲合刑害 (20%)
apps/api/skills/bazi/rules/daily-fortune.md:65:- 流年大运加成 (10%)
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/daily-fortune.md-66-
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/daily-fortune.md-67-### 5. 生成宜忌建议
--
apps/api/skills/bazi/rules/fortune.md-3-name: 运势分析
apps/api/skills/bazi/rules/fortune.md-4-impact: MEDIUM
apps/api/skills/bazi/rules/fortune.md:5:impactDescription: 中频需求，用户关心大运流年变化
apps/api/skills/bazi/rules/fortune.md:6:tags: 大运, 流年, 运势, 今年运势, 明年运势, 十年运, 转运, 运势周期, 流年运势
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-7----
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-8-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-11-## 适用场景
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-12-
apps/api/skills/bazi/rules/fortune.md:13:用户想了解大运走势、流年运势、运势周期等。
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-14-
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-15-典型问题：
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-25-|-----|---------|-----------|-------|
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-26-| 1 | 当前大运分析 | "大运 {current_dayun} {day_stem} 十年运" | 必须 |
apps/api/skills/bazi/rules/fortune.md:27:| 2 | 流年影响 | "流年 {year_ganzhi} {day_stem} 年运" | 必须 |
apps/api/skills/bazi/rules/fortune.md:28:| 3 | 大运流年组合 | "大运 {dayun} 流年 {liunian} 组合 影响" | 必须 |
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-29-| 4 | 冲合刑害 | "冲 合 刑 害 {interaction} 运势变化" | 推荐 |
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-30-| 5 | 用神得失 | "用神 {yong_shen} 大运 得用 失用" | 推荐 |
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-35-
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-36-1. **必须调用**：
apps/api/skills/bazi/rules/fortune.md:37:   - `show_bazi_fortune` 展示大运流年图
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-38-   - `show_insight` 展示运势洞察（不超过 4 点）
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-39-
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-40-2. **内容要求**：
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-41-   - 分析当前所处的大运阶段
apps/api/skills/bazi/rules/fortune.md:42:   - 指出流年的主要影响
apps/api/skills/bazi/rules/fortune.md:43:   - 结合大运流年给出关键提示
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-44-   - 提供具体的应对建议
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-45-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-53-### "今年运势怎么样？"
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-54-重点分析：
apps/api/skills/bazi/rules/fortune.md:55:- 流年天干地支与命局的关系
apps/api/skills/bazi/rules/fortune.md:56:- 流年与大运的组合效应
apps/api/skills/bazi/rules/fortune.md:57:- 用神在流年是否得力
apps/api/skills/bazi/rules/fortune.md:58:- 流年冲合对命局的影响
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-59-- 分领域（事业/财运/感情/健康）给建议
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-60-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-63-- 下一步大运的五行属性
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-64-- 大运交接的年份
apps/api/skills/bazi/rules/fortune.md:65:- 用神得力的流年
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-66-- 强调转运需要内在准备配合
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-67-- 不要被动等待，主动创造条件
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-75-- 困难期也是成长机会
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-76-
apps/api/skills/bazi/rules/fortune.md:77:### 大运流年关系
apps/api/skills/bazi/rules/fortune.md:78:- **大运为体，流年为用**：大运定基调，流年定具体
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/fortune.md-79-- **大运冲命局**：十年内有较大变动
apps/api/skills/bazi/rules/fortune.md:80:- **流年冲命局**：当年有明显事件
apps/api/skills/bazi/rules/fortune.md:81:- **大运流年同旺用神**：当年运势最佳
apps/api/skills/bazi/rules/fortune.md:82:- **大运流年同旺忌神**：当年需要谨慎
--
apps/api/skills/bazi/services/__init__.py-6-模块:
apps/api/skills/bazi/services/__init__.py-7-- calculator.py: 排盘计算 (四柱、日主、十神、五行)
apps/api/skills/bazi/services/__init__.py:8:- computer.py: 运势计算 (大运、流年、每日、K-Line)
apps/api/skills/bazi/services/__init__.py-9-- interpreter.py: 解读服务 (性格、事业、感情、健康)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/__init__.py-10-"""
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/relationship.md-28-| 3 | 桃花分析 | "桃花 {peach_blossom} 异性缘 感情" | 推荐 |
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/relationship.md-29-| 4 | 六亲关系 | "六亲 {day_stem} 家庭关系 父母 子女" | 推荐 |
apps/api/skills/bazi/rules/relationship.md:30:| 5 | 婚姻时机 | "大运 流年 婚姻 {spouse_star} 合" | 推荐 |
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/relationship.md-31-| 6 | 感情建议 | 综合以上给出建议 | 必须 |
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/relationship.md-32-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/relationship.md-61-### "我什么时候能结婚？"
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/relationship.md-62-重点分析：
apps/api/skills/bazi/rules/relationship.md:63:- 大运流年见配偶星透出或合入
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/relationship.md-64-- 日支逢合（六合、三合）
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/relationship.md-65-- 桃花星被引动
--
apps/api/skills/bazi/services/calculator.py-132-    name: str        # e.g., "正财", "偏印"
apps/api/skills/bazi/services/calculator.py-133-    stem: str        # The stem it refers to
apps/api/skills/bazi/services/calculator.py:134:    pillar: str      # Which pillar: "year", "month", "day", "hour"
apps/api/skills/bazi/services/calculator.py-135-    description: str = ""
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-136-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-143-    """Complete Bazi Chart (八字命盘)"""
apps/api/skills/bazi/services/calculator.py-144-    birth_info: Dict[str, Any]  # date, time, gender
apps/api/skills/bazi/services/calculator.py:145:    four_pillars: Dict[str, Pillar]  # year, month, day, hour
apps/api/skills/bazi/services/calculator.py-146-    day_master: DayMaster
apps/api/skills/bazi/services/calculator.py-147-    five_elements: Dict[str, int]  # element counts
--
apps/api/skills/bazi/services/calculator.py-213-        try:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-214-            # Parse date and time
apps/api/skills/bazi/services/calculator.py:215:            year, month, day = map(int, birth_date.split("-"))
apps/api/skills/bazi/services/calculator.py-216-            hour, minute = map(int, birth_time.split(":"))
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-217-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-218-            # Create Solar date
apps/api/skills/bazi/services/calculator.py:219:            solar = Solar.fromYmdHms(year, month, day, hour, minute, 0)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-220-            lunar = solar.getLunar()
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-221-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-225-            # Build four pillars
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-226-            four_pillars = {
apps/api/skills/bazi/services/calculator.py:227:                "year": Pillar(stem=eight_char.getYearGan(), branch=eight_char.getYearZhi()),
apps/api/skills/bazi/services/calculator.py-228-                "month": Pillar(stem=eight_char.getMonthGan(), branch=eight_char.getMonthZhi()),
apps/api/skills/bazi/services/calculator.py-229-                "day": Pillar(stem=eight_char.getDayGan(), branch=eight_char.getDayZhi()),
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-301-                ))
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-302-
apps/api/skills/bazi/services/calculator.py:303:            # Get year stem ten god
apps/api/skills/bazi/services/calculator.py:304:            year_gan = eight_char.getYearGan()
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-305-            ten_god_name = eight_char.getYearShiShenGan()
apps/api/skills/bazi/services/calculator.py-306-            if ten_god_name:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-307-                ten_gods.append(TenGod(
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-308-                    name=ten_god_name,
apps/api/skills/bazi/services/calculator.py:309:                    stem=year_gan,
apps/api/skills/bazi/services/calculator.py:310:                    pillar="year",
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-311-                ))
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/calculator.py-312-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/wealth.md-29-| 4 | 比劫争财 | "比肩 劫财 争财 {day_stem} 合作 竞争" | 推荐 |
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/wealth.md-30-| 5 | 格局与财 | "格局 {pattern_type} 财运 富贵" | 推荐 |
apps/api/skills/bazi/rules/wealth.md:31:| 6 | 财运时机 | "大运 流年 财星 {wealth_period}" | 推荐 |
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/wealth.md-32-| 7 | 理财建议 | 综合以上给出建议 | 必须 |
/home/aiscend/work/vibelife/apps/api/skills/bazi/rules/wealth.md-33-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-123-
apps/api/skills/bazi/services/api.py-124-    Args:
apps/api/skills/bazi/services/api.py:125:        year: 年份，默认当前年
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-126-
apps/api/skills/bazi/services/api.py-127-    Returns:
apps/api/skills/bazi/services/api.py-128-        fortune: 年度运势数据
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-129-    """
apps/api/skills/bazi/services/api.py:130:    year = args.get("year", date.today().year)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-131-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-132-    # 获取命盘数据
--
apps/api/skills/bazi/services/api.py-140-            "skill_data": {"bazi": bazi_data}
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-141-        }
apps/api/skills/bazi/services/api.py:142:        fortune = await computer.calculate_annual_fortune(profile, year)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-143-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-144-        return {
apps/api/skills/bazi/services/api.py-145-            "status": "success",
apps/api/skills/bazi/services/api.py:146:            "year": year,
apps/api/skills/bazi/services/api.py-147-            "fortune": fortune,
apps/api/skills/bazi/services/api.py:148:            "is_current": year == date.today().year,
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-149-        }
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-150-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-196-
apps/api/skills/bazi/services/api.py-197-    Args:
apps/api/skills/bazi/services/api.py:198:        start_year: 起始年份
apps/api/skills/bazi/services/api.py:199:        end_year: 结束年份
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-200-
apps/api/skills/bazi/services/api.py-201-    Returns:
apps/api/skills/bazi/services/api.py-202-        kline: K线数据 (data_points, phases, inflection_points)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-203-    """
apps/api/skills/bazi/services/api.py:204:    start_year = args.get("start_year")
apps/api/skills/bazi/services/api.py:205:    end_year = args.get("end_year")
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-206-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-207-    # 获取命盘数据
--
apps/api/skills/bazi/services/api.py-215-        profile["skill_data"] = {"bazi": bazi_data}
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-216-
apps/api/skills/bazi/services/api.py:217:        year_range = None
apps/api/skills/bazi/services/api.py:218:        if start_year and end_year:
apps/api/skills/bazi/services/api.py:219:            year_range = (start_year, end_year)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-220-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-221-        kline_data = await computer.generate_kline_data(
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-222-            profile=profile,
apps/api/skills/bazi/services/api.py:223:            year_range=year_range,
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-224-        )
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/api.py-225-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/interpreter.py-214-
apps/api/skills/bazi/services/interpreter.py-215-    def interpret_liunian(self, liunian_data: Dict, natal_data: Dict) -> Dict:
apps/api/skills/bazi/services/interpreter.py:216:        """解读流年"""
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/interpreter.py-217-        gan = liunian_data.get("gan", "")
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/interpreter.py-218-        zhi = liunian_data.get("zhi", "")
apps/api/skills/bazi/services/interpreter.py:219:        year = liunian_data.get("year", "")
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/interpreter.py-220-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/interpreter.py-221-        # 简化解读
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/interpreter.py-223-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/interpreter.py-224-        return {
apps/api/skills/bazi/services/interpreter.py:225:            "year": year,
apps/api/skills/bazi/services/interpreter.py-226-            "ganzhi": f"{gan}{zhi}",
apps/api/skills/bazi/services/interpreter.py-227-            "element": gan_info.get("element", ""),
apps/api/skills/bazi/services/interpreter.py:228:            "description": f"{year}年{gan}{zhi}，{gan_info.get('element', '')}气当令"
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/interpreter.py-229-        }
--
apps/api/skills/bazi/services/computer.py-7-功能:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-8-1. 大运计算 (Major Cycles)
apps/api/skills/bazi/services/computer.py:9:2. 流年计算 (Annual Fortune)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-10-3. 每日运势计算 (Daily Fortune)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-11-4. K-Line 数据生成 (实时计算，不缓存)
--
apps/api/skills/bazi/services/computer.py-70-class MajorCycle:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-71-    """十年大运周期"""
apps/api/skills/bazi/services/computer.py:72:    start_year: int
apps/api/skills/bazi/services/computer.py:73:    end_year: int
apps/api/skills/bazi/services/computer.py-74-    element: Element
apps/api/skills/bazi/services/computer.py-75-    polarity: str  # "yin" or "yang"
--
apps/api/skills/bazi/services/computer.py-81-    def to_dict(self) -> dict:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-82-        return {
apps/api/skills/bazi/services/computer.py:83:            "start_year": self.start_year,
apps/api/skills/bazi/services/computer.py:84:            "end_year": self.end_year,
apps/api/skills/bazi/services/computer.py-85-            "element": self.element.value,
apps/api/skills/bazi/services/computer.py-86-            "polarity": self.polarity,
--
apps/api/skills/bazi/services/computer.py-95-class AnnualFortune:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-96-    """年度运势"""
apps/api/skills/bazi/services/computer.py:97:    year: int
apps/api/skills/bazi/services/computer.py-98-    element: Element
apps/api/skills/bazi/services/computer.py-99-    polarity: str
--
apps/api/skills/bazi/services/computer.py-106-    def to_dict(self) -> dict:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-107-        return {
apps/api/skills/bazi/services/computer.py:108:            "year": self.year,
apps/api/skills/bazi/services/computer.py-109-            "element": self.element.value,
apps/api/skills/bazi/services/computer.py-110-            "polarity": self.polarity,
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-345-        return scores
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-346-
apps/api/skills/bazi/services/computer.py:347:    async def calculate_annual_fortune(
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-348-        self,
apps/api/skills/bazi/services/computer.py-349-        profile: Dict[str, Any],
apps/api/skills/bazi/services/computer.py:350:        year: int,
apps/api/skills/bazi/services/computer.py-351-    ) -> Dict[str, Any]:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-352-        """计算年度运势"""
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-355-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-356-        # 获取年份天干
apps/api/skills/bazi/services/computer.py:357:        stem_index = (year - 4) % 10
apps/api/skills/bazi/services/computer.py:358:        stem_name, year_element, polarity = self.STEMS[stem_index]
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-359-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-360-        # 计算影响
apps/api/skills/bazi/services/computer.py:361:        influence = self._calculate_influence(day_element, year_element)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-362-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-363-        # 计算分数
apps/api/skills/bazi/services/computer.py:364:        score = self._calculate_annual_score(day_element, year_element, influence)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-365-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-366-        # 生成主题和建议
apps/api/skills/bazi/services/computer.py:367:        theme = self._generate_annual_theme(influence, year_element)
apps/api/skills/bazi/services/computer.py:368:        highlights, cautions = self._generate_annual_advice(
apps/api/skills/bazi/services/computer.py:369:            day_element, year_element, influence
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-370-        )
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-371-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-372-        return {
apps/api/skills/bazi/services/computer.py:373:            "year": year,
apps/api/skills/bazi/services/computer.py:374:            "element": year_element.value,
apps/api/skills/bazi/services/computer.py-375-            "polarity": polarity,
apps/api/skills/bazi/services/computer.py-376-            "influence": influence,
--
apps/api/skills/bazi/services/computer.py-397-        try:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-398-            birth_date = datetime.strptime(birth_date_str, "%Y-%m-%d").date()
apps/api/skills/bazi/services/computer.py:399:            birth_year = birth_date.year
apps/api/skills/bazi/services/computer.py-400-        except ValueError:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-401-            return []
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-406-        # 计算大运
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-407-        cycles = self._calculate_major_cycles(
apps/api/skills/bazi/services/computer.py:408:            birth_year=birth_year,
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-409-            day_master_element=day_master_element,
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-410-            gender=gender,
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-413-        # 提取拐点
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-414-        inflection_points = []
apps/api/skills/bazi/services/computer.py:415:        current_year = datetime.now().year
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-416-
apps/api/skills/bazi/services/computer.py-417-        for i, cycle in enumerate(cycles):
--
apps/api/skills/bazi/services/computer.py-422-                if significance >= 2:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-423-                    inflection_points.append({
apps/api/skills/bazi/services/computer.py:424:                        "year": cycle.start_year,
apps/api/skills/bazi/services/computer.py-425-                        "type": "major_cycle_change",
apps/api/skills/bazi/services/computer.py-426-                        "significance": min(significance, 10),
apps/api/skills/bazi/services/computer.py-427-                        "title": f"大运交接 - 进入「{cycle.theme}」",
apps/api/skills/bazi/services/computer.py-428-                        "explanation": f"从「{prev_cycle.theme}」转换到「{cycle.theme}」阶段",
apps/api/skills/bazi/services/computer.py:429:                        "is_past": cycle.start_year < current_year,
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-430-                    })
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-431-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-435-        self,
apps/api/skills/bazi/services/computer.py-436-        profile: Dict[str, Any],
apps/api/skills/bazi/services/computer.py:437:        year_range: tuple = None,
apps/api/skills/bazi/services/computer.py-438-    ) -> Dict[str, Any]:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-439-        """
--
apps/api/skills/bazi/services/computer.py-442-        Args:
apps/api/skills/bazi/services/computer.py-443-            profile: 用户画像
apps/api/skills/bazi/services/computer.py:444:            year_range: (start_year, end_year)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-445-
apps/api/skills/bazi/services/computer.py-446-        Returns:
--
apps/api/skills/bazi/services/computer.py-456-        try:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-457-            birth_date = datetime.strptime(birth_date_str, "%Y-%m-%d").date()
apps/api/skills/bazi/services/computer.py:458:            birth_year = birth_date.year
apps/api/skills/bazi/services/computer.py-459-        except ValueError:
apps/api/skills/bazi/services/computer.py-460-            return {"error": "Invalid birth date"}
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-462-        day_master_element = self._get_day_master_element(profile)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-463-        gender = birth_info.get("gender", "unknown")
apps/api/skills/bazi/services/computer.py:464:        current_year = datetime.now().year
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-465-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-466-        # 默认范围
apps/api/skills/bazi/services/computer.py:467:        if not year_range:
apps/api/skills/bazi/services/computer.py:468:            year_range = (birth_year, birth_year + 80)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-469-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-470-        # 计算大运
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-471-        cycles = self._calculate_major_cycles(
apps/api/skills/bazi/services/computer.py:472:            birth_year=birth_year,
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-473-            day_master_element=day_master_element,
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-474-            gender=gender,
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-477-        # 生成数据点
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-478-        data_points = []
apps/api/skills/bazi/services/computer.py:479:        for year in range(year_range[0], year_range[1] + 1):
apps/api/skills/bazi/services/computer.py:480:            # 获取流年运势
apps/api/skills/bazi/services/computer.py:481:            annual = await self.calculate_annual_fortune(profile, year)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-482-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-483-            # 找到当前年份所属的大运
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-485-            phase = None
apps/api/skills/bazi/services/computer.py-486-            for cycle in cycles:
apps/api/skills/bazi/services/computer.py:487:                if cycle.start_year <= year < cycle.end_year:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-488-                    cycle_score = cycle.fortune_score
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-489-                    phase = cycle.phase.value
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-490-                    break
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-491-
apps/api/skills/bazi/services/computer.py:492:            # 混合大运和流年分数
apps/api/skills/bazi/services/computer.py:493:            blended_score = int(cycle_score * 0.6 + annual["score"] * 0.4)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-494-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-495-            data_points.append({
apps/api/skills/bazi/services/computer.py:496:                "year": year,
apps/api/skills/bazi/services/computer.py-497-                "score": blended_score,
apps/api/skills/bazi/services/computer.py:498:                "is_current": year == current_year,
apps/api/skills/bazi/services/computer.py-499-                "phase": phase,
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-500-            })
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-505-            trend = self._determine_trend(cycle, cycles)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-506-            phases.append({
apps/api/skills/bazi/services/computer.py:507:                "start_year": cycle.start_year,
apps/api/skills/bazi/services/computer.py:508:                "end_year": cycle.end_year,
apps/api/skills/bazi/services/computer.py-509-                "phase": cycle.phase.value,
apps/api/skills/bazi/services/computer.py-510-                "label": cycle.theme,
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-519-        current_phase = None
apps/api/skills/bazi/services/computer.py-520-        for phase in phases:
apps/api/skills/bazi/services/computer.py:521:            if phase["start_year"] <= current_year < phase["end_year"]:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-522-                current_phase = phase
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-523-                break
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-526-        next_inflection = None
apps/api/skills/bazi/services/computer.py-527-        for point in inflection_points:
apps/api/skills/bazi/services/computer.py:528:            if point["year"] > current_year:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-529-                next_inflection = point
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-530-                break
--
apps/api/skills/bazi/services/computer.py-535-            "phases": phases,
apps/api/skills/bazi/services/computer.py-536-            "inflection_points": inflection_points,
apps/api/skills/bazi/services/computer.py:537:            "current_year": current_year,
apps/api/skills/bazi/services/computer.py-538-            "current_phase": current_phase,
apps/api/skills/bazi/services/computer.py-539-            "next_inflection": next_inflection,
apps/api/skills/bazi/services/computer.py:540:            "now_summary": self._generate_now_summary(current_phase, current_year),
apps/api/skills/bazi/services/computer.py-541-            "next_summary": self._generate_next_summary(next_inflection),
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-542-        }
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-570-        """日期转儒略日 (简化版)"""
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-571-        a = (14 - d.month) // 12
apps/api/skills/bazi/services/computer.py:572:        y = d.year + 4800 - a
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-573-        m = d.month + 12 * a - 3
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-574-        return d.day + (153 * m + 2) // 5 + 365 * y + y // 4 - y // 100 + y // 400 - 32045
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-576-    def _calculate_major_cycles(
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-577-        self,
apps/api/skills/bazi/services/computer.py:578:        birth_year: int,
apps/api/skills/bazi/services/computer.py-579-        day_master_element: str,
apps/api/skills/bazi/services/computer.py-580-        gender: str = "unknown",
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-586-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-587-        # 起始天干索引
apps/api/skills/bazi/services/computer.py:588:        stem_index = (birth_year - 4) % 10
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-589-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-590-        # 根据性别确定方向
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-591-        direction = 1 if gender == "male" else -1
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-592-
apps/api/skills/bazi/services/computer.py:593:        cycle_start = birth_year + start_age
apps/api/skills/bazi/services/computer.py:594:        while cycle_start < birth_year + 85:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-595-            cycle_end = cycle_start + 10
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-596-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-609-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-610-            cycles.append(MajorCycle(
apps/api/skills/bazi/services/computer.py:611:                start_year=cycle_start,
apps/api/skills/bazi/services/computer.py:612:                end_year=cycle_end,
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-613-                element=element,
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-614-                polarity=polarity,
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-681-            return "财星"
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-682-
apps/api/skills/bazi/services/computer.py:683:    def _calculate_annual_score(
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-684-        self,
apps/api/skills/bazi/services/computer.py-685-        day_element: Element,
apps/api/skills/bazi/services/computer.py:686:        year_element: Element,
apps/api/skills/bazi/services/computer.py-687-        influence: str,
apps/api/skills/bazi/services/computer.py-688-    ) -> int:
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-715-        # 添加一些随机性 (基于日期的稳定随机)
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-716-        today = date.today()
apps/api/skills/bazi/services/computer.py:717:        seed = today.year * 10000 + today.month * 100 + today.day
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-718-        variation = (seed % 11) - 5  # -5 到 +5
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-719-
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-736-        return descriptions.get(phase, "")
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-737-
apps/api/skills/bazi/services/computer.py:738:    def _generate_annual_theme(self, influence: str, element: Element) -> str:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-739-        """生成年度主题"""
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-740-        themes = {
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-758-        return themes.get(influence, "平稳度过")
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-759-
apps/api/skills/bazi/services/computer.py:760:    def _generate_annual_advice(
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-761-        self,
apps/api/skills/bazi/services/computer.py-762-        day_element: Element,
apps/api/skills/bazi/services/computer.py:763:        year_element: Element,
apps/api/skills/bazi/services/computer.py-764-        influence: str,
apps/api/skills/bazi/services/computer.py-765-    ) -> tuple:
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-837-        self,
apps/api/skills/bazi/services/computer.py-838-        current_phase: Optional[Dict],
apps/api/skills/bazi/services/computer.py:839:        current_year: int,
apps/api/skills/bazi/services/computer.py-840-    ) -> str:
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-841-        """生成当前状态摘要"""
apps/api/skills/bazi/services/computer.py-842-        if not current_phase:
apps/api/skills/bazi/services/computer.py:843:            return f"{current_year}年，保持平稳心态，专注当下。"
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-844-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-845-        phase = current_phase.get("phase", "")
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-846-        summaries = {
apps/api/skills/bazi/services/computer.py:847:            "accumulation": f"你当前处于「积累期」。{current_year}年适合学习、积攒资源。",
apps/api/skills/bazi/services/computer.py:848:            "breakthrough": f"你当前处于「突破期」。{current_year}年适合尝试新事物、突破舒适区。",
apps/api/skills/bazi/services/computer.py:849:            "peak": f"你当前处于「高峰期」。{current_year}年是收获成果的好时机。",
apps/api/skills/bazi/services/computer.py:850:            "adjustment": f"你当前处于「调整期」。{current_year}年适合放慢脚步、反思沉淀。",
apps/api/skills/bazi/services/computer.py:851:            "transition": f"你当前处于「过渡期」。{current_year}年可能有新的变化和选择。",
apps/api/skills/bazi/services/computer.py:852:            "foundation": f"你当前处于「基础期」。{current_year}年适合打好根基、稳扎稳打。",
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-853-        }
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-854-
apps/api/skills/bazi/services/computer.py:855:        return summaries.get(phase, f"{current_year}年，保持平稳心态。")
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-856-
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-857-    def _generate_next_summary(
--
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-863-            return "继续当前的节奏前进。"
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-864-
apps/api/skills/bazi/services/computer.py:865:        years_away = next_inflection["year"] - datetime.now().year
/home/aiscend/work/vibelife/apps/api/skills/bazi/services/computer.py-866-
apps/api/skills/bazi/services/computer.py:867:        if years_away <= 1:
apps/api/skills/bazi/services/computer.py:868:            return f"即将在{next_inflection['year']}年迎来「{next_inflection['title']}」。"
apps/api/skills/bazi/services/computer.py:869:        elif years_away <= 3:
apps/api/skills/bazi/services/computer.py:870:            return f"{years_away}年后将迎来「{next_inflection['title']}」，可以开始准备。"
apps/api/skills/bazi/services/computer.py-871-        else:
apps/api/skills/bazi/services/computer.py:872:            return f"下一个关键节点在{next_inflection['year']}年。"