     1â†’"use client";
     2â†’
     3â†’/**
     4â†’ * DynamicQuickActions - åŠ¨æ€å¿«æ·æ“ä½œæŒ‰é’®
     5â†’ *
     6â†’ * æ ¹æ®ç”¨æˆ·çŠ¶æ€è‡ªåŠ¨è°ƒæ•´æ˜¾ç¤ºçš„æŒ‰é’®ï¼š
     7â†’ * 1. æœªç­¾åˆ° â†’ æ˜¾ç¤º"å¼€å§‹ä»Šå¤©"
     8â†’ * 2. æœ‰æœªå®Œæˆæ æ† â†’ æ˜¾ç¤ºå…·ä½“è¡ŒåŠ¨é¡¹
     9â†’ * 3. å‘¨äº”/å‘¨å…­/å‘¨æ—¥ â†’ æ˜¾ç¤º"å‘¨å¤ç›˜"
    10â†’ * 4. æ— åŒ—ææ˜Ÿ â†’ æ˜¾ç¤º"æ‰¾åˆ°æ–¹å‘"
    11â†’ */
    12â†’
    13â†’import { useMemo, useCallback } from "react";
    14â†’import { useRouter } from "next/navigation";
    15â†’import { cn } from "@/lib/utils";
    16â†’import { toast } from "sonner";
    17â†’
    18â†’interface StatusData {
    19â†’  streak: number;
    20â†’  checkedIn: boolean;
    21â†’  energy?: number;
    22â†’  hasBirthInfo?: boolean;  // æ˜¯å¦å·²å®Œæˆå‘½ç›˜ä¿¡æ¯
    23â†’}
    24â†’
    25â†’interface LifecoachData {
    26â†’  northStar?: string;
    27â†’  todayLevers: Array<{ id: string; text: string; completed: boolean }>;
    28â†’}
    29â†’
    30â†’interface QuickAction {
    31â†’  id: string;
    32â†’  icon: string;
    33â†’  label: string;
    34â†’  prompt?: string;      // å‘é€åˆ°å¯¹è¯çš„ prompt
    35â†’  route?: string;       // æˆ–è·³è½¬åˆ°ç‰¹å®šé¡µé¢
    36â†’  handler?: () => Promise<void>; // æˆ–æ‰§è¡Œç‰¹å®šæ“ä½œ
    37â†’}
    38â†’
    39â†’interface DynamicQuickActionsProps {
    40â†’  status: StatusData;
    41â†’  lifecoach: LifecoachData;
    42â†’  onCheckIn: () => Promise<void>;
    43â†’  onSendPrompt?: (prompt: string) => void;
    44â†’  className?: string;
    45â†’}
    46â†’
    47â†’export function DynamicQuickActions({
    48â†’  status,
    49â†’  lifecoach,
    50â†’  onCheckIn,
    51â†’  onSendPrompt,
    52â†’  className
    53â†’}: DynamicQuickActionsProps) {
    54â†’  const router = useRouter();
    55â†’
    56â†’  // æ ¹æ®ç”¨æˆ·çŠ¶æ€åŠ¨æ€ç”ŸæˆæŒ‰é’®
    57â†’  const actions = useMemo(() => {
    58â†’    const list: QuickAction[] = [];
    59â†’
    60â†’    // 0. æ–°ç”¨æˆ·å¼•å¯¼ï¼ˆæ²¡æœ‰å®Œæˆå‘½ç›˜æ—¶ä¼˜å…ˆæ˜¾ç¤ºï¼‰
    61â†’    if (status.hasBirthInfo === false) {
    62â†’      list.push({
    63â†’        id: "complete_profile",
    64â†’        icon: "âœ¨",
    65â†’        label: "ç»˜åˆ¶å‘½ç›˜",
    66â†’        prompt: "æˆ‘æƒ³äº†è§£è‡ªå·±çš„å‘½ç›˜"
    67â†’      });
    68â†’    }
    69â†’
    70â†’    // 1. ç­¾åˆ°ï¼ˆæœªç­¾åˆ°æ—¶æ˜¾ç¤ºï¼‰
    71â†’    if (!status.checkedIn && list.length === 0) {
    72â†’      list.push({
    73â†’        id: "checkin",
    74â†’        icon: "ğŸŒ…",
    75â†’        label: "å¼€å§‹ä»Šå¤©",
    76â†’        handler: async () => {
    77â†’          await onCheckIn();
    78â†’          toast.success(`ç­¾åˆ°æˆåŠŸï¼è¿ç»­ ${status.streak + 1} å¤© ğŸ”¥`);
    79â†’        }
    80â†’      });
    81â†’    }
    82â†’
    83â†’    // 2. ä»Šæ—¥è¡ŒåŠ¨ï¼ˆæœ‰æœªå®Œæˆæ æ†æ—¶ï¼‰
    84â†’    const uncompletedLevers = lifecoach.todayLevers.filter(l => !l.completed);
    85â†’    if (uncompletedLevers.length > 0) {
    86â†’      const firstLever = uncompletedLevers[0];
    87â†’      // æˆªå–å‰ 8 ä¸ªå­—ç¬¦
    88â†’      const shortText = firstLever.text.length > 8
    89â†’        ? firstLever.text.slice(0, 8) + "..."
    90â†’        : firstLever.text;
    91â†’
    92â†’      list.push({
    93â†’        id: "today_action",
    94â†’        icon: "ğŸ’ª",
    95â†’        label: shortText,
    96â†’        prompt: `å¸®æˆ‘å®Œæˆï¼š${firstLever.text}`
    97â†’      });
    98â†’    }
    99â†’
   100â†’    // 3. å‘¨å¤ç›˜ï¼ˆå‘¨äº”/å‘¨å…­/å‘¨æ—¥æ˜¾ç¤ºï¼‰
   101â†’    const today = new Date().getDay();
   102â†’    if ([5, 6, 0].includes(today)) {
   103â†’      list.push({
   104â†’        id: "weekly_review",
   105â†’        icon: "ğŸ“",
   106â†’        label: "å‘¨å¤ç›˜",
   107â†’        route: "/chat?skill=lifecoach&scenario=weekly-review&prompt=å‘¨å¤ç›˜"
   108â†’      });
   109â†’    }
   110â†’
   111â†’    // 4. è®¾å®šç›®æ ‡ï¼ˆæ²¡æœ‰åŒ—ææ˜Ÿæ—¶ï¼‰
   112â†’    if (!lifecoach.northStar) {
   113â†’      list.push({
   114â†’        id: "set_vision",
   115â†’        icon: "â­",
   116â†’        label: "æ‰¾åˆ°æ–¹å‘",
   117â†’        route: "/chat?skill=lifecoach&scenario=dankoe&prompt=æˆ‘æƒ³æ‰¾åˆ°äººç”Ÿæ–¹å‘"
   118â†’      });
   119â†’    }
   120â†’
   121â†’    // 5. é»˜è®¤ï¼šè‡ªç”±å¯¹è¯ï¼ˆä½œä¸ºå…œåº•ï¼‰
   122â†’    if (list.length < 3) {
   123â†’      list.push({
   124â†’        id: "chat",
   125â†’        icon: "ğŸ’¬",
   126â†’        label: "è‡ªç”±å¯¹è¯",
   127â†’        prompt: "å—¨"
   128â†’      });
   129â†’    }
   130â†’
   131â†’    // æœ€å¤šæ˜¾ç¤º 3 ä¸ªæŒ‰é’®
   132â†’    return list.slice(0, 3);
   133â†’  }, [status, lifecoach]);
   134â†’
   135â†’  const handleAction = useCallback(async (action: QuickAction) => {
   136â†’    if (action.handler) {
   137â†’      // æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œï¼ˆå¦‚ç­¾åˆ°ï¼‰
   138â†’      await action.handler();
   139â†’    } else if (action.route) {
   140â†’      // è·³è½¬åˆ°ç‰¹å®šé¡µé¢
   141â†’      router.push(action.route);
   142â†’    } else if (action.prompt && onSendPrompt) {
   143â†’      // å‘é€ prompt åˆ°å¯¹è¯
   144â†’      onSendPrompt(action.prompt);
   145â†’    }
   146â†’  }, [router, onSendPrompt]);
   147â†’
   148â†’  return (
   149â†’    <div className={cn("flex gap-2", className)}>
   150â†’      {actions.map((action) => (
   151â†’        <button
   152â†’          key={action.id}
   153â†’          onClick={() => handleAction(action)}
   154â†’          className="flex-1 px-3 py-2 rounded-xl bg-gradient-to-r from-emerald-500 to-green-600 text-white text-sm font-medium shadow-sm hover:shadow-md hover:scale-105 transition-all duration-200"
   155â†’        >
   156â†’          <span className="mr-1">{action.icon}</span>
   157â†’          <span>{action.label}</span>
   158â†’        </button>
   159â†’      ))}
   160â†’    </div>
   161â†’  );
   162â†’}
   163â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
