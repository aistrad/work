     1â†’/**
     2â†’ * ZodiacChartCard - æ˜Ÿç›˜å¡ç‰‡
     3â†’ *
     4â†’ * ä» show-zodiac-chart.tsx æå–çš„çº¯æ¸²æŸ“ç»„ä»¶
     5â†’ * é€šè¿‡ CardRegistry æ³¨å†Œï¼Œç”± card_type: "zodiac_chart" è§¦å‘
     6â†’ */
     7â†’
     8â†’"use client";
     9â†’
    10â†’import { useState } from "react";
    11â†’import { registerCard } from "@/skills/CardRegistry";
    12â†’
    13â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    14â†’// Types
    15â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    16â†’
    17â†’interface PlanetPosition {
    18â†’  planet: string;
    19â†’  sign: string;
    20â†’  degree: number;
    21â†’  house: number;
    22â†’  retrograde?: boolean;
    23â†’}
    24â†’
    25â†’interface Aspect {
    26â†’  planet1: string;
    27â†’  planet2: string;
    28â†’  type: string;
    29â†’  orb: number;
    30â†’}
    31â†’
    32â†’interface ZodiacChartData {
    33â†’  userId?: string;
    34â†’  birthInfo?: { date?: string; time?: string; place?: string };
    35â†’  birth_info?: { date?: string; time?: string; place?: string };
    36â†’  sunSign?: string;
    37â†’  sun_sign?: string;
    38â†’  moonSign?: string;
    39â†’  moon_sign?: string;
    40â†’  risingSign?: string;
    41â†’  rising_sign?: string;
    42â†’  planets?: PlanetPosition[];
    43â†’  aspects?: Aspect[];
    44â†’  dominantElement?: string;
    45â†’  dominant_element?: string;
    46â†’  dominantModality?: string;
    47â†’  dominant_modality?: string;
    48â†’}
    49â†’
    50â†’interface ZodiacChartCardProps {
    51â†’  data: ZodiacChartData;
    52â†’  cardProps?: Record<string, unknown>;
    53â†’}
    54â†’
    55â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    56â†’// Constants
    57â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    58â†’
    59â†’const PLANET_SYMBOLS: Record<string, string> = {
    60â†’  å¤ªé˜³: "â˜€ï¸", æœˆäº®: "ğŸŒ™", æ°´æ˜Ÿ: "â˜¿", é‡‘æ˜Ÿ: "â™€", ç«æ˜Ÿ: "â™‚",
    61â†’  æœ¨æ˜Ÿ: "â™ƒ", åœŸæ˜Ÿ: "â™„", å¤©ç‹æ˜Ÿ: "â™…", æµ·ç‹æ˜Ÿ: "â™†", å†¥ç‹æ˜Ÿ: "â™‡",
    62â†’  Sun: "â˜€ï¸", Moon: "ğŸŒ™", Mercury: "â˜¿", Venus: "â™€", Mars: "â™‚",
    63â†’  Jupiter: "â™ƒ", Saturn: "â™„", Uranus: "â™…", Neptune: "â™†", Pluto: "â™‡",
    64â†’};
    65â†’
    66â†’const SIGN_EMOJI: Record<string, string> = {
    67â†’  ç™½ç¾Šåº§: "â™ˆ", é‡‘ç‰›åº§: "â™‰", åŒå­åº§: "â™Š", å·¨èŸ¹åº§: "â™‹",
    68â†’  ç‹®å­åº§: "â™Œ", å¤„å¥³åº§: "â™", å¤©ç§¤åº§: "â™", å¤©èåº§: "â™",
    69â†’  å°„æ‰‹åº§: "â™", æ‘©ç¾¯åº§: "â™‘", æ°´ç“¶åº§: "â™’", åŒé±¼åº§: "â™“",
    70â†’};
    71â†’
    72â†’const ELEMENT_EMOJI: Record<string, string> = {
    73â†’  ç«: "ğŸ”¥", åœŸ: "ğŸŒ", é£: "ğŸ’¨", æ°´: "ğŸ’§",
    74â†’  Fire: "ğŸ”¥", Earth: "ğŸŒ", Air: "ğŸ’¨", Water: "ğŸ’§",
    75â†’};
    76â†’
    77â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    78â†’// Helpers
    79â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    80â†’
    81â†’function getSignElement(sign: string): string | null {
    82â†’  const fireSign = ["ç™½ç¾Šåº§", "ç‹®å­åº§", "å°„æ‰‹åº§", "Aries", "Leo", "Sagittarius"];
    83â†’  const earthSign = ["é‡‘ç‰›åº§", "å¤„å¥³åº§", "æ‘©ç¾¯åº§", "Taurus", "Virgo", "Capricorn"];
    84â†’  const airSign = ["åŒå­åº§", "å¤©ç§¤åº§", "æ°´ç“¶åº§", "Gemini", "Libra", "Aquarius"];
    85â†’  const waterSign = ["å·¨èŸ¹åº§", "å¤©èåº§", "åŒé±¼åº§", "Cancer", "Scorpio", "Pisces"];
    86â†’
    87â†’  if (fireSign.includes(sign)) return "ç«";
    88â†’  if (earthSign.includes(sign)) return "åœŸ";
    89â†’  if (airSign.includes(sign)) return "é£";
    90â†’  if (waterSign.includes(sign)) return "æ°´";
    91â†’  return null;
    92â†’}
    93â†’
    94â†’function getElementBarColor(element: string): string {
    95â†’  const colors: Record<string, string> = {
    96â†’    ç«: "#ef4444", åœŸ: "#eab308", é£: "#0ea5e9", æ°´: "#3b82f6",
    97â†’  };
    98â†’  return colors[element] || "#888";
    99â†’}
   100â†’
   101â†’function getElementStyle(element: string): string {
   102â†’  const styles: Record<string, string> = {
   103â†’    ç«: "bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300",
   104â†’    åœŸ: "bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300",
   105â†’    é£: "bg-sky-100 dark:bg-sky-900/30 text-sky-700 dark:text-sky-300",
   106â†’    æ°´: "bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300",
   107â†’  };
   108â†’  return styles[element] || "bg-muted";
   109â†’}
   110â†’
   111â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   112â†’// Component
   113â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   114â†’
   115â†’function ZodiacChartCard({ data }: ZodiacChartCardProps) {
   116â†’  const [expandedPlanet, setExpandedPlanet] = useState<string | null>(null);
   117â†’
   118â†’  // å…¼å®¹ snake_case å’Œ camelCase
   119â†’  const birthInfo = data.birthInfo || data.birth_info || {};
   120â†’  const sunSign = data.sunSign || data.sun_sign || "";
   121â†’  const moonSign = data.moonSign || data.moon_sign || "";
   122â†’  const risingSign = data.risingSign || data.rising_sign || "";
   123â†’  const planets = data.planets || [];
   124â†’  const aspects = data.aspects || [];
   125â†’  const dominantElement = data.dominantElement || data.dominant_element || "";
   126â†’  const dominantModality = data.dominantModality || data.dominant_modality || "";
   127â†’
   128â†’  // è®¡ç®—å…ƒç´ åˆ†å¸ƒ
   129â†’  const elementCounts = planets.reduce((acc, p) => {
   130â†’    const element = getSignElement(p.sign);
   131â†’    if (element) {
   132â†’      acc[element] = (acc[element] || 0) + 1;
   133â†’    }
   134â†’    return acc;
   135â†’  }, {} as Record<string, number>);
   136â†’
   137â†’  const totalPlanets = Object.values(elementCounts).reduce((sum, val) => sum + val, 0) || 1;
   138â†’
   139â†’  return (
   140â†’    <div className="zodiac-chart-card bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-indigo-950/30 dark:to-purple-950/30 rounded-xl border border-indigo-200 dark:border-indigo-800 p-4 my-2 overflow-hidden animate-fade-in">
   141â†’      {/* Header */}
   142â†’      <div className="flex items-center justify-between mb-4">
   143â†’        <h3 className="text-lg font-semibold text-indigo-900 dark:text-indigo-100 flex items-center gap-2">
   144â†’          <span>âœ¨</span>
   145â†’          <span>æœ¬å‘½æ˜Ÿç›˜</span>
   146â†’        </h3>
   147â†’        <span className="text-sm text-indigo-700 dark:text-indigo-300">
   148â†’          {birthInfo.date || ""}
   149â†’        </span>
   150â†’      </div>
   151â†’
   152â†’      {/* Big Three */}
   153â†’      <div className="grid grid-cols-3 gap-3 mb-4">
   154â†’        {[
   155â†’          { label: "å¤ªé˜³", sign: sunSign, icon: "â˜€ï¸" },
   156â†’          { label: "æœˆäº®", sign: moonSign, icon: "ğŸŒ™" },
   157â†’          { label: "ä¸Šå‡", sign: risingSign, icon: "â¬†ï¸" },
   158â†’        ].map((item) => (
   159â†’          <div
   160â†’            key={item.label}
   161â†’            className="text-center p-3 bg-white/60 dark:bg-black/30 rounded-lg cursor-pointer hover:bg-white/80 dark:hover:bg-black/40 transition-all"
   162â†’          >
   163â†’            <div className="text-xs text-muted-foreground mb-1">{item.icon} {item.label}</div>
   164â†’            <div className="text-2xl font-medium">{SIGN_EMOJI[item.sign] || "â˜…"}</div>
   165â†’            <div className="text-sm font-medium">{item.sign}</div>
   166â†’          </div>
   167â†’        ))}
   168â†’      </div>
   169â†’
   170â†’      {/* Planets */}
   171â†’      <div className="bg-white/40 dark:bg-black/20 rounded-lg p-3 mb-3">
   172â†’        <div className="text-sm font-medium mb-2">è¡Œæ˜Ÿåˆ†å¸ƒ</div>
   173â†’        <div className="space-y-1">
   174â†’          {planets.slice(0, 10).map((planet) => {
   175â†’            const isExpanded = expandedPlanet === planet.planet;
   176â†’            const planetAspects = aspects.filter(
   177â†’              a => a.planet1 === planet.planet || a.planet2 === planet.planet
   178â†’            );
   179â†’
   180â†’            return (
   181â†’              <div key={planet.planet}>
   182â†’                <div
   183â†’                  onClick={() => setExpandedPlanet(isExpanded ? null : planet.planet)}
   184â†’                  className={`flex items-center justify-between p-2 rounded-lg cursor-pointer transition-all ${
   185â†’                    isExpanded ? "bg-indigo-100 dark:bg-indigo-900/30" : "hover:bg-white/50 dark:hover:bg-black/30"
   186â†’                  }`}
   187â†’                >
   188â†’                  <div className="flex items-center gap-2">
   189â†’                    <span className="w-6 text-center">{PLANET_SYMBOLS[planet.planet] || "â˜…"}</span>
   190â†’                    <span className="text-sm font-medium">{planet.planet}</span>
   191â†’                  </div>
   192â†’                  <div className="flex items-center gap-2 text-sm">
   193â†’                    <span>{planet.sign}</span>
   194â†’                    <span className="text-muted-foreground">{planet.house}å®«</span>
   195â†’                    {planet.retrograde && <span className="text-orange-500 text-xs">â„</span>}
   196â†’                  </div>
   197â†’                </div>
   198â†’
   199â†’                {/* Expanded planet details */}
   200â†’                {isExpanded && planetAspects.length > 0 && (
   201â†’                  <div className="pl-8 pr-2 py-2 text-xs text-muted-foreground animate-fade-in">
   202â†’                    <div className="font-medium mb-1">ç›¸ä½å…³ç³»ï¼š</div>
   203â†’                    {planetAspects.slice(0, 3).map((aspect, i) => (
   204â†’                      <div key={i} className="flex items-center gap-1">
   205â†’                        <span>{aspect.type}</span>
   206â†’                        <span>{aspect.planet1 === planet.planet ? aspect.planet2 : aspect.planet1}</span>
   207â†’                        <span className="text-muted-foreground/50">({aspect.orb.toFixed(1)}Â°)</span>
   208â†’                      </div>
   209â†’                    ))}
   210â†’                  </div>
   211â†’                )}
   212â†’              </div>
   213â†’            );
   214â†’          })}
   215â†’        </div>
   216â†’      </div>
   217â†’
   218â†’      {/* Element Distribution */}
   219â†’      <div className="mb-3">
   220â†’        <div className="text-sm font-medium mb-2">å…ƒç´ åˆ†å¸ƒ</div>
   221â†’        <div className="grid grid-cols-4 gap-2">
   222â†’          {(["ç«", "åœŸ", "é£", "æ°´"] as const).map((element) => {
   223â†’            const count = elementCounts[element] || 0;
   224â†’            const percentage = Math.round((count / totalPlanets) * 100);
   225â†’            return (
   226â†’              <div key={element} className="text-center">
   227â†’                <div className="text-lg mb-1">{ELEMENT_EMOJI[element]}</div>
   228â†’                <div className="h-2 bg-white/50 dark:bg-black/20 rounded-full overflow-hidden">
   229â†’                  <div
   230â†’                    className="h-full rounded-full transition-all duration-500"
   231â†’                    style={{ width: `${percentage}%`, backgroundColor: getElementBarColor(element) }}
   232â†’                  />
   233â†’                </div>
   234â†’                <div className="text-xs text-muted-foreground mt-1">{percentage}%</div>
   235â†’              </div>
   236â†’            );
   237â†’          })}
   238â†’        </div>
   239â†’      </div>
   240â†’
   241â†’      {/* Dominant Element */}
   242â†’      <div className="flex items-center justify-between text-sm">
   243â†’        <div className="flex items-center gap-2">
   244â†’          <span className="text-muted-foreground">ä¸»å¯¼å…ƒç´ :</span>
   245â†’          <span className={`px-2 py-0.5 rounded ${getElementStyle(dominantElement)}`}>
   246â†’            {ELEMENT_EMOJI[dominantElement] || ""} {dominantElement}
   247â†’          </span>
   248â†’        </div>
   249â†’        {dominantModality && (
   250â†’          <div className="flex items-center gap-2">
   251â†’            <span className="text-muted-foreground">ä¸»å¯¼æ¨¡å¼:</span>
   252â†’            <span className="px-2 py-0.5 bg-indigo-100 dark:bg-indigo-900/30 rounded text-indigo-700 dark:text-indigo-300">
   253â†’              {dominantModality}
   254â†’            </span>
   255â†’          </div>
   256â†’        )}
   257â†’      </div>
   258â†’
   259â†’      {/* Hint */}
   260â†’      <div className="mt-3 text-xs text-center text-muted-foreground">
   261â†’        ğŸ’¡ ç‚¹å‡»è¡Œæ˜ŸæŸ¥çœ‹ç›¸ä½å…³ç³»
   262â†’      </div>
   263â†’    </div>
   264â†’  );
   265â†’}
   266â†’
   267â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   268â†’// Register to CardRegistry
   269â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   270â†’
   271â†’registerCard("zodiac_chart", ZodiacChartCard);
   272â†’
   273â†’export default ZodiacChartCard;
   274â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
