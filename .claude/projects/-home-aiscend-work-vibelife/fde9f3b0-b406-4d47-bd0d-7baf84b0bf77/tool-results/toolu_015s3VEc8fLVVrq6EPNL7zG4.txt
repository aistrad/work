     1â†’/**
     2â†’ * Shared Tools - Available to all skills
     3â†’ *
     4â†’ * These tools provide common functionality across all skill types
     5â†’ * Enhanced with animations and unified styling
     6â†’ */
     7â†’
     8â†’import { z } from "zod";
     9â†’import { useState, useCallback } from "react";
    10â†’import { motion, AnimatePresence } from "framer-motion";
    11â†’import type { ToolDefinition } from "./types";
    12â†’
    13â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    14â†’// Info Request Form Component
    15â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    16â†’
    17â†’interface InfoRequestFormProps {
    18â†’  infoType: string;
    19â†’  question?: string;
    20â†’  fields: Array<{ id: string; label: string; type: string; placeholder?: string }>;
    21â†’}
    22â†’
    23â†’function InfoRequestForm({ infoType, question, fields }: InfoRequestFormProps) {
    24â†’  const [formData, setFormData] = useState<Record<string, string>>({});
    25â†’  const [isSubmitting, setIsSubmitting] = useState(false);
    26â†’
    27â†’  const handleChange = useCallback((fieldId: string, value: string) => {
    28â†’    setFormData(prev => ({ ...prev, [fieldId]: value }));
    29â†’  }, []);
    30â†’
    31â†’  const handleSubmit = useCallback(async () => {
    32â†’    // Validate required fields
    33â†’    const hasAllFields = fields.every(f => formData[f.id]?.trim());
    34â†’    if (!hasAllFields) {
    35â†’      return;
    36â†’    }
    37â†’
    38â†’    setIsSubmitting(true);
    39â†’
    40â†’    // Build message based on info type
    41â†’    let message = "";
    42â†’    if (infoType === "birth") {
    43â†’      const date = formData.birthDate || "";
    44â†’      const time = formData.birthTime || "";
    45â†’      const place = formData.birthPlace || "";
    46â†’      message = `æˆ‘çš„å‡ºç”Ÿä¿¡æ¯ï¼š${date} ${time}ï¼Œå‡ºç”Ÿåœ°ï¼š${place}`;
    47â†’    } else if (infoType === "context") {
    48â†’      message = `æˆ‘çš„æƒ…å†µï¼š${formData.situation || ""}`;
    49â†’    } else if (infoType === "goals") {
    50â†’      message = `æˆ‘çš„ç›®æ ‡ï¼š${formData.goals || ""}`;
    51â†’    } else if (infoType === "concerns") {
    52â†’      message = `æˆ‘çš„å›°æƒ‘ï¼š${formData.concerns || ""}`;
    53â†’    } else {
    54â†’      message = Object.values(formData).join("ï¼Œ");
    55â†’    }
    56â†’
    57â†’    // Find chat input and submit
    58â†’    const chatInput = document.querySelector('textarea[name="message"], textarea[placeholder*="åˆ†äº«"], textarea[placeholder*="è¾“å…¥"]') as HTMLTextAreaElement;
    59â†’    const form = chatInput?.closest('form');
    60â†’
    61â†’    if (chatInput && form) {
    62â†’      // Set value using native setter to trigger React state update
    63â†’      const nativeInputValueSetter = Object.getOwnPropertyDescriptor(
    64â†’        window.HTMLTextAreaElement.prototype,
    65â†’        'value'
    66â†’      )?.set;
    67â†’      nativeInputValueSetter?.call(chatInput, message);
    68â†’
    69â†’      // Dispatch input event to trigger React onChange
    70â†’      chatInput.dispatchEvent(new Event('input', { bubbles: true }));
    71â†’
    72â†’      // Submit form after a short delay
    73â†’      setTimeout(() => {
    74â†’        const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
    75â†’        submitBtn?.click();
    76â†’        setIsSubmitting(false);
    77â†’      }, 100);
    78â†’    } else {
    79â†’      setIsSubmitting(false);
    80â†’    }
    81â†’  }, [formData, fields, infoType]);
    82â†’
    83â†’  return (
    84â†’    <div className="info-request-card bg-blue-50 dark:bg-blue-950/30 rounded-xl border border-blue-200 dark:border-blue-800 p-4 my-2">
    85â†’      <div className="flex items-start gap-3">
    86â†’        <span className="text-2xl">ğŸ“</span>
    87â†’        <div className="flex-1">
    88â†’          <div className="font-medium mb-2">
    89â†’            {question || getDefaultQuestion(infoType)}
    90â†’          </div>
    91â†’          <div className="space-y-2">
    92â†’            {fields.map((field) => (
    93â†’              <div key={field.id}>
    94â†’                <label className="text-sm text-muted-foreground block mb-1">
    95â†’                  {field.label}
    96â†’                </label>
    97â†’                <input
    98â†’                  type={field.type}
    99â†’                  placeholder={field.placeholder}
   100â†’                  value={formData[field.id] || ""}
   101â†’                  onChange={(e) => handleChange(field.id, e.target.value)}
   102â†’                  className="w-full px-3 py-2 rounded-lg border bg-background text-sm"
   103â†’                />
   104â†’              </div>
   105â†’            ))}
   106â†’          </div>
   107â†’          <button
   108â†’            onClick={handleSubmit}
   109â†’            disabled={isSubmitting}
   110â†’            className="mt-3 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white rounded-lg text-sm transition-colors"
   111â†’          >
   112â†’            {isSubmitting ? "æäº¤ä¸­..." : "æäº¤"}
   113â†’          </button>
   114â†’        </div>
   115â†’      </div>
   116â†’    </div>
   117â†’  );
   118â†’}
   119â†’
   120â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   121â†’// Show Report Tool
   122â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   123â†’
   124â†’const ShowReportParams = z.object({
   125â†’  reportId: z.string().optional().describe("Report ID to display"),
   126â†’  reportType: z.enum(["lite", "full"]).optional().default("lite").describe("Report type"),
   127â†’});
   128â†’
   129â†’export const showReportTool: ToolDefinition = {
   130â†’  name: "show_report",
   131â†’  description: "å±•ç¤ºç”¨æˆ·çš„å®Œæ•´æŠ¥å‘Šã€‚å½“ç”¨æˆ·æƒ³æŸ¥çœ‹æŠ¥å‘Šæˆ–éœ€è¦ç”Ÿæˆæ–°æŠ¥å‘Šæ—¶è°ƒç”¨ã€‚",
   132â†’  parameters: ShowReportParams,
   133â†’
   134â†’  async execute(params, context) {
   135â†’    const response = await fetch(`/api/v1/report/${params.reportId || "latest"}`, {
   136â†’      method: "GET",
   137â†’      headers: { "Content-Type": "application/json" },
   138â†’    });
   139â†’
   140â†’    if (!response.ok) {
   141â†’      throw new Error("è·å–æŠ¥å‘Šå¤±è´¥");
   142â†’    }
   143â†’
   144â†’    return response.json();
   145â†’  },
   146â†’
   147â†’  render(result: any) {
   148â†’    const createdAt = result.createdAt || result.created_at;
   149â†’    return (
   150â†’      <div className="report-card bg-card rounded-xl border p-4 my-2">
   151â†’        <div className="flex items-center justify-between mb-3">
   152â†’          <h3 className="font-semibold">{result.title || "ä¸ªäººæŠ¥å‘Š"}</h3>
   153â†’          <span className="text-xs text-muted-foreground">{createdAt}</span>
   154â†’        </div>
   155â†’        {result.prologue && (
   156â†’          <div className="prose prose-sm mb-4">
   157â†’            <p className="text-muted-foreground italic">{result.prologue}</p>
   158â†’          </div>
   159â†’        )}
   160â†’        <button className="w-full px-4 py-2 bg-primary text-primary-foreground rounded-lg text-sm">
   161â†’          æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š
   162â†’        </button>
   163â†’      </div>
   164â†’    );
   165â†’  },
   166â†’
   167â†’  toModelOutput(result: any) {
   168â†’    return `å·²å±•ç¤ºæŠ¥å‘Š: ${result.title}ã€‚åˆ›å»ºæ—¶é—´: ${result.createdAt}ã€‚`;
   169â†’  },
   170â†’};
   171â†’
   172â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   173â†’// Show Relationship Tool
   174â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   175â†’
   176â†’const ShowRelationshipParams = z.object({
   177â†’  relationshipId: z.string().optional().describe("Relationship analysis ID"),
   178â†’  partnerInfo: z.object({
   179â†’    name: z.string().optional(),
   180â†’    birthDate: z.string(),
   181â†’  }).optional().describe("Partner information for new analysis"),
   182â†’});
   183â†’
   184â†’export const showRelationshipTool: ToolDefinition = {
   185â†’  name: "show_relationship",
   186â†’  description: "å±•ç¤ºå…³ç³»åˆ†æç»“æœã€‚å½“ç”¨æˆ·æƒ³åˆ†æä¸ä»–äººçš„å…³ç³»å…¼å®¹æ€§æ—¶è°ƒç”¨ã€‚",
   187â†’  parameters: ShowRelationshipParams,
   188â†’
   189â†’  async execute(params, context) {
   190â†’    if (params.relationshipId) {
   191â†’      const response = await fetch(`/api/v1/relationship/${params.relationshipId}`);
   192â†’      return response.json();
   193â†’    }
   194â†’
   195â†’    // Create new analysis
   196â†’    const response = await fetch("/api/v1/relationship/analyze", {
   197â†’      method: "POST",
   198â†’      headers: { "Content-Type": "application/json" },
   199â†’      body: JSON.stringify({
   200â†’        partnerInfo: params.partnerInfo,
   201â†’        skill: context.skillId,
   202â†’      }),
   203â†’    });
   204â†’
   205â†’    return response.json();
   206â†’  },
   207â†’
   208â†’  render(result: any) {
   209â†’    return (
   210â†’      <div className="relationship-card bg-gradient-to-br from-rose-50 to-pink-50 dark:from-rose-950/30 dark:to-pink-950/30 rounded-xl border border-rose-200 dark:border-rose-800 p-4 my-2">
   211â†’        <h3 className="font-semibold text-rose-900 dark:text-rose-100 mb-3">
   212â†’          å…³ç³»åˆ†æ
   213â†’        </h3>
   214â†’        <div className="text-center py-4">
   215â†’          <div className="text-4xl font-bold text-rose-600 dark:text-rose-400">
   216â†’            {result.score || 85}%
   217â†’          </div>
   218â†’          <div className="text-sm text-muted-foreground mt-1">åŒ¹é…åº¦</div>
   219â†’        </div>
   220â†’        {result.summary && (
   221â†’          <p className="text-sm text-muted-foreground">{result.summary}</p>
   222â†’        )}
   223â†’      </div>
   224â†’    );
   225â†’  },
   226â†’
   227â†’  toModelOutput(result: any) {
   228â†’    return `å·²å±•ç¤ºå…³ç³»åˆ†æã€‚åŒ¹é…åº¦: ${result.score}%ã€‚${result.summary}`;
   229â†’  },
   230â†’};
   231â†’
   232â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   233â†’// Show Insight Tool
   234â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   235â†’
   236â†’const ShowInsightParams = z.object({
   237â†’  insightId: z.string().optional().describe("Specific insight ID"),
   238â†’  category: z.string().optional().describe("Insight category"),
   239â†’});
   240â†’
   241â†’export const showInsightTool: ToolDefinition = {
   242â†’  name: "show_insight",
   243â†’  description: "å±•ç¤ºæ´å¯Ÿå¡ç‰‡ã€‚å½“ç”¨æˆ·éœ€è¦çœ‹åˆ°å…³é”®æ´å¯Ÿæˆ–å»ºè®®æ—¶è°ƒç”¨ã€‚",
   244â†’  parameters: ShowInsightParams,
   245â†’
   246â†’  async execute(params, context) {
   247â†’    const response = await fetch(`/api/v1/users/insights?category=${params.category || ""}`);
   248â†’    return response.json();
   249â†’  },
   250â†’
   251â†’  render(result: any) {
   252â†’    return <InsightCardList result={result} />;
   253â†’  },
   254â†’
   255â†’  toModelOutput(result: any) {
   256â†’    const count = result.insights?.length || 1;
   257â†’    return `å·²å±•ç¤º ${count} æ¡æ´å¯Ÿã€‚`;
   258â†’  },
   259â†’};
   260â†’
   261â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   262â†’// Request Info Tool (AI Interview)
   263â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   264â†’
   265â†’const RequestInfoParams = z.object({
   266â†’  infoType: z.enum(["birth", "context", "goals", "concerns"]).describe("Type of information to request"),
   267â†’  question: z.string().optional().describe("Custom question to ask"),
   268â†’});
   269â†’
   270â†’export const requestInfoTool: ToolDefinition = {
   271â†’  name: "request_info",
   272â†’  description: "å‘ç”¨æˆ·è¯·æ±‚æ›´å¤šä¿¡æ¯ä»¥æä¾›æ›´å‡†ç¡®çš„åˆ†æã€‚å½“éœ€è¦ç”¨æˆ·è¡¥å……å‡ºç”Ÿä¿¡æ¯ã€å½“å‰å›°å¢ƒæˆ–ç›®æ ‡æ—¶è°ƒç”¨ã€‚",
   273â†’  parameters: RequestInfoParams,
   274â†’
   275â†’  async execute(params) {
   276â†’    // This tool is special - it doesn't fetch data, it prompts the user
   277â†’    return {
   278â†’      infoType: params.infoType,
   279â†’      question: params.question,
   280â†’      fields: getFieldsForInfoType(params.infoType),
   281â†’    };
   282â†’  },
   283â†’
   284â†’  render(result: any) {
   285â†’    return (
   286â†’      <InfoRequestForm
   287â†’        infoType={result.infoType}
   288â†’        question={result.question}
   289â†’        fields={result.fields}
   290â†’      />
   291â†’    );
   292â†’  },
   293â†’
   294â†’  toModelOutput(result: any) {
   295â†’    return `æ­£åœ¨è¯·æ±‚ç”¨æˆ·æä¾›æ›´å¤šä¿¡æ¯: ${result.infoType}`;
   296â†’  },
   297â†’};
   298â†’
   299â†’// Helper functions
   300â†’function getFieldsForInfoType(infoType: string) {
   301â†’  switch (infoType) {
   302â†’    case "birth":
   303â†’      return [
   304â†’        { id: "birthDate", label: "å‡ºç”Ÿæ—¥æœŸ", type: "date", placeholder: "" },
   305â†’        { id: "birthTime", label: "å‡ºç”Ÿæ—¶é—´", type: "time", placeholder: "" },
   306â†’        { id: "birthPlace", label: "å‡ºç”Ÿåœ°ç‚¹", type: "text", placeholder: "åŸå¸‚å" },
   307â†’      ];
   308â†’    case "context":
   309â†’      return [
   310â†’        { id: "situation", label: "å½“å‰æƒ…å†µ", type: "text", placeholder: "æè¿°ä½ ç›®å‰é¢ä¸´çš„æƒ…å†µ" },
   311â†’      ];
   312â†’    case "goals":
   313â†’      return [
   314â†’        { id: "goals", label: "ä½ çš„ç›®æ ‡", type: "text", placeholder: "ä½ æƒ³è¾¾æˆä»€ä¹ˆ" },
   315â†’      ];
   316â†’    case "concerns":
   317â†’      return [
   318â†’        { id: "concerns", label: "ä½ çš„å›°æƒ‘", type: "text", placeholder: "æœ€å›°æ‰°ä½ çš„æ˜¯ä»€ä¹ˆ" },
   319â†’      ];
   320â†’    default:
   321â†’      return [];
   322â†’  }
   323â†’}
   324â†’
   325â†’function getDefaultQuestion(infoType: string) {
   326â†’  switch (infoType) {
   327â†’    case "birth":
   328â†’      return "ä¸ºäº†ç»™ä½ æ›´å‡†ç¡®çš„åˆ†æï¼Œè¯·æä¾›ä½ çš„å‡ºç”Ÿä¿¡æ¯";
   329â†’    case "context":
   330â†’      return "èƒ½å‘Šè¯‰æˆ‘ä½ ç›®å‰çš„æƒ…å†µå—ï¼Ÿ";
   331â†’    case "goals":
   332â†’      return "ä½ å¸Œæœ›è¾¾æˆä»€ä¹ˆç›®æ ‡ï¼Ÿ";
   333â†’    case "concerns":
   334â†’      return "ä»€ä¹ˆæ˜¯ä½ æœ€å…³å¿ƒçš„é—®é¢˜ï¼Ÿ";
   335â†’    default:
   336â†’      return "è¯·æä¾›æ›´å¤šä¿¡æ¯";
   337â†’  }
   338â†’}
   339â†’
   340â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   341â†’// Export all shared tools
   342â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   343â†’
   344â†’export const sharedTools: ToolDefinition[] = [
   345â†’  showReportTool,
   346â†’  showRelationshipTool,
   347â†’  showInsightTool,
   348â†’  requestInfoTool,
   349â†’];
   350â†’
   351â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   352â†’// Enhanced Insight Card Component
   353â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   354â†’
   355â†’interface InsightCardListProps {
   356â†’  result: any;
   357â†’}
   358â†’
   359â†’function InsightCardList({ result }: InsightCardListProps) {
   360â†’  const insights = result.insights || [result];
   361â†’
   362â†’  return (
   363â†’    <motion.div
   364â†’      initial={{ opacity: 0 }}
   365â†’      animate={{ opacity: 1 }}
   366â†’      className="insights-container space-y-3 my-2"
   367â†’    >
   368â†’      {insights.slice(0, 3).map((insight: any, index: number) => (
   369â†’        <InsightCard key={index} insight={insight} index={index} />
   370â†’      ))}
   371â†’    </motion.div>
   372â†’  );
   373â†’}
   374â†’
   375â†’interface InsightCardProps {
   376â†’  insight: {
   377â†’    title?: string;
   378â†’    content?: string;
   379â†’    source?: string;
   380â†’    category?: string;
   381â†’    confidence?: number;
   382â†’  };
   383â†’  index: number;
   384â†’}
   385â†’
   386â†’function InsightCard({ insight, index }: InsightCardProps) {
   387â†’  const [isExpanded, setIsExpanded] = useState(false);
   388â†’
   389â†’  // æ ¹æ® category é€‰æ‹©ä¸åŒçš„æ ·å¼
   390â†’  const getCategoryStyle = (category?: string) => {
   391â†’    switch (category) {
   392â†’      case 'personality':
   393â†’        return {
   394â†’          bg: 'from-purple-50 to-indigo-50 dark:from-purple-950/30 dark:to-indigo-950/30',
   395â†’          border: 'border-purple-200 dark:border-purple-800',
   396â†’          icon: 'ğŸ”®',
   397â†’          iconColor: 'text-purple-600',
   398â†’        };
   399â†’      case 'career':
   400â†’        return {
   401â†’          bg: 'from-cyan-50 to-teal-50 dark:from-cyan-950/30 dark:to-teal-950/30',
   402â†’          border: 'border-cyan-200 dark:border-cyan-800',
   403â†’          icon: 'ğŸ’¼',
   404â†’          iconColor: 'text-cyan-600',
   405â†’        };
   406â†’      case 'relationship':
   407â†’        return {
   408â†’          bg: 'from-rose-50 to-pink-50 dark:from-rose-950/30 dark:to-pink-950/30',
   409â†’          border: 'border-rose-200 dark:border-rose-800',
   410â†’          icon: 'ğŸ’•',
   411â†’          iconColor: 'text-rose-600',
   412â†’        };
   413â†’      case 'fortune':
   414â†’        return {
   415â†’          bg: 'from-amber-50 to-yellow-50 dark:from-amber-950/30 dark:to-yellow-950/30',
   416â†’          border: 'border-amber-200 dark:border-amber-800',
   417â†’          icon: 'âœ¨',
   418â†’          iconColor: 'text-accent-600',
   419â†’        };
   420â†’      default:
   421â†’        return {
   422â†’          bg: 'from-amber-50 to-yellow-50 dark:from-amber-950/30 dark:to-yellow-950/30',
   423â†’          border: 'border-amber-200 dark:border-amber-800',
   424â†’          icon: 'ğŸ’¡',
   425â†’          iconColor: 'text-accent-600',
   426â†’        };
   427â†’    }
   428â†’  };
   429â†’
   430â†’  const style = getCategoryStyle(insight.category);
   431â†’
   432â†’  return (
   433â†’    <motion.div
   434â†’      initial={{ opacity: 0, y: 20 }}
   435â†’      animate={{ opacity: 1, y: 0 }}
   436â†’      transition={{ delay: index * 0.15, duration: 0.4 }}
   437â†’      onClick={() => setIsExpanded(!isExpanded)}
   438â†’      className={`insight-card bg-gradient-to-r ${style.bg} rounded-xl border ${style.border} p-4 cursor-pointer transition-all duration-200 hover:shadow-md`}
   439â†’    >
   440â†’      <div className="flex items-start gap-3">
   441â†’        <motion.span
   442â†’          className={`text-2xl ${style.iconColor}`}
   443â†’          animate={{ scale: isExpanded ? 1.1 : 1 }}
   444â†’          transition={{ duration: 0.2 }}
   445â†’        >
   446â†’          {style.icon}
   447â†’        </motion.span>
   448â†’        <div className="flex-1 min-w-0">
   449â†’          {/* Title */}
   450â†’          <motion.div
   451â†’            className="font-medium text-sm mb-1"
   452â†’            initial={{ opacity: 0 }}
   453â†’            animate={{ opacity: 1 }}
   454â†’            transition={{ delay: index * 0.15 + 0.1 }}
   455â†’          >
   456â†’            {insight.title || 'æ ¸å¿ƒæ´å¯Ÿ'}
   457â†’          </motion.div>
   458â†’
   459â†’          {/* Content */}
   460â†’          <motion.div
   461â†’            initial={{ opacity: 0 }}
   462â†’            animate={{ opacity: 1 }}
   463â†’            transition={{ delay: index * 0.15 + 0.2 }}
   464â†’          >
   465â†’            <p className={`text-sm text-muted-foreground ${isExpanded ? '' : 'line-clamp-2'}`}>
   466â†’              {insight.content}
   467â†’            </p>
   468â†’          </motion.div>
   469â†’
   470â†’          {/* Expanded content */}
   471â†’          <AnimatePresence>
   472â†’            {isExpanded && (
   473â†’              <motion.div
   474â†’                initial={{ height: 0, opacity: 0 }}
   475â†’                animate={{ height: 'auto', opacity: 1 }}
   476â†’                exit={{ height: 0, opacity: 0 }}
   477â†’                transition={{ duration: 0.2 }}
   478â†’                className="overflow-hidden"
   479â†’              >
   480â†’                {/* Source */}
   481â†’                {insight.source && (
   482â†’                  <div className="mt-3 pt-3 border-t border-current/10">
   483â†’                    <div className="flex items-center gap-1 text-xs text-muted-foreground">
   484â†’                      <span>ğŸ“Š</span>
   485â†’                      <span>æ¥è‡ªï¼š{insight.source}</span>
   486â†’                    </div>
   487â†’                  </div>
   488â†’                )}
   489â†’
   490â†’                {/* Confidence */}
   491â†’                {insight.confidence && (
   492â†’                  <div className="mt-2">
   493â†’                    <div className="flex items-center justify-between text-xs text-muted-foreground mb-1">
   494â†’                      <span>ç½®ä¿¡åº¦</span>
   495â†’                      <span>{Math.round(insight.confidence * 100)}%</span>
   496â†’                    </div>
   497â†’                    <div className="h-1.5 bg-white/50 dark:bg-black/20 rounded-full overflow-hidden">
   498â†’                      <motion.div
   499â†’                        initial={{ width: 0 }}
   500â†’                        animate={{ width: `${insight.confidence * 100}%` }}
   501â†’                        transition={{ delay: 0.3, duration: 0.5 }}
   502â†’                        className="h-full bg-current/30 rounded-full"
   503â†’                      />
   504â†’                    </div>
   505â†’                  </div>
   506â†’                )}
   507â†’              </motion.div>
   508â†’            )}
   509â†’          </AnimatePresence>
   510â†’        </div>
   511â†’      </div>
   512â†’
   513â†’      {/* Expand hint */}
   514â†’      <motion.div
   515â†’        initial={{ opacity: 0 }}
   516â†’        animate={{ opacity: 1 }}
   517â†’        transition={{ delay: index * 0.15 + 0.3 }}
   518â†’        className="mt-2 text-xs text-center text-muted-foreground/50"
   519â†’      >
   520â†’        {isExpanded ? 'ç‚¹å‡»æ”¶èµ·' : 'ç‚¹å‡»å±•å¼€'}
   521â†’      </motion.div>
   522â†’    </motion.div>
   523â†’  );
   524â†’}
   525â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
