     1→# VibeLife 前端 v7.1 设计规格
     2→
     3→> **版本**: 7.1 | 2026-01-17
     4→> **目标读者**: AI Agent 优化
     5→> **后端架构**: V7 API
     6→> **设计系统**: 「暖阳神秘」+ Linear 精致风格
     7→> **视觉标杆**: Linear (精致度) + 东方美学 (温暖感)
     8→> **优先级来源**: VibeID设计-v5.md > SPEC-v7.md > Frontend-v6.md
     9→
    10→---
    11→
    12→## 设计理念升级 (v7.1 新增)
    13→
    14→### 核心定位
    15→> **"Linear 的精致度 + 温暖的东方美学 = 高级但不冷漠"**
    16→
    17→### 与 Linear 的对比与融合
    18→
    19→| 维度 | Linear 特点 | VibeLife 融合方案 |
    20→|------|------------|------------------|
    21→| **色调** | 冷峻科技感、深色主题 | 保持暖色调，降低饱和度增加高级感 |
    22→| **阴影** | 极淡多层、带色彩倾向 | 采用多层阴影，融入暖棕色调 |
    23→| **边框** | 几乎无边框，用阴影分隔 | 减少边框使用，改用微妙阴影 |
    24→| **动效** | 微妙 spring、blur 过渡 | 采用 spring physics，保持温和节奏 |
    25→| **字体** | 精心调校的字重/间距 | 优化中英文混排，精调间距 |
    26→| **hover** | 微妙背景变化 + 光标反馈 | 添加 translateY 微动 + 阴影变化 |
    27→
    28→### 设计原则 (v7.1 更新)
    29→
    30→1. **精致克制**: 每个像素都有意义，避免装饰性元素
    31→2. **微妙层次**: 用阴影和透明度创造深度，而非边框
    32→3. **温暖亲切**: 在精致中保持人情味，不冷漠
    33→4. **流畅自然**: 动效服务于体验，不抢夺注意力
    34→5. **渐进揭示**: 信息逐步展现，尊重用户的探索旅程
    35→
    36→---
    37→
    38→## 目录
    39→
    40→1. [系统架构](#1-系统架构)
    41→2. [VibeID 核心模块](#2-vibeid-核心模块)
    42→3. [设计系统](#3-设计系统)
    43→4. [性能优化](#4-性能优化)
    44→5. [组件库与卡片系统](#5-组件库与卡片系统)
    45→6. [API 对接与数据流](#6-api-对接与数据流)
    46→7. [实施计划与验证](#7-实施计划与验证)
    47→
    48→---
    49→
    50→## 1. 系统架构
    51→
    52→### 1.1 架构总览
    53→
    54→```
    55→┌─────────────────────────────────────────────────────────────────────────────┐
    56→│                           VibeLife Frontend v7.0                             │
    57→├─────────────────────────────────────────────────────────────────────────────┤
    58→│  ┌─────────────────────────────────────────────────────────────────────┐   │
    59→│  │                         App Shell (Next.js 14)                       │   │
    60→│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌────────────┐  │   │
    61→│  │  │   Layout    │  │   Router    │  │   Auth      │  │   Theme    │  │   │
    62→│  │  │  Provider   │  │  (App Dir)  │  │  Provider   │  │  Provider  │  │   │
    63→│  │  └─────────────┘  └─────────────┘  └─────────────┘  └────────────┘  │   │
    64→│  └─────────────────────────────────────────────────────────────────────┘   │
    65→│                                      │                                       │
    66→│  ┌─────────────────────────────────────────────────────────────────────┐   │
    67→│  │                        Feature Modules                               │   │
    68→│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌────────────┐  │   │
    69→│  │  │   VibeID    │  │    Chat     │  │   Skills    │  │  Commerce  │  │   │
    70→│  │  │   Module    │  │   Module    │  │   Module    │  │   Module   │  │   │
    71→│  │  │ (Archetype) │  │ (Agentic)   │  │ (Bazi/Zodiac│  │ (Payment)  │  │   │
    72→│  │  └─────────────┘  └─────────────┘  └─────────────┘  └────────────┘  │   │
    73→│  └─────────────────────────────────────────────────────────────────────┘   │
    74→│                                      │                                       │
    75→│  ┌─────────────────────────────────────────────────────────────────────┐   │
    76→│  │                        Core Services Layer                           │   │
    77→│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌────────────┐  │   │
    78→│  │  │    API      │  │   State     │  │   Stream    │  │   Card     │  │   │
    79→│  │  │   Client    │  │   Store     │  │   Handler   │  │  Registry  │  │   │
    80→│  │  │  (SWR 2.x)  │  │(Zustand 4.x)│  │ (AI SDK 6)  │  │ (Dynamic)  │  │   │
    81→│  │  └─────────────┘  └─────────────┘  └─────────────┘  └────────────┘  │   │
    82→│  └─────────────────────────────────────────────────────────────────────┘   │
    83→│                                      │                                       │
    84→│  ┌─────────────────────────────────────────────────────────────────────┐   │
    85→│  │                        Design System Layer                           │   │
    86→│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌────────────┐  │   │
    87→│  │  │  UI Core    │  │  Archetype  │  │  Animation  │  │   Theme    │  │   │
    88→│  │  │ Components  │  │   Visuals   │  │   System    │  │   Tokens   │  │   │
    89→│  │  └─────────────┘  └─────────────┘  └─────────────┘  └────────────┘  │   │
    90→│  └─────────────────────────────────────────────────────────────────────┘   │
    91→└─────────────────────────────────────────────────────────────────────────────┘
    92→                                       │
    93→                                       ▼
    94→┌─────────────────────────────────────────────────────────────────────────────┐
    95→│                           Backend API (V7)                                   │
    96→├─────────────────────────────────────────────────────────────────────────────┤
    97→│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐│
    98→│  │  CoreAgent  │  │   Skill     │  │    Tool     │  │      Knowledge      ││
    99→│  │  (Agentic   │  │  Service    │  │  Registry   │  │       Store         ││
   100→│  │   Loop)     │  │  Registry   │  │  (Schema)   │  │     (Qdrant)        ││
   101→│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────────────┘│
   102→└─────────────────────────────────────────────────────────────────────────────┘
   103→```
   104→
   105→### 1.2 技术栈
   106→
   107→| 类别 | 技术 | 版本 | 用途 |
   108→|------|------|------|------|
   109→| 框架 | Next.js | 14.x | App Router、RSC、流式渲染 |
   110→| 语言 | TypeScript | 5.3+ | 类型安全 |
   111→| 样式 | Tailwind CSS | 3.4 | 原子化 CSS |
   112→| 状态管理 | Zustand | 4.x | 客户端状态 |
   113→| 数据获取 | SWR | 2.x | 服务端状态 + 缓存 |
   114→| AI | AI SDK | 6.x | 流式响应 + 工具调用 |
   115→| 图表 | ECharts | 5.x | 数据可视化 |
   116→| 动画 | Framer Motion | 10.x | UI 动效 |
   117→| 表单 | React Hook Form | 7.x | 表单处理 |
   118→| 校验 | Zod | 3.x | Schema 校验 |
   119→
   120→### 1.3 目录结构
   121→
   122→```
   123→apps/web/
   124→├── src/
   125→│   ├── app/                          # Next.js App Router 路由
   126→│   │   ├── (auth)/                   # 认证路由组
   127→│   │   │   ├── login/
   128→│   │   │   └── register/
   129→│   │   ├── (main)/                   # 主应用路由
   130→│   │   │   ├── chat/
   131→│   │   │   ├── profile/
   132→│   │   │   ├── vibe-id/              # VibeID 功能
   133→│   │   │   │   ├── page.tsx
   134→│   │   │   │   ├── archetype/[id]/
   135→│   │   │   │   └── journey/
   136→│   │   │   └── skills/
   137→│   │   │       ├── bazi/
   138→│   │   │       ├── zodiac/
   139→│   │   │       ├── tarot/
   140→│   │   │       └── career/
   141→│   │   ├── api/                      # API 路由
   142→│   │   ├── layout.tsx
   143→│   │   └── page.tsx
   144→│   │
   145→│   ├── components/                   # 共享组件
   146→│   │   ├── ui/                       # 设计系统基础组件
   147→│   │   │   ├── Button.tsx
   148→│   │   │   ├── Card.tsx
   149→│   │   │   ├── Input.tsx
   150→│   │   │   └── ...
   151→│   │   ├── layout/                   # 布局组件
   152→│   │   │   ├── Header.tsx
   153→│   │   │   ├── Sidebar.tsx
   154→│   │   │   └── BottomNav.tsx
   155→│   │   ├── chat/                     # 聊天组件
   156→│   │   │   ├── ChatContainer.tsx
   157→│   │   │   ├── ChatMessage.tsx
   158→│   │   │   └── MessageInput.tsx
   159→│   │   └── shared/                   # 跨功能共享组件
   160→│   │       ├── BreathAura.tsx
   161→│   │       ├── VibeGlyph.tsx
   162→│   │       └── InsightSeal.tsx
   163→│   │
   164→│   ├── skills/                       # 技能模块
   165→│   │   ├── bazi/
   166→│   │   │   ├── components/
   167→│   │   │   ├── tools/                # 工具结果卡片
   168→│   │   │   │   ├── index.ts          # 卡片导出
   169→│   │   │   │   └── show-bazi-chart.tsx
   170→│   │   │   └── types/
   171→│   │   ├── zodiac/
   172→│   │   ├── tarot/
   173→│   │   ├── career/
   174→│   │   ├── vibe-id/                  # VibeID 技能组件
   175→│   │   │   ├── components/
   176→│   │   │   │   ├── VibeIDCard.tsx
   177→│   │   │   │   ├── ArchetypeWheel.tsx
   178→│   │   │   │   ├── ArchetypeBadge.tsx
   179→│   │   │   │   └── DimensionRow.tsx
   180→│   │   │   ├── tools/
   181→│   │   │   │   ├── index.ts
   182→│   │   │   │   └── show-vibe-id.tsx
   183→│   │   │   └── hooks/
   184→│   │   │       └── useVibeID.ts
   185→│   │   ├── CardRegistry.ts           # 动态卡片注册表
   186→│   │   └── initCards.ts              # 卡片初始化
   187→│   │
   188→│   ├── hooks/                        # 共享 Hooks
   189→│   │   ├── useVibeChat.ts            # 聊天流 Hook
   190→│   │   ├── useToolSchema.ts          # 工具 Schema 获取
   191→│   │   ├── useAuth.ts
   192→│   │   └── useTheme.ts
   193→│   │
   194→│   ├── stores/                       # Zustand 状态存储
   195→│   │   ├── chatStore.ts
   196→│   │   ├── userStore.ts
   197→│   │   └── vibeIdStore.ts
   198→│   │
   199→│   ├── services/                     # API 服务
   200→│   │   ├── api.ts                    # 基础 API 客户端
   201→│   │   ├── chat.ts                   # 聊天 API
   202→│   │   └── skills.ts                 # 技能 API
   203→│   │
   204→│   ├── types/                        # TypeScript 类型定义
   205→│   │   ├── api.ts
   206→│   │   ├── chat.ts
   207→│   │   ├── vibe-id.ts
   208→│   │   └── skills.ts
   209→│   │
   210→│   ├── utils/                        # 工具函数
   211→│   │   ├── cn.ts                     # 类名合并
   212→│   │   ├── format.ts
   213→│   │   └── validation.ts
   214→│   │
   215→│   ├── providers/                    # React Provider
   216→│   │   ├── AuthProvider.tsx
   217→│   │   ├── ThemeProvider.tsx
   218→│   │   └── Providers.tsx             # 组合 Provider
   219→│   │
   220→│   └── styles/                       # 全局样式
   221→│       ├── globals.css
   222→│       └── variables.css
   223→│
   224→├── public/
   225→│   ├── fonts/
   226→│   ├── icons/
   227→│   └── images/
   228→│
   229→├── tailwind.config.ts
   230→├── next.config.js
   231→└── tsconfig.json
   232→```
   233→
   234→### 1.4 数据流架构
   235→
   236→```
   237→┌─────────────────────────────────────────────────────────────────────────┐
   238→│                              用户交互                                    │
   239→└─────────────────────────────────────────────────────────────────────────┘
   240→                                    │
   241→                                    ▼
   242→┌─────────────────────────────────────────────────────────────────────────┐
   243→│                           聊天组件层                                     │
   244→│  ┌─────────────────────────────────────────────────────────────────┐   │
   245→│  │  ChatContainer.tsx                                               │   │
   246→│  │  - 处理用户输入                                                   │   │
   247→│  │  - 渲染消息                                                       │   │
   248→│  │  - 通过 CardRegistry 显示工具结果                                  │   │
   249→│  └─────────────────────────────────────────────────────────────────┘   │
   250→└─────────────────────────────────────────────────────────────────────────┘
   251→                                    │
   252→                    ┌───────────────┴───────────────┐
   253→                    ▼                               ▼
   254→┌─────────────────────────────┐   ┌─────────────────────────────────────┐
   255→│      useVibeChat Hook       │   │           CardRegistry               │
   256→│  - 流式响应处理              │   │  - 动态组件加载                       │
   257→│  - 工具调用处理              │   │  - 工具名 → 组件映射                   │
   258→│  - 消息状态管理              │   │  - 懒加载提升性能                      │
   259→└─────────────────────────────┘   └─────────────────────────────────────┘
   260→                    │
   261→                    ▼
   262→┌─────────────────────────────────────────────────────────────────────────┐
   263→│                         后端 API (V7)                                    │
   264→│  POST /chat/v5/stream                                                    │
   265→│  ┌─────────────────────────────────────────────────────────────────┐   │
   266→│  │  请求: { user_id, messages, skill_id?, context? }               │   │
   267→│  │  响应: SSE 流                                                    │   │
   268→│  │    - type: "text" | "tool_call" | "tool_result" | "done"        │   │
   269→│  │    - 工具结果包含用于卡片渲染的结构化数据                          │   │
   270→│  └─────────────────────────────────────────────────────────────────┘   │
   271→└─────────────────────────────────────────────────────────────────────────┘
   272→```
   273→
   274→### 1.5 流事件类型
   275→
   276→```typescript
   277→// 后端 SSE 事件类型
   278→type StreamEventType =
   279→  | 'text'           // 文本内容块
   280→  | 'tool_call'      // 工具调用中
   281→  | 'tool_result'    // 工具执行结果
   282→  | 'thinking'       // Agent 思考过程
   283→  | 'error'          // 发生错误
   284→  | 'done';          // 流结束
   285→
   286→interface StreamEvent {
   287→  type: StreamEventType;
   288→  data: unknown;
   289→  timestamp: number;
   290→}
   291→
   292→interface ToolCallEvent {
   293→  type: 'tool_call';
   294→  data: {
   295→    tool_name: string;      // 例如 "show_bazi_chart"
   296→    tool_id: string;        // 唯一调用ID
   297→    arguments: Record<string, unknown>;
   298→  };
   299→}
   300→
   301→interface ToolResultEvent {
   302→  type: 'tool_result';
   303→  data: {
   304→    tool_name: string;
   305→    tool_id: string;
   306→    result: Record<string, unknown>;  // 用于卡片渲染的结构化数据
   307→    skill_id?: string;                // 所属技能
   308→  };
   309→}
   310→```
   311→
   312→---
   313→
   314→## 2. VibeID 核心模块
   315→
   316→> **来源**: VibeID设计-v5.md（主要）、SPEC-v7.md
   317→> **优先级**: 核心功能 - 所有实现必须与 VibeID-v5.md 规格保持一致
   318→
   319→### 2.1 四维原型系统
   320→
   321→VibeID 使用荣格的 12 原型，按 4 个维度组织，构建全面的人格画像。
   322→
   323→#### 2.1.1 维度定义
   324→
   325→| 维度 | 英文 | 描述 | 可见性 |
   326→|------|------|------|--------|
   327→| **核心** | Core | 真实自我，本质特性 | 私密 |
   328→| **内在** | Inner | 内心世界，情感模式 | 半私密 |
   329→| **外在** | Outer | 社交表现，公众形象 | 公开 |
   330→| **阴影** | Shadow | 隐藏面向，成长空间 | 私密 |
   331→
   332→#### 2.1.2 十二原型
   333→
   334→```typescript
   335→// src/types/vibe-id.ts
   336→
   337→/**
   338→ * 荣格十二原型
   339→ * 每个原型都有用于视觉呈现的关联元数据
   340→ */
   341→export type ArchetypeId =
   342→  | 'innocent'    // 天真者
   343→  | 'explorer'    // 探索者
   344→  | 'sage'        // 智者
   345→  | 'hero'        // 英雄
   346→  | 'outlaw'      // 叛逆者
   347→  | 'magician'    // 魔术师
   348→  | 'regular'     // 凡人
   349→  | 'lover'       // 情人
   350→  | 'jester'      // 愚者
   351→  | 'caregiver'   // 照顾者
   352→  | 'creator'     // 创造者
   353→  | 'ruler';      // 统治者
   354→
   355→export type DimensionId = 'core' | 'inner' | 'outer' | 'shadow';
   356→
   357→/**
   358→ * 原型元数据（用于 UI 渲染）
   359→ */
   360→export interface ArchetypeMeta {
   361→  id: ArchetypeId;
   362→  name: string;           // 英文名
   363→  nameCn: string;         // 中文名
   364→  emoji: string;          // 视觉标识
   365→  color: string;          // 十六进制颜色
   366→  gradient: string;       // CSS 渐变
   367→  slogan: string;         // 一句话描述
   368→  superpower: string;     // 核心优势
   369→  growthPoints: string[]; // 成长方向
   370→  element: 'fire' | 'earth' | 'air' | 'water';  // 关联元素
   371→}
   372→
   373→/**
   374→ * 四维原型档案
   375→ */
   376→export interface FourDimensionArchetypes {
   377→  core: ArchetypeId;
   378→  inner: ArchetypeId;
   379→  outer: ArchetypeId;
   380→  shadow: ArchetypeId;
   381→}
   382→
   383→/**
   384→ * 完整的 VibeID 档案
   385→ */
   386→export interface VibeIDProfile {
   387→  userId: string;
   388→  archetypes: FourDimensionArchetypes;
   389→  scores: Record<ArchetypeId, number>;  // 每个原型的 0-100 分数
   390→  confidence: number;                    // 0-1 计算置信度
   391→  calculatedAt: string;                  // ISO 时间戳
   392→  source: 'bazi' | 'zodiac' | 'interview' | 'combined';
   393→
   394→  // 可选的扩展数据
   395→  dimensionScores?: {
   396→    core: Record<ArchetypeId, number>;
   397→    inner: Record<ArchetypeId, number>;
   398→    outer: Record<ArchetypeId, number>;
   399→    shadow: Record<ArchetypeId, number>;
   400→  };

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
