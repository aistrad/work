     1→"""
     2→Tools API - 工具 Schema 端点
     3→
     4→提供前端获取工具定义的 API，实现前后端工具 Schema 同步。
     5→"""
     6→import logging
     7→from typing import Optional
     8→
     9→from fastapi import APIRouter, Query
    10→
    11→from services.agent import ToolRegistry
    12→
    13→router = APIRouter(prefix="/tools", tags=["Tools"])
    14→logger = logging.getLogger(__name__)
    15→
    16→
    17→@router.get("/schema")
    18→async def get_tool_schema(
    19→    skill_id: Optional[str] = Query(None, description="Skill ID (可选，不传则返回所有工具)")
    20→):
    21→    """
    22→    获取工具 Schema
    23→
    24→    返回工具定义供前端使用，实现前后端工具定义同步。
    25→
    26→    Response:
    27→    ```json
    28→    {
    29→        "version": "6.0",
    30→        "skill_id": "bazi",
    31→        "tools": [
    32→            {
    33→                "name": "show_bazi_chart",
    34→                "description": "展示八字命盘",
    35→                "tool_type": "display",
    36→                "card_type": "bazi_chart",
    37→                "parameters": [...]
    38→            }
    39→        ]
    40→    }
    41→    ```
    42→    """
    43→    return ToolRegistry.get_schema(skill_id)
    44→
    45→
    46→@router.get("/list")
    47→async def list_tools(
    48→    skill_id: Optional[str] = Query(None, description="Skill ID")
    49→):
    50→    """
    51→    列出所有工具（OpenAI 格式）
    52→
    53→    返回 OpenAI 工具格式，可直接用于 LLM 调用。
    54→    """
    55→    if skill_id:
    56→        tools = ToolRegistry.get_tools_for_skill(skill_id)
    57→    else:
    58→        tools = ToolRegistry.get_all_tools()
    59→
    60→    return {
    61→        "count": len(tools),
    62→        "tools": tools
    63→    }
    64→
    65→
    66→@router.get("/card-type/{tool_name}")
    67→async def get_card_type(tool_name: str):
    68→    """
    69→    获取工具对应的卡片类型
    70→
    71→    前端可根据 card_type 选择对应的渲染组件。
    72→    """
    73→    card_type = ToolRegistry.get_card_type(tool_name)
    74→    return {
    75→        "tool_name": tool_name,
    76→        "card_type": card_type
    77→    }
    78→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
