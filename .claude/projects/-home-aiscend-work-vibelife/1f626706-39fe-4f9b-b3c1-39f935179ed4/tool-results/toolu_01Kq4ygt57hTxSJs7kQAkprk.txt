The file /home/aiscend/work/vibelife/docs/archive/v4/core-algo-review.md has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
   497â†’- [ ] **äººç”Ÿ K çº¿åç«¯è®¡ç®—**: ç¡®è®¤å¤§è¿/æµå¹´è®¡ç®—æœåŠ¡å®ç°çŠ¶æ€
   498â†’- [ ] **å…³ç³»æ¨¡æ‹Ÿå™¨åˆç›˜ç®—æ³•**: ç¡®è®¤å…«å­—/æ˜Ÿåº§åˆç›˜è®¡ç®—å®ç°çŠ¶æ€
   499â†’- [ ] **å‰ç«¯é›†æˆéªŒè¯**: éªŒè¯ useVibeChat ä¸åç«¯ SSE å…¼å®¹æ€§
   500â†’
   501â†’---
   502â†’
   503â†’# å…­ã€ç”¨æˆ·æµç¨‹ï¼šä»ä¸»é¡µé¢åˆ°å­ç«™ Chat
   504â†’
   505â†’## 6.1 è®¾è®¡è§„æ ¼ (Spec 2.2.1 + æ¶æ„å†³ç­–)
   506â†’
   507â†’```
   508â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   509â†’â”‚                    è®¾è®¡ä¸­çš„ç”¨æˆ·è½¬åŒ–æµç¨‹                                      â”‚
   510â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   511â†’â”‚                                                                            â”‚
   512â†’â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   513â†’â”‚   â”‚                                                                     â”‚  â”‚
   514â†’â”‚   â”‚   æ¸¸å®¢ â”€â”€â†’ å¯¹è¯ + AI è®¿è°ˆ â”€â”€â†’ ç®€ç‰ˆæŠ¥å‘Šï¼ˆå…è´¹ï¼‰                     â”‚  â”‚
   515â†’â”‚   â”‚                                     â”‚                               â”‚  â”‚
   516â†’â”‚   â”‚                                     â–¼                               â”‚  â”‚
   517â†’â”‚   â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚  â”‚
   518â†’â”‚   â”‚                         â”‚  ğŸ’ è§£é”å®Œæ•´æŠ¥å‘Š      â”‚                   â”‚  â”‚
   519â†’â”‚   â”‚                         â”‚    ä»…éœ€ Â¥19.9        â”‚                   â”‚  â”‚
   520â†’â”‚   â”‚                         â”‚  [æ³¨å†Œå¹¶è´­ä¹°]         â”‚                   â”‚  â”‚
   521â†’â”‚   â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚  â”‚
   522â†’â”‚   â”‚                                     â”‚                               â”‚  â”‚
   523â†’â”‚   â”‚                                     â–¼                               â”‚  â”‚
   524â†’â”‚   â”‚                            æ³¨å†Œ + ä»˜è´¹                              â”‚  â”‚
   525â†’â”‚   â”‚                                     â”‚                               â”‚  â”‚
   526â†’â”‚   â”‚                                     â–¼                               â”‚  â”‚
   527â†’â”‚   â”‚                         å®Œæ•´æŠ¥å‘Š + é«˜æ¸…æµ·æŠ¥                         â”‚  â”‚
   528â†’â”‚   â”‚                                                                     â”‚  â”‚
   529â†’â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   530â†’â”‚                                                                            â”‚
   531â†’â”‚   è®¾è®¡è¦ç‚¹:                                                                 â”‚
   532â†’â”‚   1. å­åŸŸåæ¶æ„: bazi.vibelife.app / zodiac.vibelife.app                  â”‚
   533â†’â”‚   2. é¦–é¡µå¿…é¡»å±•ç¤º Daily Greeting (P0+ åŠŸèƒ½)                                â”‚
   534â†’â”‚   3. Skill é€‰æ‹©åé”å®šï¼Œåç»­æµç¨‹ä¿æŒä¸€è‡´                                    â”‚
   535â†’â”‚   4. AI è®¿è°ˆ â˜… å¿…é¡»å®Œæˆï¼Œä¸å¯è·³è¿‡                                         â”‚
   536â†’â”‚   5. å¯¹è¯ä¸­ä½¿ç”¨ Tool Calling è§¦å‘ UI å±•ç¤º                                  â”‚
   537â†’â”‚                                                                            â”‚
   538â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   539â†’```
   540â†’
   541â†’## 6.2 å®é™…å®ç°æµç¨‹
   542â†’
   543â†’### 6.2.1 å‰ç«¯è·¯ç”±æ¶æ„
   544â†’
   545â†’```
   546â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   547â†’â”‚                       å®é™…å®ç°çš„è·¯ç”±ç»“æ„                                    â”‚
   548â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   549â†’â”‚                                                                            â”‚
   550â†’â”‚  vibelife.app (å“ç‰Œé¦–é¡µ)                                                   â”‚
   551â†’â”‚  â”‚                                                                         â”‚
   552â†’â”‚  â”œâ”€ / (app/page.tsx)                                                       â”‚
   553â†’â”‚  â”‚  â””â”€ æ£€æµ‹å­åŸŸå â†’ æœ‰åˆ™é‡å®šå‘åˆ° /{skill}                                 â”‚
   554â†’â”‚  â”‚  â””â”€ æ— å­åŸŸå â†’ æ˜¾ç¤º 5 ä¸ª Skill å¡ç‰‡é€‰æ‹©å™¨                              â”‚
   555â†’â”‚  â”‚                                                                         â”‚
   556â†’â”‚  â”œâ”€ /bazi (å…«å­—è·¯ç”±ç»„)                                                     â”‚
   557â†’â”‚  â”‚  â”œâ”€ /bazi (app/bazi/page.tsx) â”€â”€â”€ Landing Page                         â”‚
   558â†’â”‚  â”‚  â”œâ”€ /bazi/chat (app/bazi/chat/page.tsx) â”€â”€â”€ å¯¹è¯é¡µé¢ â˜…                 â”‚
   559â†’â”‚  â”‚  â”œâ”€ /bazi/report â”€â”€â”€ æŠ¥å‘Šç”Ÿæˆ                                          â”‚
   560â†’â”‚  â”‚  â”œâ”€ /bazi/relationship â”€â”€â”€ å…³ç³»åˆ†æ                                    â”‚
   561â†’â”‚  â”‚  â””â”€ /bazi/kline â”€â”€â”€ Kçº¿å›¾è¡¨                                            â”‚
   562â†’â”‚  â”‚                                                                         â”‚
   563â†’â”‚  â”œâ”€ /zodiac (æ˜Ÿåº§è·¯ç”±ç»„) â”€â”€â”€ ç»“æ„åŒä¸Š                                      â”‚
   564â†’â”‚  â”‚                                                                         â”‚
   565â†’â”‚  â””â”€ middleware.ts                                                          â”‚
   566â†’â”‚     â””â”€ å­åŸŸåæ£€æµ‹ + URL é‡å†™                                               â”‚
   567â†’â”‚     â””â”€ bazi.vibelife.app/chat â†’ /bazi/chat                                â”‚
   568â†’â”‚                                                                            â”‚
   569â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   570â†’```
   571â†’
   572â†’### 6.2.2 å®é™…ç”¨æˆ·æµç¨‹
   573â†’
   574â†’```
   575â†’Step 1: è®¿é—®é¦–é¡µ
   576â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   577â†’ç”¨æˆ·è®¿é—®: vibelife.app æˆ– bazi.vibelife.app
   578â†’
   579â†’middleware.ts:
   580â†’â”œâ”€ æ£€æµ‹ hostname ä¸­çš„å­åŸŸå
   581â†’â”œâ”€ è®¾ç½® header: x-vibelife-skill
   582â†’â””â”€ è®¾ç½® cookie: vibelife-skill (1å¹´æœ‰æ•ˆæœŸ)
   583â†’
   584â†’page.tsx (é¦–é¡µ):
   585â†’â”œâ”€ æ£€æµ‹ window.location.hostname
   586â†’â”œâ”€ æœ‰å­åŸŸå â†’ router.replace(`/${skill}`)
   587â†’â””â”€ æ— å­åŸŸå â†’ æ˜¾ç¤º Skill é€‰æ‹©å¡ç‰‡
   588â†’   â”œâ”€ å…«å­—å‘½ç† (available: true)
   589â†’   â”œâ”€ æ˜Ÿåº§å æ˜Ÿ (available: true)
   590â†’   â”œâ”€ MBTI äººæ ¼ (available: false, "å³å°†æ¨å‡º")
   591â†’   â”œâ”€ ä¾æ‹æ¨¡å¼ (available: false)
   592â†’   â””â”€ èŒä¸šå‘å±• (available: false)
   593â†’
   594â†’
   595â†’Step 2: é€‰æ‹© Skill
   596â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   597â†’ç”¨æˆ·ç‚¹å‡» "å…«å­—å‘½ç†" å¡ç‰‡
   598â†’
   599â†’handleSkillClick():
   600â†’â”œâ”€ è®¾ç½® cookie: vibelife-skill=bazi
   601â†’â””â”€ router.push("/bazi")
   602â†’
   603â†’
   604â†’Step 3: Skill Landing Page
   605â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   606â†’åŠ è½½: /bazi/page.tsx
   607â†’
   608â†’BaziLayout (layout.tsx):
   609â†’â”œâ”€ useEffect: setSkill("bazi")
   610â†’â””â”€ å¼ºåˆ¶é”å®š skill ä¸Šä¸‹æ–‡
   611â†’
   612â†’é¡µé¢å†…å®¹:
   613â†’â”œâ”€ æ ‡é¢˜: "å…«å­—å‘½ç†"
   614â†’â”œâ”€ å‰¯æ ‡é¢˜: "è§£è¯»å¤©èµ‹ï¼Œæ´å¯Ÿäººç”Ÿ"
   615â†’â””â”€ æŒ‰é’®: "å¼€å§‹å¯¹è¯" â†’ /bazi/chat
   616â†’
   617â†’
   618â†’Step 4: è¿›å…¥å¯¹è¯é¡µé¢
   619â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   620â†’åŠ è½½: /bazi/chat/page.tsx
   621â†’
   622â†’ä¸‰æ å¸ƒå±€ (AppShell):
   623â†’â”œâ”€ å·¦æ : NavBar (64px)
   624â†’â”‚  â”œâ”€ chat (å¯¹è¯)
   625â†’â”‚  â”œâ”€ chart (å›¾è¡¨)
   626â†’â”‚  â”œâ”€ journey (æ—…ç¨‹)
   627â†’â”‚  â””â”€ me (ä¸ªäºº)
   628â†’â”‚
   629â†’â”œâ”€ ä¸­æ : ChatContainer (flex-1)
   630â†’â”‚  â”œâ”€ skillId="bazi"
   631â†’â”‚  â”œâ”€ skill="bazi"
   632â†’â”‚  â””â”€ voiceMode={voiceMode}
   633â†’â”‚
   634â†’â””â”€ å³æ : ResizablePanel (320-600px)
   635â†’   â””â”€ æ ¹æ® activeTab åˆ‡æ¢:
   636â†’      â”œâ”€ ChatPanel
   637â†’      â”œâ”€ ChartPanel
   638â†’      â”œâ”€ JourneyPanel
   639â†’      â””â”€ MePanel
   640â†’
   641â†’
   642â†’Step 5: åˆå§‹åŒ– Chat (ç©ºçŠ¶æ€)
   643â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   644â†’useVibeChat åˆå§‹åŒ–:
   645â†’â”œâ”€ åˆ›å»º DefaultChatTransport
   646â†’â”‚  â”œâ”€ api: "/api/chat"
   647â†’â”‚  â”œâ”€ body: { skill: "bazi", voice_mode: "warm" }
   648â†’â”‚  â””â”€ headers: { Authorization: Bearer {token} }
   649â†’â””â”€ AI SDK useChat hook
   650â†’
   651â†’ç©ºçŠ¶æ€ UI:
   652â†’â”œâ”€ DailyGreeting (é—®å€™å¡) â˜… å¾…ç¡®è®¤æ˜¯å¦çœŸæ­£å®ç°
   653â†’â”œâ”€ VibeGlyph + BreathAura (è§†è§‰æ•ˆæœ)
   654â†’â””â”€ QuickPrompts (4ä¸ªå¿«é€Ÿé—®é¢˜)
   655â†’   â”œâ”€ "å¸®æˆ‘è§£è¯»ä¸€ä¸‹æˆ‘çš„å‘½ç›˜"
   656â†’   â”œâ”€ "æœ€è¿‘è¿åŠ¿æ€ä¹ˆæ ·"
   657â†’   â”œâ”€ "æˆ‘é€‚åˆä»€ä¹ˆå·¥ä½œ"
   658â†’   â””â”€ "æˆ‘çš„æ„Ÿæƒ…è¿å¦‚ä½•"
   659â†’
   660â†’
   661â†’Step 6: å‘é€æ¶ˆæ¯
   662â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   663â†’ç”¨æˆ·è¾“å…¥: "æˆ‘æ˜¯1990å¹´5æœˆ15æ—¥æ—©ä¸Š8ç‚¹å‡ºç”Ÿ"
   664â†’
   665â†’ChatInput.onSend() â†’ sendMessage()
   666â†’
   667â†’è¯·æ±‚é“¾è·¯:
   668â†’POST /api/chat (Next.js API Route)
   669â†’  â†“ body: {
   670â†’  â†“   messages: [...],
   671â†’  â†“   skill: "bazi",
   672â†’  â†“   voice_mode: "warm",
   673â†’  â†“   conversation_id: undefined
   674â†’  â†“ }
   675â†’  â†“
   676â†’Next.js route.ts:
   677â†’  â”œâ”€ æå– skill, voice_mode, conversation_id
   678â†’  â”œâ”€ æ„å»º chatRequest
   679â†’  â””â”€ è½¬å‘åˆ° Python åç«¯
   680â†’     â†“
   681â†’POST /api/v1/chat/stream (Python FastAPI)
   682â†’  â”œâ”€ åˆ›å»ºæ–°å¯¹è¯ï¼Œç”Ÿæˆ conversation_id
   683â†’  â”œâ”€ RAG æ£€ç´¢çŸ¥è¯†åº“
   684â†’  â”œâ”€ Context æ„å»º
   685â†’  â”œâ”€ LLM è°ƒç”¨ (æµå¼)
   686â†’  â””â”€ è¿”å› SSE äº‹ä»¶æµ
   687â†’
   688â†’
   689â†’Step 7: SSE äº‹ä»¶æµè½¬æ¢
   690â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   691â†’Python åç«¯ SSE æ ¼å¼:
   692â†’â”œâ”€ {"type": "chunk", "content": "æ ¹æ®"}
   693â†’â”œâ”€ {"type": "chunk", "content": "æ‚¨çš„å…«å­—..."}
   694â†’â”œâ”€ {"type": "tool_call", "tool_name": "show_bazi_chart", ...}
   695â†’â””â”€ {"type": "done", "conversation_id": "uuid-xxx"}
   696â†’
   697â†’Next.js route.ts è½¬æ¢ä¸º AI SDK 6 æ ¼å¼:
   698â†’â”œâ”€ {"type": "text-delta", "id": "xxx", "delta": "æ ¹æ®"}
   699â†’â”œâ”€ {"type": "tool-input-available", "toolCallId": "xxx", ...}
   700â†’â”œâ”€ {"type": "tool-output-available", ...} â† æ‰§è¡Œå·¥å…·å¹¶è¿”å›ç»“æœ
   701â†’â””â”€ {"type": "finish", "messageMetadata": {conversation_id: "uuid-xxx"}}
   702â†’
   703â†’å‰ç«¯å¤„ç†:
   704â†’â”œâ”€ AI SDK useChat è§£æ UIMessageStream
   705â†’â”œâ”€ æ¸²æŸ“ ChatMessage ç»„ä»¶
   706â†’â””â”€ å·¥å…·è°ƒç”¨ â†’ æ¸²æŸ“å¯¹åº” UI ç»„ä»¶ (å›¾è¡¨/å¡ç‰‡ç­‰)
   707â†’
   708â†’
   709â†’Step 8: å·¥å…·è°ƒç”¨å¤„ç† (Generative UI)
   710â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   711â†’åç«¯è¿”å› tool_call: show_bazi_chart
   712â†’
   713â†’Next.js route.ts:
   714â†’â”œâ”€ è¯†åˆ«å·¥å…·ç±»å‹
   715â†’â”œâ”€ è°ƒç”¨ executeToolCall()
   716â†’â”‚  â”œâ”€ show_bazi_chart: è¿”å›æ¼”ç¤ºæ•°æ® (ç¡¬ç¼–ç )
   717â†’â”‚  â”œâ”€ show_bazi_fortune: è°ƒç”¨ /fortune/cycles + /fortune/annual
   718â†’â”‚  â”œâ”€ show_bazi_kline: è°ƒç”¨ /fortune/kline
   719â†’â”‚  â”œâ”€ show_report: è·å–æˆ–ç”Ÿæˆæ¼”ç¤ºæŠ¥å‘Š
   720â†’â”‚  â””â”€ show_relationship: è°ƒç”¨ /relationship/analyze
   721â†’â””â”€ è¿”å› tool-output-available äº‹ä»¶
   722â†’
   723â†’å‰ç«¯æ¸²æŸ“:
   724â†’â”œâ”€ æ ¹æ® tool_name é€‰æ‹©ç»„ä»¶
   725â†’â”‚  â”œâ”€ show_bazi_chart â†’ BaziChartCard
   726â†’â”‚  â”œâ”€ show_bazi_fortune â†’ FortunePanel
   727â†’â”‚  â”œâ”€ show_bazi_kline â†’ KLineChart
   728â†’â”‚  â””â”€ ...
   729â†’â””â”€ åµŒå…¥å¯¹è¯æµä¸­æ˜¾ç¤º
   730â†’```
   731â†’
   732â†’## 6.3 è®¾è®¡ vs å®ç°å·®å¼‚åˆ†æ
   733â†’
   734â†’### 6.3.1 è·¯ç”±æ¶æ„å·®å¼‚
   735â†’
   736â†’| è®¾è®¡ç‚¹ | è®¾è®¡è§„æ ¼ | å®é™…å®ç° | å·®å¼‚ |
   737â†’|--------|---------|---------|------|
   738â†’| **å­åŸŸåè·¯ç”±** | bazi.vibelife.app â†’ /bazi | âœ… middleware.ts URL é‡å†™ | ä¸€è‡´ |
   739â†’| **Skill é”å®š** | é€‰æ‹©åé”å®šï¼Œä¿æŒä¸€è‡´ | âœ… Layout + Cookie + Header | ä¸€è‡´ |
   740â†’| **æœ¬åœ°å¼€å‘** | localhost æ”¯æŒè·¯å¾„å‰ç¼€ | âœ… localhost:3000/bazi | ä¸€è‡´ |
   741â†’| **MBTI/ä¾æ‹/èŒä¸š** | Phase 1 å»¶å | âœ… `available: false` æ ‡è®° | ä¸€è‡´ |
   742â†’
   743â†’### 6.3.2 é¦–é¡µä¸ Daily Greeting å·®å¼‚
   744â†’
   745â†’| è®¾è®¡ç‚¹ | è®¾è®¡è§„æ ¼ | å®é™…å®ç° | å·®å¼‚ |
   746â†’|--------|---------|---------|------|
   747â†’| **Daily Greeting** | P0+ å¿…é¡»å±•ç¤ºï¼Œå¼ºåˆ¶å±•ç¤º | âš ï¸ ChatContainer æœ‰ DailyGreeting ç»„ä»¶å ä½ | éœ€ç¡®è®¤æ˜¯å¦è°ƒç”¨åç«¯ API |
   748â†’| **Greeting å†…å®¹** | èŠ‚æ°”/å¤©è±¡/è¿åŠ¿ç›¸å…³ | âš ï¸ å¯èƒ½æ˜¯é™æ€å†…å®¹ | éœ€ç¡®è®¤åŠ¨æ€ç”Ÿæˆ |
   749â†’| **"ä¸»åŠ¨å…³å¿ƒ"** | Phase 1 æ›¿ä»£ Push | âš ï¸ ä»…å±•ç¤ºï¼Œæœªè§ä¸ªæ€§åŒ–é€»è¾‘ | å¯èƒ½æœªå®ç°ä¸ªæ€§åŒ– |
   750â†’
   751â†’### 6.3.3 å¯¹è¯æµç¨‹å·®å¼‚
   752â†’
   753â†’| è®¾è®¡ç‚¹ | è®¾è®¡è§„æ ¼ | å®é™…å®ç° | å·®å¼‚ |
   754â†’|--------|---------|---------|------|
   755â†’| **SSE æ ¼å¼** | AI SDK 6 UIMessageStream | âœ… Next.js route.ts åšäº†è½¬æ¢ | âœ… å·²é€‚é… |
   756â†’| **åç«¯ SSE** | `{"type": "chunk"}` | âœ… Python chat.py è¿”å› | ä¸€è‡´ |
   757â†’| **Tool Calling** | å·¥å…·è°ƒç”¨è§¦å‘ UI | âœ… æ”¯æŒ 11 ç§å·¥å…· | ä¸€è‡´ |
   758â†’| **å·¥å…·æ‰§è¡Œä½ç½®** | åç«¯æ‰§è¡Œ | âš ï¸ Next.js è¾¹ç¼˜æ‰§è¡Œ (éƒ¨åˆ†ç¡¬ç¼–ç ) | éœ€é‡æ„åˆ°åç«¯ |
   759â†’| **conversation_id** | åç«¯ç”Ÿæˆï¼Œå‰ç«¯ä¿å­˜ | âœ… é€šè¿‡ messageMetadata è¿”å› | ä¸€è‡´ |
   760â†’
   761â†’### 6.3.4 å·¥å…·è°ƒç”¨å·®å¼‚
   762â†’
   763â†’| å·¥å…·åç§° | è®¾è®¡ | å®é™…å®ç° | å·®å¼‚ |
   764â†’|---------|------|---------|------|
   765â†’| `show_bazi_chart` | åç«¯è®¡ç®—å‘½ç›˜ | âŒ ç¡¬ç¼–ç æ¼”ç¤ºæ•°æ® | æœªæ¥çœŸå®è®¡ç®— |
   766â†’| `show_bazi_fortune` | åç«¯è®¡ç®—è¿åŠ¿ | âœ… è°ƒç”¨ /fortune API | ä¸€è‡´ |
   767â†’| `show_bazi_kline` | åç«¯è®¡ç®—Kçº¿ | âœ… è°ƒç”¨ /fortune/kline API | ä¸€è‡´ |
   768â†’| `show_zodiac_chart` | åç«¯è®¡ç®—æ˜Ÿç›˜ | âŒ ç¡¬ç¼–ç æ¼”ç¤ºæ•°æ® | æœªæ¥çœŸå®è®¡ç®— |
   769â†’| `show_report` | åç«¯è·å–æŠ¥å‘Š | âš ï¸ å°è¯•è°ƒç”¨ APIï¼Œå¤±è´¥è¿”å›æ¼”ç¤º | å›è½æ¼”ç¤ºæ•°æ® |
   770â†’| `show_relationship` | åç«¯è®¡ç®—å…³ç³» | âœ… è°ƒç”¨ /relationship/analyze | ä¸€è‡´ |
   771â†’| `request_info` | è§¦å‘ä¿¡æ¯é‡‡é›† | âœ… è¿”å›è¡¨å•å­—æ®µå®šä¹‰ | ä¸€è‡´ |
   772â†’| `show_insight` | å±•ç¤ºæ´å¯Ÿå¡ç‰‡ | âŒ ç¡¬ç¼–ç æ¼”ç¤ºæ•°æ® | æœªå®ç°åŠ¨æ€ç”Ÿæˆ |
   773â†’
   774â†’### 6.3.5 å…³é”®å·®å¼‚æ±‡æ€»
   775â†’
   776â†’| é—®é¢˜ | è®¾è®¡ | å®ç° | ä¼˜å…ˆçº§ | ä¿®å¤å»ºè®® |
   777â†’|------|------|------|--------|---------|
   778â†’| **Daily Greeting æœªä¸ªæ€§åŒ–** | åŸºäºè¿åŠ¿/èŠ‚æ°”åŠ¨æ€ç”Ÿæˆ | å¯èƒ½æ˜¯é™æ€å ä½ | P1 | è°ƒç”¨åç«¯ /fortune/greeting API |
   779â†’| **show_bazi_chart ç¡¬ç¼–ç ** | åç«¯çœŸå®è®¡ç®— | æ¼”ç¤ºæ•°æ® | P1 | å¯¹æ¥æ’ç›˜æœåŠ¡ |
   780â†’| **show_zodiac_chart ç¡¬ç¼–ç ** | åç«¯çœŸå®è®¡ç®— | æ¼”ç¤ºæ•°æ® | P1 | å¯¹æ¥æ˜Ÿç›˜æœåŠ¡ |
   781â†’| **show_insight ç¡¬ç¼–ç ** | AI åŠ¨æ€ç”Ÿæˆ | é™æ€æ¼”ç¤º | P2 | è°ƒç”¨åç«¯æ´å¯Ÿç”Ÿæˆ |
   782â†’| **å·¥å…·æ‰§è¡Œåœ¨ Edge** | åç«¯æ‰§è¡Œ | Next.js è¾¹ç¼˜æ‰§è¡Œ | P2 | å¯è€ƒè™‘ä¿æŒï¼Œä½†éœ€ç›‘æ§æ€§èƒ½ |
   783â†’
   784â†’## 6.4 å…³é”®ä»£ç è·¯å¾„
   785â†’
   786â†’```
   787â†’ç”¨æˆ·è®¿é—®é¦–é¡µ
   788â†’â”œâ”€ middleware.ts:47 â”€â”€â”€ å­åŸŸåæ£€æµ‹ + URL é‡å†™
   789â†’â”œâ”€ app/page.tsx:82 â”€â”€â”€ é¦–é¡µç»„ä»¶ï¼ŒSkill é€‰æ‹©
   790â†’â”‚
   791â†’ç”¨æˆ·é€‰æ‹© Skill
   792â†’â”œâ”€ app/page.tsx:109 â”€â”€â”€ handleSkillClick()
   793â†’â”œâ”€ app/bazi/page.tsx â”€â”€â”€ Landing Page
   794â†’â”‚
   795â†’è¿›å…¥å¯¹è¯é¡µé¢
   796â†’â”œâ”€ app/bazi/chat/page.tsx:83 â”€â”€â”€ BaziChatPage
   797â†’â”œâ”€ components/layout/AppShell.tsx â”€â”€â”€ ä¸‰æ å¸ƒå±€
   798â†’â”œâ”€ components/chat/ChatContainer.tsx â”€â”€â”€ å¯¹è¯å®¹å™¨
   799â†’â”‚
   800â†’å‘é€æ¶ˆæ¯
   801â†’â”œâ”€ hooks/useVibeChat.ts â”€â”€â”€ AI SDK åŒ…è£…
   802â†’â”œâ”€ app/api/chat/route.ts:363 â”€â”€â”€ POST handler
   803â†’â”‚  â”œâ”€ L387: fetch Python åç«¯ /chat/stream
   804â†’â”‚  â”œâ”€ L411: åˆ›å»º UIMessageStream
   805â†’â”‚  â”œâ”€ L449: å¤„ç† chunk â†’ text-delta
   806â†’â”‚  â”œâ”€ L455: å¤„ç† tool_call â†’ tool-input-available
   807â†’â”‚  â””â”€ L473: executeToolCall() æ‰§è¡Œå·¥å…·
   808â†’â”‚
   809â†’åç«¯å¤„ç†
   810â†’â”œâ”€ routes/chat.py:150 â”€â”€â”€ chat_stream()
   811â†’â”œâ”€ services/vibe_engine/context.py â”€â”€â”€ Context æ„å»º
   812â†’â”œâ”€ services/knowledge/retrieval.py â”€â”€â”€ RAG æ£€ç´¢
   813â†’â””â”€ services/vibe_engine/llm.py â”€â”€â”€ LLM è°ƒç”¨
   814â†’```
   815â†’
   816â†’## 6.5 å‰ç«¯å…³é”®æ–‡ä»¶æ¸…å•
   817â†’
   818â†’| æ–‡ä»¶ | åŠŸèƒ½ | è¡Œæ•° |
   819â†’|------|------|------|
   820â†’| `middleware.ts` | å­åŸŸåè·¯ç”± + Skill æ£€æµ‹ | 143 |
   821â†’| `app/page.tsx` | å“ç‰Œé¦–é¡µ + Skill é€‰æ‹©å™¨ | 247 |
   822â†’| `app/bazi/page.tsx` | å…«å­— Landing Page | ~100 |
   823â†’| `app/bazi/chat/page.tsx` | å…«å­—å¯¹è¯é¡µé¢ | 90 |
   824â†’| `app/bazi/layout.tsx` | å…«å­—è·¯ç”±å¸ƒå±€ (Skill é”å®š) | ~30 |
   825â†’| `app/api/chat/route.ts` | Chat API ä»£ç† + SSE è½¬æ¢ | 569 |
   826â†’| `components/chat/ChatContainer.tsx` | å¯¹è¯ä¸»å®¹å™¨ | ~300 |
   827â†’| `hooks/useVibeChat.ts` | AI SDK 6 å°è£… | ~150 |
   828â†’| `providers/SkillProvider.tsx` | Skill ä¸Šä¸‹æ–‡ç®¡ç† | ~100 |
   829â†’
   830â†’---
   831â†’
   832â†’# é™„å½•: å…³é”®æ–‡ä»¶æ¸…å•
   833â†’
   834â†’| æ¨¡å— | æ–‡ä»¶è·¯å¾„ | è¡Œæ•° |
   835â†’|------|----------|------|
   836â†’| Context æ„å»º | `apps/api/services/vibe_engine/context.py` | 410 |