     1â†’# å‰ç«¯ä½“éªŒé‡æ„æ–¹æ¡ˆ
     2â†’
     3â†’## æ¦‚è¿°
     4â†’
     5â†’å°†å‰ç«¯ä»"æŠ€èƒ½å¯¼å‘"é‡æ„ä¸º"æ—…ç¨‹å¯¼å‘"ï¼Œå®ç°ç»Ÿä¸€å…¥å£ã€Identity Prism å¯è§†åŒ–ã€æ¯æ—¥ä»ªå¼ä½“éªŒã€‚
     6â†’
     7â†’---
     8â†’
     9â†’## 1. é¡µé¢ç»“æ„é‡æ„
    10â†’
    11â†’### 1.1 ç°æœ‰ç»“æ„
    12â†’
    13â†’```
    14â†’app/
    15â†’â”œâ”€â”€ page.tsx              # é¦–é¡µ
    16â†’â”œâ”€â”€ auth/                 # è®¤è¯
    17â†’â”œâ”€â”€ chat/                 # å¯¹è¯
    18â†’â”œâ”€â”€ bazi/                 # å…«å­—
    19â†’â”œâ”€â”€ zodiac/               # æ˜Ÿåº§
    20â†’â”œâ”€â”€ interview/            # è®¿è°ˆ
    21â†’â”œâ”€â”€ report/               # æŠ¥å‘Š
    22â†’â”œâ”€â”€ relationship/         # å…³ç³»
    23â†’â””â”€â”€ ...
    24â†’```
    25â†’
    26â†’### 1.2 ç›®æ ‡ç»“æ„
    27â†’
    28â†’```
    29â†’app/
    30â†’â”œâ”€â”€ page.tsx              # é¦–é¡µ (é‡æ„ä¸ºæ—…ç¨‹å…¥å£)
    31â†’â”œâ”€â”€ auth/                 # è®¤è¯ (ä¿æŒ)
    32â†’â”œâ”€â”€ home/                 # ä¸»é¡µ (æ–°å¢ - æ¯æ—¥ä»ªå¼å…¥å£)
    33â†’â”œâ”€â”€ identity/             # Identity Prism (æ–°å¢)
    34â†’â”‚   â”œâ”€â”€ page.tsx          # æ£±é•œæ€»è§ˆ
    35â†’â”‚   â””â”€â”€ [dimension]/      # å„ç»´åº¦è¯¦æƒ…
    36â†’â”œâ”€â”€ chat/                 # ç»Ÿä¸€å¯¹è¯ (é‡æ„)
    37â†’â”œâ”€â”€ journey/              # ç”¨æˆ·æ—…ç¨‹ (æ–°å¢)
    38â†’â”œâ”€â”€ events/               # ç”Ÿæ´»äº‹ä»¶ (æ–°å¢)
    39â†’â”œâ”€â”€ memories/             # è®°å¿†å›é¡¾ (æ–°å¢)
    40â†’â””â”€â”€ settings/             # è®¾ç½® (å¢å¼º)
    41â†’```
    42â†’
    43â†’---
    44â†’
    45â†’## 2. æ ¸å¿ƒé¡µé¢è®¾è®¡
    46â†’
    47â†’### 2.1 ä¸»é¡µ (Home) - æ¯æ—¥ä»ªå¼å…¥å£
    48â†’
    49â†’```tsx
    50â†’// app/home/page.tsx
    51â†’
    52â†’export default function HomePage() {
    53â†’  const { user } = useAuth()
    54â†’  const { ritual, isLoading } = useTodayRitual()
    55â†’  const { events } = useUpcomingEvents()
    56â†’
    57â†’  return (
    58â†’    <div className="min-h-screen bg-gradient-to-b from-slate-900 to-slate-800">
    59â†’      {/* é¡¶éƒ¨é—®å€™ */}
    60â†’      <GreetingHeader user={user} />
    61â†’
    62â†’      {/* ä»Šæ—¥ä»ªå¼å¡ç‰‡ */}
    63â†’      <RitualCard ritual={ritual} />
    64â†’
    65â†’      {/* å¿«é€Ÿå…¥å£ */}
    66â†’      <QuickActions />
    67â†’
    68â†’      {/* å³å°†å‘ç”Ÿçš„äº‹ä»¶ */}
    69â†’      {events.length > 0 && <UpcomingEvents events={events} />}
    70â†’
    71â†’      {/* æœ€è¿‘æ´å¯Ÿ */}
    72â†’      <RecentInsights />
    73â†’
    74â†’      {/* åº•éƒ¨å¯¼èˆª */}
    75â†’      <BottomNav />
    76â†’    </div>
    77â†’  )
    78â†’}
    79â†’```
    80â†’
    81â†’### 2.2 ä»ªå¼å¡ç‰‡ç»„ä»¶
    82â†’
    83â†’```tsx
    84â†’// components/ritual/RitualCard.tsx
    85â†’
    86â†’interface RitualCardProps {
    87â†’  ritual: DailyRitual
    88â†’}
    89â†’
    90â†’export function RitualCard({ ritual }: RitualCardProps) {
    91â†’  const currentTime = useCurrentTime()
    92â†’  const activeRitual = getActiveRitual(ritual, currentTime)
    93â†’
    94â†’  return (
    95â†’    <motion.div
    96â†’      className="mx-4 rounded-2xl bg-gradient-to-br from-indigo-600 to-purple-700 p-6"
    97â†’      initial={{ opacity: 0, y: 20 }}
    98â†’      animate={{ opacity: 1, y: 0 }}
    99â†’    >
   100â†’      {activeRitual === 'morning' && (
   101â†’        <MorningOracleCard oracle={ritual.morning_oracle} />
   102â†’      )}
   103â†’      {activeRitual === 'midday' && (
   104â†’        <MiddayMirrorCard mirror={ritual.midday_mirror} />
   105â†’      )}
   106â†’      {activeRitual === 'night' && (
   107â†’        <NightWhisperCard whisper={ritual.night_whisper} />
   108â†’      )}
   109â†’    </motion.div>
   110â†’  )
   111â†’}
   112â†’
   113â†’function MorningOracleCard({ oracle }: { oracle: MorningOracle }) {
   114â†’  return (
   115â†’    <div className="space-y-4">
   116â†’      <div className="flex items-center gap-2">
   117â†’        <SunIcon className="h-6 w-6 text-amber-300" />
   118â†’        <span className="text-amber-300 font-medium">æ™¨è°•</span>
   119â†’      </div>
   120â†’
   121â†’      <div className="text-center">
   122â†’        <span className="text-3xl font-bold text-white">
   123â†’          {oracle.energy_theme}
   124â†’        </span>
   125â†’      </div>
   126â†’
   127â†’      <p className="text-white/90 text-sm leading-relaxed">
   128â†’        {oracle.prediction}
   129â†’      </p>
   130â†’
   131â†’      <div className="bg-white/10 rounded-lg p-3">
   132â†’        <p className="text-white/80 text-xs">
   133â†’          ğŸ’¡ {oracle.advice}
   134â†’        </p>
   135â†’      </div>
   136â†’    </div>
   137â†’  )
   138â†’}
   139â†’```
   140â†’
   141â†’### 2.3 Identity Prism é¡µé¢
   142â†’
   143â†’```tsx
   144â†’// app/identity/page.tsx
   145â†’
   146â†’export default function IdentityPage() {
   147â†’  const { prism, dimensions, isLoading } = useIdentityPrism()
   148â†’
   149â†’  if (isLoading) return <PrismSkeleton />
   150â†’
   151â†’  return (
   152â†’    <div className="min-h-screen bg-slate-900 p-4">
   153â†’      <header className="mb-6">
   154â†’        <h1 className="text-2xl font-bold text-white">ä½ çš„èº«ä»½æ£±é•œ</h1>
   155â†’        <p className="text-slate-400 text-sm">å¤šç»´åº¦èåˆçš„ä½ </p>
   156â†’      </header>
   157â†’
   158â†’      {/* 3D æ£±é•œå¯è§†åŒ– */}
   159â†’      <PrismVisualization prism={prism} />
   160â†’
   161â†’      {/* ä¸‰ç»´æ‘˜è¦ */}
   162â†’      <div className="space-y-4 mt-6">
   163â†’        <PrismDimension
   164â†’          title="æ ¸å¿ƒæœ¬è´¨"
   165â†’          subtitle="é©±åŠ¨ä½ çš„æ ¹æœ¬åŠ›é‡"
   166â†’          content={prism.core_essence}
   167â†’          icon={<CoreIcon />}
   168â†’          color="amber"
   169â†’        />
   170â†’        <PrismDimension
   171â†’          title="å†…åœ¨è‡ªæˆ‘"
   172â†’          subtitle="ä½ å†…å¿ƒçœŸæ­£æƒ³è¦çš„"
   173â†’          content={prism.inner_self}
   174â†’          icon={<InnerIcon />}
   175â†’          color="purple"
   176â†’        />
   177â†’        <PrismDimension
   178â†’          title="å¤–åœ¨è¡¨ç°"
   179â†’          subtitle="åˆ«äººçœ¼ä¸­çš„ä½ "
   180â†’          content={prism.outer_expression}
   181â†’          icon={<OuterIcon />}
   182â†’          color="blue"
   183â†’        />
   184â†’      </div>
   185â†’
   186â†’      {/* ç»´åº¦æ¥æº */}
   187â†’      <section className="mt-8">
   188â†’        <h2 className="text-lg font-semibold text-white mb-4">ç»´åº¦æ¥æº</h2>
   189â†’        <div className="grid grid-cols-2 gap-3">
   190â†’          {dimensions.map((dim) => (
   191â†’            <DimensionCard
   192â†’              key={dim.type}
   193â†’              dimension={dim}
   194â†’              isUnlocked={dim.is_unlocked}
   195â†’            />
   196â†’          ))}
   197â†’        </div>
   198â†’      </section>
   199â†’    </div>
   200â†’  )
   201â†’}
   202â†’```
   203â†’
   204â†’### 2.4 æ£±é•œ 3D å¯è§†åŒ–
   205â†’
   206â†’```tsx
   207â†’// components/identity/PrismVisualization.tsx
   208â†’
   209â†’import { Canvas } from '@react-three/fiber'
   210â†’import { OrbitControls } from '@react-three/drei'
   211â†’
   212â†’export function PrismVisualization({ prism }: { prism: IdentityPrism }) {
   213â†’  return (
   214â†’    <div className="h-64 rounded-2xl overflow-hidden bg-slate-800">
   215â†’      <Canvas camera={{ position: [0, 0, 5] }}>
   216â†’        <ambientLight intensity={0.5} />
   217â†’        <pointLight position={[10, 10, 10]} />
   218â†’
   219â†’        <Prism3D
   220â†’          coreStrength={prism.core_essence?.confidence || 0}
   221â†’          innerStrength={prism.inner_self?.confidence || 0}
   222â†’          outerStrength={prism.outer_expression?.confidence || 0}
   223â†’        />
   224â†’
   225â†’        <OrbitControls enableZoom={false} />
   226â†’      </Canvas>
   227â†’    </div>
   228â†’  )
   229â†’}
   230â†’
   231â†’function Prism3D({ coreStrength, innerStrength, outerStrength }) {
   232â†’  return (
   233â†’    <mesh rotation={[0.5, 0.5, 0]}>
   234â†’      <octahedronGeometry args={[1.5, 0]} />
   235â†’      <meshStandardMaterial
   236â†’        color="#8b5cf6"
   237â†’        transparent
   238â†’        opacity={0.8}
   239â†’        wireframe={false}
   240â†’      />
   241â†’    </mesh>
   242â†’  )
   243â†’}
   244â†’```
   245â†’
   246â†’---
   247â†’
   248â†’## 3. ç»Ÿä¸€å¯¹è¯ä½“éªŒ
   249â†’
   250â†’### 3.1 å¯¹è¯é¡µé¢é‡æ„
   251â†’
   252â†’```tsx
   253â†’// app/chat/page.tsx
   254â†’
   255â†’export default function ChatPage() {
   256â†’  const { conversation, messages, sendMessage } = useConversation()
   257â†’  const { context } = useConversationContext()
   258â†’
   259â†’  return (
   260â†’    <div className="flex flex-col h-screen bg-slate-900">
   261â†’      {/* ä¸Šä¸‹æ–‡é¢æ¿ (å¯æŠ˜å ) */}
   262â†’      <ContextPanel context={context} />
   263â†’
   264â†’      {/* æ¶ˆæ¯åˆ—è¡¨ */}
   265â†’      <MessageList messages={messages} />
   266â†’
   267â†’      {/* è¾“å…¥åŒºåŸŸ */}
   268â†’      <ChatInput onSend={sendMessage} />
   269â†’    </div>
   270â†’  )
   271â†’}
   272â†’```
   273â†’
   274â†’### 3.2 ä¸Šä¸‹æ–‡é¢æ¿
   275â†’
   276â†’```tsx
   277â†’// components/chat/ContextPanel.tsx
   278â†’
   279â†’export function ContextPanel({ context }: { context: ConversationContext }) {
   280â†’  const [isExpanded, setIsExpanded] = useState(false)
   281â†’
   282â†’  return (
   283â†’    <motion.div
   284â†’      className="bg-slate-800 border-b border-slate-700"
   285â†’      animate={{ height: isExpanded ? 'auto' : 48 }}
   286â†’    >
   287â†’      <button
   288â†’        onClick={() => setIsExpanded(!isExpanded)}
   289â†’        className="w-full px-4 py-3 flex items-center justify-between"
   290â†’      >
   291â†’        <span className="text-slate-400 text-sm">
   292â†’          {context.journey_stage} Â· {context.active_dimensions.length} ç»´åº¦å·²è§£é”
   293â†’        </span>
   294â†’        <ChevronIcon className={isExpanded ? 'rotate-180' : ''} />
   295â†’      </button>
   296â†’
   297â†’      {isExpanded && (
   298â†’        <div className="px-4 pb-4 space-y-3">
   299â†’          {/* ä»Šæ—¥è¿åŠ¿æ‘˜è¦ */}
   300â†’          {context.current_fortune && (
   301â†’            <div className="bg-slate-700/50 rounded-lg p-3">
   302â†’              <span className="text-xs text-slate-400">ä»Šæ—¥èƒ½é‡</span>
   303â†’              <p className="text-white text-sm">{context.current_fortune.theme}</p>
   304â†’            </div>
   305â†’          )}
   306â†’
   307â†’          {/* ç›¸å…³è®°å¿† */}
   308â†’          {context.recent_memories.length > 0 && (
   309â†’            <div className="bg-slate-700/50 rounded-lg p-3">
   310â†’              <span className="text-xs text-slate-400">ç›¸å…³è®°å¿†</span>
   311â†’              {context.recent_memories.slice(0, 2).map((m, i) => (
   312â†’                <p key={i} className="text-white/80 text-xs mt-1">â€¢ {m.content}</p>
   313â†’              ))}
   314â†’            </div>
   315â†’          )}
   316â†’
   317â†’          {/* å³å°†å‘ç”Ÿçš„äº‹ä»¶ */}
   318â†’          {context.upcoming_events.length > 0 && (
   319â†’            <div className="bg-slate-700/50 rounded-lg p-3">
   320â†’              <span className="text-xs text-slate-400">è¿‘æœŸäº‹ä»¶</span>
   321â†’              {context.upcoming_events.slice(0, 2).map((e, i) => (
   322â†’                <p key={i} className="text-white/80 text-xs mt-1">
   323â†’                  â€¢ {e.event_date}: {e.title}
   324â†’                </p>
   325â†’              ))}
   326â†’            </div>
   327â†’          )}
   328â†’        </div>
   329â†’      )}
   330â†’    </motion.div>
   331â†’  )
   332â†’}
   333â†’```
   334â†’
   335â†’### 3.3 å¢å¼ºæ¶ˆæ¯ç»„ä»¶
   336â†’
   337â†’```tsx
   338â†’// components/chat/Message.tsx
   339â†’
   340â†’export function Message({ message }: { message: ChatMessage }) {
   341â†’  const isAI = message.role === 'assistant'
   342â†’
   343â†’  return (
   344â†’    <div className={`flex ${isAI ? 'justify-start' : 'justify-end'} mb-4`}>
   345â†’      <div
   346â†’        className={`max-w-[80%] rounded-2xl px-4 py-3 ${
   347â†’          isAI
   348â†’            ? 'bg-slate-700 text-white'
   349â†’            : 'bg-indigo-600 text-white'
   350â†’        }`}
   351â†’      >
   352â†’        <p className="text-sm leading-relaxed">{message.content}</p>
   353â†’
   354â†’        {/* ç»´åº¦å¼•ç”¨æ ‡ç­¾ */}
   355â†’        {message.dimensions_referenced?.length > 0 && (
   356â†’          <div className="flex gap-1 mt-2">
   357â†’            {message.dimensions_referenced.map((dim) => (
   358â†’              <span
   359â†’                key={dim}
   360â†’                className="text-xs px-2 py-0.5 rounded-full bg-white/10"
   361â†’              >
   362â†’                {DIMENSION_LABELS[dim]}
   363â†’              </span>
   364â†’            ))}
   365â†’          </div>
   366â†’        )}
   367â†’
   368â†’        {/* æƒ…ç»ªæŒ‡ç¤ºå™¨ */}
   369â†’        {message.emotional_state && (
   370â†’          <EmotionalIndicator state={message.emotional_state} />
   371â†’        )}
   372â†’      </div>
   373â†’    </div>
   374â†’  )
   375â†’}
   376â†’```
   377â†’
   378â†’---
   379â†’
   380â†’## 4. ç”Ÿæ´»äº‹ä»¶ç®¡ç†
   381â†’
   382â†’### 4.1 äº‹ä»¶é¡µé¢
   383â†’
   384â†’```tsx
   385â†’// app/events/page.tsx
   386â†’
   387â†’export default function EventsPage() {
   388â†’  const { events, createEvent } = useLifeEvents()
   389â†’  const [showCreate, setShowCreate] = useState(false)
   390â†’
   391â†’  return (
   392â†’    <div className="min-h-screen bg-slate-900 p-4">
   393â†’      <header className="flex justify-between items-center mb-6">
   394â†’        <h1 className="text-xl font-bold text-white">ç”Ÿæ´»äº‹ä»¶</h1>
   395â†’        <button
   396â†’          onClick={() => setShowCreate(true)}
   397â†’          className="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm"
   398â†’        >
   399â†’          æ·»åŠ äº‹ä»¶
   400â†’        </button>
   401â†’      </header>
   402â†’
   403â†’      {/* æ—¶é—´çº¿è§†å›¾ */}
   404â†’      <EventTimeline events={events} />
   405â†’
   406â†’      {/* åˆ›å»ºäº‹ä»¶å¼¹çª— */}
   407â†’      <CreateEventModal
   408â†’        isOpen={showCreate}
   409â†’        onClose={() => setShowCreate(false)}
   410â†’        onCreate={createEvent}
   411â†’      />
   412â†’    </div>
   413â†’  )
   414â†’}
   415â†’```
   416â†’
   417â†’### 4.2 äº‹ä»¶æ—¶é—´çº¿
   418â†’
   419â†’```tsx
   420â†’// components/events/EventTimeline.tsx
   421â†’
   422â†’export function EventTimeline({ events }: { events: LifeEvent[] }) {
   423â†’  const grouped = groupEventsByDate(events)
   424â†’
   425â†’  return (
   426â†’    <div className="space-y-6">
   427â†’      {Object.entries(grouped).map(([date, dayEvents]) => (
   428â†’        <div key={date}>
   429â†’          <div className="flex items-center gap-2 mb-3">
   430â†’            <div className="w-2 h-2 rounded-full bg-indigo-500" />
   431â†’            <span className="text-slate-400 text-sm">{formatDate(date)}</span>
   432â†’          </div>
   433â†’
   434â†’          <div className="ml-4 border-l border-slate-700 pl-4 space-y-3">
   435â†’            {dayEvents.map((event) => (
   436â†’              <EventCard key={event.id} event={event} />
   437â†’            ))}
   438â†’          </div>
   439â†’        </div>
   440â†’      ))}
   441â†’    </div>
   442â†’  )
   443â†’}
   444â†’
   445â†’function EventCard({ event }: { event: LifeEvent }) {
   446â†’  return (
   447â†’    <motion.div
   448â†’      className="bg-slate-800 rounded-lg p-4"
   449â†’      whileHover={{ scale: 1.02 }}
   450â†’    >
   451â†’      <div className="flex items-start justify-between">
   452â†’        <div>
   453â†’          <span className="text-xs text-indigo-400">
   454â†’            {EVENT_TYPE_LABELS[event.event_type]}
   455â†’          </span>
   456â†’          <h3 className="text-white font-medium mt-1">{event.title}</h3>
   457â†’          {event.description && (
   458â†’            <p className="text-slate-400 text-sm mt-1">{event.description}</p>
   459â†’          )}
   460â†’        </div>
   461â†’        <EventStatusBadge status={event.status} />
   462â†’      </div>
   463â†’
   464â†’      {/* AI å…³æ€€æ¶ˆæ¯ */}
   465â†’      {event.pre_event_message && (
   466â†’        <div className="mt-3 bg-slate-700/50 rounded-lg p-3">
   467â†’          <span className="text-xs text-slate-400">VibeLife è¯´</span>
   468â†’          <p className="text-white/80 text-sm mt-1">{event.pre_event_message}</p>
   469â†’        </div>
   470â†’      )}
   471â†’    </motion.div>
   472â†’  )
   473â†’}
   474â†’```
   475â†’
   476â†’---
   477â†’
   478â†’## 5. çŠ¶æ€ç®¡ç†å‡çº§
   479â†’
   480â†’### 5.1 å…¨å±€çŠ¶æ€ Store
   481â†’
   482â†’```tsx
   483â†’// stores/useVibeStore.ts
   484â†’
   485â†’import { create } from 'zustand'
   486â†’import { persist } from 'zustand/middleware'
   487â†’
   488â†’interface VibeState {
   489â†’  // ç”¨æˆ·
   490â†’  user: VibeUser | null
   491â†’  journeyStage: JourneyStage
   492â†’
   493â†’  // Identity Prism
   494â†’  prism: IdentityPrism | null
   495â†’  dimensions: DimensionProfile[]
   496â†’
   497â†’  // ä»ªå¼
   498â†’  todayRitual: DailyRitual | null
   499â†’
   500â†’  // è®°å¿†
   501â†’  recentMemories: Memory[]
   502â†’
   503â†’  // äº‹ä»¶
   504â†’  upcomingEvents: LifeEvent[]
   505â†’
   506â†’  // Actions
   507â†’  setUser: (user: VibeUser) => void
   508â†’  setPrism: (prism: IdentityPrism) => void
   509â†’  setTodayRitual: (ritual: DailyRitual) => void
   510â†’  addMemory: (memory: Memory) => void
   511â†’  addEvent: (event: LifeEvent) => void
   512â†’}
   513â†’
   514â†’export const useVibeStore = create<VibeState>()(
   515â†’  persist(
   516â†’    (set) => ({
   517â†’      user: null,
   518â†’      journeyStage: 'encounter',
   519â†’      prism: null,
   520â†’      dimensions: [],
   521â†’      todayRitual: null,
   522â†’      recentMemories: [],
   523â†’      upcomingEvents: [],
   524â†’
   525â†’      setUser: (user) => set({ user, journeyStage: user.journey_stage }),
   526â†’      setPrism: (prism) => set({ prism }),
   527â†’      setTodayRitual: (ritual) => set({ todayRitual: ritual }),
   528â†’      addMemory: (memory) =>
   529â†’        set((state) => ({
   530â†’          recentMemories: [memory, ...state.recentMemories].slice(0, 10)
   531â†’        })),
   532â†’      addEvent: (event) =>
   533â†’        set((state) => ({
   534â†’          upcomingEvents: [...state.upcomingEvents, event].sort(
   535â†’            (a, b) => new Date(a.event_date).getTime() - new Date(b.event_date).getTime()
   536â†’          )
   537â†’        }))
   538â†’    }),
   539â†’    { name: 'vibe-storage' }
   540â†’  )
   541â†’)
   542â†’```
   543â†’
   544â†’### 5.2 API Hooks
   545â†’
   546â†’```tsx
   547â†’// hooks/useIdentityPrism.ts
   548â†’
   549â†’export function useIdentityPrism() {
   550â†’  const { prism, dimensions, setPrism } = useVibeStore()
   551â†’
   552â†’  const { data, isLoading, error } = useSWR('/api/v1/identity/prism', fetcher, {
   553â†’    onSuccess: (data) => setPrism(data.prism)
   554â†’  })
   555â†’
   556â†’  const regenerate = async () => {
   557â†’    const result = await api.post('/api/v1/identity/prism/regenerate')
   558â†’    setPrism(result.prism)
   559â†’    return result
   560â†’  }
   561â†’
   562â†’  return {
   563â†’    prism: prism || data?.prism,
   564â†’    dimensions: dimensions || data?.dimensions || [],
   565â†’    isLoading,
   566â†’    error,
   567â†’    regenerate
   568â†’  }
   569â†’}
   570â†’
   571â†’// hooks/useTodayRitual.ts
   572â†’
   573â†’export function useTodayRitual() {
   574â†’  const { todayRitual, setTodayRitual } = useVibeStore()
   575â†’
   576â†’  const { data, isLoading } = useSWR('/api/v1/rituals/today', fetcher, {
   577â†’    onSuccess: (data) => setTodayRitual(data),
   578â†’    refreshInterval: 60000 // æ¯åˆ†é’Ÿåˆ·æ–°
   579â†’  })
   580â†’
   581â†’  const respondToMidday = async (response: string) => {
   582â†’    const result = await api.post('/api/v1/rituals/midday/respond', { response })
   583â†’    setTodayRitual(result.ritual)
   584â†’    return result
   585â†’  }
   586â†’
   587â†’  return {
   588â†’    ritual: todayRitual || data,
   589â†’    isLoading,
   590â†’    respondToMidday
   591â†’  }
   592â†’}
   593â†’```
   594â†’
   595â†’---
   596â†’
   597â†’## 6. æ¨é€é€šçŸ¥é›†æˆ
   598â†’
   599â†’### 6.1 Service Worker
   600â†’
   601â†’```typescript
   602â†’// public/sw.js
   603â†’
   604â†’self.addEventListener('push', (event) => {
   605â†’  const data = event.data.json()
   606â†’
   607â†’  const options = {
   608â†’    body: data.body,
   609â†’    icon: '/icons/vibe-icon-192.png',
   610â†’    badge: '/icons/vibe-badge.png',
   611â†’    tag: data.tag,
   612â†’    data: data.url,
   613â†’    actions: data.actions || []
   614â†’  }
   615â†’
   616â†’  event.waitUntil(
   617â†’    self.registration.showNotification(data.title, options)
   618â†’  )
   619â†’})
   620â†’
   621â†’self.addEventListener('notificationclick', (event) => {
   622â†’  event.notification.close()
   623â†’
   624â†’  if (event.action === 'respond') {
   625â†’    event.waitUntil(clients.openWindow('/chat'))
   626â†’  } else {
   627â†’    event.waitUntil(clients.openWindow(event.notification.data || '/'))
   628â†’  }
   629â†’})
   630â†’```
   631â†’
   632â†’### 6.2 æ¨é€è®¢é˜…
   633â†’
   634â†’```tsx
   635â†’// hooks/usePushNotifications.ts
   636â†’
   637â†’export function usePushNotifications() {
   638â†’  const [isSubscribed, setIsSubscribed] = useState(false)
   639â†’
   640â†’  const subscribe = async () => {
   641â†’    const registration = await navigator.serviceWorker.ready
   642â†’
   643â†’    const subscription = await registration.pushManager.subscribe({
   644â†’      userVisibleOnly: true,
   645â†’      applicationServerKey: process.env.NEXT_PUBLIC_VAPID_PUBLIC_KEY
   646â†’    })
   647â†’
   648â†’    await api.post('/api/v1/push/subscribe', {
   649â†’      subscription: subscription.toJSON()
   650â†’    })
   651â†’
   652â†’    setIsSubscribed(true)
   653â†’  }
   654â†’
   655â†’  const unsubscribe = async () => {
   656â†’    const registration = await navigator.serviceWorker.ready
   657â†’    const subscription = await registration.pushManager.getSubscription()
   658â†’
   659â†’    if (subscription) {
   660â†’      await subscription.unsubscribe()
   661â†’      await api.post('/api/v1/push/unsubscribe')
   662â†’    }
   663â†’
   664â†’    setIsSubscribed(false)
   665â†’  }
   666â†’
   667â†’  return { isSubscribed, subscribe, unsubscribe }
   668â†’}
   669â†’```
   670â†’
   671â†’---
   672â†’
   673â†’## 7. åŠ¨ç”»ä¸è¿‡æ¸¡
   674â†’
   675â†’### 7.1 é¡µé¢è¿‡æ¸¡
   676â†’
   677â†’```tsx
   678â†’// components/layout/PageTransition.tsx
   679â†’
   680â†’import { motion, AnimatePresence } from 'framer-motion'
   681â†’
   682â†’export function PageTransition({ children }: { children: React.ReactNode }) {
   683â†’  return (
   684â†’    <AnimatePresence mode="wait">
   685â†’      <motion.div
   686â†’        initial={{ opacity: 0, y: 10 }}
   687â†’        animate={{ opacity: 1, y: 0 }}
   688â†’        exit={{ opacity: 0, y: -10 }}
   689â†’        transition={{ duration: 0.2 }}
   690â†’      >
   691â†’        {children}
   692â†’      </motion.div>
   693â†’    </AnimatePresence>
   694â†’  )
   695â†’}
   696â†’```
   697â†’
   698â†’### 7.2 ä»ªå¼åŠ¨ç”»
   699â†’
   700â†’```tsx
   701â†’// components/ritual/RitualAnimation.tsx
   702â†’
   703â†’export function MorningOracleAnimation() {
   704â†’  return (
   705â†’    <motion.div
   706â†’      className="absolute inset-0 pointer-events-none"
   707â†’      initial={{ opacity: 0 }}
   708â†’      animate={{ opacity: 1 }}
   709â†’    >
   710â†’      {/* æ—¥å‡ºå…‰èŠ’æ•ˆæœ */}
   711â†’      <motion.div
   712â†’        className="absolute bottom-0 left-1/2 -translate-x-1/2 w-96 h-48 bg-gradient-radial from-amber-500/30 to-transparent"
   713â†’        animate={{
   714â†’          scale: [1, 1.2, 1],
   715â†’          opacity: [0.3, 0.5, 0.3]
   716â†’        }}
   717â†’        transition={{
   718â†’          duration: 4,
   719â†’          repeat: Infinity,
   720â†’          ease: 'easeInOut'
   721â†’        }}
   722â†’      />
   723â†’    </motion.div>
   724â†’  )
   725â†’}
   726â†’```
   727â†’
   728â†’---
   729â†’
   730â†’## 8. å®æ–½æ£€æŸ¥æ¸…å•
   731â†’
   732â†’- [ ] åˆ›å»º home é¡µé¢
   733â†’- [ ] å®ç° RitualCard ç»„ä»¶
   734â†’- [ ] åˆ›å»º identity é¡µé¢
   735â†’- [ ] å®ç° PrismVisualization ç»„ä»¶
   736â†’- [ ] é‡æ„ chat é¡µé¢
   737â†’- [ ] å®ç° ContextPanel ç»„ä»¶
   738â†’- [ ] åˆ›å»º events é¡µé¢
   739â†’- [ ] å®ç° EventTimeline ç»„ä»¶
   740â†’- [ ] å‡çº§ useVibeStore
   741â†’- [ ] å®ç° API hooks
   742â†’- [ ] é…ç½® Service Worker
   743â†’- [ ] å®ç°æ¨é€è®¢é˜…
   744â†’- [ ] æ·»åŠ é¡µé¢è¿‡æ¸¡åŠ¨ç”»
   745â†’- [ ] æ·»åŠ ä»ªå¼åŠ¨ç”»æ•ˆæœ
   746â†’
   747â†’---
   748â†’
   749â†’*ä¸‹ä¸€æ­¥: [05-è®¢é˜…ç³»ç»Ÿè®¾è®¡](./05-è®¢é˜…ç³»ç»Ÿè®¾è®¡.md)*
   750â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
