     1→"use client";
     2→
     3→import Link from "next/link";
     4→import { ArrowLeft, FileText, MessageSquare, LayoutDashboard, Settings } from "lucide-react";
     5→import { LuminousPaper, VibeGlyph, BreathAura, TransitionOverlay, type SkillType } from "@/components/core";
     6→import { IconButton } from "@/components/ui/Button";
     7→import { InsightPanel, MobileInsightBar, type InsightPanelProps } from "@/components/insight/InsightPanel";
     8→import { VoiceModeToggle, type VoiceMode } from "@/components/ui/VoiceModeToggle";
     9→import { useSkillTransition } from "@/providers/SkillProvider";
    10→import { cn } from "@/lib/utils";
    11→
    12→// ═══════════════════════════════════════════════════════════════════════════
    13→// ChatLayout - LUMINOUS PAPER Design System v7.1
    14→// 统一聊天页面布局（响应式断点）：
    15→// - PC ≥1024px: 双栏布局（左侧 Insight Panel + 右侧 Chat Stream）
    16→// - Tablet 768-1024px: 单栏布局 + Tab 导航 + 折叠 Insight Bar
    17→// - Mobile <768px: 单栏布局（可折叠顶部 Insight Bar + Chat Stream）
    18→// ═══════════════════════════════════════════════════════════════════════════
    19→
    20→export type { VoiceMode };
    21→
    22→interface ChatLayoutProps {
    23→  skill: SkillType;
    24→  title: string;
    25→  backHref: string;
    26→  onViewProfile?: () => void;
    27→  children: React.ReactNode;
    28→  // Insight panel props
    29→  profile?: InsightPanelProps["profile"];
    30→  insights?: InsightPanelProps["insights"];
    31→  onInsightClick?: InsightPanelProps["onInsightClick"];
    32→  // Tab navigation (optional)
    33→  activeTab?: "chat" | "chart" | "settings";
    34→  onTabChange?: (tab: "chat" | "chart" | "settings") => void;
    35→  // Voice mode
    36→  voiceMode?: VoiceMode;
    37→  onVoiceModeChange?: (mode: VoiceMode) => void;
    38→}
    39→
    40→const SKILL_CONFIG: Record<SkillType, { profileLabel: string; chartLabel: string }> = {
    41→  bazi: { profileLabel: "查看命盘", chartLabel: "命盘" },
    42→  zodiac: { profileLabel: "查看星盘", chartLabel: "星盘" },
    43→  mbti: { profileLabel: "查看档案", chartLabel: "档案" },
    44→  attach: { profileLabel: "查看档案", chartLabel: "档案" },
    45→  career: { profileLabel: "查看档案", chartLabel: "档案" },
    46→};
    47→
    48→export function ChatLayout({
    49→  skill,
    50→  title,
    51→  backHref,
    52→  onViewProfile,
    53→  children,
    54→  profile,
    55→  insights,
    56→  onInsightClick,
    57→  activeTab = "chat",
    58→  onTabChange,
    59→  voiceMode = "warm",
    60→  onVoiceModeChange,
    61→}: ChatLayoutProps) {
    62→  const config = SKILL_CONFIG[skill];
    63→  const { isTransitioning, pendingSkill } = useSkillTransition();
    64→
    65→  return (
    66→    <LuminousPaper skill={skill} variant="default" className="h-screen flex flex-col">
    67→      {/* Skill Transition Overlay */}
    68→      <TransitionOverlay
    69→        skill={pendingSkill || skill}
    70→        isActive={isTransitioning}
    71→        onComplete={() => {}}
    72→      />
    73→
    74→      {/* Background aura */}
    75→      <BreathAura skill={skill} size="xl" position="top" intensity="low" className="opacity-40" />
    76→
    77→      {/* Glass Header */}
    78→      <header className="nav">
    79→        <div className="nav-container">
    80→          {/* Left: Back + Logo + Title */}
    81→          <div className="flex items-center gap-3">
    82→            <Link href={backHref} className="nav-link flex items-center gap-1">
    83→              <ArrowLeft className="w-4 h-4" />
    84→              <span className="hidden sm:inline">返回</span>
    85→            </Link>
    86→            <div className="flex items-center gap-2">
    87→              <VibeGlyph size="sm" skill={skill} showAura={false} animate={false} />
    88→              <span className="font-serif font-semibold text-foreground">{title}</span>
    89→            </div>
    90→          </div>
    91→
    92→          {/* Center: Tab Navigation (Tablet+PC, ≥768px) */}
    93→          {onTabChange && (
    94→            <div className="hidden md:flex items-center gap-1 bg-muted/30 rounded-full p-1">
    95→              <button
    96→                onClick={() => onTabChange("chat")}
    97→                className={cn(
    98→                  "px-4 py-1.5 text-sm rounded-full transition-all duration-200",
    99→                  activeTab === "chat"
   100→                    ? "bg-card text-foreground shadow-sm"
   101→                    : "text-muted-foreground hover:text-foreground"
   102→                )}
   103→              >
   104→                <MessageSquare className="w-4 h-4 inline mr-1.5" />
   105→                对话
   106→              </button>
   107→              <button
   108→                onClick={() => onTabChange("chart")}
   109→                className={cn(
   110→                  "px-4 py-1.5 text-sm rounded-full transition-all duration-200",
   111→                  activeTab === "chart"
   112→                    ? "bg-card text-foreground shadow-sm"
   113→                    : "text-muted-foreground hover:text-foreground"
   114→                )}
   115→              >
   116→                <LayoutDashboard className="w-4 h-4 inline mr-1.5" />
   117→                {config.chartLabel}
   118→              </button>
   119→            </div>
   120→          )}
   121→
   122→          {/* Right: Voice Toggle + Profile Button */}
   123→          <div className="flex items-center gap-2">
   124→            {/* Voice Mode Toggle */}
   125→            {onVoiceModeChange && (
   126→              <VoiceModeToggle
   127→                value={voiceMode}
   128→                onChange={onVoiceModeChange}
   129→                size="sm"
   130→              />
   131→            )}
   132→            {onViewProfile && (
   133→              <IconButton
   134→                variant="ghost"
   135→                size="sm"
   136→                onClick={onViewProfile}
   137→                aria-label={config.profileLabel}
   138→              >
   139→                <FileText className="w-5 h-5" />
   140→              </IconButton>
   141→            )}
   142→          </div>
   143→        </div>
   144→      </header>
   145→
   146→      {/* Main Content - Responsive Layout */}
   147→      <div className="flex-1 overflow-hidden relative flex">
   148→        {/* Left Sidebar - Insight Panel (PC only, ≥1024px) */}
   149→        <aside className="hidden lg:block w-80 flex-shrink-0">
   150→          <InsightPanel
   151→            skill={skill}
   152→            profile={profile}
   153→            insights={insights}
   154→            onViewFullProfile={onViewProfile}
   155→            onInsightClick={onInsightClick}
   156→          />
   157→        </aside>
   158→
   159→        {/* Right Content - Chat Area */}
   160→        <div className="flex-1 flex flex-col min-w-0 overflow-hidden">
   161→          {/* Mobile/Tablet Insight Bar (<1024px) */}
   162→          <div className="lg:hidden">
   163→            <MobileInsightBar
   164→              skill={skill}
   165→              profile={profile}
   166→              onViewFullProfile={onViewProfile}
   167→            />
   168→          </div>
   169→
   170→          {/* Chat Content */}
   171→          <div className="flex-1 overflow-hidden">
   172→            {children}
   173→          </div>
   174→        </div>
   175→      </div>
   176→    </LuminousPaper>
   177→  );
   178→}
   179→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
