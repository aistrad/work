   500→    async def _generate_default(
   501→        self,
   502→        task: ReminderTask,
   503→        profile: Dict[str, Any],
   504→        config: Dict[str, Any],
   505→    ) -> ReminderContent:
   506→        """默认内容生成器"""
   507→        return ReminderContent(
   508→            title=config.get("name", "通知"),
   509→            body=config.get("description", "您有一条新消息"),
   510→            data={},
   511→        )
   512→
   513→    # ═══════════════════════════════════════════════════════════════════════════
   514→    # LLM 内容生成
   515→    # ═══════════════════════════════════════════════════════════════════════════
   516→
   517→    async def _generate_with_llm(
   518→        self,
   519→        template_type: str,
   520→        context: Dict[str, Any],
   521→        voice_mode: str = "warm",
   522→    ) -> Dict[str, Any]:
   523→        """使用 LLM 生成个性化内容"""
   524→        import json
   525→        from services.llm import create_system_message, create_user_message
   526→
   527→        # 构建 prompt
   528→        system_prompt = self._get_system_prompt(template_type, voice_mode)
   529→        user_prompt = self._get_user_prompt(template_type, context)
   530→
   531→        try:
   532→            messages = [
   533→                create_system_message(system_prompt),
   534→                create_user_message(user_prompt),
   535→            ]
   536→            response = await self.llm_service.chat(messages=messages)
   537→
   538→            # 解析 JSON 响应
   539→            content = response.content.strip()
   540→            # 处理可能的 markdown 代码块
   541→            if content.startswith("```json"):
   542→                content = content[7:]
   543→            if content.startswith("```"):
   544→                content = content[3:]
   545→            if content.endswith("```"):
   546→                content = content[:-3]
   547→
   548→            return json.loads(content.strip())
   549→        except Exception as e:
   550→            logger.error(f"LLM generation failed: {e}")
   551→            # 返回默认内容
   552→            return self._get_fallback_content(template_type, context)
   553→
   554→    def _get_system_prompt(self, template_type: str, voice_mode: str) -> str:
   555→        """获取系统提示词"""
   556→        voice_styles = {
   557→            "warm": "你是 Vibe，一个温暖、共情、支持的 AI 知己。用温暖的语气与用户交流。",
   558→            "sarcastic": "你是 Vibe，一个直接、犀利但有趣的 AI 损友。用幽默的方式给出建议。",
   559→            "wise": "你是 Vibe，一个理性、深度、像长辈一样的 AI 导师。用睿智的方式指点迷津。",
   560→        }
   561→
   562→        base_prompt = voice_styles.get(voice_mode, voice_styles["warm"])
   563→
   564→        if template_type == "daily_fortune":
   565→            return f"""{base_prompt}
   566→
   567→现在要为用户生成一条个性化的每日运势提醒。
   568→
   569→输出 JSON 格式：
   570→{{
   571→    "greeting": "问候语（不超过50字）",
   572→    "fortune_hint": "今日运势提示（不超过30字）",
   573→    "action_tip": "具体可执行的建议（不超过30字）"
   574→}}"""
   575→
   576→        return base_prompt
   577→
   578→    def _get_user_prompt(self, template_type: str, context: Dict[str, Any]) -> str:
   579→        """获取用户提示词"""
   580→        if template_type == "daily_fortune":
   581→            concerns = context.get("concerns", [])
   582→            goals = context.get("goals", [])
   583→            concerns_str = "、".join(concerns) if concerns else "无特别关注"
   584→            goals_str = "、".join(goals) if goals else "无特别目标"
   585→
   586→            return f"""为用户生成今日问候：
   587→- 日期：{context.get('date', '')}
   588→- 日主元素：{context.get('day_master_element', 'wood')}
   589→- 今日运势分数：{context.get('daily_fortune', {}).get('score', 60)}
   590→- 用户关注：{concerns_str}
   591→- 用户目标：{goals_str}"""
   592→
   593→        return str(context)
   594→
   595→    def _get_fallback_content(self, template_type: str, context: Dict[str, Any]) -> Dict[str, Any]:
   596→        """获取降级内容"""
   597→        if template_type == "daily_fortune":
   598→            return {
   599→                "greeting": "新的一天，新的开始！愿今天一切顺利。",

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
