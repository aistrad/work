The file /home/aiscend/work/vibelife/apps/api/services/proactive/engine.py has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
   241→            logger.error(f"Failed to get users: {e}")
   242→
   243→        return users
   244→
   245→    async def _should_send_to_user(
   246→        self,
   247→        user_id: UUID,
   248→        skill_id: str,
   249→    ) -> bool:
   250→        """
   251→        检查是否应该发送推送
   252→
   253→        基于 Skill 订阅状态决定：
   254→        - Core Skill: 始终发送
   255→        - Default Skill: 未取消订阅且 push_enabled 时发送
   256→        - Professional Skill: 已订阅且 push_enabled 时发送
   257→        """
   258→        # 获取 Skill 元数据
   259→        skill_meta = load_skill_metadata(skill_id)
   260→        category = skill_meta.category if skill_meta else "professional"
   261→
   262→        # Core Skill 始终发送
   263→        if category == "core":
   264→            return True
   265→
   266→        # 获取用户订阅状态
   267→        subscription = await SkillSubscriptionRepository.get(user_id, skill_id)
   268→
   269→        # Default Skill: 检查取消订阅和推送开关
   270→        if category == "default":
   271→            if subscription and subscription.status == "unsubscribed":
   272→                return False
   273→            if subscription and not subscription.push_enabled:
   274→                return False
   275→            return True
   276→
   277→        # Professional Skill: 需要有效订阅且开启推送
   278→        if not subscription or subscription.status != "subscribed":
   279→            return False
   280→
   281→        return subscription.push_enabled
   282→
   283→    async def _detect_user_triggers(self, user: Dict[str, Any]) -> List[ReminderTask]:
   284→        """检测用户的所有触发条件 - 集成订阅检查"""
   285→        tasks = []
   286→        user_id = user["user_id"]
   287→        profile = user["profile"]
   288→
   289→        # 遍历所有 Skill 配置
   290→        for skill_id, config in self._skill_configs.items():
   291→            # 支持新旧配置格式: reminders (新) / reminder_types (旧)
   292→            reminders = config.get("reminders") or config.get("reminder_types", [])
   293→                trigger_config = reminder.get("trigger", {})
   294→
   295→                try:
   296→                    # 检测触发条件