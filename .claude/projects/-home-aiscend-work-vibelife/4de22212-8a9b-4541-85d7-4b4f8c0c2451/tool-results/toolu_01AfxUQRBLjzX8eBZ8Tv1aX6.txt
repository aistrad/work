     1â†’Proactive + Skill Management æ•´åˆä¼˜åŒ–æ–¹æ¡ˆ                                                                                                    
     2â†’                                                                                                                                               
     3â†’  ç°çŠ¶åˆ†æ                                                                                                                                     
     4â†’                                                                                                                                               
     5â†’  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                              
     6â†’  â”‚                         å½“å‰æ¶æ„ vs ç›®æ ‡æ¶æ„                                  â”‚                                                            
     7â†’  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                              
     8â†’  â”‚                                                                              â”‚                                                             
     9â†’  â”‚  å½“å‰ Proactive                         ç›®æ ‡æ¶æ„                             â”‚                                                             
    10â†’  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚                                                             
    11â†’  â”‚  â€¢ reminders.yaml ç‹¬ç«‹å®šä¹‰              â€¢ ç»Ÿä¸€åˆ° SKILL.md metadata           â”‚                                                             
    12â†’  â”‚  â€¢ åªæœ‰ bazi æœ‰é…ç½®                     â€¢ æ‰€æœ‰ Skill ç»Ÿä¸€é…ç½®                 â”‚                                                            
    13â†’  â”‚  â€¢ ä¸æ£€æŸ¥è®¢é˜…çŠ¶æ€                       â€¢ æ£€æŸ¥ user_skill_subscriptions       â”‚                                                            
    14â†’  â”‚  â€¢ ContentGenerator ç¡¬ç¼–ç               â€¢ å¤ç”¨ Skill rules/ + CoreAgent       â”‚                                                            
    15â†’  â”‚  â€¢ åªå­˜ DBï¼Œå‰ç«¯æ‹‰å–                    â€¢ æ”¯æŒå®æ—¶æ¨é€ + å¯¹è¯å¼•å¯¼             â”‚                                                            
    16â†’  â”‚                                                                              â”‚                                                             
    17â†’  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                              
    18â†’                                                                                                                                               
    19â†’  ä¼˜åŒ–æ–¹æ¡ˆ                                                                                                                                     
    20â†’                                                                                                                                               
    21â†’  1. ç»Ÿä¸€ Proactive é…ç½®åˆ° SKILL.md                                                                                                            
    22â†’                                                                                                                                               
    23â†’  å½“å‰: reminders.yaml ç‹¬ç«‹æ–‡ä»¶                                                                                                                
    24â†’  ä¼˜åŒ–: åˆå¹¶åˆ° SKILL.md çš„ metadata                                                                                                            
    25â†’                                                                                                                                               
    26â†’  # apps/api/skills/bazi/SKILL.md frontmatter æ‰©å±•                                                                                             
    27â†’  ---                                                                                                                                          
    28â†’  id: bazi                                                                                                                                     
    29â†’  name: å…«å­—å‘½ç†                                                                                                                               
    30â†’  category: professional                                                                                                                       
    31â†’  pricing:                                                                                                                                     
    32â†’    type: premium                                                                                                                              
    33â†’    trial_messages: 3                                                                                                                          
    34â†’                                                                                                                                               
    35â†’  # æ–°å¢: Proactive é…ç½® (åŸ reminders.yaml)                                                                                                   
    36â†’  proactive:                                                                                                                                   
    37â†’    enabled: true                                                                                                                              
    38â†’    reminders:                                                                                                                                 
    39â†’      - id: daily_fortune                                                                                                                      
    40â†’        name: æ¯æ—¥è¿åŠ¿                                                                                                                         
    41â†’        trigger:                                                                                                                               
    42â†’          type: time_based                                                                                                                     
    43â†’          schedule: "0 4 * * *"                                                                                                                
    44â†’        content:                                                                                                                               
    45â†’          generator: rules/daily-fortune.md  # å¤ç”¨ rules/ æ¶æ„!                                                                               
    46â†’          card_type: DailyFortuneCard                                                                                                          
    47â†’        priority: medium                                                                                                                       
    48â†’                                                                                                                                               
    49â†’      - id: dayun_transition                                                                                                                   
    50â†’        name: å¤§è¿äº¤æ¥                                                                                                                         
    51â†’        trigger:                                                                                                                               
    52â†’          type: event_based                                                                                                                    
    53â†’          event: dayun_change                                                                                                                  
    54â†’          advance_days: [30, 7, 0]                                                                                                             
    55â†’        content:                                                                                                                               
    56â†’          generator: rules/dayun-transition.md                                                                                                 
    57â†’          card_type: InsightCard                                                                                                               
    58â†’        priority: high                                                                                                                         
    59â†’                                                                                                                                               
    60â†’      - id: fortune_alert                                                                                                                      
    61â†’        name: è¿åŠ¿é¢„è­¦                                                                                                                         
    62â†’        trigger:                                                                                                                               
    63â†’          type: threshold_based                                                                                                                
    64â†’          metric: daily_fortune_score                                                                                                          
    65â†’          condition: "<"                                                                                                                       
    66â†’          threshold: 40                                                                                                                        
    67â†’          cooldown_days: 7                                                                                                                     
    68â†’        content:                                                                                                                               
    69â†’          generator: rules/fortune-alert.md                                                                                                    
    70â†’        priority: medium                                                                                                                       
    71â†’                                                                                                                                               
    72â†’  subscription:                                                                                                                                
    73â†’    can_unsubscribe: true                                                                                                                      
    74â†’    push_default: true                                                                                                                         
    75â†’  ---                                                                                                                                          
    76â†’                                                                                                                                               
    77â†’  2. ContentGenerator å¤ç”¨ Skill Rules                                                                                                         
    78â†’                                                                                                                                               
    79â†’  å½“å‰: ç¡¬ç¼–ç çš„å†…å®¹ç”Ÿæˆå‡½æ•°                                                                                                                   
    80â†’  ä¼˜åŒ–: å¤ç”¨ rules/*.md + CoreAgent èƒ½åŠ›                                                                                                       
    81â†’                                                                                                                                               
    82â†’  # services/proactive/content_generator.py é‡æ„                                                                                               
    83â†’                                                                                                                                               
    84â†’  class ContentGenerator:                                                                                                                      
    85â†’      """å¤ç”¨ Skill Rules çš„å†…å®¹ç”Ÿæˆå™¨"""                                                                                                      
    86â†’                                                                                                                                               
    87â†’      async def generate(                                                                                                                      
    88â†’          self,                                                                                                                                
    89â†’          task: ReminderTask,                                                                                                                  
    90â†’          profile: Dict[str, Any],                                                                                                             
    91â†’          config: Dict[str, Any],                                                                                                              
    92â†’      ) -> ReminderContent:                                                                                                                    
    93â†’          """                                                                                                                                  
    94â†’          æµç¨‹:                                                                                                                                
    95â†’          1. åŠ è½½ content.generator æŒ‡å®šçš„ rule æ–‡ä»¶                                                                                           
    96â†’          2. ä½¿ç”¨ rule ä¸­çš„åˆ†æè¦ç‚¹å’Œæ£€ç´¢ Query                                                                                                
    97â†’          3. è°ƒç”¨ LLM ç”Ÿæˆä¸ªæ€§åŒ–å†…å®¹                                                                                                           
    98â†’          4. è¿”å›ç»“æ„åŒ–å†…å®¹                                                                                                                    
    99â†’          """                                                                                                                                  
   100â†’          skill_id = task.skill_id                                                                                                             
   101â†’          generator_path = config.get("content", {}).get("generator", "")                                                                      
   102â†’                                                                                                                                               
   103â†’          # å¦‚æœæŒ‡å®šäº† rule æ–‡ä»¶ï¼ŒåŠ è½½å¹¶ä½¿ç”¨                                                                                                   
   104â†’          if generator_path.startswith("rules/"):                                                                                              
   105â†’              rule_content = await self._load_rule(skill_id, generator_path)                                                                   
   106â†’              return await self._generate_from_rule(                                                                                           
   107â†’                  task=task,                                                                                                                   
   108â†’                  profile=profile,                                                                                                             
   109â†’                  rule=rule_content,                                                                                                           
   110â†’                  card_type=config.get("content", {}).get("card_type"),                                                                        
   111â†’              )                                                                                                                                
   112â†’                                                                                                                                               
   113â†’          # é™çº§åˆ°é»˜è®¤ç”Ÿæˆå™¨                                                                                                                   
   114â†’          return await self._generate_default(task, profile, config)                                                                           
   115â†’                                                                                                                                               
   116â†’      async def _generate_from_rule(                                                                                                           
   117â†’          self,                                                                                                                                
   118â†’          task: ReminderTask,                                                                                                                  
   119â†’          profile: Dict[str, Any],                                                                                                             
   120â†’          rule: str,                                                                                                                           
   121â†’          card_type: Optional[str],                                                                                                            
   122â†’      ) -> ReminderContent:                                                                                                                    
   123â†’          """åŸºäº Rule ç”Ÿæˆå†…å®¹"""                                                                                                             
   124â†’          # 1. è§£æ rule ä¸­çš„åˆ†æè¦ç‚¹                                                                                                          
   125â†’          analysis_points = self._extract_analysis_points(rule)                                                                                
   126â†’                                                                                                                                               
   127â†’          # 2. æ‰§è¡ŒçŸ¥è¯†æ£€ç´¢                                                                                                                    
   128â†’          knowledge_context = []                                                                                                               
   129â†’          for point in analysis_points:                                                                                                        
   130â†’              if point.get("search_query"):                                                                                                    
   131â†’                  results = await search_db(                                                                                                   
   132â†’                      table="knowledge_chunks",                                                                                                
   133â†’                      query=point["search_query"],                                                                                             
   134â†’                      skill_id=task.skill_id,                                                                                                  
   135â†’                      top_k=3,                                                                                                                 
   136â†’                  )                                                                                                                            
   137â†’                  knowledge_context.extend(results)                                                                                            
   138â†’                                                                                                                                               
   139â†’          # 3. æ„å»º prompt å¹¶ç”Ÿæˆ                                                                                                              
   140â†’          return await self._generate_with_context(                                                                                            
   141â†’              task=task,                                                                                                                       
   142â†’              profile=profile,                                                                                                                 
   143â†’              rule=rule,                                                                                                                       
   144â†’              knowledge_context=knowledge_context,                                                                                             
   145â†’              card_type=card_type,                                                                                                             
   146â†’          )                                                                                                                                    
   147â†’                                                                                                                                               
   148â†’  3. ä¸ Skill Subscription é›†æˆ                                                                                                                
   149â†’                                                                                                                                               
   150â†’  å½“å‰: ä¸æ£€æŸ¥è®¢é˜…çŠ¶æ€                                                                                                                         
   151â†’  ä¼˜åŒ–: å®Œå…¨é›†æˆ user_skill_subscriptions                                                                                                      
   152â†’                                                                                                                                               
   153â†’  # services/proactive/engine.py æ‰©å±•                                                                                                          
   154â†’                                                                                                                                               
   155â†’  class ProactiveEngine:                                                                                                                       
   156â†’                                                                                                                                               
   157â†’      async def _should_send_to_user(                                                                                                          
   158â†’          self,                                                                                                                                
   159â†’          user_id: UUID,                                                                                                                       
   160â†’          skill_id: str,                                                                                                                       
   161â†’          reminder_id: str,                                                                                                                    
   162â†’      ) -> bool:                                                                                                                               
   163â†’          """æ£€æŸ¥æ˜¯å¦åº”è¯¥å‘é€æ¨é€"""                                                                                                           
   164â†’                                                                                                                                               
   165â†’          # 1. è·å– Skill å…ƒæ•°æ®                                                                                                               
   166â†’          skill_meta = self._skill_metadata.get(skill_id, {})                                                                                  
   167â†’          category = skill_meta.get("category", "professional")                                                                                
   168â†’                                                                                                                                               
   169â†’          # 2. Core Skill å§‹ç»ˆå‘é€                                                                                                             
   170â†’          if category == "core":                                                                                                               
   171â†’              return True                                                                                                                      
   172â†’                                                                                                                                               
   173â†’          # 3. è·å–ç”¨æˆ·è®¢é˜…çŠ¶æ€                                                                                                                
   174â†’          subscription = await SkillSubscriptionRepo.get(user_id, skill_id)                                                                    
   175â†’                                                                                                                                               
   176â†’          # 4. Default Skill æ£€æŸ¥å–æ¶ˆå’Œæ¨é€å¼€å…³                                                                                                
   177â†’          if category == "default":                                                                                                            
   178â†’              if subscription and subscription.status == "unsubscribed":                                                                       
   179â†’                  return False                                                                                                                 
   180â†’              if subscription and not subscription.push_enabled:                                                                               
   181â†’                  return False                                                                                                                 
   182â†’              return True                                                                                                                      
   183â†’                                                                                                                                               
   184â†’          # 5. Professional Skill éœ€è¦è®¢é˜…                                                                                                     
   185â†’          if not subscription or subscription.status != "subscribed":                                                                          
   186â†’              return False                                                                                                                     
   187â†’                                                                                                                                               
   188â†’          return subscription.push_enabled                                                                                                     
   189â†’                                                                                                                                               
   190â†’      async def _detect_user_triggers(self, user: Dict[str, Any]) -> List[ReminderTask]:                                                       
   191â†’          """æ£€æµ‹ç”¨æˆ·è§¦å‘æ¡ä»¶ - é›†æˆè®¢é˜…æ£€æŸ¥"""                                                                                                
   192â†’          tasks = []                                                                                                                           
   193â†’          user_id = user["user_id"]                                                                                                            
   194â†’          profile = user["profile"]                                                                                                            
   195â†’                                                                                                                                               
   196â†’          for skill_id, meta in self._skill_metadata.items():                                                                                  
   197â†’              proactive_config = meta.get("proactive", {})                                                                                     
   198â†’              if not proactive_config.get("enabled", False):                                                                                   
   199â†’                  continue                                                                                                                     
   200â†’                                                                                                                                               
   201â†’              for reminder in proactive_config.get("reminders", []):                                                                           
   202â†’                  # å…ˆæ£€æŸ¥è®¢é˜…çŠ¶æ€ (é¿å…æ— è°“çš„è§¦å‘æ£€æµ‹)                                                                                        
   203â†’                  if not await self._should_send_to_user(user_id, skill_id, reminder["id"]):                                                   
   204â†’                      continue                                                                                                                 
   205â†’                                                                                                                                               
   206â†’                  # æ£€æµ‹è§¦å‘æ¡ä»¶                                                                                                               
   207â†’                  should_trigger, event_info = await self.trigger_detector.should_trigger(                                                     
   208â†’                      trigger_config=reminder.get("trigger", {}),                                                                              
   209â†’                      profile=profile,                                                                                                         
   210â†’                      skill_id=skill_id,                                                                                                       
   211â†’                  )                                                                                                                            
   212â†’                                                                                                                                               
   213â†’                  if should_trigger:                                                                                                           
   214â†’                      tasks.append(ReminderTask(                                                                                               
   215â†’                          user_id=user_id,                                                                                                     
   216â†’                          skill_id=skill_id,                                                                                                   
   217â†’                          reminder_type=reminder["id"],                                                                                        
   218â†’                          priority=ReminderPriority(reminder.get("priority", "medium")),                                                       
   219â†’                          trigger_event=event_info.get("event_name") if event_info else None,                                                  
   220â†’                          trigger_date=event_info.get("event_date") if event_info else date.today(),                                           
   221â†’                          metadata={                                                                                                           
   222â†’                              "config": reminder,                                                                                              
   223â†’                              "event_info": event_info,                                                                                        
   224â†’                          },                                                                                                                   
   225â†’                      ))                                                                                                                       
   226â†’                                                                                                                                               
   227â†’          return tasks                                                                                                                         
   228â†’                                                                                                                                               
   229â†’  4. å‰ç«¯æ•´åˆè®¾è®¡                                                                                                                              
   230â†’                                                                                                                                               
   231â†’  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                              
   232â†’  â”‚                      å‰ç«¯å±•ç¤ºå±‚ä¼˜åŒ–                                          â”‚                                                             
   233â†’  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                              
   234â†’  â”‚                                                                              â”‚                                                             
   235â†’  â”‚  å…¥å£ 1: æ¨é€é€šçŸ¥                                                            â”‚                                                             
   236â†’  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚                                                             
   237â†’  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                                                              
   238â†’  â”‚  â”‚ ğŸ”® å…«å­—å‘½ç† Â· ä»Šæ—¥è¿åŠ¿                                   9:00 AM â”‚        â”‚                                                             
   239â†’  â”‚  â”‚                                                                  â”‚        â”‚                                                             
   240â†’  â”‚  â”‚ ç”²æœ¨æ—¥ä¸»ï¼Œä»Šæ—¥æˆŠåœŸå½“ä»¤ï¼Œé€‚åˆç¨³æ‰ç¨³æ‰“ã€‚                           â”‚        â”‚                                                             
   241â†’  â”‚  â”‚                                                                  â”‚        â”‚                                                             
   242â†’  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚        â”‚                                                              
   243â†’  â”‚  â”‚ â”‚   æŸ¥çœ‹è¯¦æƒ…       â”‚  â”‚   å¼€å§‹å¯¹è¯       â”‚  â† ç‚¹å‡»ç›´æ¥è¿›å…¥èŠå¤©   â”‚        â”‚                                                             
   244â†’  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚        â”‚                                                              
   245â†’  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                                                              
   246â†’  â”‚                                                                              â”‚                                                             
   247â†’  â”‚  å…¥å£ 2: èŠå¤©é¡µé¢é¡¶éƒ¨                                                        â”‚                                                             
   248â†’  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                           â”‚                                                             
   249â†’  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                                                              
   250â†’  â”‚  â”‚ DailyGreeting ç»„ä»¶ (å·²æœ‰)                                        â”‚        â”‚                                                             
   251â†’  â”‚  â”‚ + æ–°å¢: ç‚¹å‡»å±•å¼€è¯¦æƒ… â†’ è§¦å‘ use_skill â†’ è‡ªåŠ¨è¿›å…¥å¯¹è¯             â”‚        â”‚                                                             
   252â†’  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                                                              
   253â†’  â”‚                                                                              â”‚                                                             
   254â†’  â”‚  å…¥å£ 3: è®¾ç½®é¡µé¢ Skill ç®¡ç†                                                 â”‚                                                             
   255â†’  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚                                                             
   256â†’  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                                                              
   257â†’  â”‚  â”‚ ğŸ”® å…«å­—å‘½ç†                                             [â—]      â”‚        â”‚                                                             
   258â†’  â”‚  â”‚ å·²è®¢é˜…                                                          â”‚        â”‚                                                              
   259â†’  â”‚  â”‚                                                                  â”‚        â”‚                                                             
   260â†’  â”‚  â”‚ æ¨é€è®¾ç½®:                                                        â”‚        â”‚                                                             
   261â†’  â”‚  â”‚   [â—] æ¯æ—¥è¿åŠ¿  (æ¯å¤©æ—©ä¸Š4ç‚¹)                                    â”‚        â”‚                                                             
   262â†’  â”‚  â”‚   [â—] å¤§è¿æé†’  (é‡è¦èŠ‚ç‚¹å‰æé†’)                                 â”‚        â”‚                                                             
   263â†’  â”‚  â”‚   [â—‹] è¿åŠ¿é¢„è­¦  (è¿åŠ¿ä½äº40åˆ†æ—¶)                                 â”‚        â”‚                                                             
   264â†’  â”‚  â”‚                                                                  â”‚        â”‚                                                             
   265â†’  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚        â”‚                                                              
   266â†’  â”‚  â”‚ â”‚                  å–æ¶ˆè®¢é˜…                                â”‚     â”‚        â”‚                                                             
   267â†’  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚        â”‚                                                              
   268â†’  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                                                              
   269â†’  â”‚                                                                              â”‚                                                             
   270â†’  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                              
   271â†’                                                                                                                                               
   272â†’  5. æ–°å¢: Proactive â†’ å¯¹è¯å¼•å¯¼                                                                                                                
   273â†’                                                                                                                                               
   274â†’  // æ¨é€é€šçŸ¥æ•°æ®ç»“æ„æ‰©å±•                                                                                                                      
   275â†’  interface ProactiveNotification {                                                                                                            
   276â†’    id: string;                                                                                                                                
   277â†’    skill_id: string;                                                                                                                          
   278â†’    reminder_type: string;                                                                                                                     
   279â†’    title: string;                                                                                                                             
   280â†’    content: {                                                                                                                                 
   281â†’      body: string;                                                                                                                            
   282â†’      fortune_hint?: string;                                                                                                                   
   283â†’      action_tip?: string;                                                                                                                     
   284â†’      // æ–°å¢: å¯¹è¯å¼•å¯¼                                                                                                                        
   285â†’      suggested_prompt?: string;  // "æƒ³äº†è§£ä»Šå¤©é€‚åˆåšä»€ä¹ˆï¼Ÿ"                                                                                  
   286â†’      quick_actions?: Array<{                                                                                                                  
   287â†’        label: string;                                                                                                                         
   288â†’        prompt: string;  // ç‚¹å‡»åå‘é€çš„æ¶ˆæ¯                                                                                                   
   289â†’      }>;                                                                                                                                      
   290â†’    };                                                                                                                                         
   291â†’    card_type?: string;                                                                                                                        
   292â†’    created_at: string;                                                                                                                        
   293â†’  }                                                                                                                                            
   294â†’                                                                                                                                               
   295â†’  // å‰ç«¯å¤„ç†                                                                                                                                  
   296â†’  function NotificationCard({ notification }: { notification: ProactiveNotification }) {                                                       
   297â†’    const { startChat } = useChat();                                                                                                           
   298â†’                                                                                                                                               
   299â†’    const handleStartChat = (prompt: string) => {                                                                                              
   300â†’      // 1. åˆ‡æ¢åˆ°å¯¹åº” Skill                                                                                                                   
   301â†’      // 2. å‘é€é¢„è®¾ prompt                                                                                                                    
   302â†’      startChat({                                                                                                                              
   303â†’        skill: notification.skill_id,                                                                                                          
   304â†’        initialMessage: prompt,                                                                                                                
   305â†’      });                                                                                                                                      
   306â†’    };                                                                                                                                         
   307â†’                                                                                                                                               
   308â†’    return (                                                                                                                                   
   309â†’      <Card>                                                                                                                                   
   310â†’        <CardHeader>                                                                                                                           
   311â†’          <SkillIcon skillId={notification.skill_id} />                                                                                        
   312â†’          <span>{notification.title}</span>                                                                                                    
   313â†’        </CardHeader>                                                                                                                          
   314â†’        <CardBody>                                                                                                                             
   315â†’          <p>{notification.content.body}</p>                                                                                                   
   316â†’          {notification.content.quick_actions && (                                                                                             
   317â†’            <div className="quick-actions">                                                                                                    
   318â†’              {notification.content.quick_actions.map(action => (                                                                              
   319â†’                <Button                                                                                                                        
   320â†’                  key={action.label}                                                                                                           
   321â†’                  onClick={() => handleStartChat(action.prompt)}                                                                               
   322â†’                >                                                                                                                              
   323â†’                  {action.label}                                                                                                               
   324â†’                </Button>                                                                                                                      
   325â†’              ))}                                                                                                                              
   326â†’            </div>                                                                                                                             
   327â†’          )}                                                                                                                                   
   328â†’        </CardBody>                                                                                                                            
   329â†’      </Card>                                                                                                                                  
   330â†’    );                                                                                                                                         
   331â†’  }                                                                                                                                            
   332â†’                                                                                                                                               
   333â†’  ---                                                                                                                                          
   334â†’  ç›®å½•ç»“æ„å˜æ›´                                                                                                                                 
   335â†’                                                                                                                                               
   336â†’  apps/api/                                                                                                                                    
   337â†’  â”œâ”€â”€ skills/{skill_id}/                                                                                                                       
   338â†’  â”‚   â”œâ”€â”€ SKILL.md                    # åŒ…å« proactive é…ç½®                                                                                    
   339â†’  â”‚   â”œâ”€â”€ rules/                                                                                                                               
   340â†’  â”‚   â”‚   â”œâ”€â”€ daily-fortune.md        # å¤ç”¨ä¸ºæ¨é€å†…å®¹ç”Ÿæˆè§„åˆ™                                                                                 
   341â†’  â”‚   â”‚   â””â”€â”€ ...                                                                                                                              
   342â†’  â”‚   â””â”€â”€ tools/                                                                                                                               
   343â†’  â”‚                                                                                                                                            
   344â†’  â”œâ”€â”€ services/                                                                                                                                
   345â†’  â”‚   â”œâ”€â”€ proactive/                                                                                                                           
   346â†’  â”‚   â”‚   â”œâ”€â”€ engine.py               # é›†æˆ Skill Subscription                                                                                
   347â†’  â”‚   â”‚   â”œâ”€â”€ trigger_detector.py     # ä¸å˜                                                                                                   
   348â†’  â”‚   â”‚   â””â”€â”€ content_generator.py    # å¤ç”¨ rules/ æ¶æ„                                                                                       
   349â†’  â”‚   â”‚                                                                                                                                        
   350â†’  â”‚   â””â”€â”€ skill/                                                                                                                               
   351â†’  â”‚       â”œâ”€â”€ subscription_repo.py    # æ–°å»º                                                                                                   
   352â†’  â”‚       â””â”€â”€ recommendation.py       # æ–°å»º                                                                                                   
   353â†’                                                                                                                                               
   354â†’  apps/web/                                                                                                                                    
   355â†’  â”œâ”€â”€ components/                                                                                                                              
   356â†’  â”‚   â””â”€â”€ skill/                                                                                                                               
   357â†’  â”‚       â”œâ”€â”€ SkillCard.tsx           # Skill Management ç»„ä»¶                                                                                  
   358â†’  â”‚       â””â”€â”€ SkillPushSettings.tsx   # æ¨é€å¼€å…³ç»†åˆ†æ§åˆ¶                                                                                       
   359â†’  â”‚                                                                                                                                            
   360â†’  â””â”€â”€ app/                                                                                                                                     
   361â†’      â””â”€â”€ settings/                                                                                                                            
   362â†’          â””â”€â”€ skill-management/       # Skill ç®¡ç†é¡µé¢                                                                                         
   363â†’                                                                                                                                               
   364â†’  ---                                                                                                                                          
   365â†’  å®æ–½ä¼˜å…ˆçº§å»ºè®®                                                                                                                               
   366â†’  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”                                                                                 
   367â†’  â”‚ é˜¶æ®µ â”‚               å†…å®¹                â”‚ å¤æ‚åº¦ â”‚ ä»·å€¼ â”‚                                                                                 
   368â†’  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤                                                                                 
   369â†’  â”‚ P0   â”‚ Skill Subscription æ•°æ®æ¨¡å‹ + API â”‚ ä½     â”‚ é«˜   â”‚                                                                                 
   370â†’  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤                                                                                 
   371â†’  â”‚ P1   â”‚ ProactiveEngine é›†æˆè®¢é˜…æ£€æŸ¥      â”‚ ä¸­     â”‚ é«˜   â”‚                                                                                 
   372â†’  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤                                                                                 
   373â†’  â”‚ P2   â”‚ è®¾ç½®é¡µé¢æ¨é€å¼€å…³ UI               â”‚ ä½     â”‚ é«˜   â”‚                                                                                 
   374â†’  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤                                                                                 
   375â†’  â”‚ P3   â”‚ ContentGenerator å¤ç”¨ rules/      â”‚ é«˜     â”‚ ä¸­   â”‚                                                                                 
   376â†’  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤                                                                                 
   377â†’  â”‚ P4   â”‚ æ¨é€ â†’ å¯¹è¯å¼•å¯¼                   â”‚ ä¸­     â”‚ é«˜   â”‚                                                                                 
   378â†’  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤                                                                                 
   379â†’  â”‚ P5   â”‚ Skill æ¨èç®—æ³•                    â”‚ é«˜     â”‚ ä¸­   â”‚                                                                                 
   380â†’  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜                                                                                 
   381â†’  ---                                                                                                                                          
   382â†’  æ·±åº¦è®¿è°ˆé—®é¢˜                                                                                                                                 
   383â†’                                                                                                                                               
   384â†’  1. é…ç½®ç»Ÿä¸€: ä½ æ›´å€¾å‘äºæŠŠ proactive é…ç½®åˆå¹¶åˆ° SKILL.mdï¼Œè¿˜æ˜¯ä¿æŒ reminders.yaml ç‹¬ç«‹ä½†ä¸ SKILL.md å…³è”ï¼Ÿ                                    
   385â†’  2. æ¨é€ç²’åº¦: ç”¨æˆ·æ˜¯å¦éœ€è¦ç»†ç²’åº¦æ§åˆ¶ï¼ˆå•ç‹¬å¼€å…³æ¯æ—¥è¿åŠ¿ã€å¤§è¿æé†’ç­‰ï¼‰ï¼Œè¿˜æ˜¯åªéœ€è¦ Skill çº§åˆ«çš„æ€»å¼€å…³ï¼Ÿ                                         
   386â†’  3. å¯¹è¯å¼•å¯¼: æ¨é€å†…å®¹æ˜¯å¦éœ€è¦"ä¸€é”®å¼€å§‹å¯¹è¯"åŠŸèƒ½ï¼Ÿè¿™å¯¹ä½ çš„ä¸šåŠ¡è½¬åŒ–é‡è¦å—ï¼Ÿ                      

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
