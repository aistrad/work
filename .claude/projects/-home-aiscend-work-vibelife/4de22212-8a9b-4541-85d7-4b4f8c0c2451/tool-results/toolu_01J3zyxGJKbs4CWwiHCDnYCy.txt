   360→  );
   361→});
   362→
   363→export function ChatContainer({
   364→  skillId,
   365→  skill = "bazi",
   366→  conversationId,
   367→  voiceMode = "warm",
   368→  onConversationStart,
   369→}: ChatContainerProps) {
   370→  const messagesEndRef = useRef<HTMLDivElement>(null);
   371→
   372→  // UI 展示用的 skill（主题、空状态等）
   373→  const displaySkill: SkillType = skill || (skillId as SkillType) || "bazi";
   374→
   375→  // Use AI SDK powered chat hook
   376→  // skillId 可选：不传时后端 LLM 自动路由
   377→  const {
   378→    messages,
   379→    isLoading,
   380→    sendMessage,
   381→    sendQuickPrompt,
   382→    error,
   383→  } = useVibeChat({
   384→    skillId: skillId as SkillId | undefined,
   385→    voiceMode,
   386→    conversationId,
   387→    onConversationStart,
   388→    onError: (err) => {
   389→      console.error("Chat error:", err);
   390→      // Show user-friendly toast notification with retry option
   391→      const errorMessage = err instanceof Error ? err.message : "未知错误";
   392→      const isNetworkError = errorMessage.includes("network") || errorMessage.includes("fetch");
   393→      const isTimeoutError = errorMessage.includes("timeout") || errorMessage.includes("超时");
   394→
   395→      toast.error(
   396→        isNetworkError ? "网络连接失败" : isTimeoutError ? "请求超时" : "发送失败",
   397→        {
   398→          description: isNetworkError
   399→            ? "请检查您的网络连接后重试"
   400→            : isTimeoutError
   401→              ? "服务器响应时间过长，请稍后重试"
   402→              : "请稍后重试，或刷新页面",
   403→          duration: 5000,
   404→        }
   405→      );
   406→    },
   407→  });
   408→
   409→  const scrollToBottom = useCallback(() => {
   410→    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
   411→  }, []);
   412→
   413→  useEffect(() => {
   414→    scrollToBottom();
   415→  }, [messages, scrollToBottom]);
   416→
   417→  // Handle send from ChatInput
   418→  const handleSend = useCallback(
   419→    async (content: string) => {
   420→      await sendMessage(content);
   421→    },
   422→    [sendMessage]
   423→  );
   424→
   425→  // Handle quick prompt from empty state
   426→  const handleQuickPrompt = useCallback(
   427→    async (content: string) => {
   428→      await sendQuickPrompt(content);
   429→    },
   430→    [sendQuickPrompt]
   431→  );
   432→
   433→  const hasMessages = messages.length > 0;
   434→
   435→  return (
   436→    <div className="flex flex-col h-full" data-skill={displaySkill}>
   437→      {/* Messages area - always flex-1 to push input to bottom */}
   438→      <main
   439→        id="main-content"

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
