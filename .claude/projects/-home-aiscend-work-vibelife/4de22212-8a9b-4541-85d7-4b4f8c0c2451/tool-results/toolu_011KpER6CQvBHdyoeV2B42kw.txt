     1â†’"use client";
     2â†’
     3â†’/**
     4â†’ * Chat Page - v7.1 ç»Ÿä¸€å¯¹è¯å…¥å£
     5â†’ *
     6â†’ * v7.1 ä¼˜åŒ–:
     7â†’ * - ç§»é™¤åŒæ¸²æŸ“æ¨¡å¼ï¼Œä½¿ç”¨ CSS åª’ä½“æŸ¥è¯¢ç»Ÿä¸€å“åº”å¼
     8â†’ * - PC ä¸‰æ : Chat + SidePanel (VibeID/ä»Šæ—¥Vibe/å¿«æ·æ“ä½œ)
     9â†’ * - Mobile: å•æ  + Skill Tabs + Bottom Nav
    10â†’ * - Suspense è¾¹ç•Œ (Vercel rule: async-suspense-boundaries)
    11â†’ * - memo ç»„ä»¶ (Vercel rule: rerender-memo)
    12â†’ * - åŠ¨æ€åŠ è½½ SidePanel (Vercel rule: bundle-dynamic-imports)
    13â†’ */
    14â†’
    15â†’import { useMemo, Suspense, memo, useCallback } from "react";
    16â†’import dynamic from "next/dynamic";
    17â†’import { useRouter } from "next/navigation";
    18â†’import { useSkill } from "@/providers";
    19â†’import { AppShell, useAppShell } from "@/components/layout";
    20â†’import { ChatPanel, ChartPanel, JourneyPanel, MePanel } from "@/components/layout/panels";
    21â†’import { ChatContainer } from "@/components/chat/ChatContainer";
    22â†’import { LuminousPaper, BreathAura } from "@/components/core";
    23â†’import { Card } from "@/components/ui/Card";
    24â†’import { Skeleton } from "@/components/ui/Skeleton";
    25â†’
    26â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    27â†’// Loading Fallbacks
    28â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    29â†’
    30â†’const ChatLoadingFallback = memo(function ChatLoadingFallback() {
    31â†’  return (
    32â†’    <div className="flex-1 flex items-center justify-center bg-bg-primary">
    33â†’      <div className="flex flex-col items-center gap-3">
    34â†’        <div className="w-12 h-12 rounded-full bg-accent-primary/10 animate-pulse flex items-center justify-center">
    35â†’          <span className="text-2xl">ğŸ’¬</span>
    36â†’        </div>
    37â†’        <p className="text-text-secondary text-sm">åŠ è½½å¯¹è¯...</p>
    38â†’      </div>
    39â†’    </div>
    40â†’  );
    41â†’});
    42â†’
    43â†’const PanelLoadingFallback = memo(function PanelLoadingFallback() {
    44â†’  return (
    45â†’    <div className="p-4 space-y-4">
    46â†’      <Skeleton className="h-8 w-1/2 rounded-lg" />
    47â†’      <Skeleton className="h-32 w-full rounded-xl" />
    48â†’      <Skeleton className="h-24 w-full rounded-xl" />
    49â†’    </div>
    50â†’  );
    51â†’});
    52â†’
    53â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    54â†’// Side Panel Quick Actions - v7.1 æ ·å¼
    55â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    56â†’
    57â†’interface QuickAction {
    58â†’  id: string;
    59â†’  icon: string;
    60â†’  label: string;
    61â†’  description: string;
    62â†’  onClick: () => void;
    63â†’}
    64â†’
    65â†’const QuickActionsCard = memo(function QuickActionsCard({ actions }: { actions: QuickAction[] }) {
    66â†’  return (
    67â†’    <Card variant="default" padding="md" hover={false} className="mb-4">
    68â†’      <h3 className="text-sm font-semibold text-text-primary mb-3">å¿«æ·æ“ä½œ</h3>
    69â†’      <div className="space-y-2">
    70â†’        {actions.map((action) => (
    71â†’          <button
    72â†’            key={action.id}
    73â†’            onClick={action.onClick}
    74â†’            className="w-full flex items-center gap-3 p-2.5 rounded-lg text-left hover:bg-bg-secondary transition-colors duration-fast"
    75â†’          >
    76â†’            <span className="text-lg">{action.icon}</span>
    77â†’            <div className="flex-1 min-w-0">
    78â†’              <p className="text-sm font-medium text-text-primary truncate">{action.label}</p>
    79â†’              <p className="text-xs text-text-tertiary truncate">{action.description}</p>
    80â†’            </div>
    81â†’            <span className="text-text-disabled">â†’</span>
    82â†’          </button>
    83â†’        ))}
    84â†’      </div>
    85â†’    </Card>
    86â†’  );
    87â†’});
    88â†’
    89â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    90â†’// Today's Vibe Card - v7.1 æ ·å¼
    91â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    92â†’
    93â†’const TodayVibeCard = memo(function TodayVibeCard({ skill }: { skill: string }) {
    94â†’  const vibeData = useMemo(() => {
    95â†’    if (skill === "bazi") {
    96â†’      return {
    97â†’        title: "ä»Šæ—¥è¿åŠ¿",
    98â†’        icon: "ğŸŒŸ",
    99â†’        summary: "ç”²å­æ—¥ï¼Œæ°´æ°”æ—ºç››",
   100â†’        advice: "é€‚åˆå¤„ç†æ²Ÿé€šã€å­¦ä¹ ç›¸å…³äº‹åŠ¡",
   101â†’        score: 78,
   102â†’      };
   103â†’    }
   104â†’    return {
   105â†’      title: "ä»Šæ—¥æ˜Ÿè±¡",
   106â†’      icon: "ğŸ”®",
   107â†’      summary: "æœˆäº®è¿›å…¥å¤©èåº§",
   108â†’      advice: "é€‚åˆæ·±åº¦æ€è€ƒä¸å†…çœ",
   109â†’      score: 72,
   110â†’    };
   111â†’  }, [skill]);
   112â†’
   113â†’  return (
   114â†’    <Card variant="default" padding="md" hover={false} className="mb-4">
   115â†’      <div className="flex items-start justify-between mb-3">
   116â†’        <div className="flex items-center gap-2">
   117â†’          <span className="text-xl">{vibeData.icon}</span>
   118â†’          <h3 className="text-sm font-semibold text-text-primary">{vibeData.title}</h3>
   119â†’        </div>
   120â†’        <div className="flex items-center gap-1 px-2 py-0.5 rounded-full bg-accent-primary/10">
   121â†’          <span className="text-xs font-medium text-accent-primary">{vibeData.score}</span>
   122â†’          <span className="text-xs text-text-tertiary">åˆ†</span>
   123â†’        </div>
   124â†’      </div>
   125â†’      <p className="text-sm text-text-primary mb-1">{vibeData.summary}</p>
   126â†’      <p className="text-xs text-text-secondary">{vibeData.advice}</p>
   127â†’    </Card>
   128â†’  );
   129â†’});
   130â†’
   131â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   132â†’// VibeID Preview Card - v7.1 æ ·å¼
   133â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   134â†’
   135â†’const VibeIDPreviewCard = memo(function VibeIDPreviewCard({ onClick }: { onClick: () => void }) {
   136â†’  return (
   137â†’    <Card
   138â†’      variant="elevated"
   139â†’      padding="md"
   140â†’      hover
   141â†’      className="mb-4 cursor-pointer"
   142â†’      onClick={onClick}
   143â†’    >
   144â†’      <div className="flex items-center gap-3 mb-3">
   145â†’        <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-mystic-400 to-mystic-600 flex items-center justify-center">
   146â†’          <span className="text-xl">ğŸ’</span>
   147â†’        </div>
   148â†’        <div>
   149â†’          <h3 className="text-sm font-semibold text-text-primary">æˆ‘çš„ VibeID</h3>
   150â†’          <p className="text-xs text-text-secondary">å››ç»´åŸå‹ç”»åƒ</p>
   151â†’        </div>
   152â†’      </div>
   153â†’      <div className="flex items-center justify-between">
   154â†’        <div className="flex -space-x-1">
   155â†’          {["ğŸŒ¸", "ğŸ§­", "ğŸ­", "ğŸ”¥"].map((emoji, i) => (
   156â†’            <span
   157â†’              key={i}
   158â†’              className="w-6 h-6 rounded-full bg-bg-secondary flex items-center justify-center text-xs border-2 border-bg-card"
   159â†’            >
   160â†’              {emoji}
   161â†’            </span>
   162â†’          ))}
   163â†’        </div>
   164â†’        <span className="text-xs text-accent-primary font-medium">æŸ¥çœ‹è¯¦æƒ… â†’</span>
   165â†’      </div>
   166â†’    </Card>
   167â†’  );
   168â†’});
   169â†’
   170â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   171â†’// Panel Content - æ ¹æ® Tab åˆ‡æ¢
   172â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   173â†’
   174â†’const PanelContent = memo(function PanelContent() {
   175â†’  const router = useRouter();
   176â†’  const { activeTab } = useAppShell();
   177â†’  const { skill } = useSkill();
   178â†’
   179â†’  const handleOpenRelationship = useCallback(() => {
   180â†’    router.push("/relationship");
   181â†’  }, [router]);
   182â†’
   183â†’  const handleGenerateReport = useCallback(() => {
   184â†’    router.push("/interview?returnTo=/report");
   185â†’  }, [router]);
   186â†’
   187â†’  const handleViewKLine = useCallback(() => {
   188â†’    router.push("/chat?view=kline");
   189â†’  }, [router]);
   190â†’
   191â†’  const handleViewIdentity = useCallback(() => {
   192â†’    router.push("/identity");
   193â†’  }, [router]);
   194â†’
   195â†’  const demoProfile = useMemo(() =>
   196â†’    skill === "bazi"
   197â†’      ? { dayMaster: "ç”²æœ¨", pattern: "æ­£å°æ ¼", currentLuck: "å£¬å¯…å¤§è¿" }
   198â†’      : { sunSign: "åŒå­åº§", moonSign: "å¤©èåº§", risingSign: "ç‹®å­åº§" }
   199â†’  , [skill]);
   200â†’
   201â†’  const demoNowNext = useMemo(() => ({
   202â†’    now: { theme: skill === "bazi" ? "ç§¯ç´¯æœŸ - é€‚åˆæ²‰æ·€å­¦ä¹ " : "æ°´æ˜Ÿé€†è¡ŒæœŸ - é€‚åˆå›é¡¾åæ€" },
   203â†’    next: { startDate: "2026å¹´ä¸‹åŠå¹´", theme: "çªç ´æœŸ" },
   204â†’  }), [skill]);
   205â†’
   206â†’  const quickActions = useMemo<QuickAction[]>(() => [
   207â†’    {
   208â†’      id: "relationship",
   209â†’      icon: "ğŸ’‘",
   210â†’      label: "å…³ç³»åŒ¹é…",
   211â†’      description: "æŸ¥çœ‹ä¸ä»–äººçš„å¥‘åˆåº¦",
   212â†’      onClick: handleOpenRelationship,
   213â†’    },
   214â†’    {
   215â†’      id: "report",
   216â†’      icon: "ğŸ“Š",
   217â†’      label: "ç”ŸæˆæŠ¥å‘Š",
   218â†’      description: "è·å–è¯¦ç»†åˆ†ææŠ¥å‘Š",
   219â†’      onClick: handleGenerateReport,
   220â†’    },
   221â†’    {
   222â†’      id: "kline",
   223â†’      icon: "ğŸ“ˆ",
   224â†’      label: "è¿åŠ¿æ›²çº¿",
   225â†’      description: "æŸ¥çœ‹è¿åŠ¿èµ°åŠ¿å›¾",
   226â†’      onClick: handleViewKLine,
   227â†’    },
   228â†’  ], [handleOpenRelationship, handleGenerateReport, handleViewKLine]);
   229â†’
   230â†’  switch (activeTab) {
   231â†’    case "chat":
   232â†’      return (
   233â†’        <div className="h-full overflow-y-auto p-4">
   234â†’          <VibeIDPreviewCard onClick={handleViewIdentity} />
   235â†’          <TodayVibeCard skill={skill} />
   236â†’          <QuickActionsCard actions={quickActions} />
   237â†’        </div>
   238â†’      );
   239â†’    case "chart":
   240â†’      return (
   241â†’        <ChartPanel
   242â†’          skill={skill}
   243â†’          nowNextData={demoNowNext}
   244â†’          klinePreview={{ currentScore: 72, trend: "up", period: "2026å¹´" }}
   245â†’          onViewKLine={handleViewKLine}
   246â†’          onGenerateReport={handleGenerateReport}
   247â†’        />
   248â†’      );
   249â†’    case "journey":
   250â†’      return (
   251â†’        <JourneyPanel
   252â†’          skill={skill}
   253â†’          totalConversations={12}
   254â†’          totalInsights={5}
   255â†’          memberSince="2025å¹´12æœˆ"
   256â†’          timeline={[
   257â†’            { id: "1", date: "ä»Šå¤©", title: "å…³äºäº‹ä¸šæ–¹å‘çš„å¯¹è¯", summary: "æ¢è®¨äº†æœªæ¥3å¹´çš„èŒä¸šè§„åˆ’", type: "conversation" },
   258â†’            { id: "2", date: "æ˜¨å¤©", title: "ä½ çš„æ ¸å¿ƒä¼˜åŠ¿", summary: "åˆ†æäº†ä½ çš„æ€§æ ¼ç‰¹ç‚¹", type: "insight" },
   259â†’          ]}
   260â†’        />
   261â†’      );
   262â†’    case "me":
   263â†’      return (
   264â†’        <MePanel
   265â†’          skill={skill}
   266â†’          user={{ name: "ç”¨æˆ·", email: "user@vibelife.app", isPro: false }}
   267â†’          onLogout={() => console.log("Logout")}
   268â†’        />
   269â†’      );
   270â†’    default:
   271â†’      return null;
   272â†’  }
   273â†’});
   274â†’
   275â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   276â†’// Chat Content - ä¸»èŠå¤©åŒºåŸŸ
   277â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   278â†’
   279â†’const ChatContent = memo(function ChatContent() {
   280â†’  const { voiceMode } = useAppShell();
   281â†’  const { skill } = useSkill();
   282â†’
   283â†’  return (
   284â†’    <LuminousPaper skill={skill} variant="default" className="h-full relative">
   285â†’      <BreathAura skill={skill} size="xl" position="top" intensity="low" className="opacity-20" />
   286â†’      {/*
   287â†’        v7.2: è‡ªåŠ¨è·¯ç”±æ¨¡å¼
   288â†’        - ä¸ä¼  skillIdï¼Œè®©åç«¯ CoreAgent é€šè¿‡ LLM è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·æ„å›¾
   289â†’        - skill ä»…ç”¨äº UI å±•ç¤ºï¼ˆä¸»é¢˜ã€ç©ºçŠ¶æ€ç­‰ï¼‰
   290â†’        - ç”¨æˆ·è¯´"æ˜Ÿåº§åˆ†æ"ä¼šè‡ªåŠ¨è·¯ç”±åˆ° zodiacï¼Œè¯´"å…«å­—"ä¼šè·¯ç”±åˆ° bazi
   291â†’      */}
   292â†’      <ChatContainer skill={skill} voiceMode={voiceMode} />
   293â†’    </LuminousPaper>
   294â†’  );
   295â†’});
   296â†’
   297â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   298â†’// Chat Page - ä¸»ç»„ä»¶
   299â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   300â†’
   301â†’export default function ChatPage() {
   302â†’  const { skill } = useSkill();
   303â†’
   304â†’  return (
   305â†’    <AppShell
   306â†’      skill={skill}
   307â†’      panelContent={
   308â†’        <Suspense fallback={<PanelLoadingFallback />}>
   309â†’          <PanelContent />
   310â†’        </Suspense>
   311â†’      }
   312â†’    >
   313â†’      <Suspense fallback={<ChatLoadingFallback />}>
   314â†’        <ChatContent />
   315â†’      </Suspense>
   316â†’    </AppShell>
   317â†’  );
   318â†’}
   319â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
