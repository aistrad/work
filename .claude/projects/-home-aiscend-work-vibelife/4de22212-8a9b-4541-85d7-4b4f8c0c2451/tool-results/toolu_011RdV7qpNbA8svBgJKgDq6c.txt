The file /home/aiscend/work/vibelife/apps/api/services/proactive/engine.py has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
   279→            return False
   280→
   281→        return subscription.push_enabled
   282→
   283→    async def _detect_user_triggers(self, user: Dict[str, Any]) -> List[ReminderTask]:
   284→        """检测用户的所有触发条件 - 集成订阅检查"""
   285→        tasks = []
   286→        user_id = user["user_id"]
   287→        profile = user["profile"]
   288→
   289→        # 遍历所有 Skill 配置
   290→        for skill_id, config in self._skill_configs.items():
   291→            # 先检查订阅状态（避免无谓的触发检测）
   292→            if not await self._should_send_to_user(user_id, skill_id):
   293→                continue
   294→
   295→            # 支持新旧配置格式: reminders (新) / reminder_types (旧)
   296→            reminders = config.get("reminders") or config.get("reminder_types", [])
   297→
   298→            for reminder in reminders:
   299→                trigger_config = reminder.get("trigger", {})
   300→
   301→                try:
   302→                    # 检测触发条件
   303→                    should_trigger, event_info = await self.trigger_detector.should_trigger(
   304→                        trigger_config=trigger_config,
   305→                        profile=profile,
   306→                        skill_id=skill_id,
   307→                    )
   308→
   309→                    if should_trigger:
   310→                        tasks.append(ReminderTask(
   311→                            user_id=user_id,
   312→                            skill_id=skill_id,
   313→                            reminder_type=reminder["id"],
   314→                            priority=ReminderPriority(reminder.get("priority", "medium")),
   315→                            trigger_event=event_info.get("event_name") if event_info else None,
   316→                            trigger_date=event_info.get("event_date") if event_info else date.today(),
   317→                            metadata={"config": reminder, "event_info": event_info},
   318→                        ))
   319→                except Exception as e:
   320→                    logger.error(f"Failed to check trigger {reminder.get('id')} for user {user_id}: {e}")
   321→
   322→        return tasks
   323→
   324→    def _get_reminder_config(self, skill_config: Dict, reminder_type: str) -> Dict:
   325→        """获取特定提醒类型的配置"""
   326→        # 支持新旧配置格式
   327→        reminders = skill_config.get("reminders") or skill_config.get("reminder_types", [])
   328→        for reminder in reminders:
   329→            if reminder["id"] == reminder_type:
   330→                return reminder
   331→        return {}
   332→
   333→    def get_skill_configs(self) -> Dict[str, Dict]:
   334→        """获取所有 Skill 配置 (用于调试)"""
   335→        return self._skill_configs