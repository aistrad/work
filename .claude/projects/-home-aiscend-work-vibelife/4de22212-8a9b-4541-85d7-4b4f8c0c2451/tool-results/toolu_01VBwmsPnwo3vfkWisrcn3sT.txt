   283→    async def _detect_user_triggers(self, user: Dict[str, Any]) -> List[ReminderTask]:
   284→        """检测用户的所有触发条件 - 集成订阅检查"""
   285→        tasks = []
   286→        user_id = user["user_id"]
   287→        profile = user["profile"]
   288→
   289→        # 遍历所有 Skill 配置
   290→        for skill_id, config in self._skill_configs.items():
   291→            # 支持新旧配置格式: reminders (新) / reminder_types (旧)
   292→            reminders = config.get("reminders") or config.get("reminder_types", [])
   293→                trigger_config = reminder.get("trigger", {})
   294→
   295→                try:
   296→                    # 检测触发条件
   297→                    should_trigger, event_info = await self.trigger_detector.should_trigger(
   298→                        trigger_config=trigger_config,
   299→                        profile=profile,
   300→                        skill_id=skill_id,
   301→                    )
   302→
   303→                    if should_trigger:
   304→                        tasks.append(ReminderTask(
   305→                            user_id=user_id,
   306→                            skill_id=skill_id,
   307→                            reminder_type=reminder["id"],
   308→                            priority=ReminderPriority(reminder.get("priority", "medium")),
   309→                            trigger_event=event_info.get("event_name") if event_info else None,
   310→                            trigger_date=event_info.get("event_date") if event_info else date.today(),
   311→                            metadata={"config": reminder, "event_info": event_info},
   312→                        ))
   313→                except Exception as e:
   314→                    logger.error(f"Failed to check trigger {reminder.get('id')} for user {user_id}: {e}")
   315→
   316→        return tasks
   317→
   318→    def _get_reminder_config(self, skill_config: Dict, reminder_type: str) -> Dict:
   319→        """获取特定提醒类型的配置"""
   320→        for reminder in skill_config.get("reminder_types", []):
   321→            if reminder["id"] == reminder_type:
   322→                return reminder
   323→        return {}
   324→
   325→    def get_skill_configs(self) -> Dict[str, Dict]:
   326→        """获取所有 Skill 配置 (用于调试)"""
   327→        return self._skill_configs
   328→
   329→
   330→# ═══════════════════════════════════════════════════════════════════════════
   331→# Singleton
   332→# ═══════════════════════════════════════════════════════════════════════════

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
