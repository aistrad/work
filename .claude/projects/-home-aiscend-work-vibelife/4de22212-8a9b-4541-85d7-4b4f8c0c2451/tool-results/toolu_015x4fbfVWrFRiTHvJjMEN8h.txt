     1→# Skill 设计规范
     2→
     3→版本: 1.0 | 日期: 2026-01-18
     4→基于: Vercel Agent Skills 设计模式
     5→
     6→---
     7→
     8→## 1. 概述
     9→
    10→本规范定义了 VibeLife 平台 Skill 的设计标准，采用 **Agentic + 渐进式加载** 架构。
    11→
    12→### 1.1 核心原则
    13→
    14→| 原则 | 说明 |
    15→|-----|------|
    16→| **Agentic 决策** | LLM 自主理解意图、规划步骤、调用工具 |
    17→| **渐进式加载** | SKILL.md 只放索引，详细规则按需加载 |
    18→| **优先级驱动** | 能力按 CRITICAL/HIGH/MEDIUM/LOW 分级 |
    19→| **知识驱动** | 通过 RAG 检索专业知识，而非硬编码 |
    20→| **工具优先** | 用工具展示结果，而非纯文字 |
    21→
    22→### 1.2 与传统 Scenario 架构对比
    23→
    24→| 维度 | 传统 Scenario 架构 | Agentic 架构 |
    25→|-----|-------------------|-------------|
    26→| 场景定义 | 100+ 预定义 .md 文件 | 0 个，LLM 自主决策 |
    27→| 路由方式 | 触发词关键词匹配 | LLM 语义理解 |
    28→| 服务流程 | 预定义 SOP 步骤 | LLM 根据分析规则自主规划 |
    29→| 知识使用 | Scenario 指定检索 | 按需语义检索 |
    30→| 灵活性 | 低（只能处理预定义场景） | 高（任意组合） |
    31→| 维护成本 | 高（每个场景都要维护） | 低（只维护 SKILL.md + 知识库） |
    32→
    33→---
    34→
    35→## 2. 目录结构
    36→
    37→### 2.1 标准结构
    38→
    39→```
    40→skills/{skill_id}/
    41→├── SKILL.md                    # 核心定义（< 200 行）
    42→├── rules/                       # 分析规则（按需加载）
    43→│   ├── _index.md               # 规则分类索引
    44→│   ├── {capability-1}.md       # 能力 1 的分析规则
    45→│   ├── {capability-2}.md       # 能力 2 的分析规则
    46→│   └── ...
    47→├── tools/
    48→│   ├── tools.yaml              # 工具定义
    49→│   └── handlers.py             # 工具执行器
    50→└── metadata.json               # 元数据（可选）
    51→```
    52→
    53→### 2.2 文件说明
    54→
    55→| 文件 | 必须 | 说明 |
    56→|-----|------|------|
    57→| `SKILL.md` | 是 | 核心定义，< 200 行 |
    58→| `rules/*.md` | 是 | 分析规则，按需加载 |
    59→| `tools/tools.yaml` | 是 | 工具定义 |
    60→| `tools/handlers.py` | 是 | 工具执行器 |
    61→| `metadata.json` | 否 | 元数据（版本、作者等） |
    62→
    63→### 2.3 命名规范
    64→
    65→| 类型 | 规范 | 示例 |
    66→|-----|------|------|
    67→| Skill 目录 | kebab-case | `bazi`, `zodiac`, `career` |
    68→| SKILL.md | 大写 | `SKILL.md` |
    69→| Rule 文件 | kebab-case | `basic-reading.md`, `career.md` |
    70→| 工具名称 | snake_case | `show_bazi_chart`, `search_db` |
    71→
    72→---
    73→
    74→## 3. SKILL.md 规范
    75→
    76→### 3.1 结构模板
    77→
    78→```markdown
    79→---
    80→name: {skill-name}
    81→description: {一句话描述 + 触发词。Max 200 chars}
    82→---
    83→
    84→# {Skill Name}
    85→
    86→## 专家身份
    87→[~20 行，核心理念和知识来源]
    88→
    89→## 核心能力索引
    90→[能力表格，包含优先级和框架文件路径]
    91→
    92→## 工具快速参考
    93→[工具表格，~30 行]
    94→
    95→## 知识检索策略
    96→[检索模式表格，~20 行]
    97→
    98→## 服务原则
    99→[5 条原则，~15 行]
   100→
   101→## 伦理边界
   102→[禁止事项 + 表达原则，~20 行]
   103→
   104→## 详细文档
   105→[指向 rules/*.md 的链接]
   106→```
   107→
   108→### 3.2 行数限制
   109→
   110→| 部分 | 行数限制 | 说明 |
   111→|-----|---------|------|
   112→| Frontmatter | ~10 行 | name + description |
   113→| 专家身份 | ~20 行 | 核心理念、知识来源 |
   114→| 核心能力索引 | ~30 行 | 能力表格 |
   115→| 工具快速参考 | ~30 行 | 工具表格 |
   116→| 知识检索策略 | ~20 行 | 检索模式 |
   117→| 服务原则 | ~15 行 | 5 条原则 |
   118→| 伦理边界 | ~20 行 | 禁止事项 |
   119→| **总计** | **< 200 行** | 严格限制 |
   120→
   121→### 3.3 Frontmatter 规范
   122→
   123→```yaml
   124→---
   125→name: {skill-name}           # kebab-case，max 64 chars
   126→description: |               # 一句话描述 + 触发词，max 200 chars
   127→  {描述}。触发词：{词1}、{词2}、{词3}。
   128→---
   129→```
   130→
   131→**示例**：
   132→```yaml
   133→---
   134→name: bazi
   135→description: 八字命理专家。融汇《滴天髓》《穷通宝鉴》《子平真诠》的命理分析。触发词：八字、命盘、算命、事业运势、感情婚姻、财运、大运流年。
   136→---
   137→```
   138→
   139→### 3.4 核心能力索引规范
   140→
   141→```markdown
   142→## 核心能力索引
   143→
   144→| 能力 | 优先级 | 规则文件 | 触发场景 |
   145→|-----|-------|---------|---------|
   146→| {能力名} | {CRITICAL/HIGH/MEDIUM/LOW} | `rules/{file}.md` | {触发场景描述} |
   147→```
   148→
   149→**优先级定义**：
   150→
   151→| 优先级 | 说明 | 使用场景 |
   152→|-------|------|---------|
   153→| CRITICAL | 最高频、最基础的能力 | 命盘解读、本命盘分析 |
   154→| HIGH | 高频需求 | 事业分析、感情分析 |
   155→| MEDIUM | 中频需求 | 财运分析、运势预测 |
   156→| LOW | 低频需求 | 合婚配对、择日选时 |
   157→
   158→### 3.5 工具快速参考规范
   159→
   160→```markdown
   161→## 工具快速参考
   162→
   163→### {工具类别}
   164→| 工具 | 用途 | 何时调用 |
   165→|-----|------|---------|
   166→| `{tool_name}` | {用途} | {调用时机} |
   167→```
   168→
   169→**工具类别**：
   170→- 信息收集（collect）
   171→- 计算工具（compute）
   172→- 展示工具（display）
   173→- 检索工具（search）
   174→
   175→### 3.6 知识检索策略规范
   176→
   177→```markdown
   178→## 知识检索策略
   179→
   180→| 检索类型 | Query 模式 | 示例 |
   181→|---------|-----------|------|
   182→| 理论知识 | "{概念} 理论 原理" | "{主题} 理论 原理" |
   183→| 分析方法 | "{主题} 分析方法" | "{主题} 分析方法 步骤" |
   184→| 规则依据 | "{主题} 规则 原则" | "{主题} 规则 原则" |
   185→| 参考案例 | "{特征} 案例" | "{特征} 案例" |
   186→```
   187→
   188→---
   189→
   190→## 4. Rule 文件规范
   191→
   192→### 4.1 结构模板
   193→
   194→```markdown
   195→---
   196→id: {capability-id}
   197→name: {能力名称}
   198→impact: {CRITICAL|HIGH|MEDIUM|LOW}
   199→impactDescription: {影响说明}
   200→tags: {触发词列表，逗号分隔}
   201→---
   202→
   203→# {能力名称}框架
   204→
   205→## 适用场景
   206→[触发场景描述]
   207→
   208→## 分析要点
   209→[分析步骤表格，包含检索 Query]
   210→
   211→## 输出要求
   212→[必须调用的工具和输出格式]
   213→
   214→## 常见问题
   215→[FAQ，可选]
   216→```
   217→
   218→### 4.2 Frontmatter 规范
   219→
   220→```yaml
   221→---
   222→id: career                           # kebab-case
   223→name: 事业分析                        # 中文名称
   224→impact: HIGH                         # CRITICAL/HIGH/MEDIUM/LOW
   225→impactDescription: 高频需求，影响用户职业决策
   226→tags: 事业, 职业, 跳槽, 升职, 工作    # 触发词
   227→---
   228→```
   229→
   230→### 4.3 分析要点表格规范
   231→
   232→```markdown
   233→## 分析要点
   234→
   235→| 步骤 | 分析要点 | 检索 Query | 优先级 |
   236→|-----|---------|-----------|-------|
   237→| 1 | {要点} | "{query}" | 必须/推荐/可选 |
   238→| 2 | {要点} | "{query}" | 必须/推荐/可选 |
   239→```
   240→
   241→**优先级说明**：
   242→- **必须**：每次分析都要覆盖
   243→- **推荐**：建议覆盖，可根据情况省略
   244→- **可选**：用户明确要求时才覆盖
   245→
   246→### 4.4 输出要求规范
   247→
   248→```markdown
   249→## 输出要求
   250→
   251→1. **必须调用**：
   252→   - `{tool_1}` {说明}
   253→   - `{tool_2}` {说明}
   254→
   255→2. **内容要求**：
   256→   - {要求 1}
   257→   - {要求 2}
   258→
   259→3. **引导方向**：
   260→   - {引导 1}
   261→   - {引导 2}
   262→```
   263→
   264→---
   265→
   266→## 5. 加载流程
   267→
   268→### 5.1 渐进式加载
   269→
   270→```
   271→┌─────────────────────────────────────────────────────────────────┐
   272→│                    渐进式加载流程                                │
   273→├────────��────────────────────────────────────────────────────────┤
   274→│                                                                 │
   275→│  1. 启动时加载                                                   │
   276→│     └── SKILL.md (< 200 行)                                     │
   277→│         • 专家身份                                               │
   278→│         • 能力索引表                                             │
   279→│         • 工具快速参考                                           │
   280→│         • 服务原则 + 伦理边界                                    │
   281→│                                                                 │
   282→│  2. 匹配能力后加载                                               │
   283→│     └── rules/{capability}.md                                   │
   284→│         • 详细分析规则                                           │
   285→│         • 检索 Query 模板                                        │
   286→│         • 输出要求                                               │
   287→│                                                                 │
   288→│  3. 按需检索                                                     │
   289→│     └── search_db(query)                                        │
   290→│         • 知识库内容                                             │
   291→│         • 参考案例                                               │
   292→│                                                                 │
   293→└──────────────────────────────────────────���──────────────────────┘
   294→```
   295→
   296→### 5.2 System Prompt 构建
   297→
   298→```python
   299→def build_system_prompt(skill_id: str, user_context: Optional[Dict] = None) -> str:
   300→    """
   301→    构建 System Prompt。
   302→    只加载 SKILL.md，规则文件由 LLM 按需加载。
   303→    """
   304→    parts = []
   305→
   306→    # 1. 加载 SKILL.md (< 200 行)
   307→    skill_md = load_skill_md(skill_id)
   308→    parts.append(skill_md)
   309→
   310→    # 2. 注入用户上下文 (如果有)
   311→    if user_context:
   312→        ctx_text = format_user_context(user_context)
   313→        parts.append(f"\n---\n\n## 用户上下文\n\n{ctx_text}")
   314→
   315→    return "\n".join(parts)
   316→```
   317→
   318→### 5.3 Agentic Loop
   319→
   320→```
   321→1. 用户输入
   322→2. LLM 理解意图，匹配核心能力索引
   323→3. LLM 决定是否需要加载 Rule
   324→4. 如需要，读取 rules/{capability}.md
   325→5. 按规则规划分析步骤
   326→6. 按需检索知识 (search_db)
   327→7. 调用工具展示结果
   328→8. 引导后续对话
   329→```
   330→
   331→---
   332→
   333→## 6. 工具设计规范
   334→
   335→### 6.1 工具分类
   336→
   337→| 类别 | 前缀 | 说明 | 示例 |
   338→|-----|------|------|------|
   339→| 信息收集 | `collect_` | 收集用户信息 | `collect_bazi_info` |
   340→| 计算工具 | `calculate_` | 内部计算 | `calculate_bazi` |
   341→| 展示工具 | `show_` | 展示结果 | `show_bazi_chart` |
   342→| 检索工具 | `search_` | 检索知识 | `search_db` |
   343→| 请求工具 | `request_` | 请求补充信息 | `request_info` |
   344→
   345→### 6.2 tools.yaml 规范
   346→
   347→```yaml
   348→tools:
   349→  - name: show_bazi_chart
   350→    description: 展示八字命盘图
   351→    type: display
   352→    card_type: BaziChartCard
   353→    parameters:
   354→      - name: user_id
   355→        type: string
   356→        required: true
   357→        description: 用户 ID
   358→    when_to_call: 用户想看命盘时
   359→
   360→  - name: search_db
   361→    description: 检索知识库或案例库
   362→    type: search
   363→    parameters:
   364→      - name: table
   365→        type: string
   366→        enum: [knowledge_chunks, cases]
   367→        required: true
   368→      - name: query
   369→        type: string
   370→        required: true
   371→        description: 检索 query
   372→      - name: top_k
   373→        type: integer
   374→        default: 5
   375→    when_to_call: 需要专业知识支撑时
   376→```
   377→
   378→### 6.3 全局工具
   379→
   380→以下工具在 `skills/core/tools/` 中定义，所有 Skill 共享：
   381→
   382→| 工具 | 用途 |
   383→|-----|------|
   384→| `search_db` | 统一数据库查询 |
   385→| `request_info` | 请求用户提供信息 |
   386→| `show_insight` | 通用洞察卡片 |
   387→| `show_report` | 通用报告 |
   388→
   389→---
   390→
   391→## 7. 知识库设计
   392→
   393→### 7.1 数据库结构
   394→
   395→```sql
   396→-- knowledge_chunks 表
   397→CREATE TABLE knowledge_chunks (
   398→    id              UUID PRIMARY KEY,
   399→    skill_id        VARCHAR(50) NOT NULL,
   400→    document_id     UUID REFERENCES knowledge_documents(id),
   401→    chunk_index     INT NOT NULL,
   402→    content         TEXT NOT NULL,
   403→    section_path    TEXT,
   404→    section_title   VARCHAR(255),
   405→    embedding       VECTOR(1024),
   406→    search_text_preprocessed TEXT,
   407→    metadata        JSONB,
   408→    created_at      TIMESTAMP DEFAULT NOW()
   409→);
   410→
   411→-- cases 表
   412→CREATE TABLE cases (
   413→    id              VARCHAR(50) PRIMARY KEY,
   414→    skill_id        VARCHAR(50) NOT NULL,
   415→    name            VARCHAR(255) NOT NULL,
   416→    core_data       JSONB NOT NULL,
   417→    features        JSONB NOT NULL,
   418→    tags            VARCHAR[] NOT NULL,
   419→    analysis        JSONB NOT NULL,
   420→    conclusion      JSONB NOT NULL,
   421→    authority       VARCHAR(20) DEFAULT 'medium',
   422→    created_at      TIMESTAMP DEFAULT NOW()
   423→);
   424→```
   425→
   426→### 7.2 检索接口
   427→
   428→```python
   429→async def search_db(
   430→    table: str,           # "knowledge_chunks" 或 "cases"
   431→    query: str,           # LLM 描述的检索需求
   432→    skill_id: str,        # 限定 skill
   433→    top_k: int = 5,       # 返回数量
   434→    filters: dict = None  # 可选过滤条件
   435→) -> List[Dict]:
   436→    """语义检索知识或案例。"""
   437→```
   438→
   439→### 7.3 知识库质量要求
   440→
   441→| 指标 | 目标 | 说明 |
   442→|-----|------|------|
   443→| 知识覆盖 | ≥300 chunks/skill | 覆盖所有核心能力 |
   444→| 案例数量 | ≥50 cases/skill | 覆盖常见场景 |
   445→| 检索准确率 | ≥70% | Top-5 结果相关 |
   446→
   447→---
   448→
   449→## 8. 最佳实践
   450→
   451→### 8.1 SKILL.md 编写
   452→
   453→1. **保持精简**：严格控制在 200 行以内
   454→2. **索引优先**：只放索引，详细内容放 rules/
   455→3. **触发词明确**：在 description 中列出触发词
   456→4. **优先级标注**：每个能力标注 impact 级别
   457→
   458→### 8.2 Rule 编写
   459→
   460→1. **分析要点完整**：覆盖该能力的所有关键分析点
   461→2. **检索 Query 具体**：提供可直接使用的 query 模板
   462→3. **输出要求明确**：指定必须调用的工具
   463→4. **常见问题补充**：针对高频问题提供指导
   464→
   465→### 8.3 避免的反模式
   466→
   467→| 反模式 | 说明 | 正确做法 |
   468→|-------|------|---------|
   469→| SKILL.md 过长 | 超过 200 行 | 拆分到 rules/ |
   470→| 硬编码知识 | 在 SKILL.md 中写死规则 | 使用 search_db 检索 |
   471→| 缺少优先级 | 能力没有标注优先级 | 标注 CRITICAL/HIGH/MEDIUM/LOW |
   472→| 触发词匹配 | 使用关键词匹配路由 | 让 LLM 语义理解 |
   473→| 固定 SOP | 预定义死板的流程 | 让 LLM 根据规则自主规划 |
   474→
   475→---
   476→
   477→## 9. 示例
   478→
   479→### 9.1 完整 Skill 示例
   480→
   481→参见：
   482→- [Bazi SKILL.md 示例](./templates/SKILL_TEMPLATE_BAZI.md)
   483→- [Zodiac SKILL.md 示例](./templates/SKILL_TEMPLATE_ZODIAC.md)
   484→
   485→### 9.2 Rule 示例
   486→
   487→参见：
   488→- [Rule 模板](./templates/RULE_TEMPLATE.md)
   489→- [Career Rule 示例](./templates/RULE_CAREER.md)
   490→
   491→---
   492→
   493→## 10. 检查清单
   494→
   495→### 10.1 SKILL.md 检查
   496→
   497→- [ ] 行数 < 200 行
   498→- [ ] Frontmatter 包含 name 和 description
   499→- [ ] description 包含触发词
   500→- [ ] 核心能力索引表格完整
   501→- [ ] 每个能力都有优先级标注
   502→- [ ] 每个能力都指向 rule 文件
   503→- [ ] 工具快速参考表格完整
   504→- [ ] 知识检索策略表格完整
   505→- [ ] 服务原则 5 条
   506→- [ ] 伦理边界完整
   507→
   508→### 10.2 Rule 检查
   509→
   510→- [ ] Frontmatter 包含 id, name, impact, tags
   511→- [ ] 适用场景描述清晰
   512→- [ ] 分析要点表格完整
   513→- [ ] 每个要点都有检索 Query
   514→- [ ] 每个要点都有优先级
   515→- [ ] 输出要求明确
   516→- [ ] 必须调用的工具列出
   517→
   518→### 10.3 整体检查
   519→
   520→- [ ] 目录结构符合规范
   521→- [ ] 所有能力都有对应 rule 文件
   522→- [ ] 工具定义完整
   523→- [ ] 知识库覆盖所有能力
   524→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
