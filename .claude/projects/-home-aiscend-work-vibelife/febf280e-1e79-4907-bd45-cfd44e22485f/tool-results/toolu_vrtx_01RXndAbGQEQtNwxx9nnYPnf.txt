/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-20-ALTER TABLE conversations
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-21-DROP CONSTRAINT IF EXISTS conversations_voice_mode_check;
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-22-
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-23-ALTER TABLE conversations
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-24-ADD CONSTRAINT conversations_voice_mode_check
migrations/005_user_gender_voice_mode.sql:25:CHECK (voice_mode IN ('warm', 'sarcastic', 'wise'));
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-26-
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-27--- Update default voice_mode in user_profiles JSONB
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-28--- (This is informational - actual default is handled in code)
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-29-
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-30--- ============================================================================
--
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-34--- Check if skill_profiles table exists and add voice_mode column
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-35-DO $$
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-36-BEGIN
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-37-    IF EXISTS (SELECT FROM information_schema.tables WHERE table_name = 'skill_profiles') THEN
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-38-        ALTER TABLE skill_profiles
migrations/005_user_gender_voice_mode.sql:39:        ADD COLUMN IF NOT EXISTS voice_mode VARCHAR(20) DEFAULT 'warm'
migrations/005_user_gender_voice_mode.sql:40:        CHECK (voice_mode IN ('warm', 'sarcastic', 'wise'));
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-41-    END IF;
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-42-END $$;
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-43-
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-44--- ============================================================================
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-45--- CREATE SKILL_PROFILES TABLE IF NOT EXISTS
--
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-47-
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-48-CREATE TABLE IF NOT EXISTS skill_profiles (
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-49-    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-50-    user_id UUID NOT NULL REFERENCES vibe_users(id) ON DELETE CASCADE,
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-51-    skill VARCHAR(20) NOT NULL CHECK (skill IN ('bazi', 'zodiac', 'mbti', 'tarot')),
migrations/005_user_gender_voice_mode.sql:52:    voice_mode VARCHAR(20) DEFAULT 'warm' CHECK (voice_mode IN ('warm', 'sarcastic', 'wise')),
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-53-    profile_data JSONB DEFAULT '{}',  -- interview_responses, preferences, etc.
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-54-    first_use_at TIMESTAMPTZ DEFAULT NOW(),
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-55-    last_use_at TIMESTAMPTZ DEFAULT NOW(),
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-56-    total_sessions INT DEFAULT 0,
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-57-    created_at TIMESTAMPTZ DEFAULT NOW(),
--
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-61-
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-62-CREATE INDEX IF NOT EXISTS idx_skill_profiles_user_id ON skill_profiles(user_id);
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-63-CREATE INDEX IF NOT EXISTS idx_skill_profiles_skill ON skill_profiles(skill);
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-64-
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-65-COMMENT ON TABLE skill_profiles IS 'Per-skill user profiles with voice_mode preference';
migrations/005_user_gender_voice_mode.sql:66:COMMENT ON COLUMN skill_profiles.voice_mode IS 'Persona voice mode: warm (ÊöñÂøÉÈó∫Ëúú), sarcastic (ÊØíËàåÊçüÂèã), wise (‰∫∫ÁîüÂØºÂ∏à)';
/home/aiscend/work/vibelife/migrations/005_user_gender_voice_mode.sql-67-COMMENT ON COLUMN skill_profiles.profile_data IS 'JSONB storage for interview_responses and other skill-specific data';
--
migrations/001_v3_schema.sql-50-        "basic": {},
migrations/001_v3_schema.sql-51-        "life_context": {},
migrations/001_v3_schema.sql-52-        "ai_insights": {},
migrations/001_v3_schema.sql-53-        "identity_prism": {},
migrations/001_v3_schema.sql-54-        "preferences": {
migrations/001_v3_schema.sql:55:            "voice_mode": "warm",
migrations/001_v3_schema.sql-56-            "language": "zh-CN"
/home/aiscend/work/vibelife/migrations/001_v3_schema.sql-57-        }
/home/aiscend/work/vibelife/migrations/001_v3_schema.sql-58-    }',
/home/aiscend/work/vibelife/migrations/001_v3_schema.sql-59-    created_at TIMESTAMPTZ DEFAULT NOW(),
/home/aiscend/work/vibelife/migrations/001_v3_schema.sql-60-    UNIQUE(user_id, version)
--
/home/aiscend/work/vibelife/migrations/001_v3_schema.sql-67--- Conversation sessions
/home/aiscend/work/vibelife/migrations/001_v3_schema.sql-68-CREATE TABLE IF NOT EXISTS conversations (
/home/aiscend/work/vibelife/migrations/001_v3_schema.sql-69-    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
/home/aiscend/work/vibelife/migrations/001_v3_schema.sql-70-    user_id UUID REFERENCES vibe_users(id) ON DELETE SET NULL,
/home/aiscend/work/vibelife/migrations/001_v3_schema.sql-71-    skill VARCHAR(20) NOT NULL CHECK (skill IN ('bazi', 'zodiac')),
migrations/001_v3_schema.sql:72:    voice_mode VARCHAR(20) DEFAULT 'warm' CHECK (voice_mode IN ('warm', 'sarcastic')),
/home/aiscend/work/vibelife/migrations/001_v3_schema.sql-73-    title VARCHAR(255),  -- ‰ºöËØùÊ†áÈ¢òÔºàÂèØÈÄâÔºâ
/home/aiscend/work/vibelife/migrations/001_v3_schema.sql-74-    is_active BOOLEAN DEFAULT TRUE,
/home/aiscend/work/vibelife/migrations/001_v3_schema.sql-75-    created_at TIMESTAMPTZ DEFAULT NOW(),
/home/aiscend/work/vibelife/migrations/001_v3_schema.sql-76-    updated_at TIMESTAMPTZ DEFAULT NOW()
/home/aiscend/work/vibelife/migrations/001_v3_schema.sql-77-);
--
/home/aiscend/work/vibelife/migrations/011_guest_sessions.sql-12-
/home/aiscend/work/vibelife/migrations/011_guest_sessions.sql-13-    -- Onboarding Êï∞ÊçÆ
/home/aiscend/work/vibelife/migrations/011_guest_sessions.sql-14-    birth_datetime TIMESTAMPTZ,
/home/aiscend/work/vibelife/migrations/011_guest_sessions.sql-15-    birth_location VARCHAR(255),
/home/aiscend/work/vibelife/migrations/011_guest_sessions.sql-16-    gender VARCHAR(20),  -- male | female | private
migrations/011_guest_sessions.sql:17:    voice_mode VARCHAR(20) DEFAULT 'warm',  -- warm | sarcastic | wise
/home/aiscend/work/vibelife/migrations/011_guest_sessions.sql-18-    skill VARCHAR(50),  -- bazi | zodiac
/home/aiscend/work/vibelife/migrations/011_guest_sessions.sql-19-    interview_responses JSONB DEFAULT '{}',
/home/aiscend/work/vibelife/migrations/011_guest_sessions.sql-20-    focus_areas JSONB DEFAULT '[]',
/home/aiscend/work/vibelife/migrations/011_guest_sessions.sql-21-
/home/aiscend/work/vibelife/migrations/011_guest_sessions.sql-22-    -- ËΩ¨ÂåñÁä∂ÊÄÅ
--
apps/web/src/skills/bazi/tools/show-fortune.tsx-130-      user_id: userId,
/home/aiscend/work/vibelife/apps/web/src/skills/bazi/tools/show-fortune.tsx-131-      year,
apps/web/src/skills/bazi/tools/show-fortune.tsx-132-      profile: { basic: { birth_year: 1990, day_master_element: dayMasterElement, gender: "unknown" } },
/home/aiscend/work/vibelife/apps/web/src/skills/bazi/tools/show-fortune.tsx-133-      cycles,
/home/aiscend/work/vibelife/apps/web/src/skills/bazi/tools/show-fortune.tsx-134-      annual,
apps/web/src/skills/bazi/tools/show-fortune.tsx:135:      voice_mode: "warm",
/home/aiscend/work/vibelife/apps/web/src/skills/bazi/tools/show-fortune.tsx-136-    };
/home/aiscend/work/vibelife/apps/web/src/skills/bazi/tools/show-fortune.tsx-137-  },
/home/aiscend/work/vibelife/apps/web/src/skills/bazi/tools/show-fortune.tsx-138-
/home/aiscend/work/vibelife/apps/web/src/skills/bazi/tools/show-fortune.tsx-139-  render(result) {
/home/aiscend/work/vibelife/apps/web/src/skills/bazi/tools/show-fortune.tsx-140-    const currentYear = result.year || new Date().getFullYear();
--
apps/web/src/skills/shared/SkillIntroCard/types.ts-96-  trial_messages_remaining: number | null;
/home/aiscend/work/vibelife/apps/web/src/skills/shared/SkillIntroCard/types.ts-97-}
/home/aiscend/work/vibelife/apps/web/src/skills/shared/SkillIntroCard/types.ts-98-
/home/aiscend/work/vibelife/apps/web/src/skills/shared/SkillIntroCard/types.ts-99-export interface UserSkillSettings {
apps/web/src/skills/shared/SkillIntroCard/types.ts-100-  skill_id: string;
apps/web/src/skills/shared/SkillIntroCard/types.ts:101:  voice_mode?: 'warm' | 'direct' | 'playful';
apps/web/src/skills/shared/SkillIntroCard/types.ts-102-  reminder_hour?: number;
apps/web/src/skills/shared/SkillIntroCard/types.ts-103-  custom_settings?: Record<string, unknown>;
/home/aiscend/work/vibelife/apps/web/src/skills/shared/SkillIntroCard/types.ts-104-}
/home/aiscend/work/vibelife/apps/web/src/skills/shared/SkillIntroCard/types.ts-105-
/home/aiscend/work/vibelife/apps/web/src/skills/shared/SkillIntroCard/types.ts-106-// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
--
/home/aiscend/work/vibelife/apps/web/src/components/layout/AppShell.tsx-98-  useEffect(() => {
/home/aiscend/work/vibelife/apps/web/src/components/layout/AppShell.tsx-99-    const loadPreferences = async () => {
/home/aiscend/work/vibelife/apps/web/src/components/layout/AppShell.tsx-100-      try {
apps/web/src/components/layout/AppShell.tsx-101-        const response = await apiClient.get<{ voice_mode: string; language: string }>("/preferences");
/home/aiscend/work/vibelife/apps/web/src/components/layout/AppShell.tsx-102-        if (response.data?.voice_mode) {
apps/web/src/components/layout/AppShell.tsx:103:          setVoiceModeState(response.data.voice_mode as "warm" | "sarcastic");
/home/aiscend/work/vibelife/apps/web/src/components/layout/AppShell.tsx-104-        }
/home/aiscend/work/vibelife/apps/web/src/components/layout/AppShell.tsx-105-      } catch (error) {
apps/web/src/components/layout/AppShell.tsx-106-        console.error("Failed to load preferences:", error);
/home/aiscend/work/vibelife/apps/web/src/components/layout/AppShell.tsx-107-      }
/home/aiscend/work/vibelife/apps/web/src/components/layout/AppShell.tsx-108-    };
--
/home/aiscend/work/vibelife/apps/web/src/app/test/page.tsx-156-      } else {
/home/aiscend/work/vibelife/apps/web/src/app/test/page.tsx-157-        // ËÅäÂ§©ÔºöÊµÅÂºè SSE
/home/aiscend/work/vibelife/apps/web/src/app/test/page.tsx-158-        const res = await fetch(`/api/proxy?endpoint=${encodeURIComponent(endpoint)}`, {
apps/web/src/app/test/page.tsx-159-          method: "POST",
apps/web/src/app/test/page.tsx-160-          headers: { "Content-Type": "application/json", ...(t && { Authorization: `Bearer ${t}` }) },
apps/web/src/app/test/page.tsx:161:          body: JSON.stringify({ message: msg, skill, conversation_id: conversationId, voice_mode: "warm" }),
/home/aiscend/work/vibelife/apps/web/src/app/test/page.tsx-162-        });
/home/aiscend/work/vibelife/apps/web/src/app/test/page.tsx-163-
/home/aiscend/work/vibelife/apps/web/src/app/test/page.tsx-164-        const reader = res.body?.getReader();
/home/aiscend/work/vibelife/apps/web/src/app/test/page.tsx-165-        const decoder = new TextDecoder();
/home/aiscend/work/vibelife/apps/web/src/app/test/page.tsx-166-        let assistantMsg = "";
--
apps/web/src/app/test/page.tsx-323-      { name: "Ëé∑ÂèñËÆøÂÆ¢‰ºöËØù", endpoint: "/api/v1/guest/session", desc: "GET /guest/session (ÈúÄcookie)" },
apps/web/src/app/test/page.tsx-324-      { name: "‰øùÂ≠òOnboarding", endpoint: "/api/v1/guest/session/onboarding", method: "PUT", body: () => ({
apps/web/src/app/test/page.tsx-325-        birth_datetime: `${birthData.birth_date}T${birthData.birth_time}:00`,
apps/web/src/app/test/page.tsx-326-        birth_location: birthData.birth_location,
apps/web/src/app/test/page.tsx-327-        gender: birthData.gender,
apps/web/src/app/test/page.tsx:328:        voice_mode: "warm",
apps/web/src/app/test/page.tsx-329-        skill: skill,
apps/web/src/app/test/page.tsx-330-        focus_areas: ["‰∫ã‰∏ö", "ÊÑüÊÉÖ"],
apps/web/src/app/test/page.tsx-331-      }), desc: "PUT /guest/session/onboarding" },
apps/web/src/app/test/page.tsx-332-      { name: "Âà†Èô§ËÆøÂÆ¢‰ºöËØù", endpoint: "/api/v1/guest/session", method: "DELETE", desc: "DELETE /guest/session" },
/home/aiscend/work/vibelife/apps/web/src/app/test/page.tsx-333-    ]},
--
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-1019-        parts.append(f"# {skill.name}\n\n{skill.expert_persona}")
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-1020-
apps/api/services/agent/skill_loader.py-1021-    # V2: Voice Mode Ê≥®ÂÖ•
apps/api/services/agent/skill_loader.py-1022-    if user_context:
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-1023-        preferences = user_context.get("preferences", {})
apps/api/services/agent/skill_loader.py:1024:        voice_mode = preferences.get("voice_mode", "warm")
apps/api/services/agent/skill_loader.py-1025-        if voice_mode in VOICE_MODE_PROMPTS:
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-1026-            parts.append(VOICE_MODE_PROMPTS[voice_mode])
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-1027-
/home/aiscend/work/vibelife/apps/api/services/agent/skill_loader.py-1028-    # Âä†ËΩΩÂú∫ÊôØÊàñËßÑÂàô
apps/api/services/agent/skill_loader.py-1029-    if scenario_id:
--
apps/api/services/agent/core.py-72-    skill_data: Optional[Dict[str, Any]] = None   # Phase 2 ÊâçÂä†ËΩΩÔºåÂè™Âê´ÂΩìÂâç skill
apps/api/services/agent/core.py-73-    history: Optional[List[Dict[str, str]]] = None  # ‰ªéÊï∞ÊçÆÂ∫ìËé∑Âèñ
apps/api/services/agent/core.py-74-    skill: Optional[str] = None
apps/api/services/agent/core.py-75-    scenario: Optional[str] = None
apps/api/services/agent/core.py-76-    conversation_id: Optional[str] = None
apps/api/services/agent/core.py:77:    voice_mode: Optional[str] = "warm"
apps/api/services/agent/core.py-78-    protocol_prompt: Optional[str] = None  # ÂçèËÆÆÊ®°Âºè‰∏ìÁî® prompt
/home/aiscend/work/vibelife/apps/api/services/agent/core.py-79-
/home/aiscend/work/vibelife/apps/api/services/agent/core.py-80-
apps/api/services/agent/core.py-81-def build_use_skill_tool() -> Dict[str, Any]:
/home/aiscend/work/vibelife/apps/api/services/agent/core.py-82-    """
--
apps/api/services/proactive/content_generator.py-288-                    logger.warning(f"Knowledge search failed for query '{query}': {e}")
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-289-
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-290-        # Ëé∑ÂèñÁî®Êà∑ÁâπÂæÅ
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-291-        life_context = profile.get("life_context", {})
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-292-        preferences = profile.get("preferences", {})
apps/api/services/proactive/content_generator.py:293:        voice_mode = preferences.get("voice_mode", "warm")
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-294-
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-295-        # ÊûÑÂª∫ prompt
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-296-        context_str = "\n".join([
apps/api/services/proactive/content_generator.py-297-            f"- {chunk.get('content', '')[:200]}"
apps/api/services/proactive/content_generator.py-298-            for chunk in knowledge_context[:5]
--
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-354-        day_master_element = day_master.get("element", "wood")
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-355-
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-356-        # Ëé∑ÂèñÁî®Êà∑ÂÖ≥Ê≥®ÁÇπ
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-357-        concerns = life_context.get("concerns", [])
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-358-        goals = life_context.get("goals", [])
apps/api/services/proactive/content_generator.py:359:        voice_mode = preferences.get("voice_mode", "warm")
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-360-
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-361-        # ËÆ°ÁÆó‰ªäÊó•ËøêÂäø
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-362-        from skills.bazi.services import BaziComputer
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-363-        computer = BaziComputer()
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-364-        daily_fortune = await computer.calculate_daily_fortune(profile)
--
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-731-
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-732-    async def _generate_with_llm(
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-733-        self,
apps/api/services/proactive/content_generator.py-734-        template_type: str,
apps/api/services/proactive/content_generator.py-735-        context: Dict[str, Any],
apps/api/services/proactive/content_generator.py:736:        voice_mode: str = "warm",
apps/api/services/proactive/content_generator.py-737-    ) -> Dict[str, Any]:
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-738-        """‰ΩøÁî® LLM ÁîüÊàê‰∏™ÊÄßÂåñÂÜÖÂÆπ"""
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-739-        from services.llm import create_system_message, create_user_message
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-740-
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-741-        # ÊûÑÂª∫ prompt
--
apps/api/services/proactive/content_generator.py-771-            "warm": "‰Ω†ÊòØ VibeÔºå‰∏Ä‰∏™Ê∏©Êöñ„ÄÅÂÖ±ÊÉÖ„ÄÅÊîØÊåÅÁöÑ AI Áü•Â∑±„ÄÇÁî®Ê∏©ÊöñÁöÑËØ≠Ê∞î‰∏éÁî®Êà∑‰∫§ÊµÅ„ÄÇ",
apps/api/services/proactive/content_generator.py-772-            "sarcastic": "‰Ω†ÊòØ VibeÔºå‰∏Ä‰∏™Áõ¥Êé•„ÄÅÁäÄÂà©‰ΩÜÊúâË∂£ÁöÑ AI ÊçüÂèã„ÄÇÁî®ÂπΩÈªòÁöÑÊñπÂºèÁªôÂá∫Âª∫ËÆÆ„ÄÇ",
apps/api/services/proactive/content_generator.py-773-            "wise": "‰Ω†ÊòØ VibeÔºå‰∏Ä‰∏™ÁêÜÊÄß„ÄÅÊ∑±Â∫¶„ÄÅÂÉèÈïøËæà‰∏ÄÊ†∑ÁöÑ AI ÂØºÂ∏à„ÄÇÁî®ÁùøÊô∫ÁöÑÊñπÂºèÊåáÁÇπËø∑Ê¥•„ÄÇ",
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-774-        }
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-775-
apps/api/services/proactive/content_generator.py:776:        base_prompt = voice_styles.get(voice_mode, voice_styles["warm"])
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-777-
apps/api/services/proactive/content_generator.py-778-        if template_type == "daily_fortune":
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-779-            return f"""{base_prompt}
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-780-
/home/aiscend/work/vibelife/apps/api/services/proactive/content_generator.py-781-Áé∞Âú®Ë¶Å‰∏∫Áî®Êà∑ÁîüÊàê‰∏ÄÊù°‰∏™ÊÄßÂåñÁöÑÊØèÊó•ËøêÂäøÊèêÈÜí„ÄÇ
--
/home/aiscend/work/vibelife/apps/api/services/identity/oauth.py-143-            # Create skill profile if onboarding data provided
apps/api/services/identity/oauth.py-144-            if onboarding_data and onboarding_data.get("skill"):
/home/aiscend/work/vibelife/apps/api/services/identity/oauth.py-145-                await UserRepository.create_skill_profile(
/home/aiscend/work/vibelife/apps/api/services/identity/oauth.py-146-                    user_id=user["id"],
/home/aiscend/work/vibelife/apps/api/services/identity/oauth.py-147-                    skill=onboarding_data["skill"],
apps/api/services/identity/oauth.py:148:                    voice_mode=onboarding_data.get("voice_mode", "warm"),
/home/aiscend/work/vibelife/apps/api/services/identity/oauth.py-149-                    profile_data={
apps/api/services/identity/oauth.py-150-                        "interview_responses": onboarding_data.get("interview_responses", {}),
apps/api/services/identity/oauth.py-151-                        "focus_areas": onboarding_data.get("focus_areas", [])
/home/aiscend/work/vibelife/apps/api/services/identity/oauth.py-152-                    }
/home/aiscend/work/vibelife/apps/api/services/identity/oauth.py-153-                )
--
/home/aiscend/work/vibelife/apps/api/services/identity/oauth.py-301-            # Create skill profile if onboarding data provided
apps/api/services/identity/oauth.py-302-            if onboarding_data and onboarding_data.get("skill"):
/home/aiscend/work/vibelife/apps/api/services/identity/oauth.py-303-                await UserRepository.create_skill_profile(
/home/aiscend/work/vibelife/apps/api/services/identity/oauth.py-304-                    user_id=user["id"],
/home/aiscend/work/vibelife/apps/api/services/identity/oauth.py-305-                    skill=onboarding_data["skill"],
apps/api/services/identity/oauth.py:306:                    voice_mode=onboarding_data.get("voice_mode", "warm"),
/home/aiscend/work/vibelife/apps/api/services/identity/oauth.py-307-                    profile_data={
apps/api/services/identity/oauth.py-308-                        "interview_responses": onboarding_data.get("interview_responses", {}),
apps/api/services/identity/oauth.py-309-                        "focus_areas": onboarding_data.get("focus_areas", [])
/home/aiscend/work/vibelife/apps/api/services/identity/oauth.py-310-                    }
/home/aiscend/work/vibelife/apps/api/services/identity/oauth.py-311-                )
--
/home/aiscend/work/vibelife/apps/api/services/identity/wechat.py-346-            # Create skill profile if onboarding data provided
apps/api/services/identity/wechat.py-347-            if onboarding_data and onboarding_data.get("skill"):
/home/aiscend/work/vibelife/apps/api/services/identity/wechat.py-348-                await UserRepository.create_skill_profile(
/home/aiscend/work/vibelife/apps/api/services/identity/wechat.py-349-                    user_id=user["id"],
/home/aiscend/work/vibelife/apps/api/services/identity/wechat.py-350-                    skill=onboarding_data["skill"],
apps/api/services/identity/wechat.py:351:                    voice_mode=onboarding_data.get("voice_mode", "warm"),
/home/aiscend/work/vibelife/apps/api/services/identity/wechat.py-352-                    profile_data={
apps/api/services/identity/wechat.py-353-                        "interview_responses": onboarding_data.get("interview_responses", {}),
apps/api/services/identity/wechat.py-354-                        "focus_areas": onboarding_data.get("focus_areas", [])
/home/aiscend/work/vibelife/apps/api/services/identity/wechat.py-355-                    }
/home/aiscend/work/vibelife/apps/api/services/identity/wechat.py-356-                )
--
/home/aiscend/work/vibelife/apps/api/scripts/test_coreagent_zodiac.py-187-
/home/aiscend/work/vibelife/apps/api/scripts/test_coreagent_zodiac.py-188-        # ÂàõÂª∫ Profile
/home/aiscend/work/vibelife/apps/api/scripts/test_coreagent_zodiac.py-189-        await UnifiedProfileRepository.create_profile(test_user_id, {
apps/api/scripts/test_coreagent_zodiac.py-190-            "birth_info": test_user["birth_info"],
apps/api/scripts/test_coreagent_zodiac.py-191-            "life_context": {"test": True},
apps/api/scripts/test_coreagent_zodiac.py:192:            "preferences": {"voice_mode": "warm"}
/home/aiscend/work/vibelife/apps/api/scripts/test_coreagent_zodiac.py-193-        })
/home/aiscend/work/vibelife/apps/api/scripts/test_coreagent_zodiac.py-194-        results.add_pass("ÂàõÂª∫ Profile")
/home/aiscend/work/vibelife/apps/api/scripts/test_coreagent_zodiac.py-195-
/home/aiscend/work/vibelife/apps/api/scripts/test_coreagent_zodiac.py-196-        # ËØªÂèñ Profile
/home/aiscend/work/vibelife/apps/api/scripts/test_coreagent_zodiac.py-197-        profile = await UnifiedProfileRepository.get_profile(test_user_id)
--
/home/aiscend/work/vibelife/apps/api/scripts/test_core_agent.py-122-        user_tier=user_data["user_tier"],
/home/aiscend/work/vibelife/apps/api/scripts/test_core_agent.py-123-        profile=user_data["profile"],
/home/aiscend/work/vibelife/apps/api/scripts/test_core_agent.py-124-        skill_data=user_data["skill_data"],
/home/aiscend/work/vibelife/apps/api/scripts/test_core_agent.py-125-        history=[],
/home/aiscend/work/vibelife/apps/api/scripts/test_core_agent.py-126-        skill=scenario.get("skill"),
apps/api/scripts/test_core_agent.py:127:        voice_mode="warm"
/home/aiscend/work/vibelife/apps/api/scripts/test_core_agent.py-128-    )
/home/aiscend/work/vibelife/apps/api/scripts/test_core_agent.py-129-
apps/api/scripts/test_core_agent.py-130-    print(f"\nüîπ Áî®Êà∑ËæìÂÖ•: {scenario['message']}")
apps/api/scripts/test_core_agent.py-131-    print(f"üîπ ÊúüÊúõË°å‰∏∫: {scenario['expected_behavior']}")
/home/aiscend/work/vibelife/apps/api/scripts/test_core_agent.py-132-    print(f"\n{'‚îÄ'*70}")
--
/home/aiscend/work/vibelife/apps/api/scripts/test_real_user_scenarios.py-361-        user_tier="paid",
/home/aiscend/work/vibelife/apps/api/scripts/test_real_user_scenarios.py-362-        profile=user_data["profile"],
/home/aiscend/work/vibelife/apps/api/scripts/test_real_user_scenarios.py-363-        skill_data=user_data["profile"].get("skill_data", {}),
/home/aiscend/work/vibelife/apps/api/scripts/test_real_user_scenarios.py-364-        history=[],
/home/aiscend/work/vibelife/apps/api/scripts/test_real_user_scenarios.py-365-        skill=scenario.skill,
apps/api/scripts/test_real_user_scenarios.py:366:        voice_mode="warm"
/home/aiscend/work/vibelife/apps/api/scripts/test_real_user_scenarios.py-367-    )
/home/aiscend/work/vibelife/apps/api/scripts/test_real_user_scenarios.py-368-
/home/aiscend/work/vibelife/apps/api/scripts/test_real_user_scenarios.py-369-    # ÂàõÂª∫ Agent
/home/aiscend/work/vibelife/apps/api/scripts/test_real_user_scenarios.py-370-    agent = create_agent(max_iterations=5)
/home/aiscend/work/vibelife/apps/api/scripts/test_real_user_scenarios.py-371-
--
apps/api/routes/skills.py-452-        if profile:
/home/aiscend/work/vibelife/apps/api/routes/skills.py-453-            preferences = profile.get("preferences", {})
/home/aiscend/work/vibelife/apps/api/routes/skills.py-454-            push_settings = preferences.get("push_settings", {})
/home/aiscend/work/vibelife/apps/api/routes/skills.py-455-            settings = {
apps/api/routes/skills.py-456-                "skill_id": skill_id,
apps/api/routes/skills.py:457:                "voice_mode": preferences.get("voice_mode", "warm"),
apps/api/routes/skills.py-458-                "reminder_hour": push_settings.get("default_push_hour", 8),
apps/api/routes/skills.py-459-                "custom_settings": {},
/home/aiscend/work/vibelife/apps/api/routes/skills.py-460-            }
/home/aiscend/work/vibelife/apps/api/routes/skills.py-461-
/home/aiscend/work/vibelife/apps/api/routes/skills.py-462-            # Ê£ÄÊü•ÊòØÂê¶È¶ñÊ¨°‰ΩøÁî®
--
/home/aiscend/work/vibelife/apps/api/routes/skills.py-521-    preferences = profile.get("preferences", {}) if profile else {}
/home/aiscend/work/vibelife/apps/api/routes/skills.py-522-    push_settings = preferences.get("push_settings", {})
/home/aiscend/work/vibelife/apps/api/routes/skills.py-523-
/home/aiscend/work/vibelife/apps/api/routes/skills.py-524-    settings = {
apps/api/routes/skills.py-525-        "skill_id": skill_id,
apps/api/routes/skills.py:526:        "voice_mode": preferences.get("voice_mode", "warm"),
apps/api/routes/skills.py-527-        "reminder_hour": push_settings.get("default_push_hour", 8),
apps/api/routes/skills.py-528-        "custom_settings": {},
/home/aiscend/work/vibelife/apps/api/routes/skills.py-529-    }
/home/aiscend/work/vibelife/apps/api/routes/skills.py-530-
/home/aiscend/work/vibelife/apps/api/routes/skills.py-531-    sub = await UnifiedProfileRepository.get_skill_subscription(current_user.user_id, skill_id)
--
apps/api/routes/chat_v5.py-55-    message: Optional[str] = Field(None, description="User message (simple format)")
apps/api/routes/chat_v5.py-56-    messages: Optional[list[MessageItem]] = Field(None, description="Messages array (AI SDK format, used for user message extraction only)")
apps/api/routes/chat_v5.py-57-    conversation_id: Optional[UUID] = Field(None, description="Conversation ID")
apps/api/routes/chat_v5.py-58-    skill: Optional[str] = Field(None, description="Skill ID (bazi/zodiac/career/tarot)")
apps/api/routes/chat_v5.py-59-    scenario: Optional[str] = Field(None, description="Scenario/Rule ID (dankoe/covey/weekly-review)")
apps/api/routes/chat_v5.py:60:    voice_mode: Optional[str] = Field(None, description="Voice mode (warm/sarcastic)")
/home/aiscend/work/vibelife/apps/api/routes/chat_v5.py-61-
apps/api/routes/chat_v5.py-62-    def get_user_message(self) -> str:
/home/aiscend/work/vibelife/apps/api/routes/chat_v5.py-63-        """Extract user message from either format"""
apps/api/routes/chat_v5.py-64-        if self.message:
/home/aiscend/work/vibelife/apps/api/routes/chat_v5.py-65-            return self.message
--
/home/aiscend/work/vibelife/apps/api/routes/chat_v5.py-148-        existing = await conversation_repo.get_conversation(conversation_id)
apps/api/routes/chat_v5.py-149-        if not existing:
/home/aiscend/work/vibelife/apps/api/routes/chat_v5.py-150-            await conversation_repo.create_conversation(
/home/aiscend/work/vibelife/apps/api/routes/chat_v5.py-151-                skill=skill or "core",
/home/aiscend/work/vibelife/apps/api/routes/chat_v5.py-152-                user_id=user_id,
apps/api/routes/chat_v5.py:153:                voice_mode=voice_mode or "warm",
/home/aiscend/work/vibelife/apps/api/routes/chat_v5.py-154-                conversation_id=conversation_id
/home/aiscend/work/vibelife/apps/api/routes/chat_v5.py-155-            )
apps/api/routes/chat_v5.py-156-    except Exception as e:
apps/api/routes/chat_v5.py-157-        logger.warning(f"Failed to ensure conversation: {e}")
/home/aiscend/work/vibelife/apps/api/routes/chat_v5.py-158-
--
apps/api/routes/account.py-40-class OnboardingData(BaseModel):
/home/aiscend/work/vibelife/apps/api/routes/account.py-41-    """Onboarding data to associate with registration"""
apps/api/routes/account.py-42-    birth_datetime: Optional[datetime] = None
apps/api/routes/account.py-43-    birth_location: Optional[str] = None
apps/api/routes/account.py-44-    gender: Optional[str] = None
apps/api/routes/account.py:45:    voice_mode: Optional[str] = "warm"
apps/api/routes/account.py-46-    skill: Optional[str] = "bazi"
apps/api/routes/account.py-47-    interview_responses: Optional[dict] = None
apps/api/routes/account.py-48-    focus_areas: Optional[List[str]] = None
/home/aiscend/work/vibelife/apps/api/routes/account.py-49-
/home/aiscend/work/vibelife/apps/api/routes/account.py-50-
--
/home/aiscend/work/vibelife/apps/api/routes/account.py-142-
/home/aiscend/work/vibelife/apps/api/routes/account.py-143-
/home/aiscend/work/vibelife/apps/api/routes/account.py-144-# --- Preferences Models ---
/home/aiscend/work/vibelife/apps/api/routes/account.py-145-
apps/api/routes/account.py-146-class PreferencesResponse(BaseModel):
apps/api/routes/account.py:147:    voice_mode: str = "warm"
apps/api/routes/account.py-148-    language: str = "zh-CN"
/home/aiscend/work/vibelife/apps/api/routes/account.py-149-
/home/aiscend/work/vibelife/apps/api/routes/account.py-150-
apps/api/routes/account.py-151-class PreferencesUpdateRequest(BaseModel):
apps/api/routes/account.py-152-    voice_mode: Optional[str] = None
--
/home/aiscend/work/vibelife/apps/api/routes/account.py-554-@router.get("/preferences", response_model=PreferencesResponse)
apps/api/routes/account.py-555-async def get_preferences(current_user: CurrentUser = Depends(get_current_user)):
/home/aiscend/work/vibelife/apps/api/routes/account.py-556-    """Get current user's preferences (voice_mode, language, etc.)"""
/home/aiscend/work/vibelife/apps/api/routes/account.py-557-    preferences = await UnifiedProfileRepository.get_preferences(current_user.user_id)
/home/aiscend/work/vibelife/apps/api/routes/account.py-558-    return PreferencesResponse(
apps/api/routes/account.py:559:        voice_mode=preferences.get("voice_mode", "warm"),
/home/aiscend/work/vibelife/apps/api/routes/account.py-560-        language=preferences.get("language", "zh-CN")
/home/aiscend/work/vibelife/apps/api/routes/account.py-561-    )
/home/aiscend/work/vibelife/apps/api/routes/account.py-562-
/home/aiscend/work/vibelife/apps/api/routes/account.py-563-
/home/aiscend/work/vibelife/apps/api/routes/account.py-564-@router.put("/preferences", response_model=PreferencesResponse)
--
/home/aiscend/work/vibelife/apps/api/routes/account.py-573-        await UnifiedProfileRepository.update_preferences(current_user.user_id, update_data)
/home/aiscend/work/vibelife/apps/api/routes/account.py-574-
/home/aiscend/work/vibelife/apps/api/routes/account.py-575-    # Return updated preferences
/home/aiscend/work/vibelife/apps/api/routes/account.py-576-    preferences = await UnifiedProfileRepository.get_preferences(current_user.user_id)
/home/aiscend/work/vibelife/apps/api/routes/account.py-577-    return PreferencesResponse(
apps/api/routes/account.py:578:        voice_mode=preferences.get("voice_mode", "warm"),
/home/aiscend/work/vibelife/apps/api/routes/account.py-579-        language=preferences.get("language", "zh-CN")
/home/aiscend/work/vibelife/apps/api/routes/account.py-580-    )
/home/aiscend/work/vibelife/apps/api/routes/account.py-581-
/home/aiscend/work/vibelife/apps/api/routes/account.py-582-
/home/aiscend/work/vibelife/apps/api/routes/account.py-583-@router.get("/profile/export")
--
/home/aiscend/work/vibelife/apps/api/stores/user_repo.py-373-
/home/aiscend/work/vibelife/apps/api/stores/user_repo.py-374-    @staticmethod
/home/aiscend/work/vibelife/apps/api/stores/user_repo.py-375-    async def create_skill_profile(
apps/api/stores/user_repo.py-376-        user_id: UUID,
apps/api/stores/user_repo.py-377-        skill: str,
apps/api/stores/user_repo.py:378:        voice_mode: str = "warm",
apps/api/stores/user_repo.py-379-        profile_data: Optional[dict] = None
apps/api/stores/user_repo.py-380-    ) -> dict:
/home/aiscend/work/vibelife/apps/api/stores/user_repo.py-381-        """Create or update skill profile with voice_mode and profile_data"""
/home/aiscend/work/vibelife/apps/api/stores/user_repo.py-382-        import json
/home/aiscend/work/vibelife/apps/api/stores/user_repo.py-383-        # Merge voice_mode into profile_data since table doesn't have voice_mode column
--
apps/api/stores/conversation_repo.py-56-    def from_row(cls, row: dict) -> "ConversationRecord":
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-57-        return cls(
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-58-            id=row["id"],
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-59-            user_id=row.get("user_id"),
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-60-            skill=row["skill"],
apps/api/stores/conversation_repo.py:61:            voice_mode=row.get("voice_mode", "warm"),
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-62-            title=row.get("title"),
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-63-            is_active=row.get("is_active", True),
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-64-            created_at=row.get("created_at"),
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-65-            updated_at=row.get("updated_at"),
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-66-        )
--
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-71-# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-72-
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-73-async def create_conversation(
apps/api/stores/conversation_repo.py-74-    skill: str,
apps/api/stores/conversation_repo.py-75-    user_id: Optional[UUID] = None,
apps/api/stores/conversation_repo.py:76:    voice_mode: str = "warm",
apps/api/stores/conversation_repo.py-77-    title: Optional[str] = None,
apps/api/stores/conversation_repo.py-78-    conversation_id: Optional[UUID] = None
apps/api/stores/conversation_repo.py-79-) -> ConversationRecord:
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-80-    """
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-81-    Create a new conversation.
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-82-
apps/api/stores/conversation_repo.py-83-    Args:
apps/api/stores/conversation_repo.py-84-        skill: bazi or zodiac
apps/api/stores/conversation_repo.py-85-        user_id: Optional user ID (None for guests)
apps/api/stores/conversation_repo.py:86:        voice_mode: warm or sarcastic
apps/api/stores/conversation_repo.py-87-        title: Optional conversation title
apps/api/stores/conversation_repo.py-88-        conversation_id: Optional specific ID to use
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-89-
apps/api/stores/conversation_repo.py-90-    Returns:
/home/aiscend/work/vibelife/apps/api/stores/conversation_repo.py-91-        Created ConversationRecord
--
apps/api/stores/unified_profile_repo.py-27-        "focus": ["career", "health"],
apps/api/stores/unified_profile_repo.py-28-        "updated_at": "2026-01-19T10:00:00Z"
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-29-    },
apps/api/stores/unified_profile_repo.py-30-    "life_context": {...},
apps/api/stores/unified_profile_repo.py-31-    "preferences": {
apps/api/stores/unified_profile_repo.py:32:        "voice_mode": "warm",
apps/api/stores/unified_profile_repo.py-33-        "language": "zh-CN",
apps/api/stores/unified_profile_repo.py-34-        "timezone": "Asia/Shanghai",
apps/api/stores/unified_profile_repo.py-35-        "subscribed_skills": {
apps/api/stores/unified_profile_repo.py-36-            "bazi": {"status": "subscribed", "push_enabled": true, ...},
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-37-            ...
--
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-191-    @staticmethod
apps/api/stores/unified_profile_repo.py-192-    async def get_preferences(user_id: UUID) -> Dict[str, Any]:
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-193-        """Ëé∑ÂèñÁî®Êà∑ÂÅèÂ•Ω"""
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-194-        profile = await UnifiedProfileRepository.get_profile(user_id)
apps/api/stores/unified_profile_repo.py-195-        if profile:
apps/api/stores/unified_profile_repo.py:196:            return profile.get("preferences", {"voice_mode": "warm", "language": "zh-CN"})
apps/api/stores/unified_profile_repo.py:197:        return {"voice_mode": "warm", "language": "zh-CN"}
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-198-
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-199-    @staticmethod
apps/api/stores/unified_profile_repo.py-200-    async def get_life_context(user_id: UUID) -> Dict[str, Any]:
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-201-        """Ëé∑ÂèñÁîüÊ¥ª‰∏ä‰∏ãÊñá"""
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-202-        profile = await UnifiedProfileRepository.get_profile(user_id)
--
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-298-        profile = initial_profile or {
apps/api/stores/unified_profile_repo.py-299-            "account": {},  # Will be synced from vibe_users via trigger
apps/api/stores/unified_profile_repo.py-300-            "birth_info": {},
apps/api/stores/unified_profile_repo.py-301-            "state": {"focus": [], "updated_at": None},
apps/api/stores/unified_profile_repo.py-302-            "life_context": {},
apps/api/stores/unified_profile_repo.py:303:            "preferences": {"voice_mode": "warm", "language": "zh-CN"},
apps/api/stores/unified_profile_repo.py-304-            "skill_data": {}
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-305-        }
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-306-
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-307-        await execute(
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-308-            """INSERT INTO unified_profiles (user_id, profile)
--
apps/api/stores/unified_profile_repo.py-335-        else:
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-336-            # ‰∏çÂ≠òÂú®ÂàôÂàõÂª∫
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-337-            default_profile = {
apps/api/stores/unified_profile_repo.py-338-                "birth_info": {},
apps/api/stores/unified_profile_repo.py-339-                "life_context": {},
apps/api/stores/unified_profile_repo.py:340:                "preferences": {"voice_mode": "warm", "language": "zh-CN"},
apps/api/stores/unified_profile_repo.py-341-                "skill_data": {}
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-342-            }
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-343-            merged = deep_merge(default_profile, updates)
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-344-            await execute(
/home/aiscend/work/vibelife/apps/api/stores/unified_profile_repo.py-345-                """INSERT INTO unified_profiles (user_id, profile)