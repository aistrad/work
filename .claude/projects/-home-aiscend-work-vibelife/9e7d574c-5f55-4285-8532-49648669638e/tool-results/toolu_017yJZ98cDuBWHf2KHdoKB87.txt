     1→# VibeLife 前端设计方案 v6.1
     2→## 对接 V6.8 后端架构 + 「暖阳神秘」设计系统升级
     3→
     4→---
     5→
     6→```
     7→╔══════════════════════════════════════════════════════════════════════════════╗
     8→║                                                                              ║
     9→║   ██╗   ██╗██╗██████╗ ███████╗██╗     ██╗███████╗███████╗                    ║
    10→║   ██║   ██║██║██╔══██╗██╔════╝██║     ██║██╔════╝██╔════╝                    ║
    11→║   ██║   ██║██║██████╔╝█████╗  ██║     ██║█████╗  █████╗                      ║
    12→║   ╚██╗ ██╔╝██║██╔══██╗██╔══╝  ██║     ██║██╔══╝  ██╔══╝                      ║
    13→║    ╚████╔╝ ██║██████╔╝███████╗███████╗██║██║     ███████╗                    ║
    14→║     ╚═══╝  ╚═╝╚═════╝ ╚══════╝╚══════╝╚═╝╚═╝     ╚══════╝                    ║
    15→║                                                                              ║
    16→║                 Frontend v6.1 - 对接 Backend v6.8                            ║
    17→║                                                                              ║
    18→║           「暖阳神秘」设计系统 · Skill Gateway · 动态工具卡片                ║
    19→║                                                                              ║
    20→╚══════════════════════════════════════════════════════════════════════════════╝
    21→```
    22→
    23→---
    24→
    25→## 文档概述
    26→
    27→### 版本对照
    28→
    29→| 层级 | 版本 | 核心变更 |
    30→|------|------|---------|
    31→| 后端 | v6.8 | Skill Gateway 统一路由、SkillServiceRegistry 自动发现、CoreAgent Agentic Loop |
    32→| 前端 | v6.1 | 适配 Skill Gateway、Design Token 统一、「暖阳神秘」配色、基础组件库补全 |
    33→
    34→### 北极星目标
    35→
    36→> **让用户在90秒内感受到"终于有人懂我"的温暖，并清楚知道"还能问什么"**
    37→
    38→**核心体验指标**：
    39→- Onboarding 完成率：65% → 85%
    40→- "洞察击中感"评分：3.2 → 4.6 (满分5)
    41→- 服务发现点击率：— → 60%
    42→- 服务推荐接受率：— → 35%
    43→- D1回访率：25% → 45%
    44→- 首次付费转化：5% → 12%
    45→
    46→---
    47→
    48→# 第一篇：系统架构
    49→
    50→## 1. 前后端架构对接图
    51→
    52→```
    53→前后端架构对接图
    54→━━━━━━━━━━━━━━━
    55→
    56→┌─────────────────────────────────────────────────────────────────────────────────┐
    57→│                       Frontend Layer (Next.js 14 + AI SDK 4.x)                  │
    58→│                                                                                 │
    59→│  ┌─────────────────────────────────────────────────────────────────────────┐   │
    60→│  │                           Hooks Layer                                    │   │
    61→│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌─────────────┐  │   │
    62→│  │  │ useVibeChat  │  │useToolSchema │  │useSkillData  │  │ useAuth     │  │   │
    63→│  │  │ (对话流)      │  │ (工具Schema) │  │ (Skill数据)  │  │ (认证状态)  │  │   │
    64→│  │  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  └──────┬──────┘  │   │
    65→│  │         │                 │                 │                 │         │   │
    66→│  └─────────┼─────────────────┼─────────────────┼─────────────────┼─────────┘   │
    67→│            │                 │                 │                 │              │
    68→│  ┌─────────┼─────────────────┼─────────────────┼─────────────────┼─────────┐   │
    69→│  │         ▼                 ▼                 ▼                 ▼         │   │
    70→│  │                        API Client Layer                                 │   │
    71→│  │  ┌──────────────────────────────────────────────────────────────────┐  │   │
    72→│  │  │                     Next.js Rewrites Proxy                        │  │   │
    73→│  │  │                     /api/v1/* → Python API                        │  │   │
    74→│  │  └──────────────────────────────────────────────────────────────────┘  │   │
    75→│  │                                                                         │   │
    76→│  │  API 端点映射:                                                          │   │
    77→│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
    78→│  │  │ 对话      │ /chat/v5/stream        │ → chat_v5.py (CoreAgent)   │   │   │
    79→│  │  │ Skill服务 │ /skills/{id}/{action}  │ → skills.py (Gateway)      │   │   │
    80→│  │  │ 工具Schema│ /tools/schema          │ → tools.py                  │   │   │
    81→│  │  │ 用户/认证 │ /account/*             │ → account.py               │   │   │
    82→│  │  │ 支付/权益 │ /commerce/*            │ → commerce.py              │   │   │
    83→│  │  │ 通知     │ /notifications/*        │ → notifications.py         │   │   │
    84→│  │  └─────────────────────────────────────────────────────────────────┘   │   │
    85→│  └─────────────────────────────────────────────────────────────────────────┘   │
    86→│                                                                                 │
    87→│  ┌─────────────────────────────────────────────────────────────────────────┐   │
    88→│  │                        UI Component Layer                                │   │
    89→│  │                                                                          │   │
    90→│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌─────────────┐  │   │
    91→│  │  │ CardRegistry │  │ Chat UI      │  │ Home/Pages   │  │ Settings    │  │   │
    92→│  │  │ (动态工具卡) │  │ (对话界面)   │  │ (首页/导航)  │  │ (设置页)    │  │   │
    93→│  │  └──────────────┘  └──────────────┘  └──────────────┘  └─────────────┘  │   │
    94→│  │                                                                          │   │
    95→│  │  ┌──────────────────────────────────────────────────────────────────┐   │   │
    96→│  │  │                    Design System Layer                            │   │   │
    97→│  │  │         「暖阳神秘」 - globals.css + tailwind.config.ts           │   │   │
    98→│  │  │                                                                   │   │   │
    99→│  │  │   CSS Variables → Tailwind Tokens → Component Variants            │   │   │
   100→│  │  └──────────────────────────────────────────────────────────────────┘   │   │
   101→│  └─────────────────────────────────────────────────────────────────────────┘   │
   102→│                                                                                 │
   103→└─────────────────────────────────────────────────────────────────────────────────┘
   104→                                        │
   105→                                        ▼
   106→┌─────────────────────────────────────────────────────────────────────────────────┐
   107→│                        Backend Layer (FastAPI v6.8)                             │
   108→│                                                                                 │
   109→│   routes/                                                                       │
   110→│   ├── chat_v5.py      → CoreAgent (Agentic Loop + Tool Use)                    │
   111→│   ├── skills.py       → SkillServiceRegistry (自动发现)                        │
   112→│   ├── tools.py        → ToolRegistry (Schema API)                              │
   113→│   ├── account.py      → auth + users + identity                                │
   114→│   ├── commerce.py     → payment + billing + entitlement                        │
   115→│   └── notifications.py→ proactive notifications                                │
   116→│                                                                                 │
   117→└─────────────────────────────────────────────────────────────────────────────────┘
   118→```
   119→
   120→---
   121→
   122→## 2. 核心数据流
   123→
   124→### 2.1 对话流程（SSE Stream）
   125→
   126→```
   127→对话数据流
   128→━━━━━━━━━
   129→
   130→┌──────────┐     ┌───────────────┐     ┌───────────────┐     ┌────────────┐
   131→│ ChatInput│     │ useVibeChat   │     │ /chat/v5/     │     │ CoreAgent  │
   132→│          │     │ (AI SDK)      │     │ stream        │     │            │
   133→└────┬─────┘     └───────┬───────┘     └───────┬───────┘     └─────┬──────┘
   134→     │                   │                     │                   │
   135→     │ 1. 用户输入       │                     │                   │
   136→     │──────────────────>│                     │                   │
   137→     │                   │ 2. POST (SSE)       │                   │
   138→     │                   │────────────────────>│                   │
   139→     │                   │                     │ 3. CoreAgent.run()│
   140→     │                   │                     │──────────────────>│
   141→     │                   │                     │                   │
   142→     │                   │                     │   ┌───────────────┤
   143→     │                   │                     │   │ Agentic Loop  │
   144→     │                   │                     │   │ - LLM调用     │
   145→     │                   │                     │   │ - Tool判断    │
   146→     │                   │                     │   │ - Tool执行    │
   147→     │                   │                     │   │ - 迭代/完成   │
   148→     │                   │                     │   └───────────────┤
   149→     │                   │                     │                   │
   150→     │                   │                     │ 4. SSE Events     │
   151→     │                   │                     │<──────────────────│
   152→     │                   │ 5. AI SDK Protocol  │                   │
   153→     │                   │<────────────────────│                   │
   154→     │                   │                     │                   │
   155→     │ 6. 渲染消息       │                     │                   │
   156→     │<──────────────────│                     │                   │
   157→     │                   │                     │                   │
   158→     │ 7. 渲染工具卡片   │                     │                   │
   159→     │<──────────────────│                     │                   │
   160→     │  (CardRegistry)   │                     │                   │
   161→```
   162→
   163→### 2.2 Skill 服务调用流程
   164→
   165→```
   166→Skill 服务调用流程（适配 Skill Gateway）
   167→━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   168→
   169→┌──────────────┐     ┌───────────────┐     ┌───────────────────────────────┐
   170→│ useSkillData │     │ skills.py     │     │ SkillServiceRegistry          │
   171→│              │     │ (Gateway)     │     │                               │
   172→└──────┬───────┘     └───────┬───────┘     └───────────────┬───────────────┘
   173→       │                     │                             │
   174→       │ POST /skills/       │                             │
   175→       │ bazi/chart          │                             │
   176→       │────────────────────>│                             │
   177→       │                     │ Registry.execute()          │
   178→       │                     │────────────────────────────>│
   179→       │                     │                             │
   180→       │                     │                  ┌──────────┤
   181→       │                     │                  │ 自动路由 │
   182→       │                     │                  │ 到对应   │
   183→       │                     │                  │ skill/   │
   184→       │                     │                  │ services/│
   185→       │                     │                  │ api.py   │
   186→       │                     │                  └──────────┤
   187→       │                     │                             │
   188→       │                     │ JSON Response               │
   189→       │                     │<────────────────────────────│
   190→       │ data                │                             │
   191→       │<────────────────────│                             │
   192→
   193→
   194→新增 Skill 示例路由:
   195→━━━━━━━━━━━━━━━━━━━
   196→
   197→/skills/bazi/chart        → skills/bazi/services/api.py @skill_service("bazi", "chart")
   198→/skills/bazi/fortune      → skills/bazi/services/api.py @skill_service("bazi", "fortune")
   199→/skills/bazi/kline        → skills/bazi/services/api.py @skill_service("bazi", "kline")
   200→/skills/zodiac/chart      → skills/zodiac/services/api.py @skill_service("zodiac", "chart")
   201→/skills/zodiac/transit    → skills/zodiac/services/api.py @skill_service("zodiac", "transit")
   202→/skills/tarot/draw        → skills/tarot/services/api.py @skill_service("tarot", "draw")
   203→
   204→前端无需关心路由细节，统一调用 /skills/{skill_id}/{action}
   205→```
   206→
   207→---
   208→
   209→## 3. API 接口清单（对接 v6.8）
   210→
   211→```
   212→API 接口清单（v6.8 对接）
   213→━━━━━━━━━━━━━━━━━━━━━━━━
   214→
   215→┌─────────────────────────────────────────────────────────────────────────────┐
   216→│                                                                             │
   217→│   对话系统 (chat_v5.py)                                                     │
   218→│   ─────────────────────                                                    │
   219→│                                                                             │
   220→│   POST /api/v1/chat/v5/stream                                              │
   221→│   Request:                                                                  │
   222→│   {                                                                         │
   223→│     "message": string,                                                      │
   224→│     "conversation_id": string?,                                            │
   225→│     "skill": string?,           // "bazi" | "zodiac" | "tarot" | null      │
   226→│     "scenario": string?         // 场景标识                                │
   227→│   }                                                                         │
   228→│   Response: SSE Stream (AI SDK Data Protocol)                              │
   229→│   Events: text-delta | tool-call | tool-result | finish                    │
   230→│                                                                             │
   231→│   ─────────────────────────────────────────────────────────────            │
   232→│                                                                             │
   233→│   Skill Gateway (skills.py) - 统一路由                                     │
   234→│   ────────────────────────────────────                                     │
   235→│                                                                             │
   236→│   POST /api/v1/skills/{skill_id}/{action}                                  │
   237→│   Request: { ...action_specific_params }                                   │
   238→│   Response: { ...action_specific_result }                                  │
   239→│                                                                             │
   240→│   示例:                                                                     │
   241→│   POST /api/v1/skills/bazi/chart                                           │
   242→│   → { birth_datetime, gender, location? }                                  │
   243→│   → { pillars, elements, day_master, analysis }                            │
   244→│                                                                             │
   245→│   POST /api/v1/skills/bazi/fortune                                         │
   246→│   → { user_id, period: "year" | "month" | "day" }                          │
   247→│   → { fortune_analysis, energy_flow, suggestions }                         │
   248→│                                                                             │
   249→│   ─────────────────────────────────────────────────────────────            │
   250→│                                                                             │
   251→│   工具 Schema (tools.py)                                                   │
   252→│   ──────────────────────                                                   │
   253→│                                                                             │
   254→│   GET /api/v1/tools/schema                                                 │
   255→│   Query: ?skill_id={skillId}                                               │
   256→│   Response:                                                                 │
   257→│   {                                                                         │
   258→│     "tools": [                                                             │
   259→│       {                                                                     │
   260→│         "name": "show_bazi_chart",                                         │
   261→│         "description": "展示八字命盘",                                     │
   262→│         "parameters": { ...json_schema },                                  │
   263→│         "card_type": "BaziChartCard",                                      │
   264→│         "card_props": { ...default_props }                                 │
   265→│       }                                                                     │
   266→│     ]                                                                       │
   267→│   }                                                                         │
   268→│                                                                             │
   269→│   ─────────────────────────────────────────────────────────────            │
   270→│                                                                             │
   271→│   用户/认证 (account.py) - 合并后                                          │
   272→│   ─────────────────────────────────                                        │
   273→│                                                                             │
   274→│   POST /api/v1/account/auth/login     # 登录                               │
   275→│   POST /api/v1/account/auth/logout    # 登出                               │
   276→│   POST /api/v1/account/auth/refresh   # 刷新Token                          │
   277→│   GET  /api/v1/account/users/me       # 当前用户信息                       │
   278→│   PUT  /api/v1/account/users/me       # 更新用户信息                       │
   279→│   GET  /api/v1/account/identity/vibe-id  # 获取 Vibe ID                    │
   280→│   DELETE /api/v1/account/users/me/data   # 清除所有数据（隐私）            │
   281→│                                                                             │
   282→│   ─────────────────────────────────────────────────────────────            │
   283→│                                                                             │
   284→│   支付/权益 (commerce.py) - 合并后                                         │
   285→│   ─────────────────────────────────                                        │
   286→│                                                                             │
   287→│   GET  /api/v1/commerce/subscriptions/plans     # 订阅计划列表            │
   288→│   POST /api/v1/commerce/subscriptions/create    # 创建订阅                │
   289→│   GET  /api/v1/commerce/subscriptions/current   # 当前订阅                │
   290→│   POST /api/v1/commerce/payments/create-intent  # 创建支付意向            │
   291→│   GET  /api/v1/commerce/entitlements            # 用户权益                │
   292→│   GET  /api/v1/commerce/billing/history         # 账单历史                │
   293→│                                                                             │
   294→│   ─────────────────────────────────────────────────────────────            │
   295→│                                                                             │
   296→│   通知 (notifications.py)                                                  │
   297→│   ───────────────────────                                                  │
   298→│                                                                             │
   299→│   GET  /api/v1/notifications                    # 通知列表                 │
   300→│   POST /api/v1/notifications/{id}/read          # 标记已读                 │
   301→│   GET  /api/v1/notifications/reminders          # 即将到来的提醒           │
   302→│                                                                             │
   303→└─────────────────────────────────────────────────────────────────────────────┘
   304→```
   305→
   306→---
   307→
   308→# 第二篇：设计系统升级
   309→
   310→## 4.「暖阳神秘」设计系统
   311→
   312→### 4.1 设计理念升级
   313→
   314→```
   315→设计理念升级
   316→━━━━━━━━━━━━
   317→
   318→┌─────────────────────────────────────────────────────────────────────────────┐
   319→│                                                                             │
   320→│   v5「暖阳美学」                    v6「暖阳神秘」                           │
   321→│   ─────────────                    ─────────────                            │
   322→│                                                                             │
   323→│   温暖、舒适、安全                  温暖 + 神秘 + 高级                       │
   324→│                                                                             │
   325→│   问题:                            升级:                                    │
   326→│   · 配色过于"柔和"                 · 新增神秘紫作为命理主题色               │
   327→│   · 缺乏神秘感/命理调性            · 深化墨色系，增加质感                   │
   328→│   · 不够高级（vs Linear/Notion）   · 统一五行色系                           │
   329→│   · Token碎片化                    · 完整 Token 体系                        │
   330→│                                                                             │
   331→│   目标:                                                                     │
   332→│   达到 Linear/Notion 级别的高端精致感，同时保持温暖基调                     │
   333→│                                                                             │
   334→└─────────────────────────────────────────────────────────────────────────────┘
   335→```
   336→
   337→### 4.2 配色系统（统一定义）
   338→
   339→```
   340→配色系统 - globals.css
   341→━━━━━━━━━━━━━━━━━━━━━━
   342→
   343→:root {
   344→  /* ═══════════════════════════════════════════════════════════════════════ */
   345→  /*                           墨色系 - 文字/背景                             */
   346→  /* ═══════════════════════════════════════════════════════════════════════ */
   347→  
   348→  --color-ink: #2D2A26;               /* 主文字色 - 更深更有质感 */
   349→  --color-ink-secondary: #6B6660;      /* 次要文字 */
   350→  --color-ink-tertiary: #9A9590;       /* 辅助文字 */
   351→  --color-ink-muted: #C5C0BB;          /* 禁用/占位文字 */
   352→  
   353→  --color-vellum: #FEFDFB;             /* 纸张白 - 主背景 */
   354→  --color-vellum-warm: #FBF9F5;        /* 暖白 - 卡片背景 */
   355→  --color-vellum-cream: #F5F2EC;       /* 奶油色 - 次级背景 */
   356→  
   357→  /* ═══════════════════════════════════════════════════════════════════════ */
   358→  /*                           强调色 - 品牌识别                              */
   359→  /* ═══════════════════════════════════════════════════════════════════════ */
   360→  
   361→  --color-antique-gold: #B8923E;       /* 古金色 - 主强调 */
   362→  --color-antique-gold-light: #D4B366; /* 浅金 - hover */
   363→  --color-antique-gold-dark: #9A7A33;  /* 深金 - active */
   364→  
   365→  --color-mystic: #4A4578;             /* 神秘紫 - 命理主题色【新增】 */
   366→  --color-mystic-light: #6B66A3;       /* 浅紫 - hover */
   367→  --color-mystic-dark: #38345A;        /* 深紫 - active */
   368→  
   369→  /* ═══════════════════════════════════════════════════════════════════════ */
   370→  /*                           五行色系 - 统一定义                            */
   371→  /* ═══════════════════════════════════════════════════════════════════════ */
   372→  
   373→  --element-wood: #4A7C59;             /* 木 - 青绿 */
   374→  --element-wood-light: #6A9C79;
   375→  --element-wood-bg: rgba(74, 124, 89, 0.1);
   376→  
   377→  --element-fire: #C75146;             /* 火 - 朱红 */
   378→  --element-fire-light: #E07166;
   379→  --element-fire-bg: rgba(199, 81, 70, 0.1);
   380→  
   381→  --element-earth: #B8923E;            /* 土 - 土黄（= 古金） */
   382→  --element-earth-light: #D4B366;
   383→  --element-earth-bg: rgba(184, 146, 62, 0.1);
   384→  
   385→  --element-metal: #8B8D8F;            /* 金 - 银灰 */
   386→  --element-metal-light: #ABADAF;
   387→  --element-metal-bg: rgba(139, 141, 143, 0.1);
   388→  
   389→  --element-water: #3A6B8C;            /* 水 - 深蓝 */
   390→  --element-water-light: #5A8BAC;
   391→  --element-water-bg: rgba(58, 107, 140, 0.1);
   392→  
   393→  /* ═══════════════════════════════════════════════════════════════════════ */
   394→  /*                           功能色 - 状态反馈                              */
   395→  /* ═══════════════════════════════════════════════════════════════════════ */
   396→  
   397→  --color-success: #4A7C59;            /* 成功 = 木 */
   398→  --color-warning: #D4A84B;            /* 警告 */
   399→  --color-error: #C75146;              /* 错误 = 火 */
   400→  --color-info: #3A6B8C;               /* 信息 = 水 */
   401→  
   402→  /* ═══════════════════════════════════════════════════════════════════════ */
   403→  /*                           阴影系统 - 层次感                              */
   404→  /* ═══════════════════════════════════════════════════════════════════════ */
   405→  
   406→  --shadow-sm: 0 1px 2px rgba(45, 42, 38, 0.05);
   407→  --shadow-md: 0 4px 6px rgba(45, 42, 38, 0.07);
   408→  --shadow-lg: 0 10px 15px rgba(45, 42, 38, 0.10);
   409→  --shadow-xl: 0 20px 25px rgba(45, 42, 38, 0.12);
   410→  
   411→  --shadow-glow-gold: 0 0 20px rgba(184, 146, 62, 0.25);     /* 金色光晕 */
   412→  --shadow-glow-mystic: 0 0 20px rgba(74, 69, 120, 0.20);    /* 紫色光晕 */
   413→  
   414→  /* ═══════════════════════════════════════════════════════════════════════ */
   415→  /*                           玻璃效果 - 毛玻璃                              */
   416→  /* ═══════════════════════════════════════════════════════════════════════ */
   417→  
   418→  --glass-bg: rgba(254, 253, 251, 0.8);
   419→  --glass-border: rgba(45, 42, 38, 0.08);
   420→  --glass-blur: blur(12px);
   421→  
   422→  /* ═══════════════════════════════════════════════════════════════════════ */
   423→  /*                           边框圆角                                       */
   424→  /* ═══════════════════════════════════════════════════════════════════════ */
   425→  
   426→  --radius-sm: 4px;
   427→  --radius-md: 8px;
   428→  --radius-lg: 12px;
   429→  --radius-xl: 16px;
   430→  --radius-2xl: 24px;
   431→  --radius-full: 9999px;
   432→  
   433→  /* ═══════════════════════════════════════════════════════════════════════ */
   434→  /*                           动效时长                                       */
   435→  /* ═══════════════════════════════════════════════════════════════════════ */
   436→  
   437→  --duration-fast: 150ms;
   438→  --duration-normal: 250ms;
   439→  --duration-slow: 400ms;
   440→  --easing-default: cubic-bezier(0.4, 0, 0.2, 1);
   441→  --easing-spring: cubic-bezier(0.16, 1, 0.3, 1);
   442→}
   443→```
   444→
   445→### 4.3 Tailwind 配置
   446→
   447→```typescript
   448→// tailwind.config.ts
   449→━━━━━━━━━━━━━━━━━━━━
   450→
   451→const config = {
   452→  theme: {
   453→    extend: {
   454→      colors: {
   455→        // 墨色系
   456→        ink: {
   457→          DEFAULT: 'var(--color-ink)',
   458→          secondary: 'var(--color-ink-secondary)',
   459→          tertiary: 'var(--color-ink-tertiary)',
   460→          muted: 'var(--color-ink-muted)',
   461→        },
   462→        vellum: {
   463→          DEFAULT: 'var(--color-vellum)',
   464→          warm: 'var(--color-vellum-warm)',
   465→          cream: 'var(--color-vellum-cream)',
   466→        },
   467→        
   468→        // 强调色
   469→        'antique-gold': {
   470→          DEFAULT: 'var(--color-antique-gold)',
   471→          light: 'var(--color-antique-gold-light)',
   472→          dark: 'var(--color-antique-gold-dark)',
   473→        },
   474→        mystic: {
   475→          DEFAULT: 'var(--color-mystic)',
   476→          light: 'var(--color-mystic-light)',
   477→          dark: 'var(--color-mystic-dark)',
   478→        },
   479→        
   480→        // 五行色
   481→        element: {
   482→          wood: 'var(--element-wood)',
   483→          fire: 'var(--element-fire)',
   484→          earth: 'var(--element-earth)',
   485→          metal: 'var(--element-metal)',
   486→          water: 'var(--element-water)',
   487→        },
   488→        
   489→        // 功能色
   490→        success: 'var(--color-success)',
   491→        warning: 'var(--color-warning)',
   492→        error: 'var(--color-error)',
   493→        info: 'var(--color-info)',
   494→      },
   495→      
   496→      boxShadow: {
   497→        'glow-gold': 'var(--shadow-glow-gold)',
   498→        'glow-mystic': 'var(--shadow-glow-mystic)',
   499→      },
   500→      
   501→      borderRadius: {
   502→        'sm': 'var(--radius-sm)',
   503→        'md': 'var(--radius-md)',
   504→        'lg': 'var(--radius-lg)',
   505→        'xl': 'var(--radius-xl)',
   506→        '2xl': 'var(--radius-2xl)',
   507→      },
   508→      
   509→      transitionDuration: {
   510→        'fast': 'var(--duration-fast)',
   511→        'normal': 'var(--duration-normal)',
   512→        'slow': 'var(--duration-slow)',
   513→      },
   514→    },
   515→  },
   516→}
   517→
   518→
   519→使用示例
   520→━━━━━━━
   521→
   522→<!-- 文字颜色 -->
   523→<p className="text-ink">主文字</p>
   524→<p className="text-ink-secondary">次要文字</p>
   525→
   526→<!-- 背景颜色 -->
   527→<div className="bg-vellum">主背景</div>
   528→<div className="bg-vellum-warm">卡片背景</div>
   529→
   530→<!-- 强调色 -->
   531→<button className="bg-antique-gold hover:bg-antique-gold-light">古金按钮</button>
   532→<button className="bg-mystic hover:bg-mystic-light">神秘紫按钮</button>
   533→
   534→<!-- 五行色 -->
   535→<span className="text-element-wood">木</span>
   536→<span className="text-element-fire">火</span>
   537→<span className="bg-element-wood/10">木背景</span>
   538→
   539→<!-- 阴影 -->
   540→<div className="shadow-glow-gold">金色光晕</div>
   541→<div className="shadow-glow-mystic">紫色光晕</div>
   542→```
   543→
   544→---
   545→
   546→## 5. 基础组件库
   547→
   548→### 5.1 组件清单
   549→
   550→```
   551→基础组件库 - 补全清单
   552→━━━━━━━━━━━━━━━━━━━━
   553→
   554→┌─────────────────────────────────────────────────────────────────────────────┐
   555→│                                                                             │
   556→│   已有组件（需优化）                                                        │
   557→│   ─────────────────                                                        │
   558→│   ┌──────────┬────────────────┬─────────────────────────────────────────┐  │
   559→│   │ 组件      │ 当前状态        │ 优化内容                                │  │
   560→│   ├──────────┼────────────────┼─────────────────────────────────────────┤  │
   561→│   │ Button   │ variants不完整  │ 使用统一token，新增mystic variant       │  │
   562→│   │ Card     │ glass样式失效   │ 修复glass-card，新增element variants   │  │
   563→│   │ Input    │ 样式基础        │ 添加focus环、error状态                  │  │
   564→│   │ TriToggle│ 质量较高        │ 保持                                    │  │
   565→│   └──────────┴────────────────┴─────────────────────────────────────────┘  │
   566→│                                                                             │
   567→│   ─────────────────────────────────────────────────────────────            │
   568→│                                                                             │
   569→│   缺失组件（需新建）                                                        │
   570→│   ─────────────────                                                        │
   571→│   ┌──────────┬────────────────────────────┬────────────────────────────┐  │
   572→│   │ 组件      │ 用途                        │ 设计要点                    │  │
   573→│   ├──────────┼────────────────────────────┼────────────────────────────┤  │
   574→│   │ Badge    │ 标签/徽章/状态              │ 支持五行色 variants         │  │
   575→│   │ Avatar   │ 头像/用户标识               │ 支持图片/文字/fallback      │  │
   576→│   │ Switch   │ 开关/布尔选择               │ 替代原生checkbox            │  │
   577→│   │ Dialog   │ 模态框/确认框               │ 基于Radix UI，动画流畅      │  │
   578→│   │ Dropdown │ 下拉菜单                    │ 键盘可访问                  │  │
   579→│   │ Tooltip  │ 工具提示                    │ 延迟显示，位置智能          │  │
   580→│   │ Toast    │ 轻提示                      │ 队列管理，自动消失          │  │
   581→│   │ Skeleton │ 加载占位                    │ 动画效果                    │  │
   582→│   └──────────┴────────────────────────────┴────────────────────────────┘  │
   583→│                                                                             │
   584→└─────────────────────────────────────────────────────────────────────────────┘
   585→```
   586→
   587→### 5.2 Button 组件（优化后）
   588→
   589→```tsx
   590→// components/ui/Button.tsx
   591→━━━━━━━━━━━━━━━━━━━━━━━━━
   592→
   593→import { cva, type VariantProps } from 'class-variance-authority'
   594→
   595→const buttonVariants = cva(
   596→  // 基础样式
   597→  'inline-flex items-center justify-center rounded-lg font-medium ' +
   598→  'transition-all duration-normal ease-default ' +
   599→  'focus:outline-none focus:ring-2 focus:ring-offset-2 ' +
   600→  'disabled:opacity-50 disabled:cursor-not-allowed',
   601→  {
   602→    variants: {
   603→      variant: {
   604→        // 主按钮 - 古金色
   605→        primary: 
   606→          'bg-antique-gold text-vellum ' +
   607→          'hover:bg-antique-gold-light hover:shadow-glow-gold ' +
   608→          'focus:ring-antique-gold/50 ' +
   609→          'active:bg-antique-gold-dark',
   610→        
   611→        // 神秘紫按钮【新增】
   612→        mystic:
   613→          'bg-mystic text-vellum ' +
   614→          'hover:bg-mystic-light hover:shadow-glow-mystic ' +
   615→          'focus:ring-mystic/50 ' +
   616→          'active:bg-mystic-dark',
   617→        
   618→        // 次级按钮
   619→        secondary:
   620→          'bg-vellum-cream text-ink border border-ink/10 ' +
   621→          'hover:bg-vellum-warm hover:border-ink/20 ' +
   622→          'focus:ring-ink/20',
   623→        
   624→        // 幽灵按钮
   625→        ghost:
   626→          'bg-transparent text-ink ' +
   627→          'hover:bg-ink/5 ' +
   628→          'focus:ring-ink/20',
   629→        
   630→        // 链接样式
   631→        link:
   632→          'bg-transparent text-antique-gold underline-offset-4 ' +
   633→          'hover:underline ' +
   634→          'focus:ring-antique-gold/50',
   635→        
   636→        // 危险操作
   637→        danger:
   638→          'bg-error text-vellum ' +
   639→          'hover:bg-element-fire-light ' +
   640→          'focus:ring-error/50',
   641→      },
   642→      size: {
   643→        sm: 'h-8 px-3 text-sm',
   644→        md: 'h-10 px-4 text-sm',
   645→        lg: 'h-12 px-6 text-base',
   646→        icon: 'h-10 w-10',
   647→      },
   648→    },
   649→    defaultVariants: {
   650→      variant: 'primary',
   651→      size: 'md',
   652→    },
   653→  }
   654→)
   655→
   656→interface ButtonProps 
   657→  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
   658→    VariantProps<typeof buttonVariants> {
   659→  loading?: boolean
   660→}
   661→
   662→export function Button({ 
   663→  className, 
   664→  variant, 
   665→  size, 
   666→  loading,
   667→  children,
   668→  ...props 
   669→}: ButtonProps) {
   670→  return (
   671→    <button
   672→      className={buttonVariants({ variant, size, className })}
   673→      disabled={loading || props.disabled}
   674→      {...props}
   675→    >
   676→      {loading && <Spinner className="mr-2 h-4 w-4 animate-spin" />}
   677→      {children}
   678→    </button>
   679→  )
   680→}
   681→```
   682→
   683→### 5.3 Badge 组件（新建）
   684→
   685→```tsx
   686→// components/ui/Badge.tsx
   687→━━━━━━━━━━━━━━━━━━━━━━━━
   688→
   689→import { cva, type VariantProps } from 'class-variance-authority'
   690→
   691→const badgeVariants = cva(
   692→  'inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium transition-colors',
   693→  {
   694→    variants: {
   695→      variant: {
   696→        default: 'bg-vellum-cream text-ink border border-ink/10',
   697→        
   698→        // 五行色系
   699→        wood: 'bg-element-wood/10 text-element-wood border border-element-wood/20',
   700→        fire: 'bg-element-fire/10 text-element-fire border border-element-fire/20',
   701→        earth: 'bg-element-earth/10 text-element-earth border border-element-earth/20',
   702→        metal: 'bg-element-metal/10 text-element-metal border border-element-metal/20',
   703→        water: 'bg-element-water/10 text-element-water border border-element-water/20',
   704→        
   705→        // 品牌色
   706→        gold: 'bg-antique-gold/10 text-antique-gold border border-antique-gold/20',
   707→        mystic: 'bg-mystic/10 text-mystic border border-mystic/20',
   708→        
   709→        // 功能色
   710→        success: 'bg-success/10 text-success border border-success/20',
   711→        warning: 'bg-warning/10 text-warning border border-warning/20',
   712→        error: 'bg-error/10 text-error border border-error/20',
   713→      },
   714→      size: {
   715→        sm: 'text-xs px-2 py-0.5',
   716→        md: 'text-sm px-2.5 py-0.5',
   717→        lg: 'text-sm px-3 py-1',
   718→      },
   719→    },
   720→    defaultVariants: {
   721→      variant: 'default',
   722→      size: 'md',
   723→    },
   724→  }
   725→)
   726→
   727→interface BadgeProps
   728→  extends React.HTMLAttributes<HTMLSpanElement>,
   729→    VariantProps<typeof badgeVariants> {}
   730→
   731→export function Badge({ className, variant, size, ...props }: BadgeProps) {
   732→  return (
   733→    <span className={badgeVariants({ variant, size, className })} {...props} />
   734→  )
   735→}
   736→
   737→
   738→使用示例
   739→━━━━━━━
   740→
   741→<Badge variant="wood">木</Badge>
   742→<Badge variant="fire">火</Badge>
   743→<Badge variant="earth">土</Badge>
   744→<Badge variant="metal">金</Badge>
   745→<Badge variant="water">水</Badge>
   746→
   747→<Badge variant="mystic">命理洞察</Badge>
   748→<Badge variant="gold">Premium</Badge>
   749→```
   750→
   751→### 5.4 Card 组件（优化后）
   752→
   753→```tsx
   754→// components/ui/Card.tsx
   755→━━━━━━━━━━━━━━━━━━━━━━━
   756→
   757→import { cva, type VariantProps } from 'class-variance-authority'
   758→
   759→const cardVariants = cva(
   760→  'rounded-xl transition-all duration-normal',
   761→  {
   762→    variants: {
   763→      variant: {
   764→        // 默认 - 实色背景
   765→        default: 
   766→          'bg-vellum-warm border border-ink/5 shadow-sm',
   767→        
   768→        // 玻璃效果【修复】
   769→        glass:
   770→          'bg-[var(--glass-bg)] backdrop-blur-[12px] ' +
   771→          'border border-[var(--glass-border)] shadow-lg',
   772→        
   773→        // 强调 - 金色边框
   774→        elevated:
   775→          'bg-vellum-warm border border-antique-gold/20 ' +
   776→          'shadow-md hover:shadow-glow-gold',
   777→        
   778→        // 神秘紫边框【新增】
   779→        mystic:
   780→          'bg-vellum-warm border border-mystic/20 ' +
   781→          'shadow-md hover:shadow-glow-mystic',
   782→        
   783→        // 五行主题卡片【新增】
   784→        wood: 'bg-element-wood/5 border border-element-wood/20',
   785→        fire: 'bg-element-fire/5 border border-element-fire/20',
   786→        earth: 'bg-element-earth/5 border border-element-earth/20',
   787→        metal: 'bg-element-metal/5 border border-element-metal/20',
   788→        water: 'bg-element-water/5 border border-element-water/20',
   789→      },
   790→      padding: {
   791→        none: 'p-0',
   792→        sm: 'p-3',
   793→        md: 'p-4',
   794→        lg: 'p-6',
   795→      },
   796→      interactive: {
   797→        true: 'cursor-pointer hover:shadow-lg hover:-translate-y-0.5',
   798→        false: '',
   799→      },
   800→    },
   801→    defaultVariants: {
   802→      variant: 'default',
   803→      padding: 'md',
   804→      interactive: false,
   805→    },
   806→  }
   807→)
   808→
   809→interface CardProps
   810→  extends React.HTMLAttributes<HTMLDivElement>,
   811→    VariantProps<typeof cardVariants> {}
   812→
   813→export function Card({ 
   814→  className, 
   815→  variant, 
   816→  padding, 
   817→  interactive,
   818→  ...props 
   819→}: CardProps) {
   820→  return (
   821→    <div 
   822→      className={cardVariants({ variant, padding, interactive, className })} 
   823→      {...props} 
   824→    />
   825→  )
   826→}
   827→
   828→// 子组件
   829→export function CardHeader({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {
   830→  return <div className={cn('mb-4', className)} {...props} />
   831→}
   832→
   833→export function CardTitle({ className, ...props }: React.HTMLAttributes<HTMLHeadingElement>) {
   834→  return <h3 className={cn('text-lg font-semibold text-ink', className)} {...props} />
   835→}
   836→
   837→export function CardContent({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {
   838→  return <div className={cn('text-ink-secondary', className)} {...props} />
   839→}
   840→
   841→export function CardFooter({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {
   842→  return <div className={cn('mt-4 flex items-center', className)} {...props} />
   843→}
   844→```
   845→
   846→---
   847→
   848→# 第三篇：功能组件
   849→
   850→## 6. 工具卡片系统
   851→
   852→### 6.1 CardRegistry 架构
   853→
   854→```
   855→CardRegistry 动态卡片系统
   856→━━━━━━━━━━━━━━━━━━━━━━━━━
   857→
   858→┌─────────────────────────────────────────────────────────────────────────────┐
   859→│                                                                             │
   860→│   后端 Tool Schema (tools.yaml)                                            │
   861→│   ─────────────────────────────                                            │
   862→│                                                                             │
   863→│   tools:                                                                    │
   864→│     - name: show_bazi_chart                                                │
   865→│       description: 展示八字命盘                                            │
   866→│       parameters:                                                           │
   867→│         type: object                                                        │
   868→│         properties:                                                         │
   869→│           pillars: { type: object }                                        │
   870→│           day_master: { type: string }                                     │
   871→│       card_type: BaziChartCard           ← 前端卡片类型                   │
   872→│       card_props:                        ← 默认属性                        │
   873→│         showElements: true                                                 │
   874→│         interactive: true                                                  │
   875→│                                                                             │
   876→│   ─────────────────────────────────────────────────────────────            │
   877→│                                                                             │
   878→│   前端 CardRegistry                                                        │
   879→│   ────────────────────                                                     │
   880→│                                                                             │
   881→│   // components/cards/registry/CardRegistry.ts                             │
   882→│                                                                             │
   883→│   const CARD_REGISTRY: Record<string, React.ComponentType<any>> = {        │
   884→│     // 全局卡片                                                            │
   885→│     SkillServicesCard,                                                     │
   886→│     ServiceRecommendationCard,                                             │
   887→│     CollectFormCard,                                                       │
   888→│     AskQuestionCard,                                                       │
   889→│     InsightCard,                                                           │
   890→│     ReportCard,                                                            │
   891→│     ProactivePushCard,                                                     │
   892→│     ReminderCard,                                                          │
   893→│                                                                             │
   894→│     // 八字卡片                                                            │
   895→│     BaziChartCard,                                                         │
   896→│     BaziFortuneCard,                                                       │
   897→│     BaziKLineCard,                                                         │
   898→│                                                                             │
   899→│     // 星座卡片                                                            │
   900→│     ZodiacChartCard,                                                       │
   901→│     ZodiacTransitCard,                                                     │
   902→│                                                                             │
   903→│     // 塔罗卡片                                                            │
   904→│     TarotSpreadCard,                                                       │
   905→│     TarotSingleCard,                                                       │
   906→│   }                                                                         │
   907→│                                                                             │
   908→│   export function getCardComponent(cardType: string) {                     │
   909→│     return CARD_REGISTRY[cardType] || FallbackCard                         │
   910→│   }                                                                         │
   911→│                                                                             │
   912→└─────────────────────────────────────────────────────────────────────────────┘
   913→```
   914→
   915→### 6.2 ToolCardRenderer 实现
   916→
   917→```tsx
   918→// components/chat/ToolCardRenderer.tsx
   919→━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   920→
   921→import { getCardComponent } from '@/components/cards/registry/CardRegistry'
   922→
   923→interface ToolCardRendererProps {
   924→  toolName: string
   925→  toolArgs: Record<string, any>
   926→  toolResult: Record<string, any>
   927→  cardType?: string        // 来自 tool schema
   928→  cardProps?: Record<string, any>  // 来自 tool schema
   929→}
   930→
   931→export function ToolCardRenderer({
   932→  toolName,
   933→  toolArgs,
   934→  toolResult,
   935→  cardType,
   936→  cardProps = {},
   937→}: ToolCardRendererProps) {
   938→  // 1. 优先使用 schema 指定的 cardType
   939→  // 2. 否则根据 toolName 推断
   940→  const resolvedCardType = cardType || inferCardType(toolName)
   941→  
   942→  // 获取对应的卡片组件
   943→  const CardComponent = getCardComponent(resolvedCardType)
   944→  
   945→  // 合并属性：cardProps (schema默认) + toolArgs + toolResult
   946→  const mergedProps = {
   947→    ...cardProps,
   948→    ...toolArgs,
   949→    ...toolResult,
   950→  }
   951→  
   952→  return (
   953→    <div className="my-3">
   954→      <CardComponent {...mergedProps} />
   955→    </div>
   956→  )
   957→}
   958→
   959→function inferCardType(toolName: string): string {
   960→  const mapping: Record<string, string> = {
   961→    show_bazi_chart: 'BaziChartCard',
   962→    show_bazi_fortune: 'BaziFortuneCard',
   963→    show_bazi_kline: 'BaziKLineCard',
   964→    show_zodiac_chart: 'ZodiacChartCard',
   965→    show_skill_services: 'SkillServicesCard',
   966→    recommend_service: 'ServiceRecommendationCard',
   967→    collect_info: 'CollectFormCard',
   968→    ask_question: 'AskQuestionCard',
   969→    show_insight: 'InsightCard',
   970→  }
   971→  return mapping[toolName] || 'FallbackCard'
   972→}
   973→```
   974→
   975→### 6.3 useToolSchema Hook
   976→
   977→```tsx
   978→// hooks/useToolSchema.ts
   979→━━━━━━━━━━━━━━━━━━━━━━━
   980→
   981→import useSWR from 'swr'
   982→
   983→interface ToolSchema {
   984→  name: string
   985→  description: string
   986→  parameters: Record<string, any>
   987→  card_type: string
   988→  card_props: Record<string, any>
   989→}
   990→
   991→interface UseToolSchemaResult {
   992→  tools: ToolSchema[]
   993→  isLoading: boolean
   994→  error: Error | null
   995→  getToolSchema: (toolName: string) => ToolSchema | undefined
   996→}
   997→
   998→export function useToolSchema(skillId?: string): UseToolSchemaResult {
   999→  const url = skillId 
  1000→    ? `/api/v1/tools/schema?skill_id=${skillId}`
  1001→    : '/api/v1/tools/schema'
  1002→  
  1003→  const { data, error, isLoading } = useSWR<{ tools: ToolSchema[] }>(url)
  1004→  
  1005→  const getToolSchema = (toolName: string) => {
  1006→    return data?.tools.find(t => t.name === toolName)
  1007→  }
  1008→  
  1009→  return {
  1010→    tools: data?.tools || [],
  1011→    isLoading,
  1012→    error,
  1013→    getToolSchema,
  1014→  }
  1015→}
  1016→
  1017→
  1018→在 useVibeChat 中集成
  1019→━━━━━━━━━━━━━━━━━━━━━
  1020→
  1021→export function useVibeChat(options: UseVibeChatOptions) {
  1022→  const { getToolSchema } = useToolSchema(options.skillId)
  1023→  
  1024→  // 处理 tool_result 时，获取 card 信息
  1025→  const handleToolResult = (toolCall: ToolCall, result: any) => {
  1026→    const schema = getToolSchema(toolCall.name)
  1027→    return {
  1028→      toolName: toolCall.name,
  1029→      toolArgs: toolCall.args,
  1030→      toolResult: result,
  1031→      cardType: schema?.card_type,
  1032→      cardProps: schema?.card_props,
  1033→    }
  1034→  }
  1035→  
  1036→  // ...
  1037→}
  1038→```
  1039→
  1040→---
  1041→
  1042→## 7. 图表组件优化
  1043→
  1044→### 7.1 BaziChart 五行颜色统一
  1045→
  1046→```tsx
  1047→// components/chart/BaziChart.tsx
  1048→━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  1049→
  1050→// 使用 CSS 变量，不再硬编码
  1051→const ELEMENT_COLORS = {
  1052→  木: {
  1053→    primary: 'var(--element-wood)',
  1054→    light: 'var(--element-wood-light)',
  1055→    bg: 'var(--element-wood-bg)',
  1056→  },
  1057→  火: {
  1058→    primary: 'var(--element-fire)',
  1059→    light: 'var(--element-fire-light)',
  1060→    bg: 'var(--element-fire-bg)',
  1061→  },
  1062→  土: {
  1063→    primary: 'var(--element-earth)',
  1064→    light: 'var(--element-earth-light)',
  1065→    bg: 'var(--element-earth-bg)',
  1066→  },
  1067→  金: {
  1068→    primary: 'var(--element-metal)',
  1069→    light: 'var(--element-metal-light)',
  1070→    bg: 'var(--element-metal-bg)',
  1071→  },
  1072→  水: {
  1073→    primary: 'var(--element-water)',
  1074→    light: 'var(--element-water-light)',
  1075→    bg: 'var(--element-water-bg)',
  1076→  },
  1077→}
  1078→
  1079→// 使用示例
  1080→function ElementBadge({ element }: { element: keyof typeof ELEMENT_COLORS }) {
  1081→  const colors = ELEMENT_COLORS[element]
  1082→  return (
  1083→    <span 
  1084→      className="px-2 py-1 rounded-md text-sm font-medium"
  1085→      style={{ 
  1086→        color: colors.primary,
  1087→        backgroundColor: colors.bg,
  1088→      }}
  1089→    >
  1090→      {element}
  1091→    </span>
  1092→  )
  1093→}
  1094→```
  1095→
  1096→### 7.2 LifeKLine 主题统一
  1097→
  1098→```tsx
  1099→// components/trend/LifeKLine.tsx
  1100→━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  1101→
  1102→// 移除独立 THEME，使用全局 CSS 变量
  1103→
  1104→// 旧代码（删除）
  1105→// const THEME = {
  1106→//   colors: { wood: '#4A7C59', fire: '#C75146', ... }
  1107→// }
  1108→
  1109→// 新代码 - 从 CSS 变量获取
  1110→function getElementColor(element: string): string {
  1111→  const root = document.documentElement
  1112→  const cssVar = `--element-${element.toLowerCase()}`
  1113→  return getComputedStyle(root).getPropertyValue(cssVar).trim()
  1114→}
  1115→
  1116→// ECharts 配置中使用
  1117→const chartOption = {
  1118→  series: [
  1119→    {
  1120→      type: 'line',
  1121→      data: fortuneData,
  1122→      lineStyle: {
  1123→        color: getElementColor('wood'),  // 使用全局变量
  1124→      },
  1125→      areaStyle: {
  1126→        color: {
  1127→          type: 'linear',
  1128→          colorStops: [
  1129→            { offset: 0, color: 'rgba(74, 124, 89, 0.3)' },  // element-wood/30
  1130→            { offset: 1, color: 'rgba(74, 124, 89, 0.05)' }, // element-wood/5
  1131→          ],
  1132→        },
  1133→      },
  1134→    },
  1135→  ],
  1136→}
  1137→```
  1138→
  1139→---
  1140→
  1141→## 8. 隐性记忆能力
  1142→
  1143→### 8.1 设计理念
  1144→
  1145→```
  1146→隐性记忆设计原则
  1147→━━━━━━━━━━━━━━━
  1148→
  1149→┌─────────────────────────────────────────────────────────────────────────────┐
  1150→│                                                                             │
  1151→│   核心原则：让用户感受到"被理解"，而不是"被记录"                            │
  1152→│                                                                             │
  1153→│   ─────────────────────────────────────────────────────────────            │
  1154→│                                                                             │
  1155→│   ❌ 错误做法（显式展示）                                                   │
  1156→│   ─────────────────────────                                                │
  1157→│   · 「我记住了你的这些信息...」                                             │
  1158→│   · 「基于我了解的你...」标签                                               │
  1159→│   · 记忆管理面板                                                            │
  1160→│   · 「VibeLife 记住的关于你」卡片                                           │
  1161→│                                                                             │
  1162→│   → 用户感受：被监视、隐私被侵犯、不舒服                                    │
  1163→│                                                                             │
  1164→│   ─────────────────────────────────────────────────────────────            │
  1165→│                                                                             │
  1166→│   ✅ 正确做法（隐性能力）                                                   │
  1167→│   ─────────────────────────                                                │
  1168→│   · AI 自然地在回复中引用用户信息，无需标注来源                             │
  1169→│   · 像一个真正了解你的朋友那样说话                                          │
  1170→│   · 用户感知到的是"被理解"，而不是"数据被调用"                              │
  1171→│                                                                             │
  1172→│   → 用户感受：温暖、被懂、自然                                              │
  1173→│                                                                             │
  1174→│   ─────────────────────────────────────────────────────────────            │
  1175→│                                                                             │
  1176→│   隐私保护                                                                  │
  1177→│   ─────────────                                                            │
  1178→│                                                                             │
  1179→│   设置 > 隐私 中提供：                                                      │
  1180→│   · 一键清除对话历史（同步删除 Profile extracted 数据）                     │
  1181→│   · 不向第三方共享任何用户数据                                             │
  1182→│                                                                             │
  1183→└─────────────────────────────────────────────────────────────────────────────┘
  1184→```
  1185→
  1186→### 8.2 后端 Profile 数据流（前端不直接使用）
  1187→
  1188→```
  1189→Profile 数据流（后端闭环）
  1190→━━━━━━━━━━━━━━━━━━━━━━━━
  1191→
  1192→用户对话 → messages 表
  1193→    ↓
  1194→profile_extractor (后台Worker，每日凌晨3点)
  1195→    ↓
  1196→unified_profiles.profile.extracted
  1197→{
  1198→  "facts": ["在互联网公司工作", "有一个3岁的女儿"],
  1199→  "concerns": ["工作压力较大"],
  1200→  "goals": ["想要找到更有意义的工作"],
  1201→  "pain_points": ["不知道如何平衡工作和家庭"],
  1202→  "life_events": [{ "date": "2024-03", "event": "女儿出生" }],
  1203→  "patterns": ["习惯性讨好他人"]
  1204→}
  1205→    ↓
  1206→CoreAgent._build_system_prompt() 
  1207→→ 自动注入到 System Prompt
  1208→→ AI 自然引用，不标注来源
  1209→    ↓
  1210→用户感知：「它真的懂我」
  1211→
  1212→前端不直接调用 /api/v1/users/me/profile 展示数据
  1213→前端只提供"清除数据"功能：DELETE /api/v1/account/users/me/data
  1214→```
  1215→
  1216→---
  1217→
  1218→# 第四篇：目录结构与实施
  1219→
  1220→## 9. 前端目录结构
  1221→
  1222→```
  1223→前端目录结构（完整）
  1224→━━━━━━━━━━━━━━━━━━━
  1225→
  1226→apps/web/src/
  1227→├── app/                              # Next.js App Router
  1228→│   ├── globals.css                   # 🔥 Design Token 定义（v6.1升级）
  1229→│   ├── layout.tsx
  1230→│   ├── page.tsx                      # 首页
  1231→│   ├── chat/
  1232→│   │   └── [[...slug]]/page.tsx      # 对话页
  1233→│   ├── settings/
  1234→│   │   └── page.tsx                  # 设置页（含隐私设置）
  1235→│   └── onboarding/
  1236→│       └── page.tsx                  # Onboarding
  1237→│
  1238→├── components/
  1239→│   ├── ui/                           # 🔥 基础组件库（v6.1补全）
  1240→│   │   ├── Button.tsx                # 优化 - 新增 mystic variant
  1241→│   │   ├── Card.tsx                  # 优化 - 修复 glass，新增五行 variants
  1242→│   │   ├── Input.tsx                 # 优化 - focus环、error状态
  1243→│   │   ├── Badge.tsx                 # 新建 - 五行色 variants
  1244→│   │   ├── Avatar.tsx                # 新建
  1245→│   │   ├── Switch.tsx                # 新建
  1246→│   │   ├── Dialog.tsx                # 新建 - 基于 Radix
  1247→│   │   ├── Dropdown.tsx              # 新建
  1248→│   │   ├── Tooltip.tsx               # 新建
  1249→│   │   ├── Toast.tsx                 # 新建
  1250→│   │   └── Skeleton.tsx              # 新建
  1251→│   │
  1252→│   ├── cards/                        # 工具卡片
  1253→│   │   ├── registry/
  1254→│   │   │   └── CardRegistry.ts       # 卡片统一注册表
  1255→│   │   ├── global/
  1256→│   │   │   ├── SkillServicesCard.tsx
  1257→│   │   │   ├── ServiceRecommendationCard.tsx
  1258→│   │   │   ├── CollectFormCard.tsx
  1259→│   │   │   ├── AskQuestionCard.tsx
  1260→│   │   │   ├── InsightCard.tsx
  1261→│   │   │   ├── ReportCard.tsx
  1262→│   │   │   ├── ProactivePushCard.tsx
  1263→│   │   │   └── ReminderCard.tsx
  1264→│   │   ├── bazi/
  1265→│   │   │   ├── BaziChartCard.tsx     # 🔥 五行颜色改用 CSS 变量
  1266→│   │   │   ├── BaziFortuneCard.tsx
  1267→│   │   │   └── BaziKLineCard.tsx
  1268→│   │   ├── zodiac/
  1269→│   │   │   ├── ZodiacChartCard.tsx   # 🔥 完善详细版
  1270→│   │   │   └── ZodiacTransitCard.tsx
  1271→│   │   └── tarot/
  1272→│   │       ├── TarotSpreadCard.tsx
  1273→│   │       └── TarotSingleCard.tsx
  1274→│   │
  1275→│   ├── chat/
  1276→│   │   ├── ChatMessage.tsx
  1277→│   │   ├── ToolCardRenderer.tsx      # 工具卡片渲染器
  1278→│   │   └── ChatInput.tsx
  1279→│   │
  1280→│   ├── home/
  1281→│   │   ├── DailyFortuneCard.tsx
  1282→│   │   ├── UpcomingEventsCard.tsx
  1283→│   │   └── FollowUpItemsCard.tsx
  1284→│   │
  1285→│   ├── settings/
  1286→│   │   └── PrivacySettings.tsx       # 隐私设置（含清除数据）
  1287→│   │
  1288→│   └── onboarding/
  1289→│       ├── InkRevealAnimation.tsx
  1290→│       ├── InsightRevealCard.tsx
  1291→│       └── ScenarioGuessCard.tsx
  1292→│
  1293→├── hooks/
  1294→│   ├── useVibeChat.ts                # AI SDK 集成
  1295→│   ├── useToolSchema.ts              # 工具 Schema 获取
  1296→│   ├── useSkillData.ts               # Skill 数据获取（适配 Gateway）
  1297→│   ├── useAuth.ts                    # 认证状态
  1298→│   └── useProactiveNotifications.ts  # 主动推送
  1299→│
  1300→├── lib/
  1301→│   ├── api/
  1302→│   │   ├── client.ts                 # API 客户端
  1303→│   │   ├── skills.ts                 # Skill Gateway 调用封装
  1304→│   │   ├── account.ts                # 账户 API
  1305→│   │   └── commerce.ts               # 商业 API
  1306→│   └── utils/
  1307→│       └── cn.ts                     # classnames 工具
  1308→│
  1309→├── stores/
  1310→│   ├── userStore.ts
  1311→│   └── chatStore.ts
  1312→│
  1313→└── tailwind.config.ts                # 🔥 Tailwind Token 配置（v6.1升级）
  1314→```
  1315→
  1316→---
  1317→
  1318→## 10. 实施计划
  1319→
  1320→### 10.1 Phase 1：Design Token 统一（P0，Week 1）
  1321→
  1322→```
  1323→Phase 1: Design Token 统一
  1324→━━━━━━━━━━━━━━━━━━━━━━━━━━
  1325→
  1326→┌────────────────────┬────────────────────────┬───────────────────────────────┐
  1327→│ 任务                │ 文件                    │ 改动                          │
  1328→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1329→│ 1.1 CSS 变量补全    │ globals.css            │ 添加所有 Token（墨色/强调色/  │
  1330→│                    │                        │ 五行色/阴影/glass 等）        │
  1331→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1332→│ 1.2 Tailwind 配置   │ tailwind.config.ts     │ 映射 CSS 变量到 Tailwind      │
  1333→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1334→│ 1.3 Button 组件     │ components/ui/Button   │ 使用统一 token，新增 mystic   │
  1335→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1336→│ 1.4 Card 组件       │ components/ui/Card     │ 修复 glass，新增五行 variants │
  1337→└────────────────────┴────────────────────────┴───────────────────────────────┘
  1338→
  1339→验证：
  1340→- 所有颜色使用 CSS 变量或 Tailwind token
  1341→- 无硬编码颜色值
  1342→- Tailwind 编译无警告
  1343→```
  1344→
  1345→### 10.2 Phase 2：图表组件 + 基础组件（P0，Week 2）
  1346→
  1347→```
  1348→Phase 2: 图表组件 + 基础组件
  1349→━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  1350→
  1351→┌────────────────────┬────────────────────────┬───────────────────────────────┐
  1352→│ 任务                │ 文件                    │ 改动                          │
  1353→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1354→│ 2.1 BaziChart      │ cards/bazi/BaziChart   │ 五行颜色改用 CSS 变量         │
  1355→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1356→│ 2.2 LifeKLine      │ cards/bazi/BaziKLine   │ 移除独立 THEME                │
  1357→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1358→│ 2.3 Badge 组件      │ components/ui/Badge    │ 新建，支持五行色              │
  1359→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1360→│ 2.4 Avatar 组件     │ components/ui/Avatar   │ 新建                          │
  1361→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1362→│ 2.5 Switch 组件     │ components/ui/Switch   │ 新建                          │
  1363→└────────────────────┴────────────────────────┴───────────────────────────────┘
  1364→```
  1365→
  1366→### 10.3 Phase 3：Skill Gateway 适配（P0，Week 2-3）
  1367→
  1368→```
  1369→Phase 3: Skill Gateway 适配
  1370→━━━━━━━━━━━━━━━━━━━━━━━━━━━
  1371→
  1372→┌────────────────────┬────────────────────────┬───────────────────────────────┐
  1373→│ 任务                │ 文件                    │ 改动                          │
  1374→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1375→│ 3.1 API 客户端      │ lib/api/skills.ts      │ 封装 /skills/{id}/{action}    │
  1376→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1377→│ 3.2 useSkillData   │ hooks/useSkillData     │ 适配新路由格式                │
  1378→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1379→│ 3.3 CardRegistry   │ cards/registry/        │ 动态加载 + Schema 集成        │
  1380→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1381→│ 3.4 useToolSchema  │ hooks/useToolSchema    │ 获取工具 Schema               │
  1382→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1383→│ 3.5 ToolCardRenderer│ chat/ToolCardRenderer │ 基于 Schema 渲染卡片          │
  1384→└────────────────────┴────────────────────────┴───────────────────────────────┘
  1385→```
  1386→
  1387→### 10.4 Phase 4：服务发现 + 主动推送（P1，Week 3-4）
  1388→
  1389→```
  1390→Phase 4: 服务发现 + 主动推送
  1391→━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  1392→
  1393→┌────────────────────┬────────────────────────┬───────────────────────────────┐
  1394→│ 任务                │ 文件                    │ 改动                          │
  1395→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1396→│ 4.1 SkillServices  │ cards/global/          │ 服务目录卡片                  │
  1397→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1398→│ 4.2 ServiceRecommend│ cards/global/         │ 服务推荐卡片                  │
  1399→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1400→│ 4.3 ProactivePush  │ cards/global/          │ 主动推送卡片                  │
  1401→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1402→│ 4.4 ReminderCard   │ cards/global/          │ 提醒卡片                      │
  1403→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1404→│ 4.5 通知 Hook       │ hooks/                 │ useProactiveNotifications     │
  1405→└────────────────────┴────────────────────────┴───────────────────────────────┘
  1406→```
  1407→
  1408→### 10.5 Phase 5：功能完善（P2，Week 5-6）
  1409→
  1410→```
  1411→Phase 5: 功能完善
  1412→━━━━━━━━━━━━━━━━
  1413→
  1414→┌────────────────────┬────────────────────────┬───────────────────────────────┐
  1415→│ 任务                │ 文件                    │ 改动                          │
  1416→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1417→│ 5.1 Dialog 组件     │ components/ui/Dialog   │ 基于 Radix UI                 │
  1418→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1419→│ 5.2 Toast 组件      │ components/ui/Toast    │ 轻提示系统                    │
  1420→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1421→│ 5.3 隐私设置        │ settings/Privacy       │ 清除数据功能                  │
  1422→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1423→│ 5.4 首页差异化      │ home/                  │ 三类用户不同首页              │
  1424→├────────────────────┼────────────────────────┼───────────────────────────────┤
  1425→│ 5.5 Onboarding 完善 │ onboarding/            │ 启用 PersonaStep              │
  1426→└────────────────────┴────────────────────────┴───────────────────────────────┘
  1427→```
  1428→
  1429→---
  1430→
  1431→## 11. 验证方法
  1432→
  1433→```
  1434→验证方法
  1435→━━━━━━━
  1436→
  1437→视觉验证
  1438→────────
  1439→1. 启动开发服务器: cd apps/web && pnpm dev
  1440→2. 检查页面:
  1441→   - 首页 / - 整体配色
  1442→   - 八字页 /bazi - BaziChart 五行颜色
  1443→   - K线页 /bazi/kline - LifeKLine 主题
  1444→   - 设置页 /settings - 新组件
  1445→
  1446→代码验证
  1447→────────
  1448→# 检查未定义的 Tailwind 类
  1449→npx tailwindcss -i ./src/app/globals.css -o /dev/null --content "./src/**/*.tsx" 2>&1 | grep "warn"
  1450→
  1451→# TypeScript 类型检查
  1452→pnpm tsc --noEmit
  1453→
  1454→# ESLint 检查
  1455→pnpm lint
  1456→
  1457→质量指标
  1458→────────
  1459→✓ 所有颜色使用 CSS 变量或 Tailwind token
  1460→✓ 无硬编码颜色值
  1461→✓ 所有交互元素有 hover/focus 状态
  1462→✓ 响应式布局正常
  1463→✓ Tailwind 编译无警告
  1464→✓ TypeScript 无类型错误
  1465→```
  1466→
  1467→---
  1468→
  1469→## 结语
  1470→
  1471→> **v6.1 的核心升级：对接 v6.8 后端架构 + 「暖阳神秘」设计系统**
  1472→
  1473→**架构层面**：
  1474→- 适配 Skill Gateway 统一路由（/skills/{id}/{action}）
  1475→- CardRegistry 动态渲染 + Tool Schema 集成
  1476→- API 调用层重构，与后端 account/commerce/notifications 对齐
  1477→
  1478→**设计层面**：
  1479→- Design Token 统一（CSS Variables → Tailwind → Components）
  1480→- 「暖阳神秘」配色升级，新增神秘紫 + 五行色系统一
  1481→- 基础组件库补全（Badge, Avatar, Switch, Dialog...）
  1482→
  1483→**体验层面**：
  1484→- 服务发现机制，让用户知道"能问什么"
  1485→- 隐性记忆能力，让用户感受"被理解"而不是"被记录"
  1486→- 主动推送系统，在关键时刻主动关心
  1487→
  1488→---
  1489→
  1490→*设计方案版本：v6.1*
  1491→*对接后端版本：v6.8*
  1492→*设计系统：「暖阳神秘」LUMINOUS MYSTIC Design System*
  1493→*核心目标：让用户在90秒内感受到"终于有人懂我"*

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
