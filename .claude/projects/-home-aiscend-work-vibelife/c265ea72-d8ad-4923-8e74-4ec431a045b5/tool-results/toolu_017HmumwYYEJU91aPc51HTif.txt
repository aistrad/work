     1→# VibeLife 前端工程指南 v3.0
     2→
     3→> **文档定位**：Phase 1 前端落地的唯一真理来源 (Source of Truth)
     4→> **目标状态**：世界级移动端优先体验 + PC 端沉浸式工作台
     5→> **美学基准**：Apple Journal / Apple Books / Paper by WeTransfer
     6→> **核心隐喻**：魔幻现实主义 —— 东方神秘学遇见现代物理
     7→> **Last Updated**：2026-01-06
     8→
     9→---
    10→
    11→## 0. 执行摘要
    12→
    13→### 0.1 本文要解决什么
    14→
    15→把「愿景」落到「4 周可交付的 P0 体验」：
    16→
    17→| 目标 | 定义 | 核心指标 |
    18→|------|------|----------|
    19→| **引流** | 有特色功能、可传播、别的 App 没有 | `share_complete_rate` |
    20→| **激活** | 眼前一亮、极易用、立刻解决痛点 | `first_value_rate` |
    21→| **第一口价值** | 高质量解读 + 高质量洞察（质量 > 速度） | `first_value_achieved` |
    22→
    23→### 0.2 关键决策摘要
    24→
    25→| 决策项 | 选择 | 理由 |
    26→|--------|------|------|
    27→| 身份框架 | **三元 Identity Prism** (Inner/Core/Outer) | 更细腻表达人的多面性，符合东方命理层次观 |
    28→| 洞察卡交互 | **响应式混合** (PC: Side Panel / Mobile: Bottom Sheet) | PC 不遮挡聊天，移动端原生感 |
    29→| Relationship Simulator | **P0+ 含双用户模式** | 杀手级引流功能，隐私友好是核心差异化 |
    30→| 端侧优先级 | **双端并重 (60/40)** | 移动端核心体验 + PC 工作台基础版 |
    31→| 首次价值 | **混合策略** | 推演过场 (1.5-2s) 作为仪式感桥接，再给完整解读 |
    32→| 趋势表达 | **只给主题 + 注意点** | 不预测具体事件，避免贩卖焦虑 |
    33→
    34→---
    35→
    36→## 1. 设计哲学与物理质感
    37→
    38→### 1.1 光纸 (Luminous Paper)
    39→
    40→**拒绝平坦色块**，在 `--vellum (#FBF7F1)` 之上创造材质深度：
    41→
    42→```css
    43→/* 噪点纹理叠加 */
    44→.luminous-paper {
    45→  background: var(--vellum);
    46→  position: relative;
    47→}
    48→.luminous-paper::before {
    49→  content: '';
    50→  position: absolute;
    51→  inset: 0;
    52→  background-image: url('/textures/paper-grain.png');
    53→  opacity: 0.03;
    54→  mix-blend-mode: multiply;
    55→  pointer-events: none;
    56→}
    57→```
    58→
    59→**光晕是背光**：柔和、漫射、温暖。禁用霓虹感、禁用过亮 glow。
    60→
    61→**墨水物理**：流式文本 / 标题入场用「模糊显影」：
    62→
    63→```css
    64→@keyframes ink-reveal {
    65→  from { filter: blur(4px); opacity: 0; }
    66→  to   { filter: blur(0);   opacity: 1; }
    67→}
    68→.ink-text {
    69→  animation: ink-reveal 0.6s var(--ease-out-expo) forwards;
    70→}
    71→```
    72→
    73→### 1.2 禅意呼吸动效 (Zen Breath)
    74→
    75→| 属性 | 规范 |
    76→|------|------|
    77→| 频率 | 极低：`0.05Hz - 0.1Hz` (10-20 秒一个周期) |
    78→| 默认 | 静止。只在交互 / 推演时「苏醒」 |
    79→| 缓动 | 统一 `framer-motion` **spring physics**，禁用 `linear` |
    80→| 强度 | 最大位移 `4px`，最大缩放 `1.02` |
    81→
    82→```typescript
    83→// 统一呼吸动效配置
    84→export const breathVariants = {
    85→  idle: { scale: 1 },
    86→  breathing: {
    87→    scale: [1, 1.015, 1],
    88→    transition: {
    89→      duration: 16,
    90→      repeat: Infinity,
    91→      ease: 'easeInOut',
    92→    },
    93→  },
    94→};
    95→```
    96→
    97→### 1.3 色彩系统
    98→
    99→**语义色**（已在 `globals.css` 定义）：
   100→
   101→| Token | Light | Dark | 用途 |
   102→|-------|-------|------|------|
   103→| `--background` | `#FBF7F1` | `#1C1A17` | 页面背景 |
   104→| `--foreground` | `#1C1A17` | `#FBF7F1` | 主文本 |
   105→| `--accent` | `#B88A44` | `#D4A55A` | 强调/CTA |
   106→| `--muted` | `#F5F0E8` | `#2A2825` | 次级背景 |
   107→
   108→**技能主题色**（通过 `data-skill` 属性切换）：
   109→
   110→| Skill | Primary | Accent | 隐喻 |
   111→|-------|---------|--------|------|
   112→| `bazi` | 玄金 `#8B7355` | 朱砂 `#C45C48` | 铜钱/古卷 |
   113→| `zodiac` | 星蓝 `#4A5568` | 金线 `#D4AF37` | 星空/黄道 |
   114→| `mbti` | 棱镜 `#6B46C1` | 光谱 `#EC4899` | 折射/光谱 |
   115→
   116→---
   117→
   118→## 2. 信息架构 (IA)
   119→
   120→### 2.1 四大诉求主叙事
   121→
   122→Phase 1 的产品骨架围绕用户最大诉求展开：
   123→
   124→```
   125→1. 身份：我是谁 (Identity Prism)     → 第一次击中 (Activation)
   126→2. 关系：我们是什么 (Relationship)   → 可分享、可传播 (Acquisition)
   127→3. 趋势：我正处在什么阶段 (Now/Next) → 复访动机 (Retention seed)
   128→4. 改变：我下一步怎么做 (Coach)      → 长期价值 (Monetization seed)
   129→```
   130→
   131→### 2.2 导航结构
   132→
   133→#### 移动端 BottomNav (固定四 Tab)
   134→
   135→```
   136→┌────────┬────────┬────────┬────────┐
   137→│  Chat  │  Chart │ Journey│   Me   │
   138→│   💬   │   📊   │   🛤   │   👤   │
   139→└────────┴────────┴────────┴────────┘
   140→```
   141→
   142→| Tab | 职责 | P0 内容 |
   143→|-----|------|---------|
   144→| **Chat** | 对话主线，洞察卡嵌入 | 流式对话 + 洞察卡 + Daily Greeting |
   145→| **Chart** | 结构化解读（命盘/星盘/类型） | Identity Prism + 出盘结果 + 证据 |
   146→| **Journey** | 洞察库 + 周期回顾 + 轻量行动 | 洞察收藏列表 + 7天微行动 |
   147→| **Me** | 身份开关 + 偏好 + 订阅 | Identity Prism (常驻) + 设置 |
   148→
   149→#### PC 端三栏布局
   150→
   151→```
   152→┌──────────┬────────────────────────┬──────────────────────┐
   153→│  导航栏  │       聊天主区域        │    Insight Panel     │
   154→│  (240px) │     (max-w-3xl)        │      (360px)         │
   155→│          │                        │                      │
   156→│  · Chat  │   [对话流 + 输入框]    │  · Identity Prism    │
   157→│  · Chart │                        │  · 当前洞察详情      │
   158→│  · Journey                        │  · Now/Next 趋势     │
   159→│  · Me    │                        │  · 快捷操作          │
   160→│          │                        │                      │
   161→│  ─────── │                        │                      │
   162→│  历史    │                        │                      │
   163→└──────────┴────────────────────────┴──────────────────────┘
   164→```
   165→
   166→### 2.3 路由规范 (Next.js App Router)
   167→
   168→```
   169→/                       # 首页 Landing
   170→/{skill}                # 技能入口 (bazi/zodiac/mbti)
   171→/{skill}/chat           # 对话页
   172→/{skill}/chart          # 图表/报告页
   173→/{skill}/journey        # 回顾/时间线
   174→/me                     # 全局个人中心
   175→/auth/login             # 登录
   176→/auth/register          # 注册
   177→/relationship           # 关系模拟器入口
   178→/relationship/[id]      # 关系详情页
   179→```
   180→
   181→---
   182→
   183→## 3. 核心组件规格
   184→
   185→### 3.1 仪式感输入胶囊 (Birth Input Capsule) — P0
   186→
   187→**交互规范**：
   188→
   189→| 状态 | 视觉表现 |
   190→|------|----------|
   191→| 默认 | 圆角胶囊，1px 边框，微弱内阴影 |
   192→| 聚焦 | `scale(1.02)` + 边框变 accent + 外发光 |
   193→| 完成 | 短暂 pulse + 收缩回原尺寸 |
   194→
   195→**字段策略**：
   196→
   197→```
   198→必填：生日（年/月/日）
   199→选填（收纳为「高级选项」）：
   200→  - 时辰：可跳过 (unknown)，提示「时辰可提升精度」
   201→  - 性别：包容性选项（女性/男性/非二元/不便透露）
   202→  - 地点：默认北京，可修改
   203→```
   204→
   205→**包容性要求**：
   206→- 文案避免默认异性恋叙事
   207→- 关系建议使用中性措辞
   208→- 性别字段不做二元假设
   209→
   210→### 3.2 推演过场 (Deduction Bridge) — P0
   211→
   212→**目标**：1.5-2s 的仪式感过渡，连接「凡人输入」与「天机洞察」
   213→
   214→| Skill | 视觉隐喻 | 技术实现 |
   215→|-------|----------|----------|
   216→| `bazi` | 同心环转动（玉石质感） | SVG + framer-motion rotate |
   217→| `zodiac` | 星点连线（深蓝底金线） | Canvas particles + line drawing |
   218→| `mbti` | 光谱折射（棱镜分光） | CSS gradient animation |
   219→
   220→**工程规范**：
   221→- 统一组件：`<TransitionOverlay variant="bazi|zodiac|mbti" />`
   222→- 必须提供「跳过」按钮（无障碍 + 尊重用户时间）
   223→- 过场期间预加载后续数据
   224→
   225→```typescript
   226→interface TransitionOverlayProps {
   227→  variant: 'bazi' | 'zodiac' | 'mbti';
   228→  duration?: number; // 默认 2000ms
   229→  onComplete: () => void;
   230→  onSkip?: () => void;
   231→}
   232→```
   233→
   234→### 3.3 洞察卡片 (Insight Card) — P0
   235→
   236→**流中形态 (Gems in the Stream)**：
   237→
   238→```
   239→┌─────────────────────────────────┐
   240→│ ✨ 洞察                         │
   241→│ ┌───────────────────────────┐   │
   242→│ │  你的核心驱动力是          │   │
   243→│ │  「追求深度理解」          │   │
   244→│ │                           │   │
   245→│ │  [展开详情 →]              │   │
   246→│ └───────────────────────────┘   │
   247→└─────────────────────────────────┘
   248→```
   249→
   250→**展开交互（响应式混合）**：
   251→
   252→| 端侧 | 交互形式 | 实现库 |
   253→|------|----------|--------|
   254→| Mobile (<1024px) | Bottom Sheet | `vaul` |
   255→| PC (≥1024px) | Side Panel (右栏内切换) | 自定义 + framer-motion |
   256→
   257→**展开后必备功能**：
   258→
   259→| 功能 | 交互 | 优先级 |
   260→|------|------|--------|
   261→| 喜欢 | 点击心形，只做正向反馈 | P0 |
   262→| 分享 | 复制文本 / 生成海报 (二选一先做复制) | P0 |
   263→| 深入解读 | 生成 follow-up prompt，回到对话 | P0 |
   264→| 收藏/保存 | 点击触发渐进注册，登录后进入 Journey | P0 |
   265→
   266→**数据结构**：
   267→
   268→```typescript
   269→interface InsightCard {
   270→  id: string;
   271→  skill: 'bazi' | 'zodiac' | 'mbti';
   272→  type: 'identity' | 'relationship' | 'trend' | 'action';
   273→  title: string;           // 一句话标题
   274→  summary: string;         // 2-3 句核心洞察
   275→  detail?: string;         // 展开后详细内容
   276→  evidence?: {             // 证据（不暴露完整 portrait）
   277→    type: 'chart' | 'conversation';
   278→    snippet: string;       // 如 "日主=甲木" 或用户原话
   279→  }[];
   280→  actions: ('like' | 'share' | 'dive' | 'save')[];
   281→  createdAt: string;
   282→}
   283→```
   284→
   285→### 3.4 Identity Prism (三元身份视角) — P0 核心
   286→
   287→> 用一个**极简交互**，一次性解决用户核心困惑：
   288→> 「我内心是这样的，但别人觉得我是那样的」→ **人是多面的** → 我被理解/被允许/被赋能
   289→
   290→#### 3.4.1 三段式文案结构
   291→
   292→```
   293→┌─────────────────────────────────────────────────┐
   294→│                                                 │
   295→│   ○ Inner    ◉ Core    ○ Outer                 │
   296→│   ═════════════●═══════════════                │
   297→│                                                 │
   298→│   你真正稳定的驱动力是                           │
   299→│   ╭─────────────────────────────╮               │
   300→│   │                             │               │
   301→│   │     「追求深度理解」          │               │
   302→│   │                             │               │
   303→│   ╰─────────────────────────────╯               │
   304→│                                                 │
   305→│   你天生对表象不满足，总想探究事物               │
   306→│   背后的本质。这让你在研究、分析、               │
   307→│   策略制定方面有独特优势。                       │
   308→│                                                 │
   309→│   来源：日主甲木 · 偏印格                        │
   310→│                                                 │
   311→└─────────────────────────────────────────────────┘
   312→```
   313→
   314→| 视角 | 含义 | 语气 |
   315→|------|------|------|
   316→| **Inner (阴)** | 内心最在意的 | 「在你心里，其实最在意的是…」 |
   317→| **Core (本)** | 真正稳定的驱动力 | 「你真正稳定的驱动力是…」 |
   318→| **Outer (阳)** | 给人的感觉 | 「你给人的感觉是…」 |
   319→
   320→#### 3.4.2 放置策略（半常驻）
   321→
   322→| 端侧 | 位置 | 形态 |
   323→|------|------|------|
   324→| PC | Insight Panel 顶部（第一屏可见） | 完整三档开关 |
   325→| Mobile - Me Tab | 顶部常驻 | 完整三档开关 |
   326→| Mobile - Chat | 空状态时展示预览卡，点击跳转 Me | 简化预览 |
   327→| Chart/报告页 | 作为报告第一页 | 完整展示 |
   328→
   329→#### 3.4.3 交互组件：TriToggle
   330→
   331→三档物理开关，带「机械阻尼感」的 spring 动画：
   332→
   333→```typescript
   334→interface TriToggleProps {
   335→  value: 'inner' | 'core' | 'outer';
   336→  onChange: (value: 'inner' | 'core' | 'outer') => void;
   337→  disabled?: boolean;
   338→}
   339→
   340→// 动效配置
   341→const toggleSpring = {
   342→  type: 'spring',
   343→  stiffness: 500,
   344→  damping: 30,
   345→};
   346→```
   347→
   348→**光晕变化规则**：
   349→
   350→| 状态 | 光晕半径 | 亮度 | 呼吸频率 |
   351→|------|----------|------|----------|
   352→| Inner | 小 (0.8x) | 低 | 慢 (20s) |
   353→| Core | 中 (1x) | 中 | 几乎静止 |
   354→| Outer | 大 (1.2x) | 高 | 稳 (16s) |
   355→
   356→#### 3.4.4 三 Skill 映射
   357→
   358→**八字 (Bazi)**：
   359→- `Inner`：日主（本我核心气质）→「你最自然的反应方式」
   360→- `Core`：用神/喜忌 →「长期利益的方向盘」（现代语义，不堆术语）
   361→- `Outer`：十神结构 →「社会角色策略」
   362→
   363→**星座 (Zodiac)**：
   364→- `Inner`：月亮星座
   365→- `Core`：太阳星座
   366→- `Outer`：上升星座（缺失时退化为双层，轻提示补充时辰可解锁）
   367→
   368→**MBTI**：
   369→- `Inner`：内在能量补给方式
   370→- `Core`：主导功能/决策偏好
   371→- `Outer`：对外互动策略
   372→
   373→#### 3.4.5 禁用话术
   374→
   375→**必须禁用**：
   376→- 「你注定… / 你一定会… / 你逃不掉… / 这是命」
   377→- 以恐惧驱动的句式：「不这样就会很惨/会出事/会破财」
   378→- 情感操控式推销：「不买你就错过窗口期」
   379→
   380→**改用**：
   381→- 「更可能 / 更容易 / 在…情况下常见 / 可以尝试」
   382→
   383→### 3.5 Relationship Simulator (关系模拟器) — P0+
   384→
   385→> 杀手级引流功能：隐私友好 + 可分享 + 可行动
   386→
   387→#### 3.5.1 主场景
   388→
   389→**亲密关系**为主打（传播性最强、复访动机最强）
   390→
   391→#### 3.5.2 双模式设计
   392→
   393→**模式 1：传统输入（单人发起）**
   394→
   395→```
   396→┌─────────────────────────────────────┐
   397→│  关系模拟器                      ✕  │
   398→├─────────────────────────────────────┤
   399→│                                     │
   400→│  选择对方信息来源                    │
   401→│                                     │
   402→│  ┌─────────────────────────────┐    │
   403→│  │  📅 我知道 TA 的生日         │    │
   404→│  └─────────────────────────────┘    │
   405→│  ┌─────────────────────────────┐    │
   406→│  │  ♈ 我只知道 TA 的星座        │    │
   407→│  └─────────────────────────────┘    │
   408→│  ┌─────────────────────────────┐    │
   409→│  │  🧠 我知道 TA 的 MBTI        │    │
   410→│  └─────────────────────────────┘    │
   411→│                                     │
   412→└─────────────────────────────────────┘
   413→```
   414→
   415→**模式 2：双用户隐私模式 (Vibe Link)**
   416→
   417→```
   418→发起者                              接收者
   419→─────────                           ─────────
   420→1. 选择披露级别
   421→   ○ 最隐私（默认）
   422→   ○ 展示基本标签
   423→   ○ 完整披露
   424→
   425→2. 生成邀请链接 ──────────────────→ 3. 点击链接
   426→
   427→                                    4. 选择披露级别
   428→
   429→                                    5. 确认参与
   430→
   431→          ←────────────────────────
   432→
   433→6. 双方各自看到「我该如何对待 TA」
   434→   （底层信息不互相暴露）
   435→```
   436→
   437→**隐私边界**（默认最隐私）：
   438→- 对方看不到：生日/时辰/地点/性别
   439→- 也不展示：日主/上升/MBTI 类型等底层标签
   440→- 只展示：合盘结果 + 行动建议
   441→
   442→#### 3.5.3 输出形态：行动处方
   443→
   444→```
   445→┌─────────────────────────────────────┐
   446→│  你们的关系诊断                      │
   447→├─────────────────────────────────────┤
   448→│                                     │
   449→│  「你们是彼此的镜子，                │
   450→│    但镜中的自己让你有点不安」        │
   451→│                                     │
   452→│  ─────────────────────────────────  │
   453→│                                     │
   454→│  💬 下次可以这样说                   │
   455→│  ┌─────────────────────────────┐    │
   456→│  │ "我需要一点时间想清楚"       │ 📋 │
   457→│  └─────────────────────────────┘    │
   458→│  ┌─────────────────────────────┐    │
   459→│  │ "你说的我听到了，但..."      │ 📋 │
   460→│  └─────────────────────────────┘    │
   461→│                                     │
   462→│  ⚠️ 注意点                          │
   463→│  避免在 TA 情绪激动时讲道理          │
   464→│                                     │
   465→│  ┌──────────────────────────────┐   │
   466→│  │       ↗ 分享关系卡           │   │
   467→│  └──────────────────────────────┘   │
   468→│                                     │
   469→└─────────────────────────────────────┘
   470→```
   471→
   472→#### 3.5.4 可分享关系卡（引流核心）
   473→
   474→**只包含**：
   475→- 一句关系结论
   476→- 「你们最适合的沟通方式」一句
   477→- 一个「下次就用这句开场」模板
   478→
   479→**明确不包含**：
   480→- 生日、星座/类型、命盘字段等敏感信息
   481→
   482→### 3.6 趋势系统 (Now/Next) — P0
   483→
   484→#### 3.6.1 表达边界
   485→
   486→**只给**：
   487→- 阶段主题
   488→- 风险/注意点
   489→- 可做的事
   490→
   491→**不做**：
   492→- 不预测具体事件
   493→- 不说「会发生什么」
   494→
   495→#### 3.6.2 组件设计
   496→
   497→**NowNextCard**：
   498→
   499→```
   500→┌─────────────────────────────────────┐
   501→│  📍 当前阶段                        │
   502→├─────────────────────────────────────┤
   503→│  主题：沉淀与积累                    │
   504→│                                     │
   505→│  ⚠️ 注意：容易陷入细节，忘记大局     │
   506→│                                     │
   507→│  ✓ 可做：每周留出 2 小时做规划       │
   508→├─────────────────────────────────────┤
   509→│  ➡️ 下一阶段（3 月起）               │
   510→│  主题：向外拓展                      │
   511→└─────────────────────────────────────┘
   512→```
   513→
   514→**TodayOneStep**（嵌入 Daily Greeting）：
   515→
   516→```
   517→┌─────────────────────────────────────┐
   518→│  🌅 早安                            │
   519→│  今天立春，木气上升                  │
   520→│                                     │
   521→│  今日一步                           │
   522→│  ┌─────────────────────────────┐    │
   523→│  │ ☐ 拒绝一个不合理的请求       │    │
   524→│  └─────────────────────────────┘    │
   525→│                                     │
   526→│  [加入 7 天计划]                    │
   527→└─────────────────────────────────────┘
   528→```
   529→
   530→#### 3.6.3 三 Skill 差异化
   531→
   532→| Skill | 周期表达 | 示例 |
   533→|-------|----------|------|
   534→| 八字 | 流月/节气/阶段主题 | 「本月官星透出，适合争取曝光」 |
   535→| 星座 | 天象/周期 | 「水逆期向内梳理，不急于决策」 |
   536→| MBTI | 成长焦点 | 「本周适合练习设定边界」 |
   537→
   538→### 3.7 主动关怀：Daily Greeting — P0
   539→
   540→**策略**：No Push，打开页面立即看到最新的
   541→
   542→**触发频率**：
   543→- 每日（基于当日节律）
   544→- 节气/特殊天象
   545→- 用户事件（生日等）
   546→
   547→**展示位置**：
   548→- 首页或 Chat 顶部
   549→- 只呈现「最新一期」，历史不做强依赖
   550→
   551→```
   552→┌─────────────────────────────────────┐
   553→│  🎋 小寒                            │
   554→│  ───────────────────────────────    │
   555→│  寒气渐盛，宜收敛精气。              │
   556→│  今天适合处理需要耐心的事。          │
   557→│                        [了解更多 →] │
   558→└─────────────────────────────────────┘
   559→```
   560→
   561→---
   562→
   563→## 4. PC 工作台：A2UI (Agent-Driven UI)
   564→
   565→### 4.1 设计理念
   566→
   567→Agent 控制 UI 状态，不只是文本生成。
   568→
   569→### 4.2 协议设计 (Phase 1 粗粒度)
   570→
   571→后端通过 SSE Data Stream 发送 `ui_directive`：
   572→
   573→```typescript
   574→interface UIDirective {
   575→  view: 'default' | 'transit' | 'pattern' | 'relationship';
   576→  focus?: string;  // 如 '2026' 或 'partner_1'
   577→  highlight?: string[];  // 需要高亮的元素 ID
   578→}
   579→
   580→// 示例
   581→{ "view": "transit", "focus": "2026-Q1" }
   582→```
   583→
   584→### 4.3 Insight Panel 视图
   585→
   586→Phase 1 支持 3 个视图：
   587→
   588→| 视图 | 内容 | 触发条件 |
   589→|------|------|----------|
   590→| `default` | Identity Prism + 当前运势 + 快捷操作 | 默认/空闲 |
   591→| `transit` | 运势时间线 + 阶段详情 | 用户问趋势/Agent 主动 |
   592→| `pattern` | 命盘/星盘结构图 + 解释 | 用户问「为什么」/证据 |
   593→
   594→### 4.4 技术实现
   595→
   596→```typescript
   597→// Zustand store
   598→interface InsightPanelStore {
   599→  currentView: 'default' | 'transit' | 'pattern';
   600→  viewData: Record<string, unknown>;
   601→  setView: (view: string, data?: Record<string, unknown>) => void;
   602→}
   603→
   604→// SSE handler (Vercel AI SDK)
   605→const { data } = useChat({
   606→  onDataMessage: (directive: UIDirective) => {
   607→    insightPanelStore.setView(directive.view, { focus: directive.focus });
   608→  },
   609→});
   610→```
   611→
   612→---
   613→
   614→## 5. 渐进注册 (Progressive Disclosure)
   615→
   616→### 5.1 原则
   617→
   618→**不阻断首次价值**，只在「用户明确要拥有」时注册。
   619→
   620→### 5.2 触发点
   621→
   622→| 动作 | 是否触发注册 |
   623→|------|--------------|
   624→| 单纯聊天 | ❌ |
   625→| 单次体验 (Guest) | ❌ |
   626→| 保存洞察 | ✅ |
   627→| 查看完整报告/命盘 | ✅ |
   628→| 生成关系邀请链接 | ✅ |
   629→
   630→### 5.3 登录方式优先级
   631→
   632→| 阶段 | 方式 |
   633→|------|------|
   634→| P0 | 邮箱 + 手机 |
   635→| P1 | 微信 |
   636→| P2 | Google / Apple |
   637→
   638→---
   639→
   640→## 6. 技术规范
   641→
   642→### 6.1 必选库
   643→
   644→| 类别 | 库 | 理由 |
   645→|------|-----|------|
   646→| 框架 | Next.js 14 (App Router) | 已采用 |
   647→| 状态管理 | Zustand | 轻量、与 React 18 兼容好 |
   648→| 动效 | framer-motion | Spring physics、layoutId |
   649→| Bottom Sheet | vaul | 移动端原生感、snap points |
   650→| 样式 | Tailwind CSS | 已采用 |
   651→| 图标 | lucide-react | 已采用 |
   652→
   653→### 6.2 SSE 流式响应
   654→
   655→所有 AI 响应使用 SSE 流式输出：
   656→
   657→```typescript
   658→// 前端
   659→const { messages, isLoading } = useChat({
   660→  api: '/api/v1/chat/stream',
   661→  streamMode: 'stream-data',
   662→});
   663→
   664→// 后端
   665→@app.post("/api/v1/chat/stream")
   666→async def chat_stream(request: ChatRequest):
   667→    async def generate():
   668→        async for chunk in agent.stream(request.message):
   669→            yield f"data: {json.dumps(chunk)}\n\n"
   670→    return StreamingResponse(generate(), media_type="text/event-stream")
   671→```
   672→
   673→### 6.3 响应式断点
   674→
   675→```css
   676→/* Tailwind 配置 */
   677→screens: {
   678→  'sm': '640px',   // 手机横屏
   679→  'md': '768px',   // 平板
   680→  'lg': '1024px',  // PC（洞察卡交互切换点）
   681→  'xl': '1280px',  // 大屏 PC
   682→}
   683→```
   684→
   685→### 6.4 性能预算
   686→
   687→| 指标 | 目标 |
   688→|------|------|
   689→| FCP | < 1.5s |
   690→| LCP | < 2.5s |
   691→| TTI | < 3.5s |
   692→| Bundle Size (首屏) | < 150KB gzipped |
   693→
   694→---
   695→
   696→## 7. 工程路线图 (4 周)
   697→
   698→### Week 1：模板强一致 + 移动端框架
   699→
   700→| 任务 | 交付物 |
   701→|------|--------|
   702→| 全站统一 Luminous Paper | 所有页面应用纸张纹理 + 色彩系统 |
   703→| BottomNav 骨架 | Chat/Chart/Journey/Me 四 Tab 可切换 |
   704→| Birth Input 胶囊打磨 | 可跳过字段 + 默认地点 + 包容性选项 |
   705→| 推演过场 (bazi) | TransitionOverlay 组件 + 跳过按钮 |
   706→
   707→### Week 2：洞察卡闭环 + Identity Prism
   708→
   709→| 任务 | 交付物 |
   710→|------|--------|
   711→| 洞察卡 Bottom Sheet | vaul 集成 + 响应式 (PC: Side Panel) |
   712→| 分享功能 | 复制文本（海报 Phase 2） |
   713→| Like + 深入解读 | 正向反馈 + follow-up prompt 生成 |
   714→| Identity Prism | TriToggle 组件 + 三 Skill 映射 + 半常驻放置 |
   715→
   716→### Week 3：Chart/档案 + 趋势视图 + 续聊
   717→
   718→| 任务 | 交付物 |
   719→|------|--------|
   720→| `/{skill}/chart` 页面 | 最小可用报告页 |
   721→| Insight Panel 真实数据 | 接入后端摘要 API |
   722→| 继续上次对话 | localStorage (Guest) + conversation_id (登录) |
   723→| NowNextCard + TodayOneStep | 趋势组件 + 嵌入 Daily Greeting |
   724→
   725→### Week 4：Relationship Simulator + 付费墙预留
   726→
   727→| 任务 | 交付物 |
   728→|------|--------|
   729→| Daily Greeting 卡片 | 展示最新一期 + 节气/天象 |
   730→| Relationship Simulator P0+ | 传统输入 + 双用户模式 + 可分享关系卡 |
   731→| 订阅权益/付费墙 UI | UI 就绪，支付可 stub |
   732→| A2UI 粗粒度切换 | 3 个视图切换 + ui_directive handler |
   733→
   734→---
   735→
   736→## 8. 埋点清单 (最少集)
   737→
   738→### 8.1 引流相关
   739→
   740→```
   741→landing_view(skill)
   742→insight_share_click(type)
   743→insight_share_complete(type, method)
   744→relationship_simulator_opened(skill, mode)
   745→relationship_share_click
   746→relationship_share_complete
   747→```
   748→
   749→### 8.2 激活相关
   750→
   751→```
   752→birth_submit(skill, has_hour, has_gender, has_location)
   753→deduction_shown(skill, duration_ms)
   754→deduction_skipped(skill, at_ms)
   755→chart_generated(skill, success)
   756→chat_first_message_sent(skill)
   757→insight_shown(type)
   758→insight_opened(type)
   759→insight_like(type)
   760→first_value_achieved(skill, path)
   761→```
   762→
   763→### 8.3 留存相关
   764→
   765→```
   766→identity_prism_viewed(skill, state)
   767→identity_prism_toggled(skill, from, to)
   768→resume_conversation(skill)
   769→daily_greeting_viewed
   770→today_one_step_completed
   771→```
   772→
   773→### 8.4 转化相关
   774→
   775→```
   776→register_prompt_shown(trigger)
   777→register_complete(method)
   778→paywall_shown(feature)
   779→subscription_started(plan)
   780→```
   781→
   782→---
   783→
   784→## 9. 非目标 (4 周内刻意不做)
   785→
   786→- 系统级 Push 通知
   787→- 完整跨技能洞察整合
   788→- 完整历史体系（先做「继续上次对话」）
   789→- 30 天长期计划（先做 7 天微行动）
   790→- 海报生成（先做复制文本）
   791→- 完整支付接入（先做 Stripe，微信/支付宝 Phase 2）
   792→
   793→---
   794→
   795→## 10. 后端协同要点
   796→
   797→### 10.1 新增 API 需求
   798→
   799→| API | 用途 | 优先级 |
   800→|-----|------|--------|
   801→| `GET /api/v1/identity-prism/{skill}` | 获取三元身份数据 | P0 |
   802→| `POST /api/v1/relationship/create` | 创建关系模拟 | P0 |
   803→| `GET /api/v1/relationship/{id}` | 获取关系结果 | P0 |
   804→| `POST /api/v1/relationship/invite` | 生成邀请链接 | P0 |
   805→| `POST /api/v1/relationship/accept` | 接受邀请 | P0 |
   806→| `GET /api/v1/trend/now-next/{skill}` | 获取趋势数据 | P0 |
   807→| `GET /api/v1/greeting/today` | 获取每日问候 | P0 |
   808→
   809→### 10.2 数据结构新增
   810→
   811→```python
   812→# Identity Prism 响应
   813→class IdentityPrismResponse(BaseModel):
   814→    skill: str
   815→    inner: PrismLayer
   816→    core: PrismLayer
   817→    outer: PrismLayer
   818→
   819→class PrismLayer(BaseModel):
   820→    keyword: str           # 关键词
   821→    description: str       # 2-3 句描述
   822→    evidence: list[Evidence]  # 证据列表
   823→
   824→# Relationship 响应
   825→class RelationshipResult(BaseModel):
   826→    id: str
   827→    diagnosis: str         # 一句话诊断
   828→    communication_style: str
   829→    action_scripts: list[str]  # 可复制的话术
   830→    warning: str           # 注意点
   831→    shareable_card: ShareableCard
   832→```
   833→
   834→---
   835→
   836→## 附录 A：备选方案存档
   837→
   838→### A.1 身份框架备选
   839→
   840→#### 方案 B：二元 Mirror Toggle
   841→
   842→Jungian 心理学的 Persona/Self 框架：
   843→
   844→```
   845→┌─────────────────────────────────────┐
   846→│                                     │
   847→│   ◉ Outer (面具)    ○ Inner (本我)  │
   848→│   ═══●═════════════════════════════ │
   849→│                                     │
   850→│   你展现给世界的是                   │
   851→│   「冷静可靠的执行者」               │
   852→│                                     │
   853→└─────────────────────────────────────┘
   854→```
   855→
   856→**未采用理由**：二元过于简化，难以表达东方命理的层次感。
   857→
   858→### A.2 洞察卡交互备选
   859→
   860→#### 方案 C：原地扩展
   861→
   862→卡片在原位置 layout animation 放大到全屏。
   863→
   864→```
   865→初始态                    展开态
   866→┌───────┐                ┌─────────────┐
   867→│ 洞察  │  ───────────→  │             │
   868→│ [展开]│                │   洞察详情   │
   869→└───────┘                │             │
   870→                         └─────────────┘
   871→```
   872→
   873→**未采用理由**：
   874→- 实现复杂度较高
   875→- 与 A2UI 右栏模式冲突
   876→- 移动端全屏跳转体验不如 Bottom Sheet 自然
   877→
   878→### A.3 趋势表达备选
   879→
   880→#### 方案 B：允许轻度预测
   881→
   882→可以说「本周合作机会较多」「水逆期向内梳理」。
   883→
   884→**未采用理由**：边界难以把控，易滑向「贩卖焦虑」，Phase 1 保守起见不做。
   885→
   886→### A.4 Relationship Simulator 备选
   887→
   888→#### 轻量验证方案
   889→
   890→只做关系入口 UI，后端逻辑放 Phase 2。
   891→
   892→**未采用理由**：用户明确希望 4 周内上线含双用户模式的完整版。
   893→
   894→---
   895→
   896→## 附录 B：组件速查表
   897→
   898→| 组件 | 文件位置 | 状态 |
   899→|------|----------|------|
   900→| LuminousPaper | `components/core/LuminousPaper.tsx` | ✅ 已有 |
   901→| VibeGlyph | `components/core/VibeGlyph.tsx` | ✅ 已有 |
   902→| BreathAura | `components/core/BreathAura.tsx` | ✅ 已有 |
   903→| InsightCard | `components/insight/InsightCard.tsx` | ✅ 已有，需扩展 |
   904→| InsightPanel | `components/insight/InsightPanel.tsx` | ✅ 已有，需扩展 |
   905→| TransitionOverlay | `components/core/TransitionOverlay.tsx` | ❌ 待创建 |
   906→| TriToggle | `components/ui/TriToggle.tsx` | ❌ 待创建 |
   907→| IdentityPrism | `components/identity/IdentityPrism.tsx` | ❌ 待创建 |
   908→| NowNextCard | `components/trend/NowNextCard.tsx` | ❌ 待创建 |
   909→| TodayOneStep | `components/trend/TodayOneStep.tsx` | ❌ 待创建 |
   910→| DailyGreeting | `components/greeting/DailyGreeting.tsx` | ❌ 待创建 |
   911→| RelationshipSimulator | `components/relationship/Simulator.tsx` | ❌ 待创建 |
   912→| RelationshipCard | `components/relationship/Card.tsx` | ❌ 待创建 |
   913→| BottomSheet | `components/ui/BottomSheet.tsx` | ❌ 待创建 (vaul 封装) |
   914→| SidePanel | `components/ui/SidePanel.tsx` | ❌ 待创建 |
   915→
   916→---
   917→
   918→## 附录 C：ASCII 交互参考
   919→
   920→详见 `/docs/frontend-identity-demo.md`
   921→
   922→---
   923→
   924→> 本文档是 Phase 1 前端落地的唯一真理来源 (Source of Truth)。
   925→> 如需修改优先级，请先改本文档，再改代码。
   926→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
