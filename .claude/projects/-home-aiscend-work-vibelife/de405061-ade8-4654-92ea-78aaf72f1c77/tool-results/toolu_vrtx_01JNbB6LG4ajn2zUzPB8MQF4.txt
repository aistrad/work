     1→/**
     2→ * VibeLife API Client
     3→ * All API calls go through Next.js API routes to avoid exposing backend URLs
     4→ */
     5→
     6→const API_BASE = "/api";
     7→
     8→// ─────────────────────────────────────────────────────────────────
     9→// Types
    10→// ─────────────────────────────────────────────────────────────────
    11→
    12→export interface TokenResponse {
    13→  access_token: string;
    14→  refresh_token: string;
    15→  token_type: string;
    16→  expires_in: number;
    17→  user: {
    18→    user_id: string;
    19→    vibe_id: string;
    20→    display_name?: string;
    21→  };
    22→}
    23→
    24→export interface ChatRequest {
    25→  message: string;
    26→  skill: string;           // Changed from skill_id to match backend
    27→  conversation_id?: string;
    28→  voice_mode?: string;     // Added voice mode support
    29→}
    30→
    31→export interface ChatResponse {
    32→  content: string;
    33→  conversation_id: string;
    34→  intent?: string;
    35→  tools_used?: string[];
    36→  knowledge_used: boolean;
    37→  insight?: {
    38→    id: string;
    39→    insight_type: string;
    40→    title: string;
    41→    content: string;
    42→  };
    43→  suggestions?: string[];
    44→}
    45→
    46→// ─────────────────────────────────────────────────────────────────
    47→// Token Management
    48→// ─────────────────────────────────────────────────────────────────
    49→
    50→let accessToken: string | null = null;
    51→let refreshToken: string | null = null;
    52→
    53→export function setTokens(access: string, refresh: string) {
    54→  accessToken = access;
    55→  refreshToken = refresh;
    56→  if (typeof window !== "undefined") {
    57→    localStorage.setItem("access_token", access);
    58→    localStorage.setItem("refresh_token", refresh);
    59→  }
    60→}
    61→
    62→export function getTokens() {
    63→  if (typeof window !== "undefined") {
    64→    accessToken = localStorage.getItem("access_token");
    65→    refreshToken = localStorage.getItem("refresh_token");
    66→  }
    67→  return { accessToken, refreshToken };
    68→}
    69→
    70→export function clearTokens() {
    71→  accessToken = null;
    72→  refreshToken = null;
    73→  if (typeof window !== "undefined") {
    74→    localStorage.removeItem("access_token");
    75→    localStorage.removeItem("refresh_token");
    76→    localStorage.removeItem("user");
    77→  }
    78→}
    79→
    80→// ─────────────────────────────────────────────────────────────────
    81→// API Helpers
    82→// ─────────────────────────────────────────────────────────────────
    83→
    84→async function fetchAPI(
    85→  endpoint: string,
    86→  options: RequestInit = {}
    87→): Promise<Response> {
    88→  const { accessToken } = getTokens();
    89→
    90→  const headers: Record<string, string> = {
    91→    "Content-Type": "application/json",
    92→    ...options.headers as Record<string, string>,
    93→  };
    94→
    95→  if (accessToken) {
    96→    headers["Authorization"] = `Bearer ${accessToken}`;
    97→  }
    98→
    99→  const response = await fetch(`${API_BASE}${endpoint}`, {
   100→    ...options,

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
