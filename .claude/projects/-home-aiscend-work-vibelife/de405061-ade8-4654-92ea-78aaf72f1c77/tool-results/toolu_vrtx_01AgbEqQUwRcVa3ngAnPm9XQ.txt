     1→"use client";
     2→
     3→/**
     4→ * useJourneyData Hook - Journey 页面数据管理
     5→ *
     6→ * 读取 lifecoach skill_data，支持乐观更新
     7→ * 遵循 React Best Practices: client-swr-dedup
     8→ */
     9→
    10→import useSWR from "swr";
    11→import { useCallback } from "react";
    12→import { apiClient } from "@/lib/api";
    13→import type {
    14→  LifecoachSkillData,
    15→  ReadLifecoachStateResponse,
    16→  JourneyState,
    17→  WeeklyAction,
    18→  DailyLever,
    19→  Milestone,
    20→} from "@/types/journey";
    21→import { getJourneyState } from "@/types/journey";
    22→
    23→const JOURNEY_KEY = "/journey";
    24→
    25→// ═══════════════════════════════════════════════════════════════════════════
    26→// Fetcher
    27→// ═══════════════════════════════════════════════════════════════════════════
    28→
    29→async function fetcher(): Promise<LifecoachSkillData> {
    30→  const { data } = await apiClient.get<ReadLifecoachStateResponse>(JOURNEY_KEY);
    31→
    32→  if (data.status === "error") {
    33→    throw new Error(data.message || "Failed to load journey data");
    34→  }
    35→
    36→  return data.data || {};
    37→}
    38→
    39→// ═══════════════════════════════════════════════════════════════════════════
    40→// Hook
    41→// ═══════════════════════════════════════════════════════════════════════════
    42→
    43→export function useJourneyData() {
    44→  const { data, error, isLoading, mutate } = useSWR<LifecoachSkillData>(
    45→    JOURNEY_KEY,
    46→    fetcher,
    47→    {
    48→      revalidateOnFocus: false,
    49→      revalidateOnReconnect: true,
    50→      dedupingInterval: 60000, // 1 minute dedup
    51→      errorRetryCount: 3,
    52→    }
    53→  );
    54→
    55→  // ═══════════════════════════════════════════════════════════════════════════
    56→  // Computed Values
    57→  // ═══════════════════════════════════════════════════════════════════════════
    58→
    59→  const journeyState: JourneyState = getJourneyState(data);
    60→  const hasNorthStar = !!data?.north_star?.vision_scene;
    61→  const hasIdentity = !!data?.identity?.target;
    62→  const hasRoadmap = (data?.roadmap?.goals?.length ?? 0) > 0 || (data?.goals?.length ?? 0) > 0;
    63→  const hasWeeklyActions = (data?.weekly?.rocks?.length ?? 0) > 0 || (data?.weekly_rocks?.rocks?.length ?? 0) > 0;
    64→  const hasMonthlyBoss = !!data?.monthly_boss?.title;
    65→  const hasDailyLevers = (data?.daily_levers?.levers?.length ?? 0) > 0;
    66→
    67→  // Normalize weekly data (support both formats)
    68→  const weekly = data?.weekly_rocks || data?.weekly;
    69→
    70→  // Normalize goals data
    71→  const goals = data?.roadmap?.goals || data?.goals || [];
    72→
    73→  // ═══════════════════════════════════════════════════════════════════════════
    74→  // Actions
    75→  // ═══════════════════════════════════════════════════════════════════════════
    76→
    77→  /**
    78→   * 切换周大石头完成状态
    79→   */
    80→  const toggleAction = useCallback(
    81→    async (actionId: string) => {
    82→      const rocks = weekly?.rocks;
    83→      if (!rocks) return;
    84→
    85→      const actionIndex = rocks.findIndex(
    86→        (r) => r.id === actionId || r.task === actionId
    87→      );
    88→      if (actionIndex === -1) return;
    89→
    90→      const action = rocks[actionIndex];
    91→      const newStatus: WeeklyAction["status"] =
    92→        action.status === "completed" ? "pending" : "completed";
    93→
    94→      // 1. Optimistic update
    95→      const updatedRocks = rocks.map((r, i) =>
    96→        i === actionIndex ? { ...r, status: newStatus } : r
    97→      );
    98→      const optimisticData: LifecoachSkillData = {
    99→        ...data,
   100→        weekly: data?.weekly ? { ...data.weekly, rocks: updatedRocks } : undefined,

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
