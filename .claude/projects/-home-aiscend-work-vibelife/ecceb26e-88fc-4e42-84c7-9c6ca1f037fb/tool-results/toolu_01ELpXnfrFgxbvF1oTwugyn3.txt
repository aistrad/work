     1→"use client";
     2→
     3→import { useState, KeyboardEvent, useRef, useEffect } from "react";
     4→import { cn } from "@/lib/utils";
     5→import { Send, Mic, Paperclip } from "lucide-react";
     6→
     7→// ═══════════════════════════════════════════════════════════════════════════
     8→// ChatInput - LUMINOUS PAPER Design System
     9→// Omnibar 玻璃胶囊样式：frosted glass 输入框
    10→// ═══════════════════════════════════════════════════════════════════════════
    11→
    12→const MAX_MESSAGE_LENGTH = 500;
    13→
    14→export interface ChatInputProps {
    15→  onSend: (message: string) => void;
    16→  onFileSelect?: (file: File) => void;
    17→  disabled?: boolean;
    18→  placeholder?: string;
    19→  showMediaButtons?: boolean;
    20→  className?: string;
    21→}
    22→
    23→export function ChatInput({
    24→  onSend,
    25→  onFileSelect,
    26→  disabled,
    27→  placeholder = "分享你的生辰或提出问题...",
    28→  showMediaButtons = true,
    29→  className,
    30→}: ChatInputProps) {
    31→  const [message, setMessage] = useState("");
    32→  const textareaRef = useRef<HTMLTextAreaElement>(null);
    33→  const fileInputRef = useRef<HTMLInputElement>(null);
    34→
    35→  // Auto-resize textarea
    36→  useEffect(() => {
    37→    const textarea = textareaRef.current;
    38→    if (textarea) {
    39→      textarea.style.height = "auto";
    40→      textarea.style.height = `${Math.min(textarea.scrollHeight, 120)}px`;
    41→    }
    42→  }, [message]);
    43→
    44→  const handleSend = () => {
    45→    if (message.trim() && !disabled) {
    46→      onSend(message.trim());
    47→      setMessage("");
    48→      // Reset height
    49→      if (textareaRef.current) {
    50→        textareaRef.current.style.height = "auto";
    51→      }
    52→    }
    53→  };
    54→
    55→  const handleKeyDown = (e: KeyboardEvent<HTMLTextAreaElement>) => {
    56→    if (e.key === "Enter" && !e.shiftKey) {
    57→      e.preventDefault();
    58→      handleSend();
    59→    }
    60→  };
    61→
    62→  const handleChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
    63→    const value = e.target.value;
    64→    if (value.length <= MAX_MESSAGE_LENGTH) {
    65→      setMessage(value);
    66→    }
    67→  };
    68→
    69→  const canSend = message.trim().length > 0 && !disabled;
    70→  const charCount = message.length;
    71→  const isNearLimit = charCount > MAX_MESSAGE_LENGTH * 0.8;
    72→
    73→  const handleFileClick = () => {
    74→    fileInputRef.current?.click();
    75→  };
    76→
    77→  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    78→    const file = e.target.files?.[0];
    79→    if (file && onFileSelect) {
    80→      onFileSelect(file);
    81→    }
    82→    // Reset input
    83→    if (fileInputRef.current) {
    84→      fileInputRef.current.value = "";
    85→    }
    86→  };
    87→
    88→  return (
    89→    <div className={cn("p-4 md:px-6 pb-6", className)}>
    90→      {/* Screen reader only label for the chat input */}
    91→      <label htmlFor="chat-input" className="sr-only">
    92→        聊天输入框 - 分享你的生辰或提出问题
    93→      </label>
    94→
    95→      {/* Hidden file input with label */}
    96→      <label htmlFor="file-upload" className="sr-only">
    97→        上传图片或文档
    98→      </label>
    99→      <input
   100→        ref={fileInputRef}
   101→        id="file-upload"
   102→        type="file"
   103→        accept="image/*,.pdf,.txt,.docx"
   104→        onChange={handleFileChange}
   105→        className="hidden"
   106→        disabled={disabled}
   107→      />
   108→
   109→      {/* Gradient fade above input */}
   110→      <div className="h-8 bg-gradient-to-t from-background to-transparent -mt-8 mb-4 pointer-events-none" />
   111→
   112→      {/* 所有设备底部居中，PC端响应式增宽 */}
   113→      <div className="max-w-3xl xl:max-w-4xl 2xl:max-w-5xl mx-auto">
   114→        <div className="omnibar shadow-lg shadow-black/5">
   115→          {/* Media buttons (optional) */}
   116→          {showMediaButtons && (
   117→            <>
   118→              <button
   119→                type="button"
   120→                onClick={handleFileClick}
   121→                className="omnibar-btn"
   122→                aria-label="上传文件"
   123→                aria-describedby="upload-hint"
   124→                title="上传图片或文档"
   125→                disabled={disabled}
   126→              >
   127→                <Paperclip className="w-5 h-5" />
   128→              </button>
   129→              <button
   130→                type="button"
   131→                className="omnibar-btn"
   132→                aria-label="语音输入"
   133→                title="语音输入（即将推出）"
   134→                disabled={disabled}
   135→              >
   136→                <Mic className="w-5 h-5" />
   137→              </button>
   138→            </>
   139→          )}
   140→
   141→          {/* Input */}
   142→          <textarea
   143→            ref={textareaRef}
   144→            id="chat-input"
   145→            value={message}
   146→            onChange={handleChange}
   147→            onKeyDown={handleKeyDown}
   148→            placeholder={placeholder}
   149→            disabled={disabled}
   150→            rows={1}
   151→            className="omnibar-input min-h-[24px] max-h-[120px]"
   152→            aria-describedby="input-hint"
   153→            aria-multiline="true"
   154→            maxLength={MAX_MESSAGE_LENGTH}
   155→          />
   156→
   157→          {/* Send button with animation */}
   158→          <button
   159→            type="button"
   160→            onClick={handleSend}
   161→            disabled={!canSend}
   162→            className={cn(
   163→              "omnibar-send transition-all duration-300",
   164→              canSend
   165→                ? "scale-100 opacity-100 bg-skill-primary hover:bg-skill-primary/90"
   166→                : "scale-90 opacity-30 cursor-not-allowed bg-muted"
   167→            )}
   168→            aria-label="发送消息"
   169→            title={canSend ? "发送消息 (Enter)" : "请输入内容后发送"}
   170→          >
   171→            <Send className="w-5 h-5" />
   172→          </button>
   173→        </div>
   174→
   175→        {/* Footer: Keyboard hints + Character count */}
   176→        <div className="flex items-center justify-between mt-2 px-1">
   177→          <p id="input-hint" className="text-xs text-muted-foreground/60">
   178→            <kbd className="px-1.5 py-0.5 bg-muted/50 rounded text-[10px] font-mono">Enter</kbd>
   179→            <span className="mx-1">发送</span>
   180→            <kbd className="px-1.5 py-0.5 bg-muted/50 rounded text-[10px] font-mono">Shift+Enter</kbd>
   181→            <span className="mx-1">换行</span>
   182→          </p>
   183→          <p className={cn(
   184→            "text-xs transition-colors",
   185→            isNearLimit ? "text-accent-500" : "text-muted-foreground/40"
   186→          )}>
   187→            {charCount} / {MAX_MESSAGE_LENGTH}
   188→          </p>
   189→        </div>
   190→      </div>
   191→    </div>
   192→  );
   193→}
   194→
   195→// ═══════════════════════════════════════════════════════════════════════════
   196→// QuickReplies - Suggested quick reply buttons
   197→// ═══════════════════════════════════════════════════════════════════════════
   198→
   199→interface QuickRepliesProps {
   200→  replies: string[];
   201→  onSelect: (reply: string) => void;
   202→  className?: string;
   203→}
   204→
   205→export function QuickReplies({ replies, onSelect, className }: QuickRepliesProps) {
   206→  if (replies.length === 0) return null;
   207→
   208→  return (
   209→    <div className={cn("flex flex-wrap gap-2 px-4 pb-2", className)}>
   210→      {replies.map((reply, index) => (
   211→        <button
   212→          key={index}
   213→          onClick={() => onSelect(reply)}
   214→          className={cn(
   215→            "px-3 py-1.5 text-sm rounded-full",
   216→            "bg-muted/50 text-muted-foreground",
   217→            "border border-border/50",
   218→            "hover:bg-muted hover:text-foreground",
   219→            "transition-colors duration-200"
   220→          )}
   221→        >
   222→          {reply}
   223→        </button>
   224→      ))}
   225→    </div>
   226→  );
   227→}
   228→
   229→// ═══════════════════════════════════════════════════════════════════════════
   230→// FloatingOmnibar - Floating version for landing pages
   231→// ═══════════════════════════════════════════════════════════════════════════
   232→
   233→interface FloatingOmnibarProps {
   234→  onSend: (message: string) => void;
   235→  placeholder?: string;
   236→  className?: string;
   237→}
   238→
   239→export function FloatingOmnibar({
   240→  onSend,
   241→  placeholder = "输入你的出生日期开始...",
   242→  className,
   243→}: FloatingOmnibarProps) {
   244→  const [value, setValue] = useState("");
   245→
   246→  const handleSubmit = () => {
   247→    if (value.trim()) {
   248→      onSend(value.trim());
   249→      setValue("");
   250→    }
   251→  };
   252→
   253→  return (
   254→    <div className={cn("bg-bg-card border border-subtle shadow-soft p-6 w-full md:max-w-lg mx-auto", className)}>
   255→      <div className="omnibar">
   256→        <input
   257→          type="text"
   258→          value={value}
   259→          onChange={(e) => setValue(e.target.value)}
   260→          onKeyDown={(e) => e.key === "Enter" && handleSubmit()}
   261→          placeholder={placeholder}
   262→          className="omnibar-input"
   263→        />
   264→        <button
   265→          onClick={handleSubmit}
   266→          disabled={!value.trim()}
   267→          className={cn(
   268→            "omnibar-send",
   269→            !value.trim() && "opacity-50 cursor-not-allowed"
   270→          )}
   271→        >
   272→          <Send className="w-5 h-5" />
   273→        </button>
   274→      </div>
   275→    </div>
   276→  );
   277→}
   278→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
