     1â†’"use client";
     2â†’
     3â†’/**
     4â†’ * NavBar - PCç«¯å·¦ä¾§å¯¼èˆªæ  v10.0
     5â†’ *
     6â†’ * V10 å˜æ›´:
     7â†’ * - å¯¹è¯å†å²æ•´åˆåˆ° NavBar ä¸­
     8â†’ * - "å¯¹è¯"æŒ‰é’® = å¼€å§‹æ–°å¯¹è¯
     9â†’ * - å†å²å¯¹è¯åˆ—è¡¨æ˜¾ç¤ºåœ¨å¯¼èˆªé“¾æ¥ä¸‹æ–¹
    10â†’ */
    11â†’
    12â†’import { useState, useEffect } from "react";
    13â†’import { motion, AnimatePresence } from "framer-motion";
    14â†’import { cn } from "@/lib/utils";
    15â†’import {
    16â†’  PanelLeftClose,
    17â†’  PanelLeft,
    18â†’  MoreHorizontal,
    19â†’  Pencil,
    20â†’  Trash2,
    21â†’} from "lucide-react";
    22â†’import Link from "next/link";
    23â†’import { VibeGlyph, type SkillType } from "@/components/core";
    24â†’import { type TabType } from "./AppShell";
    25â†’import { useConversations, type ConversationItem } from "@/hooks/useConversations";
    26â†’
    27â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    28â†’// Types & Config
    29â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    30â†’
    31â†’interface NavBarProps {
    32â†’  skill: SkillType;
    33â†’  activeTab: TabType;
    34â†’  onTabChange: (tab: TabType) => void;
    35â†’  activeConversationId: string | null;
    36â†’  onSelectConversation: (id: string | null) => void;
    37â†’  onNewChat: () => void;
    38â†’  className?: string;
    39â†’}
    40â†’
    41â†’interface NavItem {
    42â†’  id: TabType;
    43â†’  icon: string;
    44â†’  label: string;
    45â†’  description?: string;
    46â†’}
    47â†’
    48â†’// V10: 4 navigation items - é¡ºåºï¼šæˆ‘ã€æ—…ç¨‹ã€å…³ç³»ã€æ¢ç´¢
    49â†’// ä½¿ç”¨æ¸å˜èƒŒæ™¯ Emoji å›¾æ ‡é£æ ¼
    50â†’const NAV_ITEMS: NavItem[] = [
    51â†’  {
    52â†’    id: "me",
    53â†’    icon: "ğŸ‘¤",
    54â†’    label: "æˆ‘",
    55â†’    description: "ä¸ªäººä¸­å¿ƒ",
    56â†’  },
    57â†’  {
    58â†’    id: "journey",
    59â†’    icon: "ğŸ¯",
    60â†’    label: "ç›®æ ‡",
    61â†’    description: "æˆ‘çš„ç›®æ ‡",
    62â†’  },
    63â†’  {
    64â†’    id: "relations",
    65â†’    icon: "ğŸ’‘",
    66â†’    label: "å…³ç³»",
    67â†’    description: "äººé™…å…³ç³»",
    68â†’  },
    69â†’  {
    70â†’    id: "discover",
    71â†’    icon: "âœ¨",
    72â†’    label: "æ¢ç´¢",
    73â†’    description: "å‘ç°æ›´å¤š Skills",
    74â†’  },
    75â†’];
    76â†’
    77â†’const STORAGE_KEY = "vibelife-navbar-expanded";
    78â†’
    79â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    80â†’// NavBar Component
    81â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    82â†’
    83â†’export function NavBar({
    84â†’  skill,
    85â†’  activeTab,
    86â†’  onTabChange,
    87â†’  activeConversationId,
    88â†’  onSelectConversation,
    89â†’  onNewChat,
    90â†’  className,
    91â†’}: NavBarProps) {
    92â†’  const [isExpanded, setIsExpanded] = useState(true); // é»˜è®¤å±•å¼€
    93â†’  const [hoveredItem, setHoveredItem] = useState<string | null>(null);
    94â†’  const [isMounted, setIsMounted] = useState(false);
    95â†’  const [menuOpenId, setMenuOpenId] = useState<string | null>(null);
    96â†’  const [editingId, setEditingId] = useState<string | null>(null);
    97â†’  const [editTitle, setEditTitle] = useState("");
    98â†’
    99â†’  const { conversations, isLoading, renameConversation, deleteConversation } = useConversations();
   100â†’
   101â†’  // ä» localStorage æ¢å¤çŠ¶æ€
   102â†’  useEffect(() => {
   103â†’    setIsMounted(true);
   104â†’    const saved = localStorage.getItem(STORAGE_KEY);
   105â†’    if (saved !== null) {
   106â†’      setIsExpanded(saved === "true");
   107â†’    }
   108â†’  }, []);
   109â†’
   110â†’  const toggleExpanded = () => {
   111â†’    setIsExpanded((prev) => {
   112â†’      const newValue = !prev;
   113â†’      if (typeof window !== "undefined") {
   114â†’        localStorage.setItem(STORAGE_KEY, String(newValue));
   115â†’      }
   116â†’      return newValue;
   117â†’    });
   118â†’  };
   119â†’
   120â†’  // å¼€å§‹æ–°å¯¹è¯
   121â†’  const handleNewChat = () => {
   122â†’    onNewChat();
   123â†’    onTabChange("chat");
   124â†’  };
   125â†’
   126â†’  // é€‰æ‹©å¯¹è¯
   127â†’  const handleSelectConversation = (id: string) => {
   128â†’    onSelectConversation(id);
   129â†’    onTabChange("chat");
   130â†’    setMenuOpenId(null);
   131â†’  };
   132â†’
   133â†’  // é‡å‘½åå¯¹è¯
   134â†’  const handleRename = async (id: string) => {
   135â†’    if (editTitle.trim()) {
   136â†’      await renameConversation(id, editTitle.trim());
   137â†’    }
   138â†’    setEditingId(null);
   139â†’    setEditTitle("");
   140â†’  };
   141â†’
   142â†’  // åˆ é™¤å¯¹è¯
   143â†’  const handleDelete = async (id: string) => {
   144â†’    await deleteConversation(id);
   145â†’    if (activeConversationId === id) {
   146â†’      onSelectConversation(null);
   147â†’    }
   148â†’    setMenuOpenId(null);
   149â†’  };
   150â†’
   151â†’  return (
   152â†’    <motion.nav
   153â†’      initial={false}
   154â†’      animate={{ width: isExpanded ? 260 : 64 }}
   155â†’      transition={{ duration: 0.2, ease: "easeInOut" }}
   156â†’      className={cn(
   157â†’        "h-full flex flex-col bg-card border-r border-border",
   158â†’        className
   159â†’      )}
   160â†’    >
   161â†’      {/* Logo Area + Collapse Toggle */}
   162â†’      <div className="h-14 flex items-center justify-between px-3 border-b border-border">
   163â†’        <div className="flex items-center gap-2">
   164â†’          <VibeGlyph size="sm" skill={skill} showAura={false} animate={false} />
   165â†’          {isExpanded && (
   166â†’            <span className="font-serif font-semibold text-foreground whitespace-nowrap">
   167â†’              VibeLife
   168â†’            </span>
   169â†’          )}
   170â†’        </div>
   171â†’        <button
   172â†’          onClick={toggleExpanded}
   173â†’          aria-label={isExpanded ? "æ”¶èµ·ä¾§è¾¹æ " : "å±•å¼€ä¾§è¾¹æ "}
   174â†’          className="p-1.5 rounded-md text-muted-foreground/60 hover:text-muted-foreground hover:bg-muted/50 transition-colors"
   175â†’        >
   176â†’          {isExpanded ? <PanelLeftClose className="w-4 h-4" /> : <PanelLeft className="w-4 h-4" />}
   177â†’        </button>
   178â†’      </div>
   179â†’
   180â†’      {/* Main Nav Section - æ–°å¯¹è¯ + å¯¼èˆªé¡¹ */}
   181â†’      <div className="px-2 pt-3 pb-2 space-y-1">
   182â†’        {/* æ–°å¯¹è¯æŒ‰é’® */}
   183â†’        <div className="relative">
   184â†’          <button
   185â†’            onClick={handleNewChat}
   186â†’            onMouseEnter={() => !isExpanded && setHoveredItem("chat")}
   187â†’            onMouseLeave={() => setHoveredItem(null)}
   188â†’            className={cn(
   189â†’              "w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200",
   190â†’              isExpanded ? "justify-start" : "justify-center",
   191â†’              "bg-muted/60 text-foreground hover:bg-muted",
   192â†’              "border border-border/50"
   193â†’            )}
   194â†’          >
   195â†’            <div className="w-7 h-7 rounded-lg bg-gradient-to-br from-vellum-100 to-vellum-200 flex items-center justify-center flex-shrink-0">
   196â†’              <span className="text-base">ğŸ’¬</span>
   197â†’            </div>
   198â†’            {isExpanded && (
   199â†’              <span className="text-sm font-medium whitespace-nowrap">æ–°å¯¹è¯</span>
   200â†’            )}
   201â†’          </button>
   202â†’          {!isExpanded && hoveredItem === "chat" && (
   203â†’            <motion.div
   204â†’              initial={{ opacity: 0, x: -4 }}
   205â†’              animate={{ opacity: 1, x: 0 }}
   206â†’              className="absolute left-full top-1/2 -translate-y-1/2 ml-2 z-50"
   207â†’            >
   208â†’              <div className="bg-foreground text-background px-3 py-1.5 rounded-md text-sm whitespace-nowrap shadow-lg">
   209â†’                æ–°å¯¹è¯
   210â†’                <div className="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1 w-2 h-2 bg-foreground rotate-45" />
   211â†’              </div>
   212â†’            </motion.div>
   213â†’          )}
   214â†’        </div>
   215â†’
   216â†’        {/* å¯¼èˆªé¡¹ï¼šæˆ‘ã€æ—…ç¨‹ã€å…³ç³»ã€æ¢ç´¢ */}
   217â†’        {NAV_ITEMS.map((item) => {
   218â†’          const isActive = activeTab === item.id;
   219â†’
   220â†’          return (
   221â†’            <div key={item.id} className="relative">
   222â†’              <button
   223â†’                onClick={() => onTabChange(item.id)}
   224â†’                onMouseEnter={() => !isExpanded && setHoveredItem(item.id)}
   225â†’                onMouseLeave={() => setHoveredItem(null)}
   226â†’                className={cn(
   227â†’                  "w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200",
   228â†’                  isExpanded ? "justify-start" : "justify-center",
   229â†’                  isActive
   230â†’                    ? "bg-black/5 dark:bg-white/10"
   231â†’                    : "hover:bg-muted"
   232â†’                )}
   233â†’              >
   234â†’                <div className={cn(
   235â†’                  "w-7 h-7 rounded-lg flex items-center justify-center flex-shrink-0 transition-all duration-200",
   236â†’                  isActive
   237â†’                    ? "bg-gradient-to-br from-vellum-200 to-vellum-300"
   238â†’                    : "bg-gradient-to-br from-vellum-100 to-vellum-200"
   239â†’                )}>
   240â†’                  <span className="text-base">{item.icon}</span>
   241â†’                </div>
   242â†’                {isExpanded && (
   243â†’                  <span className="text-sm font-medium text-foreground">{item.label}</span>
   244â†’                )}
   245â†’              </button>
   246â†’              {!isExpanded && hoveredItem === item.id && (
   247â†’                <motion.div
   248â†’                  initial={{ opacity: 0, x: -4 }}
   249â†’                  animate={{ opacity: 1, x: 0 }}
   250â†’                  className="absolute left-full top-1/2 -translate-y-1/2 ml-2 z-50"
   251â†’                >
   252â†’                  <div className="bg-foreground text-background px-3 py-1.5 rounded-md text-sm whitespace-nowrap shadow-lg">
   253â†’                    {item.label}
   254â†’                    <div className="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1 w-2 h-2 bg-foreground rotate-45" />
   255â†’                  </div>
   256â†’                </motion.div>
   257â†’              )}
   258â†’            </div>
   259â†’          );
   260â†’        })}
   261â†’      </div>
   262â†’
   263â†’      {/* Conversation History Section - å±•å¼€æ€æ˜¾ç¤º */}
   264â†’      {isExpanded && (
   265â†’        <div className="flex-1 overflow-y-auto border-t border-border">
   266â†’          <div className="px-2 pt-2 pb-2">
   267â†’            <div className="text-xs text-muted-foreground px-3 py-2 font-medium">
   268â†’              å¯¹è¯å†å²
   269â†’            </div>
   270â†’            <div className="space-y-0.5">
   271â†’              {conversations.slice(0, 20).map((conv) => (
   272â†’                <ConversationItem
   273â†’                  key={conv.id}
   274â†’                  conversation={conv}
   275â†’                  isActive={activeConversationId === conv.id}
   276â†’                  isMenuOpen={menuOpenId === conv.id}
   277â†’                  isEditing={editingId === conv.id}
   278â†’                  editTitle={editTitle}
   279â†’                  onSelect={() => handleSelectConversation(conv.id)}
   280â†’                  onMenuToggle={() => setMenuOpenId(menuOpenId === conv.id ? null : conv.id)}
   281â†’                  onStartEdit={() => {
   282â†’                    setEditingId(conv.id);
   283â†’                    setEditTitle(conv.title || "");
   284â†’                    setMenuOpenId(null);
   285â†’                  }}
   286â†’                  onEditChange={setEditTitle}
   287â†’                  onEditSave={() => handleRename(conv.id)}
   288â†’                  onEditCancel={() => {
   289â†’                    setEditingId(null);
   290â†’                    setEditTitle("");
   291â†’                  }}
   292â†’                  onDelete={() => handleDelete(conv.id)}
   293â†’                />
   294â†’              ))}
   295â†’              {isLoading && (
   296â†’                <div className="px-3 py-2 text-xs text-muted-foreground">åŠ è½½ä¸­...</div>
   297â†’              )}
   298â†’              {!isLoading && conversations.length === 0 && (
   299â†’                <div className="px-3 py-2 text-xs text-muted-foreground">æš‚æ— å¯¹è¯</div>
   300â†’              )}
   301â†’            </div>
   302â†’          </div>
   303â†’        </div>
   304â†’      )}
   305â†’
   306â†’      {/* æ”¶èµ·æ€æ—¶çš„å ä½ */}
   307â†’      {!isExpanded && <div className="flex-1" />}
   308â†’
   309â†’      {/* Settings Link */}
   310â†’      <div className="p-2 border-t border-border">
   311â†’        <Link
   312â†’          href="/settings"
   313â†’          className={cn(
   314â†’            "w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200",
   315â†’            "text-muted-foreground hover:bg-muted hover:text-foreground"
   316â†’          )}
   317â†’        >
   318â†’          <div className="w-7 h-7 rounded-lg bg-gradient-to-br from-vellum-100 to-vellum-200 flex items-center justify-center flex-shrink-0">
   319â†’            <span className="text-base">âš™ï¸</span>
   320â†’          </div>
   321â†’          <AnimatePresence>
   322â†’            {isExpanded && (
   323â†’              <motion.span
   324â†’                initial={{ opacity: 0, width: 0 }}
   325â†’                animate={{ opacity: 1, width: "auto" }}
   326â†’                exit={{ opacity: 0, width: 0 }}
   327â†’                className="text-sm font-medium overflow-hidden whitespace-nowrap"
   328â†’              >
   329â†’                è®¾ç½®
   330â†’              </motion.span>
   331â†’            )}
   332â†’          </AnimatePresence>
   333â†’        </Link>
   334â†’      </div>
   335â†’    </motion.nav>
   336â†’  );
   337â†’}
   338â†’
   339â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   340â†’// ConversationItem Component
   341â†’// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   342â†’
   343â†’interface ConversationItemProps {
   344â†’  conversation: ConversationItem;
   345â†’  isActive: boolean;
   346â†’  isMenuOpen: boolean;
   347â†’  isEditing: boolean;
   348â†’  editTitle: string;
   349â†’  onSelect: () => void;
   350â†’  onMenuToggle: () => void;
   351â†’  onStartEdit: () => void;
   352â†’  onEditChange: (value: string) => void;
   353â†’  onEditSave: () => void;
   354â†’  onEditCancel: () => void;
   355â†’  onDelete: () => void;
   356â†’}
   357â†’
   358â†’function ConversationItem({
   359â†’  conversation,
   360â†’  isActive,
   361â†’  isMenuOpen,
   362â†’  isEditing,
   363â†’  editTitle,
   364â†’  onSelect,
   365â†’  onMenuToggle,
   366â†’  onStartEdit,
   367â†’  onEditChange,
   368â†’  onEditSave,
   369â†’  onEditCancel,
   370â†’  onDelete,
   371â†’}: ConversationItemProps) {
   372â†’  if (isEditing) {
   373â†’    return (
   374â†’      <div className="px-2 py-1">
   375â†’        <input
   376â†’          type="text"
   377â†’          value={editTitle}
   378â†’          onChange={(e) => onEditChange(e.target.value)}
   379â†’          onKeyDown={(e) => {
   380â†’            if (e.key === "Enter") onEditSave();
   381â†’            if (e.key === "Escape") onEditCancel();
   382â†’          }}
   383â†’          onBlur={onEditSave}
   384â†’          autoFocus
   385â†’          className="w-full px-2 py-1 text-sm bg-background border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-[var(--accent-primary)]"
   386â†’        />
   387â†’      </div>
   388â†’    );
   389â†’  }
   390â†’
   391â†’  return (
   392â†’    <div className="relative group">
   393â†’      <button
   394â†’        onClick={onSelect}
   395â†’        className={cn(
   396â†’          "w-full flex items-center gap-2 px-3 py-2 rounded-lg text-left transition-all duration-200",
   397â†’          isActive
   398â†’            ? "bg-[var(--accent-primary)]/10 text-[var(--accent-primary)]"
   399â†’            : "text-text-secondary hover:bg-muted hover:text-foreground"
   400â†’        )}
   401â†’      >
   402â†’        <span className="text-sm flex-shrink-0 opacity-80">ğŸ’¬</span>
   403â†’        <span className="text-sm truncate flex-1">{conversation.title || "æ–°å¯¹è¯"}</span>
   404â†’      </button>
   405â†’
   406â†’      {/* Menu Button */}
   407â†’      <button
   408â†’        onClick={(e) => {
   409â†’          e.stopPropagation();
   410â†’          onMenuToggle();
   411â†’        }}
   412â†’        className={cn(
   413â†’          "absolute right-1 top-1/2 -translate-y-1/2 p-1 rounded-md transition-opacity",
   414â†’          "opacity-0 group-hover:opacity-100",
   415â†’          isMenuOpen && "opacity-100",
   416â†’          "text-muted-foreground hover:text-foreground hover:bg-muted"
   417â†’        )}
   418â†’      >
   419â†’        <MoreHorizontal className="w-4 h-4" />
   420â†’      </button>
   421â†’
   422â†’      {/* Dropdown Menu */}
   423â†’      {isMenuOpen && (
   424â†’        <div className="absolute right-0 top-full mt-1 z-50 bg-card border border-border rounded-lg shadow-lg py-1 min-w-[120px]">
   425â†’          <button
   426â†’            onClick={(e) => {
   427â†’              e.stopPropagation();
   428â†’              onStartEdit();
   429â†’            }}
   430â†’            className="w-full flex items-center gap-2 px-3 py-1.5 text-sm text-left hover:bg-muted transition-colors"
   431â†’          >
   432â†’            <Pencil className="w-3.5 h-3.5" />
   433â†’            <span>é‡å‘½å</span>
   434â†’          </button>
   435â†’          <button
   436â†’            onClick={(e) => {
   437â†’              e.stopPropagation();
   438â†’              onDelete();
   439â†’            }}
   440â†’            className="w-full flex items-center gap-2 px-3 py-1.5 text-sm text-left text-red-500 hover:bg-red-50 dark:hover:bg-red-950/20 transition-colors"
   441â†’          >
   442â†’            <Trash2 className="w-3.5 h-3.5" />
   443â†’            <span>åˆ é™¤</span>
   444â†’          </button>
   445â†’        </div>
   446â†’      )}
   447â†’    </div>
   448â†’  );
   449â†’}
   450â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
