     1→"use client";
     2→
     3→/**
     4→ * ConversationItem - Single conversation row with actions
     5→ */
     6→
     7→import { useState, useRef, useEffect } from "react";
     8→import { MoreHorizontal, Pencil, Trash2, Check, X } from "lucide-react";
     9→import { cn } from "@/lib/utils";
    10→import type { ConversationItem as ConversationItemType } from "@/hooks/useConversations";
    11→
    12→interface ConversationItemProps {
    13→  conversation: ConversationItemType;
    14→  isActive: boolean;
    15→  onClick: () => void;
    16→  onRename: (title: string) => Promise<void>;
    17→  onDelete: () => Promise<void>;
    18→}
    19→
    20→export function ConversationItem({
    21→  conversation,
    22→  isActive,
    23→  onClick,
    24→  onRename,
    25→  onDelete,
    26→}: ConversationItemProps) {
    27→  const [isMenuOpen, setIsMenuOpen] = useState(false);
    28→  const [isEditing, setIsEditing] = useState(false);
    29→  const [editTitle, setEditTitle] = useState(conversation.title || "");
    30→  const [isDeleting, setIsDeleting] = useState(false);
    31→  const inputRef = useRef<HTMLInputElement>(null);
    32→  const menuRef = useRef<HTMLDivElement>(null);
    33→
    34→  // Focus input when editing starts
    35→  useEffect(() => {
    36→    if (isEditing && inputRef.current) {
    37→      inputRef.current.focus();
    38→      inputRef.current.select();
    39→    }
    40→  }, [isEditing]);
    41→
    42→  // Close menu on outside click
    43→  useEffect(() => {
    44→    function handleClickOutside(event: MouseEvent) {
    45→      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {
    46→        setIsMenuOpen(false);
    47→      }
    48→    }
    49→    if (isMenuOpen) {
    50→      document.addEventListener("mousedown", handleClickOutside);
    51→    }
    52→    return () => document.removeEventListener("mousedown", handleClickOutside);
    53→  }, [isMenuOpen]);
    54→
    55→  const handleRename = async () => {
    56→    if (editTitle.trim() && editTitle !== conversation.title) {
    57→      await onRename(editTitle.trim());
    58→    }
    59→    setIsEditing(false);
    60→  };
    61→
    62→  const handleDelete = async () => {
    63→    setIsDeleting(true);
    64→    try {
    65→      await onDelete();
    66→    } finally {
    67→      setIsDeleting(false);
    68→      setIsMenuOpen(false);
    69→    }
    70→  };
    71→
    72→  const handleKeyDown = (e: React.KeyboardEvent) => {
    73→    if (e.key === "Enter") {
    74→      handleRename();
    75→    } else if (e.key === "Escape") {
    76→      setEditTitle(conversation.title || "");
    77→      setIsEditing(false);
    78→    }
    79→  };
    80→
    81→  // Display title or fallback
    82→  const displayTitle = conversation.title || "新对话";
    83→
    84→  return (
    85→    <div
    86→      className={cn(
    87→        "group relative flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer",
    88→        "transition-colors duration-150",
    89→        isActive
    90→          ? "bg-skill-primary/10 text-skill-primary"
    91→          : "hover:bg-muted/50 text-foreground/80 hover:text-foreground"
    92→      )}
    93→      onClick={() => !isEditing && onClick()}
    94→    >
    95→      {isEditing ? (
    96→        <div className="flex-1 flex items-center gap-1">
    97→          <input
    98→            ref={inputRef}
    99→            type="text"
   100→            value={editTitle}
   101→            onChange={(e) => setEditTitle(e.target.value)}
   102→            onKeyDown={handleKeyDown}
   103→            onBlur={handleRename}
   104→            className={cn(
   105→              "flex-1 px-2 py-1 text-sm rounded",
   106→              "bg-background border border-border",
   107→              "focus:outline-none focus:ring-1 focus:ring-skill-primary"
   108→            )}
   109→            onClick={(e) => e.stopPropagation()}
   110→          />
   111→          <button
   112→            onClick={(e) => {
   113→              e.stopPropagation();
   114→              handleRename();
   115→            }}
   116→            className="p-1 text-green-500 hover:bg-green-500/10 rounded"
   117→          >
   118→            <Check className="w-3.5 h-3.5" />
   119→          </button>
   120→          <button
   121→            onClick={(e) => {
   122→              e.stopPropagation();
   123→              setEditTitle(conversation.title || "");
   124→              setIsEditing(false);
   125→            }}
   126→            className="p-1 text-red-500 hover:bg-red-500/10 rounded"
   127→          >
   128→            <X className="w-3.5 h-3.5" />
   129→          </button>
   130→        </div>
   131→      ) : (
   132→        <>
   133→          <span className="flex-1 truncate text-sm">{displayTitle}</span>
   134→
   135→          {/* Action menu button - visible on hover or when open */}
   136→          <div
   137→            ref={menuRef}
   138→            className={cn(
   139→              "relative",
   140→              isMenuOpen ? "opacity-100" : "opacity-0 group-hover:opacity-100",
   141→              "transition-opacity duration-150"
   142→            )}
   143→          >
   144→            <button
   145→              onClick={(e) => {
   146→                e.stopPropagation();
   147→                setIsMenuOpen(!isMenuOpen);
   148→              }}
   149→              className={cn(
   150→                "p-1 rounded hover:bg-muted/80",
   151→                "text-muted-foreground hover:text-foreground"
   152→              )}
   153→            >
   154→              <MoreHorizontal className="w-4 h-4" />
   155→            </button>
   156→
   157→            {/* Dropdown menu */}
   158→            {isMenuOpen && (
   159→              <div
   160→                className={cn(
   161→                  "absolute right-0 top-full mt-1 z-50",
   162→                  "min-w-[120px] py-1 rounded-lg shadow-lg",
   163→                  "bg-popover border border-border"
   164→                )}
   165→              >
   166→                <button
   167→                  onClick={(e) => {
   168→                    e.stopPropagation();
   169→                    setIsMenuOpen(false);
   170→                    setIsEditing(true);
   171→                  }}
   172→                  className={cn(
   173→                    "w-full flex items-center gap-2 px-3 py-2 text-sm",
   174→                    "hover:bg-muted text-foreground"
   175→                  )}
   176→                >
   177→                  <Pencil className="w-3.5 h-3.5" />
   178→                  重命名
   179→                </button>
   180→                <button
   181→                  onClick={(e) => {
   182→                    e.stopPropagation();
   183→                    handleDelete();
   184→                  }}
   185→                  disabled={isDeleting}
   186→                  className={cn(
   187→                    "w-full flex items-center gap-2 px-3 py-2 text-sm",
   188→                    "hover:bg-red-500/10 text-red-500",
   189→                    "disabled:opacity-50"
   190→                  )}
   191→                >
   192→                  <Trash2 className="w-3.5 h-3.5" />
   193→                  {isDeleting ? "删除中…" : "删除"}
   194→                </button>
   195→              </div>
   196→            )}
   197→          </div>
   198→        </>
   199→      )}
   200→    </div>
   201→  );
   202→}
   203→
   204→export default ConversationItem;
   205→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
