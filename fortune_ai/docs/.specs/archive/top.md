# MENTIS 顶层设计文档
## AI 改命 | Your Life, Reprogrammed

**版本**: v1.0 (Genesis Edition)
**日期**: 2026-01-03
**定位**: 全球首个可量化人生改变的AI系统
**核心理念**: 命运不是预言，而是可编程的操作系统

---

███╗   ███╗███████╗███╗   ██╗████████╗██╗███████╗
████╗ ████║██╔════╝████╗  ██║╚══██╔══╝██║██╔════╝
██╔████╔██║█████╗  ██╔██╗ ██║   ██║   ██║███████╗
██║╚██╔╝██║██╔══╝  ██║╚██╗██║   ██║   ██║╚════██║
██║ ╚═╝ ██║███████╗██║ ╚████║   ██║   ██║███████║
╚═╝     ╚═╝╚══════╝╚═╝  ╚═══╝   ╚═╝   ╚═╝╚══════╝
      >>  DECODE. REFRAME. EVOLVE.  <<

---

# 第一章：战略愿景

## 1.1 核心命题

> **"改命" = 可量化的人生改变**
>
> 不是玄学，是工程问题。
> 不是预言，是操作系统。
> 不是安慰，是结果。

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          MENTIS 核心理念                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│    传统命理 ─────────────────────────────────────────────> 玄学/宿命论      │
│       │                                                                     │
│       │  ╔═══════════════════════════════════════════════════════════╗      │
│       │  ║                                                           ║      │
│       ╰──╬──> MENTIS = 命理 × AI × 行为科学 × 量化反馈                 ║      │
│          ║                                                           ║      │
│          ║         "解码命运，重塑人生"                               ║      │
│          ║         Decode. Reframe. Evolve.                          ║      │
│          ║                                                           ║      │
│          ╚═══════════════════════════════════════════════════════════╝      │
│                                      │                                      │
│                                      v                                      │
│    可量化改变 <─────────────────────────────────────────── 工程/科学        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 1.2 差异化定位

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                          市场定位矩阵                                          ║
╠══════════════════════════════════════════════════════════════════════════════╣
║                                                                              ║
║        高                                                                    ║
║         │                                                                    ║
║   可    │     ┌───────────┐                    ┌─────────────────┐          ║
║   量    │     │ 健身APP   │                    │    MENTIS       │          ║
║   化    │     │ (身体)    │                    │   (全人生)      │          ║
║   程    │     └───────────┘                    │   ★ 我们在这里   │          ║
║   度    │                                      └─────────────────┘          ║
║         │                                                                    ║
║         │     ┌───────────┐                    ┌───────────────┐            ║
║         │     │心理咨询APP│                    │  传统命理APP  │            ║
║         │     │ (情绪)    │                    │   (八字/星座) │            ║
║        低     └───────────┘                    └───────────────┘            ║
║         └──────────────────────────────────────────────────────── 高        ║
║                              覆盖领域广度                                    ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

## 1.3 一句话价值主张

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│     " "解码命运，重塑人生"                                                   │
│                                                                             │
│       Decode. Reframe. Evolve.                                             │
│                                                                             │
│     ─────────────────────────────────────────────────────────────────────   │
│                                                                             │
│     • 解码 (Decode)   ──── 八字/紫微/MBTI 多维画像/深度心理分析                │
│     • 重塑 (Reframe)──── 人生日记 + 人生目标 + AI教练 + 微习惯 + 认知重塑      │
│     • 进化 (Evolve)  ──── 人生仪表盘 + 改命指数 + 里程碑                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

# 第二章：商业模型

## 2.1 商业模式画布

```
╔════════════════════════════════════════════════════════════════════════════════════════╗
║                              MENTIS 商业模式画布                                          ║
╠════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                        ║
║  ┌──────────────┐   ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐   ║
║  │ 关键合作伙伴  │   │   关键活动      │   │   价值主张       │   │   客户关系       │   ║
║  ├──────────────┤   ├─────────────────┤   ├─────────────────┤   ├─────────────────┤   ║
║  │ • 大模型供应  │   │ • AI 模型训练   │   │ ★ 可量化的      │   │ • AI 教练 1:1   │   ║
║  │   (GLM/Claude)│   │ • 命理知识体系  │   │   人生改变       │   │ • 社群互助      │   ║
║  │ • 心理学专家  │   │ • 产品迭代      │   │ ───────────────  │   │ • 进度推送      │   ║
║  │ • 命理大师    │   │ • 用户增长      │   │ 解码 → 重编 →   │   │                 │   ║
║  │ • 社交平台    │   │                 │   │ 量化 → 见证     │   │                 │   ║
║  └──────────────┘   └─────────────────┘   └─────────────────┘   └─────────────────┘   ║
║                      ┌─────────────────┐                         ┌─────────────────┐   ║
║                      │   关键资源      │                         │   渠道          │   ║
║                      ├─────────────────┤                         ├─────────────────┤   ║
║                      │ • 命理知识库    │                         │ • 微信生态      │   ║
║                      │ • AI 模型能力   │                         │ • 短视频平台    │   ║
║                      │ • 用户行为数据  │                         │ • 口碑转介绍    │   ║
║                      │ • 改命案例库    │                         │ • SEO/ASO       │   ║
║                      └─────────────────┘                         └─────────────────┘   ║
║  ┌─────────────────────────────────────────────────────────────────────────────────┐  ║
║  │                              用户分层                                            │  ║
║  ├─────────────────────────────────────────────────────────────────────────────────┤  ║
║  │  迷茫青年 (25-35)    │    职场中层 (30-45)    │    创业者/高净值 (35-55)        │  ║
║  │  "我不知道方向"      │    "我想突破瓶颈"       │    "我要掌控全局"               │  ║
║  │  ───────────────────┴────────────────────────┴─────────────────────────────────│  ║
║  │  ★ 核心痛点: 对未来的不确定感 + 缺乏可信的指引系统                               │  ║
║  └─────────────────────────────────────────────────────────────────────────────────┘  ║
║  ┌────────────────────────────────────┐   ┌────────────────────────────────────────┐  ║
║  │          成本结构                  │   │          收入来源                      │  ║
║  ├────────────────────────────────────┤   ├────────────────────────────────────────┤  ║
║  │ • 大模型 API 调用成本 (40%)        │   │ • 订阅制 (基础版 ¥29/月, PRO ¥99/月)  │  ║
║  │ • 研发人员 (35%)                   │   │ • 深度报告 (¥99-299/份)               │  ║
║  │ • 营销获客 (20%)                   │   │ • 私域社群 (¥999/季)                  │  ║
║  │ • 运营服务 (5%)                    │   │ • 企业版 (定制定价)                   │  ║
║  └────────────────────────────────────┘   └────────────────────────────────────────┘  ║
╚════════════════════════════════════════════════════════════════════════════════════════╝
```

## 2.2 核心增长飞轮

```
                          ╔══════════════════════╗
                          ║   MENTIS 增长飞轮    ║
                          ╚══════════════════════╝
                                    │
                                    ▼
        ┌───────────────────────────────────────────────────────┐
        │                                                       │
        │    ┌─────────────┐                                   │
        │    │  1. 解码    │  AI 解读命盘，产生"共鸣时刻"     │
        │    │  (Decode)   │  → 用户感到"被看见"               │
        │    └──────┬──────┘                                   │
        │           │                                           │
        │           ▼                                           │
        │    ┌─────────────┐                                   │
        │    │  2. 承诺    │  每日微行动 + AI 提醒              │
        │    │ (Commit)    │  → 形成改变动力                   │
        │    └──────┬──────┘                                   │
        │           │                                           │
        │           ▼                                           │
        │    ┌─────────────┐                                   │
        │    │  3. 结果    │  Dashboard + 改命指数                │
        │    │ (Outcome)   │  → 看到真实改变                   │
        │    └──────┬──────┘                                   │
        │           │                                           │
        │           ▼                                           │
        │    ┌─────────────┐                                   │
        │    │  4. 分享    │  海报 + 故事 + 接龙                │
        │    │  (Share)    │  → 病毒式传播                     │
        │    └──────┬──────┘                                   │
        │           │                                           │
        │           ╰──────────────────────────────────────────│──╮
        │                                                       │  │
        └───────────────────────────────────────────────────────┘  │
                                    ▲                              │
                                    │                              │
                                    ╰──────────────────────────────╯
                                      新用户进入 (口碑/分享)
```

## 2.3 收入模型

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          MENTIS 收入金字塔                                    │
└─────────────────────────────────────────────────────────────────────────────┘

                              ╱╲
                             ╱  ╲
                            ╱    ╲
                           ╱ 顶层 ╲        【企业版/私董会】
                          ╱ 定制  ╲        ¥10,000+/年
                         ╱        ╲        企业团队命盘、战略咨询
                        ╱──────────╲       
                       ╱    高端    ╲      【私域社群】
                      ╱    社群     ╲      ¥999/季
                     ╱              ╲      深度陪伴、线下活动、大师问答
                    ╱────────────────╲     
                   ╱   深度报告付费   ╲    【单次报告】
                  ╱                   ╲    ¥99-299/份
                 ╱   流年/事业/婚姻    ╲   AI深度分析报告
                ╱──────────────────────╲   
               ╱      订阅制 PRO        ╲  【PRO会员】
              ╱                          ╲  ¥99/月 或 ¥699/年
             ╱   无限对话 + 高级分析      ╲  解锁全部功能
            ╱────────────────────────────╲ 
           ╱        订阅制 基础            ╲ 【基础会员】
          ╱                                 ╲ ¥29/月
         ╱   基础对话 + 每日指引 + K线       ╲ 核心功能
        ╱──────────────────────────────────────╲
       ╱               免费层                    ╲【Free】
      ╱                                           ╲ 3次深度对话 + 基础报告
     ╱   Freemium 漏斗入口                         ╲ 病毒传播引擎
    ╱───────────────────────────────────────────────╲

    用户量:  ◆ 1%   ◆◆ 5%   ◆◆◆ 15%   ◆◆◆◆ 25%   ◆◆◆◆◆◆ 54%

```

---

# 第三章：产品架构

## 3.1 核心产品矩阵

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                          MENTIS 产品矩阵                                       ║
╠══════════════════════════════════════════════════════════════════════════════╣
║                                                                              ║
║    ┌─────────────────────────────────────────────────────────────────────┐  ║
║    │                        ⚡ 核心产品层                                  │  ║
║    │                                                                     │  ║
║    │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐           │  ║
║    │  │  🔮 DECODE    │  │  🧠 REPROGRAM │  │  📈 MEASURE   │           │  ║
║    │  │   解码引擎     │  │   重编引擎    │  │   量化引擎    │           │  ║
║    │  ├───────────────┤  ├───────────────┤  ├───────────────┤           │  ║
║    │  │ • 八字精算    │  │ • AI 教练对话 │  │ • 人生K线    │           │  ║
║    │  │ • 紫微斗数    │  │ • 微习惯处方  │  │ • 改命指数   │           │  ║
║    │  │ • 性格画像    │  │ • 认知重塑    │  │ • 里程碑追踪  │           │  ║
║    │  │ • 流年大运    │  │ • 情绪调节    │  │ • 周期复盘   │           │  ║
║    │  └───────────────┘  └───────────────┘  └───────────────┘           │  ║
║    │                             │                                       │  ║
║    └─────────────────────────────┼───────────────────────────────────────┘  ║
║                                  │                                          ║
║    ┌─────────────────────────────┼───────────────────────────────────────┐  ║
║    │                        💎 增值服务层                                  │  ║
║    │                             │                                       │  ║
║    │  ┌───────────────┐  ┌──────┴────────┐  ┌───────────────┐           │  ║
║    │  │  📄 深度报告   │  │  👥 社群互动   │  │  🎨 传播物料  │           │  ║
║    │  ├───────────────┤  ├───────────────┤  ├───────────────┤           │  ║
║    │  │ • 年度流年    │  │ • 能量加油站  │  │ • 命盘海报   │           │  ║
║    │  │ • 事业报告    │  │ • 好运接龙    │  │ • 改变故事卡  │           │  ║
║    │  │ • 婚姻合盘    │  │ • 私域圈子    │  │ • 分享卡片   │           │  ║
║    │  └───────────────┘  └───────────────┘  └───────────────┘           │  ║
║    └─────────────────────────────────────────────────────────────────────┘  ║
║                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

## 3.2 用户旅程地图

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              MENTIS 用户旅程 (90天改命周期)                               │
└─────────────────────────────────────────────────────────────────────────────────────────┘

 Day 1          Day 7           Day 30          Day 60          Day 90
  │              │               │               │               │
  ▼              ▼               ▼               ▼               ▼
┌────┐        ┌────┐          ┌────┐          ┌────┐          ┌────┐
│ 🌟 │        │ 🔥 │          │ ⚡ │          │ 🚀 │          │ 🏆 │
└────┘        └────┘          └────┘          └────┘          └────┘
  │              │               │               │               │
  │              │               │               │               │
  ▼              ▼               ▼               ▼               ▼
┌──────────┐ ┌──────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐
│  觉醒    │ │  启动    │ │   突破    │ │   稳固    │ │   蜕变    │
│ AWAKEN   │ │ IGNITE   │ │BREAKTHROUGH│ │ SOLIDIFY │ │TRANSFORM │
├──────────┤ ├──────────┤ ├───────────┤ ├───────────┤ ├───────────┤
│          │ │          │ │           │ │           │ │           │
│ • 命盘   │ │ • 首个   │ │ • 21天    │ │ • 关键   │ │ • 改命   │
│   解码   │ │   承诺   │ │   习惯    │ │   里程碑  │ │   见证   │
│          │ │          │ │   形成    │ │   达成    │ │           │
│ • 共鸣   │ │ • 每日   │ │           │ │           │ │ • K线    │
│   时刻   │ │   指引   │ │ • 首次   │ │ • 模式   │ │   可视化  │
│          │ │   开启   │ │   复盘    │ │   固化    │ │           │
│ • 痛点   │ │          │ │           │ │           │ │ • 分享   │
│   识别   │ │ • K线    │ │ • 改命   │ │ • 认知   │ │   传播   │
│          │ │   启动   │ │   指数↑  │ │   升级    │ │           │
└──────────┘ └──────────┘ └───────────┘ └───────────┘ └───────────┘
     │              │               │               │               │
     ▼              ▼               ▼               ▼               ▼
  ┌─────────────────────────────────────────────────────────────────────┐
  │                         情绪曲线                                      │
  │                                                                     │
  │  高                            ┌───────────────────────────╮        │
  │   │                     ╱╲    │                           │        │
  │   │               ╱╲   ╱  ╲  ╱                            ▼        │
  │   │         ╱╲   ╱  ╲ ╱    ╲╱                        🏆 蜕变       │
  │   │    ╱╲  ╱  ╲ ╱                                                  │
  │   │ ╱╲╱  ╲╱                                                        │
  │  低                                                                 │
  │   └─────────────────────────────────────────────────────────────   │
  │        怀疑期    │    适应期    │     突破期    │    稳定期        │
  │                  ▼              ▼               ▼                   │
  │             留存关键点     转化关键点       口碑关键点              │
  └─────────────────────────────────────────────────────────────────────┘
```

## 3.3 核心功能架构

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          MENTIS 功能架构总览                                      │
└─────────────────────────────────────────────────────────────────────────────────┘

                    ┌─────────────────────────────────────┐
                    │          用户触点层                  │
                    │  Web App / 小程序 / API            │
                    └─────────────────┬───────────────────┘
                                      │
          ┌───────────────────────────┼───────────────────────────┐
          │                           │                           │
          ▼                           ▼                           ▼
    ┌───────────────┐         ┌───────────────┐         ┌───────────────┐
    │               │         │               │         │               │
    │   🔮 DECODE   │         │  🧠 REPROGRAM │         │  📈 MEASURE   │
    │   解码中心    │◄───────►│   重编中心    │◄───────►│   量化中心    │
    │               │         │               │         │               │
    └───────┬───────┘         └───────┬───────┘         └───────┬───────┘
            │                         │                         │
    ┌───────┴───────┐         ┌───────┴───────┐         ┌───────┴───────┐
    │               │         │               │         │               │
    │ ┌───────────┐ │         │ ┌───────────┐ │         │ ┌───────────┐ │
    │ │八字精算   │ │         │ │AI 教练    │ │         │ │改命指数   │ │
    │ │BaziEngine │ │         │ │CoachAI    │ │         │ │LifeIndex  │ │
    │ └───────────┘ │         │ └───────────┘ │         │ └───────────┘ │
    │               │         │               │         │               │
    │ ┌───────────┐ │         │ ┌───────────┐ │         │ ┌───────────┐ │
    │ │紫微斗数   │ │         │ │微习惯系统 │ │         │ │人生K线   │ │
    │ │ZiweiEngine│ │         │ │HabitRx    │ │         │ │LifeKline  │ │
    │ └───────────┘ │         │ └───────────┘ │         │ └───────────┘ │
    │               │         │               │         │               │
    │ ┌───────────┐ │         │ ┌───────────┐ │         │ ┌───────────┐ │
    │ │性格画像   │ │         │ │认知重塑   │ │         │ │里程碑    │ │
    │ │Persona    │ │         │ │CBT Reframe│ │         │ │Milestone  │ │
    │ └───────────┘ │         │ └───────────┘ │         │ └───────────┘ │
    │               │         │               │         │               │
    │ ┌───────────┐ │         │ ┌───────────┐ │         │ ┌───────────┐ │
    │ │流年大运   │ │         │ │情绪调节   │ │         │ │周期复盘   │ │
    │ │FortuneFlow│ │         │ │EmotionReg │ │         │ │Reflection │ │
    │ └───────────┘ │         │ └───────────┘ │         │ └───────────┘ │
    │               │         │               │         │               │
    └───────────────┘         └───────────────┘         └───────────────┘
            │                         │                         │
            └─────────────────────────┼─────────────────────────┘
                                      │
                    ┌─────────────────┴───────────────────┐
                    │           Mentis Core OS            │
                    │     (统一上下文 + 记忆 + 推理)       │
                    └─────────────────────────────────────┘
```

---

# 第四章：系统架构

## 4.1 Mentis OS 核心架构

```
╔══════════════════════════════════════════════════════════════════════════════════════════╗
║                              MENTIS CORE OS ARCHITECTURE                                  ║
╠══════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                          ║
║  ┌────────────────────────────────────────────────────────────────────────────────────┐ ║
║  │                           🌐 INTERACTION LAYER                                      │ ║
║  │                                                                                     │ ║
║  │   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐           │ ║
║  │   │ Chat Mode   │   │ Command Mode│   │ Dashboard   │   │ Push/Notify │           │ ║
║  │   │ 自然对话    │   │ /指令触发   │   │ 可视化面板  │   │ 主动推送    │           │ ║
║  │   └──────┬──────┘   └──────┬──────┘   └──────┬──────┘   └──────┬──────┘           │ ║
║  │          └──────────────────┴────────────────┴────────────────┘                    │ ║
║  └─────────────────────────────────────────┬──────────────────────────────────────────┘ ║
║                                            │                                            ║
║  ┌─────────────────────────────────────────┼──────────────────────────────────────────┐ ║
║  │                           🧠 AGENT RUNTIME                                          │ ║
║  │                           Vercel AI SDK 6                                          │ ║
║  │   ┌─────────────────────────────────────┴──────────────────────────────────────┐  │ ║
║  │   │                                                                            │  │ ║
║  │   │   streamText({                                                             │  │ ║
║  │   │     model: selectModel(),      // GLM-4.5 / Claude / Gemini               │  │ ║
║  │   │     system: buildContext(),    // Mentis Context Assembly                  │  │ ║
║  │   │     tools: getSkills(mode),    // Pluggable Skills                        │  │ ║
║  │   │     maxSteps: 5,               // Multi-step Reasoning                    │  │ ║
║  │   │   })                                                                       │  │ ║
║  │   │                                                                            │  │ ║
║  │   └────────────────────────────────────────────────────────────────────────────┘  │ ║
║  │          │                          │                          │                  │ ║
║  │          ▼                          ▼                          ▼                  │ ║
║  │   ┌────────────────┐       ┌────────────────┐       ┌────────────────┐           │ ║
║  │   │  Model Hub     │       │  Skills Registry│       │  Context Mgr   │           │ ║
║  │   │                │       │                 │       │                │           │ ║
║  │   │ • GLM-4.5      │       │ • Decode Skills │       │ • L0 Profile   │           │ ║
║  │   │ • Claude       │       │ • Reprogram     │       │ • L1 Modules   │           │ ║
║  │   │ • Gemini       │       │ • Measure       │       │ • L2 Insights  │           │ ║
║  │   │ • Deepseek     │       │ • Social        │       │ • History Vec  │           │ ║
║  │   └────────────────┘       └────────────────┘       └────────────────┘           │ ║
║  └──────────────────────────────────────────────────────────────────────────────────┘ ║
║                                            │                                            ║
║  ┌─────────────────────────────────────────┼──────────────────────────────────────────┐ ║
║  │                           💾 DATA LAYER                                             │ ║
║  │                                                                                     │ ║
║  │   ┌──────────────────┐   ┌──────────────────┐   ┌──────────────────┐              │ ║
║  │   │    L0: BASE      │   │   L1: MODULE     │   │   L2: INSIGHT    │              │ ║
║  │   │    用户基础       │   │   领域数据        │   │   洞察沉淀        │              │ ║
║  │   ├──────────────────┤   ├──────────────────┤   ├──────────────────┤              │ ║
║  │   │ • user_profile   │   │ • bazi_snapshot  │   │ • insight_log    │              │ ║
║  │   │ • preferences    │   │ • perma_score    │   │ • pattern_cache  │              │ ║
║  │   │ • auth_session   │   │ • kline_daily    │   │ • summary_vector │              │ ║
║  │   │ • push_config    │   │ • commitment     │   │ • milestone      │              │ ║
║  │   │                  │   │ • reflection     │   │                  │              │ ║
║  │   └──────────────────┘   └──────────────────┘   └──────────────────┘              │ ║
║  │                                                                                     │ ║
║  │                    ┌────────────────────────────────────┐                          │ ║
║  │                    │        PostgreSQL (SSOT)           │                          │ ║
║  │                    └────────────────────────────────────┘                          │ ║
║  └─────────────────────────────────────────────────────────────────────────────────────┘ ║
║                                                                                          ║
╚══════════════════════════════════════════════════════════════════════════════════════════╝
```

## 4.2 Skills 可插拔架构

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          MENTIS SKILLS REGISTRY                                   │
│                          可插拔能力系统                                           │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────────────┐
    │  Skills Registry (TypeScript / Zod Schema)                              │
    │                                                                         │
    │  export const skills = {                                                │
    │                                                                         │
    │    // ═══════════════ DECODE SKILLS ═══════════════                    │
    │    decode: {                                                            │
    │      calculate_bazi,      // 八字精算                                   │
    │      calculate_ziwei,     // 紫微斗数                                   │
    │      analyze_daymaster,   // 日主分析                                   │
    │      fortune_forecast,    // 流年预测                                   │
    │    },                                                                   │
    │                                                                         │
    │    // ═══════════════ REPROGRAM SKILLS ═══════════════                 │
    │    reprogram: {                                                         │
    │      habit_prescription,  // 微习惯处方                                 │
    │      cbt_reframe,        // 认知重塑                                    │
    │      emotion_regulate,    // 情绪调节                                   │
    │      decision_matrix,     // 决策辅助                                   │
    │    },                                                                   │
    │                                                                         │
    │    // ═══════════════ MEASURE SKILLS ═══════════════                   │
    │    measure: {                                                           │
    │      log_checkin,        // 打卡记录                                    │
    │      calculate_index,     // 改命指数                                   │
    │      generate_kline,      // K线生成                                    │
    │      track_milestone,     // 里程碑追踪                                 │
    │    },                                                                   │
    │                                                                         │
    │    // ═══════════════ SOCIAL SKILLS ═══════════════                    │
    │    social: {                                                            │
    │      energy_boost,       // 能量加油                                    │
    │      luck_chain,         // 好运接龙                                    │
    │      generate_poster,     // 海报生成                                   │
    │    },                                                                   │
    │  }                                                                      │
    └─────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │  Skill 定义示例 (habit_prescription)                                    │
    │                                                                         │
    │  export const habit_prescription = tool({                               │
    │    description: '根据用户命盘和当前状态，生成微习惯处方',               │
    │    parameters: z.object({                                               │
    │      goal: z.string(),                                                  │
    │      duration_days: z.number().default(21),                             │
    │      difficulty: z.enum(['easy', 'medium', 'hard']),                    │
    │    }),                                                                  │
    │    execute: async ({ goal, duration_days, difficulty }) => {            │
    │      // 1. 获取用户命盘特征                                              │
    │      // 2. 匹配适合的习惯模板                                            │
    │      // 3. 生成 If-Then 执行计划                                         │
    │      // 4. 创建 commitment 记录                                          │
    │      return { habit, schedule, commitment_id }                          │
    │    }                                                                    │
    │  })                                                                     │
    └─────────────────────────────────────────────────────────────────────────┘
```

## 4.3 数据流架构

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          MENTIS 数据流架构                                        │
│                          Hot Path + Cold Path                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

                              ┌───────────────┐
                              │    用户输入    │
                              └───────┬───────┘
                                      │
                    ┌─────────────────┼─────────────────┐
                    │                 │                 │
                    ▼                 ▼                 ▼
              ┌──────────┐     ┌──────────┐     ┌──────────┐
              │   Chat   │     │ Command  │     │  Action  │
              │  自然语言 │     │  /指令   │     │  点击    │
              └────┬─────┘     └────┬─────┘     └────┬─────┘
                   │                │                │
                   └────────────────┼────────────────┘
                                    │
    ═══════════════════════════════════════════════════════════════════════════
    ║                          HOT PATH (同步 < 2s)                            ║
    ═══════════════════════════════════════════════════════════════════════════
                                    │
                                    ▼
                    ┌───────────────────────────────┐
                    │       Context Assembly        │
                    │   L0 Profile + L1 Module +    │
                    │   L2 Insight + History Vec    │
                    └───────────────┬───────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────────┐
                    │        Agent Runtime          │
                    │   streamText() + tool()       │
                    └───────────────┬───────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────────┐
                    │         A2UI 输出             │
                    │  结论 + 处方 + 承诺邀请 + 卡片 │
                    └───────────────┬───────────────┘
                                    │
                                    ▼
                              ┌──────────┐
                              │  用户    │
                              └──────────┘

    ═══════════════════════════════════════════════════════════════════════════
    ║                          COLD PATH (异步 后台)                           ║
    ═══════════════════════════════════════════════════════════════════════════
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
          ┌─────────────────┐             ┌─────────────────┐
          │  Insight Agent  │             │   Cron Worker   │
          │  对话洞察萃取    │             │  定时任务调度    │
          └────────┬────────┘             └────────┬────────┘
                   │                               │
                   ▼                               ▼
          ┌─────────────────┐             ┌─────────────────┐
          │  反写 L0/L1     │             │  每日 K线计算   │
          │  • 偏好更新      │             │  • OHLC 汇总    │
          │  • 状态感知      │             │  • 改命指数     │
          │  • 历史摘要      │             │  • Push 触发    │
          └─────────────────┘             └─────────────────┘
```

## 4.4 技术栈选型

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          MENTIS 技术栈                                           │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌───────────────────────────────────────────────────────────────────────────┐
    │                             前端层                                         │
    │                                                                           │
    │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
    │   │ Next.js 15  │  │   React 19  │  │ Tailwind CSS│  │  Zustand    │     │
    │   │  App Router │  │   RSC/SSR   │  │  + shadcn   │  │  状态管理    │     │
    │   └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
    │                                                                           │
    │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                      │
    │   │Vercel AI SDK│  │  useChat()  │  │ Framer Motion│                      │
    │   │ 流式对话    │  │  Hook       │  │  动效       │                      │
    │   └─────────────┘  └─────────────┘  └─────────────┘                      │
    └───────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
    ┌───────────────────────────────────────────────────────────────────────────┐
    │                           Agent Runtime                                    │
    │                                                                           │
    │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
    │   │ Vercel AI   │  │ streamText()│  │   tool()    │  │ Multi-Model │     │
    │   │   SDK 6     │  │  流式推理   │  │  技能调用   │  │  Provider   │     │
    │   └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
    │                                                                           │
    │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                      │
    │   │   GLM-4.5   │  │   Claude    │  │   Gemini    │                      │
    │   │   主力模型   │  │   复杂推理  │  │   多模态    │                      │
    │   └─────────────┘  └─────────────┘  └─────────────┘                      │
    └───────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
    ┌───────────────────────────────────────────────────────────────────────────┐
    │                            后端服务                                        │
    │                                                                           │
    │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
    │   │  FastAPI    │  │ PostgreSQL  │  │   Redis     │  │  Celery     │     │
    │   │  数据服务   │  │    SSOT     │  │   缓存      │  │  异步任务   │     │
    │   └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
    │                                                                           │
    │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                      │
    │   │   Nginx     │  │   Docker    │  │ Kubernetes  │                      │
    │   │  反向代理   │  │   容器化    │  │  编排(可选) │                      │
    │   └─────────────┘  └─────────────┘  └─────────────┘                      │
    └───────────────────────────────────────────────────────────────────────────┘
```

---

# 第五章：核心功能设计

## 5.1 DECODE 解码引擎

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                          🔮 DECODE ENGINE                                      ║
║                          解码引擎 - 命运解析中心                                ║
╠══════════════════════════════════════════════════════════════════════════════╣
║                                                                              ║
║  ┌─────────────────────────────────────────────────────────────────────────┐║
║  │                          输入层                                          │║
║  │                                                                         │║
║  │   ┌───────────────┐                  ┌───────────────┐                 │║
║  │   │   出生信息    │                  │   辅助信息    │                 │║
║  │   │ • 出生日期    │                  │ • 出生地点    │                 │║
║  │   │ • 出生时辰    │                  │ • 性别       │                 │║
║  │   │ • 公历/农历   │                  │ • 当前困惑    │                 │║
║  │   └───────────────┘                  └───────────────┘                 │║
║  └────────────────────────────────┬────────────────────────────────────────┘║
║                                   │                                          ║
║  ┌────────────────────────────────┼────────────────────────────────────────┐║
║  │                          计算层                                          │║
║  │                                │                                         │║
║  │   ┌───────────────┐   ┌───────┴───────┐   ┌───────────────┐            │║
║  │   │  BaziEngine   │   │  ZiweiEngine  │   │ PersonaEngine │            │║
║  │   │  八字精算     │   │  紫微斗数     │   │  性格画像     │            │║
║  │   ├───────────────┤   ├───────────────┤   ├───────────────┤            │║
║  │   │ • 四柱排盘    │   │ • 命盘排布    │   │ • MBTI 推断   │            │║
║  │   │ • 十神分析    │   │ • 主星解读    │   │ • 五行性格    │            │║
║  │   │ • 神煞定位    │   │ • 宫位关联    │   │ • 行为倾向    │            │║
║  │   │ • 格局判定    │   │ • 四化飞星    │   │ • 决策风格    │            │║
║  │   │ • 大运流年    │   │ • 流年预测    │   │ • 压力响应    │            │║
║  │   └───────────────┘   └───────────────┘   └───────────────┘            │║
║  └────────────────────────────────┬────────────────────────────────────────┘║
║                                   │                                          ║
║  ┌────────────────────────────────┼────────────────────────────────────────┐║
║  │                          输出层                                          │║
║  │                                │                                         │║
║  │   ┌────────────────────────────┴────────────────────────────────────┐   │║
║  │   │                   命盘快照 (bazi_snapshot)                       │   │║
║  │   │                                                                  │   │║
║  │   │  {                                                               │   │║
║  │   │    "daymaster": "甲木",                                          │   │║
║  │   │    "daymaster_strength": "身旺",                                 │   │║
║  │   │    "pattern": "食神生财格",                                      │   │║
║  │   │    "favorable_elements": ["水", "木"],                           │   │║
║  │   │    "current_luck": "丙申大运第3年",                              │   │║
║  │   │    "year_forecast": { "career": 72, "wealth": 65, "health": 80 },│   │║
║  │   │    "persona_tags": ["创意型", "完美主义", "外向直觉"],            │   │║
║  │   │    "key_insights": ["适合创业", "注意肝胆", "贵人在西北方"]       │   │║
║  │   │  }                                                               │   │║
║  │   └──────────────────────────────────────────────────────────────────┘   │║
║  └──────────────────────────────────────────────────────────────────────────┘║
║                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

## 5.2 REPROGRAM 重编引擎

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                          🧠 REPROGRAM ENGINE                                   ║
║                          重编引擎 - AI教练中心                                  ║
╠══════════════════════════════════════════════════════════════════════════════╣
║                                                                              ║
║   ┌──────────────────────────────────────────────────────────────────────┐  ║
║   │                       AI 教练对话核心                                  │  ║
║   │                                                                        │  ║
║   │   用户输入 ──────────────────────────────────────────────────────>    │  ║
║   │       │                                                                │  ║
║   │       ▼                                                                │  ║
║   │   ┌─────────────────────────────────────────────────────────────┐     │  ║
║   │   │              Context Assembly (上下文组装)                   │     │  ║
║   │   │                                                              │     │  ║
║   │   │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐        │     │  ║
║   │   │  │L0 Profile│  │L1 Bazi │  │L1 PERMA │  │History  │        │     │  ║
║   │   │  │用户画像  │  │八字特征│  │幸福指数│  │历史向量│        │     │  ║
║   │   │  └─────────┘  └─────────┘  └─────────┘  └─────────┘        │     │  ║
║   │   └──────────────────────────────┬──────────────────────────────┘     │  ║
║   │                                  │                                     │  ║
║   │                                  ▼                                     │  ║
║   │   ┌─────────────────────────────────────────────────────────────┐     │  ║
║   │   │                Agent Runtime (推理引擎)                      │     │  ║
║   │   │                                                              │     │  ║
║   │   │   System Prompt (Mentis 人设):                               │     │  ║
║   │   │   "你是 Mentis，一个融合东方命理与现代心理学的 AI 教练。      │     │  ║
║   │   │    你的使命是帮助用户'改命'——通过可量化的行为改变，           │     │  ║
║   │   │    实现人生轨迹的跃迁..."                                     │     │  ║
║   │   │                                                              │     │  ║
║   │   │   + 用户命盘特征 + 当前状态 + 历史对话摘要                    │     │  ║
║   │   └──────────────────────────────┬──────────────────────────────┘     │  ║
║   │                                  │                                     │  ║
║   │                                  ▼                                     │  ║
║   │   ┌─────────────────────────────────────────────────────────────┐     │  ║
║   │   │                A2UI 结构化输出                                │     │  ║
║   │   │                                                              │     │  ║
║   │   │   {                                                          │     │  ║
║   │   │     "insight": "你现在的焦虑源于...",      // 洞察           │     │  ║
║   │   │     "reframe": "换个角度看...",           // 认知重塑        │     │  ║
║   │   │     "prescription": [                     // 行动处方        │     │  ║
║   │   │       { "action": "...", "if_then": "..." }                  │     │  ║
║   │   │     ],                                                       │     │  ║
║   │   │     "commitment_ask": "你愿意先做哪一个？", // 承诺邀请      │     │  ║
║   │   │     "actions": [                          // 可点击按钮      │     │  ║
║   │   │       { "label": "接受挑战", "action": "accept_task" }       │     │  ║
║   │   │     ]                                                        │     │  ║
║   │   │   }                                                          │     │  ║
║   │   └─────────────────────────────────────────────────────────────┘     │  ║
║   │                                                                        │  ║
║   └──────────────────────────────────────────────────────────────────────┘  ║
║                                                                              ║
║   ┌──────────────────────────────────────────────────────────────────────┐  ║
║   │                       核心能力模块                                     │  ║
║   │                                                                        │  ║
║   │   ┌────────────────┐   ┌────────────────┐   ┌────────────────┐       │  ║
║   │   │  微习惯处方    │   │   认知重塑     │   │   情绪调节     │       │  ║
║   │   │  HabitRx       │   │   CBT Reframe  │   │  EmotionReg    │       │  ║
║   │   ├────────────────┤   ├────────────────┤   ├────────────────┤       │  ║
║   │   │ • 2分钟启动法  │   │ • 自动思维识别 │   │ • 情绪命名     │       │  ║
║   │   │ • If-Then 计划 │   │ • 认知扭曲检测 │   │ • 3分钟降噪    │       │  ║
║   │   │ • 最小可行动作 │   │ • 证据检验     │   │ • 呼吸锚定     │       │  ║
║   │   │ • 习惯堆叠     │   │ • 替代思维     │   │ • 情绪K线      │       │  ║
║   │   └────────────────┘   └────────────────┘   └────────────────┘       │  ║
║   │                                                                        │  ║
║   │   ┌────────────────┐   ┌────────────────┐                            │  ║
║   │   │   决策辅助     │   │   目标设定     │                            │  ║
║   │   │ DecisionMatrix │   │  GoalSetting   │                            │  ║
║   │   ├────────────────┤   ├────────────────┤                            │  ║
║   │   │ • 决策模板     │   │ • SMART 目标   │                            │  ║
║   │   │ • 10/10/10 法则│   │ • 里程碑分解   │                            │  ║
║   │   │ • 命盘适配建议 │   │ • 时运匹配     │                            │  ║
║   │   └────────────────┘   └────────────────┘                            │  ║
║   └──────────────────────────────────────────────────────────────────────┘  ║
║                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

## 5.3 MEASURE 量化引擎

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                          📈 MEASURE ENGINE                                     ║
║                          量化引擎 - 改命追踪中心                                ║
╠══════════════════════════════════════════════════════════════════════════════╣
║                                                                              ║
║   ┌──────────────────────────────────────────────────────────────────────┐  ║
║   │                       改命指数 (Life Change Index)                    │  ║
║   │                                                                        │  ║
║   │   ┌────────────────────────────────────────────────────────────────┐  │  ║
║   │   │                                                                │  │  ║
║   │   │                    改命指数: 72 ↑ (+8)                         │  │  ║
║   │   │                                                                │  │  ║
║   │   │    ███████████████████████████████████████████░░░░░░░░░░░░░   │  │  ║
║   │   │    0                    50                   72          100   │  │  ║
║   │   │                                              ▲                 │  │  ║
║   │   │                                              │                 │  │  ║
║   │   │                                          当前位置              │  │  ║
║   │   └────────────────────────────────────────────────────────────────┘  │  ║
║   │                                                                        │  ║
║   │   计算公式:                                                            │  ║
║   │   ┌────────────────────────────────────────────────────────────────┐  │  ║
║   │   │  LCI = 情绪稳定度(30%) + 行动完成率(35%) + 成长积累(25%)       │  │  ║
║   │   │        + 社交能量(10%)                                         │  │  ║
║   │   │                                                                │  │  ║
║   │   │  • 情绪稳定度 = PERMA 五维均值 + 情绪波动逆指标                 │  │  ║
║   │   │  • 行动完成率 = 承诺完成数 / 承诺接受数                         │  │  ║
║   │   │  • 成长积累   = 里程碑达成 + 连续打卡天数 + 复盘次数            │  │  ║
║   │   │  • 社交能量   = 能量加油次数 + 好运接龙参与                     │  │  ║
║   │   └────────────────────────────────────────────────────────────────┘  │  ║
║   └──────────────────────────────────────────────────────────────────────┘  ║
║                                                                              ║
║   ┌──────────────────────────────────────────────────────────────────────┐  ║
║   │                       人生K线 (Life Kline)                            │  ║
║   │                                                                        │  ║
║   │   ┌────────────────────────────────────────────────────────────────┐  │  ║
║   │   │                                                                │  │  ║
║   │   │   80 ┤                              ╭─╮                        │  │  ║
║   │   │      │                         ╭─╮  │ │  ╭─╮                   │  │  ║
║   │   │   70 ┤                    ╭─╮  │ │  │ │  │ │                   │  │  ║
║   │   │      │               ╭─╮  │ │  │ │╭─┼─╯  │ │                   │  │  ║
║   │   │   60 ┤          ╭─╮  │ │  │ │╭─┼─┴─┘     ╰─╯                   │  │  ║
║   │   │      │     ╭─╮  │ │╭─┼─┴──┴─┘                                  │  │  ║
║   │   │   50 ┤╭─╮  │ │╭─┼─┘                    绿涨 ▌红跌 ▐            │  │  ║
║   │   │      ││ │╭─┼─┘                                                 │  │  ║
║   │   │   40 ┤╰─┴─┘                            ★ 里程碑事件            │  │  ║
║   │   │      │                                                         │  │  ║
║   │   │      └────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴───   │  │  ║
║   │   │       D1   D5   D10  D15  D20  D25  D30  D35  D40  D45  D50   │  │  ║
║   │   │                                                                │  │  ║
║   │   │   OHLC 定义:                                                   │  │  ║
║   │   │   • Open  = 当日首次状态分数                                   │  │  ║
║   │   │   • High  = 当日最高状态分数                                   │  │  ║
║   │   │   • Low   = 当日最低状态分数                                   │  │  ║
║   │   │   • Close = 当日最后状态分数                                   │  │  ║
║   │   │   • Volume = 当日活动次数 (打卡 + 完成任务 + 对话)             │  │  ║
║   │   └────────────────────────────────────────────────────────────────┘  │  ║
║   └──────────────────────────────────────────────────────────────────────┘  ║
║                                                                              ║
║   ┌──────────────────────────────────────────────────────────────────────┐  ║
║   │                       里程碑系统 (Milestone Tracker)                  │  ║
║   │                                                                        │  ║
║   │   ┌────────────────────────────────────────────────────────────────┐  │  ║
║   │   │                                                                │  │  ║
║   │   │   ✓ 完成首次命盘解读                        Day 1    🏆        │  │  ║
║   │   │   ✓ 接受首个行动承诺                        Day 1    🏆        │  │  ║
║   │   │   ✓ 连续打卡 7 天                           Day 8    🏆🏆       │  │  ║
║   │   │   ✓ 完成首次周复盘                          Day 7    🏆        │  │  ║
║   │   │   ○ 达成首个 21 天习惯                      Day 21   🏆🏆🏆     │  │  ║
║   │   │   ○ 改命指数突破 80                         ---      🏆🏆🏆🏆    │  │  ║
║   │   │   ○ 完成 90 天蜕变周期                      Day 90   🏆🏆🏆🏆🏆  │  │  ║
║   │   │                                                                │  │  ║
║   │   │   已解锁: 4/7     当前进度: ████████░░░░░░ 57%                 │  │  ║
║   │   └────────────────────────────────────────────────────────────────┘  │  ║
║   └──────────────────────────────────────────────────────────────────────┘  ║
║                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

## 5.4 SOCIAL 社交引擎

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                          👥 SOCIAL ENGINE                                      ║
║                          社交引擎 - 隐私社交中心                                ║
╠══════════════════════════════════════════════════════════════════════════════╣
║                                                                              ║
║   ┌──────────────────────────────────────────────────────────────────────┐  ║
║   │                       能量加油站 (Energy Boost)                       │  ║
║   │                                                                        │  ║
║   │   好友向你发送能量加油:                                                │  ║
║   │                                                                        │  ║
║   │   ┌────────────────────────────────────────────────────────────────┐  │  ║
║   │   │  👤 小明                                                       │  │  ║
║   │   │  ─────────────────────────────────────────────────────────     │  │  ║
║   │   │  "加油！我知道你最近压力很大，但你一定能扛过去！"                │  │  ║
║   │   │                                                                │  │  ║
║   │   │  ⚡ +10 能量值                               [回复加油]         │  │  ║
║   │   └────────────────────────────────────────────────────────────────┘  │  ║
║   │                                                                        │  ║
║   │   你今日收到: 3 次加油  |  本周累计: 15 次  |  排行榜: TOP 20%        │  ║
║   └──────────────────────────────────────────────────────────────────────┘  ║
║                                                                              ║
║   ┌──────────────────────────────────────────────────────────────────────┐  ║
║   │                       好运接龙 (Luck Chain)                           │  ║
║   │                                                                        │  ║
║   │   ┌────────────────────────────────────────────────────────────────┐  │  ║
║   │   │                    🍀 今日接龙主题                              │  │  ║
║   │   │                                                                │  │  ║
║   │   │           "说出你今天最感恩的一件事"                            │  │  ║
║   │   │                                                                │  │  ║
║   │   │   ╭────────────────────────────────────────────────────────╮  │  │  ║
║   │   │   │ 👤 用户A: 感恩今天地铁没挤，心情很好                    │  │  │  ║
║   │   │   │    ↓                                                   │  │  │  ║
║   │   │   │ 👤 用户B: 感恩同事帮我解决了一个大 bug                  │  │  │  ║
║   │   │   │    ↓                                                   │  │  │  ║
║   │   │   │ 👤 用户C: 感恩妈妈做的红烧肉太好吃了                    │  │  │  ║
║   │   │   │    ↓                                                   │  │  │  ║
║   │   │   │ 👤 你: [输入你的感恩...]                                │  │  │  ║
║   │   │   ╰────────────────────────────────────────────────────────╯  │  │  ║
║   │   │                                                                │  │  ║
║   │   │   参与人数: 128人  |  链长: 64  |  你的接龙加成: +5 运气值    │  │  ║
║   │   └────────────────────────────────────────────────────────────────┘  │  ║
║   └──────────────────────────────────────────────────────────────────────┘  ║
║                                                                              ║
║   ┌──────────────────────────────────────────────────────────────────────┐  ║
║   │                       命盘海报 (Poster Generator)                     │  ║
║   │                                                                        │  ║
║   │   ┌────────────────────────────────────────────────────────────────┐  │  ║
║   │   │                                                                │  │  ║
║   │   │   ╔════════════════════════════════════════════════════════╗  │  │  ║
║   │   │   ║                                                        ║  │  │  ║
║   │   │   ║                  ┌───────────────┐                     ║  │  │  ║
║   │   │   ║                  │   ♠ 甲木      │                     ║  │  │  ║
║   │   │   ║                  │   身旺        │                     ║  │  │  ║
║   │   │   ║                  └───────────────┘                     ║  │  │  ║
║   │   │   ║                                                        ║  │  │  ║
║   │   │   ║    "我就是那个想太多的甲木，                           ║  │  │  ║
║   │   │   ║     明明可以躺平却偏要内耗。"                          ║  │  │  ║
║   │   │   ║                                                        ║  │  │  ║
║   │   │   ║    改命指数: 72 ↑ (+8)                                 ║  │  │  ║
║   │   │   ║    连续打卡: 15 天 🔥                                  ║  │  │  ║
║   │   │   ║                                                        ║  │  │  ║
║   │   │   ║              扫码解锁你的命盘                          ║  │  │  ║
║   │   │   ║                 [二维码]                               ║  │  │  ║
║   │   │   ║                                                        ║  │  │  ║
║   │   │   ╚════════════════════════════════════════════════════════╝  │  │  ║
║   │   │                                                                │  │  ║
║   │   │   海报类型: [人格海报] [情绪海报] [成就海报] [求助海报]        │  │  ║
║   │   │                                                                │  │  ║
║   │   │   [下载到相册]  [分享到朋友圈]  [生成新海报]                   │  │  ║
║   │   └────────────────────────────────────────────────────────────────┘  │  ║
║   └──────────────────────────────────────────────────────────────────────┘  ║
║                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

---

# 第六章：前端交互设计

## 6.1 信息架构

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          MENTIS 信息架构                                          │
└─────────────────────────────────────────────────────────────────────────────────┘

                         ┌────────────────────────────┐
                         │         / (Landing)        │
                         │     Digital Mirror 首页    │
                         └─────────────┬──────────────┘
                                       │
              ┌────────────────────────┼────────────────────────┐
              │                        │                        │
              ▼                        ▼                        ▼
     ┌────────────────┐      ┌────────────────┐      ┌────────────────┐
     │  /app (主应用)  │      │ /report (报告) │      │ /admin (管理)  │
     │   登录后主界面  │      │   深度报告     │      │   后台管理     │
     └────────┬───────┘      └────────────────┘      └────────────────┘
              │
     ┌────────┴───────────────────────────────────────────┐
     │                                                    │
     │  ╔════════════════════════════════════════════╗   │
     │  ║            双栏布局 (主应用)                 ║   │
     │  ╠════════════════════════════════════════════╣   │
     │  ║                                            ║   │
     │  ║  ┌─────────────┐    ┌─────────────────┐   ║   │
     │  ║  │   Zone A    │    │     Zone B      │   ║   │
     │  ║  │  对话区域   │    │   Dashboard     │   ║   │
     │  ║  │             │    │                 │   ║   │
     │  ║  │ • AI 对话   │    │ Tab: 总览      │   ║   │
     │  ║  │ • 流式响应  │    │ Tab: 行动      │   ║   │
     │  ║  │ • 承诺卡片  │    │ Tab: K线       │   ║   │
     │  ║  │ • 快捷指令  │    │ Tab: 社交      │   ║   │
     │  ║  │             │    │ Tab: 设置      │   ║   │
     │  ║  │             │    │                 │   ║   │
     │  ║  └─────────────┘    └─────────────────┘   ║   │
     │  ║                                            ║   │
     │  ║  (移动端: Zone A/B 切换显示)               ║   │
     │  ╚════════════════════════════════════════════╝   │
     │                                                    │
     └────────────────────────────────────────────────────┘
```

## 6.2 核心界面布局

```
╔══════════════════════════════════════════════════════════════════════════════════════════╗
║                              MENTIS 主应用布局 (Desktop)                                   ║
╠══════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                          ║
║  ┌─────────────────────────────────────────────────────────────────────────────────────┐║
║  │  🔮 MENTIS                              改命指数: 72 ↑     👤 设置  ⚙️               │║
║  └─────────────────────────────────────────────────────────────────────────────────────┘║
║                                                                                          ║
║  ┌──────────────────────────────────┐  ┌────────────────────────────────────────────────┐║
║  │                                  │  │  [总览] [行动] [K线] [社交] [设置]              │║
║  │         ZONE A: 对话区域          │  │────────────────────────────────────────────────│║
║  │                                  │  │                                                │║
║  │  ┌─────────────────────────────┐ │  │  ┌──────────────────────────────────────────┐ │║
║  │  │ 🤖 Mentis                   │ │  │  │            今日指引 🌟                    │ │║
║  │  │                             │ │  │  │                                          │ │║
║  │  │ 根据你的甲木身旺格局，今天  │ │  │  │  "今日宜静不宜动，适合思考与规划"       │ │║
║  │  │ 适合做规划类的事情...       │ │  │  │                                          │ │║
║  │  │                             │ │  │  │  幸运色: 🟢 绿色   方位: 东方            │ │║
║  │  │ **行动处方:**               │ │  │  └──────────────────────────────────────────┘ │║
║  │  │ 1. 用决策模板梳理选项       │ │  │                                                │║
║  │  │ 2. 找一位信任的人倾诉       │ │  │  ┌──────────────────────────────────────────┐ │║
║  │  │                             │ │  │  │            待完成任务 📋                  │ │║
║  │  │ 你愿意先做哪一个？          │ │  │  │                                          │ │║
║  │  │                             │ │  │  │  ☐ 完成决策模板 (今日到期)               │ │║
║  │  │ [接受任务1] [接受任务2]     │ │  │  │  ☐ 15分钟冥想 (习惯养成第8天)            │ │║
║  │  └─────────────────────────────┘ │  │  │  ✓ 晨间复盘 (已完成)                     │ │║
║  │                                  │  │  └──────────────────────────────────────────┘ │║
║  │  ┌─────────────────────────────┐ │  │                                                │║
║  │  │ 👤 你                       │ │  │  ┌──────────────────────────────────────────┐ │║
║  │  │                             │ │  │  │            改命指数趋势 📈                │ │║
║  │  │ 我最近很焦虑，工作要不要换？│ │  │  │                                          │ │║
║  │  └─────────────────────────────┘ │  │  │   80┤            ╭───╮                    │ │║
║  │                                  │  │  │   70┤      ╭───╮─╯   ╰─ ← 今天            │ │║
║  │                                  │  │  │   60┤╭───╮─╯                              │ │║
║  │                                  │  │  │   50┤╯                                    │ │║
║  │                                  │  │  │     └──┴──┴──┴──┴──┴──┴──┴──             │ │║
║  │                                  │  │  │      D1 D7 D14 D21 D28 D35               │ │║
║  │                                  │  │  └──────────────────────────────────────────┘ │║
║  │                                  │  │                                                │║
║  │  ┌─────────────────────────────┐ │  │  ┌──────────────────────────────────────────┐ │║
║  │  │ 💬 输入你的问题...          │ │  │  │            快速操作 ⚡                    │ │║
║  │  │                     [发送]  │ │  │  │                                          │ │║
║  │  └─────────────────────────────┘ │  │  │  [情绪打卡] [生成海报] [邀请好友]         │ │║
║  │                                  │  │  └──────────────────────────────────────────┘ │║
║  │  快捷指令: /解读 /处方 /复盘    │  │                                                │║
║  └──────────────────────────────────┘  └────────────────────────────────────────────────┘║
║                                                                                          ║
╚══════════════════════════════════════════════════════════════════════════════════════════╝
```

## 6.3 移动端适配

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          MENTIS 移动端布局                                        │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────────┐          ┌─────────────────┐          ┌─────────────────┐
    │                 │          │                 │          │                 │
    │   对话模式      │          │   仪表盘模式    │          │   K线模式       │
    │   (Zone A)      │          │   (Zone B)      │          │   (Zone B)      │
    │                 │          │                 │          │                 │
    │ ┌─────────────┐ │          │ ┌─────────────┐ │          │ ┌─────────────┐ │
    │ │ 🔮 Mentis   │ │          │ │ 改命指数:72 │ │          │ │  人生K线    │ │
    │ └─────────────┘ │          │ │ ████████░░  │ │          │ │             │ │
    │                 │          │ └─────────────┘ │          │ │   ╭───╮     │ │
    │ ┌─────────────┐ │          │                 │          │ │ ╭─╯   ╰─╮  │ │
    │ │ AI 回复...  │ │          │ ┌─────────────┐ │          │ │╭╯       ╰─ │ │
    │ │             │ │          │ │ 今日任务    │ │          │ │            │ │
    │ │ 行动处方:   │ │          │ │ ☐ 任务1    │ │          │ │ 涨跌: +8%  │ │
    │ │ 1. xxx      │ │          │ │ ☐ 任务2    │ │          │ └─────────────┘ │
    │ │ 2. xxx      │ │          │ │ ✓ 任务3    │ │          │                 │
    │ │             │ │          │ └─────────────┘ │          │ ┌─────────────┐ │
    │ │ [接受]      │ │          │                 │          │ │ 事件标记    │ │
    │ └─────────────┘ │          │ ┌─────────────┐ │          │ │ ★ 里程碑   │ │
    │                 │          │ │ 趋势图      │ │          │ │ ○ 打卡     │ │
    │ ┌─────────────┐ │          │ │  ╭──╮      │ │          │ └─────────────┘ │
    │ │ 💬 输入...  │ │          │ │ ╭╯  ╰─    │ │          │                 │
    │ └─────────────┘ │          │ └─────────────┘ │          │                 │
    │                 │          │                 │          │                 │
    ├─────────────────┤          ├─────────────────┤          ├─────────────────┤
    │ [💬] [📊] [📈] │          │ [💬] [📊] [📈] │          │ [💬] [📊] [📈] │
    │  ▲              │          │       ▲         │          │            ▲    │
    └─────────────────┘          └─────────────────┘          └─────────────────┘

    底部 Tab 导航:
    • 💬 对话 - AI 教练对话界面
    • 📊 仪表盘 - 总览/任务/社交
    • 📈 K线 - 人生轨迹可视化
```

---

# 第七章：数据模型

## 7.1 核心数据表

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          MENTIS 数据模型                                          │
│                          PostgreSQL Schema                                        │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌───────────────────────────────────────────────────────────────────────────┐
    │                           L0: 用户基础层                                    │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  mentis_user                                                        │  │
    │  ├─────────────────────────────────────────────────────────────────────┤  │
    │  │  id           │ UUID PRIMARY KEY                                    │  │
    │  │  phone        │ VARCHAR(20) UNIQUE (国内主键)                       │  │
    │  │  email        │ VARCHAR(255) UNIQUE                                 │  │
    │  │  nickname     │ VARCHAR(50)                                         │  │
    │  │  avatar_url   │ TEXT                                                │  │
    │  │  birth_datetime│ TIMESTAMP (出生日期时间)                           │  │
    │  │  birth_place  │ JSONB (经纬度 + 城市)                               │  │
    │  │  gender       │ ENUM('male', 'female', 'other')                     │  │
    │  │  created_at   │ TIMESTAMP                                           │  │
    │  │  updated_at   │ TIMESTAMP                                           │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  mentis_user_preferences                                            │  │
    │  ├─────────────────────────────────────────────────────────────────────┤  │
    │  │  user_id      │ UUID REFERENCES mentis_user                         │  │
    │  │  persona_style│ ENUM('standard', 'warm', 'roast')                   │  │
    │  │  push_enabled │ BOOLEAN DEFAULT true                                │  │
    │  │  push_time    │ TIME DEFAULT '08:00'                                │  │
    │  │  quiet_start  │ TIME DEFAULT '22:00'                                │  │
    │  │  quiet_end    │ TIME DEFAULT '07:00'                                │  │
    │  │  language     │ VARCHAR(10) DEFAULT 'zh-CN'                         │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    └───────────────────────────────────────────────────────────────────────────┘

    ┌───────────────────────────────────────────────────────────────────────────┐
    │                           L1: 领域数据层                                    │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  mentis_bazi_snapshot (八字快照)                                    │  │
    │  ├─────────────────────────────────────────────────────────────────────┤  │
    │  │  id             │ UUID PRIMARY KEY                                  │  │
    │  │  user_id        │ UUID REFERENCES mentis_user                       │  │
    │  │  pillars        │ JSONB (四柱: 年/月/日/时)                          │  │
    │  │  daymaster      │ VARCHAR(10) (日主)                                │  │
    │  │  dm_strength    │ ENUM('strong', 'weak', 'neutral')                 │  │
    │  │  pattern        │ VARCHAR(50) (格局)                                │  │
    │  │  ten_gods       │ JSONB (十神分布)                                  │  │
    │  │  spirit_stars   │ JSONB (神煞)                                      │  │
    │  │  favorable      │ JSONB (喜用神)                                    │  │
    │  │  current_luck   │ JSONB (当前大运)                                  │  │
    │  │  facts_hash     │ VARCHAR(64) (计算哈希，用于缓存)                  │  │
    │  │  created_at     │ TIMESTAMP                                         │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  mentis_perma_score (PERMA 幸福指数)                                │  │
    │  ├─────────────────────────────────────────────────────────────────────┤  │
    │  │  id           │ UUID PRIMARY KEY                                    │  │
    │  │  user_id      │ UUID REFERENCES mentis_user                         │  │
    │  │  score_date   │ DATE                                                │  │
    │  │  positive     │ DECIMAL(3,2) (积极情绪 0-1)                         │  │
    │  │  engagement   │ DECIMAL(3,2) (投入度 0-1)                           │  │
    │  │  relationships│ DECIMAL(3,2) (人际关系 0-1)                         │  │
    │  │  meaning      │ DECIMAL(3,2) (意义感 0-1)                           │  │
    │  │  accomplishment│DECIMAL(3,2) (成就感 0-1)                           │  │
    │  │  total_score  │ DECIMAL(5,2) (综合分 0-100)                         │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  mentis_kline_daily (人生K线)                                       │  │
    │  ├─────────────────────────────────────────────────────────────────────┤  │
    │  │  id           │ UUID PRIMARY KEY                                    │  │
    │  │  user_id      │ UUID REFERENCES mentis_user                         │  │
    │  │  kline_date   │ DATE                                                │  │
    │  │  open         │ INTEGER (当日开盘分 0-100)                          │  │
    │  │  high         │ INTEGER (当日最高分 0-100)                          │  │
    │  │  low          │ INTEGER (当日最低分 0-100)                          │  │
    │  │  close        │ INTEGER (当日收盘分 0-100)                          │  │
    │  │  volume       │ INTEGER (活动量)                                    │  │
    │  │  change_pct   │ DECIMAL(5,2) (涨跌幅%)                              │  │
    │  │  drivers      │ JSONB (驱动因素)                                    │  │
    │  │  events       │ JSONB (事件标记)                                    │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  mentis_commitment (承诺/任务)                                      │  │
    │  ├─────────────────────────────────────────────────────────────────────┤  │
    │  │  id           │ UUID PRIMARY KEY                                    │  │
    │  │  user_id      │ UUID REFERENCES mentis_user                         │  │
    │  │  session_id   │ UUID (来源对话)                                     │  │
    │  │  title        │ TEXT                                                │  │
    │  │  description  │ TEXT                                                │  │
    │  │  if_then      │ TEXT (If-Then 执行计划)                             │  │
    │  │  status       │ ENUM('suggested', 'active', 'done', 'skipped')      │  │
    │  │  due_at       │ TIMESTAMP                                           │  │
    │  │  accepted_at  │ TIMESTAMP                                           │  │
    │  │  done_at      │ TIMESTAMP                                           │  │
    │  │  done_note    │ TEXT                                                │  │
    │  │  created_at   │ TIMESTAMP                                           │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  mentis_checkin (打卡记录)                                          │  │
    │  ├─────────────────────────────────────────────────────────────────────┤  │
    │  │  id           │ UUID PRIMARY KEY                                    │  │
    │  │  user_id      │ UUID REFERENCES mentis_user                         │  │
    │  │  checkin_type │ ENUM('mood', 'habit', 'milestone')                  │  │
    │  │  mood         │ VARCHAR(20) (情绪标签)                              │  │
    │  │  intensity    │ INTEGER (1-10)                                      │  │
    │  │  note         │ TEXT                                                │  │
    │  │  created_at   │ TIMESTAMP                                           │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    └───────────────────────────────────────────────────────────────────────────┘

    ┌───────────────────────────────────────────────────────────────────────────┐
    │                           对话与社交层                                      │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  mentis_conversation_session (对话会话)                             │  │
    │  ├─────────────────────────────────────────────────────────────────────┤  │
    │  │  id           │ UUID PRIMARY KEY                                    │  │
    │  │  user_id      │ UUID REFERENCES mentis_user                         │  │
    │  │  title        │ TEXT (自动摘要)                                     │  │
    │  │  mode         │ ENUM('chat', 'command')                             │  │
    │  │  created_at   │ TIMESTAMP                                           │  │
    │  │  updated_at   │ TIMESTAMP                                           │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  mentis_conversation_message (对话消息)                             │  │
    │  ├─────────────────────────────────────────────────────────────────────┤  │
    │  │  id           │ UUID PRIMARY KEY                                    │  │
    │  │  session_id   │ UUID REFERENCES mentis_conversation_session         │  │
    │  │  role         │ ENUM('user', 'assistant', 'system')                 │  │
    │  │  content      │ TEXT                                                │  │
    │  │  a2ui         │ JSONB (结构化输出)                                  │  │
    │  │  tool_calls   │ JSONB (技能调用记录)                                │  │
    │  │  created_at   │ TIMESTAMP                                           │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  mentis_social_relation (社交关系)                                  │  │
    │  ├─────────────────────────────────────────────────────────────────────┤  │
    │  │  id           │ UUID PRIMARY KEY                                    │  │
    │  │  user_id      │ UUID REFERENCES mentis_user (发起方)                │  │
    │  │  friend_id    │ UUID REFERENCES mentis_user (接收方)                │  │
    │  │  status       │ ENUM('pending', 'accepted', 'blocked')              │  │
    │  │  created_at   │ TIMESTAMP                                           │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  mentis_energy_boost (能量加油)                                     │  │
    │  ├─────────────────────────────────────────────────────────────────────┤  │
    │  │  id           │ UUID PRIMARY KEY                                    │  │
    │  │  sender_id    │ UUID REFERENCES mentis_user                         │  │
    │  │  receiver_id  │ UUID REFERENCES mentis_user                         │  │
    │  │  message      │ TEXT                                                │  │
    │  │  energy_value │ INTEGER DEFAULT 10                                  │  │
    │  │  created_at   │ TIMESTAMP                                           │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    └───────────────────────────────────────────────────────────────────────────┘
```

## 7.2 数据关系图

```
                          ┌─────────────────────────────┐
                          │       mentis_user           │
                          │         (核心)              │
                          └─────────────┬───────────────┘
                                        │
            ┌───────────────────────────┼───────────────────────────┐
            │                           │                           │
            ▼                           ▼                           ▼
    ┌───────────────┐          ┌───────────────┐          ┌───────────────┐
    │ L0 基础数据   │          │ L1 领域数据   │          │ 交互数据      │
    ├───────────────┤          ├───────────────┤          ├───────────────┤
    │ preferences   │          │ bazi_snapshot │          │ conv_session  │
    │               │          │ perma_score   │          │ conv_message  │
    │               │          │ kline_daily   │          │ checkin       │
    │               │          │ commitment    │          │ milestone     │
    └───────────────┘          └───────────────┘          └───────────────┘
                                                                  │
                                                                  ▼
                                                          ┌───────────────┐
                                                          │ 社交数据      │
                                                          ├───────────────┤
                                                          │ social_relation│
                                                          │ energy_boost  │
                                                          │ luck_chain    │
                                                          │ poster        │
                                                          └───────────────┘
```

---

# 第八章：API 设计

## 8.1 API 总览

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          MENTIS API 架构                                          │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌───────────────────────────────────────────────────────────────────────────┐
    │                           公开 API (需登录)                                 │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  /api/chat                                                          │  │
    │  │  POST /api/chat           → 发送消息 (流式响应)                      │  │
    │  │  POST /api/chat/command   → 执行指令 (/解读 /处方 /复盘)            │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  /api/decode                                                        │  │
    │  │  POST /api/decode/bazi    → 八字计算                                 │  │
    │  │  POST /api/decode/ziwei   → 紫微斗数                                 │  │
    │  │  GET  /api/decode/snapshot → 获取命盘快照                            │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  /api/measure                                                       │  │
    │  │  GET  /api/measure/index   → 获取改命指数                            │  │
    │  │  GET  /api/measure/kline   → 获取K线数据                             │  │
    │  │  GET  /api/measure/milestones → 获取里程碑                           │  │
    │  │  POST /api/measure/checkin → 打卡记录                                │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  /api/commitment                                                    │  │
    │  │  GET  /api/commitment/list → 获取任务列表                            │  │
    │  │  POST /api/commitment/accept → 接受任务                              │  │
    │  │  POST /api/commitment/done → 完成任务                                │  │
    │  │  POST /api/commitment/skip → 跳过任务                                │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  /api/social                                                        │  │
    │  │  GET  /api/social/friends  → 好友列表                                │  │
    │  │  POST /api/social/boost    → 发送能量加油                            │  │
    │  │  GET  /api/social/chain    → 获取今日接龙                            │  │
    │  │  POST /api/social/chain    → 参与接龙                                │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  /api/poster                                                        │  │
    │  │  POST /api/poster/generate → 生成海报                                │  │
    │  │  GET  /api/poster/{id}     → 获取海报状态/URL                        │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  /api/report                                                        │  │
    │  │  POST /api/report/submit   → 提交深度报告请求                        │  │
    │  │  GET  /api/report/{id}     → 获取报告状态/内容                       │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    └───────────────────────────────────────────────────────────────────────────┘

    ┌───────────────────────────────────────────────────────────────────────────┐
    │                           Landing API (无需登录)                           │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  /api/landing                                                       │  │
    │  │  POST /api/landing/insight → 快速命盘洞察 (触发"共鸣时刻")          │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  /api/auth                                                          │  │
    │  │  POST /api/auth/register   → 注册 (设置 Cookie)                      │  │
    │  │  POST /api/auth/login      → 登录 (设置 Cookie)                      │  │
    │  │  POST /api/auth/logout     → 登出 (清除 Cookie)                      │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    └───────────────────────────────────────────────────────────────────────────┘

    ┌───────────────────────────────────────────────────────────────────────────┐
    │                           Internal API (仅服务间调用)                      │
    │                                                                           │
    │  ┌─────────────────────────────────────────────────────────────────────┐  │
    │  │  /internal                                                          │  │
    │  │  GET  /internal/context      → 聚合用户上下文 (L0+L1+History)        │  │
    │  │  POST /internal/chat/finalize → 事务提交对话结果                     │  │
    │  │  POST /internal/insight      → Insight Agent 反写                   │  │
    │  └─────────────────────────────────────────────────────────────────────┘  │
    └───────────────────────────────────────────────────────────────────────────┘
```

## 8.2 核心 API 详情

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          POST /api/chat (核心对话)                               │
└─────────────────────────────────────────────────────────────────────────────────┘

Request:
┌─────────────────────────────────────────────────────────────────────────────────┐
│ {                                                                               │
│   "session_id": "uuid",           // 可选，为空则创建新会话                      │
│   "message": "我最近很焦虑，工作要不要换？",                                     │
│   "mode": "chat"                  // chat | command                             │
│ }                                                                               │
└─────────────────────────────────────────────────────────────────────────────────┘

Response (Streaming):
┌─────────────────────────────────────────────────────────────────────────────────┐
│ // 使用 Vercel AI SDK 的 toDataStreamResponse()                                 │
│                                                                                 │
│ data: {"type":"text","content":"根据你的甲木身旺格局..."}                        │
│ data: {"type":"text","content":"你现在的焦虑主要来自..."}                        │
│ data: {"type":"tool_call","name":"habit_prescription","args":{...}}             │
│ data: {"type":"tool_result","result":{"habit_id":"xxx"}}                        │
│ data: {"type":"message_annotation","a2ui":{                                     │
│   "insight": "你现在的焦虑源于...",                                              │
│   "prescription": [...],                                                        │
│   "commitment_ask": "你愿意先做哪一个？",                                        │
│   "actions": [...]                                                              │
│ }}                                                                              │
│ data: [DONE]                                                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                          GET /api/measure/kline (K线数据)                        │
└─────────────────────────────────────────────────────────────────────────────────┘

Request:
┌─────────────────────────────────────────────────────────────────────────────────┐
│ GET /api/measure/kline?period=daily&count=30                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

Response:
┌─────────────────────────────────────────────────────────────────────────────────┐
│ {                                                                               │
│   "life_index": 72,                                                             │
│   "index_change": "+8",                                                         │
│   "klines": [                                                                   │
│     {                                                                           │
│       "date": "2026-01-03",                                                     │
│       "open": 68, "high": 78, "low": 62, "close": 72,                           │
│       "volume": 5,                                                              │
│       "change_pct": "+5.9%",                                                    │
│       "events": [                                                               │
│         {"type": "milestone", "label": "连续打卡7天"}                           │
│       ]                                                                         │
│     },                                                                          │
│     ...                                                                         │
│   ]                                                                             │
│ }                                                                               │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

# 第九章：实施路线图

## 9.1 MVP 阶段划分

```
╔══════════════════════════════════════════════════════════════════════════════════════════╗
║                              MENTIS 实施路线图                                            ║
╠══════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                          ║
║   Phase 1: Foundation (4周)                                                             ║
║   ═══════════════════════════════════════════════════════════════════════════════════   ║
║                                                                                          ║
║   Week 1-2: 核心基础                                                                    ║
║   ┌─────────────────────────────────────────────────────────────────────────────────┐  ║
║   │ □ PostgreSQL Schema 迁移 (mentis_* 表)                                          │  ║
║   │ □ 认证系统 (Cookie Session + CSRF)                                              │  ║
║   │ □ 八字计算引擎 (BaziEngine)                                                     │  ║
║   │ □ 基础 API 框架 (FastAPI + Next.js API Route)                                   │  ║
║   └─────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                          ║
║   Week 3-4: 核心对话                                                                    ║
║   ┌─────────────────────────────────────────────────────────────────────────────────┐  ║
║   │ □ Vercel AI SDK 集成 (streamText + tool)                                        │  ║
║   │ □ Context Assembly (L0 + L1 聚合)                                               │  ║
║   │ □ A2UI 输出格式 (结构化响应)                                                    │  ║
║   │ □ 前端双栏布局 (Zone A 对话 + Zone B Dashboard)                                 │  ║
║   └─────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                          ║
║   Phase 2: Core Loop (4周)                                                              ║
║   ═══════════════════════════════════════════════════════════════════════════════════   ║
║                                                                                          ║
║   Week 5-6: 改命闭环                                                                    ║
║   ┌─────────────────────────────────────────────────────────────────────────────────┐  ║
║   │ □ 承诺系统 (Commitment State Machine)                                           │  ║
║   │ □ 打卡系统 (Checkin + PERMA)                                                    │  ║
║   │ □ K线计算与可视化                                                               │  ║
║   │ □ 改命指数算法                                                                  │  ║
║   └─────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                          ║
║   Week 7-8: 增值功能                                                                    ║
║   ┌─────────────────────────────────────────────────────────────────────────────────┐  ║
║   │ □ 深度报告生成                                                                  │  ║
║   │ □ 海报生成 (GLM 文案 + Gemini 图片)                                             │  ║
║   │ □ 社交功能 (能量加油 + 好运接龙)                                                │  ║
║   │ □ Push 通知系统                                                                 │  ║
║   └─────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                          ║
║   Phase 3: Growth (4周)                                                                 ║
║   ═══════════════════════════════════════════════════════════════════════════════════   ║
║                                                                                          ║
║   Week 9-10: Landing & 转化                                                             ║
║   ┌─────────────────────────────────────────────────────────────────────────────────┐  ║
║   │ □ Digital Mirror Landing Page                                                   │  ║
║   │ □ 快速洞察 API (/api/landing/insight)                                           │  ║
║   │ □ 注册转化漏斗                                                                  │  ║
║   │ □ 病毒分享机制                                                                  │  ║
║   └─────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                          ║
║   Week 11-12: 付费 & 运营                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────────────┐  ║
║   │ □ 订阅系统 (Free / Basic / PRO)                                                 │  ║
║   │ □ 支付集成 (微信支付 / 支付宝)                                                  │  ║
║   │ □ Admin 后台 (数据监控 + Prompt 管理)                                           │  ║
║   │ □ 数据埋点 & 指标看板                                                           │  ║
║   └─────────────────────────────────────────────────────────────────────────────────┘  ║
║                                                                                          ║
╚══════════════════════════════════════════════════════════════════════════════════════════╝
```

## 9.2 关键里程碑

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          关键里程碑                                               │
└─────────────────────────────────────────────────────────────────────────────────┘

    Week 0                Week 4                Week 8               Week 12
      │                     │                     │                     │
      ▼                     ▼                     ▼                     ▼
    ┌───┐                 ┌───┐                 ┌───┐                 ┌───┐
    │ ★ │                 │ ★ │                 │ ★ │                 │ ★ │
    └───┘                 └───┘                 └───┘                 └───┘
      │                     │                     │                     │
      │                     │                     │                     │
   项目启动            Alpha 版本            Beta 版本            正式上线
                          │                     │                     │
                          │                     │                     │
                    • 八字解读可用         • 完整闭环           • 付费系统
                    • AI 对话可用          • K线可视化          • Landing Page
                    • 基础 Dashboard        • 社交功能          • 增长引擎

    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │   Alpha 验收标准:                                                        │
    │   • 用户可注册登录                                                       │
    │   • 可输入出生信息获取八字解读                                           │
    │   • 可与 AI 对话获得建议                                                 │
    │   • 可在 Dashboard 查看基础信息                                          │
    │                                                                         │
    │   Beta 验收标准:                                                         │
    │   • 可接受 AI 处方并完成任务                                             │
    │   • 可查看改命指数和 K线                                                 │
    │   • 可生成和分享海报                                                     │
    │   • 可与好友互动 (能量加油)                                              │
    │                                                                         │
    │   正式上线验收标准:                                                      │
    │   • Landing Page 完成且转化率 >5%                                        │
    │   • 付费功能正常 (订阅 + 报告)                                           │
    │   • 7日留存率 >30%                                                       │
    │   • WCG 闭环率 >20% (每周至少1次完整闭环)                                │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘
```

---

# 第十章：成功指标

## 10.1 核心指标体系

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                          MENTIS 指标体系                                       ║
╠══════════════════════════════════════════════════════════════════════════════╣
║                                                                              ║
║   ┌──────────────────────────────────────────────────────────────────────┐  ║
║   │                       北极星指标 (North Star)                         │  ║
║   │                                                                       │  ║
║   │              "每周完成至少1次 WCG 闭环的用户数"                        │  ║
║   │                                                                       │  ║
║   │   WCG = Wisdom → Commitment → Growth                                  │  ║
║   │   (洞察 → 承诺 → 成长)                                                │  ║
║   │                                                                       │  ║
║   │   完整闭环 = 获得洞察 → 接受任务 → 完成打卡 → 看到改变                │  ║
║   └──────────────────────────────────────────────────────────────────────┘  ║
║                                                                              ║
║   ┌──────────────────────────────────────────────────────────────────────┐  ║
║   │                       增长指标 (Growth Metrics)                       │  ║
║   │                                                                       │  ║
║   │   ┌────────────────┐   ┌────────────────┐   ┌────────────────┐       │  ║
║   │   │  获客 (Acq.)   │   │  激活 (Act.)   │   │  留存 (Ret.)   │       │  ║
║   │   ├────────────────┤   ├────────────────┤   ├────────────────┤       │  ║
║   │   │ • DAU/MAU      │   │ • 注册转化率   │   │ • D1 留存      │       │  ║
║   │   │ • 新增注册     │   │ • 首次解读率   │   │ • D7 留存      │       │  ║
║   │   │ • 邀请转化     │   │ • 首次对话率   │   │ • D30 留存     │       │  ║
║   │   │ • CAC          │   │ • 承诺接受率   │   │ • 月活跃天数   │       │  ║
║   │   └────────────────┘   └────────────────┘   └────────────────┘       │  ║
║   │                                                                       │  ║
║   │   ┌────────────────┐   ┌────────────────┐   ┌────────────────┐       │  ║
║   │   │  变现 (Rev.)   │   │  推荐 (Ref.)   │   │  参与 (Eng.)   │       │  ║
║   │   ├────────────────┤   ├────────────────┤   ├────────────────┤       │  ║
║   │   │ • 付费转化率   │   │ • K-Factor     │   │ • 日均对话数   │       │  ║
║   │   │ • ARPU/ARPPU   │   │ • 海报分享率   │   │ • 打卡完成率   │       │  ║
║   │   │ • LTV          │   │ • 邀请成功率   │   │ • 任务完成率   │       │  ║
║   │   │ • 续费率       │   │ • NPS          │   │ • WCG 闭环率   │       │  ║
║   │   └────────────────┘   └────────────────┘   └────────────────┘       │  ║
║   └──────────────────────────────────────────────────────────────────────┘  ║
║                                                                              ║
║   ┌──────────────────────────────────────────────────────────────────────┐  ║
║   │                       产品健康指标 (Health)                           │  ║
║   │                                                                       │  ║
║   │   ┌────────────────────────────────────────────────────────────────┐ │  ║
║   │   │  改命指数分布                                                   │ │  ║
║   │   │                                                                 │ │  ║
║   │   │   • 平均改命指数: 65 → 目标 75                                  │ │  ║
║   │   │   • 指数提升用户占比: 60% → 目标 80%                            │ │  ║
║   │   │   • 90天后平均提升: +15 → 目标 +25                              │ │  ║
║   │   └────────────────────────────────────────────────────────────────┘ │  ║
║   │                                                                       │  ║
║   │   ┌────────────────────────────────────────────────────────────────┐ │  ║
║   │   │  技术健康度                                                     │ │  ║
║   │   │                                                                 │ │  ║
║   │   │   • API P95 延迟: <500ms                                        │ │  ║
║   │   │   • 对话首 Token 时间: <1s                                      │ │  ║
║   │   │   • 系统可用性: >99.5%                                          │ │  ║
║   │   │   • 错误率: <1%                                                 │ │  ║
║   │   └────────────────────────────────────────────────────────────────┘ │  ║
║   └──────────────────────────────────────────────────────────────────────┘  ║
║                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

## 10.2 阶段目标

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          阶段目标设定                                            │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌───────────────────────────────────────────────────────────────────────────┐
    │                         Month 1-3: 验证期                                  │
    ├───────────────────────────────────────────────────────────────────────────┤
    │                                                                           │
    │   核心目标: 验证产品-市场匹配 (PMF)                                        │
    │                                                                           │
    │   ┌─────────────────────────────────────────────────────────────────────┐│
    │   │  指标                        目标值           验证方法              ││
    │   ├─────────────────────────────────────────────────────────────────────┤│
    │   │  种子用户数                  500              邀请制                ││
    │   │  D7 留存率                   >30%             队列分析              ││
    │   │  WCG 闭环率                  >20%             漏斗分析              ││
    │   │  NPS (净推荐值)              >40              问卷调查              ││
    │   │  用户主动分享率              >10%             行为埋点              ││
    │   └─────────────────────────────────────────────────────────────────────┘│
    │                                                                           │
    └───────────────────────────────────────────────────────────────────────────┘

    ┌───────────────────────────────────────────────────────────────────────────┐
    │                         Month 4-6: 增长期                                  │
    ├───────────────────────────────────────────────────────────────────────────┤
    │                                                                           │
    │   核心目标: 建立增长引擎                                                   │
    │                                                                           │
    │   ┌─────────────────────────────────────────────────────────────────────┐│
    │   │  指标                        目标值           增长策略              ││
    │   ├─────────────────────────────────────────────────────────────────────┤│
    │   │  MAU                         10,000           内容营销 + 口碑       ││
    │   │  注册转化率                  >8%              Landing 优化          ││
    │   │  付费转化率                  >5%              价值展示 + 限时优惠   ││
    │   │  K-Factor                    >0.5             海报分享 + 邀请奖励   ││
    │   │  D30 留存率                  >20%             习惯养成机制          ││
    │   └─────────────────────────────────────────────────────────────────────┘│
    │                                                                           │
    └───────────────────────────────────────────────────────────────────────────┘

    ┌───────────────────────────────────────────────────────────────────────────┐
    │                         Month 7-12: 规模期                                 │
    ├───────────────────────────────────────────────────────────────────────────┤
    │                                                                           │
    │   核心目标: 实现可持续盈利                                                 │
    │                                                                           │
    │   ┌─────────────────────────────────────────────────────────────────────┐│
    │   │  指标                        目标值           运营重点              ││
    │   ├─────────────────────────────────────────────────────────────────────┤│
    │   │  MAU                         50,000           规模化获客            ││
    │   │  MRR (月经常性收入)          ¥200,000         订阅 + 报告           ││
    │   │  ARPU                        >¥30             增值服务              ││
    │   │  LTV/CAC                     >3               优化获客成本          ││
    │   │  改命指数平均提升            +25              产品持续优化          ││
    │   └─────────────────────────────────────────────────────────────────────┘│
    │                                                                           │
    └───────────────────────────────────────────────────────────────────────────┘
```

---

# 附录

## A. 术语表

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          MENTIS 术语表                                           │
└─────────────────────────────────────────────────────────────────────────────────┘

    术语                      定义
    ════════════════════════════════════════════════════════════════════════════
    
    MENTIS                    产品名称，源自拉丁语 "mentis" (心智)
    
    改命指数 (LCI)            Life Change Index，综合衡量用户人生改变的指标
    
    人生K线                   用 OHLC 蜡烛图可视化用户每日状态变化
    
    WCG                       Wisdom → Commitment → Growth，核心闭环
    
    DECODE                    解码引擎，负责命盘分析
    
    REPROGRAM                 重编引擎，负责 AI 教练对话
    
    MEASURE                   量化引擎，负责数据追踪
    
    A2UI                      Agent to UI，AI 输出的结构化格式
    
    Hot Path                  同步路径，用户交互的实时响应
    
    Cold Path                 异步路径，后台洞察萃取和数据反写
    
    Skill                     可插拔能力模块，对应 Vercel AI SDK 的 tool
    
    Commitment                承诺/任务，用户接受的行动项
    
    L0 / L1 / L2              数据层次: 基础档案 / 领域数据 / 洞察沉淀
    
    Digital Mirror            Landing Page 的核心概念，屏幕是映照命运的镜子
```

## B. 与 Fortune AI 的差异

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          MENTIS vs Fortune AI 对比                               │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌────────────────────┬───────────────────────┬───────────────────────┐
    │  维度              │  Fortune AI (原)       │  MENTIS (新)          │
    ├────────────────────┼───────────────────────┼───────────────────────┤
    │  核心定位          │  人生导航/陪伴         │  AI 改命              │
    │                    │                       │  可量化的人生改变      │
    ├────────────────────┼───────────────────────┼───────────────────────┤
    │  价值主张          │  理解你、帮助你        │  解码→重编→量化→见证   │
    │                    │                       │  90天见证改变          │
    ├────────────────────┼───────────────────────┼───────────────────────┤
    │  核心指标          │  任务完成率            │  改命指数 + K线        │
    │                    │  PERMA 分数           │  WCG 闭环率            │
    ├────────────────────┼───────────────────────┼───────────────────────┤
    │  架构命名          │  Soul OS (L0-L3)       │  Mentis Core OS        │
    │                    │                       │  DECODE/REPROGRAM/     │
    │                    │                       │  MEASURE               │
    ├────────────────────┼───────────────────────┼───────────────────────┤
    │  商业模式          │  未明确                │  Freemium + 订阅 +     │
    │                    │                       │  报告 + 私域           │
    ├────────────────────┼───────────────────────┼───────────────────────┤
    │  增长策略          │  未明确                │  海报病毒传播 +        │
    │                    │                       │  共鸣时刻 + 口碑       │
    ├────────────────────┼───────────────────────┼───────────────────────┤
    │  技术栈            │  保持一致              │  保持一致              │
    │                    │  Vercel AI SDK        │  Vercel AI SDK         │
    │                    │  Next.js + FastAPI     │  Next.js + FastAPI     │
    └────────────────────┴───────────────────────┴───────────────────────┘
```

---

**文档版本**: v1.0 (Genesis Edition)
**更新日期**: 2026-01-03
**核心理念**: 命运不是预言，而是可编程的操作系统
**下一步**: 开始 Phase 1 实施