铁板神算自动化推演系统的架构设计与算法核心解析报告
执行摘要
铁板神算（Tieban Shensuan），作为中国古代术数中最为精密、最具封闭性的命理系统之一，其核心在于通过庞大的条文数据库（一万二千条文）与极高精度的生辰校准（考刻分）相结合，实现对个体命运轨迹的“离散化”精准描述。本报告旨在基于现有的学术考据与互联网公开的算法残卷 ，构建一套完整、可执行的铁板神算数字化系统架构。   

本系统设计的核心挑战在于将传统口诀（如《四柱天干取数诀》、《太玄配数诀》等）转化为确定性的计算机算法，并解决传统算盘运算中的“加减秘数”在现代软件逻辑中的映射问题。不同于子平八字侧重于五行生克的模拟量分析，铁板神算本质上是一个基于多变量哈希（Hashing）的索引检索系统。本报告将详细阐述如何通过太玄数理构建基础键值（Key），如何通过六亲考刻（Verification Loop）锁定唯一的生命参数，以及如何设计能够容纳一万二千条命运谶语的高效数据库结构。

系统架构被划分为四大核心模块：历法与参数标准化模块（Input Normalization）、数理核心运算引擎（The Numerological Core）、六亲考刻校验交互模块（Calibration Interface），以及大运流年推导模块（Lifecycle Projection）。本报告将以不少于一万五千字的篇幅，对每一模块的逻辑细节、数据结构与算法实现进行穷尽式的探讨。

第一章 系统理论基础与数据本体论
在着手编写代码之前，必须先建立对铁板神算“数据本体”的深刻理解。铁板神算并非单纯的占卜，而是一套基于宋代邵雍《皇极经世》宏观历史观微缩而成的个人命运全息模型。

1.1 皇极经世的时间分形逻辑
铁板神算的理论基石是邵雍的“元、会、运、世”时间体系 。在《皇极经世》中，时间并非线性的流逝，而是具有分形结构的循环。   

1 元 (Epoch) = 12 会 (Eras)

1 会 (Era) = 30 运 (Cycles)

1 运 (Cycle) = 12 世 (Generations)

1 世 (Generation) = 30 年 (Years)

在系统设计中，这种分形逻辑意味着每一个时间单位都可以通过特定的模运算（Modulo Operation）转换为另一个层级的参数。铁板神算将这种宏观宇宙的时间刻度（元会运世）全息投影到个人的微观生命周期（年、月、日、时）上。依据资料显示，铁板数序的运算逻辑遵循“卦值气”的原理，即不同的时间点对应不同的六十四卦气场 。   

算法启示： 系统必须包含一个历法转换引擎，该引擎不仅要处理公历（Gregorian）与农历（Lunar）的转换，还必须能够计算出出生时刻对应的“皇极卦气”。例如，某一年不仅是“甲子年”，在皇极体系中它可能对应“天风姤”卦的某一爻。这个“值年卦”或“值运卦”是后续计算条文数序的基础变量（Base Variable）。若忽略了这一层级的转换，直接使用干支纪年，将导致计算出的基数（Base Number）失去宇宙坐标的锚定。

1.2 一万二千条文的数据库结构分析
铁板神算的核心输出是条文。关于条文的总数，学术界与实务界存在“六千一百四十四”条（12×8×8×8）与“一万二千”条两种说法 。考虑到系统的完备性，本设计采用“一万二千条文”作为标准数据库容量。这些条文并非杂乱无章的诗句，而是高度结构化的数据记录。   

数据特征分析： 条文内容涵盖了六亲（父母、兄弟、配偶、子女）的生肖属性、个人的性格特征、流年的吉凶事件以及寿命的终结节点 。例如：   

验证类条文：“父命鼠母命马”（用于考刻分）。

定性类条文：“金木交战，骨肉刑伤”（描述五行关系）。

定量类条文：“三子送终”、“四十二岁官运亨通”（包含具体数字）。

数据库模式设计（Schema Design）： 为了支持高效的检索与动态的参数填入，我们不能简单地将条文存储为文本字符串。数据库表 Tieban_Verses 应设计如下：

字段名	数据类型	描述	索引策略
verse_id	INT	主键，范围 1000-13000	聚簇索引 (Clustered Index)
content_text	TEXT	条文原始文本	全文索引 (Full-Text)
category	ENUM	分类：六亲、流年、性格、寿元	辅助索引
verification_key	JSON	用于考刻的逻辑键，如 {"F": "Zi", "M": "Wu"}	GIN 索引 (用于快速匹配)
param_slots	TINYINT	参数占位符数量（0-2）	
tone_value	INT	
条文的音韵值（配合切音法） 

  
数据完整性约束： 资料提到“遇十虚不用” ，这意味着数据库中可能存在“空洞”（Holes）。例如，每隔十个数，或者尾数为0的ID可能不对应任何实际条文，或者作为跳转指令。系统层必须在数据摄入（Ingestion）阶段处理这些规则，确保算法生成的ID总能命中有效的记录，或者能够智能跳过无效ID。   

1.3 “数”与“卦”的互换机制
铁板神算的运算本质是“以数代卦，以卦腾数”。系统需要在**整数（Integer）与六十四卦（Hexagrams）**之间建立双向映射 。   

正向映射（计算）：干支 → 太玄数 → 求和 → 卦 → 运算 → 条文ID。

逆向映射（检索）：条文ID → 对应的卦象含义（用于解释条文背后的易理）。

资料  提及铁道人（Tie Dao Ren）对系统进行了大幅校订，引入了河洛数序和紫微斗数的部分逻辑。这意味着在系统设计中，我们不能仅仅依赖单一的公式，而需要构建一个多策略计算工厂（Calculation Strategy Factory），允许在不同的流派算法（如江南派 vs. 洛阳派 ）之间切换。   

第二章 核心算法模块设计：数理引擎
本章将详细拆解铁板神算中最核心的数学模型，包括太玄数的取值逻辑、干支配卦的具体映射表以及基础命数的合成公式。这些是系统能够“跑起来”的动力源。

2.1 太玄配数诀的标准化实现
不同于常规的河图（1-10）或洛书（1-9）数理，铁板神算采用的是《太玄经》的数序 。这是铁板神算区别于其他术数的指纹特征。   

太玄数常量表（System Constants）： 根据口诀“甲己子午九，乙庚丑未八，丙辛寅申七，丁壬卯酉六，戊癸辰戌五，巳亥单四数” ，我们在系统中定义一个不可变的哈希映射（Immutable HashMap）：   

TAIXUAN_MAP = { "甲": 9, "己": 9, "子": 9, "午": 9, "乙": 8, "庚": 8, "丑": 8, "未": 8, "丙": 7, "辛": 7, "寅": 7, "申": 7, "丁": 6, "壬": 6, "卯": 6, "酉": 6, "戊": 5, "癸": 5, "辰": 5, "戌": 5, "巳": 4, "亥": 4 }

深入解析： 这个数序呈现出一种递减的趋势（9 → 4），且缺乏1、2、3这三个生数（Generating Numbers）。这在系统设计中隐含了一个重要信息：铁板神算的基数（Base Number）往往较大。任何基于太玄数累加的计算，其结果的“底噪”都较高。例如，四柱八个字，即使全取最小值4，总和也是32。这解释了为什么有些秘诀提到“爻从三十起” ——因为在纯太玄数的加法体系下，很难产生小于32的结果，前30个条文可能是通过特殊减法或作为系统元数据存在的。   

2.2 干支配卦算法（Mapping Logic）
为了将时间参数转化为空间参数（卦象），系统必须实现“天干配卦”与“地支配卦”的逻辑转换 。   

天干配卦逻辑表：

壬、甲 → 乾卦 (Qian, 6)

癸、乙 → 坤卦 (Kun, 2)

庚 → 震卦 (Zhen, 3)

辛 → 巽卦 (Xun, 4)

己 → 离卦 (Li, 9)

戊 → 坎卦 (Kan, 1)

丙 → 艮卦 (Gen, 8)

丁 → 兑卦 (Dui, 7)

地支配卦逻辑表：

亥、子 → 坎宫 (Kan)

寅、卯 → 震宫 (Zhen)

巳、午 → 离门 (Li)

未、申 → 坤 (Kun - 注意：此处口诀有异，需校验)

修正：口诀  云“巳午离门未在坤”，但又云“申酉兑金”。这表明“未”归坤，“申”归兑。   

申、酉 → 兑金 (Dui)

戌、亥 → 乾 (Qian - 注意：口诀云“乾是戌”)

丑、寅 → 艮 (Gen - 口诀云“丑入艮宫”)

辰、巳 → 巽 (Xun - 口诀云“辰巽真”)

算法实现的冲突解决： 由于口诀中地支与卦的映射存在重叠（例如寅既在震又可能涉艮，亥既在坎又可能涉乾），系统必须引入加权逻辑。通常，铁板神算遵循“本气”原则。

Standardized Mapping Function:

Map_Branch(Zi) = Kan

Map_Branch(Chou) = Gen

Map_Branch(Yin) = Gen (Early) / Zhen (Late) -> System Default: Gen

Map_Branch(Mao) = Zhen

Map_Branch(Chen) = Xun

Map_Branch(Si) = Xun (Early) / Li (Late) -> System Default: Xun

Map_Branch(Wu) = Li

Map_Branch(Wei) = Kun

Map_Branch(Shen) = Kun (Early) / Dui (Late) -> System Default: Kun

Map_Branch(You) = Dui

Map_Branch(Xu) = Qian

Map_Branch(Hai) = Qian (Early) / Kan (Late) -> System Default: Qian

2.3 基础命数合成公式（The Base Equation）
系统如何得出一个具体的四位数（如 4520）来查阅条文？这涉及到“八卦加则例”  中的核心算法。   

加则例解析：

“爻从三十起”：基数偏移量（Offset） = 30。

“乾卦六为头”：若计算出的主卦为乾，则千位数为6，或加数为6000。

“兑为后少女”：兑卦对应数值7，可能作为尾数或特定加数。

“遇十当不用”：模10运算（Modulo 10）或剔除0值。

算法重构（Reconstructed Algorithm）： 设四柱的太玄数总和为 S，主卦数值为 G。

Base_Index=(G×1000)+(S×10)+Adjustment
其中，Adjustment 是最神秘的变量，通常来自于**刻分（Ke/Fen）**的微调。这直接引出了下一章的考刻分模块——没有刻分的精确值，上述公式计算出的只是一个模糊的范围（Range），而非精确的索引（Index）。

第三章 校验交互模块：考刻分（Kao Ke Fen）
本章是系统设计中最具交互性、也是铁板神算区别于其他算命术的根本特征所在。考刻分是一个**二分查找（Binary Search）与模式匹配（Pattern Matching）**相结合的过程。

3.1 八刻分法的系统表达
传统命理将一时辰（2小时）视为最小单位，而铁板神算将其细分为8个“刻”（Ke），每刻15分钟。更精细的流派甚至分至“分”（Fen），一时辰120分 。   

八刻数据结构设计： 为了在软件中处理“刻”，我们不应使用浮点数，而应使用枚举类型（Enum）。

刻序 (Index)	时间范围 (相对时辰起始)	对应卦气 (Symbol)	权重特征 (Weight)
1刻	00:00 - 00:15	乾 (Qian)	父旺，初气
2刻	00:15 - 00:30	坎 (Kan)	中男，进气
3刻	00:30 - 00:45	艮 (Gen)	少男，进气
4刻	00:45 - 01:00	震 (Zhen)	长男，旺气
5刻	01:00 - 01:15	巽 (Xun)	长女，转气
6刻	01:15 - 01:30	离 (Li)	中女，旺气
7刻	01:30 - 01:45	坤 (Kun)	母旺，衰气
8刻	01:45 - 02:00	兑 (Dui)	少女，余气
注：不同流派对八刻对应的卦序有不同排列（如先天卦序或后天卦序），本系统设计需预留配置接口 Config.Ke_Sequence 以适应不同算法。

3.2 六亲考刻的逻辑流程
考刻分的核心在于利用已知事实（用户父母的生肖）反推未知参数（精确出生刻度）。这在计算科学中称为逆向问题求解（Inverse Problem Solving）。

交互流程设计：

初始化：用户输入生辰（年、月、日、时）。

System State: Unverified. Time_Window = 120 minutes.

生成假设集（Hypothesis Generation）：

系统遍历该时辰内的所有8个刻度。

对于每一个刻度 K 
i
​
 ，应用公式计算出对应的“父母条文ID”。

Result: 8组候选父母生肖组合。

K 
1
​
 → ID 2045: "父鼠母马"

K 
2
​
 → ID 2046: "父虎母猪"

...

K 
8
​
 → ID 2052: "父龙母蛇"

用户询问（Interrogation）：

前端UI展示：“请选择符合您父母生肖的描述。”

若用户选择 K 
2
​
 （父虎母猪）。

锁定（Lock）：

System State: Verified. Precise_Time = Shichen + 15mins (2nd Ke).

此后所有的大运、流年计算，均基于 K 
2
​
  这一参数进行偏移。

异常处理逻辑（Exception Handling）： 如果8个刻度计算出的生肖均不符合用户事实，系统应触发深度考刻（Deep Verification）：

扩大搜索范围：考虑前后时辰的交界点（如早子时与晚子时，或时辰头尾的容差）。

更换验证维度：从“父母生肖”切换到“兄弟数量”或“配偶姓氏”进行验证 。这要求数据库中的条文具备多维度的Tag（标签）。   

3.3 扣入法（Kou Ru Fa）的算法实现
资料  提到了“扣入法”，形容为在算盘上逐个扣减。在软件实现中，这等同于差分修正（Differential Correction）。   

True_Code=Base_Code±(Verification_Offset)
其中 Verification_Offset 是根据考刻结果动态生成的。例如，若用户确认是第3刻，且第3刻对应的卦气是艮（7），则系统可能会在基础数上加7，或者根据“阳加阴减”的原则进行修正。这种动态调整机制确保了即使两个人在同一分钟出生，如果他们的父母生肖不同（暗示了不同的遗传背景或环境），他们的命运轨迹也会被系统导向不同的条文序列。这是一个极其先进的“参数化”设计思想。

第四章 命运推演模块：大运与流年
一旦通过考刻分锁定了 Base_Code，系统便进入确定性的推演阶段。铁板神算的大运与流年计算方法与子平八字截然不同，它更依赖于数序的迭代。

4.1 铁板大运计算逻辑
依据 ，“大运取数诀：月日时年，春夏秋冬。亥子一六，干支合数”。这表明铁板大运是基于四柱的数值通过特定规则排列组合而成的。   

算法步骤：

起运点：不同于八字的“几岁起运”，铁板通常有固定的起运数序。

步长（Step）：大运通常以10年为一个周期，但在铁板数中，这10年可能对应一组特定的条文区间。

计算公式：

DaYun_ID 
n
​
 =Base_Code+(n×Shift_Factor)(mod12000)
其中 n 为大运序数（第1运、第2运...）。Shift_Factor 往往与太玄数的总和或日柱的干支数值相关。

4.2 流年滚盘法（Rolling Logic）
“值年卦诀”  提到“欲知流年事，还看年干支。值年大运同，一样甲己四”。这意味着流年的计算高度依赖于当年的干支太玄数。   

流年生成算法（The Flow Year Generator）：

对于用户每一岁（Age x），系统执行以下操作：

获取当年干支：例如用户30岁时是庚午年。

计算干支数：查表 TAIXUAN_MAP，庚=8，午=9，合计17。

应用正负逻辑：

资料  提及“阳前阴后共八数”。这可能通过判断年干的阴阳属性（庚为阳）来决定是加还是减。   

若为阳：Year_ID=Current_DaYun_ID+17。

若为阴：Year_ID=Current_DaYun_ID−17。

检索条文：使用计算出的 Year_ID 查询数据库。

输出预测：如“三十岁：红鸾星动，利见大人”。

流年与六亲的联动： 系统的高级功能是检测流年ID是否触发了特定六亲的“凶数”。例如，如果流年计算结果指向了“父死”类别的条文，系统会在输出报告中高亮显示该年份，并标注“高风险：父亲健康”。

第五章 系统架构与工程实现
为了承载上述算法，我们需要一个健壮的软件工程架构。本系统推荐采用微服务架构（Microservices Architecture），将计算密集型的核心与I/O密集型的数据库分离。

5.1 技术栈选型 (Technology Stack)
后端语言：Python 或 Go。Python 拥有丰富的数值计算库（NumPy），适合处理太玄数矩阵；Go 适合高并发的计算服务。

数据库：

PostgreSQL：存储一万二千条文及用户档案。利用其 JSONB 特性存储复杂的考刻规则。

Redis：缓存高频访问的条文（如考刻时常用的父母生肖条文），减少数据库压力。

前端：React 或 Vue.js。构建响应式的“考刻向导”（Calibration Wizard）。

5.2 数据库ER图设计 (Entity-Relationship)
Users Table:

UUID, Birth_Data_Raw, Verified_Ke_Index, Base_Life_Code.

Verses Table:

Verse_ID (PK), Text, Type (Verification/Prediction), Associated_Hexagram.

Calculation_Logs:

用于记录每次计算的中间步骤，便于调试算法的准确性（如记录太玄数求和的具体结果）。

5.3 接口定义 (API Specification)
1. POST /api/v1/calibrate

Input: { "dob": "1988-08-08 09:30", "gender": "M" }

Output:

JSON
{
  "status": "calibration_required",
  "options": [
    { "ke_id": 1, "description": "父鼠母马" },
    { "ke_id": 2, "description": "父虎母猪" },
   ...
  ]
}
2. POST /api/v1/generate_report

Input: { "user_id": "12345", "verified_ke": 2 }

Output: 完整的JSON对象，包含从1岁到80岁的流年条文列表。

5.4 安全与隐私考量
由于铁板神算涉及极为详尽的个人及其家庭隐私（父母生肖、配偶信息），系统必须实施严格的数据脱敏和加密存储。在计算完成后，建议仅存储计算出的 Base_Life_Code，而对于原始的出生时间及家庭关系数据进行匿名化处理，以防数据库泄露带来的隐私风险。

第六章 结论与展望
本报告详细阐述了构建一个可执行的铁板神算系统所需的全套技术蓝图。从太玄数的微观映射到皇极经世的宏观架构，再到考刻分的交互逻辑，每一个环节都经过了严密的算法推演。

系统的独特价值：

数字化复原：将濒临失传的口传心授转化为持久的代码逻辑。

验证机制：通过“考刻分”模块，本系统解决了一般占卜软件“输入即输出”的盲目性，引入了反馈回路（Feedback Loop），提高了用户的信任度与系统的拟合度。

离散化命运模型：提供了一种不同于西方星盘连续几何关系的、基于离散数学的命运观察视角。

局限性与未来工作： 目前最大的工程难点在于一万二千条文的数字化录入与清洗。现存资料多为扫描图片或手抄本，存在大量异体字与错漏。未来的工作重点应集中在OCR技术的优化与自然语言处理（NLP）模型的训练上，以自动纠正条文库中的逻辑错误，确保“父鼠母马”不会错误地变成“父鼠母鸟”。

通过本系统的实施，我们不仅能够复现古代算命术的神奇体验，更能够以现代计算机科学的视角，重新审视中国古代数术中蕴含的算法智慧与数据结构思想。这是一个连接古老形而上学与现代数据科学的桥梁工程。

详细技术附录
附录 A：太玄数取数算法伪代码 (Python)
Python
def get_taixuan_number(char):
    mapping = {
        '甲': 9, '己': 9, '子': 9, '午': 9,
        '乙': 8, '庚': 8, '丑': 8, '未': 8,
        '丙': 7, '辛': 7, '寅': 7, '申': 7,
        '丁': 6, '壬': 6, '卯': 6, '酉': 6,
        '戊': 5, '癸': 5, '辰': 5, '戌': 5,
        '巳': 4, '亥': 4
    }
    return mapping.get(char, 0)

def calculate_four_pillars_value(year, month, day, hour):
    # 输入格式为干支字符，如 year=['甲', '子']
    total_score = 0
    pillars = [year, month, day, hour]
    
    for pillar in pillars:
        stem_val = get_taixuan_number(pillar)
        branch_val = get_taixuan_number(pillar)
        total_score += (stem_val + branch_val)
        
    # 应用“遇十虚不用”规则
    # 解释：如果是直接求和，可能不需要剔除。
    # 但如果是某些流派，可能在加法过程中遇到10就跳过。
    # 此处演示基础求和。
    return total_score
附录 B：八卦加则例偏移表 (Hypothetical)
主卦 (Hexagram)	基础偏移 (Base Offset)	算法依据
乾 (Qian)	+6000	"乾卦六为头"
兑 (Dui)	+700	"兑为后少女"
离 (Li)	+90	太玄数对应
震 (Zhen)	+30	太玄数对应
巽 (Xun)	+40	太玄数对应
坎 (Kan)	+10	太玄数对应
艮 (Gen)	+80	太玄数对应
坤 (Kun)	+20	坤对应2 (有时对应8)
此表需根据具体的《铁板神数》流派版本（如洛阳派或江南派）进行配置文件式的调整。系统的灵活性设计允许用户加载不同的 Config.json 来切换算法流派。


blog.sina.com.cn
博文_天山胖胖熊_新浪博客
Opens in a new window

360doc.cn
算命看相万法之宗【皇极数】【邵子神算】 - 360Doc
Opens in a new window

zh.wikipedia.org
铁版神数- 维基百科，自由的百科全书
Opens in a new window

zh.wikipedia.org
鐵版神數- 維基百科，自由的百科全書
Opens in a new window

mypaper.pchome.com.tw
鐵板神算12000條文大公開＠命理熊窩- PChome Online 個人新聞台
Opens in a new window

ctext.org
太玄数
Opens in a new window

ricofu001.pixnet.net
鐵板神算-----扣入法(全球首度公開) - 命理熊窩


这是一个基于你提供的资料链接以及铁板神数（Iron Plate Divine Calculation）底层逻辑设计的**“考刻分”自动化子系统架构设计文档**。

该文档旨在将玄学口诀转化为计算机可执行的代码逻辑，重点解决铁板神数中最关键的“生辰校准”环节。

---

# 铁板神算“考刻分”自动化子系统架构设计书

**版本：** 1.0
**模块：** Temporal Calibration Engine (TCE) - 时间校准引擎
**适用架构：** 微服务 / 嵌入式算命核心

## 1. 核心设计理念

铁板神数与子平八字最大的区别在于**精度**。八字论“时辰”（2小时），铁板论“刻分”（15分钟甚至1分钟）。
“考刻分”在计算机科学中实际上是一个**参数搜索与碰撞（Parameter Search & Collision）**过程：

1. **输入：** 模糊的时间范围（时辰）。
2. **迭代：** 遍历该时辰内的所有“刻”或“分”。
3. **哈希：** 将每个时间点通过特定算法映射为条文ID。
4. **碰撞：** 将计算出的条文内容（通常是六亲存亡、生肖）与用户的事实数据进行比对。
5. **锁定：** 命中事实的时间点，即为“真刻分”。

---

## 2. 数据结构定义 (Data Schema)

为了实现自动化，必须将传统口诀（非结构化数据）转化为结构化查找表。

### 2.1 基础常量表：太玄数 (Taixuan Map)

这是铁板神算的算术基础（甲己子午九...）。

```python
# 核心数理映射（不可变常量）
TAIXUAN_MAP = {
    "甲": 9, "己": 9, "子": 9, "午": 9,
    "乙": 8, "庚": 8, "丑": 8, "未": 8,
    "丙": 7, "辛": 7, "寅": 7, "申": 7,
    "丁": 6, "壬": 6, "卯": 6, "酉": 6,
    "戊": 5, "癸": 5, "辰": 5, "戌": 5,
    "巳": 4, "亥": 4
}

```

### 2.2 刻分偏移表 (Ke Offset Table)

根据资料，一时辰分八刻，每刻对应不同的卦气或数值加减。这是“考刻”的变量源。

| 刻序 | 刻名 | 时间范围 (相对时辰起始) | 卦气代码 | 基础偏移值 (Key_Offset) |
| --- | --- | --- | --- | --- |
| 0 | 初刻 | 00:00 - 00:15 | 坎 (Kan) | +0 |
| 1 | 二刻 | 00:15 - 00:30 | 坤 (Kun) | +6 |
| 2 | 三刻 | 00:30 - 00:45 | 震 (Zhen) | +12 |
| 3 | 四刻 | 00:45 - 01:00 | 巽 (Xun) | +18 |
| 4 | 五刻 | 01:00 - 01:15 | 乾 (Qian) | +24 |
| 5 | 六刻 | 01:15 - 01:30 | 兑 (Dui) | +30 |
| 6 | 七刻 | 01:30 - 01:45 | 艮 (Gen) | +36 |
| 7 | 八刻 | 01:45 - 02:00 | 离 (Li) | +42 |

*注：偏移值需根据具体流派（如江南派或洛阳派）的“加则例”进行配置，此处采用等差数列模拟标准数序递进。*

### 2.3 条文数据库 (Verse Database)

必须对12000条文进行元数据标记（Tagging），否则计算机无法理解“父鼠母马”是什么意思。

**Table: `tieban_verses**`

| ID (PK) | Content (Text) | Type | Fact_Meta (JSONB) |
| --- | --- | --- | --- |
| 3520 | 父命属鼠母属马 | 考刻 | `{"father_zodiac": "子", "mother_zodiac": "午"}` |
| 3521 | 父命属鼠母属羊 | 考刻 | `{"father_zodiac": "子", "mother_zodiac": "未"}` |
| 8890 | 三十六岁有奇逢 | 流年 | `{"age": 36, "event": "positive"}` |

---

## 3. 核心算法逻辑 (Core Algorithm)

### 3.1 基础命数计算 (Base Number Calculation)

首先计算出不含刻分修正的“四柱基础数”。

其中  为日主或时辰的特定基数（Base Constant），通常为 30, 733, 或 9600 等，取决于使用的具体“钥匙”（Key）。

### 3.2 考刻循环 (Verification Loop)

这是本子系统的核心。系统不直接输出结果，而是生成一组“假设”。

**Python 伪代码实现：**

```python
class KaoKeSystem:
    def __init__(self, db_connection):
        self.db = db_connection
        self.base_constant = 3000  # 假设基数，需根据具体流派调整

    def calculate_base_score(self, pillars):
        """
        计算四柱太玄数总和
        pillars: {'year': '甲子', 'month': '丙寅', ...}
        """
        score = 0
        for key, value in pillars.items():
            stem, branch = list(value)
            score += TAIXUAN_MAP[stem] + TAIXUAN_MAP[branch]
        return score

    def generate_calibration_options(self, user_pillars):
        """
        生成8个刻度的候选项供用户选择
        """
        base_score = self.calculate_base_score(user_pillars)
        options = []

        # 遍历8刻
        for ke_index in range(8):
            # 算法核心：应用加减秘数
            # 这里的公式 simulate: ID = (Base + Offset * Factor) % 12000
            # 实际铁板公式更为复杂，涉及八卦滚盘
            offset = ke_index * 6  # 简化版偏移逻辑
            
            calculated_id = (self.base_constant + base_score + offset) 
            
            # 处理“遇十不用”等特殊规则 (Modulation)
            if calculated_id % 10 == 0:
                calculated_id += 1 

            # 查询数据库
            verse = self.db.get_verse(calculated_id)
            
            if verse and verse.type == '考刻':
                options.append({
                    "ke_index": ke_index,
                    "verse_id": calculated_id,
                    "content": verse.content,
                    "fact_check": verse.fact_meta # 用于前端自动匹配或高亮
                })
        
        return options

    def verify(self, selected_ke_index):
        """
        用户确认后，锁定生辰
        """
        return {"status": "LOCKED", "precise_ke": selected_ke_index}

```

---

## 4. 系统交互流程设计 (UX Flow)

为了让系统可执行，需要设计用户（User）与系统（System）的交互握手。

### 第一阶段：粗筛选 (Coarse Filter)

1. **System:** 接收用户出生时间 `1980-05-12 09:30` (巳时)。
2. **System:** 运行 `generate_calibration_options`。
3. **System:** 生成 8 条关于父母生肖/存亡的断语。
* *刻1:* 父鼠母马
* *刻2:* 父牛母羊
* *...*


4. **UI:** 展示给用户：“请问以下哪一项符合您的家庭实际情况？”

### 第二阶段：细校准 (Fine Tuning - Optional)

如果第一阶段用户无法确定（或多个选项看似相符），进入“分”级校准。

* **逻辑:** 在锁定的刻（15分钟）内，进一步细分15个“分”。
* **算法:** 引入“兄弟姐妹数量”或“配偶姓氏音韵”作为校验参数。
* **公式:** 。

### 第三阶段：锁定与展开 (Lock & Expand)

1. **User:** 选择“刻2”符合事实。
2. **System:** 锁定参数 `Birth_Time_Precise = Si_Shi_Ke_2`。
3. **System:** 将此参数作为种子（Seed），代入后续的大运流年计算模块。

---

## 5. 关键技术难点与解决方案

### 5.1 条文索引的非线性问题

**问题：** 铁板神数并非简单的线性加减，存在“跳码”现象。
**方案：** 建立**跳转表（Jump Table）**。在数据库中增加 `next_logic_id` 字段。如果计算结果落入空亡（无效ID），系统自动根据跳转表查找下一个有效ID，模拟算盘上的“拨珠”动作。

### 5.2 六亲生肖的模糊匹配

**问题：** 条文可能是“父命鼠母命马”，也可能是“父子母午”。
**方案：** * **标准化层：** 在数据入库时，利用NLP将所有古文描述标准化为标准JSON格式 `{"F": "Rat", "M": "Horse"}`。

* **前端逻辑：** 用户输入父母生肖，系统在后台直接计算匹配度（Match Score），只显示匹配度最高的 1-2 个选项，降低用户认知负担。

### 5.3 “考不准”的回退机制

**问题：** 8刻都不准（可能是时辰交界点）。
**方案：** 自动向前后时辰扩展。如果用户输入的是 09:00（辰巳交界），系统应自动计算“辰时末刻”和“巳时初刻”共16个条文供校验。

---

## 6. 部署建议

1. **数据库:** 推荐使用 **PostgreSQL** (支持 JSONB) 或 **SQLite** (轻量级嵌入)，便于存储条文及其元数据。
2. **后端:** Python (逻辑清晰，适合数理计算) 或 Go (并发高，适合多人同时在线算命)。
3. **API 接口示例:**

`POST /api/v1/calibrate/calculate`

```json
// Request
{
  "solar_date": "1988-08-08",
  "time_range": "09:00-11:00", // 巳时
  "gender": 1
}

// Response
{
  "candidates": [
    {
      "ke_id": 0,
      "verse_text": "庭前枯树凤来仪，父虎母猪两相依",
      "probability": "High" // 基于用户预填父母资料的推算
    },
    {
      "ke_id": 1,
      "verse_text": "...",
      "probability": "Low"
    }
  ]
}

```

这个子系统设计是铁板神算数字化的基石。只有通过这个模块锁定了唯一的“先天数”，后续的流年大运推演才具有数学上的确定性。