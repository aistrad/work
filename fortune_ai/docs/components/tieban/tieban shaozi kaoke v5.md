你好，我是铁板神算命理大师。

这是一个非常敏锐且具有决定性意义的洞察。

你是对的。在 v4.0 及之前的设计中，我们潜意识地将“铁板神算”视为一个单一的黑盒。但仔细审视附件 `research tieban3.md`（邵子神数新编）与 `research tieban2.md`（胖胖熊实战），这实际上是**两套同源但异构的系统**。

* **系统 A：铁板神数 (Tieban 12k)**
* **容量**：约 12,000 条。
* **逻辑**：**线性流（Stream）**。基于基数（Base）进行 `+96` 的算术递推，形成时间轴上的连续命运流。
* **核心算法**：四柱天干数、八卦加则、16组加减秘数。
* **适用场景**：流年详批、六亲生肖精准定位。


* **系统 B：邵子神数 (Shaozi 6k)**
* **容量**：6,144 条（12集 × 512条）。
* **逻辑**：**矩阵索引（Matrix）**。基于 `集-组-条` 的三维坐标定位，且有严格的男女分卷限制。
* **核心算法**：十二集分类（子~亥）、XnGn 编码结构、元会运世卦气。
* **适用场景**：格局总断、性格定性。



如果用铁板的算法算出数字 `2521`，去查邵子的库，会发现邵子库里根本没有 ID 为 2521 的条文（邵子是编码制，如 `1111`）；反之亦然。

为此，我发布 **《铁板神数系统核心算法架构设计书 v5.0 (Dual-Kernel Architecture)》**。本版本将系统底层彻底重构为**双核驱动**。

---

# 铁板神数系统核心算法架构设计书 v5.0 (Dual-Kernel)

**版本**: 5.0
**状态**: 双库异构匹配完成
**核心变革**:

1. **物理隔离**: 建立 `KB_Tieban` 和 `KB_Shaozi` 两套独立的数据库。
2. **双引擎算力**:
* **Engine-T (Arithmetic)**: 专用于 12k 库，执行算术推演（+96）与秘数搜索。
* **Engine-S (Coordinate)**: 专用于 6k 库，执行坐标映射（Set-Group-Line）。


3. **交叉验证**: 利用邵子的结构化确定性辅助铁板的考刻。

---

## 第一章：知识库的双层架构 (Dual-Schema KB)

必须建立两个结构完全不同的数据表，严禁混用。

### 1.1 铁板实战库 (Target: Engine-T)

*对应资料：research tieban2.md*

* **表名**: `kb_tieban_12k`
* **索引**: `strip_id` (INT, 1-13000)
* **结构**: 线性列表。
* **Schema**:
```sql
CREATE TABLE kb_tieban_12k (
    strip_id INT PRIMARY KEY,       -- 范围 1 - 13000
    content TEXT,                   -- 例："父鼠母马，先天定数"
    category VARCHAR(20),           -- 'PARENTS', 'SIBLINGS', 'FORTUNE'

    -- 核心逻辑字段
    remainder_96 INT,               -- strip_id % 96，用于流年链表快速匹配
    is_secret_point BOOLEAN         -- 标记是否为"16组秘数"的常见落点
);

```



### 1.2 邵子原理库 (Target: Engine-S)

*对应资料：research tieban3.md*

* **表名**: `kb_shaozi_6k`
* **索引**: `shaozi_code` (VARCHAR, e.g., "子-1121")
* **结构**: 层级坐标 `Set(集) -> Group(组) -> Line(条)`。
* **Schema**:
```sql
CREATE TABLE kb_shaozi_6k (
    -- 复合主键：集-组-条
    set_id INT,                     -- [1-12] 对应 子(1)...亥(12)
    group_id INT,                   -- [1-64] 对应 512条中的64个子组
    line_id INT,                    -- [1-8]  组内序号

    raw_code VARCHAR(10),           -- 原始编码，如 "1111", "12881"
    content TEXT,                   -- 四句七言诗

    -- 业务属性 (源自 tieban3 的特殊定义)
    gender_scope ENUM('M', 'F'),    -- M: Group 1-32, F: Group 33-64 (关键!)
    hexagram_idx INT,               -- 关联的64卦象ID (用于算法映射)

    PRIMARY KEY (set_id, group_id, line_id)
);

```



---

## 第二章：双核算法引擎详情

### 2.1 引擎 A：铁板算术引擎 (Engine-T)

**适用场景**: **考刻分**、**批流年**。
**核心逻辑**: **Modulo-96 Arithmetic (模96算术)**。

1. **基数计算 (Base Calc)**:
* 复用 v4 的胖胖熊公式：。
* *结果*: 得到一个整数  (如 2521)。


2. **秘数跳跃 (Key Hopping)**:
* 考刻时，若  未命中六亲条文，使用 16 组秘数进行**非线性跳跃**。
* 。
* *注意*: 此步骤**仅**在 `kb_tieban_12k` 中进行搜索。邵子库不支持这种加减法。


3. **流年滚动 (Timeline Rollout)**:
* 一旦刻分锁定，使用  生成时间轴。
* 。



### 2.2 引擎 B：邵子坐标引擎 (Engine-S)

**适用场景**: **定格局**、**总断**、**辅助校验**。
**核心逻辑**: **Matrix Mapping (矩阵映射)**。

邵子条文不是“算”出来的，是根据坐标“查”出来的。

1. **坐标定位 (Coordinate Calculation)**:
我们需要构建 `(Set, Group, Line)` 三维坐标。
* **Set (集)**: 由**年支**决定。
* 子年  子集(1); 丑年  丑集(2) ...


* **Group (组)**: 由**先天卦气**与**性别**决定（这是邵子最独特的逻辑）。
* 输入: 卦气值  (1-64), 性别 。
* **男命公式**:  (确保落在 1-32 区间)。
* **女命公式**:  (确保落在 33-64 区间)。


* **Line (条)**: 由**刻分**决定。
*  (范围 1-8)。




2. **编码生成**:
* 根据坐标查询 `kb_shaozi_6k`。
* *输出*: 邵子诗句（如“生平志气在云霄...”）。



---

## 第三章：考刻策略的深度优化 (Cross-Verification)

最强大的优化在于利用 **Engine-S (邵子)** 的**确定性结构**，来辅助解决 **Engine-T (铁板)** 的**模糊搜索**。

### 3.1 联合考刻流程

1. **初筛 (邵子引擎先行)**:
* 用户输入八字。
* Engine-S 根据年支、性别、卦气，直接锁定“集”和“组”（如：子集-第5组）。
* 提取该组下的 8 条（对应8个刻分）作为“格局总断”。
* *展示*: “请看这几句诗，哪句最符合您的性格或现状？”
* *用户反馈*: 选中第 2 条。
* **推论**: 锁定刻分为 **初一刻 (Line 2)**。


2. **精锁 (铁板引擎跟进)**:
* 将“初一刻”作为真值输入 Engine-T。
* Engine-T 计算基数，直接跳转到对应刻分的六亲条文。
* *展示*: “推算您的父母生肖为：父牛母羊，是否正确？”
* *用户反馈*: “是”。
* **结果**: 考刻完成。


3. **出书 (双轨输出)**:
* **卷一·总断篇**: 由 Engine-S 生成。提供性格分析、一生定调（文采好）。
* **卷二·流年篇**: 由 Engine-T 生成。提供每年的具体吉凶（如“32岁发财”）。



---

## 第四章：数据清洗的关键指令 (ETL Instructions)

为了实现 v5.0，数据清洗必须严格遵循以下规则：

1. **Rule 1 (邵子库清洗)**:
* 解析 `tieban3.md` 时，必须识别 `【1】` 到 `【64】` 的分组标记。
* **强制逻辑**: 将 【1】-【32】 标记为 `MALE`，【33】-【64】 标记为 `FEMALE`。这是邵子算法的核心路由依据，不可遗漏。
* 解析编码（如 `1121`）时，需补全集数，形成全局唯一码。


2. **Rule 2 (铁板库清洗)**:
* 解析 12000 条文时，使用正则 `r"父(.)母(.)"` 提取生肖，存入 `logic_tags`。
* 计算 `remainder_96` 并建立索引，这是流年计算性能的关键。



---

## 第五章：总结

v5.0 是对“铁板神数”系统工程的最终解构。我们不再追求用一个算法解决所有问题，而是：

* 用 **邵子引擎** 解决 **"我是谁"** (定性/格局) —— 基于**坐标与性别**。
* 用 **铁板引擎** 解决 **"我什么时候发生什么"** (定量/流年) —— 基于**算术与秘数**。

这种双核架构完美匹配了附件提供的两套资料的特征，是复原这门术数的唯一科学路径。