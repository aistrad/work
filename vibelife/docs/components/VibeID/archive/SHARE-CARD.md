# Vibe ID åˆ†äº«å¡ç‰‡è®¾è®¡

> Version: 7.0 | 2026-01-18

---

## æ¦‚è¿°

åˆ†äº«å¡ç‰‡æ˜¯ Vibe ID è£‚å˜çš„æ ¸å¿ƒè½½ä½“ï¼Œé‡‡ç”¨**æœåŠ¡ç«¯æ¸²æŸ“**æ–¹æ¡ˆï¼Œç¡®ä¿åœ¨æ‰€æœ‰å¹³å°ä¸Šçš„å…¼å®¹æ€§ã€‚

## è®¾è®¡ç›®æ ‡

1. **é«˜è¾¨è¯†åº¦**: ä¸€çœ¼å°±èƒ½è®¤å‡ºæ˜¯ VibeLife
2. **æ˜“ä¼ æ’­**: é€‚åˆæœ‹å‹åœˆã€å°çº¢ä¹¦ã€å¾®åšç­‰å¹³å°
3. **å¼•å‘å¥½å¥‡**: è®©çœ‹åˆ°çš„äººæƒ³æµ‹æµ‹è‡ªå·±çš„ Vibe
4. **å¿«é€ŸåŠ è½½**: å›¾ç‰‡ä½“ç§¯å°ï¼ŒåŠ è½½å¿«

---

## å¡ï¿½ï¿½ï¿½æ ·å¼

### 1. Default æ ·å¼ (é»˜è®¤)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚     â”‚   ğŸ§­     â”‚  æˆ‘æ˜¯              â”‚
â”‚     â”‚          â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚     â”‚  Avatar  â”‚  æ¢ç´¢è€… Vibe       â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                     â”‚
â”‚     "å¥½å¥‡å¿ƒé©±åŠ¨ï¼Œè¿½æ±‚æ„ä¹‰ï¼Œ          â”‚
â”‚      äº«å—æ¢ç´¢æœªçŸ¥çš„æ—…ç¨‹"            â”‚
â”‚                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ ğŸ” å¥½å¥‡å®å® 95%              â”‚ â”‚
â”‚     â”‚ ğŸ¦… ç‹¬ç«‹è‡ªä¸» 88%              â”‚ â”‚
â”‚     â”‚ ğŸ§  ç†æ€§åˆ†æ 82%              â”‚ â”‚
â”‚     â”‚ ğŸ¢ çˆ±å†’é™©   79%              â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚     æ‰«ç æµ‹æµ‹ä½ çš„ Vibe               â”‚
â”‚     [QR Code]           [VibeLife]  â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å°ºå¯¸: 750 x 1334 px (é€‚åˆæ‰‹æœºå±å¹•)
èƒŒæ™¯: æµ…ç±³è‰²æ¸å˜ (#FFF8F0 â†’ #FFF0E6)
```

### 2. Dark æ ·å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ â”‚
â”‚ â–“                                 â–“ â”‚
â”‚ â–“    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â–“ â”‚
â”‚ â–“    â”‚   ğŸ§­     â”‚  æˆ‘æ˜¯           â–“ â”‚
â”‚ â–“    â”‚          â”‚  â•â•â•â•â•â•â•â•â•â•â•â•   â–“ â”‚
â”‚ â–“    â”‚  Avatar  â”‚  æ¢ç´¢è€… Vibe    â–“ â”‚
â”‚ â–“    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â–“ â”‚
â”‚ â–“                                 â–“ â”‚
â”‚ â–“    "å¥½å¥‡å¿ƒé©±åŠ¨ï¼Œè¿½æ±‚æ„ä¹‰ï¼Œ       â–“ â”‚
â”‚ â–“     äº«å—æ¢ç´¢æœªçŸ¥çš„æ—…ç¨‹"         â–“ â”‚
â”‚ â–“                                 â–“ â”‚
â”‚ â–“    ğŸ” 95%  ğŸ¦… 88%  ğŸ§  82%       â–“ â”‚
â”‚ â–“                                 â–“ â”‚
â”‚ â–“    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â–“ â”‚
â”‚ â–“    æ‰«ç æµ‹æµ‹ä½ çš„ Vibe            â–“ â”‚
â”‚ â–“    [QR]              [VibeLife] â–“ â”‚
â”‚ â–“                                 â–“ â”‚
â”‚ â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

èƒŒæ™¯: æ·±è‰²æ¸å˜ (#1A1A2E â†’ #16213E)
æ–‡å­—: ç™½è‰²/æµ…è‰²
```

### 3. Gradient æ ·å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚
â”‚ â–‘  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â–‘ â”‚
â”‚ â–‘  â•‘                           â•‘  â–‘ â”‚
â”‚ â–‘  â•‘    ğŸ§­ æ¢ç´¢è€… Vibe         â•‘  â–‘ â”‚
â”‚ â–‘  â•‘                           â•‘  â–‘ â”‚
â”‚ â–‘  â•‘    "å¥½å¥‡å¿ƒé©±åŠ¨ï¼Œ          â•‘  â–‘ â”‚
â”‚ â–‘  â•‘     è¿½æ±‚æ„ä¹‰"             â•‘  â–‘ â”‚
â”‚ â–‘  â•‘                           â•‘  â–‘ â”‚
â”‚ â–‘  â•‘    â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ 95%        â•‘  â–‘ â”‚
â”‚ â–‘  â•‘    â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘ 88%        â•‘  â–‘ â”‚
â”‚ â–‘  â•‘    â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘ 82%        â•‘  â–‘ â”‚
â”‚ â–‘  â•‘                           â•‘  â–‘ â”‚
â”‚ â–‘  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â–‘ â”‚
â”‚ â–‘                                 â–‘ â”‚
â”‚ â–‘  [QR] æ‰«ç æµ‹æµ‹ä½ çš„ Vibe         â–‘ â”‚
â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

èƒŒæ™¯: åŸå‹å¯¹åº”çš„æ¸å˜è‰²
è¾¹æ¡†: æ¯›ç»ç’ƒæ•ˆæœ
```

### 4. Minimal æ ·å¼ (å°çº¢ä¹¦ä¼˜åŒ–)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚                                     â”‚
â”‚           ğŸ§­                        â”‚
â”‚                                     â”‚
â”‚        æ¢ç´¢è€… Vibe                  â”‚
â”‚                                     â”‚
â”‚    "å¥½å¥‡å¿ƒé©±åŠ¨ï¼Œè¿½æ±‚æ„ä¹‰"           â”‚
â”‚                                     â”‚
â”‚                                     â”‚
â”‚        VibeLife                     â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å°ºå¯¸: 1080 x 1080 px (æ­£æ–¹å½¢)
èƒŒæ™¯: çº¯è‰² + åŸå‹è‰²ç‚¹ç¼€
æç®€è®¾è®¡ï¼Œé€‚åˆå°çº¢ä¹¦
```

---

## æŠ€æœ¯å®ç°

### æœåŠ¡ç«¯æ¸²æŸ“æ–¹æ¡ˆ

ä½¿ç”¨ **Pillow** (Python) è¿›è¡Œå›¾ç‰‡æ¸²æŸ“ã€‚

```python
# skills/vibe_id/services/card_renderer.py

from PIL import Image, ImageDraw, ImageFont
from io import BytesIO
import qrcode
from typing import Dict, Any, Literal
import os

CardStyle = Literal["default", "dark", "gradient", "minimal"]

class CardRenderer:
    """åˆ†äº«å¡ç‰‡æ¸²æŸ“å™¨"""

    # å¡ç‰‡å°ºå¯¸
    SIZES = {
        "default": (750, 1334),
        "dark": (750, 1334),
        "gradient": (750, 1334),
        "minimal": (1080, 1080),
    }

    # å­—ä½“è·¯å¾„
    FONT_DIR = os.path.join(os.path.dirname(__file__), "../assets/fonts")

    def __init__(self):
        self._load_fonts()
        self._load_assets()

    def _load_fonts(self):
        """åŠ è½½å­—ä½“"""
        self.fonts = {
            "title": ImageFont.truetype(f"{self.FONT_DIR}/NotoSansSC-Bold.ttf", 48),
            "subtitle": ImageFont.truetype(f"{self.FONT_DIR}/NotoSansSC-Medium.ttf", 32),
            "body": ImageFont.truetype(f"{self.FONT_DIR}/NotoSansSC-Regular.ttf", 24),
            "small": ImageFont.truetype(f"{self.FONT_DIR}/NotoSansSC-Regular.ttf", 18),
            "emoji": ImageFont.truetype(f"{self.FONT_DIR}/NotoColorEmoji.ttf", 64),
        }

    def _load_assets(self):
        """åŠ è½½é™æ€èµ„æº"""
        assets_dir = os.path.join(os.path.dirname(__file__), "../assets")
        self.logo = Image.open(f"{assets_dir}/logo.png")

    def render(
        self,
        vibe_id: Dict[str, Any],
        style: CardStyle = "default",
        include_qr: bool = True
    ) -> bytes:
        """
        æ¸²æŸ“åˆ†äº«å¡ç‰‡

        Args:
            vibe_id: Vibe ID æ•°æ®
            style: å¡ç‰‡æ ·å¼
            include_qr: æ˜¯å¦åŒ…å«äºŒç»´ç 

        Returns:
            PNG å›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®
        """
        size = self.SIZES[style]
        img = Image.new("RGBA", size, self._get_background(style, vibe_id))
        draw = ImageDraw.Draw(img)

        if style == "default":
            self._render_default(img, draw, vibe_id, include_qr)
        elif style == "dark":
            self._render_dark(img, draw, vibe_id, include_qr)
        elif style == "gradient":
            self._render_gradient(img, draw, vibe_id, include_qr)
        elif style == "minimal":
            self._render_minimal(img, draw, vibe_id, include_qr)

        # è¾“å‡ºä¸º PNG
        buffer = BytesIO()
        img.save(buffer, format="PNG", optimize=True)
        return buffer.getvalue()

    def _get_background(self, style: CardStyle, vibe_id: Dict) -> tuple:
        """è·å–èƒŒæ™¯è‰²"""
        if style == "dark":
            return (26, 26, 46, 255)
        elif style == "minimal":
            return (255, 255, 255, 255)
        else:
            return (255, 248, 240, 255)

    def _render_default(self, img: Image, draw: ImageDraw, vibe_id: Dict, include_qr: bool):
        """æ¸²æŸ“é»˜è®¤æ ·å¼"""
        identity = vibe_id["identity"]
        tags = vibe_id["tags"]
        share = vibe_id["share"]

        width, height = img.size
        center_x = width // 2

        # åŸå‹ Emoji (å¤§)
        emoji = identity["primary_emoji"]
        draw.text((center_x, 150), emoji, font=self.fonts["emoji"], anchor="mm")

        # "æˆ‘æ˜¯" æ ‡ç­¾
        draw.text((center_x, 250), "æˆ‘æ˜¯", font=self.fonts["body"], fill=(100, 100, 100), anchor="mm")

        # åŸå‹åç§°
        archetype_text = f"{identity['primary_tagline']} Vibe"
        draw.text((center_x, 310), archetype_text, font=self.fonts["title"], fill=(30, 30, 30), anchor="mm")

        # æ ‡è¯­
        slogan = f'"{identity["primary_slogan"]}"'
        self._draw_wrapped_text(draw, slogan, center_x, 400, self.fonts["subtitle"], (80, 80, 80), width - 100)

        # æ ‡ç­¾
        y_offset = 550
        for tag in tags[:4]:
            tag_text = f"{tag['emoji']} {tag['label']} {tag['score']}%"
            draw.text((center_x, y_offset), tag_text, font=self.fonts["body"], fill=(60, 60, 60), anchor="mm")
            y_offset += 50

        # åˆ†éš”çº¿
        draw.line([(100, height - 300), (width - 100, height - 300)], fill=(200, 200, 200), width=1)

        # åº•éƒ¨æ–‡æ¡ˆ
        draw.text((center_x, height - 220), "æ‰«ç æµ‹æµ‹ä½ çš„ Vibe", font=self.fonts["body"], fill=(100, 100, 100), anchor="mm")

        # äºŒç»´ç 
        if include_qr:
            qr = self._generate_qr(f"https://vibelife.app/vibe-id/{share['share_code']}")
            qr = qr.resize((120, 120))
            img.paste(qr, (100, height - 180))

        # Logo
        logo = self.logo.resize((100, 30))
        img.paste(logo, (width - 150, height - 100), logo)

    def _render_dark(self, img: Image, draw: ImageDraw, vibe_id: Dict, include_qr: bool):
        """æ¸²æŸ“æ·±è‰²æ ·å¼"""
        # ç±»ä¼¼ defaultï¼Œä½†ä½¿ç”¨æ·±è‰²èƒŒæ™¯å’Œæµ…è‰²æ–‡å­—
        pass

    def _render_gradient(self, img: Image, draw: ImageDraw, vibe_id: Dict, include_qr: bool):
        """æ¸²æŸ“æ¸å˜æ ·å¼"""
        # ä½¿ç”¨åŸå‹å¯¹åº”çš„æ¸å˜è‰²
        pass

    def _render_minimal(self, img: Image, draw: ImageDraw, vibe_id: Dict, include_qr: bool):
        """æ¸²æŸ“æç®€æ ·å¼"""
        identity = vibe_id["identity"]
        width, height = img.size
        center_x = width // 2
        center_y = height // 2

        # åŸå‹ Emoji (è¶…å¤§)
        draw.text((center_x, center_y - 150), identity["primary_emoji"], font=self.fonts["emoji"], anchor="mm")

        # åŸå‹åç§°
        draw.text((center_x, center_y + 50), f"{identity['primary_tagline']} Vibe", font=self.fonts["title"], fill=(30, 30, 30), anchor="mm")

        # æ ‡è¯­ (ç®€çŸ­ç‰ˆ)
        short_slogan = identity["primary_slogan"][:20] + "..."
        draw.text((center_x, center_y + 120), f'"{short_slogan}"', font=self.fonts["subtitle"], fill=(100, 100, 100), anchor="mm")

        # å“ç‰Œ
        draw.text((center_x, height - 80), "VibeLife", font=self.fonts["body"], fill=(150, 150, 150), anchor="mm")

    def _generate_qr(self, url: str) -> Image:
        """ç”ŸæˆäºŒç»´ç """
        qr = qrcode.QRCode(
            version=1,
            error_correction=qrcode.constants.ERROR_CORRECT_L,
            box_size=10,
            border=2,
        )
        qr.add_data(url)
        qr.make(fit=True)
        return qr.make_image(fill_color="black", back_color="white")

    def _draw_wrapped_text(self, draw: ImageDraw, text: str, x: int, y: int, font: ImageFont, fill: tuple, max_width: int):
        """ç»˜åˆ¶è‡ªåŠ¨æ¢è¡Œæ–‡æœ¬"""
        lines = []
        current_line = ""

        for char in text:
            test_line = current_line + char
            bbox = draw.textbbox((0, 0), test_line, font=font)
            if bbox[2] - bbox[0] <= max_width:
                current_line = test_line
            else:
                lines.append(current_line)
                current_line = char

        if current_line:
            lines.append(current_line)

        line_height = font.size + 10
        total_height = len(lines) * line_height
        start_y = y - total_height // 2

        for i, line in enumerate(lines):
            draw.text((x, start_y + i * line_height), line, font=font, fill=fill, anchor="mm")


# å•ä¾‹
_renderer: CardRenderer = None

def get_card_renderer() -> CardRenderer:
    global _renderer
    if _renderer is None:
        _renderer = CardRenderer()
    return _renderer
```

### API ç«¯ç‚¹å®ç°

```python
# routes/vibe_id.py

from fastapi import APIRouter, Response
from fastapi.responses import StreamingResponse
from skills.vibe_id.services.card_renderer import get_card_renderer, CardStyle

router = APIRouter(prefix="/vibe-id", tags=["vibe-id"])

@router.get("/card/{share_code}.png")
async def get_share_card(
    share_code: str,
    style: CardStyle = "default",
    size: str = "medium"
):
    """è·å–åˆ†äº«å¡ç‰‡å›¾ç‰‡"""
    # 1. é€šè¿‡ share_code æŸ¥æ‰¾ vibe_id
    vibe_id = await find_vibe_id_by_share_code(share_code)
    if not vibe_id:
        # è¿”å›é»˜è®¤å ä½å›¾
        return Response(content=get_placeholder_image(), media_type="image/png")

    # 2. æ¸²æŸ“å¡ç‰‡
    renderer = get_card_renderer()
    image_bytes = renderer.render(vibe_id, style=style)

    # 3. è¿”å›å›¾ç‰‡
    return Response(
        content=image_bytes,
        media_type="image/png",
        headers={
            "Cache-Control": "public, max-age=3600",  # ç¼“å­˜1å°æ—¶
            "Content-Disposition": f"inline; filename=vibe-id-{share_code}.png"
        }
    )

@router.post("/card/generate")
async def generate_share_card(
    style: CardStyle = "default",
    include_qr: bool = True,
    current_user: dict = Depends(get_current_user)
):
    """ç”Ÿæˆåˆ†äº«å¡ç‰‡"""
    user_id = UUID(current_user["id"])

    # 1. è·å–ç”¨æˆ·çš„ vibe_id
    vibe_id = await get_vibe_id(user_id)
    if not vibe_id:
        raise HTTPException(status_code=404, detail="Vibe ID not found")

    # 2. æ¸²æŸ“å¡ç‰‡
    renderer = get_card_renderer()
    image_bytes = renderer.render(vibe_id, style=style, include_qr=include_qr)

    # 3. ä¿å­˜åˆ°å­˜å‚¨ (å¯é€‰)
    card_url = await save_card_to_storage(user_id, image_bytes)

    # 4. æ›´æ–° vibe_id ä¸­çš„ card_url
    await update_vibe_id_card_url(user_id, card_url)

    return {
        "status": "success",
        "data": {
            "card_url": card_url,
            "share_code": vibe_id["share"]["share_code"],
            "generated_at": datetime.utcnow().isoformat()
        }
    }
```

---

## èµ„æºæ–‡ä»¶

### å­—ä½“æ–‡ä»¶

```
skills/vibe_id/assets/fonts/
â”œâ”€â”€ NotoSansSC-Bold.ttf
â”œâ”€â”€ NotoSansSC-Medium.ttf
â”œâ”€â”€ NotoSansSC-Regular.ttf
â””â”€â”€ NotoColorEmoji.ttf
```

### é™æ€èµ„æº

```
skills/vibe_id/assets/
â”œâ”€â”€ logo.png                    # VibeLife Logo
â”œâ”€â”€ logo-white.png              # ç™½è‰² Logo (æ·±è‰²èƒŒæ™¯ç”¨)
â”œâ”€â”€ backgrounds/
â”‚   â”œâ”€â”€ default.png
â”‚   â”œâ”€â”€ dark.png
â”‚   â””â”€â”€ gradient-*.png          # å„åŸå‹æ¸å˜èƒŒæ™¯
â””â”€â”€ icons/
    â””â”€â”€ qr-placeholder.png
```

---

## åˆ†äº«ç ç”Ÿæˆ

```python
# skills/vibe_id/services/share_code.py

import random
import string
from typing import Optional

# åˆ†äº«ç å­—ç¬¦é›† (æ’é™¤æ˜“æ··æ·†å­—ç¬¦)
CHARSET = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789"

def generate_share_code(length: int = 6) -> str:
    """ç”Ÿæˆåˆ†äº«ç """
    return "".join(random.choices(CHARSET, k=length))

async def get_unique_share_code(max_attempts: int = 10) -> str:
    """è·å–å”¯ä¸€åˆ†äº«ç """
    for _ in range(max_attempts):
        code = generate_share_code()
        if not await share_code_exists(code):
            return code
    raise Exception("Failed to generate unique share code")

async def share_code_exists(code: str) -> bool:
    """æ£€æŸ¥åˆ†äº«ç æ˜¯å¦å·²å­˜åœ¨"""
    result = await fetchval(
        """SELECT 1 FROM unified_profiles
           WHERE profile->'skill_data'->'vibe_id'->'share'->>'share_code' = $1""",
        code
    )
    return result is not None
```

---

## ç¼“å­˜ç­–ç•¥

```python
# å¡ç‰‡ç¼“å­˜é…ç½®

CARD_CACHE_CONFIG = {
    # CDN ç¼“å­˜
    "cdn_ttl": 3600,              # 1å°æ—¶

    # æœ¬åœ°ç¼“å­˜
    "local_ttl": 300,             # 5åˆ†é’Ÿ

    # ç¼“å­˜ key æ ¼å¼
    "key_format": "vibe_card:{share_code}:{style}",

    # ç¼“å­˜å¤±æ•ˆæ¡ä»¶
    "invalidate_on": [
        "vibe_id_recalculated",
        "card_style_changed",
    ]
}
```

---

## æ€§èƒ½ä¼˜åŒ–

1. **å›¾ç‰‡å‹ç¼©**: ä½¿ç”¨ PNG ä¼˜åŒ–ï¼Œæ§åˆ¶åœ¨ 200KB ä»¥å†…
2. **CDN ç¼“å­˜**: å¡ç‰‡å›¾ç‰‡é€šè¿‡ CDN åˆ†å‘
3. **é¢„ç”Ÿæˆ**: ç”¨æˆ·åˆ›å»º Vibe ID æ—¶é¢„ç”Ÿæˆé»˜è®¤æ ·å¼å¡ç‰‡
4. **æ‡’åŠ è½½**: å…¶ä»–æ ·å¼æŒ‰éœ€ç”Ÿæˆ
