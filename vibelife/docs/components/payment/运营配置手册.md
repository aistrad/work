# VibeLife æ”¯ä»˜ç³»ç»Ÿé…ç½®æ‰‹å†Œ

## æ¦‚è¿°

VibeLife æ”¯æŒå¤šç§æ”¯ä»˜å¹³å°ï¼š

**Stripeï¼ˆä¸»è¦ï¼‰**
- ğŸ’³ ä¿¡ç”¨å¡/å€Ÿè®°å¡æ”¯ä»˜
- ğŸ“± æ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜
- ğŸ”„ è®¢é˜…åˆ¶è‡ªåŠ¨ç»­è´¹

**PayPalï¼ˆè¡¥å……ï¼‰**
- ğŸŒ å…¨çƒ 200+ å›½å®¶ PayPal ç”¨æˆ·
- ğŸ’³ ä¿¡ç”¨å¡æ”¯ä»˜ï¼ˆæ— éœ€ PayPal è´¦æˆ·ï¼‰
- ğŸ’° ä¸€æ¬¡æ€§é¢„ä»˜è´­ä¹°

---

## ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®

### 1. Stripe è´¦å·è®¾ç½®

**æ³¨å†Œæ­¥éª¤ï¼š**

1. è®¿é—® [Stripe Dashboard](https://dashboard.stripe.com/register)
2. æ³¨å†Œè´¦å·å¹¶å®Œæˆä¼ä¸šéªŒè¯
3. æ¿€æ´»è´¦æˆ·ï¼ˆéœ€è¦é“¶è¡Œè´¦æˆ·ç”¨äºæ”¶æ¬¾ï¼‰

**è·å– API å¯†é’¥ï¼š**

1. ç™»å½• Stripe Dashboard
2. å¯¼èˆªåˆ° **Developers** > **API Keys**
3. è·å–ä»¥ä¸‹å¯†é’¥ï¼š
   - **Publishable Key** (å…¬é’¥)ï¼š`pk_live_xxx` æˆ– `pk_test_xxx`
   - **Secret Key** (ç§é’¥)ï¼š`sk_live_xxx` æˆ– `sk_test_xxx`

**ç¯å¢ƒå˜é‡é…ç½®ï¼š**

```bash
# åç«¯é…ç½®ï¼šapps/api/.env

# ç”Ÿäº§ç¯å¢ƒ
STRIPE_SECRET_KEY=sk_live_xxxxxxxxxxxxxxxxxxxxxxxx
STRIPE_PUBLISHABLE_KEY=pk_live_xxxxxxxxxxxxxxxxxxxxxxxx

# æˆ–æµ‹è¯•ç¯å¢ƒ
# STRIPE_SECRET_KEY=sk_test_xxxxxxxxxxxxxxxxxxxxxxxx
# STRIPE_PUBLISHABLE_KEY=pk_test_xxxxxxxxxxxxxxxxxxxxxxxx
```

**æ–‡æ¡£å‚è€ƒï¼š** https://docs.stripe.com/keys

---

### 2. åˆ›å»ºäº§å“å’Œä»·æ ¼

**åœ¨ Stripe Dashboard åˆ›å»ºï¼š**

1. å¯¼èˆªåˆ° **Products** > **Add Product**
2. åˆ›å»ºäº§å“ï¼ˆå¦‚ "VibeLife Pro è®¢é˜…"ï¼‰
3. ä¸ºäº§å“æ·»åŠ ä»·æ ¼ï¼š
   - æœˆä»˜ä»·æ ¼ï¼ˆMonthlyï¼‰
   - å­£ä»˜ä»·æ ¼ï¼ˆQuarterlyï¼‰
   - å¹´ä»˜ä»·æ ¼ï¼ˆYearlyï¼‰

**ä»·æ ¼é…ç½®ç¤ºä¾‹ï¼š**

| äº§å“ | å‘¨æœŸ | ä»·æ ¼ | è´§å¸ | Price ID |
|-----|------|-----|------|----------|
| Pro è®¢é˜… | æœˆä»˜ | $9.99 | USD | `price_xxx` |
| Pro è®¢é˜… | å­£ä»˜ | $24.99 | USD | `price_xxx` |
| Pro è®¢é˜… | å¹´ä»˜ | $79.99 | USD | `price_xxx` |
| é¢„ä»˜å¥—é¤ | 1ä¸ªæœˆ | HK$78 | HKD | `price_xxx` |
| é¢„ä»˜å¥—é¤ | 3ä¸ªæœˆ | HK$198 | HKD | `price_xxx` |
| é¢„ä»˜å¥—é¤ | 12ä¸ªæœˆ | HK$588 | HKD | `price_xxx` |

**ç¯å¢ƒå˜é‡é…ç½®ï¼š**

```bash
# åç«¯é…ç½®ï¼šapps/api/.env

# æµ·å¤–è®¢é˜… Price IDs (USD, Recurring)
STRIPE_PRICE_SUB_MONTHLY_USD=price_xxxxxxxxxxxxxxxx
STRIPE_PRICE_SUB_QUARTERLY_USD=price_xxxxxxxxxxxxxxxx
STRIPE_PRICE_SUB_YEARLY_USD=price_xxxxxxxxxxxxxxxx

# å¤§é™†/é¦™æ¸¯é¢„ä»˜ Price IDs (HKD, One-time)
STRIPE_PRICE_PREPAID_1M_HKD=price_xxxxxxxxxxxxxxxx
STRIPE_PRICE_PREPAID_3M_HKD=price_xxxxxxxxxxxxxxxx
STRIPE_PRICE_PREPAID_12M_HKD=price_xxxxxxxxxxxxxxxx
```

**æ–‡æ¡£å‚è€ƒï¼š** https://docs.stripe.com/products-prices/manage-prices

---

### 3. é…ç½® Webhook

**ç”¨é€”ï¼š** æ¥æ”¶ Stripe çš„æ”¯ä»˜äº‹ä»¶é€šçŸ¥ï¼ˆæˆåŠŸã€å¤±è´¥ã€é€€æ¬¾ç­‰ï¼‰

**é…ç½®æ­¥éª¤ï¼š**

1. å¯¼èˆªåˆ° **Developers** > **Webhooks**
2. ç‚¹å‡» **Add endpoint**
3. é…ç½®ç«¯ç‚¹ï¼š
   - **Endpoint URL**: `https://vibelife.app/api/payment/webhook`
   - **Events to send**: é€‰æ‹©ä»¥ä¸‹äº‹ä»¶
     - `checkout.session.completed`
     - `customer.subscription.created`
     - `customer.subscription.updated`
     - `customer.subscription.deleted`
     - `invoice.paid`
     - `invoice.payment_failed`
     - `payment_intent.succeeded`
     - `payment_intent.payment_failed`
4. åˆ›å»ºåè·å– **Signing Secret**: `whsec_xxx`

**ç¯å¢ƒå˜é‡é…ç½®ï¼š**

```bash
# åç«¯é…ç½®ï¼šapps/api/.env
STRIPE_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxxxxxxxxxxxx
```

**æœ¬åœ°æµ‹è¯• Webhookï¼š**

```bash
# å®‰è£… Stripe CLI
brew install stripe/stripe-cli/stripe

# ç™»å½•
stripe login

# è½¬å‘ Webhook åˆ°æœ¬åœ°
stripe listen --forward-to localhost:8000/api/payment/webhook
```

**æ–‡æ¡£å‚è€ƒï¼š** https://docs.stripe.com/webhooks

---

### 4. é…ç½® Customer Portal

**ç”¨é€”ï¼š** è®©ç”¨æˆ·è‡ªåŠ©ç®¡ç†è®¢é˜…ï¼ˆæ›´æ¢è®¡åˆ’ã€å–æ¶ˆè®¢é˜…ã€æ›´æ–°æ”¯ä»˜æ–¹å¼ï¼‰

**é…ç½®æ­¥éª¤ï¼š**

1. å¯¼èˆªåˆ° **Settings** > **Billing** > **Customer portal**
2. é…ç½®å…è®¸çš„åŠŸèƒ½ï¼š
   - âœ… Update payment methods
   - âœ… Cancel subscriptions
   - âœ… Switch plans
   - âœ… View invoices
3. é…ç½®å“ç‰Œï¼ˆLogoã€é¢œè‰²ï¼‰
4. ä¿å­˜è®¾ç½®

**å›è°ƒ URL é…ç½®ï¼š**

```bash
# åç«¯é…ç½®ï¼šapps/api/.env
BILLING_PORTAL_RETURN_URL=https://vibelife.app/account
```

---

### 5. é…ç½®æ”¯ä»˜å›è°ƒé¡µé¢

```bash
# åç«¯é…ç½®ï¼šapps/api/.env
PAYMENT_SUCCESS_URL=https://vibelife.app/payment/success
PAYMENT_CANCEL_URL=https://vibelife.app/pricing
```

---

## PayPal é…ç½®

### 1. PayPal Business è´¦å·è®¾ç½®

**æ³¨å†Œæ­¥éª¤ï¼š**

1. è®¿é—® [PayPal Business](https://www.paypal.com/bizsignup)
2. é€‰æ‹©è´¦æˆ·ç±»å‹ï¼ˆä¸ªäººå•†æˆ· / ä¼ä¸šï¼‰
3. å®Œæˆèº«ä»½éªŒè¯å’Œé“¶è¡Œè´¦æˆ·å…³è”

> **ä¸ªäººå•†æˆ·**ï¼šé€‚åˆå°å‹é¡¹ç›®ï¼Œæ‰‹ç»­è´¹ç•¥é«˜ï¼Œæ— éœ€ä¼ä¸šèµ„è´¨
> **ä¼ä¸šè´¦æˆ·**ï¼šéœ€è¦è¥ä¸šæ‰§ç…§ï¼Œæ‰‹ç»­è´¹ç•¥ä½

---

### 2. åˆ›å»º REST API åº”ç”¨

**é…ç½®æ­¥éª¤ï¼š**

1. ç™»å½• [PayPal Developer Dashboard](https://developer.paypal.com/dashboard)
2. å¯¼èˆªåˆ° **Apps & Credentials**
3. ç‚¹å‡» **Create App**
4. å¡«å†™åº”ç”¨ä¿¡æ¯ï¼š
   - **App Name**: `VibeLife`
   - **App Type**: Merchant
5. åˆ›å»ºåè·å–ï¼š
   - **Client ID**: `AYSq3RDGsmBLJE-otTkBtM-xxx`
   - **Client Secret**: `EGnHDxD_qRPdaLdZz8iCr8N7_xxx`

**ç¯å¢ƒé€‰æ‹©ï¼š**
- **Sandbox**: æµ‹è¯•ç¯å¢ƒï¼ˆé»˜è®¤ï¼‰
- **Live**: ç”Ÿäº§ç¯å¢ƒï¼ˆéœ€è¦åˆ‡æ¢ï¼‰

**ç¯å¢ƒå˜é‡é…ç½®ï¼š**

```bash
# åç«¯é…ç½®ï¼šapps/api/.env

# Sandboxï¼ˆæµ‹è¯•ï¼‰
PAYPAL_CLIENT_ID=AYSq3RDGsmBLJE-otTkBtM-jBRd1TCQwFf9RGfwddNXWz
PAYPAL_CLIENT_SECRET=EGnHDxD_qRPdaLdZz8iCr8N7_MzF-YHPTkjs6NKYQvQS
PAYPAL_MODE=sandbox

# Liveï¼ˆç”Ÿäº§ï¼‰- åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ä½¿ç”¨
# PAYPAL_CLIENT_ID=xxx
# PAYPAL_CLIENT_SECRET=xxx
# PAYPAL_MODE=live
```

**å‰ç«¯é…ç½®ï¼š**

```bash
# å‰ç«¯é…ç½®ï¼šapps/web/.env.local
NEXT_PUBLIC_PAYPAL_CLIENT_ID=AYSq3RDGsmBLJE-otTkBtM-jBRd1TCQwFf9RGfwddNXWz
```

**æ–‡æ¡£å‚è€ƒï¼š** https://developer.paypal.com/api/rest/

---

### 3. é…ç½® PayPal Webhook

**ç”¨é€”ï¼š** æ¥æ”¶ PayPal çš„æ”¯ä»˜äº‹ä»¶é€šçŸ¥

**é…ç½®æ­¥éª¤ï¼š**

1. åœ¨ PayPal Developer Dashboard å¯¼èˆªåˆ° **My Apps & Credentials**
2. é€‰æ‹©ä½ çš„åº”ç”¨
3. æ»šåŠ¨åˆ° **Webhooks** éƒ¨åˆ†ï¼Œç‚¹å‡» **Add Webhook**
4. é…ç½®ç«¯ç‚¹ï¼š
   - **Webhook URL**: `https://vibelife.app/api/payment/paypal/webhook`
   - **Events**: é€‰æ‹©ä»¥ä¸‹äº‹ä»¶
     - `CHECKOUT.ORDER.APPROVED`
     - `PAYMENT.CAPTURE.COMPLETED`
     - `PAYMENT.CAPTURE.DENIED`
     - `PAYMENT.CAPTURE.REFUNDED`
5. åˆ›å»ºåè·å– **Webhook ID**: `WH-xxx`

**ç¯å¢ƒå˜é‡é…ç½®ï¼š**

```bash
# åç«¯é…ç½®ï¼šapps/api/.env
PAYPAL_WEBHOOK_ID=WH-xxxxxxxxxxxxxxxx
```

---

### 4. PayPal å›è°ƒ URL

```bash
# åç«¯é…ç½®ï¼šapps/api/.env
PAYPAL_RETURN_URL=https://vibelife.app/payment/paypal/success
PAYPAL_CANCEL_URL=https://vibelife.app/payment/paypal/cancel
```

---

## é…ç½®æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰è¯·ç¡®è®¤ä»¥ä¸‹é…ç½®å·²å®Œæˆï¼š

### Stripe å¿…éœ€é…ç½®
- [ ] Stripe Secret Key - `STRIPE_SECRET_KEY`
- [ ] Stripe Publishable Key - `STRIPE_PUBLISHABLE_KEY`
- [ ] Stripe Webhook Secret - `STRIPE_WEBHOOK_SECRET`
- [ ] è‡³å°‘ä¸€ä¸ª Price ID é…ç½®

### PayPal é…ç½®ï¼ˆå¯é€‰ï¼‰
- [ ] PayPal Client ID - `PAYPAL_CLIENT_ID`
- [ ] PayPal Client Secret - `PAYPAL_CLIENT_SECRET`
- [ ] PayPal Mode - `PAYPAL_MODE` (sandbox/live)
- [ ] PayPal Webhook ID - `PAYPAL_WEBHOOK_ID`
- [ ] å‰ç«¯ Client ID - `NEXT_PUBLIC_PAYPAL_CLIENT_ID`

### æ¨èé…ç½®
- [ ] Payment Success URL - `PAYMENT_SUCCESS_URL`
- [ ] Payment Cancel URL - `PAYMENT_CANCEL_URL`
- [ ] Billing Portal Return URL - `BILLING_PORTAL_RETURN_URL`
- [ ] PayPal Return URL - `PAYPAL_RETURN_URL`
- [ ] PayPal Cancel URL - `PAYPAL_CANCEL_URL`

### ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥
- [ ] Stripe ä½¿ç”¨ç”Ÿäº§å¯†é’¥ï¼ˆ`sk_live_`ï¼Œé `sk_test_`ï¼‰
- [ ] PayPal è®¾ç½®ä¸º live æ¨¡å¼ï¼ˆ`PAYPAL_MODE=live`ï¼‰
- [ ] Webhook ç«¯ç‚¹ä½¿ç”¨ HTTPS
- [ ] é“¶è¡Œè´¦æˆ·å·²å…³è”ï¼ˆç”¨äºæ”¶æ¬¾ï¼‰

---

## æµ‹è¯•éªŒè¯

### 1. æµ‹è¯•æ”¯ä»˜æµç¨‹

1. ä½¿ç”¨ Stripe æµ‹è¯•å¡ï¼š`4242 4242 4242 4242`
2. æœ‰æ•ˆæœŸï¼šä»»æ„æœªæ¥æ—¥æœŸ
3. CVCï¼šä»»æ„ 3 ä½æ•°
4. é‚®ç¼–ï¼šä»»æ„ 5 ä½æ•°

### 2. æµ‹è¯• Webhook

```bash
# ä½¿ç”¨ Stripe CLI è§¦å‘æµ‹è¯•äº‹ä»¶
stripe trigger checkout.session.completed
stripe trigger payment_intent.succeeded
```

### 3. æµ‹è¯•è®¢é˜…æµç¨‹

1. æ‰“å¼€ `https://vibelife.app/pricing`
2. é€‰æ‹©è®¢é˜…è®¡åˆ’
3. å®Œæˆæ”¯ä»˜
4. éªŒè¯ç”¨æˆ·æƒç›Šå·²æ›´æ–°

---

## å¸¸è§é—®é¢˜

### Q1: æ”¯ä»˜æ€»æ˜¯å¤±è´¥ï¼Ÿ
**A:** æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„ API å¯†é’¥ï¼ˆæµ‹è¯• vs ç”Ÿäº§ï¼‰ï¼Œå¹¶ç¡®è®¤å¡ç‰‡ä¿¡æ¯æ­£ç¡®ã€‚

### Q2: Webhook æ”¶ä¸åˆ°äº‹ä»¶ï¼Ÿ
**A:** æ£€æŸ¥ Webhook URL æ˜¯å¦æ­£ç¡®ï¼ŒSigning Secret æ˜¯å¦é…ç½®ã€‚å¯ä»¥åœ¨ Stripe Dashboard çš„ Webhooks é¡µé¢æŸ¥çœ‹äº‹ä»¶æ—¥å¿—ã€‚

### Q3: ç”¨æˆ·æ— æ³•è®¿é—® Customer Portalï¼Ÿ
**A:** ç¡®è®¤ç”¨æˆ·å·²æœ‰ Stripe Customer IDï¼Œä¸” Portal é…ç½®å·²å¯ç”¨ã€‚

### Q4: å¦‚ä½•å¤„ç†é€€æ¬¾ï¼Ÿ
**A:** åœ¨ Stripe Dashboard çš„ Payments é¡µé¢ï¼Œæ‰¾åˆ°å¯¹åº”äº¤æ˜“ï¼Œç‚¹å‡» Refundã€‚ç³»ç»Ÿä¼šé€šè¿‡ Webhook æ¥æ”¶é€€æ¬¾é€šçŸ¥ã€‚

---

## æŠ€æœ¯æ”¯æŒ

å¦‚é‡é…ç½®é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. Stripe Dashboard äº‹ä»¶æ—¥å¿—
2. åç«¯æ—¥å¿—ï¼š`apps/api/logs/`
3. Stripe CLI è¾“å‡º

è”ç³»æ–¹å¼ï¼š
- Stripe å®˜æ–¹æ”¯æŒï¼šhttps://support.stripe.com
- Stripe å¼€å‘è€…æ–‡æ¡£ï¼šhttps://docs.stripe.com
