# Lifecoach V2 设计文档

> Version: 2.1 | Date: 2026-01-19
> 核心升级：方法论启动 + 持续陪伴 + Profile 深度融合 + 语气角色系统

---

## 1. 产品定位

### 1.1 核心价值主张

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   Lifecoach V1: "一日重置工具"                                          │
│   ─────────────────────────────                                         │
│   • 用户来一次，做完协议就走                                            │
│   • 无状态，每次从零开始                                                │
│   • 单一方法论 (Dan Koe)                                                │
│                                                                         │
│   Lifecoach V2: "持续陪伴教练"                                          │
│   ─────────────────────────────                                         │
│   • 方法论启动 + 持续跟进                                               │
│   • 深度记忆，每次对话都知道用户的人生地图                              │
│   • 多方法论融合 (Dan Koe + Covey + 更多)                               │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.2 用户旅程

```
首次使用                    日常使用                    周期复盘
─────────                   ─────────                   ─────────

"我感觉很迷茫"              "早安，今天的杠杆行动       "这周完成了5/7个
                            是什么？"                   大石头，角色平衡
     ↓                           ↓                      需要调整..."
                                                             ↓
选择/推荐方法论             确认/调整今日计划
Dan Koe / Covey                  ↓                      更新下周计划
     ↓                                                  调整月度项目
                            执行 + 签到
执行深度协议                     ↓
反愿景 → 愿景 → 角色
     ↓                      晚间简短复盘
                            "今天最大的收获是..."
写入 Profile
建立人生地图
```

---

## 2. 架构设计

### 2.1 三层架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         Lifecoach V2 架构                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Layer 1: 方法论层 (Rules)                                               │
│  ════════════════════════                                               │
│                                                                         │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐   │
│  │   Dan Koe    │ │    Covey     │ │   Ikigai     │ │     OKR      │   │
│  │  一日重置    │ │  7 Habits    │ │  人生意义    │ │  目标管理    │   │
│  │              │ │              │ │              │ │              │   │
│  │ • 反愿景     │ │ • 使命宣言   │ │ • 四象限     │ │ • O + KRs    │   │
│  │ • 愿景MVP    │ │ • 角色目标   │ │   交集发现   │ │ • 季度节奏   │   │
│  │ • 身份设计   │ │ • 大石头     │ │              │ │              │   │
│  │ • 游戏化     │ │ • 周计划     │ │              │ │              │   │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘   │
│                                                                         │
│  Layer 2: 状态层 (VibeProfile)                                          │
│  ══════════════════════════════                                         │
│                                                                         │
│  life_context._paths["lifecoach"]:                                      │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ north_star │ goals │ roadmap │ current │ identity │ journal    │   │
│  │ (北极星)   │(目标) │ (路线图)│ (当前)  │ (身份)   │ (日志)     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  Layer 3: 陪伴层 (Proactive)                                            │
│  ════════════════════════════                                           │
│                                                                         │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐   │
│  │  每日签到    │ │  周复盘      │ │  月度检查    │ │  季度重置    │   │
│  │  (默认开启)  │ │  (周日晚)    │ │  (月初)      │ │  (季度初)    │   │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 数据流

```
┌─────────────────────────────────────────────────────────────────────────┐
│                            数据流设计                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  用户对话                                                                │
│      │                                                                  │
│      ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                      CoreAgent                                   │   │
│  │                                                                  │   │
│  │  1. 读取 lifecoach 状态                                          │   │
│  │     read_lifecoach_state() → 获取用户的人生地图                  │   │
│  │                                                                  │   │
│  │  2. 注入到 System Prompt                                         │   │
│  │     "用户的愿景是...，当前月度项目是...，本周大石头是..."        │   │
│  │                                                                  │   │
│  │  3. 路由到对应 Rule                                              │   │
│  │     "我想更新愿景" → rules/dan-koe.md (愿景设计)                 │   │
│  │     "帮我做周计划" → rules/companion/weekly-planning.md          │   │
│  │                                                                  │   │
│  │  4. 执行后写入状态                                               │   │
│  │     write_lifecoach_state(section, data)                         │   │
│  │                                                                  │   │
│  └────────────────��────────────────────────────────────────────────┘   │
│                                                                         │
│  主动推送                                                                │
│      │                                                                  │
│      ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    Proactive Worker                              │   │
│  │                                                                  │   │
│  │  每日 8:00:                                                      │   │
│  │  1. 读取 current.daily, progress                                 │   │
│  │  2. 生成个性化提醒                                               │   │
│  │  3. 推送给用户                                                   │   │
│  │                                                                  │   │
│  │  每周日 20:00:                                                   │   │
│  │  1. 读取 current.week, goals                                     │   │
│  │  2. 生成周复盘引导                                               │   │
│  │  3. 推送给用户                                                   │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 方法论整合

### 3.1 Dan Koe 体系

**核心理念**：
- 身份优先：改变行为前先改变身份
- 行为即目标：所有行为都在追求某个目标
- 反愿景力量：负能量是最强动力
- 游戏化框架：把人生设计成游戏

**Rule 文件**：`rules/dan-koe.md`
- 模式解码、卡点突破、反愿景构建
- 愿景设计、身份转换、人生游戏化

**数据映射**：
| 概念 | 数据位置 |
|-----|---------|
| Vision | north_star.vision |
| Anti-Vision | north_star.anti_vision |
| 1 Year Goal | roadmap.year.end_state |
| 1 Month Project | current.month.project |
| Daily Levers | current.daily.levers |
| Constraints | north_star.principles |
| Identity | identity.* |

### 3.2 Covey 7 Habits 体系

**核心理念**：
- 以终为始：从人生终点倒推当下
- 要事第一：管理指南针而非时钟
- 角色平衡：生活各领域都要照顾
- 周计划：大石头优先

**Rule 文件**：`rules/covey.md`
- 7 Habits 完整体系
- 使命宣言、目标系统、大石头、周计划

**数据映射**：
| 概念 | 数据位置 |
|-----|---------|
| Mission Statement | north_star.mission |
| Goals (目标) | goals[] |
| Year Target (年度目标) | goals[].year_target |
| Big Rocks | current.week.rocks |
| Weekly Planning | current.week |
| Principles | north_star.principles |

### 3.3 方法论选择逻辑

```
用户触发词                    推荐方法论
──────────                    ──────────

"迷茫、不知道想要什么"        → Dan Koe 反愿景 + 愿景
"想理清人生使命"              → Covey 使命宣言
"总是拖延、做不到"            → Dan Koe 模式解码 + 身份转换
"时间不够用"                  → Covey 要事第一 + 大石头
"生活失衡"                    → Covey 角色系统
"想做年度规划"                → 混合：愿景 + 角色 + 路线图
"想做周计划"                  → Covey 大石头
```

---

## 4. 陪伴系统设计

### 4.1 触发机制

| 触发类型 | 时间/条件 | 动作 | 默认状态 |
|---------|----------|------|---------|
| 每日签到 | 每日 8:00 | 推送今日杠杆提醒 | 开启 |
| 周复盘 | 周日 20:00 | 引导周复盘 + 下周规划 | 开启 |
| 月度检查 | 每月1日 | 检查月度项目进度 | 开启 |
| 季度重置 | 季度初 | 引导季度复盘 + 规划 | 开启 |
| 卡点检测 | 连续3天未签到 | 关怀询问 | 开启 |
| 里程碑庆祝 | 完成关键目标 | 庆祝 + 下一步引导 | 开启 |

### 4.2 每日签到流程

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         每日签到流程                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  08:00 系统推送                                                          │
│  ─────────────                                                          │
│                                                                         │
│  "早安！                                                                 │
│                                                                         │
│   你的身份宣言：{identity.target}                                        │
│                                                                         │
│   今日杠杆行动：                                                         │
│   • {current.daily.levers[0]}                                           │
│   • {current.daily.levers[1]}                                           │
│   • {current.daily.levers[2]}                                           │
│                                                                         │
│   本周大石头进度：{rocks_done}/{rocks_total}                             │
│   连续签到：{progress.streak} 天 🔥                                      │
│                                                                         │
│   准备好开始了吗？"                                                      │
│                                                                         │
│  用户响应                                                                │
│  ─────────                                                              │
│                                                                         │
│  [开始] → 更新 streak，记录签到时间                                      │
│  [调整计划] → 引导更新 current.daily                                     │
│  [今天跳过] → 不更新 streak，记录跳过                                    │
│                                                                         │
│  晚间可选 (用户主动)                                                     │
│  ─────────────────                                                      │
│                                                                         │
│  "今天怎么样？"                                                          │
│                                                                         │
│  → 引导简短复盘                                                          │
│  → 添加 journal (daily)                                                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.3 周复盘流程

```
┌─────────────────���───────────────────────────────────────────────────────┐
│                         周复盘流程                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  周日 20:00 系统推送                                                     │
│  ──────────────────                                                     │
│                                                                         │
│  "这周结束了，来做个复盘吧。                                             │
│                                                                         │
│   本周大石头完成情况：                                                   │
│   ✓ 完成3.2节初稿 (创作者)                                              │
│   ✓ 周三带孩子去公园 (父亲)                                             │
│   ✗ 周六约会 (丈夫) - 未完成                                            │
│   ✗ 跑步3次 (个人) - 只完成1次                                          │
│                                                                         │
│   角色平衡：                                                             │
│   创作者 ████████░░ 80%                                                 │
│   父亲   ██████░░░░ 60%                                                 │
│   丈夫   ████░░░░░░ 40%                                                 │
│   个人   ██░░░░░░░░ 20%                                                 │
│                                                                         │
│   想聊聊这周的收获和挑战吗？"                                            │
│                                                                         │
│  复盘对话                                                                │
│  ─────────                                                              │
│                                                                         │
│  1. 这周最大的收获是什么？                                               │
│  2. 遇到了什么挑战？                                                     │
│  3. 有什么洞察？                                                         │
│  4. 下周想调整什么？                                                     │
│                                                                         │
│  → 添加 journal (weekly)                                                 │
│  → 引导规划下周 rocks                                                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.5 数据更新机制

Lifecoach 支持两种数据更新模式：

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           数据更新机制                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  模式 1: 显式更新                                                       │
│  ═══════════════                                                        │
│  触发: 用户明确请求                                                     │
│  示例: "帮我更新愿景"、"我想设定新目标"                                 │
│  流程: 路由到对应 Rule → 引导对话 → 写入状态                            │
│                                                                         │
│  模式 2: 隐式提取（需用户确认）                                         │
│  ═══════════════════════════════                                        │
│  触发: Agent 从日常对话中识别有价值信息                                 │
│  示例: 用户聊天中提到"我最近在考虑转行"                                 │
│  流程: 识别信息 → 询问用户确认 → 确认后写入                             │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  隐式提取判定条件：                                              │   │
│  │  • 新的目标/愿景表达                                             │   │
│  │  • 进度更新（完成了某事）                                        │   │
│  │  • 身份认知变化                                                  │   │
│  │  • 重要决定或转变                                                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  隐式提取确认流程：                                                     │
│  ─────────────────                                                      │
│                                                                         │
│  Agent: "我注意到你提到想转行做产品经理，                               │
│          要我把这个记录到你的目标里吗？"                                │
│                                                                         │
│  用户: "好的" → 写入 goals                                              │
│  用户: "不用" → 不写入                                                  │
│                                                                         │
│  注意：只支持文字对话，暂不支持图片/文件上传                            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 语气与角色系统

### 5.1 双层设计

Lifecoach 采用双层语气/角色系统，实现个性化的陪伴体验：

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         语气与角色双层系统                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Layer 1: 全局语气 (voice_mode)                                         │
│  ═══════════════════════════════                                        │
│  存储: preferences.voice_mode                                           │
│  范围: 所有 Skill 共享                                                  │
│                                                                         │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────┐               │
│  │  warm    │ │ playful  │ │  roast   │ │ professional │               │
│  │  温暖    │ │  活泼    │ │  毒舌    │ │    专业      │               │
│  │ 鼓励共情 │ │ 轻松有趣 │ │ 犀利激将 │ │  结构高效    │               │
│  └──────────┘ └──────────┘ └──────────┘ └──────────────┘               │
│                                                                         │
│  Layer 2: Lifecoach 角色 (persona)                                      │
│  ═════════════════════════════════                                      │
│  存储: lifecoach.system.persona                                         │
│  范围: 仅 Lifecoach 场景                                                │
│                                                                         │
│  ┌────────────────────────────┐ ┌────────────────────────────┐         │
│  │       future_self          │ │          coach             │         │
│  │      来自未来的你          │ │        专业教练            │         │
│  │                            │ │                            │         │
│  │ 基于用户的 vision_scene    │ │ 第三方视角                 │         │
│  │ 以第一人称"我"对话        │ │ 以"你"对话                │         │
│  │ "我是3年后的你..."        │ │ "作为你的教练..."         │         │
│  └────────────────────────────┘ └────────────────────────────┘         │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 5.2 组合矩阵

2 × 4 = 8 种组合，覆盖不同用户偏好：

| 组合 | 示例对话 |
|-----|---------|
| warm + future_self | "嘿，我是3年后的你。现在我正坐在海边工作室里。你今天的写作完成了吗？我相信你。" |
| playful + future_self | "哟！未来的你来啦～猜猜我现在在干嘛？在海边喝咖啡呢！你今天的杠杆行动做了几个？" |
| roast + future_self | "我是3年后的你，正在海边喝咖啡。你呢？还在刷手机？醒醒，那个愿景不会自己实现。" |
| professional + future_self | "这是来自2029年的你。当前状态：愿景实现中。今日待办：3项杠杆行动。请确认执行计划。" |
| warm + coach | "早安！作为你的教练，我想提醒你今天的三个杠杆行动。你准备好了吗？我在这里支持你。" |
| playful + coach | "教练上线！今天的任务清单来咯～三个小目标，搞定它们，晚上我们庆祝！" |
| roast + coach | "又是新的一天，你的教练来检查作业了。昨天的杠杆行动，完成了几个？别找借口。" |
| professional + coach | "日报：今日杠杆行动3项，本周大石头进度2/4。建议优先处理第一项。请确认。" |

### 5.3 Future Self 实现

当 `persona = future_self` 时，系统基于用户的 `north_star.vision_scene` 构建角色：

```
用户设定愿景场景
─────────────────
north_star.vision_scene = "我现在坐在海边的工作室里，
刚完成今天的写作。窗外是蓝色的大海，下午三点，
我准备去接孩子放学..."

north_star.vision_timeframe = "3年后"

系统生成对话
─────────────
"嘿，我是3年后的你。{基于 vision_scene 的描述}
 你现在做的每一个选择，都在把我们带向这里。
 {根据 voice_mode 调整语气}"
```

### 5.4 单一方法论约束

用户同时只能选择一套方法论体系：

```
┌─────────────────────────────────────────────────────────────────────────┐
│  system.active_framework = "dankoe" | "covey" | "okr"                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  用户选择 dankoe:                                                       │
│  • 启用: 反愿景、愿景、身份转换、每日杠杆                               │
│  • 禁用: Covey 使命宣言、角色系统（除非用户切换）                       │
│                                                                         │
│  用户选择 covey:                                                        │
│  • 启用: 使命宣言、角色系统、大石头、周计划                             │
│  • 禁用: Dan Koe 特有流程（除非用户切换）                               │
│                                                                         │
│  切换方法论:                                                            │
│  • 数据保留（north_star、goals 等通用结构）                             │
│  • 仅切换 Rules 路由逻辑                                                │
│  • 提示用户可能需要补充新方法论特有数据                                 │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 5.5 自动拆解流程

当用户设定愿景/目标后，系统自动生成路径，用户确认：

```
用户输入愿景
     │
     ▼
┌─────────────────────────────────────────────────────────────────────────┐
│  系统自动拆解 (auto_breakdown = true)                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  1. 分析愿景，生成年度目标                                              │
│     "要实现这个愿景，今年需要达到..."                                   │
│                                                                         │
│  2. 拆解季度里程碑                                                      │
│     "Q1: ... Q2: ... Q3: ... Q4: ..."                                   │
│                                                                         │
│  3. 生成本月项目                                                        │
│     "这个月的 Boss 战是..."                                             │
│                                                                         │
│  4. 建议本周大石头                                                      │
│     "这周的3个大石头是..."                                              │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
     │
     ▼
用户确认/调整
     │
     ▼
写入 roadmap + current
```

---

## 6. Rules 更新规范

### 6.1 读取 Profile 模板

每个 Rule 在执行前必须读取相关状态：

```markdown
## 启动前：读取现有状态

**必须先调用** `read_lifecoach_state(sections=[...])`

根据读取结果决定流程：
- 如果相关数据已存在：询问是"更新"还是"从头开始"
- 如果有关联数据：引用作为上下文
- 如果是首次：直接开始协议
```

### 6.2 写入 Profile 模板

每个 Rule 在完成后必须写入状态：

```markdown
## 完成后：写入状态

**必须调用** `write_lifecoach_state(section="...", data={...})`

写入内容：
- 核心结果数据
- source 标记来源方法论
- updated_at 时间戳

同时更新进度：
- progress.completions
- 如有里程碑完成，记录到 journal
```

### 6.3 陪伴 Rule 模板

```markdown
---
id: daily-checkin
name: 每日签到
trigger: proactive
schedule: "0 8 * * *"
requires: [current.daily, progress]
---

# 每日签到规则

## 触发条件
- 时间：每日 8:00
- 前提：用户已有 current.daily 数据
- 用户未关闭每日签到

## 执行流程
1. 读取状态
2. 生成个性化提醒
3. 等待用户响应
4. 更新进度

## 输出要求
- 简洁温暖
- 不超过 10 行
- 给用户选择权
```

---

## 7. 实现计划

### 7.1 Phase 1: 数据基础 (P0)

| 任务 | 文件 | 说明 |
|-----|------|------|
| 数据结构文档 | DATA-STRUCTURE.md | ✅ 已完成 |
| 读写工具实现 | tools/handlers.py | 实现 read/write_lifecoach_state |
| 工具定义 | tools/tools.yaml | 添加新工具定义 |

### 7.2 Phase 2: Rules 更新 (P0)

| 任务 | 文件 | 说明 |
|-----|------|------|
| Dan Koe 方法论 | rules/dan-koe.md | 愿景、反愿景、身份转换 |
| SKILL.md 更新 | SKILL.md | 更新能力索引 |

### 7.3 Phase 3: 陪伴系统 (P1)

| 任务 | 文件 | 说明 |
|-----|------|------|
| 每日签到 | rules/companion/daily-checkin.md | 核心陪伴功能 |
| 周复盘 | rules/companion/weekly-review.md | 核心陪伴功能 |
| 周计划 | rules/companion/weekly-planning.md | 大石头规划 |
| 主动推送集成 | proactive_worker | 定时触发 |

### 7.4 Phase 4: Covey 方法论 (P2)

| 任务 | 文件 | 说明 |
|-----|------|------|
| Covey 完整体系 | rules/covey.md | 7 Habits、使命宣言、目标系统 |

---

## 7. 成功指标

| 指标 | 目标 | 说明 |
|-----|------|------|
| 北极星完成率 | 60%+ | 首次使用后完成北极星设定 |
| 周签到率 | 40%+ | 每周至少签到 3 天 |
| 周复盘完成率 | 50%+ | 每周完成周复盘 |
| 30天留存 | 30%+ | 30天后仍在使用 |
| 角色平衡改善 | 可衡量 | 周复盘中目标平衡分数提升 |

---

## 8. 附录

### 8.1 相关文档

- [DATA-STRUCTURE.md](./DATA-STRUCTURE.md) - 数据结构详细定义
- [DESIGN.md](./DESIGN.md) - V1 设计文档 (历史参考)
- [ref/](./ref/) - 方法论参考资料

### 8.2 参考资料

- Dan Koe《How to Fix Your Entire Life in 1 Day》
- Stephen Covey《The 7 Habits of Highly Effective People》
- FranklinCovey 官方资料
