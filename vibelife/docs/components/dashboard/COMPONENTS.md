# Dashboard 组件实现指南

> **Version**: 2.0 | 2026-01-19
> **关联文档**: DESIGN.md (视觉规格)

---

## 核心组件 ASCII 详图

### 1. AmbientHeader

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              AmbientHeader                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   ┌──────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                          │  │
│   │  ☀️ 早安，{用户名}                              2026年1月19日 大寒前3天   │  │
│   │  ───────────────────────────────────────────────────────────────────     │  │
│   │  "{智能名言}"                                              — {作者}      │  │
│   │                                                                          │  │
│   │  🔥 {streak}天连续   💪 能量 {energy}%   {status}        [ 签到 ]       │  │
│   │                                                                          │  │
│   └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│   子组件:                                                                        │
│   ├── Greeting: 时间问候 + 用户名                                              │
│   ├── DateDisplay: 日期 + 节气                                                 │
│   ├── QuoteDisplay: 智能名言                                                   │
│   └── StatusBar: 签到状态 + 连续天数 + 能量                                    │
│       ├── StreakBadge: 🔥 连续天数                                             │
│       ├── EnergyIndicator: 💪 能量值                                           │
│       ├── CheckedStatus: ✓ 已签到 / □ 未签到                                  │
│       └── CheckInButton: [ 签到 ]                                              │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**智能名言系统:**

```typescript
// src/lib/dashboard/quotes.ts

/**
 * 名言库 - 按主题分类
 * 设计原则：触动人心、简洁有力、与用户状态共鸣
 */

// ═══════════════════════════════════════════════════════════════
// 1. 愿景与目标
// ═══════════════════════════════════════════════════════════════
const VISION_QUOTES = [
  { text: "你的愿景正在等待你的行动。", author: null },
  { text: "种一棵树最好的时间是十年前，其次是现在。", author: "中国谚语" },
  { text: "不是因为看见了才相信，而是因为相信了才看见。", author: null },
  { text: "你不必看清整个楼梯，只需迈出第一步。", author: "马丁·路德·金" },
  { text: "今天做的每一件小事，都是明天大事的预演。", author: null },
  { text: "目标不是用来达成的，而是用来指引方向的。", author: "布鲁斯·李" },
  { text: "梦想不会逃跑，逃跑的永远是自己。", author: "村上春树" },
  { text: "最慢的步伐不是跬步，而是徘徊。", author: null },
];

// ═══════════════════════════════════════════════════════════════
// 2. 坚持与毅力
// ═══════════════════════════════════════════════════════════════
const PERSISTENCE_QUOTES = [
  { text: "滴水穿石，不是力量大，而是功夫深。", author: null },
  { text: "每一次你想放弃的时候，想想为什么开始。", author: null },
  { text: "成功的秘诀在于坚持。坚持的秘诀在于热爱。", author: null },
  { text: "复利效应：今天的1%进步，一年后是37倍。", author: null },
  { text: "不是强者才能坚持，而是坚持了才会变强。", author: null },
  { text: "你已经走了这么远，不要忘记为什么出发。", author: null },
  { text: "日拱一卒，功不唐捐。", author: "曾国藩" },
];

// ═══════════════════════════════════════════════════════════════
// 3. 自我认知 (荣格相关)
// ═══════════════════════════════════════════════════════════════
const SELF_AWARENESS_QUOTES = [
  { text: "认识你自己。", author: "苏格拉底" },
  { text: "你是谁，比你做什么更重要。", author: null },
  { text: "真正的自由是成为你自己。", author: null },
  { text: "接纳自己，是改变的起点。", author: null },
  { text: "每个人都是自己生命的作者。", author: null },
  { text: "最深的井，往往有最甜的水。", author: "尼采" },
  { text: "你内心的答案，比任何外在的声音都重要。", author: null },
  { text: "向内求，是所有外在成就的起点。", author: null },
  { text: "你的任务不是去寻找爱，而是去寻找并拆除你内心所有阻挡爱的障碍。", author: "荣格" },
  { text: "凡是你所抗拒的，都会持续。", author: "荣格" },
  { text: "往外看的人在做梦，往内看的人正清醒。", author: "荣格" },
];

// ═══════════════════════════════════════════════════════════════
// 4. 行动与当下
// ═══════════════════════════════════════════════════════════════
const ACTION_QUOTES = [
  { text: "千里之行，始于足下。", author: "老子" },
  { text: "想都是问题，做才是答案。", author: null },
  { text: "最好的准备就是立刻开始。", author: null },
  { text: "完成比完美更重要。", author: null },
  { text: "今天是余生中最年轻的一天。", author: null },
  { text: "你不需要很厉害才能开始，但需要开始才能很厉害。", author: null },
  { text: "行动是治愈恐惧的良药。", author: null },
  { text: "先完成，再完美。", author: null },
];

// ═══════════════════════════════════════════════════════════════
// 5. 成长与变化
// ═══════════════════════════════════════════════════════════════
const GROWTH_QUOTES = [
  { text: "舒适区的边缘，是成长发生的地方。", author: null },
  { text: "蜕变总是伴随着不舒服。", author: null },
  { text: "你不是在变老，而是在变好。", author: null },
  { text: "今天的你比昨天的你更接近目标。", author: null },
  { text: "每一次跌倒，都是在学习如何站得更稳。", author: null },
  { text: "不是环境造就人，而是人选择如何回应环境。", author: "维克多·弗兰克尔" },
  { text: "成长是一个过程，不是一个事件。", author: null },
];

// ═══════════════════════════════════════════════════════════════
// 6. 休息与平衡
// ═══════════════════════════════════════════════════════════════
const REST_QUOTES = [
  { text: "休息不是放弃，而是为了走更远的路。", author: null },
  { text: "张弛有度，方能长久。", author: null },
  { text: "有时候，慢下来才能看清方向。", author: null },
  { text: "照顾好自己，才能照顾好世界。", author: null },
  { text: "留白是为了让重要的事物更突出。", author: null },
  { text: "能量管理比时间管理更重要。", author: null },
];

// ═══════════════════════════════════════════════════════════════
// 7. 困境与突破
// ═══════════════════════════════════════════════════════════════
const BREAKTHROUGH_QUOTES = [
  { text: "山重水复疑无路，柳暗花明又一村。", author: "陆游" },
  { text: "在你准备放弃的那一刻，往往离成功最近。", author: null },
  { text: "困难是化了妆的礼物。", author: null },
  { text: "没有到不了的明天。", author: null },
  { text: "冬天来了，春天还会远吗？", author: "雪莱" },
  { text: "你现在经历的，都会成为你未来的力量。", author: null },
];

// ═══════════════════════════════════════════════════════════════
// 8. 周期性名言（特殊时间点）
// ═══════════════════════════════════════════════════════════════
const PERIODIC_QUOTES = {
  monday: [
    { text: "新的一周，新的可能。", author: null },
    { text: "周一是重新开始的好时机。", author: null },
    { text: "这周，你想成为什么样的人？", author: null },
    { text: "每个周一都是52次重新开始的机会。", author: null },
  ],
  friday: [
    { text: "回顾这周，你离目标更近了一步。", author: null },
    { text: "这周的你，比上周的你更强了。", author: null },
  ],
  weekend: [
    { text: "周末是给灵魂充电的时间。", author: null },
    { text: "休息好，才能走得更远。", author: null },
    { text: "好好休息，也是一种自律。", author: null },
  ],
  month_start: [
    { text: "新的一月，新的篇章。", author: null },
    { text: "这个月，你想完成什么？", author: null },
  ],
  month_end: [
    { text: "月底了，回顾一下这个月的收获。", author: null },
    { text: "无论结果如何，感谢这个月努力的自己。", author: null },
  ],
};

// ═══════════════════════════════════════════════════════════════
// 智能选择算法
// ═══════════════════════════════════════════════════════════════

interface QuoteContext {
  hour: number;
  dayOfWeek: number;        // 0=周日, 1=周一, ...
  dayOfMonth: number;
  month: number;
  streak: number;
  checkedIn: boolean;
  weekProgress: number;     // 0-1
  subscribedSkills: string[];  // 用户订阅的 Skill
}

function selectQuote(context: QuoteContext): { text: string; author: string | null } {
  const {
    hour, dayOfWeek, dayOfMonth, month,
    streak, checkedIn, weekProgress, subscribedSkills
  } = context;

  let candidatePool: Array<{ text: string; author: string | null; weight: number }> = [];

  // 1. 周期性名言优先（特殊时间点）
  if (dayOfWeek === 1) {
    candidatePool.push(...PERIODIC_QUOTES.monday.map(q => ({ ...q, weight: 10 })));
  } else if (dayOfWeek === 5) {
    candidatePool.push(...PERIODIC_QUOTES.friday.map(q => ({ ...q, weight: 10 })));
  } else if (dayOfWeek === 0 || dayOfWeek === 6) {
    candidatePool.push(...PERIODIC_QUOTES.weekend.map(q => ({ ...q, weight: 10 })));
  }

  if (dayOfMonth <= 3) {
    candidatePool.push(...PERIODIC_QUOTES.month_start.map(q => ({ ...q, weight: 12 })));
  } else if (dayOfMonth >= 28) {
    candidatePool.push(...PERIODIC_QUOTES.month_end.map(q => ({ ...q, weight: 12 })));
  }

  // 2. 基于用户订阅 Skill 选择
  if (subscribedSkills.includes('jungian')) {
    candidatePool.push(...SELF_AWARENESS_QUOTES.map(q => ({ ...q, weight: 8 })));
  }

  // 3. 基于用户状态选择
  if (streak >= 7) {
    candidatePool.push(...PERSISTENCE_QUOTES.map(q => ({ ...q, weight: 8 })));
  }

  if (!checkedIn && hour >= 6 && hour < 12) {
    candidatePool.push(...ACTION_QUOTES.map(q => ({ ...q, weight: 8 })));
  }

  if (weekProgress >= 0.7) {
    candidatePool.push(...GROWTH_QUOTES.map(q => ({ ...q, weight: 6 })));
  }

  if (weekProgress < 0.3 && dayOfWeek >= 4) {
    candidatePool.push(...BREAKTHROUGH_QUOTES.map(q => ({ ...q, weight: 8 })));
  }

  if (hour >= 20 || dayOfWeek === 0 || dayOfWeek === 6) {
    candidatePool.push(...REST_QUOTES.map(q => ({ ...q, weight: 5 })));
  }

  // 4. 默认池补充
  candidatePool.push(...VISION_QUOTES.map(q => ({ ...q, weight: 3 })));
  candidatePool.push(...SELF_AWARENESS_QUOTES.map(q => ({ ...q, weight: 3 })));

  // 5. 加权随机选择（使用日期作为种子，同一天返回相同名言）
  const seed = new Date().toDateString();
  const totalWeight = candidatePool.reduce((sum, q) => sum + q.weight, 0);
  const targetWeight = (hashCode(seed) % totalWeight + totalWeight) % totalWeight;

  let cumulative = 0;
  for (const quote of candidatePool) {
    cumulative += quote.weight;
    if (cumulative >= targetWeight) {
      return { text: quote.text, author: quote.author };
    }
  }

  return VISION_QUOTES[0];
}

function hashCode(str: string): number {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    hash = ((hash << 5) - hash) + str.charCodeAt(i);
    hash |= 0;
  }
  return hash;
}
```

---

### 2. LifecoachCard (合并卡片)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              LifecoachCard                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   ┌──────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                          │  │
│   │  🧭 LIFECOACH                                                            │  │
│   │  ─────────────                                                           │  │
│   │                                                                          │  │
│   │  ⭐ 北极星: "{vision}"                                                   │  │
│   │                                                                          │  │
│   │  ┌──────────────────────────┐  ┌──────────────────────────┐             │  │
│   │  │  📊 月度项目              │  │  ☀️ 今日杠杆              │             │  │
│   │  │  {project_name}          │  │  □ {lever_1}              │             │  │
│   │  │  ████████░░░░░░ {%}     │  │  □ {lever_2}              │             │  │
│   │  │  还剩 {days} 天          │  │  □ {lever_3}              │             │  │
│   │  │                          │  │  ────────────             │             │  │
│   │  │                          │  │  进度: {done}/{total}     │             │  │
│   │  └──────────────────────────┘  └──────────────────────────┘             │  │
│   │                                                                          │  │
│   │  📅 本周大石头 ({done}/{total})                                          │  │
│   │  ┌────────────────────────────────────────────────────────────────────┐ │  │
│   │  │ ✓ {rock_1}  │  ○ {rock_2}  │  ○ {rock_3}  │  ○ {rock_4}           │ │  │
│   │  │  ({role})   │    ({role})  │    ({role})  │    ({role})           │ │  │
│   │  └────────────────────────────────────────────────────────────────────┘ │  │
│   │                                                                          │  │
│   └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│   子组件:                                                                        │
│   ├── NorthStarSection: 北极星愿景展示                                          │
│   ├── MonthlyProgressSection: 月度项目 + 进度条                                 │
│   │   └── ProgressBar: 进度条组件                                              │
│   ├── TodayLeversSection: 今日杠杆行动列表                                      │
│   │   └── LeverItem × n: 单个杠杆项                                            │
│   └── WeekRocksSection: 本周大石头                                              │
│       └── RockChip × n: 单个大石头标签                                          │
│                                                                                  │
│   交互:                                                                          │
│   ├── 点击 LeverItem → 勾选/取消勾选                                           │
│   ├── 点击 RockChip → 勾选/取消勾选                                            │
│   └── 点击北极星 → 进入 Lifecoach 对话                                          │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**LeverItem 状态变体:**

```
未完成:                      已完成:
┌────────────────────────┐   ┌────────────────────────┐
│ □ 完成3.2节初稿         │   │ ☑ 完成3.2节初稿         │
└────────────────────────┘   └────────────────────────┘
  默认样式                      文字划线 + 淡化
```

**RockChip 状态变体:**

```
未完成:                      已完成:
┌───────────────────┐        ┌───────────────────┐
│ ○ 周三带孩子       │        │ ✓ 完成3.2节初稿    │
│   (父亲)          │        │   (创作者)        │
└───────────────────┘        └───────────────────┘
  边框淡色                      边框绿色 + 背景淡绿
```

---

### 3. SkillCarousel (My Skills)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              SkillCarousel                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   ┌──────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                          │  │
│   │  🎯 MY SKILLS                                              ← 滑动 →     │  │
│   │  ─────────────                                                           │  │
│   │                                                                          │  │
│   │  ┌───────────────────┐ ┌───────────────────┐ ┌───────────────────┐      │  │
│   │  │                   │ │                   │ │                   │ ···  │  │
│   │  │  🎭 荣格原型洞察   │ │  🌙 八字今日运势   │ │  ⭐ 星座能量       │      │  │
│   │  │  ─────────────    │ │  ─────────────    │ │  ─────────────    │      │  │
│   │  │                   │ │                   │ │                   │      │  │
│   │  │  今日: 创造者     │ │  整体: ★★★★☆    │ │  水瓶座           │      │  │
│   │  │                   │ │  事业: ★★★★★    │ │                   │      │  │
│   │  │  💡 能量旺盛      │ │                   │ │  💫 灵感爆发日    │      │  │
│   │  │                   │ │  宜: 创作、学习   │ │                   │      │  │
│   │  │  ⚠️ 注意批评者    │ │  忌: 冲动消费     │ │                   │      │  │
│   │  │                   │ │                   │ │                   │      │  │
│   │  │ [与原型对话 →]   │ │ [查看详情 →]     │ │ [查看详情 →]     │      │  │
│   │  │                   │ │                   │ │                   │      │  │
│   │  └───────────────────┘ └───────────────────┘ └───────────────────┘      │  │
│   │                                                                          │  │
│   │                            ● ○ ○                                         │  │
│   │                                                                          │  │
│   └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│   子组件:                                                                        │
│   ├── CarouselHeader: 标题 + 滑动提示                                          │
│   ├── CarouselTrack: 横滑轨道容器                                              │
│   │   └── SkillCard × n: 已订阅 Skill 卡片                                     │
│   └── CarouselIndicator: 圆点指示器                                            │
│                                                                                  │
│   Props:                                                                         │
│   ├── skills: SkillCardData[]                                                  │
│   ├── onCardClick: (skillId: string) => void                                   │
│   └── cardWidth: number (default 280)                                          │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**SkillCard 组件详图:**

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              SkillCard                                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   通用型 (荣格/塔罗等):                                                         │
│   ┌───────────────────────────────┐                                            │
│   │                               │                                            │
│   │  🎭 荣格原型洞察               │  ← icon + title                            │
│   │  ─────────────────────        │                                            │
│   │                               │                                            │
│   │  今日主导: 创造者              │  ← content.headline                        │
│   │                               │                                            │
│   │  💡 创意能量旺盛               │  ← content.insights[0]                     │
│   │  适合完成创作性工作            │                                            │
│   │                               │                                            │
│   │  ⚠️ 注意内在批评者             │  ← content.insights[1]                     │
│   │                               │                                            │
│   │  ─────────────────────        │                                            │
│   │                               │                                            │
│   │  [ 与原型对话 → ]              │  ← actionLabel                             │
│   │                               │                                            │
│   └───────────────────────────────┘                                            │
│                                                                                  │
│   ─────────────────────────────────────────────────────────────────────────     │
│                                                                                  │
│   评分型 (八字/星座):                                                           │
│   ┌───────────────────────────────┐                                            │
│   │                               │                                            │
│   │  🌙 八字今日运势               │                                            │
│   │  ─────────────────────        │                                            │
│   │                               │                                            │
│   │  整体: ★★★★☆ 良好            │  ← content.rating.label                    │
│   │  ─────────────────────        │                                            │
│   │  事业: ★★★★★ 贵人相助        │  ← content.rating.details                  │
│   │  感情: ★★★☆☆ 平稳            │                                            │
│   │  健康: ★★★★☆ 稳定            │                                            │
│   │  ─────────────────────        │                                            │
│   │  宜: 创作、学习、见客户       │  ← content.suggestions.do                  │
│   │  忌: 冲动消费、情绪决策       │  ← content.suggestions.avoid               │
│   │                               │                                            │
│   │  [ 查看详情 → ]               │                                            │
│   │                               │                                            │
│   └───────────────────────────────┘                                            │
│                                                                                  │
│   TypeScript 接口:                                                               │
│   interface SkillCardProps {                                                     │
│     skillId: string;                                                            │
│     icon: string;                                                               │
│     title: string;                                                              │
│     content: SkillCardContent;                                                  │
│     actionLabel: string;                                                        │
│     actionRoute: string;                                                        │
│     onClick?: () => void;                                                       │
│   }                                                                             │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

### 4. DiscoverCarousel (发现更多)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              DiscoverCarousel                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   ┌──────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                          │  │
│   │  ✨ 发现更多                                               ← 滑动 →     │  │
│   │  ──────────                                                              │  │
│   │                                                                          │  │
│   │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────┐│  │
│   │  │                 │ │                 │ │                 │ │         ││  │
│   │  │  🔮 塔罗        │ │  🧘 冥想        │ │  💰 财富        │ │  ❤️ 关系 ││  │
│   │  │  ─────────      │ │  ─────────      │ │  ─────────      │ │ ─────── ││  │
│   │  │  每日一牌       │ │  正念指导       │ │  理财建议       │ │ 亲密关系││  │
│   │  │  洞察潜意识     │ │  减压放松       │ │  财务自由       │ │ 关系改善││  │
│   │  │                 │ │                 │ │                 │ │         ││  │
│   │  │  [ + 订阅 ]     │ │  [ + 订阅 ]     │ │  [ + 订阅 ]     │ │[+ 订阅] ││  │
│   │  │                 │ │                 │ │                 │ │         ││  │
│   │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────┘│  │
│   │                                                                          │  │
│   │                            ● ○ ○ ○                                       │  │
│   │                                                                          │  │
│   └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│   子组件:                                                                        │
│   ├── CarouselHeader: 标题 + 滑动提示                                          │
│   ├── CarouselTrack: 横滑轨道容器                                              │
│   │   └── DiscoverCard × n: 未订阅 Skill 卡片                                  │
│   └── CarouselIndicator: 圆点指示器                                            │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**DiscoverCard 组件详图:**

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              DiscoverCard                                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   ┌─────────────────────┐                                                       │
│   │                     │                                                       │
│   │  🔮 塔罗             │  ← icon + title                                       │
│   │  ─────────────      │                                                       │
│   │  每日一牌           │  ← tagline                                            │
│   │  洞察潜意识         │  ← description                                        │
│   │                     │                                                       │
│   │  ─────────────      │                                                       │
│   │                     │                                                       │
│   │  [ + 订阅 ]         │  ← subscribe button                                   │
│   │                     │                                                       │
│   └─────────────────────┘                                                       │
│                                                                                  │
│   状态变体:                                                                      │
│                                                                                  │
│   Default:              Hover:                   Subscribing:                    │
│   ┌─────────────┐       ┌─────────────┐         ┌─────────────┐                │
│   │  🔮 塔罗    │       │  🔮 塔罗    │         │  🔮 塔罗    │                │
│   │  ─────     │       │  ─────     │  scale  │  ─────     │                │
│   │  每日一牌  │  ──▶  │  每日一牌  │  1.02   │  ⏳ 订阅中...│                │
│   │            │       │            │         │            │                │
│   │ [ + 订阅 ] │       │ [ + 订阅 ] │         │ [ ······ ] │                │
│   └─────────────┘       └─────────────┘         └─────────────┘                │
│     虚线边框              边框高亮                 加载状态                       │
│                                                                                  │
│   TypeScript 接口:                                                               │
│   interface DiscoverCardProps {                                                  │
│     skillId: string;                                                            │
│     icon: string;                                                               │
│     title: string;                                                              │
│     tagline: string;                                                            │
│     description: string;                                                        │
│     onSubscribe: (skillId: string) => Promise<void>;                            │
│   }                                                                             │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

### 5. CarouselTrack (通用横滑组件)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              CarouselTrack                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   ┌──────────────────────────────────────────────────────────────────────────┐  │
│   │                                                                          │  │
│   │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │  │
│   │  │         │ │         │ │         │ │         │ │         │ ···       │  │
│   │  │ Card 1  │ │ Card 2  │ │ Card 3  │ │ Card 4  │ │ Card 5  │           │  │
│   │  │         │ │         │ │         │ │         │ │         │           │  │
│   │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘           │  │
│   │  ◀───────────────────── 可滑动区域 ─────────────────────▶               │  │
│   │                                                                          │  │
│   └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│   实现方式:                                                                      │
│   ├── CSS: overflow-x: auto + scroll-snap-type: x mandatory                    │
│   ├── 每个卡片: scroll-snap-align: start                                       │
│   └── 隐藏滚动条: scrollbar-hide                                               │
│                                                                                  │
│   交互增强:                                                                      │
│   ├── Touch: 原生滑动                                                          │
│   ├── Mouse: 可拖拽 (optional)                                                 │
│   └── 边缘提示: 下一张卡片露出 20px                                             │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**Tailwind 实现:**

```tsx
// src/components/dashboard/shared/CarouselTrack.tsx

interface CarouselTrackProps {
  children: React.ReactNode;
  gap?: number;       // default 16
  padding?: number;   // default 16
  className?: string;
}

const CarouselTrack: React.FC<CarouselTrackProps> = ({
  children,
  gap = 16,
  padding = 16,
  className
}) => {
  return (
    <div
      className={cn(
        "overflow-x-auto scrollbar-hide",
        "snap-x snap-mandatory",
        "-mx-4 px-4",  // 负边距 + 内边距实现边缘露出
        className
      )}
      style={{
        scrollPaddingLeft: padding,
        scrollPaddingRight: padding
      }}
    >
      <div
        className="flex"
        style={{ gap }}
      >
        {React.Children.map(children, (child) => (
          <div className="flex-shrink-0 snap-start">
            {child}
          </div>
        ))}
      </div>
    </div>
  );
};
```

---

## 响应式布局矩阵

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              响应式断点                                          │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   Mobile (<640px)                                                                │
│   ═══════════════                                                                │
│                                                                                  │
│   ┌─────────────────────────┐                                                   │
│   │      AmbientHeader      │                                                   │
│   ├─────────────────────────┤                                                   │
│   │      LifecoachCard      │  ← 垂直布局 (月度 → 今日 → 本周)                  │
│   ├─────────────────────────┤                                                   │
│   │    SkillCarousel        │  ← 1.5 张可见                                     │
│   ├─────────────────────────┤                                                   │
│   │    DiscoverCarousel     │  ← 2.5 张可见                                     │
│   ├─────────────────────────┤                                                   │
│   │     MobileBottomNav     │                                                   │
│   └─────────────────────────┘                                                   │
│                                                                                  │
│   Tablet (640px - 1024px)                                                        │
│   ═══════════════════════════                                                    │
│                                                                                  │
│   ┌─────────────────────────────────────────────┐                               │
│   │              AmbientHeader                  │                               │
│   ├─────────────────────────────────────────────┤                               │
│   │            LifecoachCard                    │  ← 2列布局 (月度|今日)         │
│   ├─────────────────────────────────────────────┤                               │
│   │          SkillCarousel                      │  ← 2 张可见                   │
│   ├─────────────────────────────────────────────┤                               │
│   │         DiscoverCarousel                    │  ← 3 张可见                   │
│   └─────────────────────────────────────────────┘                               │
│                                                                                  │
│   Desktop (>1024px)                                                              │
│   ═════════════════════                                                          │
│                                                                                  │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │                           AmbientHeader                                  │   │
│   ├─────────────────────────────────────────────────────────────────────────┤   │
│   │                          LifecoachCard                                   │   │
│   │  ┌─────────────────────────────┬─────────────────────────────────────┐  │   │
│   │  │        月度项目             │          今日杠杆                    │  │   │
│   │  └─────────────────────────────┴─────────────────────────────────────┘  │   │
│   │  ┌───────────────────────────────────────────────────────────────────┐  │   │
│   │  │                         本周大石头                                 │  │   │
│   │  └───────────────────────────────────────────────────────────────────┘  │   │
│   ├─────────────────────────────────────────────────────────────────────────┤   │
│   │                          SkillCarousel                                   │   │
│   │  ← 3 张可见，右侧露出提示 →                                              │   │
│   ├─────────────────────────────────────────────────────────────────────────┤   │
│   │                         DiscoverCarousel                                 │   │
│   │  ← 4 张可见，右侧露出提示 →                                              │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 动画规格

```typescript
// src/lib/dashboard/animations.ts

export const animations = {
  // 卡片入场
  cardEnter: {
    initial: { opacity: 0, y: 20 },
    animate: { opacity: 1, y: 0 },
    transition: { duration: 0.3, ease: [0.4, 0, 0.2, 1] }
  },

  // 卡片悬停
  cardHover: {
    scale: 1.02,
    y: -2,
    transition: { duration: 0.2, ease: "easeOut" }
  },

  // 签到动画
  checkIn: {
    scale: [1, 1.2, 1],
    transition: { duration: 0.5, ease: "easeInOut" }
  },

  // 数字跳动
  numberBounce: {
    scale: [1, 1.3, 1],
    transition: { duration: 0.3, ease: "easeOut" }
  },

  // 进度条填充
  progressFill: {
    initial: { scaleX: 0 },
    animate: { scaleX: 1 },
    transition: { duration: 0.8, ease: [0.4, 0, 0.2, 1] }
  },

  // 横滑吸附
  snapScroll: {
    transition: {
      type: "spring",
      stiffness: 300,
      damping: 30
    }
  },

  // 订阅成功
  subscribeSuccess: {
    scale: [1, 1.1, 1],
    backgroundColor: ["#fff", "#dcfce7", "#fff"],
    transition: { duration: 0.6 }
  }
};
```

**签到按钮动画序列:**

```
点击 "签到" 按钮:

Frame 0 (0ms):        Frame 1 (100ms):      Frame 2 (300ms):      Frame 3 (500ms):
┌─────────────┐       ┌─────────────┐       ┌─────────────┐       ┌─────────────┐
│   [ 签到 ]  │  ──▶  │  ●          │  ──▶  │     ✨      │  ──▶  │   🔥 8天    │
└─────────────┘       └─────────────┘       │   🔥 8天    │       │             │
                      loading 动画           │     ✨      │       │   太棒了！  │
                                            └─────────────┘       └─────────────┘
                                            数字跳动 7→8          完成状态
```

---

## 错误边界与降级

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              错误处理策略                                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   场景 1: 数据加载失败                                                           │
│   ────────────────────                                                           │
│                                                                                  │
│   ┌──────────────────────────────────────────┐                                  │
│   │                                          │                                  │
│   │         ⚠️ 加载数据时出错                │                                  │
│   │                                          │                                  │
│   │         请稍后再试                        │                                  │
│   │                                          │                                  │
│   │         [ 重试 ]                         │                                  │
│   │                                          │                                  │
│   └──────────────────────────────────────────┘                                  │
│                                                                                  │
│   场景 2: Skill Card 加载失败                                                    │
│   ────────────────────────                                                       │
│                                                                                  │
│   ┌───────────────────┐ ┌───────────────────┐ ┌───────────────────┐            │
│   │                   │ │                   │ │                   │            │
│   │  🎭 荣格原型       │ │  ⚠️ 加载失败       │ │  ⭐ 星座能量       │            │
│   │  今日: 创造者     │ │                   │ │  水瓶座           │            │
│   │  ...             │ │  [ 重试 ]         │ │  ...             │            │
│   │                   │ │                   │ │                   │            │
│   └───────────────────┘ └───────────────────┘ └───────────────────┘            │
│                                                                                  │
│   单个卡片失败不影响其他卡片                                                      │
│                                                                                  │
│   场景 3: 网络离线                                                               │
│   ────────────────────                                                           │
│                                                                                  │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │  📶 当前离线 - 显示缓存数据                                              │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│   使用 SWR 的 fallbackData 显示上次成功获取的数据                                │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## Hooks

```typescript
// src/hooks/useDashboard.ts

import useSWR from 'swr';

export function useDashboard() {
  const { data, error, isLoading, mutate } = useSWR<DashboardDTO>(
    '/api/dashboard',
    fetcher,
    {
      revalidateOnFocus: false,
      dedupingInterval: 60000,
    }
  );

  const checkIn = async () => {
    // 乐观更新
    mutate(
      {
        ...data!,
        status: { ...data!.status, checkedIn: true, streak: data!.status.streak + 1 }
      },
      false
    );

    const result = await api.post('/api/dashboard/checkin');
    mutate();
    return result;
  };

  const toggleLever = async (leverId: string) => {
    // 乐观更新
    const newLevers = data!.lifecoach.todayLevers.map(l =>
      l.id === leverId ? { ...l, completed: !l.completed } : l
    );
    mutate(
      { ...data!, lifecoach: { ...data!.lifecoach, todayLevers: newLevers } },
      false
    );

    await api.patch(`/api/dashboard/lever/${leverId}`);
    mutate();
  };

  return {
    data,
    error,
    isLoading,
    checkIn,
    toggleLever,
  };
}

// src/hooks/useCarousel.ts

export function useCarousel(itemCount: number) {
  const [currentIndex, setCurrentIndex] = useState(0);
  const containerRef = useRef<HTMLDivElement>(null);

  const scrollTo = (index: number) => {
    if (containerRef.current) {
      const scrollLeft = index * (cardWidth + gap);
      containerRef.current.scrollTo({ left: scrollLeft, behavior: 'smooth' });
      setCurrentIndex(index);
    }
  };

  const handleScroll = useCallback(() => {
    if (containerRef.current) {
      const index = Math.round(containerRef.current.scrollLeft / (cardWidth + gap));
      setCurrentIndex(index);
    }
  }, []);

  return {
    containerRef,
    currentIndex,
    scrollTo,
    handleScroll,
  };
}
```

---

> **Version**: 2.0 | 2026-01-19
