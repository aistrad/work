# VibeLife Agent æ¡†æ¶å®æ–½è®¡åˆ’

> âš ï¸ **DEPRECATED** - æ­¤æ–‡æ¡£æè¿°çš„æ˜¯ V4 æ¶æ„ï¼ˆOrchestrator + SkillAgentsï¼‰ï¼Œå·²è¢« V5 æ¶æ„å–ä»£ã€‚
>
> **V5 æ¶æ„æ–‡æ¡£**ï¼š
> - `llm-architecture-v5.md` - V5 æ¶æ„è®¾è®¡
> - `apps/api/skills/README.md` - Skills æ¶æ„è¯´æ˜
> - `apps/api/services/agent/core.py` - CoreAgent å®ç°
> - `apps/api/services/agent/skill_loader.py` - SkillLoader å®ç°

---

> ç‰ˆæœ¬ï¼šv1.0 (DEPRECATED)
> æ—¥æœŸï¼š2026-01-11
> ç›®æ ‡ï¼šæ„å»ºé€šç”¨çš„ Orchestrator + Skill Agents æ¡†æ¶

---

## ä¸€ã€èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 èƒŒæ™¯

åŸºäºæ·±åº¦è®¿è°ˆå’Œä»£ç åˆ†æï¼ŒVibeLife éœ€è¦ä¸€ä¸ªé€šç”¨çš„ Agent æ¡†æ¶æ¥ï¼š
- è§£å†³å¤æ‚é—®é¢˜ï¼ˆå¤šç»´åº¦åˆ†æï¼‰
- æ”¯æŒ Skill å¯æ’æ‹”
- ç»Ÿä¸€è®¡è´¹ï¼ˆç»Ÿè®¡æ¨¡å‹ã€è°ƒç”¨æ¬¡æ•°ã€tokenï¼‰
- ä¸ Vercel AI SDK 6 æ·±åº¦é›†æˆ

### 1.2 ç›®æ ‡

1. **é€šç”¨èŒƒå¼**ï¼šæˆä¸ºè§£å†³å¤æ‚é—®é¢˜çš„é€šç”¨æ¶æ„
2. **Skill å¯æ’æ‹”**ï¼šæ–°å¢ Skill åªéœ€å®ç°æ¥å£å¹¶æ³¨å†Œ
3. **è®¡è´¹å‡†å¤‡**ï¼šç»Ÿä¸€è®°å½•æ‰€æœ‰ LLM è°ƒç”¨ï¼Œä¸ºç²¾ç»†è®¡è´¹åšå‡†å¤‡
4. **ç”¨æˆ·ä½“éªŒ**ï¼šæ€è€ƒè¿‡ç¨‹å¯è§ï¼Œä¸­é€”å¯äº¤äº’

---

## äºŒã€æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        VibeLife Agent Framework                             â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         Orchestrator Agent                             â”‚ â”‚
â”‚  â”‚  â€¢ ç†è§£ç”¨æˆ·é—®é¢˜ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ Agent æµç¨‹                               â”‚ â”‚
â”‚  â”‚  â€¢ æ ¹æ®ç”¨æˆ·è®¢é˜…çŠ¶æ€ç¡®å®šå¯ç”¨ Skill èŒƒå›´                                 â”‚ â”‚
â”‚  â”‚  â€¢ è‡ªåŠ¨é€‰æ‹© Skill æˆ–å“åº”ç”¨æˆ·æŒ‡å®š                                       â”‚ â”‚
â”‚  â”‚  â€¢ åè°ƒå¤š Skill Agent è°ƒç”¨                                             â”‚ â”‚
â”‚  â”‚  â€¢ ç»Ÿä¸€è®°å½•è°ƒç”¨æ¬¡æ•°å’Œ token æ¶ˆè€—                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚              â”‚                       â”‚                       â”‚              â”‚
â”‚              â–¼                       â–¼                       â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Bazi Skill Agent  â”‚ â”‚ Zodiac Skill Agent  â”‚ â”‚  Future Skill Agent â”‚   â”‚
â”‚  â”‚   (å¯æ’æ‹”)          â”‚ â”‚   (å¯æ’æ‹”)          â”‚ â”‚   (MBTI/å¡”ç½—/...)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         Fusion Agent                                   â”‚ â”‚
â”‚  â”‚  â€¢ ç›¸äº’å°è¯å‹æ´å¯Ÿ â€¢ å¯¹æ¯”å¼ åŠ›å‹æ´å¯Ÿ â€¢ ç»¼åˆå»ºè®®å‹æ´å¯Ÿ â€¢ å…ƒç´ å…³è”å‹æ´å¯Ÿ   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Usage Tracking Layer                              â”‚ â”‚
â”‚  â”‚  â€¢ ç»Ÿè®¡æ¯æ¬¡ LLM è°ƒç”¨ â€¢ è®°å½•æ¨¡å‹ã€è°ƒç”¨æ¬¡æ•°ã€token â€¢ ä¸ºç²¾ç»†è®¡è´¹å‡†å¤‡      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              å‰ç«¯ (Next.js)                                 â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  useAgentChat Hook (æ‰©å±• useChat)                                    â”‚   â”‚
â”‚  â”‚  â€¢ å¤„ç† agent_thinking äº‹ä»¶                                          â”‚   â”‚
â”‚  â”‚  â€¢ å¤„ç† agent_interaction äº‹ä»¶                                       â”‚   â”‚
â”‚  â”‚  â€¢ æ¸²æŸ“ AgentStatus ç»„ä»¶                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  /api/chat/route.ts (æ‰©å±•)                                           â”‚   â”‚
â”‚  â”‚  â€¢ è¯†åˆ« agent_* äº‹ä»¶ç±»å‹                                             â”‚   â”‚
â”‚  â”‚  â€¢ è½¬æ¢ä¸º AI SDK 6 UIMessageChunk                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              åç«¯ (FastAPI)                                 â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  /api/v1/agent/stream (æ–°å¢)                                         â”‚   â”‚
â”‚  â”‚  â€¢ æ¥æ”¶ Agent è¯·æ±‚                                                   â”‚   â”‚
â”‚  â”‚  â€¢ è°ƒç”¨ OrchestratorAgent                                            â”‚   â”‚
â”‚  â”‚  â€¢ æµå¼è¿”å› SSE äº‹ä»¶                                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  OrchestratorAgent                                                   â”‚   â”‚
â”‚  â”‚  â€¢ ä½¿ç”¨ model_router é€‰æ‹©æ¨¡å‹                                        â”‚   â”‚
â”‚  â”‚  â€¢ ä½¿ç”¨ QuotaManager æ£€æŸ¥é…é¢                                        â”‚   â”‚
â”‚  â”‚  â€¢ ä½¿ç”¨ record_completion è®°å½•ä½¿ç”¨é‡                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æ¥å£è®¾è®¡

### 3.1 SkillPlugin æ‰©å±•ï¼ˆå‰ç«¯ï¼‰

```typescript
// apps/web/src/skills/types.ts

export interface SkillAgentConfig {
  /** Skill çš„åˆ†æèƒ½åŠ›æè¿°ï¼Œä¾› Orchestrator é€‰æ‹© */
  capabilities: string[];

  /** Skill çš„åˆ†æ Prompt æ¨¡æ¿ */
  analysisPrompt: string;

  /** ä¸æ­¤ Skill ç›¸å…³çš„å…¶ä»– Skillï¼Œç”¨äºäº¤å‰åˆ†æ */
  relatedSkills: SkillId[];

  /** Skill çš„ä¼˜å…ˆçº§ï¼Œå¤š Skill æ—¶çš„è°ƒç”¨é¡ºåº */
  priority?: number;

  /** Skill æ˜¯å¦æ”¯æŒ Agent æ¨¡å¼ */
  agentEnabled?: boolean;
}

export interface SkillPlugin {
  // ... ç°æœ‰å­—æ®µ ...

  /** Agent é…ç½®ï¼ˆå¯é€‰ï¼Œä¸é…ç½®åˆ™ä¸æ”¯æŒ Agent æ¨¡å¼ï¼‰ */
  agent?: SkillAgentConfig;
}
```

### 3.2 SkillAgent æ¥å£ï¼ˆåç«¯ï¼‰

```python
# apps/api/services/agent/skill_agent.py

from abc import ABC, abstractmethod
from dataclasses import dataclass
from typing import List, Dict, Any, Optional

@dataclass
class SkillAgentConfig:
    """Skill Agent é…ç½®"""
    skill_id: str
    capabilities: List[str]
    analysis_prompt: str
    related_skills: List[str]
    priority: int = 50

@dataclass
class AnalysisResult:
    """åˆ†æç»“æœ"""
    skill_id: str
    summary: str
    insights: List[Dict[str, Any]]
    confidence: float
    tokens_used: int
    model_used: str

class SkillAgent(ABC):
    """Skill Agent åŸºç±» - å¯æ’æ‹”"""

    @property
    @abstractmethod
    def config(self) -> SkillAgentConfig:
        """è¿”å› Skill é…ç½®"""
        pass

    @abstractmethod
    async def analyze(
        self,
        user_id: str,
        question: str,
        context: Dict[str, Any]
    ) -> AnalysisResult:
        """æ‰§è¡Œåˆ†æ"""
        pass

    @abstractmethod
    async def get_user_data(self, user_id: str) -> Dict[str, Any]:
        """è·å–ç”¨æˆ·åœ¨æ­¤ Skill çš„æ•°æ®"""
        pass
```

### 3.3 SSE äº‹ä»¶ç±»å‹

```python
# Agent ç›¸å…³ SSE äº‹ä»¶

# æ€è€ƒçŠ¶æ€
{"type": "agent_thinking", "content": "ğŸ”® æ­£åœ¨ä»å…«å­—è§’åº¦åˆ†æ...", "skill_id": "bazi"}

# äº¤äº’è¯·æ±‚
{"type": "agent_interaction", "question": "è¿™ä¸ªè§’åº¦ä½ æƒ³æ·±å…¥å—ï¼Ÿ", "options": ["æ·±å…¥", "ç»§ç»­"]}

# åˆ†æç»“æœ
{"type": "agent_result", "skill_id": "bazi", "summary": "...", "insights": [...]}

# èåˆç»“æœ
{"type": "agent_fusion", "summary": "...", "insights": [...]}
```

---

## å››ã€å®æ–½æ­¥éª¤

### Phase 1ï¼šåŸºç¡€æ¡†æ¶ï¼ˆåç«¯ï¼‰

| ä»»åŠ¡ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| 1.1 åˆ›å»º Agent æ¨¡å—ç›®å½• | `apps/api/services/agent/` | æ–°å»ºç›®å½•ç»“æ„ |
| 1.2 å®ç° SkillAgent åŸºç±» | `apps/api/services/agent/skill_agent.py` | å®šä¹‰æ¥å£ |
| 1.3 å®ç° UsageTracker | `apps/api/services/agent/usage_tracker.py` | ç»Ÿä¸€ä½¿ç”¨é‡è¿½è¸ª |
| 1.4 å®ç° SkillAgentRegistry | `apps/api/services/agent/registry.py` | Skill Agent æ³¨å†Œä¸­å¿ƒ |
| 1.5 å®ç° OrchestratorAgent | `apps/api/services/agent/orchestrator.py` | ä¸»åè°ƒ Agent |

### Phase 2ï¼šSkill Agent å®ç°

| ä»»åŠ¡ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| 2.1 å®ç° BaziSkillAgent | `apps/api/services/agent/skills/bazi_agent.py` | å…«å­—åˆ†æ Agent |
| 2.2 å®ç° ZodiacSkillAgent | `apps/api/services/agent/skills/zodiac_agent.py` | æ˜Ÿåº§åˆ†æ Agent |
| 2.3 å®ç° FusionAgent | `apps/api/services/agent/fusion_agent.py` | èåˆåˆ†æ Agent |

### Phase 3ï¼šAPI è·¯ç”±

| ä»»åŠ¡ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| 3.1 åˆ›å»º Agent è·¯ç”± | `apps/api/routes/agent.py` | /api/v1/agent/stream |
| 3.2 æ³¨å†Œè·¯ç”± | `apps/api/main.py` | æ·»åŠ è·¯ç”±æ³¨å†Œ |

### Phase 4ï¼šå‰ç«¯é›†æˆ

| ä»»åŠ¡ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| 4.1 æ‰©å±• SkillPlugin ç±»å‹ | `apps/web/src/skills/types.ts` | æ·»åŠ  agent å­—æ®µ |
| 4.2 æ›´æ–° Bazi é…ç½® | `apps/web/src/skills/bazi/config.ts` | æ·»åŠ  agent é…ç½® |
| 4.3 æ›´æ–° Zodiac é…ç½® | `apps/web/src/skills/zodiac/config.ts` | æ·»åŠ  agent é…ç½® |
| 4.4 åˆ›å»º AgentStatus ç»„ä»¶ | `apps/web/src/components/agent/AgentStatus.tsx` | æ€è€ƒçŠ¶æ€å±•ç¤º |
| 4.5 æ‰©å±• chat route | `apps/web/src/app/api/chat/route.ts` | å¤„ç† agent_* äº‹ä»¶ |
| 4.6 åˆ›å»º useAgentChat Hook | `apps/web/src/hooks/useAgentChat.ts` | Agent èŠå¤© Hook |

### Phase 5ï¼šæµ‹è¯•ä¸ä¼˜åŒ–

| ä»»åŠ¡ | è¯´æ˜ |
|------|------|
| 5.1 å•å…ƒæµ‹è¯• | æµ‹è¯•å„ Agent ç»„ä»¶ |
| 5.2 é›†æˆæµ‹è¯• | æµ‹è¯•å®Œæ•´æµç¨‹ |
| 5.3 æ€§èƒ½ä¼˜åŒ– | å¹¶è¡Œè°ƒç”¨ã€Context è£å‰ª |

---

## äº”ã€ä¸ç°æœ‰ç³»ç»Ÿé›†æˆç‚¹

### 5.1 Model Router é›†æˆ

```python
# åœ¨ OrchestratorAgent ä¸­ä½¿ç”¨ model_router

from services.model_router import chat as model_router_chat
from services.model_router.router import get_model_router

class OrchestratorAgent:
    async def _call_llm(self, messages, user_id, user_tier, skill, task):
        # ä½¿ç”¨ model_router ç»Ÿä¸€è°ƒç”¨
        response = await model_router_chat(
            messages=messages,
            capability="analysis",
            user_id=user_id,
            user_tier=user_tier,
            skill=skill,
            task=task
        )
        return response
```

### 5.2 AI SDK 6 é›†æˆ

```typescript
// æ‰©å±• chat route å¤„ç† agent äº‹ä»¶

// apps/web/src/app/api/chat/route.ts
if (data.type === 'agent_thinking') {
  controller.enqueue({
    type: 'text-delta',
    id: currentTextPartId,
    delta: `\n${data.content}\n`,
  });
} else if (data.type === 'agent_result') {
  // æ¸²æŸ“åˆ†æç»“æœå¡ç‰‡
  controller.enqueue({
    type: 'tool-output-available',
    toolCallId: `agent-${data.skill_id}`,
    output: data,
  });
}
```

---

## å…­ã€æ–‡ä»¶ç»“æ„

```
apps/api/services/agent/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ skill_agent.py           # Skill Agent åŸºç±»
â”œâ”€â”€ orchestrator.py          # Orchestrator Agent
â”œâ”€â”€ fusion_agent.py          # Fusion Agent
â”œâ”€â”€ usage_tracker.py         # ä½¿ç”¨é‡è¿½è¸ª
â”œâ”€â”€ registry.py              # Skill Agent æ³¨å†Œä¸­å¿ƒ
â””â”€â”€ skills/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ bazi_agent.py        # å…«å­— Skill Agent
    â””â”€â”€ zodiac_agent.py      # æ˜Ÿåº§ Skill Agent

apps/web/src/
â”œâ”€â”€ components/agent/
â”‚   â”œâ”€â”€ AgentStatus.tsx      # æ€è€ƒçŠ¶æ€ç»„ä»¶
â”‚   â””â”€â”€ AgentInteraction.tsx # äº¤äº’èŠ‚ç‚¹ç»„ä»¶
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useAgentChat.ts      # Agent èŠå¤© Hook
â””â”€â”€ skills/
    â””â”€â”€ types.ts             # æ‰©å±• SkillAgentConfig
```

---

## ä¸ƒã€éªŒæ”¶æ ‡å‡†

### 7.1 åŠŸèƒ½éªŒæ”¶

- [ ] ç”¨æˆ·å¯ä»¥è§¦å‘ Agent æ·±åº¦åˆ†æ
- [ ] æ€è€ƒè¿‡ç¨‹å¯è§ï¼ˆç®€æ´çŠ¶æ€æ ‡ç­¾ï¼‰
- [ ] æ”¯æŒå¤š Skill èåˆåˆ†æ
- [ ] æ–°å¢ Skill åªéœ€å®ç°æ¥å£å¹¶æ³¨å†Œ

### 7.2 æŠ€æœ¯éªŒæ”¶

- [ ] æ‰€æœ‰ LLM è°ƒç”¨é€šè¿‡ model_router
- [ ] ä½¿ç”¨é‡æ­£ç¡®è®°å½•ï¼ˆæ¨¡å‹ã€è°ƒç”¨æ¬¡æ•°ã€tokenï¼‰
- [ ] ä¸ AI SDK 6 æ­£ç¡®é›†æˆ
- [ ] æ— æ€§èƒ½å›å½’

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0*
*åˆ›å»ºæ—¥æœŸï¼š2026-01-11*
