# VibeLife 用户场景分析与系统优化报告

> **版本**: 1.0
> **日期**: 2026-01-07
> **分析范围**: 13 个核心用户场景 vs 系统实现能力

---

## 1. 执行摘要

### 1.1 关键发现

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                                                                               ║
║   13 个用户场景覆盖度分析结果                                                   ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   ✅ 可满足 (基础能力已实现):     3 个场景 (23%)                               ║
║   ⚠️ 需完善 (框架有/功能弱):      5 个场景 (38%)                               ║
║   ❌ 需新建 (完全缺失):           5 个场景 (38%)                               ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   核心阻塞问题:                                                                ║
║   1. 知识库严重缺失 (仅1个测试文件) → 无法提供专业解读                          ║
║   2. 主动推送未闭环 → 差异化价值无法体现                                        ║
║   3. 可视化组件缺失 → 用户期望的"图表"无法实现                                  ║
║   4. 行动追踪系统缺失 → "如何改变"类场景全部无法满足                            ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

### 1.2 Top 5 紧急任务

| 优先级 | 任务 | 影响场景 | 工作量 |
|-------|------|---------|-------|
| **P0-1** | 知识库内容建设 (八字+星座) | 场景 1,2,4,10 | 2-3周 |
| **P0-2** | 主动推送系统完善 | 场景 5 (核心差异化) | 1周 |
| **P0-3** | 情绪急救 SOS 模式 | 场景 11 (高价值场景) | 3天 |
| **P1-1** | 每日微行动系统 | 场景 7 (高频使用) | 1周 |
| **P1-2** | 可视化图表组件 | 场景 1,3 (用户期望) | 1周 |

---

## 2. 用户场景覆盖度详细分析

### 2.1 认识自我 (3个场景)

#### 场景 1: 深度自我认知 (BaZi)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 用户诉求                                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ Alex 想了解本质，明白为何内心总有与外在表现不符的纠结感。                       │
│                                                                             │
│ 用户期望:                                                                   │
│ • 不想要晦涩的术语（如"财滋弱杀"）                                           │
│ • 想要能看懂的图表                                                          │
│ • 解释清楚内在与外在的反差                                                   │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 系统能力评估                                            评分: ⚠️ 需完善 (60%) │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ✅ 已实现:                                                                  │
│    • 八字排盘计算 (tools/bazi/calculator.py - 541行)                        │
│    • Persona 现代化表达风格定义 (agent/persona.py)                          │
│    • 对话系统基础框架                                                       │
│                                                                             │
│ ⚠️ 部分实现:                                                                │
│    • 现代化语言解读 - Persona定义有，但知识库几乎为空                         │
│    • "内外反差"解读 - 需要十神组合知识支撑                                   │
│                                                                             │
│ ❌ 未实现:                                                                  │
│    • 可视化图表 - 用户期望的"能看懂的图表"                                   │
│    • 命盘交互组件 - DeductionBridge 推演动画                                │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ 差距分析                                                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ 1. 知识库差距 (严重)                                                        │
│    当前: knowledge/bazi/ 仅1个测试文件 (2KB)                                │
│    需要: 十神详解、格局分析、性格解读框架 (~50KB)                            │
│                                                                             │
│ 2. 可视化差距 (中等)                                                        │
│    当前: 无图表组件                                                         │
│    需要: BaziChart 可视化组件                                               │
│                                                                             │
│ 3. 内外反差解读 (需知识支撑)                                                │
│    • 外在 = 年柱/月柱表现                                                   │
│    • 内在 = 日柱/时柱本性                                                   │
│    • 需要专业知识库支撑此类解读                                             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**满足此场景需要:**
1. 八字知识库建设 (十神详解、格局分析)
2. BaziChart 可视化组件
3. 性格解读框架 (内外对比)

---

#### 场景 2: 情绪模式识别 (Zodiac)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 用户诉求                                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ Chloe 陷入情绪死循环（如等待消息时的焦虑），想知道原因。                        │
│                                                                             │
│ 用户期望:                                                                   │
│ • 被"看见"和"理解"                                                          │
│ • 指出没意识到的潜意识模式                                                   │
│ • 不是泛泛的性格描述                                                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 系统能力评估                                            评分: ⚠️ 需完善 (50%) │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ✅ 已实现:                                                                  │
│    • 星盘计算 (tools/zodiac/chart.py - 420行)                               │
│    • 情绪引擎框架 (emotion_engine.py - 314行)                               │
│    • 洞察系统框架 (PATTERN 类型洞察定义)                                    │
│                                                                             │
│ ⚠️ 部分实现:                                                                │
│    • 情绪识别 - 规则库不完整                                                │
│    • 模式洞察 - PATTERN card 触发规则弱                                     │
│                                                                             │
│ ❌ 未实现:                                                                  │
│    • 星座知识库 - knowledge/zodiac/ 为空                                    │
│    • 潜意识模式解读 - 需要月亮/上升/宫位知识                                 │
│    • "被看见"体验 - 需要更细腻的情绪响应                                    │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ 差距分析                                                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ 1. 情绪感知差距 (中等)                                                      │
│    emotion_engine.py 框架存在但规则不完整                                   │
│    需要: 扩展情绪规则库 + LLM 辅助判断                                      │
│                                                                             │
│ 2. 知识库差距 (严重)                                                        │
│    • 12星座情绪模式                                                         │
│    • 月亮星座与潜意识                                                       │
│    • 焦虑型依恋与星座关联                                                   │
│                                                                             │
│ 3. 模式洞察差距 (需完善)                                                    │
│    PATTERN 洞察需要累积 3+ 次才触发                                         │
│    需要: 情绪模式专属触发规则                                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

#### 场景 3: 认知盲点可视化 (MBTI)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 用户诉求                                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ David 想直观看到自己的认知短板（为什么总想得多做得少）。                        │
│                                                                             │
│ 用户期望:                                                                   │
│ • 可视化方式看到思维强项和行动弱项                                           │
│ • 不觉得被冒犯                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 系统能力评估                                            评分: ❌ 需新建 (20%) │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ✅ 已实现:                                                                  │
│    • MBTI 页面骨架 (apps/web/src/app/mbti/)                                │
│    • Skill 隔离架构                                                         │
│                                                                             │
│ ❌ 未实现:                                                                  │
│    • MBTI 分析工具 (tools/mbti/ 为空)                                       │
│    • MBTI 知识库 (knowledge/mbti/ 为空)                                     │
│    • 认知功能可视化组件                                                     │
│    • 强弱项光谱图表                                                         │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ 备注: MBTI 为 Phase 2 功能，MVP 暂不覆盖                                     │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 2.2 理解当下 (3个场景)

#### 场景 4: 运势归因 (BaZi)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 用户诉求                                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ Alex 觉得最近诸事不顺，很累，想知道是不是自己能力有问题。                       │
│                                                                             │
│ 用户期望:                                                                   │
│ • 客观的解释（归因）                                                        │
│ • 确认这是暂时的还是长期的                                                   │
│ • 减轻心理负担                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 系统能力评估                                            评分: ⚠️ 需完善 (55%) │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ✅ 已实现:                                                                  │
│    • 流年大运计算 (tools/bazi/transit.py)                                   │
│    • 运势节点识别                                                           │
│    • Persona 安抚式表达风格                                                 │
│                                                                             │
│ ⚠️ 部分实现:                                                                │
│    • 归因解释 - 需要更深的知识库支撑                                        │
│    • "暂时 vs 长期"判断 - 需要大运周期解读                                  │
│                                                                             │
│ ❌ 未实现:                                                                  │
│    • 运势趋势可视化 (时间线图表)                                            │
│    • 心理负担缓解的专属响应模板                                             │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ 核心需求                                                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ 用户本质需求: "这不是我的错" 的客观证据                                      │
│                                                                             │
│ 系统需要提供:                                                               │
│ 1. 当前运势解读 → "你现在走的是 XX 运"                                      │
│ 2. 时间框架 → "这个阶段大约持续到 XX"                                       │
│ 3. 正向引导 → "这是调整期，不是你的问题"                                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

#### 场景 5: 环境主动提醒 (Zodiac) ⭐ 核心差异化

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 用户诉求                                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ Chloe 想提前知道环境变化（如水逆），好做心理准备。                              │
│                                                                             │
│ 用户期望:                                                                   │
│ • 不需要天天查                                                              │
│ • 系统能主动告诉我                                                          │
│ • 像朋友提醒一样                                                            │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 系统能力评估                                            评分: ⚠️ 需完善 (45%) │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ✅ 已实现:                                                                  │
│    • 提醒系统框架 (services/reminder/)                                      │
│      - scheduler.py (事件调度)                                              │
│      - calendar.py (事件日历)                                               │
│      - generator.py (内容生成)                                              │
│      - notification.py (通知分发)                                           │
│    • 7种提醒类型定义 (包括水逆 MERCURY_RETROGRADE)                          │
│    • 提醒模板定义 (vibelife spec v2.1)                                      │
│                                                                             │
│ ⚠️ 部分实现:                                                                │
│    • 提醒触发逻辑未完整                                                     │
│    • 推送通道未接入 (Web Push / 微信)                                       │
│                                                                             │
│ ❌ 未实现:                                                                  │
│    • 星历事件数据源 (水逆日期等)                                            │
│    • 用户偏好设置 UI                                                        │
│    • "像朋友提醒"的个性化内容生成                                           │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ 重要性: ⭐⭐⭐ 这是产品核心差异化                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ "等你开口" vs "主动关心" 是工具和朋友的本质区别                              │
│                                                                             │
│ 此场景直接体现 VibeLife 的核心价值主张:                                      │
│ "不是工具，是关系。不是被动响应，是主动关心。"                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**此场景为 P0 优先级，需要立即完善:**
1. 接入星历数据源 (水逆、月相等)
2. 完善提醒触发逻辑
3. 接入推送通道 (至少 Web Push)
4. 实现个性化提醒内容生成

---

#### 场景 6: 成长确认 (MBTI)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 用户诉求                                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ David 刚完成了一个艰难的任务，想确认自己的状态变化。                           │
│                                                                             │
│ 用户期望:                                                                   │
│ • 自己的努力被看见                                                          │
│ • 获得正向反馈                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 系统能力评估                                            评分: ⚠️ 需完善 (40%) │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ✅ 已实现:                                                                  │
│    • GROWTH 洞察类型定义 (insight_generator.py)                             │
│    • 用户画像系统 - 可追踪状态变化                                          │
│    • 洞察卡片框架                                                           │
│                                                                             │
│ ⚠️ 部分实现:                                                                │
│    • GROWTH 触发规则 - 需要检测"行为突破"                                   │
│    • 与历史自述对比 - portrait 有 Facts/State 但对比逻辑弱                  │
│                                                                             │
│ ❌ 未实现:                                                                  │
│    • 主动检测"成长信号"                                                     │
│    • 成长时刻的庆祝 UI                                                      │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ 技术可行性: 此场景可通过完善 GROWTH 触发规则实现                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ 实现方案:                                                                   │
│ 1. 在 portrait 更新时，对比 "上次 State" vs "当前 State"                   │
│ 2. 如果发现积极变化，触发 GROWTH 洞察                                       │
│ 3. 用温暖的语言呈现 "你成长了"                                              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 2.3 如何改变 (3个场景)

#### 场景 7: 每日微行动 (BaZi) ⭐ 高频场景

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 用户诉求                                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ Alex 想改善运势，不想听大道理，只想知道今天具体做什么。                         │
│                                                                             │
│ 用户期望:                                                                   │
│ • 简单、可执行、低门槛的建议                                                 │
│ • 最好只有一条                                                              │
│ • 做完就很有成就感                                                          │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 系统能力评估                                            评分: ❌ 需新建 (10%) │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ✅ 已实现:                                                                  │
│    • 提醒系统框架 (可复用)                                                  │
│    • 运势计算基础                                                           │
│                                                                             │
│ ❌ 未实现:                                                                  │
│    • 每日建议生成逻辑                                                       │
│    • 微行动库 (五行对应的具体行动)                                          │
│    • 行动完成追踪                                                           │
│    • 成就感反馈 UI                                                          │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ 设计方案                                                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ 核心逻辑:                                                                   │
│ 1. 根据用户五行喜忌 + 当日流日，生成"今日微行动"                             │
│ 2. 每日一条，简单可执行                                                     │
│ 3. 用户可标记"已完成"，触发正向反馈                                         │
│                                                                             │
│ 微行动示例:                                                                 │
│ • 五行缺水: "今天多喝水，或者听一首轻音乐"                                   │
│ • 五行缺木: "今天走一条不一样的路上班"                                       │
│ • 五行缺火: "今天主动和一个人打招呼"                                         │
│                                                                             │
│ 所需组件:                                                                   │
│ 1. daily_action_generator.py - 每日行动生成                                 │
│ 2. action_library.json - 五行微行动库                                       │
│ 3. DailyActionCard.tsx - 前端展示                                           │
│ 4. 行动完成追踪表                                                           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

#### 场景 8: 长程转型计划 (BaZi)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 用户诉求                                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ Alex 想要转行，需要一个长期的过渡计划。                                       │
│                                                                             │
│ 用户期望:                                                                   │
│ • 把大目标拆解成每一步的计划                                                 │
│ • 能帮我追踪进度                                                            │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 系统能力评估                                            评分: ❌ 需新建 (5%)  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ❌ 完全未实现:                                                              │
│    • 计划管理系统                                                           │
│    • 目标拆解功能                                                           │
│    • 进度追踪                                                               │
│    • 运势节点与计划结合                                                     │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ 复杂度评估: 高 (需要完整的计划管理子系统)                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ 建议: 此场景为 P2 优先级，MVP 阶段可简化为:                                  │
│ • 通过对话提供阶段性建议                                                    │
│ • 不做完整的计划管理系统                                                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

#### 场景 9: 专注伴随 (MBTI)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 用户诉求                                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ David 知道自己拖延，需要有人推一把，强制开始执行。                             │
│                                                                             │
│ 用户期望:                                                                   │
│ • "脚手架"或监督机制                                                        │
│ • 帮我跨过"开始"这个最难的门槛                                               │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 系统能力评估                                            评分: ❌ 需新建 (0%)  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ❌ 完全未实现:                                                              │
│    • 番茄钟/专注模式                                                        │
│    • 开始提醒                                                               │
│    • 进度检查点                                                             │
│    • 完成庆祝                                                               │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ 备注: MBTI 为 Phase 2 功能，此场景 MVP 暂不覆盖                               │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 2.4 咨询问事 (2个场景)

#### 场景 10: 职业决策 (BaZi)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 用户诉求                                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ Alex 面临职业重大决策（如裸辞创业），犹豫不决。                                │
│                                                                             │
│ 用户期望:                                                                   │
│ • 理性的风险评估和建议                                                       │
│ • 不是算命式的"你会发财"或"你会破产"                                         │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 系统能力评估                                            评分: ✅ 可满足 (75%) │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ✅ 已实现:                                                                  │
│    • 流年大运分析 (transit.py)                                              │
│    • Persona 定义: "不预测具体事件，强调选择权"                              │
│    • 对话系统支持深度咨询                                                   │
│                                                                             │
│ ⚠️ 需完善:                                                                  │
│    • 职业/事业类知识库                                                       │
│    • 风险评估框架                                                           │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ Persona 指南 (已定义)                                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ boundaries:                                                                 │
│ - 不做具体事件预测（如"你明年会结婚"）                                       │
│ - 不贩卖焦虑                                                                │
│ - 不说绝对的话                                                              │
│ - 强调命理是参考，不是宿命                                                   │
│                                                                             │
│ 示例响应:                                                                   │
│ ❌ "你今年犯太岁，运势很差，要小心"                                          │
│ ✅ "今年是你的'调整年'，适合慢下来思考。有什么特别想完成的目标吗？"           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

#### 场景 11: 情绪急救 SOS (Zodiac) ⭐ 高价值场景

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 用户诉求                                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ Chloe 情绪崩溃，深夜焦虑哭泣，无法理性思考。                                   │
│                                                                             │
│ 用户期望:                                                                   │
│ • 不需要理性分析星盘                                                        │
│ • 只需要陪伴、倾听和安抚                                                    │
│ • 像一个耐心的朋友                                                          │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 系统能力评估                                            评分: ⚠️ 需完善 (35%) │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ✅ 已实现:                                                                  │
│    • 情绪引擎框架 (emotion_engine.py)                                       │
│    • Persona 温暖风格定义                                                   │
│                                                                             │
│ ⚠️ 部分实现:                                                                │
│    • 情绪感知 - 需要增强负面情绪识别                                        │
│    • 安抚模式 - 有框架但无专门的 SOS 响应流程                               │
│                                                                             │
│ ❌ 未实现:                                                                  │
│    • SOS 模式自动切换                                                       │
│    • 专属安抚话术库                                                         │
│    • 危机干预指引 (如识别到自伤倾向时的处理)                                │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ 设计方案: 情绪急救 SOS 模式                                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ 触发条件 (emotion_engine 检测):                                             │
│ • 关键词: "崩溃"、"受不了"、"想死"、"太难了"                                 │
│ • 时间: 深夜 (00:00-05:00) + 负面情绪                                       │
│ • 情绪强度 > 0.8                                                            │
│                                                                             │
│ SOS 模式行为:                                                               │
│ 1. 暂停 Skill 分析（不讲星座理论）                                          │
│ 2. 切换到纯陪伴模式                                                         │
│ 3. 使用专属安抚话术                                                         │
│ 4. 必要时提供专业求助热线                                                   │
│                                                                             │
│ 示例响应:                                                                   │
│ "我感觉到你现在很不好受。                                                   │
│  不用说什么，我就在这里。                                                   │
│  深呼吸...慢慢来。                                                          │
│  你不是一个人。"                                                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### 2.5 合盘 (2个场景)

#### 场景 12: 合伙人隐私匹配 (BaZi)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 用户诉求                                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ Alex 找合伙人，想看合不合，但不能问对方要具体生辰。                            │
│                                                                             │
│ 用户期望:                                                                   │
│ • 保护隐私                                                                  │
│ • 不需要对方知道我算了他在想什么                                             │
│ • 只需要知道怎么配合                                                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 系统能力评估                                            评分: ❌ 需新建 (0%)  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ❌ 完全未实现:                                                              │
│    • 单方合盘功能                                                           │
│    • 模糊信息推断 (仅知道年份/属相)                                          │
│    • 配合建议生成                                                           │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ 设计方案: 单方合盘 (隐私保护版)                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ 用户输入:                                                                   │
│ • 对方大概年龄 或 属相                                                      │
│ • 对方的外显特征描述 (可选)                                                 │
│                                                                             │
│ 系统输出:                                                                   │
│ • 基于年份推断对方可能的性格特点                                            │
│ • 与用户命盘的潜在互动模式                                                  │
│ • 具体配合建议 (如何相处、如何沟通)                                         │
│                                                                             │
│ 示例:                                                                       │
│ 用户: "对方是属虎的，大概35岁左右"                                          │
│ 系统: "1990年属虎(庚午年)的人...和你的甲木日主是'正官'关系，                │
│        这意味着...建议你在合作中..."                                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

#### 场景 13: 行动处方 (Zodiac)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 用户诉求                                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ Chloe 想搞定暧昧对象，想知道怎么回消息对方才高兴。                             │
│                                                                             │
│ 用户期望:                                                                   │
│ • 具体的、可复制的行动指南                                                   │
│ • 甚至是直接的话术模板                                                      │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 系统能力评估                                            评分: ❌ 需新建 (10%) │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ✅ 已实现:                                                                  │
│    • 星座星盘分析基础                                                       │
│    • 对话系统                                                               │
│                                                                             │
│ ❌ 未实现:                                                                  │
│    • 星座配对知识库                                                         │
│    • 话术模板引擎                                                           │
│    • 场景化行动建议                                                         │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ 设计方案: 话术模板引擎                                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ 用户输入:                                                                   │
│ • 对方星座 (或大概生日)                                                     │
│ • 当前情境 (刚认识/暧昧期/争吵后)                                           │
│ • 想达成的目标 (约出来/和好/表白)                                           │
│                                                                             │
│ 系统输出:                                                                   │
│ • 对方星座的沟通偏好分析                                                    │
│ • 可直接使用的话术模板 (2-3个选项)                                          │
│ • 发送时机建议                                                              │
│                                                                             │
│ 示例:                                                                       │
│ 用户: "他是处女座，我们吵架了，我想和好"                                     │
│ 系统: "处女座在吵架后需要冷静期...                                          │
│        建议在 2-3 天后发送:                                                 │
│        Option A: '上次是我说话太冲了，对不起。'                              │
│        Option B: '我反思了一下，你说的有道理...'                             │
│        最佳时机: 下午茶时间 (15:00-17:00)"                                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 架构差距优先级排序

### 3.1 P0 - 阻塞核心体验 (必须在 MVP 前完成)

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║ P0-1: 知识库内容建设                                                          ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║ 当前状态: 🔴 严重缺失                                                         ║
║ • 八字: 仅1个测试文件 (2KB)                                                   ║
║ • 星座: 完全为空                                                              ║
║                                                                               ║
║ 影响场景: 1, 2, 4, 10 (4个核心场景无法提供专业解读)                            ║
║                                                                               ║
║ 所需工作:                                                                     ║
║ ├── 八字知识库 (~50KB)                                                        ║
║ │   ├── theory/ (天干地支、十神、五行)                                        ║
║ │   ├── patterns/ (格局分析)                                                  ║
║ │   ├── transit/ (大运流年)                                                   ║
║ │   └── analysis/ (性格、事业、感情解读框架)                                  ║
║ │                                                                             ║
║ └── 星座知识库 (~40KB)                                                        ║
║     ├── signs/ (12星座)                                                       ║
║     ├── houses/ (12宫位)                                                      ║
║     ├── planets/ (10行星)                                                     ║
║     └── aspects/ (主要相位)                                                   ║
║                                                                               ║
║ 工作量: 2-3 周                                                                ║
║ 负责路径: knowledge/bazi/, knowledge/zodiac/                                  ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝

╔═══════════════════════════════════════════════════════════════════════════════╗
║ P0-2: 主动推送系统完善                                                        ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║ 当前状态: 🟡 框架存在，逻辑未完整                                              ║
║                                                                               ║
║ 影响场景: 5 (核心差异化)                                                      ║
║ 这是 "等你开口" vs "主动关心" 的本质区别                                      ║
║                                                                               ║
║ 所需工作:                                                                     ║
║ 1. 接入星历数据源 (水逆日期、月相等)                                          ║
║ 2. 完善 scheduler.py 触发逻辑                                                 ║
║ 3. 实现 generator.py 个性化内容生成                                           ║
║ 4. 接入推送通道 (Web Push 优先)                                               ║
║ 5. 用户偏好设置 UI                                                            ║
║                                                                               ║
║ 工作量: 1 周                                                                  ║
║ 负责路径: services/reminder/                                                  ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝

╔═══════════════════════════════════════════════════════════════════════════════╗
║ P0-3: 情绪急救 SOS 模式                                                       ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║ 当前状态: 🟡 情绪引擎框架存在，SOS 模式未实现                                  ║
║                                                                               ║
║ 影响场景: 11 (高价值场景，用户最脆弱时刻)                                      ║
║                                                                               ║
║ 所需工作:                                                                     ║
║ 1. 增强 emotion_engine.py 负面情绪识别                                        ║
║ 2. 实现 SOS 模式自动切换逻辑                                                  ║
║ 3. 创建安抚话术库                                                             ║
║ 4. 添加危机干预指引                                                           ║
║                                                                               ║
║ 工作量: 3 天                                                                  ║
║ 负责路径: services/vibe_engine/emotion_engine.py                              ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

### 3.2 P1 - 影响差异化 (上线后 4 周内完成)

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║ P1-1: 每日微行动系统                                                          ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║ 影响场景: 7 (高频使用场景)                                                    ║
║                                                                               ║
║ 所需工作:                                                                     ║
║ 1. 创建 daily_action_generator.py                                             ║
║ 2. 创建五行微行动库 (action_library.json)                                     ║
║ 3. 创建 DailyActionCard.tsx 组件                                              ║
║ 4. 行动完成追踪数据表                                                         ║
║                                                                               ║
║ 工作量: 1 周                                                                  ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝

╔═══════════════════════════════════════════════════════════════════════════════╗
║ P1-2: 可视化图表组件                                                          ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║ 影响场景: 1, 3 (用户明确期望"能看懂的图表")                                    ║
║                                                                               ║
║ 所需工作:                                                                     ║
║ 1. BaziChart.tsx - 八字命盘可视化                                             ║
║ 2. ZodiacChart.tsx - 星盘可视化                                               ║
║ 3. 推演过场动画 (DeductionBridge.tsx)                                         ║
║                                                                               ║
║ 工作量: 1 周                                                                  ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝

╔═══════════════════════════════════════════════════════════════════════════════╗
║ P1-3: GROWTH 洞察触发完善                                                     ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║ 影响场景: 6 (成长确认)                                                        ║
║                                                                               ║
║ 所需工作:                                                                     ║
║ 1. 完善 insight_generator.py GROWTH 触发规则                                  ║
║ 2. 实现 portrait 前后对比逻辑                                                 ║
║ 3. 成长庆祝 UI                                                                ║
║                                                                               ║
║ 工作量: 3 天                                                                  ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

### 3.3 P2 - 增强体验 (可迭代完成)

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║ P2-1: 单方合盘功能                                                            ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║ 影响场景: 12                                                                  ║
║ 工作量: 1 周                                                                  ║
╚═══════════════════════════════════════════════════════════════════════════════╝

╔═══════════════════════════════════════════════════════════════════════════════╗
║ P2-2: 话术模板引擎                                                            ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║ 影响场景: 13                                                                  ║
║ 工作量: 1 周                                                                  ║
╚═══════════════════════════════════════════════════════════════════════════════╝

╔═══════════════════════════════════════════════════════════════════════════════╗
║ P2-3: 长程计划追踪系统                                                        ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║ 影响场景: 8                                                                   ║
║ 工作量: 2 周                                                                  ║
║ 建议: MVP 阶段简化为对话式建议                                                ║
╚═══════════════════════════════════════════════════════════════════════════════╝

╔═══════════════════════════════════════════════════════════════════════════════╗
║ P2-4: MBTI 完整实现                                                           ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║ 影响场景: 3, 6, 9                                                             ║
║ 工作量: 3 周                                                                  ║
║ 建议: 作为 Phase 2 功能                                                       ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

---

## 4. 新功能设计方案

### 4.1 主动推送系统完善

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   PROACTIVE REMINDER SYSTEM V2                                              │
│                                                                             │
│   ═══════════════════════════════════════════════════════════════════════   │
│                                                                             │
│   架构                                                                      │
│   ─────────────────────────────────────────────────────────────────────     │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                                                                     │   │
│   │   Event Sources (事件源)                                            │   │
│   │   ─────────────────────────────────────────────────────────────     │   │
│   │                                                                     │   │
│   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │   │
│   │   │   BAZI      │  │   ZODIAC    │  │   CALENDAR  │                │   │
│   │   │   Events    │  │   Events    │  │   Events    │                │   │
│   │   │             │  │             │  │             │                │   │
│   │   │ • 月运交接  │  │ • 水逆      │  │ • 生日      │                │   │
│   │   │ • 流年交接  │  │ • 新月满月  │  │ • 纪念日    │                │   │
│   │   │ • 大运交接  │  │ • 周运      │  │             │                │   │
│   │   └─────────────┘  └─────────────┘  └─────────────┘                │   │
│   │                                                                     │   │
│   └───────────────────────────────┬─────────────────────────────────────┘   │
│                                   │                                         │
│                                   ▼                                         │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                                                                     │   │
│   │   Scheduler (调度器)                                                │   │
│   │   ─────────────────────────────────────────────────────────────     │   │
│   │                                                                     │   │
│   │   Cron Job: 每日 00:00 检查即将到来的事件                           │   │
│   │   触发逻辑:                                                         │   │
│   │   • 月运交接: 提前 1-2 天                                           │   │
│   │   • 水逆: 开始前 2-3 天 / 结束时                                    │   │
│   │   • 新月满月: 当天                                                  │   │
│   │                                                                     │   │
│   └───────────────────────────────┬─────────────────────────────────────┘   │
│                                   │                                         │
│                                   ▼                                         │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                                                                     │   │
│   │   Generator (内容生成)                                              │   │
│   │   ─────────────────────────────────────────────────────────────     │   │
│   │                                                                     │   │
│   │   LLM 生成个性化内容:                                               │   │
│   │   • 读取用户 portrait                                               │   │
│   │   • 读取用户命盘/星座                                               │   │
│   │   • 生成"像朋友提醒"的内容                                          │   │
│   │                                                                     │   │
│   └───────────────────────────────┬─────────────────────────────────────┘   │
│                                   │                                         │
│                                   ▼                                         │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                                                                     │   │
│   │   Notification (通知分发)                                           │   │
│   │   ─────────────────────────────────────────────────────────────     │   │
│   │                                                                     │   │
│   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │   │
│   │   │  Web Push   │  │  In-App     │  │  WeChat     │                │   │
│   │   │  (MVP)      │  │  Inbox      │  │  (Phase 2)  │                │   │
│   │   └─────────────┘  └─────────────┘  └─────────────┘                │   │
│   │                                                                     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**关键文件:**
- `apps/api/services/reminder/scheduler.py` - 完善触发逻辑
- `apps/api/services/reminder/generator.py` - 实现 LLM 生成
- `apps/api/services/reminder/notification.py` - 接入 Web Push
- `apps/api/data/ephemeris.json` - 星历数据 (水逆日期等)

---

### 4.2 每日微行动系统

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   DAILY MICRO-ACTION SYSTEM                                                 │
│                                                                             │
│   ═══════════════════════════════════════════════════════════════════════   │
│                                                                             │
│   用户流程                                                                  │
│   ─────────────────────────────────────────────────────────────────────     │
│                                                                             │
│   1. 每日推送 (或用户主动查看)                                              │
│      ┌─────────────────────────────────────────────────────────────────┐    │
│      │  🌟 今日微行动                                                  │    │
│      │  ─────────────────────────────────────────────────────────────  │    │
│      │                                                                 │    │
│      │  今天你的五行偏弱于"水"                                          │    │
│      │                                                                 │    │
│      │  ┌───────────────────────────────────────────────────────────┐  │    │
│      │  │  💧 今日建议                                              │  │    │
│      │  │                                                           │  │    │
│      │  │  "多喝水，或者听一首轻音乐放松一下"                         │  │    │
│      │  │                                                           │  │    │
│      │  │  [ 我做到了 ✓ ]     [ 换一个建议 ]                         │  │    │
│      │  └───────────────────────────────────────────────────────────┘  │    │
│      │                                                                 │    │
│      └─────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│   2. 完成反馈                                                               │
│      ┌─────────────────────────────────────────────────────────────────┐    │
│      │  🎉 太棒了！                                                    │    │
│      │                                                                 │    │
│      │  你今天完成了微行动。                                           │    │
│      │  这个小小的行动，正在帮你平衡能量。                             │    │
│      │                                                                 │    │
│      │  [ 本周已完成 5 次 ]                                            │    │
│      └─────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│   ═══════════════════════════════════════════════════════════════════════   │
│                                                                             │
│   技术实现                                                                  │
│   ─────────────────────────────────────────────────────────────────────     │
│                                                                             │
│   1. daily_action_generator.py                                              │
│      ───────────────────────────────────────                                │
│      • 读取用户八字 (五行喜忌)                                              │
│      • 读取当日流日 (当天五行)                                              │
│      • 从 action_library 选择合适的微行动                                   │
│                                                                             │
│   2. action_library.json                                                    │
│      ───────────────────────────────────────                                │
│      {                                                                      │
│        "water": [                                                           │
│          {"action": "多喝水，或者听一首轻音乐", "difficulty": 1},           │
│          {"action": "今天尝试一条新的路线", "difficulty": 2}                │
│        ],                                                                   │
│        "wood": [                                                            │
│          {"action": "今天走一条不一样的路上班", "difficulty": 1},           │
│          {"action": "给家里的植物浇浇水", "difficulty": 1}                  │
│        ],                                                                   │
│        ...                                                                  │
│      }                                                                      │
│                                                                             │
│   3. 数据表                                                                 │
│      ───────────────────────────────────────                                │
│      daily_actions (                                                        │
│        id, user_id, date, action_text, element,                            │
│        completed_at, created_at                                            │
│      )                                                                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**关键文件 (新建):**
- `apps/api/services/vibe_engine/daily_action_generator.py`
- `apps/api/data/action_library.json`
- `apps/web/src/components/action/DailyActionCard.tsx`

---

### 4.3 情绪急救 SOS 模式

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   EMOTIONAL SOS MODE                                                        │
│                                                                             │
│   ═══════════════════════════════════════════════════════════════════════   │
│                                                                             │
│   触发条件                                                                  │
│   ─────────────────────────────────────────────────────────────────────     │
│                                                                             │
│   任一条件满足即触发:                                                       │
│                                                                             │
│   1. 关键词检测                                                             │
│      • 危机词: "想死"、"活不下去"、"自杀"、"结束"                            │
│      • 崩溃词: "崩溃"、"受不了"、"撑不住"、"太难了"                          │
│      • 求助词: "救我"、"帮帮我"、"怎么办"                                   │
│                                                                             │
│   2. 时间 + 情绪组合                                                        │
│      • 深夜 (00:00-05:00) + 负面情绪强度 > 0.7                              │
│                                                                             │
│   3. 情绪强度                                                               │
│      • 单条消息负面情绪强度 > 0.9                                           │
│                                                                             │
│   ═══════════════════════════════════════════════════════════════════════   │
│                                                                             │
│   SOS 模式行为                                                              │
│   ─────────────────────────────────────────────────────────────────────     │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                                                                     │   │
│   │   1. 暂停 Skill 分析                                                │   │
│   │      • 不讲星座/八字理论                                            │   │
│   │      • 不给"运势解释"                                               │   │
│   │                                                                     │   │
│   │   2. 切换到纯陪伴模式                                               │   │
│   │      • 倾听                                                         │   │
│   │      • 共情                                                         │   │
│   │      • 不给建议                                                     │   │
│   │                                                                     │   │
│   │   3. 使用专属安抚话术                                               │   │
│   │                                                                     │   │
│   │   4. 危机干预 (如检测到自伤倾向)                                    │   │
│   │      • 提供专业求助热线                                             │   │
│   │      • 全国心理援助热线: 400-161-9995                               │   │
│   │      • 北京心理危机研究与干预中心: 010-82951332                     │   │
│   │                                                                     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│   ═══════════════════════════════════════════════════════════════════════   │
│                                                                             │
│   安抚话术示例                                                              │
│   ─────────────────────────────────────────────────────────────────────     │
│                                                                             │
│   Level 1 (轻度情绪低落):                                                   │
│   "我感觉到你现在不太好受。                                                 │
│    想聊聊吗？或者只是待一会儿也可以。"                                      │
│                                                                             │
│   Level 2 (中度崩溃):                                                       │
│   "我在这里。                                                               │
│    深呼吸...慢慢来。                                                        │
│    你不用说什么，我就在这里陪着你。"                                        │
│                                                                             │
│   Level 3 (危机信号):                                                       │
│   "我听到你说的了，我很担心你。                                             │
│    现在最重要的是你的安全。                                                 │
│                                                                             │
│    如果你愿意，可以拨打这个电话:                                            │
│    全国心理援助热线: 400-161-9995                                           │
│                                                                             │
│    那里有专业的人可以帮助你。                                               │
│    我会一直在这里。"                                                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**关键文件:**
- `apps/api/services/vibe_engine/emotion_engine.py` - 增强检测
- `apps/api/services/agent/sos_mode.py` - 新建 SOS 模式处理
- `apps/api/data/sos_phrases.json` - 安抚话术库

---

### 4.4 单方合盘功能

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   SINGLE-SIDE COMPATIBILITY (单方合盘)                                       │
│                                                                             │
│   ═══════════════════════════════════════════════════════════════════════   │
│                                                                             │
│   用户流程                                                                  │
│   ─────────────────────────────────────────────────────────────────────     │
│                                                                             │
│   用户: "我想看看和一个合伙人合不合，但不知道他具体生日"                     │
│                                                                             │
│   系统: "没问题，我可以帮你分析。                                           │
│          知道对方的大概年龄或属相吗？"                                      │
│                                                                             │
│   用户: "他是属虎的，大概35岁"                                              │
│                                                                             │
│   系统:                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  🔮 单方合盘分析                                                    │   │
│   │                                                                     │   │
│   │  基于对方信息:                                                      │   │
│   │  • 属虎 + 35岁 → 推测为 1990 年 (庚午年)                            │   │
│   │                                                                     │   │
│   │  与你的八字关系:                                                    │   │
│   │  • 你的日主: 甲木                                                   │   │
│   │  • 对方年柱: 庚午 → 对你是"正官"                                    │   │
│   │                                                                     │   │
│   │  这意味着:                                                          │   │
│   │  • 对方可能比较正派、有原则                                         │   │
│   │  • 合作中对方可能会"约束"你                                         │   │
│   │  • 这种约束可以是积极的（帮你守规矩）                               │   │
│   │                                                                     │   │
│   │  配合建议:                                                          │   │
│   │  1. 让对方主导流程和规则                                            │   │
│   │  2. 你负责创意和开拓                                                │   │
│   │  3. 决策时尊重对方的保守意见                                        │   │
│   │                                                                     │   │
│   │  ⚠️ 注意: 这是基于有限信息的推断，仅供参考                          │   │
│   │                                                                     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│   ═══════════════════════════════════════════════════════════════════════   │
│                                                                             │
│   技术实现                                                                  │
│   ─────────────────────────────────────────────────────────────────────     │
│                                                                             │
│   输入解析:                                                                 │
│   • 属相 → 年份范围                                                        │
│   • 年龄 → 确定具体年份                                                    │
│   • 星座 (如果有) → 月份范围                                               │
│                                                                             │
│   分析维度:                                                                 │
│   • 年柱与用户日主的十神关系                                               │
│   • 五行相生相克                                                           │
│   • 配合建议生成                                                           │
│                                                                             │
│   隐私保护:                                                                 │
│   • 不存储对方信息                                                         │
│   • 仅在对话中临时使用                                                     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**关键文件 (新建):**
- `apps/api/tools/bazi/compatibility.py` - 合盘计算
- `apps/api/services/agent/intents/compatibility.py` - 意图处理

---

### 4.5 话术模板引擎

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   SCRIPT TEMPLATE ENGINE (话术模板引擎)                                      │
│                                                                             │
│   ═══════════════════════════════════════════════════════════════════════   │
│                                                                             │
│   用户流程                                                                  │
│   ─────────────────────────────────────────────────────────────────────     │
│                                                                             │
│   用户: "他是处女座，我们吵架了，我想和好但不知道怎么说"                     │
│                                                                             │
│   系统:                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  💬 话术指南                                                        │   │
│   │                                                                     │   │
│   │  处女座的沟通特点:                                                  │   │
│   │  • 注重逻辑和细节                                                   │   │
│   │  • 吵架后需要冷静期                                                 │   │
│   │  • 欣赏真诚的自我反思                                               │   │
│   │                                                                     │   │
│   │  ─────────────────────────────────────────────────────────────────  │   │
│   │                                                                     │   │
│   │  建议在 2-3 天后发送 (给对方冷静时间)                               │   │
│   │  最佳时机: 下午茶时间 (15:00-17:00)                                 │   │
│   │                                                                     │   │
│   │  ─────────────────────────────────────────────────────────────────  │   │
│   │                                                                     │   │
│   │  话术选项:                                                          │   │
│   │                                                                     │   │
│   │  Option A (直接道歉):                                               │   │
│   │  "上次是我说话太冲了，对不起。我反思了一下，                         │   │
│   │   你说的那个点确实是我的问题。"                                      │   │
│   │                                                                     │   │
│   │  Option B (承认对方观点):                                           │   │
│   │  "我仔细想了想你那天说的，你是对的。                                 │   │
│   │   我不应该那样回应。"                                                │   │
│   │                                                                     │   │
│   │  Option C (轻松破冰):                                               │   │
│   │  "想你了。周末有空一起吃饭吗？"                                      │   │
│   │  (适合冷战时间较长、需要破冰的情况)                                  │   │
│   │                                                                     │   │
│   │  [ 复制 A ]  [ 复制 B ]  [ 复制 C ]                                  │   │
│   │                                                                     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│   ═══════════════════════════════════════════════════════════════════════   │
│                                                                             │
│   知识库需求                                                                │
│   ─────────────────────────────────────────────────────────────────────     │
│                                                                             │
│   1. 12星座沟通偏好                                                         │
│      • 吵架后的处理方式                                                    │
│      • 喜欢的表达风格                                                      │
│      • 禁忌话题                                                            │
│                                                                             │
│   2. 场景话术库                                                             │
│      • 和好类                                                              │
│      • 表白类                                                              │
│      • 邀约类                                                              │
│      • 安慰类                                                              │
│                                                                             │
│   3. 时机建议规则                                                           │
│      • 星座 × 场景 → 最佳发送时间                                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**关键文件 (新建):**
- `knowledge/zodiac/communication/` - 沟通偏好知识库
- `apps/api/services/agent/script_generator.py` - 话术生成
- `apps/web/src/components/script/ScriptCard.tsx` - 话术卡片组件

---

## 5. 实施路线图建议

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                                                                               ║
║   IMPLEMENTATION ROADMAP                                                      ║
║                                                                               ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   Phase 1: 基础夯实 (Week 1-3)                                                ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   Week 1:                                                                     ║
║   ├── [P0-1] 八字知识库建设 - theory 部分                                     ║
║   └── [P0-3] 情绪急救 SOS 模式                                                ║
║                                                                               ║
║   Week 2:                                                                     ║
║   ├── [P0-1] 八字知识库建设 - patterns + transit                              ║
║   └── [P0-2] 主动推送系统 - 调度器 + 数据源                                   ║
║                                                                               ║
║   Week 3:                                                                     ║
║   ├── [P0-1] 星座知识库建设                                                   ║
║   └── [P0-2] 主动推送系统 - 通知通道 + UI                                     ║
║                                                                               ║
║   里程碑: 端到端流程可运行，八字/星座专业解读可用                             ║
║                                                                               ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   Phase 2: 体验提升 (Week 4-6)                                                ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   Week 4:                                                                     ║
║   ├── [P1-1] 每日微行动系统                                                   ║
║   └── [P1-3] GROWTH 洞察触发完善                                              ║
║                                                                               ║
║   Week 5-6:                                                                   ║
║   └── [P1-2] 可视化图表组件 (BaziChart, ZodiacChart, DeductionBridge)         ║
║                                                                               ║
║   里程碑: 核心差异化体验完整                                                  ║
║                                                                               ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   Phase 3: 功能扩展 (Week 7+)                                                 ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   ├── [P2-1] 单方合盘功能                                                     ║
║   ├── [P2-2] 话术模板引擎                                                     ║
║   └── [P2-4] MBTI 完整实现 (Phase 2 产品)                                     ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

---

## 6. 附录：关键文件路径

### 6.1 需要修改的现有文件

| 文件路径 | 修改目的 |
|---------|---------|
| `apps/api/services/vibe_engine/emotion_engine.py` | 增强情绪检测 + SOS 模式 |
| `apps/api/services/vibe_engine/insight_generator.py` | 完善 GROWTH 触发规则 |
| `apps/api/services/reminder/scheduler.py` | 完善触发逻辑 |
| `apps/api/services/reminder/generator.py` | 实现 LLM 个性化生成 |
| `apps/api/services/reminder/notification.py` | 接入 Web Push |
| `apps/api/services/agent/runtime.py` | 集成 SOS 模式 |
| `apps/api/services/agent/persona.py` | 增加 SOS 模式 persona |

### 6.2 需要新建的文件

| 文件路径 | 功能 |
|---------|------|
| `knowledge/bazi/theory/*.md` | 八字理论知识库 |
| `knowledge/bazi/patterns/*.md` | 格局分析知识库 |
| `knowledge/bazi/transit/*.md` | 大运流年知识库 |
| `knowledge/zodiac/signs/*.md` | 12星座知识库 |
| `knowledge/zodiac/houses/*.md` | 12宫位知识库 |
| `knowledge/zodiac/communication/*.md` | 沟通偏好知识库 |
| `apps/api/services/agent/sos_mode.py` | SOS 模式处理 |
| `apps/api/services/vibe_engine/daily_action_generator.py` | 每日微行动生成 |
| `apps/api/data/sos_phrases.json` | 安抚话术库 |
| `apps/api/data/action_library.json` | 微行动库 |
| `apps/api/data/ephemeris.json` | 星历数据 |
| `apps/api/tools/bazi/compatibility.py` | 合盘计算 |
| `apps/api/services/agent/script_generator.py` | 话术生成 |
| `apps/web/src/components/action/DailyActionCard.tsx` | 每日行动卡片 |
| `apps/web/src/components/chart/BaziChart.tsx` | 八字可视化 |
| `apps/web/src/components/chart/ZodiacChart.tsx` | 星盘可视化 |
| `apps/web/src/components/script/ScriptCard.tsx` | 话术卡片 |

---

## 7. 总结

### 7.1 场景覆盖度汇总

| 类别 | 场景数 | 可满足 | 需完善 | 需新建 |
|------|-------|-------|-------|-------|
| 认识自我 | 3 | 0 | 2 | 1 (MBTI) |
| 理解当下 | 3 | 0 | 3 | 0 |
| 如何改变 | 3 | 0 | 0 | 3 |
| 咨询问事 | 2 | 1 | 1 | 0 |
| 合盘 | 2 | 0 | 0 | 2 |
| **总计** | **13** | **1** | **6** | **6** |

### 7.2 核心结论

1. **知识库是最大阻塞** - 没有知识库，再好的架构也无法提供专业解读

2. **主动推送是差异化核心** - 这是 "工具" vs "朋友" 的本质区别

3. **情绪急救是高价值场景** - 用户最脆弱时刻的体验决定忠诚度

4. **"如何改变"类场景需要新建系统** - 每日微行动、计划追踪需要独立子系统

5. **MBTI 可作为 Phase 2** - MVP 聚焦八字 + 星座，降低复杂度

---

*报告版本: 1.0*
*生成时间: 2026-01-07*
*基于: user case.md, vibelife spec v2.0/v2.1, architecture-gap-analysis.md*
