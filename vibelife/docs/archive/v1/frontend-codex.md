# 前端工程指南：VibeLife「Luminous Paper」(Codex 版)

> **目标状态**：世界级移动端优先体验 + PC 端沉浸式工作台（A2UI）  
> **美学基准**：Apple Journal / Apple Books / Paper by WeTransfer  
> **核心隐喻**：魔幻现实主义（东方神秘学遇见现代物理）  
> **本文性质**：`docs/frontend-gemini.md` 的落地执行版（结合本次深度访谈决策）  
> **Last Updated**：2026-01-06

---

## 0. 本文要解决什么

把“好看”落到“可交付”，把“愿景”落到“4 周能上线的 P0 体验”：

1. **引流**：有特色功能、可传播、别的 App 没有。
2. **激活**：眼前一亮、极易用、能立刻解决用户痛点。
3. **第一口价值**：以**高质量解读 + 高质量洞察**为核心（时间其次，质量最重要）。

---

## 1. 北极星指标（4 周）

### 1.1 OMTM：引流 + 激活（双北极星）

**引流（Acquisition）**
- 定义：用户因为“特色功能/可分享卡片/仪式感体验”而进入站点并产生传播链。
- 关键指标（建议）：
  - `share_click_rate`：洞察卡“分享”点击率
  - `share_complete_rate`：分享成功率（复制/系统分享/生成海报）
  - `share_to_visit_rate`：分享带来的新访问占比（短链/邀请码）

**激活（Activation）**
- 定义：用户在首次访问中获得“我被理解/我想继续”的确定性回报。
- 关键指标（建议）：
  - `first_value_rate`：首次价值达成率（见下）
  - `return_next_day_rate`：次日回访率（不靠 push，靠“应用内问候/继续对话”）

### 1.2 “首次价值（First Value）”判定（建议）

只看“是否输出了高质量价值”，不盲目追求秒开。

- **路径 A（八字）**：完成“出生信息 → 推演过场 → 出盘 + 解读（含 1 张洞察卡）”
- **路径 B（星座/MBTI）**：完成“进入聊天 → 2 轮高质量追问 → 1 张洞察卡”

事件建议：
- `first_value_achieved`：当用户看到 **解读区块** + **洞察卡** 之一即可触发；当二者都出现记为 `first_value_strong`.

---

## 2. Phase 1 产品范围（决策）

### 2.1 Skill 策略：通用模板 + 各自特色

- **模板强一致**：信息架构、导航框架、交互节奏一致。
- **视觉元素各自有特点**：`bazi/zodiac/mbti` 的推演过场、右栏内容、卡片语言不同。
- **主页面框架一致**：同一套 Luminous Paper 质感与“仪式感路径”。

### 2.2 渐进注册（Progressive Disclosure）

**不阻断首次价值**，只在“用户明确要拥有”时注册。

- 触发注册的动作（P0）：
  1. **保存洞察**
  2. **查看完整报告/完整命盘**
- 非触发：单纯聊天、单次体验（guest 模式可用）

### 2.3 首次信息采集（P0）

- 必填：**生日（年月日）**
- 选填：
  - 时辰：可跳过（unknown）
  - 性别：需要包容（见 2.3.1）
  - 地点：默认北京（可在设置里修改）

#### 2.3.1 性别字段（包容性要求）

前端展示不要做二元假设：
- 推荐选项（示例）：`女性 / 男性 / 非二元 / 不便透露`
- 文案避免默认异性恋叙事；关系相关建议使用中性措辞。

### 2.4 出生信息与结果自动带入（决定：要）

目标：让用户感到“系统记得我”，而不是“我在填表”。

- 出生信息应自动注入：
  - Chat 的上下文（首条系统提示/隐藏 context）
  - 右侧 Insight Panel 的档案摘要
- 摘要结构（P0 版）：
  - `bazi`：年/月/日柱 + 日主 + 格局（如能）+ 当前运势节点（如能）
  - `zodiac`：太阳/上升/月亮（可缺省）+ 本周关键词
  - `mbti`：类型（如已判定）+ 2 个优势 + 1 个盲点（非常短）

### 2.5 Chat：继续上次对话（决定：要，优先级高）

体验原则：用户返回时看到的不是空白，而是“上次聊到这里”。

- Guest：本地持久化最近一次对话（localStorage）
- 已登录：以 `conversation_id` 继续；若后端支持，拉取最近对话摘要（最少：最后 20 条）

### 2.6 四大诉求的主叙事（产品骨架）

围绕你强调的最大诉求，Phase 1 的叙事顺序建议如下：

1. **身份：我是谁（Identity Prism）** —— 第一次击中（Activation）
2. **关系：我们是什么（Relationship Simulator）** —— 可分享、可传播（Acquisition）
3. **趋势：我正处在什么阶段（Now/Next）** —— 复访动机（Retention seed）
4. **改变：我下一步怎么做（Coach Steps）** —— 长期价值（Monetization seed）

对应信息架构：
- **Chat**：对话主线（身份/关系/趋势/行动都可被对话驱动）
- **Chart**：结构化解释（命盘/星盘/类型 + 证据）
- **Journey**：洞察库 + 周期回顾 + 轻量行动（7 天微行动）
- **Me**：身份开关常驻 + 偏好与隐私 + 订阅

---

## 3. 现状对照（当前已实现 / 未实现）

### 3.1 已实现（前端现状）

- Landing：`/`、`/bazi`、`/zodiac`、`/mbti`
- Chat：`/bazi/chat`、`/zodiac/chat`、`/mbti/chat`、`/chat/[skillId]`
- Auth：`/auth/login`、`/auth/register`、`/auth/sso-callback`
- 八字 guest 出盘：`/bazi` 直接调用 guest tool 并展示 raw result + interpretation

### 3.2 关键缺口（与 v2.0/v2.1 对照）

> 下面三项是我建议的 **4 周最优先缺口（P0/P1/P2）**，与你的“引流 + 激活 + 高质量解读/洞察”以及“四大诉求骨架”对齐。

**P0：「我是谁」Identity Prism + 洞察卡闭环（激活 + 引流）**
- 三元视角（Inner/Core/Outer）半常驻（PC 右栏 + Mobile Me + Chart 首屏）。
- 洞察卡 Bottom Sheet + 分享 + Like + 深入解读（并把“收藏/保存”作为渐进注册触发）。

**P1：Relationship Simulator（关系模拟器）P0（杀手级功能）**
- 先上“传统输入模式”+ 可分享关系卡（不暴露底层信息）。
- 双用户隐私模式作为 P1.5（需要同意机制与披露级别）。

**P2：结构化承载（Chart/Insight Panel）+ 续聊**
- 修复 `/bazi/profile` 等缺失页（统一到 `/{skill}/chart`），让右栏有真实摘要与趋势卡。
- 继续上次对话（local + conversation_id），给复访一个“马上接上”的理由。

（其余：提醒系统、Skill Mirror、订阅/支付、跨技能洞察属于后续依赖项，但本指南会给出接口与 IA 预留。）

---

## 4. 设计哲学与物理质感（执行要点）

### 4.1 光纸（Luminous Paper）

- **拒绝平坦色块**：在 `--vellum` 之上叠加噪点纹理（低不透明度），用 `mix-blend-mode: multiply/overlay` 创造材质深度。
- **光晕是背光**：柔和、漫射、温暖；避免霓虹感。
- **墨水物理**：流式文本/标题入场用“模糊显影”（`blur(4px) -> blur(0)` + opacity）。

### 4.2 禅意呼吸动效

- 频率极低：`0.05Hz - 0.1Hz`
- 默认静止：只有在交互/推演时“苏醒”
- 统一用 `framer-motion` **spring physics**（禁用 linear）

---

## 5. IA 与导航（移动端优先）

### 5.1 BottomNav（P0）

结构固定：`Chat | Chart | Journey | Me`

- `Chat`：对话流（洞察卡嵌入）
- `Chart`：出盘/档案/报告（技能差异化展示）
- `Journey`：Mirror/节律回顾/洞察时间线（Phase 1 可做轻量）
- `Me`：账号、偏好（地点/性别）、订阅状态

### 5.2 路由建议（Next.js App Router）

建议统一技能路由形态，便于三技能复用：

- `/{skill}`：Landing（零摩擦入口）
- `/{skill}/chat`：对话
- `/{skill}/chart`：图表/报告（取代当前“/profile”不明确）
- `/{skill}/journey`：回顾/时间线（Phase 1 轻量）
- `/me`：全局个人中心（也可在技能内提供入口）

备注：`/chat/[skillId]` 可保留作为通用入口，但应确保和 `{skill}/chat` 不冲突、且能复用同一套布局。

### 5.3 洞察库（Insights Library / 收藏）

你提到“参考洞察部分文档”，因此这里按 `v2.1 Insight Card System` 的思路落地：

- **不新增独立信息架构**：优先放在 `Journey` Tab（移动端最顺手），并在 PC 右侧面板提供同款入口。
- **默认跨 Skill 聚合 + 支持筛选**：
  - 默认：聚合展示（符合“一个 Vibe 的长期理解”）
  - 筛选：按 `skill` / `insight_type` / `时间`（Phase 1 先做最少筛选：skill）
- **仅登录可用**：Guest 可浏览洞察，但点击“收藏/保存”触发渐进注册。

---

## 6. 核心组件（P0 交付标准）

### 6.1 仪式感输入胶囊（Birth Input Capsule）

- 聚焦轻微膨胀（scale 1.02）
- 关键节点轻触觉反馈（如环境支持）
- “可跳过字段”不要造成认知负担（时辰/性别/地点应收纳为“高级选项”）

### 6.2 推演过场（Deduction Bridge）

目标：连接“凡人输入”与“天机洞察”的 1.5–2s 过场。

- `bazi`：同心环（玉石质感，重力转动）
- `zodiac`：星连（深蓝底色，金线勾勒）
- `mbti`：光谱折射（棱镜分光）

工程建议：
- 统一 `TransitionOverlay` 组件 + `variant` 参数
- 过场必须可被“快速跳过”（无障碍/性能保障）

### 6.3 洞察卡片：流中宝石（Gems in the Stream）

P0 必须具备：
- **点击展开**：Bottom Sheet（`vaul`），禁用居中 Modal
- **分享**：复制文本 + 生成海报（第一版可只做复制/图片导出二选一）
- **深入解读**：作为“二跳对话”入口（生成 follow-up prompt）
- **正向反馈**：`Like`（只做正向，不做踩）
- **收藏/保存**：点击触发“渐进注册”，登录后进入 `Journey → 洞察库`

### 6.4 主动关怀：应用内问候（No Push）

你的偏好是“打开页面立即看到最新的”：
- 首页或聊天顶部渲染“问候卡片”（Daily Vibe Greeting）
- 频率：每日/每周/月/季/年/节日 + 用户事件驱动
- 只呈现“最新一期”，历史不做强依赖（Phase 1 简化）

### 6.5 Skill Mirror（放置：聊天/右栏）

Phase 1 建议形态：
- 在 Chat 顶部或右侧面板展示“本周期回顾卡”
- 支持一键分享（与洞察卡共享分享组件）

### 6.6 「我是谁」：Identity Prism（三元视角，P0 核心）

> 目标：用一个**极简单的交互**，一次性解决用户的核心困惑：  
> “我内心是这样的，但别人觉得我是那样的” → **人是多面的** → 我被理解/被允许/被赋能。

#### 6.6.1 一句话击中（默认文案结构）

统一采用“三段式对照”，直接对准痛点：

- `Outer（外在/面具）`：你给人的感觉是「{outer_keyword}」
- `Core（核心/自我）`：但你真正稳定的驱动力是「{core_keyword}」
- `Inner（内在/阴）`：在你心里，其实最在意的是「{inner_keyword}」

> 这三段永远以“可被验证的行为倾向”表达，避免宿命化、避免绝对预言。

#### 6.6.2 放置策略（默认入口）

选 **B：半常驻**（理由：强心智但不打断对话节奏）

- **PC**：Insight Panel 顶部常驻（第一屏可见），作为“身份锚点”
- **Mobile**：`Me` Tab 顶部常驻 + `Chat` 空状态提供一张“预览卡”（点击跳转 Me/Chart）
- **Chart/报告页**：作为“报告的第一页”（在任何图表之前先给身份框架）

#### 6.6.3 交互形式：三档物理开关（Yin / Self / Yang）

- 推荐组件：`TriToggle`（三段拨片/旋钮，带“机械阻尼感”的 spring）
- 三个状态：
  - `Inner / Yin`：光晕内敛（更小半径、更低亮度、更慢呼吸）
  - `Core / Self`：平衡（中等半径，几乎静止）
  - `Outer / Yang`：光晕外放（更大半径、更高亮度、但频率仍低）
- 动效规则：
  - 切换时只允许 1 个强动效（开关拨动），其余只是材质/光晕轻微变化
  - 文本采用墨水显影：`blur-in` + opacity

#### 6.6.4 三个 Skill 的映射（P0 版）

**八字（Bazi）**
- `Inner`：日主（本我核心气质）+ “最自然的反应方式”
- `Core`：用神/喜忌（更像“长期利益的方向盘”）——用现代语义表达，不直接堆术语
- `Outer`：十神结构的“社会角色策略”（比直接用“格局=表象”更安全；格局可作为次级标签）
- 说明：避免“你注定…”；改为“你更容易…/你更常…/如果…你会…”

**星座（Zodiac）**
- 三层默认：`月亮(Inner)` / `太阳(Core)` / `上升(Outer)`
- 上升缺失（不知道时辰）：采用 **C 退化** + 轻提示（不阻断）
  - P0：先用太阳/月亮两层
  - P1：允许用户补时辰解锁“上升层”

**MBTI**
- 采用 **B 表达**：`内在能量补给方式(Inner)` vs `对外互动策略(Outer)`，避免误导
- `Core`：主导功能/决策偏好（用非术语话表达：你更靠“逻辑框架/价值对齐/体验感受/可能性”做决定）
- 类型来源：**C 混合**（对话推断 + 一键校准）

#### 6.6.5 “证据”展示（不暴露 Portrait）

你不希望暴露 portrait，因此证据只给“来源类型”，不给画像原文：
- `来自命盘/星盘/测验`：展示 1–2 个结构化要点（例如“日主=甲木”/“月亮=巨蟹”/“倾向=内向补能”）
- `来自对话`：只展示用户明确说过的一句“原话摘录”（可关闭），不展示系统总结

#### 6.6.6 禁用话术（避免贩卖焦虑）

必须禁用：
- “你注定… / 你一定会… / 你逃不掉… / 这是命”
- 以恐惧驱动的句式：“不这样就会很惨/会出事/会破财”
- 情感操控式推销：“不买你就错过窗口期”

改用：
- “更可能/更容易/在…情况下常见/可以尝试”

---

### 6.7 Relationship Simulator（关系模拟器，杀手级引流功能）

> 目标：关系是刚需。用“隐私友好 + 可分享 + 可行动”的方式做出差异化。

#### 6.7.1 Phase 1 主场景（默认选择）

选择 **A 亲密关系** 作为主打（传播性最强、复访动机最强、可自然导向“行动处方”）。

#### 6.7.2 输出形态（默认选择）

选择 **D 行动处方** 为主，A/B/C 作为辅助模块：

- 先给一句“关系诊断句”（像医生开方，但温柔）
- 再给 3 条“下次怎么说/怎么做”（可直接复制发送）
- 最后给“高风险冲突触发器”1 条（避免吓人，用“注意点”表达）

#### 6.7.3 两种模式（传统输入 vs 双用户隐私模式）

**模式 1：传统输入（单人发起）**
- 最小输入集（P0）：
  - 八字：对方生日（年月日）即可；时辰可选
  - 星座：对方太阳星座（不知道生日也能玩）；生日可选提升精度
  - MBTI：对方类型（或快速 4 题校准）

**模式 2：双 VibeLife 用户（隐私友好）**
- 隐私边界选择：**C 可选择分享级别（默认最隐私）**
  - 默认：对方看不到我的生日/时辰/地点/性别等输入
  - 默认也不展示“日主/上升/MBTI 类型”等底层标签给对方，只展示“合盘结果 + 建议”
  - 发起者可在分享前手动升级披露（可选）
- 同意机制选择：**A 链接/邀请码**（裂变自然、成本最低）
  - 发起者生成 `relationship_link`
  - 对方点击 → 选择披露级别 → 同意 → 生成合盘结果

#### 6.7.4 可分享卡片（引流核心）

必须做（P0）：
- 可分享的“关系卡”只包含：
  - 一句关系结论（不含底层信息）
  - “你们最适合的沟通方式”一句
  - 一个“下次就用这句开场”模板
- 明确不包含：生日、星座/类型、命盘字段等敏感信息

#### 6.7.5 关系目标与 30 天计划（对齐“改变与执行”）

Phase 1 建议做“轻量计划”（避免变成复杂任务管理）：
- 允许用户选一个目标：`减少争吵 / 更亲密 / 更高效合作`
- 输出：
  - `7 天微行动`（每天 1 条，极短）
  - `一次复盘问题`（第 7 天问一句）
- `30 天计划`放到 Phase 2（需要更稳定的留存/任务系统）

### 6.8 趋势与执行：Now/Next + Coach Steps（P0 轻量闭环）

> 目标：满足“我现在/未来的趋势注意事项”与“我该怎么一步步做”的需求，且符合 **No Push** 偏好。

#### 6.8.1 趋势表达边界（默认选择）

选择 **A**：
- 不预测具体事件
- 只给：`阶段主题` + `风险/注意点` + `可做的事`

#### 6.8.2 触发方式（No Push）

以 **打开页面立即看到最新的** 为核心：
- 首页或 Chat 顶部的 **Daily Greeting** 作为“今日入口”
- Greeting 内含一个可展开的 **Today One Step**（今日一步）

#### 6.8.3 组件清单（Phase 1）

- `NowNextCard`：当前阶段（Now）/下一阶段（Next）/注意事项（Watch）/建议动作（Do）
- `TodayOneStep`：只给 1 个动作（可一键加入 7 天游程）
- `SevenDayMicroPlan`：Journey 中的“7 天微行动”（只做勾选 + 一句话复盘）

#### 6.8.4 三 Skill 的差异化内容（P0）

- **八字**：以“节律/周期”表达（流月/节气/阶段主题），不做事件预言
- **星座**：以“天象/周期”表达（水逆/新月满月/周主题），不做具体坏事恐吓
- **MBTI**：以“成长焦点”表达（本周更适合练什么：边界/表达/决策/复盘），依据对话与用户自选目标

---

## 7. PC 工作台（A2UI，Phase 1 先预留）

你当前的关键目标是引流/激活，因此 A2UI 可以先做“预留协议 + 粗粒度切换”，不追求完整实现。

- 右侧面板只支持 3 个视图：`default / transit / pattern`
- Agent 不生成 UI，只发 `ui_directive`

参考 `docs/frontend-gemini.md` 的 POC（Vercel AI SDK Data Stream + Zustand）。

---

## 8. 订阅与支付（建议方案，待你确认）

你希望支付通道覆盖：Stripe + 微信 + 支付宝。4 周内建议策略：

1. **先定义“权益与付费墙”**（不用立刻接全支付）
2. **支付接入分批**：
   - P0：Stripe（最快验证订阅转化）
   - P1：微信/支付宝（本地化补齐）

### 8.1 哪些功能付费（建议）

- 免费（引流 + 激活）：首次出盘 + 少量高质量洞察/深入解读
- 付费（持续价值）：
  - 深度解读次数/长报告
  - Mirror（周期回顾）高级版
  - 跨技能洞察（Phase 1.5）

> 价格锚点建议先做 A/B：`¥29/月` vs `¥49/月`（以转化与留存数据为准）。

---

## 9. Vibe ID（登录矩阵与落地节奏）

你希望覆盖：微信、手机、Google、Apple、邮箱。落地建议：

- P0：邮箱 + 手机（低摩擦）  
- P1：微信（国内主力入口）  
- P2：Google/Apple（国际化与 iOS 体验）  

同时保持“渐进注册”的产品原则：不在首次价值前强行登录。

---

## 10. 4 周执行排期（建议）

> 以“质量最重要”为准：每周都要留出打磨时间（动效、排版、细节）。

**Week 1：模板强一致 + 移动端框架**
- 全站统一 Luminous Paper（包括 zodiac/mbti/auth）
- BottomNav（Chat/Chart/Journey/Me）骨架跑通
- Birth Input 胶囊打磨（可跳过字段/默认地点）

**Week 2：洞察卡闭环 + Identity Prism（引流/激活核心）**
- 洞察卡 Bottom Sheet（vaul）
- 分享（复制/海报其一）+ Like + 深入解读入口
- 推演过场（至少 bazi 版）
- Identity Prism（三元视角）在 PC 右栏与 Mobile Me 落地（半常驻）

**Week 3：Chart/档案与“趋势”视图（激活增强）**
- `{skill}/chart`（或修复 `/profile`）最小可用
- Insight Panel 接入真实摘要（哪怕是 P0 简化数据）
- 继续上次对话（local + conversation_id）
- 趋势卡（Now / Next / 注意事项）只展示“阶段主题 + 风险提示 + 可做的事”（不预测具体事件）

**Week 4：Relationship Simulator P0 + 问候/Mirror/付费墙预留**
- Daily Greeting 卡片（仅展示“最新一期”）
- Mirror 卡片（放在 Chat/右栏）
- 订阅权益/付费墙 UI（支付可先 stub）
- Relationship Simulator（传统输入模式 + 可分享关系卡）上线；双用户隐私模式作为 P1 排期

---

## 11. 埋点建议（最少集）

必须埋点（对应引流/激活）：

- `landing_view`（skill）
- `birth_submit`（skill，是否填时辰/性别/地点）
- `deduction_shown`（skill，时长）
- `chart_generated`（skill，成功/失败）
- `chat_first_message_sent`（skill）
- `insight_shown`（type）
- `insight_opened`（type）
- `insight_like`（type）
- `insight_share_click` / `insight_share_complete`
- `identity_prism_viewed`（skill，state=inner|core|outer）
- `identity_prism_toggled`（skill，from→to）
- `relationship_simulator_opened`（skill，mode=solo|pair）
- `relationship_share_click` / `relationship_share_complete`
- `register_prompt_shown`（trigger=save_insight|view_report）
- `register_complete`
- `resume_conversation`（skill）

---

## 12. 非目标（4 周内刻意不做）

- 系统级 push（你明确偏好 No Push）
- 完整跨技能洞察整合（Phase 1.5 之后）
- 完整历史体系（先做“继续上次对话”）

---

> 本文档是 Phase 1 前端落地的唯一真理来源（Source of Truth）。  
> 如需修改优先级，请先改本文档，再改代码。
