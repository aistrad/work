# Vibe Diary 产品重构设计

```
╔═══════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                                                                                   ║
║                              VIBE DIARY: RETHINKING FROM FIRST PRINCIPLES                         ║
║                                                                                                   ║
║                                    "From Fragments to Masterpiece"                                ║
║                                     从碎片到作品                                                   ║
║                                                                                                   ║
╚═══════════════════════════════════════════════════════════════════════════════════════════════════╝

Document Version: 2.0 (First Principles Edition)
Author: Silicon Valley Product Lead
Last Updated: 2026-01-04
```

---

# Part 1: 第一性原理分析

## 1.1 回到本质：用户到底要什么？

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                     FIRST PRINCIPLES: WHAT DO USERS REALLY WANT?               ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   传统日记产品的假设 vs 用户真实需求                                           ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   ┌─────────────────────────────────┬─────────────────────────────────────┐  ║
║   │ 产品假设 (错误)                 │ 用户真实需求                        │  ║
║   ├─────────────────────────────────┼─────────────────────────────────────┤  ║
║   │ 用户想"写日记"                  │ 用户想"被理解"                      │  ║
║   │ 用户需要"坚持记录"              │ 用户需要"有话能说"                  │  ║
║   │ 日记是"私密的"                  │ 生活是"值得分享的"                  │  ║
║   │ 记录是"目的"                    │ 记录是"手段"，成长才是目的          │  ║
║   │ 日记是"文字"                    │ 日记是"生活的艺术品"                │  ║
║   │ 日记是"独立的"                  │ 日记应该"连接一切"                  │  ║
║   └─────────────────────────────────┴─────────────────────────────────────┘  ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   用户的五层需求金字塔:                                                        ║
║                                                                               ║
║                              ╱╲                                               ║
║                             ╱  ╲                                              ║
║                            ╱ 5  ╲   创作：我的生活值得被美丽地呈现             ║
║                           ╱──────╲                                            ║
║                          ╱   4    ╲  分享：我的感受值得被他人看到              ║
║                         ╱──────────╲                                          ║
║                        ╱     3      ╲ 洞察：我想看到自己的模式和成长           ║
║                       ╱──────────────╲                                        ║
║                      ╱       2        ╲ 理解：我想被懂得（哪怕是 AI）          ║
║                     ╱──────────────────╲                                      ║
║                    ╱         1          ╲ 表达：我有话想说，需要出口           ║
║                   ╱──────────────────────╲                                    ║
║                                                                               ║
║   当前产品只满足了 1-3 层，我们要突破到 4-5 层                                ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 1.2 重新定义 Vibe Diary

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                         REDEFINING VIBE DIARY                                  ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   OLD POSITIONING (旧定位)                                                     ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   "AI 情绪日记" — 记录情绪，AI 帮你理解                                        ║
║                                                                               ║
║   问题：还是"记录工具"思维，用户觉得是任务                                     ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   NEW POSITIONING (新定位)                                                     ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   "Your Life, Beautifully Understood"                                   │ ║
║   │   "你的生活，被美丽地理解"                                               │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   Vibe Diary 是你的 AI 共创伙伴：                                        │ ║
║   │                                                                         │ ║
║   │   • 你随便说 → 它帮你创作美丽的日记作品                                  │ ║
║   │   • 你倾诉 → 它帮你连接目标、计划、关系                                  │ ║
║   │   • 你分享 → 它帮你生成可以发朋友圈的内容                                │ ║
║   │                                                                         │ ║
║   │   不是"记录工具"，是"生活创作工作室"                                     │ ║
║   │   不是"你写它存"，是"你说它创"                                           │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   核心价值等式:                                                                ║
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │      碎片输入          AI 转化              多维产出                     │ ║
║   │   ┌──────────┐     ┌──────────┐        ┌──────────────┐                │ ║
║   │   │ 语音     │     │ 理解     │        │ 📖 日记作品   │                │ ║
║   │   │ 文字     │ ──▶ │ 增强     │ ──▶    │ 📤 可分享内容 │                │ ║
║   │   │ 图片     │     │ 美化     │        │ ✅ 待办事项   │                │ ║
║   │   │ 情绪     │     │ 关联     │        │ 🎯 目标追踪   │                │ ║
║   │   └──────────┘     └──────────┘        │ 💡 人生洞察   │                │ ║
║   │                                        └──────────────┘                │ ║
║   │                                                                         │ ║
║   │   用户付出: 最小 (随便说几句)                                            │ ║
║   │   用户获得: 最大 (作品 + 连接 + 洞察)                                    │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 1.3 AI Agent 的角色定位

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                         AI AGENT ROLE DEFINITION                               ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   AI 不是"工具"，是"共创者"                                                    ║
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   TOOL MINDSET (工具思维) ❌                                             │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │   用户：写一段话                                                        │ ║
║   │   AI：存储、分析、返回标签                                               │ ║
║   │   结果：用户还是在"使用工具"                                             │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   CO-CREATOR MINDSET (共创思维) ✅                                       │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │   用户：说几句碎碎念                                                    │ ║
║   │   AI：理解、感知、创作、关联、建议                                       │ ║
║   │   结果：用户感觉在"和伙伴一起创作"                                       │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
║   AI Agent 的六种能力角色:                                                     ║
║                                                                               ║
║   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                            ║
║   │ 👂          │ │ 🎨          │ │ 🔗          │                            ║
║   │ LISTENER    │ │ CREATOR     │ │ CONNECTOR   │                            ║
║   │ 倾听者      │ │ 创作者      │ │ 连接者      │                            ║
║   │             │ │             │ │             │                            ║
║   │ 理解情绪    │ │ 生成美丽    │ │ 关联信息    │                            ║
║   │ 提取语义    │ │ 日记作品    │ │ 到其他系统  │                            ║
║   └─────────────┘ └─────────────┘ └─────────────┘                            ║
║                                                                               ║
║   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                            ║
║   │ 🔮          │ │ 📢          │ │ 🤝          │                            ║
║   │ ANALYST     │ │ PUBLISHER   │ │ ADVISOR     │                            ║
║   │ 分析师      │ │ 发布者      │ │ 建议者      │                            ║
║   │             │ │             │ │             │                            ║
║   │ 发现模式    │ │ 格式化为    │ │ 主动建议    │                            ║
║   │ 生成洞察    │ │ 可分享内容  │ │ 行动方案    │                            ║
║   └─────────────┘ └─────────────┘ └─────────────┘                            ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

---

# Part 2: 核心功能重构

## 2.1 功能架构全景图

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                      VIBE DIARY FEATURE ARCHITECTURE 2.0                       ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║                              ┌─────────────────┐                              ║
║                              │   VIBE DIARY    │                              ║
║                              │   CORE ENGINE   │                              ║
║                              └────────┬────────┘                              ║
║                                       │                                       ║
║      ┌────────────────────────────────┼────────────────────────────────┐     ║
║      │                                │                                │     ║
║      ▼                                ▼                                ▼     ║
║  ┌────────────┐                ┌────────────┐                ┌────────────┐  ║
║  │   INPUT    │                │  TRANSFORM │                │   OUTPUT   │  ║
║  │   LAYER    │       →        │   LAYER    │       →        │   LAYER    │  ║
║  │   输入层   │                │   转化层   │                │   产出层   │  ║
║  └─────┬──────┘                └─────┬──────┘                └─────┬──────┘  ║
║        │                             │                             │         ║
║  ┌─────┴─────┐               ┌───────┴───────┐             ┌───────┴───────┐║
║  │           │               │               │             │               │║
║  │ • 文字输入│               │ • 情绪识别   │             │ • Daily Digest│║
║  │ • 语音输入│               │ • 语义抽取   │             │   每日精美日记│║
║  │ • 图片输入│               │ • 信息关联   │             │               │║
║  │ • 快捷情绪│               │ • 美化创作   │             │ • Life Connect│║
║  │           │               │ • 模式分析   │             │   生活信息连接│║
║  │           │               │               │             │               │║
║  └───────────┘               └───────────────┘             │ • Share Cards │║
║                                                            │   社交分享卡  │║
║                                                            │               │║
║                                                            │ • Insights    │║
║                                                            │   深度洞察    │║
║                                                            │               │║
║                                                            └───────────────┘║
║                                                                               ║
║  ═══════════════════════════════════════════════════════════════════════════ ║
║                                                                               ║
║                           LIFE GRAPH (生活图谱)                               ║
║  ┌─────────────────────────────────────────────────────────────────────────┐ ║
║  │                                                                         │ ║
║  │   👥 People     📍 Places     📅 Events     🎯 Goals     ✅ Todos      │ ║
║  │   人物关系      足迹地图      事件时间线    目标追踪      待办事项      │ ║
║  │                                                                         │ ║
║  │   所有信息自动从日记中抽取，形成结构化的生活数据                        │ ║
║  │                                                                         │ ║
║  └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 2.2 Feature 1: Daily Digest (每日精美日记)

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                              DAILY DIGEST                                      ║
║                      "碎片变作品，每天一幅生活画卷"                             ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   核心理念:                                                                    ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   用户不需要写日记，只需要随便说。                                             ║
║   AI 会在一天结束时，把所有碎片变成一篇美丽的日记作品。                         ║
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   USER INPUT (一天中的碎片输入)                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   08:15  "今天起晚了，赶地铁好累 😫"                                    │ ║
║   │   12:30  "中午吃了超好吃的拉面！推荐！" + [photo.jpg]                   │ ║
║   │   15:20  "开会被怼了，心情有点down"                                     │ ║
║   │   18:45  "下班路上听了最喜欢的播客，心情好点了"                          │ ║
║   │   22:00  "今天虽然有低谷，但也有小确幸"                                  │ ║
║   │                                                                         │ ║
║   │                              │                                          │ ║
║   │                              ▼                                          │ ║
║   │                     ┌────────────────┐                                  │ ║
║   │                     │  AI TRANSFORM  │                                  │ ║
║   │                     │  Digest Engine │                                  │ ║
║   │                     └────────────────┘                                  │ ║
║   │                              │                                          │ ║
║   │                              ▼                                          │ ║
║   │                                                                         │ ║
║   │   AI OUTPUT (Daily Digest 日记作品)                                     │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ┌─────────────────────────────────────────────────────────┐   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │              2026年1月4日 · 周六                         │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   ─────────────────────────────────────────────────     │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   今天是忙碌的一天。                                     │   │   │ ║
║   │   │   │   早起匆忙，在拥挤的地铁里开始了这一天。                  │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   幸运的是，午间的那碗拉面                               │   │   │ ║
║   │   │   │   成了今天的小确幸。                                     │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │          ┌─────────────────┐                            │   │   │ ║
║   │   │   │          │  [拉面照片]     │                            │   │   │ ║
║   │   │   │          │                 │                            │   │   │ ║
║   │   │   │          └─────────────────┘                            │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   下午的会议让心情跌入谷底，                             │   │   │ ║
║   │   │   │   但傍晚的播客陪我走过了回家的路。                        │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   一天有起有落，                                        │   │   │ ║
║   │   │   │   但我记住的是那碗热腾腾的拉面，                         │   │   │ ║
║   │   │   │   和耳机里温暖的声音。                                   │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   ─────────────────────────────────────────────────     │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   情绪轨迹：🌤️ → ☀️ → 🌧️ → 🌤️ → 🌙                    │   │   │ ║
║   │   │   │   能量变化：68 → 72 → 65 → 70                           │   │   │ ║
║   │   │   │   关键词：#工作 #美食 #成长                               │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   └─────────────────────────────────────────────────────────┘   │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   [ 💾 保存 ]  [ ✏️ 编辑 ]  [ 📤 分享 ]  [ 🎨 换风格 ]         │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   DIGEST STYLES (日记风格)                                                    ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            ║
║   │ 📝          │ │ 🎨          │ │ 📰          │ │ 🌸          │            ║
║   │ MINIMAL     │ │ ARTISTIC    │ │ MAGAZINE    │ │ WARM        │            ║
║   │ 极简风      │ │ 文艺风      │ │ 杂志风      │ │ 温暖风      │            ║
║   │             │ │             │ │             │ │             │            ║
║   │ 简洁排版    │ │ 诗意文字    │ │ 标题+配图   │ │ 手账风格    │            ║
║   │ 黑白为主    │ │ 意境插图    │ │ 专业排版    │ │ 贴纸装饰    │            ║
║   └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘            ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   GENERATION TRIGGERS (生成触发)                                              ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   • 自动生成：每天 22:00 自动生成当日 Digest                                  ║
║   • 手动生成：用户随时可以请求生成"到目前为止"的 Digest                       ║
║   • 周期生成：Weekly Digest (周报)、Monthly Digest (月报)                     ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 2.3 Feature 2: Life Connect (生活信息连接)

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                              LIFE CONNECT                                      ║
║                     "你的碎碎念，连接你的一切"                                  ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   核心理念:                                                                    ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   日记不应该是孤岛。                                                          ║
║   你在日记里提到的人、事、计划、目标，都应该自动关联起来。                      ║
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   EXTRACTION PIPELINE (信息抽取流水线)                                  │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   用户输入: "下周三要跟 Lisa 吃饭，别忘了带她的生日礼物"                │ ║
║   │                                                                         │ ║
║   │                              │                                          │ ║
║   │                              ▼                                          │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                     AI EXTRACTION                               │   │ ║
║   │   ├─────────────────────────────────────────────────────────────────┤   │ ║
║   │   │                                                                 │   │ ║
║   │   │   👥 PERSON DETECTED                                            │   │ ║
║   │   │   ┌─────────────────────────────────────────────────────────┐   │   │ ║
║   │   │   │  Name: Lisa                                             │   │   │ ║
║   │   │   │  Relation: 朋友 (推测)                                   │   │   │ ║
║   │   │   │  Event: 生日 (upcoming)                                  │   │   │ ║
║   │   │   │  Action: 添加到联系人 / 更新现有联系人                    │   │   │ ║
║   │   │   └─────────────────────────────────────────────────────────┘   │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   📅 EVENT DETECTED                                             │   │ ║
║   │   │   ┌─────────────────────────────────────────────────────────┐   │   │ ║
║   │   │   │  Type: 社交 / 吃饭                                       │   │   │ ║
║   │   │   │  Time: 下周三 → 2026-01-08                               │   │   │ ║
║   │   │   │  With: Lisa                                              │   │   │ ║
║   │   │   │  Action: 创建日程事件                                    │   │   │ ║
║   │   │   └─────────────────────────────────────────────────────────┘   │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ✅ TODO DETECTED                                              │   │ ║
║   │   │   ┌─────────────────────────────────────────────────────────┐   │   │ ║
║   │   │   │  Task: 准备 Lisa 的生日礼物                               │   │   │ ║
║   │   │   │  Deadline: 下周三之前                                    │   │   │ ║
║   │   │   │  Priority: Medium                                        │   │   │ ║
║   │   │   │  Action: 创建待办事项                                    │   │   │ ║
║   │   │   └─────────────────────────────────────────────────────────┘   │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   │                              │                                          │ ║
║   │                              ▼                                          │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                     USER CONFIRMATION                           │   │ ║
║   │   ├─────────────────────────────────────────────────────────────────┤   │ ║
║   │   │                                                                 │   │ ║
║   │   │   💡 我识别到了一些信息，要帮你添加吗？                          │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ┌─────────────────────────────────────────────────────────┐   │   │ ║
║   │   │   │  📅 添加日程: 和 Lisa 吃饭 (1月8日)          [ ✓ ] [ ✗ ] │   │   │ ║
║   │   │   │  ✅ 添加待办: 准备 Lisa 生日礼物             [ ✓ ] [ ✗ ] │   │   │ ║
║   │   │   │  👥 更新联系人: Lisa 生日提醒               [ ✓ ] [ ✗ ] │   │   │ ║
║   │   │   └─────────────────────────────────────────────────────────┘   │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   [ 全部添加 ]  [ 逐个确认 ]  [ 跳过 ]                          │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   LIFE GRAPH ENTITIES (生活图谱实体)                                          ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   👥 PEOPLE (人物)                                                      │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │   • 自动识别提到的人名                                                  │ ║
║   │   • 推测关系类型（家人/朋友/同事）                                      │ ║
║   │   • 记录互动历史                                                        │ ║
║   │   • 追踪情绪影响（和谁在一起能量高/低）                                 │ ║
║   │                                                                         │ ║
║   │   例：Lisa - 朋友 - 上次互动:12月 - 能量影响:+2.3                       │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   📅 EVENTS (事件)                                                      │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │   • 过去事件：自动归档到时间线                                          │ ║
║   │   • 未来事件：自动创建日程提醒                                          │ ║
║   │   • 重复事件：识别规律（每周例会）                                      │ ║
║   │                                                                         │ ║
║   │   例：和Lisa吃饭 - 2026-01-08 - 已添加到日历                           │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   ✅ TODOS (待办)                                                       │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │   • 从承诺中抽取：用户说"我要..."、"记得..."、"别忘了..."               │ ║
║   │   • 智能截止日期推断                                                    │ ║
║   │   • 关联上下文（为什么要做这件事）                                      │ ║
║   │                                                                         │ ║
║   │   例：准备Lisa生日礼物 - 截止:1月8日 - 来源:日记                        │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   🎯 GOALS (目标)                                                       │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │   • 识别长期目标表达："我想..."、"我的目标是..."                        │ ║
║   │   • 追踪目标相关的日记内容                                              │ ║
║   │   • 自动关联进展                                                        │ ║
║   │                                                                         │ ║
║   │   例：减肥10斤 - 提及次数:15 - 相关日记:8篇 - 进展:40%                  │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   📍 PLACES (地点)                                                      │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │   • 自动识别地点名称                                                    │ ║
║   │   • 记录足迹和频率                                                      │ ║
║   │   • 关联情绪（在哪里心情好/差）                                         │ ║
║   │                                                                         │ ║
║   │   例：公司 - 提及:45次 - 平均能量:-1.2 (需要注意)                       │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 2.4 Feature 3: Share Cards (社交分享卡)

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                              SHARE CARDS                                       ║
║                     "你的生活，值得被美丽地分享"                                ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   核心理念:                                                                    ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   用户想分享生活，但不想暴露太多隐私。                                         ║
║   Share Cards 将日记转化为美观、安全、可分享的社交内容。                        ║
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   CARD TYPES (卡片类型)                                                 │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   TYPE 1: MOMENT CARD (时刻卡)                                          │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │   单条日记 → 美观卡片                                                   │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ┌─────────────────────────────────────────────────────────┐   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   ☀️                                                     │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   "今天发现了一家超棒的咖啡店，                          │   │   │ ║
║   │   │   │    阳光刚好洒在窗边。"                                   │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   ─────────────────────────────────────────────────     │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   2026.01.04 · 小确幸                                   │   │   │ ║
║   │   │   │                                          via Vibe Diary │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   └─────────────────────────────────────────────────────────┘   │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   │   TYPE 2: DAILY CARD (日报卡)                                           │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │   Daily Digest 精简版 → 朋友圈风格                                      │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ┌─────────────────────────────────────────────────────────┐   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   📅 2026年1月4日                                       │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   今日心情：🌤️                                          │   │   │ ║
║   │   │   │   能量值：72/100                                        │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   "忙碌的一天，但有拉面和播客相伴。"                     │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   ─────────────────────────────────────────────────     │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   #工作日 #小确幸 #成长中                                │   │   │ ║
║   │   │   │                                          via Vibe Diary │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   └─────────────────────────────────────────────────────────┘   │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   │   TYPE 3: MILESTONE CARD (里程碑卡)                                     │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │   成就/坚持记录 → 可分享的成就卡                                        │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ┌─────────────────────────────────────────────────────────┐   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   🏆                                                     │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   连续记录 30 天！                                       │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   累计 127 条心情记录                                    │   │   │ ║
║   │   │   │   发现 15 个情绪模式                                     │   │   │ ║
║   │   │   │   能量提升 23%                                          │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   ─────────────────────────────────────────────────     │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   坚持记录，遇见更好的自己                               │   │   │ ║
║   │   │   │                                          via Vibe Diary │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   └─────────────────────────────────────────────────────────┘   │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   │   TYPE 4: INSIGHT CARD (洞察卡)                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │   AI 发现的有趣模式 → 可分享的洞察                                      │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ┌─────────────────────────────────────────────────────────┐   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   💡 我的 AI 发现                                        │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   "你周末的能量比工作日高 40%"                           │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   📊 工作日: ████████░░ 62                               │   │   │ ║
║   │   │   │   📊 周末:   ██████████████ 87                          │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   ─────────────────────────────────────────────────     │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   也许该考虑周三请个假了 😉                              │   │   │ ║
║   │   │   │                                          via Vibe Diary │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   └─────────────────────────────────────────────────────────┘   │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   PRIVACY CONTROL (隐私控制)                                                  ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   分享前的隐私处理:                                                           ║
║   • 自动模糊人名：Lisa → L**                                                 ║
║   • 移除敏感信息：公司名、地址等                                             ║
║   • 用户可手动调整要分享的内容                                               ║
║   • 不同平台不同模板（朋友圈/小红书/微博）                                   ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   EXPORT OPTIONS (导出选项)                                                   ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ 📱 保存图片 ]  [ 📋 复制文案 ]  [ 📤 直接分享 ]                           ║
║                                                                               ║
║   支持平台: 微信 · 朋友圈 · 小红书 · 微博 · Instagram                        ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

---

# Part 3: Web 交互设计

## 3.1 Web-First 设计原则

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                        WEB-FIRST DESIGN PRINCIPLES                             ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   Web 的优势 (要充分利用)                                                      ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            ║
║   │ 🖥️          │ │ ⌨️          │ │ 🖱️          │ │ 🪟          │            ║
║   │ LARGE       │ │ KEYBOARD    │ │ PRECISE     │ │ MULTI-TAB   │            ║
║   │ SCREEN      │ │ INPUT       │ │ POINTER     │ │ WORKFLOW    │            ║
║   │             │ │             │ │             │ │             │            ║
║   │ 大屏幕      │ │ 键盘输入    │ │ 精确点击    │ │ 多标签页    │            ║
║   │ 多栏布局    │ │ 快捷键      │ │ 悬停状态    │ │ 并行工作    │            ║
║   └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘            ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   Web 的限制 (要绕过)                                                          ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                            ║
║   │ 🎙️ ❌        │ │ 📱 ❌        │ │ 🔔 ⚠️        │                            ║
║   │ NO NATIVE   │ │ NO NATIVE   │ │ LIMITED     │                            ║
║   │ VOICE       │ │ SENSORS     │ │ PUSH        │                            ║
║   │             │ │             │ │             │                            ║
║   │ 语音需授权  │ │ 无传感器    │ │ 通知受限    │                            ║
║   │ 用 Web API  │ │ 手动输入    │ │ 用邮件/PWA │                            ║
║   └─────────────┘ └─────────────┘ └─────────────┘                            ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   核心交互原则:                                                                ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   1. KEYBOARD-FIRST (键盘优先)                                                ║
║      • 回车发送消息                                                           ║
║      • Cmd/Ctrl + K 打开搜索                                                  ║
║      • Cmd/Ctrl + N 新建日记                                                  ║
║      • J/K 上下导航                                                           ║
║      • ESC 关闭弹窗                                                           ║
║                                                                               ║
║   2. DRAG & DROP (拖拽支持)                                                   ║
║      • 拖拽图片到输入区                                                       ║
║      • 拖拽文件上传                                                           ║
║      • 拖拽排序日记                                                           ║
║                                                                               ║
║   3. HOVER STATES (悬停状态)                                                  ║
║      • 卡片悬停显示操作按钮                                                   ║
║      • 工具提示                                                               ║
║      • 预览弹窗                                                               ║
║                                                                               ║
║   4. MULTI-PANEL (多面板布局)                                                 ║
║      • 侧边栏导航                                                             ║
║      • 主内容区                                                               ║
║      • 详情面板                                                               ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 3.2 主界面布局

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                         MAIN LAYOUT (DESKTOP WEB)                              ║
║                              1440 x 900 viewport                               ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │ ┌────────┬──────────────────────────────────┬────────────────────────┐  │ ║
║   │ │        │                                  │                        │  │ ║
║   │ │  NAV   │           MAIN STREAM            │     CONTEXT PANEL      │  │ ║
║   │ │  BAR   │                                  │                        │  │ ║
║   │ │        │                                  │                        │  │ ║
║   │ │  64px  │            800px                 │         380px          │  │ ║
║   │ │        │                                  │                        │  │ ║
║   │ │ ┌────┐ │  ┌──────────────────────────┐   │  ┌────────────────────┐ │  │ ║
║   │ │ │ 📝 │ │  │  Magic Input             │   │  │  TODAY'S SUMMARY   │ │  │ ║
║   │ │ │    │ │  │  有什么想说的...   📷 🎙️ │   │  │                    │ │  │ ║
║   │ │ │Home│ │  └──────────────────────────┘   │  │  ⚡ 能量: 72       │ │  │ ║
║   │ │ └────┘ │                                  │  │  📊 记录: 5 条     │ │  │ ║
║   │ │        │  ┌──────────────────────────┐   │  │  🎯 待办: 3 项     │ │  │ ║
║   │ │ ┌────┐ │  │  😢 10:34 AM      ⚡-4   │   │  │                    │ │  │ ║
║   │ │ │ 🔍 │ │  │                          │   │  └────────────────────┘ │  │ ║
║   │ │ │    │ │  │  "今天被老板骂了..."     │   │                        │  │ ║
║   │ │ │搜索│ │  │                          │   │  ┌────────────────────┐ │  │ ║
║   │ │ └────┘ │  │  #Work #Sadness          │   │  │  DAILY DIGEST      │ │  │ ║
║   │ │        │  └──────────────────────────┘   │  │  Preview           │ │  │ ║
║   │ │ ┌────┐ │                                  │  │                    │ │  │ ║
║   │ │ │ 📊 │ │  ┌──────────────────────────┐   │  │  ┌──────────────┐  │ │  │ ║
║   │ │ │    │ │  │  😊 9:15 AM       ⚡+3   │   │  │  │ 今天是忙碌   │  │ │  │ ║
║   │ │ │洞察│ │  │                          │   │  │  │ 的一天...    │  │ │  │ ║
║   │ │ └────┘ │  │  "早起跑了3公里！"       │   │  │  └──────────────┘  │ │  │ ║
║   │ │        │  │                          │   │  │                    │ │  │ ║
║   │ │ ┌────┐ │  │  #Health #Exercise       │   │  │  [ 预览 ] [生成]   │ │  │ ║
║   │ │ │ 📅 │ │  └──────────────────────────┘   │  │                    │ │  │ ║
║   │ │ │    │ │                                  │  └────────────────────┘ │  │ ║
║   │ │ │日历│ │           ...                    │                        │  │ ║
║   │ │ └────┘ │                                  │  ┌────────────────────┐ │  │ ║
║   │ │        │                                  │  │  LIFE CONNECT      │ │  │ ║
║   │ │ ┌────┐ │                                  │  │                    │ │  │ ║
║   │ │ │ ✅ │ │                                  │  │  📅 1 个日程       │ │  │ ║
║   │ │ │    │ │                                  │  │  ✅ 2 个待办       │ │  │ ║
║   │ │ │待办│ │                                  │  │  👥 1 个联系人     │ │  │ ║
║   │ │ └────┘ │                                  │  │                    │ │  │ ║
║   │ │        │                                  │  │  [ 查看详情 ]      │ │  │ ║
║   │ │ ┌────┐ │                                  │  └────────────────────┘ │  │ ║
║   │ │ │ ⚙️ │ │                                  │                        │  │ ║
║   │ │ │设置│ │                                  │                        │  │ ║
║   │ │ └────┘ │                                  │                        │  │ ║
║   │ │        │                                  │                        │  │ ║
║   │ └────────┴──────────────────────────────────┴────────────────────────┘  │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
║   LAYOUT COMPONENTS:                                                          ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   NAV BAR (64px)     - 图标导航，始终可见                                     ║
║   MAIN STREAM (flex) - 核心交互区，Stream + 输入框                            ║
║   CONTEXT PANEL      - 上下文面板，今日摘要/Digest/Life Connect               ║
║                       - 可折叠（按 ] 键）                                     ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 3.3 输入体验设计

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                         INPUT EXPERIENCE (WEB)                                 ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   MAGIC INPUT BAR (输入栏)                                                    ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   DEFAULT STATE (默认状态)                                              │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                 │   │ ║
║   │   │   💭 有什么想说的...                                   📷  🎙️  │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   │   • 单行输入框，聚焦时自动扩展                                          │ ║
║   │   • 右侧：图片上传 + 语音输入                                           │ ║
║   │   • 支持拖拽图片到输入框                                               │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   FOCUSED STATE (聚焦状态)                                              │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                 │   │ ║
║   │   │   今天被老板骂了，心情很差█                                     │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ─────────────────────────────────────────────────────────     │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   😊 😢 😤 😰 😌    快捷情绪                          📷  🎙️  │   │ ║
║   │   │                                                                 │   │ ║
║   │   │                                    Enter 发送 · Shift+Enter 换行│   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   │   • 输入框扩展为多行                                                    │ ║
║   │   • 显示快捷情绪选择                                                   │ ║
║   │   • 底部提示快捷键                                                     │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   WITH IMAGE (带图片)                                                   │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ┌──────────┐                                                  │   │ ║
║   │   │   │  📷      │  ✕                                               │   │ ║
║   │   │   │ [image]  │                                                  │   │ ║
║   │   │   └──────────┘                                                  │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   这家拉面超好吃！█                                             │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ─────────────────────────────────────────────────────────     │   │ ║
║   │   │                                                      📷  🎙️    │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   │   • 图片缩略图预览                                                      │ ║
║   │   • 可删除重选                                                         │ ║
║   │   • 支持多图                                                           │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   VOICE INPUT (语音输入 - Web 版)                                             ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   点击 🎙️ 按钮后:                                                       │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                 │   │ ║
║   │   │              🔴 正在录音...                                     │   │ ║
║   │   │                                                                 │   │ ║
║   │   │              ◉◉◉◉◉◉◉◉◉◉◉◉                                      │   │ ║
║   │   │              (实时波形)                                         │   │ ║
║   │   │                                                                 │   │ ║
║   │   │              [ 停止录音 ]                                       │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   │   Web 语音流程:                                                         │ ║
║   │   1. 点击麦克风 → 请求浏览器权限                                        │ ║
║   │   2. 授权后开始录音（显示波形）                                         │ ║
║   │   3. 点击停止 → 发送到 Whisper API 转写                                 │ ║
║   │   4. 转写结果自动填入输入框                                             │ ║
║   │   5. 用户可编辑后发送                                                   │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 3.4 日记卡片交互

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                         ENTRY CARD INTERACTION                                 ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   CARD STATES (卡片状态)                                                      ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   STATE 1: DEFAULT (默认)                                               │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                 │   │ ║
║   │   │   😢  10:34 AM                                          ⚡-4   │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   "今天被老板骂了，心情很差"                                    │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   #Work  #Sadness                                               │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   STATE 2: HOVER (悬停)                                                 │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                     ┌─────────┐ │   │ ║
║   │   │   😢  10:34 AM                                      │ ✏️ 📤 🗑️│ │   │ ║
║   │   │                                                     └─────────┘ │   │ ║
║   │   │   "今天被老板骂了，心情很差"                                    │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   #Work  #Sadness                                       ⚡-4   │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   │   悬停时显示操作按钮：编辑 / 分享 / 删除                               │ ║
║   │   卡片轻微上移 + 阴影加深                                              │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   STATE 3: EXPANDED (展开 - 点击后)                                     │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                 │   │ ║
║   │   │   😢  10:34 AM · January 4, 2026                        ⚡-4   │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   "今天被老板骂了，心情很差"                                    │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ─────────────────────────────────────────────────────────     │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   EMOTION ANALYSIS                                              │   │ ║
║   │   │   ┌─────────────────────────────────────────────────────────┐   │   │ ║
║   │   │   │  Primary: Sadness        Intensity: ███████░░░ 7/10    │   │   │ ║
║   │   │   │  Secondary: disappointment, frustration                 │   │   │ ║
║   │   │   │  Confidence: 89%                                        │   │   │ ║
║   │   │   └─────────────────────────────────────────────────────────┘   │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   CONTEXT                                                       │   │ ║
║   │   │   ┌─────────────────────────────────────────────────────────┐   │   │ ║
║   │   │   │  📍 Scene: Work   ⚡ Trigger: 被批评   👤 Target: 老板 │   │   │ ║
║   │   │   └─────────────────────────────────────────────────────────┘   │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   #Work  #Sadness  #Boss  #Morning                              │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ─────────────────────────────────────────────────────────     │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   [ ✏️ 编辑 ]  [ 📤 分享 ]  [ 🔗 关联 ]  [ 🗑️ 删除 ]            │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   │   点击展开显示完整分析                                                  │ ║
║   │   点击外部或按 ESC 收起                                                │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 3.5 Daily Digest 交互

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                        DAILY DIGEST INTERACTION                                ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   DIGEST WORKFLOW (生成流程)                                                  ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   STEP 1: TRIGGER (触发)                                                │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   方式 A: 自动触发                                                      │ ║
║   │   • 每天 22:00 自动生成                                                 │ ║
║   │   • 右上角出现通知提示                                                  │ ║
║   │                                                                         │ ║
║   │   方式 B: 手动触发                                                      │ ║
║   │   • 右侧面板点击 "生成今日日记"                                         │ ║
║   │   • 快捷键 Cmd/Ctrl + D                                                 │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   STEP 2: PREVIEW (预览)                                                │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ┌─────────────────────────────────────────────────────────┐   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │              YOUR DAILY DIGEST                          │   │   │ ║
║   │   │   │              2026年1月4日 · 周六                         │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   ─────────────────────────────────────────────────     │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │              今天是忙碌的一天。                          │   │   │ ║
║   │   │   │              早起匆忙，在拥挤的地铁里                     │   │   │ ║
║   │   │   │              开始了这一天。                              │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │              幸运的是，午间的那碗拉面                     │   │   │ ║
║   │   │   │              成了今天的小确幸。                          │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │              ...                                        │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   ─────────────────────────────────────────────────     │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   │   情绪: 🌤️→☀️→🌧️→🌤️    能量: 68→72                    │   │   │ ║
║   │   │   │                                                         │   │   │ ║
║   │   │   └─────────────────────────────────────────────────────────┘   │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   STYLE OPTIONS                                                 │   │ ║
║   │   │   ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐                  │   │ ║
║   │   │   │📝 极简 │ │🎨 文艺 │ │📰 杂志 │ │🌸 温暖 │                  │   │ ║
║   │   │   │  ✓    │ │       │ │       │ │       │                  │   │ ║
║   │   │   └────────┘ └────────┘ └────────┘ └────────┘                  │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   [ ✏️ 编辑内容 ]  [ 🔄 重新生成 ]                               │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ─────────────────────────────────────────────────────────     │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   [ 💾 保存 ]  [ 📤 分享 ]  [ 📱 下载图片 ]                      │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   │   • 实时预览不同风格                                                    │ ║
║   │   • 可编辑 AI 生成的文字                                                │ ║
║   │   • 可重新生成不满意的版本                                              │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   STEP 3: SHARE (分享)                                                  │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   点击 "分享" 后:                                                       │ ║
║   │                                                                         │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                                                                 │   │ ║
║   │   │   选择分享方式                                                  │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   ┌─────────────────────────────────────────────────────────┐   │   │ ║
║   │   │   │  📱 保存为图片         → 下载 PNG/JPG                   │   │   │ ║
║   │   │   │  📋 复制文案           → 复制纯文本到剪贴板              │   │   │ ║
║   │   │   │  🔗 生成分享链接       → 创建公开链接                    │   │   │ ║
║   │   │   └─────────────────────────────────────────────────────────┘   │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   隐私设置                                                      │   │ ║
║   │   │   ┌─────────────────────────────────────────────────────────┐   │   │ ║
║   │   │   │  [✓] 模糊人名 (Lisa → L**)                              │   │   │ ║
║   │   │   │  [✓] 移除地点信息                                        │   │   │ ║
║   │   │   │  [ ] 保留原文 (不做任何修改)                             │   │   │ ║
║   │   │   └─────────────────────────────────────────────────────────┘   │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

---

# Part 4: 数据架构

## 4.1 数据模型扩展

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                         EXTENDED DATA MODEL                                    ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   在现有 stream_entry 基础上扩展:                                              ║
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   NEW TABLE: daily_digest (每日精美日记)                                │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   CREATE TABLE daily_digest (                                           │ ║
║   │     id              UUID PRIMARY KEY,                                   │ ║
║   │     user_id         UUID REFERENCES mentis_user(id),                    │ ║
║   │     date            DATE NOT NULL,                                      │ ║
║   │                                                                         │ ║
║   │     -- 内容                                                             │ ║
║   │     title           TEXT,                      -- AI 生成的标题         │ ║
║   │     content         TEXT NOT NULL,             -- AI 生成的正文         │ ║
║   │     style           VARCHAR(20),               -- minimal/artistic/...  │ ║
║   │                                                                         │ ║
║   │     -- 统计                                                             │ ║
║   │     entry_count     INTEGER,                   -- 当日日记条数          │ ║
║   │     emotion_journey JSONB,                     -- 情绪轨迹              │ ║
║   │     energy_range    JSONB,                     -- {min, max, avg}       │ ║
║   │     key_tags        TEXT[],                    -- 关键标签              │ ║
║   │                                                                         │ ║
║   │     -- 关联                                                             │ ║
║   │     source_entries  UUID[],                    -- 关联的 stream_entry   │ ║
║   │                                                                         │ ║
║   │     -- 分享                                                             │ ║
║   │     is_shared       BOOLEAN DEFAULT FALSE,                              │ ║
║   │     share_url       TEXT,                                               │ ║
║   │     share_settings  JSONB,                     -- 隐私设置              │ ║
║   │                                                                         │ ║
║   │     created_at      TIMESTAMPTZ DEFAULT NOW(),                          │ ║
║   │     updated_at      TIMESTAMPTZ DEFAULT NOW(),                          │ ║
║   │                                                                         │ ║
║   │     UNIQUE(user_id, date)                                               │ ║
║   │   );                                                                    │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   NEW TABLE: life_entity (生活实体)                                     │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   CREATE TABLE life_entity (                                            │ ║
║   │     id              UUID PRIMARY KEY,                                   │ ║
║   │     user_id         UUID REFERENCES mentis_user(id),                    │ ║
║   │                                                                         │ ║
║   │     -- 实体类型                                                         │ ║
║   │     entity_type     VARCHAR(20) NOT NULL,      -- person/place/event/  │ ║
║   │                                                -- goal/todo             │ ║
║   │     -- 基本信息                                                         │ ║
║   │     name            TEXT NOT NULL,                                      │ ║
║   │     description     TEXT,                                               │ ║
║   │     metadata        JSONB,                     -- 类型特定的元数据      │ ║
║   │                                                                         │ ║
║   │     -- 关系                                                             │ ║
║   │     source_entries  UUID[],                    -- 来源日记              │ ║
║   │     related_entities UUID[],                   -- 关联实体              │ ║
║   │                                                                         │ ║
║   │     -- 状态 (用于 todo/goal)                                            │ ║
║   │     status          VARCHAR(20),               -- pending/done/...      │ ║
║   │     due_date        TIMESTAMPTZ,                                        │ ║
║   │                                                                         │ ║
║   │     -- 统计                                                             │ ║
║   │     mention_count   INTEGER DEFAULT 1,                                  │ ║
║   │     avg_energy_impact FLOAT,                   -- 平均能量影响          │ ║
║   │     last_mentioned  TIMESTAMPTZ,                                        │ ║
║   │                                                                         │ ║
║   │     created_at      TIMESTAMPTZ DEFAULT NOW(),                          │ ║
║   │     updated_at      TIMESTAMPTZ DEFAULT NOW()                           │ ║
║   │   );                                                                    │ ║
║   │                                                                         │ ║
║   │   -- 索引                                                               │ ║
║   │   CREATE INDEX idx_life_entity_user_type                                │ ║
║   │     ON life_entity(user_id, entity_type);                               │ ║
║   │   CREATE INDEX idx_life_entity_status                                   │ ║
║   │     ON life_entity(user_id, status)                                     │ ║
║   │     WHERE entity_type IN ('todo', 'goal');                              │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   NEW TABLE: share_card (分享卡片)                                      │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   CREATE TABLE share_card (                                             │ ║
║   │     id              UUID PRIMARY KEY,                                   │ ║
║   │     user_id         UUID REFERENCES mentis_user(id),                    │ ║
║   │                                                                         │ ║
║   │     -- 卡片类型                                                         │ ║
║   │     card_type       VARCHAR(20) NOT NULL,      -- moment/daily/         │ ║
║   │                                                -- milestone/insight     │ ║
║   │     -- 内容                                                             │ ║
║   │     content         JSONB NOT NULL,            -- 卡片内容数据          │ ║
║   │     style           VARCHAR(20),                                        │ ║
║   │                                                                         │ ║
║   │     -- 来源                                                             │ ║
║   │     source_type     VARCHAR(20),               -- entry/digest/insight  │ ║
║   │     source_id       UUID,                                               │ ║
║   │                                                                         │ ║
║   │     -- 分享                                                             │ ║
║   │     share_url       TEXT UNIQUE,                                        │ ║
║   │     privacy_settings JSONB,                                             │ ║
║   │     view_count      INTEGER DEFAULT 0,                                  │ ║
║   │     expires_at      TIMESTAMPTZ,               -- 过期时间              │ ║
║   │                                                                         │ ║
║   │     created_at      TIMESTAMPTZ DEFAULT NOW()                           │ ║
║   │   );                                                                    │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 4.2 信息抽取数据流

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                         INFORMATION EXTRACTION FLOW                            ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   USER INPUT                                                            │ ║
║   │   "下周三要跟 Lisa 吃饭，别忘了带她的生日礼物"                          │ ║
║   │                              │                                          │ ║
║   │                              ▼                                          │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                     EXTRACTION ENGINE                           │   │ ║
║   │   ├─────────────────────────────────────────────────────────────────┤   │ ║
║   │   │                                                                 │   │ ║
║   │   │   PROMPT:                                                       │   │ ║
║   │   │   ─────────────────────────────────────────────────────────     │   │ ║
║   │   │   分析以下文本，提取结构化信息：                                 │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   1. PERSON: 人物 (姓名, 推测关系, 相关事件)                    │   │ ║
║   │   │   2. EVENT: 事件 (类型, 时间, 参与者)                           │   │ ║
║   │   │   3. TODO: 待办 (任务, 截止时间, 优先级)                        │   │ ║
║   │   │   4. GOAL: 目标 (描述, 类型)                                    │   │ ║
║   │   │   5. PLACE: 地点 (名称, 类型)                                   │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   文本: "{input}"                                               │   │ ║
║   │   │   当前日期: 2026-01-04                                          │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                              │                                          │ ║
║   │                              ▼                                          │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                     EXTRACTED DATA                              │   │ ║
║   │   ├─────────────────────────────────────────────────────────────────┤   │ ║
║   │   │                                                                 │   │ ║
║   │   │   {                                                             │   │ ║
║   │   │     "persons": [{                                               │   │ ║
║   │   │       "name": "Lisa",                                           │   │ ║
║   │   │       "relation": "friend",                                     │   │ ║
║   │   │       "event": "birthday"                                       │   │ ║
║   │   │     }],                                                         │   │ ║
║   │   │     "events": [{                                                │   │ ║
║   │   │       "type": "social",                                         │   │ ║
║   │   │       "title": "和 Lisa 吃饭",                                  │   │ ║
║   │   │       "datetime": "2026-01-08",                                 │   │ ║
║   │   │       "participants": ["Lisa"]                                  │   │ ║
║   │   │     }],                                                         │   │ ║
║   │   │     "todos": [{                                                 │   │ ║
║   │   │       "title": "准备 Lisa 的生日礼物",                          │   │ ║
║   │   │       "due_date": "2026-01-08",                                 │   │ ║
║   │   │       "priority": "medium",                                     │   │ ║
║   │   │       "context": "Lisa 生日"                                    │   │ ║
║   │   │     }]                                                          │   │ ║
║   │   │   }                                                             │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                              │                                          │ ║
║   │                              ▼                                          │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                     USER CONFIRMATION                           │   │ ║
║   │   ├─────────────────────────────────────────────────────────────────┤   │ ║
║   │   │                                                                 │   │ ║
║   │   │   弹出确认面板，用户可以：                                       │   │ ║
║   │   │   • 确认全部                                                    │   │ ║
║   │   │   • 逐个确认/修改                                               │   │ ║
║   │   │   • 跳过                                                        │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   设置偏好：                                                    │   │ ║
║   │   │   [ ] 今后自动添加类似信息 (不再询问)                           │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                              │                                          │ ║
║   │                              ▼                                          │ ║
║   │   ┌─────────────────────────────────────────────────────────────────┐   │ ║
║   │   │                     PERSIST TO DATABASE                         │   │ ║
║   │   ├─────────────────────────────────────────────────────────────────┤   │ ║
║   │   │                                                                 │   │ ║
║   │   │   INSERT INTO life_entity (...)                                 │   │ ║
║   │   │   • Person: Lisa                                                │   │ ║
║   │   │   • Event: 和 Lisa 吃饭                                        │   │ ║
║   │   │   • Todo: 准备礼物                                              │   │ ║
║   │   │                                                                 │   │ ║
║   │   │   UPDATE stream_entry SET                                       │   │ ║
║   │   │     extracted_entities = [...]                                  │   │ ║
║   │   │                                                                 │   │ ║
║   │   └─────────────────────────────────────────────────────────────────┘   │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

---

# Part 5: 核心算法

## 5.1 Daily Digest 生成算法

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                      DAILY DIGEST GENERATION ALGORITHM                         ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   ┌─────────────────────────────────────────────────────────────────────────┐ ║
║   │                                                                         │ ║
║   │   STEP 1: AGGREGATE (聚合当日数据)                                      │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   SELECT * FROM stream_entry                                            │ ║
║   │   WHERE user_id = :userId                                               │ ║
║   │   AND DATE(created_at) = :date                                          │ ║
║   │   ORDER BY created_at ASC;                                              │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   STEP 2: ANALYZE (分析情绪轨迹)                                        │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   emotion_journey = entries.map(e => ({                                 │ ║
║   │     time: e.created_at,                                                 │ ║
║   │     emotion: e.emotion.primary,                                         │ ║
║   │     intensity: e.emotion.intensity,                                     │ ║
║   │     energy: calculateEnergyAtTime(e)                                    │ ║
║   │   }));                                                                  │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   STEP 3: IDENTIFY KEY MOMENTS (识别关键时刻)                           │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   key_moments = []                                                      │ ║
║   │                                                                         │ ║
║   │   // 情绪高点/低点                                                      │ ║
║   │   key_moments.push(findEmotionPeaks(emotion_journey))                   │ ║
║   │   key_moments.push(findEmotionValleys(emotion_journey))                 │ ║
║   │                                                                         │ ║
║   │   // 有图片的记录                                                       │ ║
║   │   key_moments.push(entries.filter(e => e.media_urls?.length > 0))       │ ║
║   │                                                                         │ ║
║   │   // 能量变化最大的记录                                                 │ ║
║   │   key_moments.push(findLargestEnergyChange(entries))                    │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   STEP 4: GENERATE NARRATIVE (生成叙事)                                 │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   PROMPT:                                                               │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │   你是一位富有诗意的日记作者。                                          │ ║
║   │   根据以下一天的碎片记录，创作一篇优美的日记。                           │ ║
║   │                                                                         │ ║
║   │   要求：                                                                │ ║
║   │   1. 用第一人称                                                        │ ║
║   │   2. 将碎片串联成有叙事性的故事                                        │ ║
║   │   3. 保留原文的情感基调                                                │ ║
║   │   4. 添加适当的文学修饰，但不要过度                                     │ ║
║   │   5. 如果有图片，描述图片代表的时刻                                     │ ║
║   │   6. 结尾总结这一天的感悟                                              │ ║
║   │   7. 风格：{style}                                                     │ ║
║   │                                                                         │ ║
║   │   日期：{date}                                                          │ ║
║   │   记录：{entries_json}                                                  │ ║
║   │   关键时刻：{key_moments_json}                                          │ ║
║   │   情绪轨迹：{emotion_journey_json}                                      │ ║
║   │                                                                         │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   STEP 5: FORMAT & STORE (格式化存储)                                   │ ║
║   │   ─────────────────────────────────────────────────────────────────     │ ║
║   │                                                                         │ ║
║   │   INSERT INTO daily_digest (                                            │ ║
║   │     user_id, date, title, content, style,                               │ ║
║   │     entry_count, emotion_journey, energy_range,                         │ ║
║   │     key_tags, source_entries                                            │ ║
║   │   ) VALUES (...);                                                       │ ║
║   │                                                                         │ ║
║   └─────────────────────────────────────────────────────────────────────────┘ ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 5.2 生活实体识别算法

```typescript
// 生活实体识别核心算法

interface ExtractionResult {
  persons: PersonEntity[];
  events: EventEntity[];
  todos: TodoEntity[];
  goals: GoalEntity[];
  places: PlaceEntity[];
}

const EXTRACTION_PROMPT = `
分析以下文本，提取结构化信息。

规则：
1. PERSON (人物)
   - 识别提到的人名
   - 推测关系类型: family/friend/colleague/other
   - 识别相关事件: birthday/meeting/...

2. EVENT (事件)
   - 识别事件类型: social/work/health/travel/...
   - 解析时间表达: "下周三" → 具体日期
   - 识别参与者

3. TODO (待办)
   - 识别承诺性表达: "要..."、"记得..."、"别忘了..."
   - 推断截止时间
   - 评估优先级: high/medium/low

4. GOAL (目标)
   - 识别长期目标表达: "我想..."、"目标是..."
   - 分类: health/career/relationship/finance/...

5. PLACE (地点)
   - 识别地点名称
   - 分类: home/work/restaurant/...

当前日期: {current_date}
用户已有联系人: {existing_contacts}

文本: "{input}"

返回 JSON 格式。
`;

async function extractLifeEntities(
  input: string,
  userId: string
): Promise<ExtractionResult> {
  
  // 获取用户已有联系人，用于更好地识别
  const existingContacts = await getExistingContacts(userId);
  
  const prompt = EXTRACTION_PROMPT
    .replace('{current_date}', new Date().toISOString().split('T')[0])
    .replace('{existing_contacts}', JSON.stringify(existingContacts))
    .replace('{input}', input);
  
  const response = await llm.complete({
    model: 'gpt-4-turbo',
    prompt,
    response_format: { type: 'json_object' },
  });
  
  const extracted = JSON.parse(response);
  
  // 后处理：去重、关联已有实体
  const result = await postProcess(extracted, userId);
  
  return result;
}

// 判断是否需要用户确认
function shouldAskConfirmation(result: ExtractionResult): boolean {
  // 低置信度的抽取需要确认
  // 新人物需要确认
  // 涉及日程/待办的需要确认
  
  const hasNewPerson = result.persons.some(p => !p.existingId);
  const hasCalendarEvent = result.events.some(e => e.datetime);
  const hasTodo = result.todos.length > 0;
  
  return hasNewPerson || hasCalendarEvent || hasTodo;
}
```

---

# Part 6: 总结

## 6.1 核心创新点

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                           KEY INNOVATIONS                                      ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   1. FROM FRAGMENTS TO MASTERPIECE (碎片变作品)                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   用户随便说 → AI 创作美丽的 Daily Digest                                     ║
║   解决了"日记太丑不想分享"的问题                                              ║
║                                                                               ║
║   2. LIFE CONNECT (生活连接)                                                  ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   自动从日记中抽取人物/事件/待办/目标                                         ║
║   打破日记作为信息孤岛的困境                                                  ║
║                                                                               ║
║   3. SHAREABLE BY DEFAULT (天生可分享)                                        ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   多种分享卡片格式，内置隐私保护                                              ║
║   让分享生活变得简单和安全                                                    ║
║                                                                               ║
║   4. WEB-FIRST EXCELLENCE (Web 优先卓越体验)                                  ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   充分利用 Web 优势：键盘快捷键、多面板、拖拽                                 ║
║   不是 App 的缩水版，而是 Web 的最佳实践                                      ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 6.2 MVP 优先级

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                           MVP PRIORITY                                         ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   P0 - MUST HAVE (必须有)                                                     ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   ✅ 基础日记输入 (文字/图片)                                                 ║
║   ✅ 情绪识别 + 即时反馈                                                      ║
║   ✅ Daily Digest 自动生成                                                    ║
║   ✅ 基础分享功能 (下载图片)                                                  ║
║                                                                               ║
║   P1 - SHOULD HAVE (应该有)                                                   ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   📋 Life Connect - 待办抽取                                                  ║
║   📋 Life Connect - 日程抽取                                                  ║
║   📋 多种 Digest 风格                                                         ║
║   📋 语音输入 (Web Speech API)                                                ║
║                                                                               ║
║   P2 - NICE TO HAVE (锦上添花)                                                ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   💡 Life Connect - 人物关系图                                                ║
║   💡 Life Connect - 目标追踪                                                  ║
║   💡 分享链接生成                                                             ║
║   💡 Weekly/Monthly Digest                                                    ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

---

```
╚═══════════════════════════════════════════════════════════════════════════════╝
```

---

# Part 7: 详细实现计划

## 7.1 实现路线图

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                         IMPLEMENTATION ROADMAP                                 ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   PHASE 1: LLM 情绪引擎增强                                                   ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   ██████████████████████████████████████████████████████████████████  100%  ║
║                                                                               ║
║   后端:                                                                       ║
║   • services/llm_emotion_engine.py - LLM 驱动情绪分析                        ║
║   • services/prompts.py - Prompt 模板管理                                    ║
║   • 修改 stream_processor.py - 集成混合分析                                  ║
║                                                                               ║
║   数据库:                                                                     ║
║   • ALTER stream_entry ADD llm_emotion JSONB                                 ║
║   • ALTER stream_entry ADD extracted_entities UUID[]                         ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   PHASE 2: Daily Digest 功能                                                  ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   ██████████████████████████████████████████████████████████████████  100%  ║
║                                                                               ║
║   后端:                                                                       ║
║   • 创建 daily_digest 表                                                     ║
║   • services/daily_digest_service.py - Digest 生成                          ║
║   • api/digest_routes.py - Digest API                                        ║
║                                                                               ║
║   前端:                                                                       ║
║   • components/digest/ 目录                                                  ║
║   • digest-viewer.tsx, emotion-timeline.tsx                                  ║
║   • style-selector.tsx, digest-preview.tsx                                   ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   PHASE 3: Life Connect 功能                                                  ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   ██████████████████████████████████████████████████████████████████  100%  ║
║                                                                               ║
║   后端:                                                                       ║
║   • 创建 life_entity 表                                                      ║
║   • services/life_connect_service.py - 实体抽取与管理                        ║
║   • api/entity_routes.py - Entity API                                        ║
║                                                                               ║
║   前端:                                                                       ║
║   • components/life/ 目录                                                    ║
║   • entity-list.tsx, entity-card.tsx                                         ║
║   • confirm-dialog.tsx                                                        ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   PHASE 4: Share Cards 功能                                                   ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   ██████████████████████████████████████████████████████████████████  100%  ║
║                                                                               ║
║   后端:                                                                       ║
║   • 创建 share_card 表                                                       ║
║   • services/share_card_service.py - 卡片生成                                ║
║   • api/share_routes.py - Share API                                          ║
║                                                                               ║
║   前端:                                                                       ║
║   • components/share/ 目录                                                   ║
║   • card-creator.tsx, card-preview.tsx                                       ║
║   • template-picker.tsx, privacy-settings.tsx                                ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   PHASE 5: 集成测试与优化                                                     ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║   ██████████████████████████████████████████████████████████████████  100%  ║
║                                                                               ║
║   • 端到端测试所有功能                                                        ║
║   • 性能优化 (LLM 调用缓存)                                                  ║
║   • 错误处理完善                                                              ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 7.2 Phase 1 详细实现清单

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                     PHASE 1: LLM EMOTION ENGINE                               ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   [ ] 1.1 创建 services/prompts.py                                           ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   EMOTION_ANALYSIS_PROMPT = '''                                               ║
║   分析以下用户日记文本的情绪状态。                                             ║
║                                                                               ║
║   文本: "{text}"                                                              ║
║                                                                               ║
║   请返回 JSON 格式:                                                           ║
║   {                                                                           ║
║     "primary_emotion": "joy|sadness|anger|fear|anxiety|calm|...",            ║
║     "intensity": 1-10,                                                        ║
║     "secondary_emotions": ["emotion1", "emotion2"],                          ║
║     "confidence": 0.0-1.0,                                                    ║
║     "energy_delta": -5 到 +5,                                                ║
║     "context": {                                                              ║
║       "scene": "work|home|social|...",                                       ║
║       "trigger": "触发原因",                                                  ║
║       "target": "情绪对象"                                                    ║
║     },                                                                        ║
║     "nuanced_feeling": "更细腻的情感描述",                                    ║
║     "suggested_tags": ["tag1", "tag2"]                                       ║
║   }                                                                           ║
║   '''                                                                         ║
║                                                                               ║
║   ENTITY_EXTRACTION_PROMPT = '''                                              ║
║   从以下文本中提取结构化生活信息:                                              ║
║                                                                               ║
║   1. PERSON: 人物 (姓名, 关系, 相关事件)                                      ║
║   2. EVENT: 事件 (类型, 时间, 参与者)                                         ║
║   3. TODO: 待办 (任务, 截止时间, 优先级)                                      ║
║   4. GOAL: 目标 (描述, 类型)                                                  ║
║   5. PLACE: 地点 (名称, 类型)                                                 ║
║                                                                               ║
║   文本: "{text}"                                                              ║
║   当前日期: {current_date}                                                    ║
║   '''                                                                         ║
║                                                                               ║
║   DIGEST_PROSE_PROMPT = '''                                                   ║
║   你是一位富有诗意的日记作者。                                                 ║
║   根据以下一天的碎片记录，创作一篇优美的日记。                                  ║
║                                                                               ║
║   风格: {style}  (minimal/artistic/magazine/warm)                            ║
║   日期: {date}                                                                ║
║   记录: {entries}                                                             ║
║   情绪轨迹: {emotion_journey}                                                 ║
║   '''                                                                         ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ ] 1.2 创建 services/llm_emotion_engine.py                                ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   class LLMEmotionEngine:                                                     ║
║       async def analyze(text: str) -> LLMEmotionResult                       ║
║       async def extract_entities(text: str) -> List[LifeEntity]              ║
║                                                                               ║
║   async def hybrid_emotion_analyze(                                           ║
║       text: str,                                                              ║
║       rule_result: EmotionResult                                              ║
║   ) -> LLMEmotionResult:                                                      ║
║       '''                                                                     ║
║       混合分析策略:                                                            ║
║       - 规则引擎快速识别 (< 50ms)                                             ║
║       - 高强度(>=7) 或 低置信度(<0.7) 时调用 LLM                              ║
║       '''                                                                     ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ ] 1.3 修改 services/stream_processor.py                                  ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   在 process_stream() 中添加:                                                 ║
║   1. 调用 hybrid_emotion_analyze()                                           ║
║   2. 调用 extract_entities() (如果启用 Life Connect)                         ║
║   3. 新增 SSE 事件: llm_analysis_complete                                    ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ ] 1.4 数据库迁移                                                          ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   ALTER TABLE stream_entry ADD COLUMN llm_emotion JSONB;                     ║
║   ALTER TABLE stream_entry ADD COLUMN extracted_entities UUID[];             ║
║   CREATE INDEX idx_stream_llm_emotion ON stream_entry USING GIN(llm_emotion);║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 7.3 Phase 2 详细实现清单

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                     PHASE 2: DAILY DIGEST                                     ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   [ ] 2.1 创建 daily_digest 数据表                                           ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   CREATE TABLE daily_digest (                                                 ║
║     id UUID PRIMARY KEY DEFAULT gen_random_uuid(),                           ║
║     user_id UUID REFERENCES mentis_user(id),                                 ║
║     date DATE NOT NULL,                                                       ║
║     title TEXT,                                                               ║
║     summary TEXT,                                                             ║
║     prose TEXT NOT NULL,                                                      ║
║     style VARCHAR(20) DEFAULT 'minimal',                                     ║
║     emotion_trajectory JSONB,                                                 ║
║     energy_curve JSONB,                                                       ║
║     key_tags TEXT[],                                                          ║
║     entry_count INTEGER,                                                      ║
║     source_entries UUID[],                                                    ║
║     is_shared BOOLEAN DEFAULT FALSE,                                         ║
║     share_url TEXT,                                                           ║
║     share_settings JSONB,                                                     ║
║     created_at TIMESTAMPTZ DEFAULT NOW(),                                    ║
║     updated_at TIMESTAMPTZ DEFAULT NOW(),                                    ║
║     UNIQUE(user_id, date)                                                     ║
║   );                                                                          ║
║                                                                               ║
║   CREATE INDEX idx_digest_user_date ON daily_digest(user_id, date DESC);     ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ ] 2.2 创建 services/daily_digest_service.py                              ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   class DailyDigestService:                                                   ║
║       async def generate_digest(user_id, date, style) -> Digest              ║
║       async def get_emotion_trajectory(user_id, date) -> List                ║
║       async def get_energy_curve(user_id, date) -> List                      ║
║       async def regenerate_digest(digest_id, style) -> Digest                ║
║       async def get_digest_by_date(user_id, date) -> Optional[Digest]        ║
║       async def list_digests(user_id, limit, offset) -> List[Digest]         ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ ] 2.3 创建 api/digest_routes.py                                          ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   @router.get("/v3/digest")                                                   ║
║   async def list_digests(user_id, limit=30, offset=0)                        ║
║                                                                               ║
║   @router.get("/v3/digest/{date}")                                            ║
║   async def get_digest(user_id, date: str)                                   ║
║                                                                               ║
║   @router.post("/v3/digest/{date}/generate")                                  ║
║   async def generate_digest(user_id, date: str, style: str = "minimal")      ║
║                                                                               ║
║   @router.put("/v3/digest/{id}/style")                                        ║
║   async def update_style(digest_id, style: str)                              ║
║                                                                               ║
║   @router.get("/v3/digest/{date}/trajectory")                                 ║
║   async def get_trajectory(user_id, date: str)                               ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ ] 2.4 前端组件 components/digest/                                         ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   digest-viewer.tsx       - 日记查看器主组件                                  ║
║   digest-card.tsx         - 日记卡片 (列表用)                                 ║
║   emotion-timeline.tsx    - 情绪时间线可视化                                  ║
║   energy-curve.tsx        - 能量曲线图表                                      ║
║   style-selector.tsx      - 风格选择器 (minimal/artistic/magazine/warm)      ║
║   digest-editor.tsx       - 日记编辑器 (可选)                                 ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 7.4 Phase 3 详细实现清单

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                     PHASE 3: LIFE CONNECT                                     ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   [ ] 3.1 创建 life_entity 数据表                                            ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   CREATE TABLE life_entity (                                                  ║
║     id UUID PRIMARY KEY DEFAULT gen_random_uuid(),                           ║
║     user_id UUID REFERENCES mentis_user(id),                                 ║
║     entity_type VARCHAR(20) NOT NULL,  -- person/event/todo/goal/place       ║
║     name TEXT NOT NULL,                                                       ║
║     description TEXT,                                                         ║
║     metadata JSONB,                                                           ║
║     source_entries UUID[],                                                    ║
║     related_entities UUID[],                                                  ║
║     status VARCHAR(20),                -- pending/confirmed/done/dismissed   ║
║     due_date TIMESTAMPTZ,                                                     ║
║     mention_count INTEGER DEFAULT 1,                                          ║
║     avg_energy_impact FLOAT,                                                  ║
║     last_mentioned TIMESTAMPTZ,                                               ║
║     confirmed BOOLEAN DEFAULT FALSE,                                          ║
║     created_at TIMESTAMPTZ DEFAULT NOW(),                                    ║
║     updated_at TIMESTAMPTZ DEFAULT NOW()                                     ║
║   );                                                                          ║
║                                                                               ║
║   CREATE INDEX idx_entity_user_type ON life_entity(user_id, entity_type);    ║
║   CREATE INDEX idx_entity_status ON life_entity(user_id, status)             ║
║     WHERE entity_type IN ('todo', 'goal');                                    ║
║   CREATE INDEX idx_entity_pending ON life_entity(user_id)                    ║
║     WHERE confirmed = FALSE;                                                  ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ ] 3.2 创建 services/life_connect_service.py                              ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   class LifeConnectService:                                                   ║
║       async def extract_entities(stream_id, content, llm_result) -> List     ║
║       async def merge_or_create(user_id, entity) -> Entity                   ║
║       async def get_pending(user_id) -> List[Entity]                         ║
║       async def confirm_entity(user_id, entity_id) -> Entity                 ║
║       async def dismiss_entity(user_id, entity_id) -> None                   ║
║       async def list_entities(user_id, type=None) -> List[Entity]            ║
║       async def get_people(user_id) -> List[PersonEntity]                    ║
║       async def get_todos(user_id, status=None) -> List[TodoEntity]          ║
║       async def get_goals(user_id) -> List[GoalEntity]                       ║
║       async def complete_todo(user_id, todo_id) -> TodoEntity                ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ ] 3.3 创建 api/entity_routes.py                                          ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   @router.get("/v3/entities")                                                 ║
║   async def list_entities(user_id, type=None)                                ║
║                                                                               ║
║   @router.get("/v3/entities/pending")                                         ║
║   async def get_pending(user_id)                                             ║
║                                                                               ║
║   @router.post("/v3/entities/{id}/confirm")                                   ║
║   async def confirm_entity(user_id, entity_id)                               ║
║                                                                               ║
║   @router.post("/v3/entities/{id}/dismiss")                                   ║
║   async def dismiss_entity(user_id, entity_id)                               ║
║                                                                               ║
║   @router.get("/v3/entities/people")                                          ║
║   async def get_people(user_id)                                              ║
║                                                                               ║
║   @router.get("/v3/entities/todos")                                           ║
║   async def get_todos(user_id, status=None)                                  ║
║                                                                               ║
║   @router.post("/v3/entities/todos/{id}/complete")                            ║
║   async def complete_todo(user_id, todo_id)                                  ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ ] 3.4 前端组件 components/life/                                           ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   entity-list.tsx         - 实体列表容器                                      ║
║   entity-card.tsx         - 实体卡片                                          ║
║   confirm-dialog.tsx      - 确认弹窗                                          ║
║   pending-entities.tsx    - 待确认实体面板                                    ║
║   people-section.tsx      - 人物板块                                          ║
║   todos-section.tsx       - 待办板块                                          ║
║   goals-section.tsx       - 目标板块                                          ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 7.5 Phase 4 详细实现清单

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                     PHASE 4: SHARE CARDS                                      ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   [ ] 4.1 创建 share_card 数据表                                             ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   CREATE TABLE share_card (                                                   ║
║     id UUID PRIMARY KEY DEFAULT gen_random_uuid(),                           ║
║     user_id UUID REFERENCES mentis_user(id),                                 ║
║     card_type VARCHAR(20) NOT NULL,  -- moment/daily/milestone/insight       ║
║     title TEXT,                                                               ║
║     content JSONB NOT NULL,                                                   ║
║     template VARCHAR(30) DEFAULT 'default',                                  ║
║     style JSONB,                                                              ║
║     source_type VARCHAR(20),          -- entry/digest/insight                ║
║     source_id UUID,                                                           ║
║     share_token VARCHAR(64) UNIQUE,                                          ║
║     is_public BOOLEAN DEFAULT FALSE,                                         ║
║     privacy_settings JSONB,                                                   ║
║     image_url TEXT,                                                           ║
║     view_count INTEGER DEFAULT 0,                                            ║
║     expires_at TIMESTAMPTZ,                                                   ║
║     created_at TIMESTAMPTZ DEFAULT NOW()                                     ║
║   );                                                                          ║
║                                                                               ║
║   CREATE INDEX idx_share_user ON share_card(user_id, created_at DESC);       ║
║   CREATE INDEX idx_share_token ON share_card(share_token)                    ║
║     WHERE is_public = TRUE;                                                   ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ ] 4.2 创建 services/share_card_service.py                                ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   class ShareCardService:                                                     ║
║       async def create_card(user_id, card_type, source_id, template) -> Card ║
║       async def apply_privacy(content, settings) -> Tuple[content, redacted] ║
║       async def generate_image(card_id, format='png') -> str                 ║
║       async def create_share_link(card_id) -> str                            ║
║       async def get_public_card(token) -> Optional[Card]                     ║
║       async def list_cards(user_id) -> List[Card]                            ║
║       async def delete_card(user_id, card_id) -> None                        ║
║                                                                               ║
║   CARD TEMPLATES:                                                             ║
║   - moment: 单条日记 → 美观卡片                                               ║
║   - daily: Daily Digest 精简版                                                ║
║   - milestone: 成就卡 (连续记录、能量提升等)                                  ║
║   - insight: AI 洞察卡                                                        ║
║                                                                               ║
║   PRIVACY SETTINGS:                                                           ║
║   - blur_names: 模糊人名 (Lisa → L**)                                        ║
║   - remove_places: 移除地点信息                                               ║
║   - keep_original: 保留原文                                                   ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ ] 4.3 创建 api/share_routes.py                                           ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   @router.post("/v3/share/card")                                              ║
║   async def create_card(user_id, card_type, source_id, template, privacy)    ║
║                                                                               ║
║   @router.get("/v3/share/cards")                                              ║
║   async def list_cards(user_id)                                              ║
║                                                                               ║
║   @router.post("/v3/share/cards/{id}/image")                                  ║
║   async def generate_image(user_id, card_id, format='png')                   ║
║                                                                               ║
║   @router.post("/v3/share/cards/{id}/publish")                                ║
║   async def publish_card(user_id, card_id)                                   ║
║                                                                               ║
║   @router.delete("/v3/share/cards/{id}")                                      ║
║   async def delete_card(user_id, card_id)                                    ║
║                                                                               ║
║   @router.get("/v3/public/{token}")  # 无需认证                               ║
║   async def get_public_card(token: str)                                      ║
║                                                                               ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ ] 4.4 前端组件 components/share/                                          ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   card-creator.tsx        - 卡片创建器                                        ║
║   card-preview.tsx        - 卡片预览                                          ║
║   template-picker.tsx     - 模板选择器                                        ║
║   privacy-settings.tsx    - 隐私设置                                          ║
║   share-dialog.tsx        - 分享弹窗                                          ║
║   card-gallery.tsx        - 卡片库                                            ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 7.6 关键技术决策

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                     TECHNICAL DECISIONS                                       ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   LLM 选择策略                                                                ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   ┌─────────────────┬─────────────────┬─────────────────┐                    ║
║   │ 场景            │ 首选 LLM        │ 备选 LLM        │                    ║
║   ├─────────────────┼─────────────────┼─────────────────┤                    ║
║   │ 情绪深度分析    │ GLM-4-Flash    │ Gemini Flash    │                    ║
║   │ 实体抽取        │ GLM-4-Flash    │ Gemini Flash    │                    ║
║   │ Digest 生成     │ GLM-4          │ GPT-4-Turbo     │                    ║
║   │ Embedding       │ Gemini (3072维) │ text-embedding-3│                   ║
║   └─────────────────┴─────────────────┴─────────────────┘                    ║
║                                                                               ║
║   混合分析模式                                                                ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   1. 规则引擎快速识别 (< 50ms)                                                ║
║   2. 触发 LLM 条件:                                                           ║
║      - intensity >= 7 (高强度情绪)                                           ║
║      - confidence < 0.7 (低置信度)                                           ║
║      - 文本长度 > 50 字符                                                     ║
║   3. LLM 结果增强规则结果，不替换                                             ║
║                                                                               ║
║   图片生成方案                                                                ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   方案: Playwright 渲染 HTML → 截图                                          ║
║   - 使用 React 组件渲染卡片                                                   ║
║   - Playwright 加载页面截图                                                   ║
║   - 输出 PNG/JPG 格式                                                         ║
║   - 支持多种尺寸 (1:1, 16:9, 9:16)                                           ║
║                                                                               ║
║   向量搜索                                                                    ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   - Pinecone 作为向量数据库                                                   ║
║   - Gemini Embedding (3072 维)                                                ║
║   - 用于实体去重和相似性匹配                                                  ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 7.7 文件清单

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                     FILE CHECKLIST                                            ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║   需修改的文件                                                                ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ ] services/stream_processor.py    - 集成 LLM 和实体抽取                  ║
║   [ ] services/glm_service.py         - 添加结构化输出支持                   ║
║   [ ] stores/mentis_db.py             - 支持新表操作                         ║
║   [ ] api/main.py                     - 注册新路由                           ║
║   [ ] migrations/001_init.sql         - 添加新表和列                         ║
║   [ ] apps/web/src/lib/db/schema.ts   - Drizzle schema 更新                  ║
║                                                                               ║
║   需创建的后端文件                                                            ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   [ ] services/prompts.py              - Prompt 模板                         ║
║   [ ] services/llm_emotion_engine.py   - LLM 情绪引擎                        ║
║   [ ] services/daily_digest_service.py - Digest 服务                         ║
║   [ ] services/life_connect_service.py - Life Connect 服务                   ║
║   [ ] services/share_card_service.py   - Share Card 服务                     ║
║   [ ] api/digest_routes.py             - Digest API                          ║
║   [ ] api/entity_routes.py             - Entity API                          ║
║   [ ] api/share_routes.py              - Share API                           ║
║                                                                               ║
║   需创建的前端文件                                                            ║
║   ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║   components/digest/                                                          ║
║   [ ] digest-viewer.tsx                                                       ║
║   [ ] digest-card.tsx                                                         ║
║   [ ] emotion-timeline.tsx                                                    ║
║   [ ] energy-curve.tsx                                                        ║
║   [ ] style-selector.tsx                                                      ║
║                                                                               ║
║   components/life/                                                            ║
║   [ ] entity-list.tsx                                                         ║
║   [ ] entity-card.tsx                                                         ║
║   [ ] confirm-dialog.tsx                                                      ║
║   [ ] pending-entities.tsx                                                    ║
║                                                                               ║
║   components/share/                                                           ║
║   [ ] card-creator.tsx                                                        ║
║   [ ] card-preview.tsx                                                        ║
║   [ ] template-picker.tsx                                                     ║
║   [ ] privacy-settings.tsx                                                    ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

---

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                                                                               ║
║                              END OF DOCUMENT                                  ║
║                                                                               ║
║                         VIBE DIARY: RETHINKING                                ║
║                       From Fragments to Masterpiece                           ║
║                                                                               ║
║  ─────────────────────────────────────────────────────────────────────────   ║
║                                                                               ║
║  Document Version: 3.0 (Implementation Complete)                              ║
║  Last Updated: 2026-01-04                                                     ║
║  Author: Silicon Valley Product Lead                                          ║
║  Implementation: Claude Code                                                  ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```