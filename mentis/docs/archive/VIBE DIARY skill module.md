# VIBE SKILL MODULE SYSTEM v2.3

---

# Part 1: Core Design

## 1.1 Design Principles

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


        VIBE = User's Primary Companion
        
        Skills = Vibe's Extended Capabilities
        
        用户和 Vibe 对话
        Skills 被 Vibe 按需加载


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**Core Principles**

1. **Vibe 是唯一 Persona** — 用户始终和 Vibe 对话
2. **Skill = Claude Skill** — 完全遵循 Claude Skills 规范
3. **按需加载** — Metadata → Body → Resources
4. **订阅决定能力** — Default + Subscribed = Vibe 内化能力

---

## 1.2 Two Modes (Simplified)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   MODE 1: 内化能力                                                      │
│   ─────────────────────────────────────────────────────────────────     │
│                                                                         │
│   适用：Default Skills + User Subscribed Skills                         │
│                                                                         │
│   流程：                                                                │
│   用户消息 → 匹配 Skill → 加载 → Vibe 直接回答                          │
│                                                                         │
│   用户感知：Vibe 本来就懂                                               │
│                                                                         │
│   ═══════════════════════════════════════════════════════════════════   │
│                                                                         │
│   MODE 2: 推荐能力                                                      │
│   ─────────────────────────────────────────────────────────────────     │
│                                                                         │
│   适用：Unsubscribed Skills                                             │
│                                                                         │
│   流程：                                                                │
│   用户消息 → 匹配 Skill → 基于 Skill Meta 给粗浅回答                    │
│            → 推荐 Skill Card → 用户确认 → 完整体验                      │
│                                                                         │
│   用户感知：Vibe 推荐了一个专业工具                                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**简化说明**

之前的 Mode 2a/2b 合并为一个 Mode 2：
- 无论显式请求还是隐含意图，流程相同
- 都是先给粗浅回答，再推荐 Skill
- 用户确认后才进入完整体验

---

## 1.3 Mode 3: Deep Dialogue (Optional)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   MODE 3: 深度对话（可选，高级功能）                                    │
│   ─────────────────────────────────────────────────────────────────     │
│                                                                         │
│   触发：用户主动请求深度探索                                            │
│                                                                         │
│   流程：                                                                │
│   用户请求 → Vibe 邀请 Expert → Expert 主导对话 → Vibe 总结              │
│                                                                         │
│   角色分工：                                                            │
│   • Expert: 专业主导（基于 Skill 定义的 persona）                       │
│   • Vibe: 协调、补充背景、总结                                          │
│                                                                         │
│   注：此模式仅在用户明确请求时触发，默认不启用                          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# Part 2: Skill Module Design

## 2.1 Directory Structure

```
/skills/
│
├── default/                          # 默认 Skills（所有用户）
│   ├── emotion/                      # 情绪识别
│   ├── life-advice/                  # 生活建议
│   └── reflection/                   # 自我反思引导
│
├── subscription/                     # 订阅 Skills
│   │
│   ├── ─────── 命理类 ───────
│   │
│   ├── bazi/                         # 八字
│   │   ├── SKILL.md
│   │   ├── scripts/
│   │   │   ├── calculator.py
│   │   │   └── transit.py
│   │   ├── references/
│   │   │   ├── theory.md
│   │   │   └── patterns.md
│   │   └── assets/
│   │       └── card.json
│   │
│   ├── ziwei/                        # 紫微斗数
│   │   ├── SKILL.md
│   │   ├── scripts/
│   │   ├── references/
│   │   └── assets/
│   │
│   ├── zodiac/                       # 星座
│   │   ├── SKILL.md
│   │   ├── references/
│   │   └── assets/
│   │
│   ├── ─────── 心理类 ───────
│   │
│   ├── attachment/                   # 依恋模式
│   │   ├── SKILL.md
│   │   ├── scripts/
│   │   │   └── assessment.py
│   │   ├── references/
│   │   │   └── attachment-theory.md
│   │   └── assets/
│   │
│   ├── cognitive/                    # 认知模式（CBT）
│   │   ├── SKILL.md
│   │   ├── references/
│   │   │   ├── distortions.md
│   │   │   └── techniques.md
│   │   └── assets/
│   │
│   ├── inner-child/                  # 内在小孩
│   │   ├── SKILL.md
│   │   ├── references/
│   │   └── assets/
│   │
│   ├── ─────── 关系类 ───────
│   │
│   ├── relationship/                 # 亲密关系
│   │   ├── SKILL.md
│   │   ├── references/
│   │   └── assets/
│   │
│   ├── communication/                # 沟通技巧
│   │   ├── SKILL.md
│   │   ├── references/
│   │   └── assets/
│   │
│   ├── ─────── 成长类 ───────
│   │
│   ├── career/                       # 职业发展
│   │   ├── SKILL.md
│   │   ├── references/
│   │   └── assets/
│   │
│   ├── decision/                     # 决策分析
│   │   ├── SKILL.md
│   │   ├── references/
│   │   └── assets/
│   │
│   └── habit/                        # 习惯养成
│       ├── SKILL.md
│       ├── references/
│       └── assets/
│
└── user/                             # 用户自定义（未来）
```

---

## 2.2 SKILL.md Standard

### Structure

```yaml
---
name: skill-id
description: >
  一句话描述 + 触发场景列表
  这是唯一的触发机制，必须清晰
---

# Skill Name

## Overview
简要说明

## Workflow
工作流程

## References
参考文档列表

## Card
卡片配置说明
```

### Example: 八字 Skill

```markdown
---
name: bazi
description: >
  八字命理分析，解读性格特点和运势周期。触发场景：
  (1) 用户请求看八字、排盘、算命
  (2) 用户询问运势、流年、大运
  (3) 用户提到出生日期想了解命理
  (4) 用户问适合做某事的时机
  关键词：八字、命盘、运势、流年、大运、算命
---

# 八字分析

## Overview

提供八字命盘分析，帮助用户理解性格特点和运势周期。
用现代语言解释传统概念，强调命理是参考而非决定。

## Workflow

1. 收集信息
   - 必需：出生年月日（公历）
   - 可选：出生时辰（提供更准确分析）

2. 排盘分析
   - 使用 `scripts/calculator.py` 排出八字
   - 判断日主强弱和格局
   - 分析十神关系

3. 输出结果
   - 命盘可视化
   - 性格特点解读
   - 运势周期分析
   - 具体建议

## References

- [八字理论](references/theory.md)
- [常见格局](references/patterns.md)

## Card

使用 `assets/card.json` 定义的交互卡片。
输入卡片收集出生信息，结果卡片展示分析。
```

### Example: 依恋模式 Skill

```markdown
---
name: attachment
description: >
  依恋模式分析，识别用户的依恋风格并提供改善建议。触发场景：
  (1) 用户想了解依恋类型/依恋模式
  (2) 用户询问关系模式、亲密关系问题
  (3) 用户提到安全感、被抛弃感、回避亲密
  (4) 用户问"为什么我在关系里总是..."
  关键词：依恋、安全感、回避、焦虑、亲密关系、原生家庭
---

# 依恋模式分析

## Overview

帮助用户识别自己的依恋风格（安全/焦虑/回避/混乱），
理解形成原因，提供改善路径。
不贴标签，强调模式可以改变。

## Workflow

1. 初步评估
   - 通过对话收集关系模式信息
   - 使用 `scripts/assessment.py` 辅助评估

2. 识别风格
   - 安全型：舒适亲密，信任他人
   - 焦虑型：渴望亲密，担心被抛弃
   - 回避型：重视独立，回避亲密
   - 混乱型：矛盾，既渴望又恐惧

3. 深入分析
   - 形成原因（通常与早期经历相关）
   - 在当前关系中的表现
   - 对伴侣的影响

4. 改善建议
   - 具体可行的下一步
   - 识别风险信号时建议专业帮助

## References

- [依恋理论](references/attachment-theory.md)

## Card

使用问答式流程卡片，逐步收集信息。
结果卡片展示分析和建议。

## Deep Dialogue

支持 Mode 3 深度对话。
Expert persona: 温暖、有洞察力、不评判、善于用提问引导思考。
```

---

## 2.3 Target User Skills Analysis

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   TARGET USER PROFILE                                                   │
│                                                                         │
│   ═══════════════════════════════════════════════════════════════════   │
│                                                                         │
│   年龄：25-45                                                           │
│   特征：                                                                │
│   • 有一定生活阅历和自省能力                                            │
│   • 对自我成长有追求                                                    │
│   • 缺少"真正懂我"的人                                                 │
│   • 对命理、心理学有好奇心                                              │
│                                                                         │
│   核心需求：                                                            │
│   • 被理解                                                              │
│   • 自我认知                                                            │
│   • 关系问题                                                            │
│   • 人生方向                                                            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### High-Priority Skills (核心付费 Skills)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   TIER 1: 核心 Skills（高频使用，强付费意愿）                           │
│                                                                         │
│   ═══════════════════════════════════════════════════════════════════   │
│                                                                         │
│   1. attachment（依恋模式）                                             │
│      ─────────────────────────────────────────────────────────────      │
│      用户痛点：不知道为什么关系总是出问题                               │
│      价值：帮助理解自己的关系模式                                       │
│      使用场景：                                                         │
│      • "为什么我总是在关系里感到不安全"                                 │
│      • "我好像总是选择不对的人"                                         │
│      • "我不知道怎么和伴侣亲近"                                         │
│                                                                         │
│   2. bazi（八字）                                                       │
│      ─────────────────────────────────────────────────────────────      │
│      用户痛点：想了解自己，对未来有方向感                               │
│      价值：提供自我认知框架和运势参考                                   │
│      使用场景：                                                         │
│      • "帮我看看八字"                                                   │
│      • "最近运势怎么样"                                                 │
│      • "今年适合换工作吗"                                               │
│                                                                         │
│   3. cognitive（认知模式/CBT）                                          │
│      ─────────────────────────────────────────────────────────────      │
│      用户痛点：负面思维、焦虑、自我否定                                 │
│      价值：识别认知扭曲，提供调整方法                                   │
│      使用场景：                                                         │
│      • "我总是觉得自己不够好"                                           │
│      • "为什么我总往坏处想"                                             │
│      • "我很焦虑，停不下来"                                             │
│                                                                         │
│   4. relationship（亲密关系）                                           │
│      ─────────────────────────────────────────────────────────────      │
│      用户痛点：和伴侣的具体问题                                         │
│      价值：分析关系动态，提供沟通建议                                   │
│      使用场景：                                                         │
│      • "我和男朋友总是吵架"                                             │
│      • "我们好像越来越没话说"                                           │
│      • "他不理解我"                                                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### Medium-Priority Skills

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   TIER 2: 重要 Skills（中频使用）                                       │
│                                                                         │
│   ═══════════════════════════════════════════════════════════════════   │
│                                                                         │
│   5. career（职业发展）                                                 │
│      • "我不知道该不该换工作"                                           │
│      • "我对现在的工作没有热情"                                         │
│      • "我想转行但不知道做什么"                                         │
│                                                                         │
│   6. inner-child（内在小孩）                                            │
│      • "我好像一直在讨好别人"                                           │
│      • "我很难真正放松"                                                 │
│      • "我和父母的关系很复杂"                                           │
│                                                                         │
│   7. decision（决策分析）                                               │
│      • "我在纠结要不要..."                                              │
│      • "两个选择我不知道怎么选"                                         │
│      • "我怕做错决定"                                                   │
│                                                                         │
│   8. ziwei（紫微斗数）                                                  │
│      • 八字用户的进阶需求                                               │
│      • 更详细的命盘分析                                                 │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### Lower-Priority Skills

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   TIER 3: 补充 Skills（低频或小众）                                     │
│                                                                         │
│   ═══════════════════════════════════════════════════════════════════   │
│                                                                         │
│   9. zodiac（星座）                                                     │
│      • 轻量级入口，容易上手                                             │
│      • 可以免费或低价引流                                               │
│                                                                         │
│   10. communication（沟通技巧）                                         │
│       • 职场沟通                                                        │
│       • 难以开口的对话                                                  │
│                                                                         │
│   11. habit（习惯养成）                                                 │
│       • 建立新习惯                                                      │
│       • 戒除坏习惯                                                      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# Part 3: Skill Card System

## 3.1 Design Philosophy

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   CARD SYSTEM DESIGN                                                    │
│   借鉴 Google A2UI 理念，简化实现                                       │
│                                                                         │
│   ═══════════════════════════════════════════════════════════════════   │
│                                                                         │
│   A2UI 核心理念：                                                       │
│   • 声明式 JSON，不是可执行代码                                         │
│   • Agent 只能使用预定义组件                                            │
│   • 支持流式更新                                                        │
│   • 框架无关，可跨平台渲染                                              │
│                                                                         │
│   ─────────────────────────────────────────────────────────────────     │
│                                                                         │
│   Vibe Card System（简化版）：                                          │
│   • 声明式 JSON 定义卡片结构                                            │
│   • 预定义组件目录（安全）                                              │
│   • 支持对话内嵌入和更新                                                │
│   • 当前：Web/Mobile 渲染                                               │
│   • 未来：可迁移到 A2UI 标准                                            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## 3.2 Component Catalog

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   COMPONENT CATALOG                                                     │
│   预定义的安全组件                                                      │
│                                                                         │
│   ═══════════════════════════════════════════════════════════════════   │
│                                                                         │
│   Layout Components                                                     │
│   ─────────────────────────────────────────────────────────────────     │
│   • card          卡片容器                                              │
│   • section       分区                                                  │
│   • divider       分隔线                                                │
│   • spacer        间距                                                  │
│                                                                         │
│   Input Components                                                      │
│   ─────────────────────────────────────────────────────────────────     │
│   • text-field    文本输入                                              │
│   • date-picker   日期选择                                              │
│   • time-picker   时间选择                                              │
│   • select        下拉选择                                              │
│   • radio         单选                                                  │
│   • checkbox      多选                                                  │
│   • slider        滑块                                                  │
│                                                                         │
│   Display Components                                                    │
│   ─────────────────────────────────────────────────────────────────     │
│   • text          文本                                                  │
│   • heading       标题                                                  │
│   • image         图片                                                  │
│   • chart         图表（简单）                                          │
│   • progress      进度条                                                │
│   • badge         标签                                                  │
│   • icon          图标                                                  │
│                                                                         │
│   Action Components                                                     │
│   ─────────────────────────────────────────────────────────────────     │
│   • button        按钮                                                  │
│   • link          链接                                                  │
│   • chip          可点击标签                                            │
│                                                                         │
│   Special Components                                                    │
│   ─────────────────────────────────────────────────────────────────     │
│   • chat-input    卡片内对话输入                                        │
│   • flow-step     流程步骤指示器                                        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## 3.3 Card JSON Schema

```json
{
  "skill_id": "bazi",
  "version": "1.0",
  
  "recommend_card": {
    "title": "八字命盘分析",
    "icon": "🔒",
    "description": "解读你的性格特点和运势周期",
    "benefits": [
      "了解天生性格优势",
      "把握运势起伏周期",
      "获得具体行动建议"
    ],
    "actions": [
      { "type": "button", "label": "开始分析", "action": "start" },
      { "type": "link", "label": "先聊聊", "action": "dismiss" }
    ]
  },
  
  "input_card": {
    "title": "八字命盘分析",
    "fields": [
      {
        "id": "birth_date",
        "type": "date-picker",
        "label": "出生日期",
        "required": true
      },
      {
        "id": "birth_time",
        "type": "select",
        "label": "出生时辰",
        "required": false,
        "placeholder": "不确定可跳过",
        "options": [
          { "value": "zi", "label": "子时 (23:00-01:00)" },
          { "value": "chou", "label": "丑时 (01:00-03:00)" },
          { "value": "yin", "label": "寅时 (03:00-05:00)" },
          { "value": "mao", "label": "卯时 (05:00-07:00)" },
          { "value": "chen", "label": "辰时 (07:00-09:00)" },
          { "value": "si", "label": "巳时 (09:00-11:00)" },
          { "value": "wu", "label": "午时 (11:00-13:00)" },
          { "value": "wei", "label": "未时 (13:00-15:00)" },
          { "value": "shen", "label": "申时 (15:00-17:00)" },
          { "value": "you", "label": "酉时 (17:00-19:00)" },
          { "value": "xu", "label": "戌时 (19:00-21:00)" },
          { "value": "hai", "label": "亥时 (21:00-23:00)" }
        ]
      },
      {
        "id": "focus",
        "type": "checkbox",
        "label": "最想了解",
        "options": [
          { "value": "personality", "label": "性格" },
          { "value": "career", "label": "事业" },
          { "value": "relationship", "label": "感情" },
          { "value": "yearly", "label": "今年运势" }
        ]
      }
    ],
    "submit": { "label": "开始分析" }
  },
  
  "result_card": {
    "sections": [
      {
        "id": "chart",
        "type": "custom",
        "component": "bazi-chart"
      },
      {
        "id": "personality",
        "type": "text",
        "title": "性格特点"
      },
      {
        "id": "yearly",
        "type": "text",
        "title": "今年运势"
      },
      {
        "id": "advice",
        "type": "text",
        "title": "建议"
      }
    ],
    "quick_actions": [
      { "label": "看感情运", "action": "query", "params": { "topic": "relationship" } },
      { "label": "看事业运", "action": "query", "params": { "topic": "career" } },
      { "label": "下个月", "action": "query", "params": { "topic": "next_month" } }
    ],
    "allow_chat": true,
    "chat_placeholder": "继续问..."
  },
  
  "subscription_card": {
    "show_after_preview": true,
    "title": "解锁完整分析",
    "benefits": [
      "详细十神解读",
      "每月运势推送",
      "不限次数咨询"
    ],
    "pricing": {
      "monthly": 29,
      "yearly": 199
    }
  }
}
```

## 3.4 Card Rendering Flow

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   CARD RENDERING FLOW                                                   │
│                                                                         │
│   ═══════════════════════════════════════════════════════════════════   │
│                                                                         │
│   1. Vibe 输出包含 Card Directive                                       │
│      ─────────────────────────────────────────────────────────────      │
│                                                                         │
│      Vibe 回复:                                                         │
│      "我可以帮你做八字分析。"                                           │
│                                                                         │
│      [CARD: skill=bazi, type=input]                                     │
│                                                                         │
│   2. Client 解析 Directive，渲染 Card                                   │
│      ─────────────────────────────────────────────────────────────      │
│                                                                         │
│      Client 读取 bazi/assets/card.json                                  │
│      渲染 input_card                                                    │
│                                                                         │
│   3. 用户交互，提交数据                                                 │
│      ─────────────────────────────────────────────────────────────      │
│                                                                         │
│      用户填写表单                                                       │
│      点击"开始分析"                                                     │
│      数据发送给 Vibe                                                    │
│                                                                         │
│   4. Vibe 处理，返回结果                                                │
│      ─────────────────────────────────────────────────────────────      │
│                                                                         │
│      Vibe 调用 scripts/calculator.py                                    │
│      参考 references/theory.md                                          │
│      生成分析结果                                                       │
│                                                                         │
│      [CARD: skill=bazi, type=result, data={...}]                        │
│                                                                         │
│   5. Client 渲染结果 Card                                               │
│      ─────────────────────────────────────────────────────────────      │
│                                                                         │
│      渲染 result_card                                                   │
│      填充数据                                                           │
│      启用 in-card chat                                                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# Part 4: Conversation Examples

## 4.1 Mode 1: 内化能力

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   用户已订阅 bazi skill                                                 │
│                                                                         │
│   ═══════════════════════════════════════════════════════════════════   │
│                                                                         │
│   用户：最近感觉做事总是差一点点，是不是运势问题？                       │
│                                                                         │
│   [后台]                                                                │
│   1. 匹配 bazi skill（用户已订阅）                                      │
│   2. 加载 SKILL.md                                                      │
│   3. 调用 scripts/transit.py                                            │
│   4. 参考 references/theory.md                                          │
│                                                                         │
│   Vibe：                                                                │
│   你最近走到"偏印"运了，这个阶段容易想太多、行动力下降。                │
│   不是运气不好，是需要"慢下来"的阶段。                                  │
│                                                                         │
│   而且你的八字本身木旺，遇到偏印运会放大这个特点。                      │
│   最近有什么事让你特别着急想搞定的吗？                                  │
│                                                                         │
│   ─────────────────────────────────────────────────────────────────     │
│                                                                         │
│   用户感知：Vibe 懂命理，直接帮我分析                                   │
│   无卡片，无推荐，自然对话                                              │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## 4.2 Mode 2: 推荐能力

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   用户未订阅 attachment skill                                           │
│                                                                         │
│   ═══════════════════════════════════════════════════════════════════   │
│                                                                         │
│   用户：我和男朋友在一起三年了，但我总是没有安全感。                     │
│                                                                         │
│   [后台]                                                                │
│   1. 匹配 attachment skill（未订阅）                                    │
│   2. 读取 skill description（不加载完整 body）                          │
│   3. 生成粗浅回答 + 推荐                                                │
│                                                                         │
│   Vibe：                                                                │
│   三年了还没有安全感，这一定让你很累。                                  │
│   安全感的来源很复杂——可能和你的期待有关，                              │
│   也可能和你从小形成的"依恋模式"有关。                                  │
│                                                                         │
│   如果你想深入了解自己的依恋模式，我可以帮你做个分析。                  │
│                                                                         │
│   ┌───────────────────────────────────────────────────────────────┐     │
│   │                                                               │     │
│   │  💡 依恋模式分析                                              │     │
│   │                                                               │     │
│   │  了解你在亲密关系中的模式：                                   │     │
│   │  • 识别你的依恋风格                                           │     │
│   │  • 理解模式形成的原因                                         │     │
│   │  • 获得改善关系的具体建议                                     │     │
│   │                                                               │     │
│   │  [ 开始分析 ]        [ 先聊聊 ]                               │     │
│   │                                                               │     │
│   └───────────────────────────────────────────────────────────────┘     │
│                                                                         │
│   ─────────────────────────────────────────────────────────────────     │
│                                                                         │
│   [用户点击"开始分析"]                                                  │
│                                                                         │
│   Vibe：                                                                │
│   好，我来问你几个问题。                                                │
│                                                                         │
│   ┌───────────────────────────────────────────────────────────────┐     │
│   │                                                               │     │
│   │  💡 依恋模式分析                                              │     │
│   │                                                               │     │
│   │  第一个问题：                                                 │     │
│   │                                                               │     │
│   │  在亲密关系里，你更怕...                                      │     │
│   │                                                               │     │
│   │  ○ 被抛弃、被忽视                                             │     │
│   │  ○ 被控制、失去自由                                           │     │
│   │  ○ 两者都怕                                                   │     │
│   │  ○ 都还好                                                     │     │
│   │                                                               │     │
│   │                              [ 下一步 ]                       │     │
│   │                                                               │     │
│   └───────────────────────────────────────────────────────────────┘     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# Part 5: System Architecture

## 5.1 Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                           USER MESSAGE                                  │
│                                │                                        │
│                                ▼                                        │
│                     ┌─────────────────────┐                             │
│                     │   SKILL MATCHER     │                             │
│                     │   匹配 description  │                             │
│                     └─────────────────────┘                             │
│                                │                                        │
│                 ┌──────────────┼──────────────┐                         │
│                 │              │              │                         │
│                 ▼              ▼              ▼                         │
│            No Match       Subscribed    Not Subscribed                  │
│                 │              │              │                         │
│                 ▼              ▼              ▼                         │
│           Vibe Only       MODE 1         MODE 2                         │
│                 │              │              │                         │
│                 │              ▼              ▼                         │
│                 │         Load SKILL    Read Meta Only                  │
│                 │              │              │                         │
│                 │              ▼              ▼                         │
│                 │         Use Scripts   Shallow Answer                  │
│                 │         & References       │                          │
│                 │              │              ▼                         │
│                 │              │         Recommend Card                 │
│                 │              │              │                         │
│                 │              │              ▼                         │
│                 │              │         User Confirms?                 │
│                 │              │         ┌────┴────┐                    │
│                 │              │        Yes        No                   │
│                 │              │         │          │                   │
│                 │              │         ▼          │                   │
│                 │              │    Load SKILL      │                   │
│                 │              │    Show Card       │                   │
│                 │              │         │          │                   │
│                 └──────────────┴─────────┴──────────┘                   │
│                                │                                        │
│                                ▼                                        │
│                     ┌─────────────────────┐                             │
│                     │   VIBE RESPONSE     │                             │
│                     │   + Optional Card   │                             │
│                     └─────────────────────┘                             │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## 5.2 Data Model

```typescript
interface VibeContext {
  user: {
    id: string
    subscriptions: string[]  // skill_ids
    skillData: Record<string, any>  // 保存的 skill 数据（如八字）
  }
  
  memory: {
    facts: Fact[]
    patterns: Pattern[]
    insights: Insight[]
  }
  
  conversation: {
    messages: Message[]
    activeCard?: CardState
  }
  
  skillRegistry: {
    default: Skill[]
    subscription: Skill[]
  }
}

interface Skill {
  id: string
  name: string
  description: string  // 触发用
  category: 'default' | 'subscription'
  
  // 加载后才有
  body?: string
  scripts?: Script[]
  references?: Reference[]
  cardConfig?: CardConfig
}

interface CardState {
  skillId: string
  type: 'recommend' | 'input' | 'flow' | 'result'
  step?: number
  data?: Record<string, any>
  collapsed: boolean
}
```

---

# Part 6: Future Roadmap

## 6.1 A2UI Integration

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   A2UI INTEGRATION ROADMAP                                              │
│                                                                         │
│   ═══════════════════════════════════════════════════════════════════   │
│                                                                         │
│   Phase 1: Current (v2.3)                                               │
│   ─────────────────────────────────────────────────────────────────     │
│   • 简化的 JSON Card Schema                                             │
│   • 预定义组件目录                                                      │
│   • Web/Mobile 渲染器                                                   │
│                                                                         │
│   Phase 2: A2UI Alignment                                               │
│   ─────────────────────────────────────────────────────────────────     │
│   • 当 A2UI 稳定（v1.0+）后                                             │
│   • 将 Card Schema 迁移到 A2UI 格式                                     │
│   • 使用 A2UI 官方渲染器                                                │
│   • 支持流式更新                                                        │
│                                                                         │
│   Phase 3: Multi-Agent                                                  │
│   ─────────────────────────────────────────────────────────────────     │
│   • 支持 A2A Protocol                                                   │
│   • Skills 可以是远程 Agent                                             │
│   • 跨平台 UI 一致性                                                    │
│                                                                         │
│   ─────────────────────────────────────────────────────────────────     │
│                                                                         │
│   Why wait:                                                             │
│   • A2UI 目前 v0.8，规范还在变化                                        │
│   • 我们的简化方案足够当前需求                                          │
│   • 保持架构兼容，未来可平滑迁移                                        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## 6.2 Skill Expansion

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   SKILL EXPANSION ROADMAP                                               │
│                                                                         │
│   ═══════════════════════════════════════════════════════════════════   │
│                                                                         │
│   Launch (v1.0)                                                         │
│   • bazi, attachment, cognitive, relationship                           │
│   • Default: emotion, reflection, life-advice                           │
│                                                                         │
│   v1.1                                                                  │
│   • career, inner-child, decision                                       │
│   • ziwei, zodiac                                                       │
│                                                                         │
│   v1.2                                                                  │
│   • communication, habit                                                │
│   • 健康相关 skills                                                     │
│                                                                         │
│   v2.0                                                                  │
│   • User-created skills                                                 │
│   • Skill marketplace                                                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# Summary

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


                    VIBE SKILL MODULE SYSTEM v2.3
                    
                    ════════════════════════════


    KEY CHANGES FROM v2.2
    
    1. Insight Module → Skill Module
    
    2. Mode 2a/2b 合并为 Mode 2
       统一流程：粗浅回答 + 推荐 + 确认 + 完整体验
    
    3. 命理类拆分为独立 Skills
       bazi / ziwei / zodiac
    
    4. 基于用户分析的 Skill 优先级
       Tier 1: attachment, bazi, cognitive, relationship
       Tier 2: career, inner-child, decision, ziwei
       Tier 3: zodiac, communication, habit
    
    5. Card System 借鉴 A2UI
       声明式 JSON，预定义组件，未来可迁移


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

**Document Version**: 2.3  
**Last Updated**: January 2026  
**Key Principle**: Vibe is the persona, Skills are capabilities